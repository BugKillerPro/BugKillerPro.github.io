<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Goè¯­è¨€é«˜çº§ç¼–ç¨‹</title>
    <url>/2021/10/24/uncatalog/read_note_Advanced_Go_Programming_01/</url>
    <content><![CDATA[<p>è¯»ä¹¦ç¬”è®°ä¹‹ã€ŠGoè¯­è¨€é«˜çº§ç¼–ç¨‹(Advanced Go Programming)ã€‹</p>
<span id="more"></span>  

<p><img src="/2021/10/24/uncatalog/read_note_Advanced_Go_Programming_01/1.png"><br>&ensp;&ensp;æœ€è¿‘ç»„é‡Œçš„<code>Python</code>å°ä¼™ä¼´ä»¬éƒ½å¼€å§‹å­¦GOäº†,æ‰¾æˆ‘æ¨èä¸‹æ•™ç¨‹,å¯¹äºæœ‰å…¶ä»–è¯­è¨€åŸºç¡€çš„äººæ¥è¯´,<br>æœ‰ä¸¤æœ¬ä¹¦éå¸¸é€‚åˆä½œä¸º<code>GO</code>çš„å…¥é—¨æ•™ç¨‹:  </p>
<ul>
<li><a href="https://chai2010.cn/advanced-go-programming-book/" title="Markdown">Goè¯­è¨€é«˜çº§ç¼–ç¨‹(Advanced Go Programming)</a></li>
<li><a href="https://www.kancloud.cn/kancloud/web-application-with-golang/44105" title="Markdown">Go Web ç¼–ç¨‹</a>  </li>
</ul>
<p>&ensp;&ensp;ä½œè€…åˆ†åˆ«æ˜¯æ›¹æ˜¥æ™–å’Œè°¢å­Ÿå†›,ä¸¤ä½éƒ½æ˜¯<code>GO</code>ä¸­å›½çš„å¸ƒé“å¸ˆã€‚<br>å€Ÿç€è¿™æ¬¡æ¨èçš„æœºä¼š,æˆ‘åˆæŠŠã€ŠGoè¯­è¨€é«˜çº§ç¼–ç¨‹ã€‹è¯»äº†ä¸€é,ä»¥å…å°ä¼™ä¼´ä»¬æ¥é—®æˆ‘çš„æ—¶å€™,è¿˜æœ‰ä¸å¤ªç†Ÿæ‚‰çš„åœ°æ–¹ã€‚ğŸ˜  </p>
<p>&ensp;&ensp;è¯­æ³•åŸºç¡€ç« èŠ‚,è®²çš„æ¯”è¾ƒæµ…æ˜¾,æ¯•ç«Ÿä½œè€…å†åºè¨€é‡Œé¢ä¹Ÿè¯´äº†:  </p>
<pre><code class="text">æœ¬ä¹¦é’ˆå¯¹æœ‰ä¸€å®šGoè¯­è¨€ç»éªŒï¼Œæƒ³æ·±å…¥äº†è§£Goè¯­è¨€å„ç§é«˜çº§ç”¨æ³•çš„å¼€å‘äººå‘˜ã€‚  
å¯¹äºGoè¯­è¨€æ–°æ‰‹ï¼Œåœ¨é˜…è¯»æœ¬ä¹¦å‰å»ºè®®å…ˆç†Ÿè¯»D&amp;Kçš„ã€ŠThe Go Programming Languageã€‹ã€‚  
</code></pre>
<p>&ensp;&ensp;é™¤æ­¤ä¹‹å¤–,åç»­çš„ç« èŠ‚,å°±æ¯”è¾ƒç¬¦åˆä¹¦åé‡Œçš„<code>advenced</code>è¿™ä¸ªä¸­å¿ƒæ€æƒ³äº†.<br>&ensp;&ensp;å…·ä½“çš„å†…å®¹æ–¹é¢,ä½œè€…ç»“åˆå®æˆ˜åœºæ™¯,é€šè¿‡å¾ªåºæ¸è¿›çš„æ–¹å¼ç»™å‡ºäº†ä¸€äº›è§£å†³æ–¹æ¡ˆ,ä½†æ˜¯å…·ä½“åˆ°ä»£ç è½åœ°,è¿˜æ˜¯éœ€è¦è¯»è€…è‡ªå·±å»æ€è€ƒå’Œå®ç°,è¿™ä¸€ç‚¹å¯¹äºç¼–ç¨‹ç»éªŒä¸å¤Ÿä¸°å¯Œçš„æ–°æ‰‹å¯èƒ½ä¸å¤ªå‹å¥½.ä½†æ˜¯å¤šåŠ¨æ‰‹ã€å¤šåŠ¨è„‘æ€»æ˜¯æ²¡é”™çš„.<br>&ensp;&ensp;é˜…è¯»æŠ€å·§æ–¹é¢,å¦‚æœå¯¹è¯­è¨€åº•å±‚çš„ä¸œè¥¿ä¸æ˜¯ç‰¹åˆ«æ„Ÿå…´è¶£æˆ–è€…æ²¡æ—¶é—´çš„è¯,ç¬¬äºŒç«  CGOç¼–ç¨‹ å’Œ ç¬¬ä¸‰ç«  æ±‡ç¼–è¯­è¨€<br>æ˜¯å¯ä»¥ç›´æ¥è·³è¿‡çš„,å‰©ä¸‹çš„å…¶ä»–ç« èŠ‚å¯¹äºåä¸šåŠ¡å¼€å‘çš„åŒå­¦æ¥è¯´å°±å…¨æ˜¯å¹²è´§äº†.<br>&ensp;&ensp;ä¸¤å¹´å‰,åˆšä»<code>java</code>è½¬<code>go</code>çš„æ—¶å€™,å°±é€‰äº†è¿™æœ¬ä¹¦ä½œä¸ºå…¥é—¨ä¹¦ç±,è€Œä¸”å½“æ—¶é¡¹ç›®å¾ˆæ€¥,å‡ ä¹æ˜¯ä¸€è¾¹å­¦ä¸€è¾¹å¼€å‘.ç‰¹åˆ«æ˜¯ç¬¬äº”ç«  GOå’ŒWeb<br>å½“æ—¶é¡¹ç›®ç»„åˆšåˆšå…¨å‘˜è½¬<code>go</code>,å¯¹äº<code>go</code>è¯­è¨€æ–¹é¢çš„è½®å­ç§¯ç´¯ä¸ºç©º,å½“æ—¶çš„<code>leader</code>åˆæ¯”è¾ƒå›ºæ‰§,ä¸æ‰“ç®—ç”¨åŒ…æ‹¬<code>gin</code>åœ¨å†…çš„ä»»ä½•å¼€æºæ¡†æ¶,<br>è€Œè‡ªç ”<code>web</code>æ¡†æ¶çš„ä»»åŠ¡åˆè½åœ¨äº†æˆ‘çš„è‚©ä¸Š,å½“æ—¶,å¯¹äºè¿˜æ²¡å…¥é—¨<code>go</code>çš„æˆ‘,ç¡®å®æœ‰ç‚¹æ…ŒğŸ¤£.æ‰€ä»¥å½“çœ‹åˆ°è¯¥ä¹¦å¾—ç¬¬äº”ç« çš„æ—¶å€™,æˆ‘å°±åƒé«˜åŸååº”æ‚£è€…<br>çªç„¶å¾—åˆ°äº†ä¸é™é‡æ°§æ°”ç“¶ä¸€æ ·,å…´å¥‹å’Œæ¿€åŠ¨çš„åŠ æŒä¸‹,è¾¹æ¬ç –è¾¹è¯»è¿™æœ¬ä¹¦,ä»…ç”¨äº†3å¤©å·¦å³å°±æŠŠè¿™æœ¬ä¹¦å¸æ”¶äº†,å½“ç„¶,ç¬¬äºŒç« å’Œç¬¬ä¸‰ç« è·³è¿‡äº†.ğŸ˜‚<br>çœ‹å®Œä¹‹å,è¿˜æ²¡æ¥å¾—åŠçœ‹ä¸€çœ‹<code>gin</code>çš„æºç ,å°±å¼€å§‹è‡ªå·±æ‰‹æ’¸<code>web</code>æ¡†æ¶äº†,å¥½åœ¨æ˜¯åŸºäº<code>httprouter</code>åšè·¯ç”±ç®¡ç†å¼€å‘çš„,ä¸Šçº¿ä¹‹å,è¾¹ç»´æŠ¤è¾¹è¿­ä»£,<br>å¯ç”¨æ€§å’Œæ€§èƒ½æ–¹é¢è¿˜æ²¡æœ‰å‡ºè¿‡æ˜æ˜¾çš„é—®é¢˜.æ„Ÿè°¢è¿™æœ¬ä¹¦,æ‰®æ¼”äº†æ•‘ç«çš„è§’è‰².<br>&ensp;&ensp;æœ€è¿‘å†æ¬¡æ‹¿èµ·è¿™æœ¬ä¹¦,çœ‹å®Œä¹‹å,å¤©ç©ºé£˜æ¥äº”ä¸ªå­—â€¦,ä¸å¥½æ„æ€,é‡æ¥,è„‘æµ·é‡Œåªæœ‰å››ä¸ªå­—:å¼€å·æœ‰ç›Š.å·®ä¸å¤šå¿«æœ‰ä¸€å¹´æ²¡æœ‰è¯»è¿‡å®Œæ•´çš„ä¸€æœ¬ä¹¦äº†,<br>ç†ç”±å’Œå¤§å®¶ä¸€æ ·â€“æ²¡æ—¶é—´ğŸ¤£.è€Œä¸”æœ€è¿‘åŠå¹´çŠ¶æ€ä¹Ÿä¸å¤ªå¥½,è‡ªæˆ‘åæ€äº†ä¸€ä¸‹,ä¸»è¦åŸå› å°±æ˜¯è‚¡ç¥¨;3æœˆä»½å¼€å‘äº†ä¸€ä¸ªé€‰è‚¡ç³»ç»Ÿ,åˆšä¸Šçº¿æ—¶,æ•ˆæœéå¸¸å‡¶çŒ›.ç»è¿‡ç³»ç»Ÿå’Œæˆ‘ä¸ªäººçš„<br>ä¸¤å±‚ç­›é€‰ä¹‹å,é€‰å‡ºçš„è‚¡ç¥¨æˆåŠŸç‡å‡ ä¹100%,è€Œä¸”æ¶¨å¹…ä¹Ÿä¸å°,é€šå¸¸2å‘¨å·¦å³,30%å·¦å³çš„æ¶¨å¹….æ‰€ä»¥åˆšå¼€å§‹å°ä»“ä½è¯•æ°´,æ•ˆæœéå¸¸ç†æƒ³.æ‰€ä»¥ä¸ªäººå¿ƒæ€å°±å˜äº†,<br>å¾ˆéš¾å†é™ä¸‹æ¥å¿ƒç»§ç»­æé«˜è‡ªå·±äº†.å¯æƒœ,åˆ°äº†8æœˆä»½,ç³»ç»Ÿä¼¼ä¹ä¸çµäº†,å¯¼è‡´æˆªæ­¢åˆ°ç°åœ¨,è¿˜æ˜¯äºæŸçŠ¶æ€.æ‰€ä»¥è¿™æ¬¡è¯»å®Œè¿™æœ¬ä¹¦ä¹‹å,å¿ƒç†å¹³é™äº†ä¸å°‘,æ„Ÿè°¢è¿™æœ¬ä¹¦,å†æ¬¡æ‰®æ¼”äº†æ•‘ç«çš„è§’è‰²,<br>è®©æˆ‘å¹³é™äº†ä¸‹æ¥.<br>&ensp;&ensp;å½“ç„¶äº†,è¿™æœ¬ä¹¦ä¹Ÿæœ‰ä¸å°‘çš„ç¼ºé™·,æ¯”å¦‚åœ¨å®è·µæ–¹é¢,æ¯æ¯è®²åˆ°ç—›ç‚¹å°±çªç„¶å³°å›è·¯è½¬å¦èµ·ä¸€ç« ,æ²¡æœ‰å…·ä½“çš„è½åœ°æ–¹æ¡ˆ,ä¸ç¦è®©äººæœ‰äº›å¤±æœ›.ä½†æ˜¯å¯¹äºé±¼é¾™æ··æ‚çš„<br><code>go</code>æ•™ç¨‹æ¥è¯´,è¿™æœ¬ä¹¦è‡³å°‘åšåˆ°äº†è¨€ä¹‹æœ‰ç‰©,éå¸¸å€¼å¾—ä¸€è¯».</p>
]]></content>
      <tags>
        <tag>è¯»ä¹¦ç¬”è®°</tag>
        <tag>golang</tag>
      </tags>
  </entry>
  <entry>
    <title>article_name.md</title>
    <url>/2021/03/22/uncatalog/ckv998l900007v0r7ex2x5g2g/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>gitå·¥ä½œå®è·µ</title>
    <url>/2021/06/03/git%E5%9B%9E%E5%BF%86%E5%BD%95/git_practice01/</url>
    <content><![CDATA[<p>ä»giteaåˆ‡æ¢åˆ°gitLabå¿«ä¸€å¹´äº†,è€Œä¸”åˆæ˜¯ç‹¬ç«‹å¼€å‘ç»´æŠ¤ä¸€ä¸ªé¡¹ç›®,å¾ˆå¤šgitå‘½ä»¤éƒ½æœ‰äº›æ¨¡ç³Šäº†,é‡æ–°æ•´ç†è®°å½•ä¸€ä¸‹;</p>
<span id="more"></span>
<p><img src="/2021/06/03/git%E5%9B%9E%E5%BF%86%E5%BD%95/git_practice01/0.png"></p>
<h1 id="gitå®è·µ"><a href="#gitå®è·µ" class="headerlink" title="gitå®è·µ"></a>gitå®è·µ</h1><h3 id="1-ä¿®æ”¹ä¸Šæ¬¡çš„æäº¤"><a href="#1-ä¿®æ”¹ä¸Šæ¬¡çš„æäº¤" class="headerlink" title="1 ä¿®æ”¹ä¸Šæ¬¡çš„æäº¤"></a>1 ä¿®æ”¹ä¸Šæ¬¡çš„æäº¤</h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">git add </span><br><span class="line">git commit --amend --no-edit</span><br><span class="line">git push</span><br></pre></td></tr></table></figure></div>
<h3 id="2-åˆ†æ”¯åˆå¹¶å‰ï¼Œåˆå¹¶å¤šæ¬¡æäº¤"><a href="#2-åˆ†æ”¯åˆå¹¶å‰ï¼Œåˆå¹¶å¤šæ¬¡æäº¤" class="headerlink" title="2 åˆ†æ”¯åˆå¹¶å‰ï¼Œåˆå¹¶å¤šæ¬¡æäº¤"></a>2 åˆ†æ”¯åˆå¹¶å‰ï¼Œåˆå¹¶å¤šæ¬¡æäº¤</h3><h4 id="2-1-åº”ç”¨åœºæ™¯"><a href="#2-1-åº”ç”¨åœºæ™¯" class="headerlink" title="2.1 åº”ç”¨åœºæ™¯"></a>2.1 åº”ç”¨åœºæ™¯</h4><p>å¯¹äºä¸€ä¸ªé¡¹ç›®ï¼Œä½ å¯èƒ½ä¼šå¤šæ¬¡æäº¤ä»£ç ï¼Œæ¯æ¬¡æäº¤éƒ½å¯¹åº”ä¸€ä¸ª<code>commit sha</code></p>
<p><img src="/2021/06/03/git%E5%9B%9E%E5%BF%86%E5%BD%95/git_practice01/1.jpg" alt="avatar"></p>
<p>å½“å®Œæˆé¡¹ç›®ï¼Œè¦è¿›è¡Œåˆ†æ”¯åˆå¹¶çš„æ—¶å€™ï¼Œåªæƒ³ä¿ç•™ä¸€ä¸ªæˆ–æŸå‡ ä¸ª<code>commit</code>ï¼Œè¿™æ—¶å€™å°±éœ€è¦åˆå¹¶<code>commit</code>äº†ã€‚</p>
<h4 id="2-2-å¦‚ä½•åˆå¹¶"><a href="#2-2-å¦‚ä½•åˆå¹¶" class="headerlink" title="2.2 å¦‚ä½•åˆå¹¶"></a>2.2 å¦‚ä½•åˆå¹¶</h4><p>è¿™é‡Œä»‹ç»ä¸¤ç§æ–¹å¼ï¼Œç¬¬ä¸€ç§æ˜¯<code>git rebase</code>ï¼Œç¬¬äºŒç§æ˜¯<code>git rebase --autosquash</code>ï¼Œåè€…åœ¨<code>git commit</code>æ—¶æ˜¯æœ‰æ¡ä»¶çš„ã€‚</p>
<p>1ï¼‰ <code>git rebase</code><br>ç¬¬ä¸€æ­¥ï¼Œå¼€å¯äº¤äº’æ¨¡å¼</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">// æ³¨æ„,è¿™é‡Œçš„&lt;commit_sha&gt;æ˜¯ä½ é’ˆå¯¹æ­¤é¡¹ç›®ç¬¬ä¸€ä¸ªæäº¤çš„å‰ä¸€ä¸ªæäº¤çš„commitã€‚</span><br><span class="line">git rebase -i &lt;commit_sha&gt;</span><br></pre></td></tr></table></figure></div>

<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<p>ä¸‹é¢æ˜¯å·¥ä½œä¸­çš„æäº¤è®°å½•ï¼š</p>
<p><img src="/2021/06/03/git%E5%9B%9E%E5%BF%86%E5%BD%95/git_practice01/2.jpg" alt="avatar"></p>
<p>è¿™æ—¶æˆ‘ä»¬æƒ³è¦æŠŠå‰ä¸ƒä¸ª<code>commit</code>åˆå¹¶æˆä¸€ä¸ªï¼Œå³ï¼š<br><img src="/2021/06/03/git%E5%9B%9E%E5%BF%86%E5%BD%95/git_practice01/3.jpg" alt="avatar"></p>
<p>å…¶ä¸­<code>commit_sha</code>æ˜¯ç¬¬ä¸€ä¸ªæäº¤çš„å‰ä¸€ä¸ªæäº¤çš„å“ˆå¸Œã€‚ å› æ­¤ï¼Œåœ¨æˆ‘çš„ç¤ºä¾‹ä¸­ï¼Œå‘½ä»¤ä¸ºï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">git rebase -i 6394dc</span><br></pre></td></tr></table></figure></div>
<p>ç¬¬äºŒæ­¥ï¼Œå†å»åˆå¹¶</p>
<p>è¿™æ—¶å€™ä¼šå¼¹å‡ºä¸€ä¸ªæ¡†ï¼Œåˆ—å‡ºäº†ä½ æƒ³è¦åˆå¹¶çš„æ‰€æœ‰<code>commit</code>ã€‚æ³¨æ„åˆ—å‡ºçš„é¡ºåºæ˜¯ä»è€åˆ°æ–°çš„ã€‚</p>
<p><img src="/2021/06/03/git%E5%9B%9E%E5%BF%86%E5%BD%95/git_practice01/4.jpg" alt="avatar"></p>
<p>æ›´æ”¹<code>commit_sha</code>æœ€å‰é¢çš„å•è¯ï¼Œæˆ‘ä»¬æ‰“ç®—æŠŠè¿™ä¸ƒä¸ªåˆå¹¶æˆä¸€ä¸ª<code>commit</code>ï¼Œé‚£ä¹ˆæ›´æ”¹å¦‚ä¸‹ï¼š<br><img src="/2021/06/03/git%E5%9B%9E%E5%BF%86%E5%BD%95/git_practice01/5.jpg" alt="avatar"></p>
<p>ä¿å­˜é€€å‡ºåï¼Œåˆå¼¹å‡ºä¸€ä¸ªæ–°çš„æ¡†ï¼Œè®©æˆ‘ä»¬æ›´æ”¹<code>commit</code>ä¿¡æ¯ï¼Œç¼–è¾‘å®Œåé€€å‡ºå°±å¥½äº†ã€‚<br>æœ€åæ‰§è¡Œ:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">git push -f</span><br></pre></td></tr></table></figure></div>
<p>æœ€åå®Œæˆçš„æ•ˆæœå¦‚ä¸‹ï¼š</p>
<p><img src="/2021/06/03/git%E5%9B%9E%E5%BF%86%E5%BD%95/git_practice01/6.png" alt="avatar"></p>
<ol start="2">
<li><code>git rebase --autosquash</code></li>
</ol>
<p>é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯ä¼šè‡ªåŠ¨å¸®ä½ å‹ç¼©<code>commit</code>ã€‚ä½†æ˜¯ä½ åœ¨<code>git commit</code>çš„æ—¶å€™éœ€è¦ä½¿ç”¨ç‰¹æ®Šå‘½ä»¤ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">git commit --fixup=&lt;commit_sha&gt;</span><br></pre></td></tr></table></figure></div>
<p>è¿™é‡Œçš„<code>commit_sha</code>æ˜¯æŒ‡ä½ å¯¹å“ªä¸ª<code>commit</code>è¿›è¡Œäº†æ›´æ”¹ï¼Œæ‰€ä»¥å¿…é¡»å…ˆè‡³å°‘å­˜åœ¨ä¸€ä¸ªå¯¹è¯¥é¡¹ç›®çš„æäº¤ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<p>ä¸‹é¢æ˜¯å·¥ä½œä¸­çš„æäº¤è®°å½•ï¼š</p>
<p><img src="/2021/06/03/git%E5%9B%9E%E5%BF%86%E5%BD%95/git_practice01/7.png" alt="avatar"></p>
<p>æˆ‘ç°åœ¨æœ‰æœ‰äº†ä¸€ä¸ªæ–°çš„æ”¹åŠ¨ï¼Œé‚£ä¹ˆåœ¨æäº¤æ—¶ï¼Œå°±éœ€è¦ç”¨å¦‚ä¸‹å‘½ä»¤è¡¨æ˜æˆ‘æ˜¯å¯¹ä¸Šä¸€ä¸ª<code>commit</code>è¿›è¡Œäº†æ›´æ”¹ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">git commit --fixup=d94e78</span><br></pre></td></tr></table></figure></div>
<p>äº§ç”Ÿçš„æ•ˆæœæ˜¯è¿™æ ·çš„ï¼š</p>
<p><img src="/2021/06/03/git%E5%9B%9E%E5%BF%86%E5%BD%95/git_practice01/8.png" alt="avatar"></p>
<p>è¿™æ—¶å€™åˆæœ‰äº†ä¸€ä¸ªæ–°çš„æ”¹åŠ¨ï¼Œé‚£ä¹ˆæäº¤æ—¶çš„å‘½ä»¤ä¸å˜ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">git commit --fixup=d94e78</span><br></pre></td></tr></table></figure></div>

<p>äº§ç”Ÿçš„æ•ˆæœï¼š</p>
<p><img src="/2021/06/03/git%E5%9B%9E%E5%BF%86%E5%BD%95/git_practice01/9.jpg" alt="avatar"></p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬è¿›è¡Œåˆå¹¶æ“ä½œï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">git rebase --autosquash -i &lt;commit_sha&gt;</span><br></pre></td></tr></table></figure></div>

<p>æ³¨æ„ï¼Œè¿™é‡Œçš„<code>commit_sha</code>æ˜¯<code>older commit6394dc</code>ã€‚</p>
<p>Gitè¿™æ—¶ä¼šå¾ˆæœºæ™ºçš„è¡¥å…¨å•è¯ï¼Œä¸éœ€è¦æ‰‹åŠ¨è¾“å…¥äº†ã€‚</p>
<p><img src="/2021/06/03/git%E5%9B%9E%E5%BF%86%E5%BD%95/git_practice01/10.png" alt="avatar"></p>
<p>ç›´æ¥ä¿å­˜é€€å‡ºï¼Œé‡æ–°ç¼–è¾‘æäº¤ä¿¡æ¯å³å¯ã€‚</p>
<p>ä»¥ä¸Šä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯æäº¤æ—¶è½»æ¾ï¼Œåˆå¹¶æ—¶éº»çƒ¦ï¼Œå¦å¤–ä¸€ç§ç›¸åã€‚å¯ä»¥æ ¹æ®å–œå¥½æ¥é€‰æ‹©ä½¿ç”¨ã€‚</p>
<h3 id="3-å¯¹ç‰¹å®šé¡¹ç›®è®¾ç½®ç”¨æˆ·å-é‚®ç®±-å¯†ç çš„æ–¹æ³•"><a href="#3-å¯¹ç‰¹å®šé¡¹ç›®è®¾ç½®ç”¨æˆ·å-é‚®ç®±-å¯†ç çš„æ–¹æ³•" class="headerlink" title="3 å¯¹ç‰¹å®šé¡¹ç›®è®¾ç½®ç”¨æˆ·å/é‚®ç®±/å¯†ç çš„æ–¹æ³•"></a>3 å¯¹ç‰¹å®šé¡¹ç›®è®¾ç½®ç”¨æˆ·å/é‚®ç®±/å¯†ç çš„æ–¹æ³•</h3><h4 id="3-1-æ‰¾åˆ°é¡¹ç›®æ‰€åœ¨ç›®å½•ä¸‹çš„-gitï¼Œè¿›å…¥-gitæ–‡ä»¶å¤¹ï¼Œç„¶åæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤åˆ†åˆ«è®¾ç½®ç”¨æˆ·åå’Œé‚®ç®±"><a href="#3-1-æ‰¾åˆ°é¡¹ç›®æ‰€åœ¨ç›®å½•ä¸‹çš„-gitï¼Œè¿›å…¥-gitæ–‡ä»¶å¤¹ï¼Œç„¶åæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤åˆ†åˆ«è®¾ç½®ç”¨æˆ·åå’Œé‚®ç®±" class="headerlink" title="3.1.æ‰¾åˆ°é¡¹ç›®æ‰€åœ¨ç›®å½•ä¸‹çš„.gitï¼Œè¿›å…¥.gitæ–‡ä»¶å¤¹ï¼Œç„¶åæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤åˆ†åˆ«è®¾ç½®ç”¨æˆ·åå’Œé‚®ç®±"></a>3.1.æ‰¾åˆ°é¡¹ç›®æ‰€åœ¨ç›®å½•ä¸‹çš„.gitï¼Œè¿›å…¥.gitæ–‡ä»¶å¤¹ï¼Œç„¶åæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤åˆ†åˆ«è®¾ç½®ç”¨æˆ·åå’Œé‚®ç®±</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">git config user.name &quot;BugKillerPro&quot;</span><br><span class="line">git config user.email &quot;511808895@qq.com&quot;</span><br></pre></td></tr></table></figure></div>
<p>ç„¶åæ‰§è¡Œå‘½ä»¤æŸ¥çœ‹configæ–‡ä»¶ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">cat config</span><br></pre></td></tr></table></figure></div>
<p>å‘ç°é‡Œé¢å¤šäº†åˆšæ‰é…ç½®çš„ç”¨æˆ·åå’Œé‚®ç®±ä¿¡æ¯userï¼Œå³æˆåŠŸä¸ºè¯¥é¡¹ç›®å•ç‹¬è®¾ç½®äº†ç”¨æˆ·åå’Œé‚®ç®±</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line">[branch &quot;master&quot;]</span><br><span class="line">    remote = origin</span><br><span class="line">    merge = refs/heads/master</span><br><span class="line">[user]</span><br><span class="line">    name = BugKillerPro</span><br><span class="line">    email = 511808895@qq.com</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>2.å¦‚æœ<code>git pull</code> æ¯æ¬¡éƒ½è¦æ±‚è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼Œåˆ™å¯ä»¥æ‰§è¡Œå¦‚ä¸‹é…ç½®</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">git config credential.helper store</span><br></pre></td></tr></table></figure></div>
<p>æ‰§è¡Œå,<code> cat config</code>æŸ¥çœ‹ï¼Œåˆ™å¤šäº†credentialçš„å†…å®¹ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">[user]</span><br><span class="line">    name = BugKillerPro</span><br><span class="line">    email = 511808895@qq.com</span><br><span class="line">[credential]</span><br><span class="line">        helper = store</span><br></pre></td></tr></table></figure></div>

<p>ç„¶åå†å›åˆ°é¡¹ç›®ç›®å½•ä¸‹æ‰§è¡Œ<code>git pull/push</code>ï¼Œæ ¹æ®æç¤ºè¾“å…¥ç”¨æˆ·åå’Œå¯†ç ï¼Œè¾“å…¥æ­£ç¡®åï¼Œä»¥åå†æ‰§è¡Œ<code>git pull/push</code> å°±ä¸ç”¨è¾“å…¥ç”¨æˆ·åå’Œå¯†ç äº†</p>
<h3 id="4-åˆä½œå¼€å‘åŒä¸€ä¸ªåˆ†æ”¯-æäº¤æœ¬åœ°ä¿®æ”¹æµç¨‹"><a href="#4-åˆä½œå¼€å‘åŒä¸€ä¸ªåˆ†æ”¯-æäº¤æœ¬åœ°ä¿®æ”¹æµç¨‹" class="headerlink" title="4 åˆä½œå¼€å‘åŒä¸€ä¸ªåˆ†æ”¯,æäº¤æœ¬åœ°ä¿®æ”¹æµç¨‹"></a>4 åˆä½œå¼€å‘åŒä¸€ä¸ªåˆ†æ”¯,æäº¤æœ¬åœ°ä¿®æ”¹æµç¨‹</h3><h4 id="ç¬¬ä¸€ç§ï¼š"><a href="#ç¬¬ä¸€ç§ï¼š" class="headerlink" title="ç¬¬ä¸€ç§ï¼š"></a>ç¬¬ä¸€ç§ï¼š</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">git add -A</span><br><span class="line">git commit -m &quot;www&quot;</span><br><span class="line">git push</span><br><span class="line"><span class="meta">#</span><span class="bash"> æ— å†²çª,åˆ™ç»“æŸ,æœ‰å†²çª,åˆ™ç»§ç»­æ‰§è¡Œä¸‹é¢çš„æ“ä½œ</span></span><br><span class="line">git pull --rebase</span><br><span class="line"><span class="meta">#</span><span class="bash"> è§£å†³æœ¬åœ°æ–‡ä»¶å†²çª</span></span><br><span class="line">git add -A</span><br><span class="line">git commit --amend</span><br><span class="line">git rebase --continue</span><br><span class="line">git push</span><br></pre></td></tr></table></figure></div>

<h4 id="ç¬¬äºŒç§ï¼š"><a href="#ç¬¬äºŒç§ï¼š" class="headerlink" title="ç¬¬äºŒç§ï¼š"></a>ç¬¬äºŒç§ï¼š</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">git stash     # æš‚å­˜</span><br><span class="line">git pull      # æœ¬åœ°æ–‡ä»¶ä¼šå˜å¾—å’Œæœ€æ–°è¿œç¨‹ä»“åº“ä¸€è‡´</span><br><span class="line">git stash pop # æš‚å­˜å†…å®¹æ¢å¤</span><br><span class="line"><span class="meta">#</span><span class="bash"> æ— å†²çª,åˆ™push,æœ‰å†²çª,åˆ™ç»§ç»­æ‰§è¡Œä¸‹é¢çš„æ“ä½œ</span></span><br><span class="line">git add -A</span><br><span class="line">git commit -m &quot;www&quot;</span><br><span class="line">git push </span><br></pre></td></tr></table></figure></div>
<p><em><strong>å‚è€ƒ</strong></em></p>
<blockquote>
<p><a href="https://zhuanlan.zhihu.com/p/139321091" title="Markdown">çŸ¥ä¹</a></p>
<p><a href="https://www.jianshu.com/p/bac094fb0222" title="Markdown">ç®€ä¹¦</a></p>
</blockquote>
]]></content>
      <categories>
        <category>gitå›å¿†å½•</category>
      </categories>
      <tags>
        <tag>gitå›å¿†å½•</tag>
      </tags>
  </entry>
  <entry>
    <title>goåç¨‹æ³„éœ² goroutine leak</title>
    <url>/2021/10/27/uncatalog/ckv998l94000av0r75cugcz8d/</url>
    <content><![CDATA[<p>goroutine leak</p>
<span id="more"></span>
<p><img src="/2021/10/27/uncatalog/ckv998l94000av0r75cugcz8d/1.png"></p>
<h1 id="ä»€ä¹ˆæ˜¯æ³„éœ²ï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯æ³„éœ²ï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯æ³„éœ²ï¼Ÿ"></a>ä»€ä¹ˆæ˜¯æ³„éœ²ï¼Ÿ</h1><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="TEXT"><figure class="iseeu highlight /text"><table><tr><td class="code"><pre><span class="line">ä¸å¥½çš„äº‹æƒ…æµä¼ å‡ºå»è®©åˆ«äººçŸ¥é“äº†</span><br></pre></td></tr></table></figure></div>
<p>é¢â€¦â€¦,è¿™ä¸ªè§£é‡Šå¯¹ç¨‹åºå‘˜æ¥è¯´å¥½åƒä¸å¤ªè´´è¿‘ç”Ÿæ´»,é‚£æˆ‘ä»¬æ¢ä¸€ä¸ª  </p>
<h3 id="å†…å­˜æ³„éœ²-Memory-Leak"><a href="#å†…å­˜æ³„éœ²-Memory-Leak" class="headerlink" title="å†…å­˜æ³„éœ²(Memory Leak)"></a>å†…å­˜æ³„éœ²(Memory Leak)</h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="TEXT"><figure class="iseeu highlight /text"><table><tr><td class="code"><pre><span class="line">å¯¹äºjavaç¨‹åºå‘˜æ¥è¯´,è¿™ä¸ªè¯æ±‡è‚¯å®šä¸é™Œç”Ÿ.</span><br><span class="line">å†…å­˜æ³„éœ²æœ¬æ„æ˜¯ç”³è¯·çš„å†…å­˜ç©ºé—´æ²¡æœ‰è¢«æ­£ç¡®é‡Šæ”¾,  </span><br><span class="line">å¯¼è‡´åç»­ç¨‹åºé‡Œè¿™å—å†…å­˜è¢«æ°¸è¿œå ç”¨ï¼ˆä¸å¯è¾¾ï¼‰,  </span><br><span class="line">è€Œä¸”æŒ‡å‘è¿™å—å†…å­˜ç©ºé—´çš„æŒ‡é’ˆä¸å†å­˜åœ¨æ—¶,  </span><br><span class="line">è¿™å—å†…å­˜ä¹Ÿå°±æ°¸è¿œä¸å¯è¾¾äº†,å†…å­˜ç©ºé—´å°±è¿™ä¹ˆä¸€ç‚¹ç‚¹è¢«èš•é£Ÿ.  </span><br><span class="line">å€Ÿç”¨åˆ«äººçš„æ¯”å–»å°±æ˜¯:  </span><br><span class="line">æ¯”å¦‚æœ‰10å¼ çº¸,æœ¬æ¥ä¸€äººä¸€å¼ ,ç”»å®Œè‡ªå·±æ“¦äº†è¿˜å›å»,åˆ«äººå¯ä»¥ç»§ç»­ç”»,ç°åœ¨æœ‰ä¸ªåè›‹è¦äº†çº¸ä¸æ“¦ä¸è¿˜,ç„¶åè¿˜è·‘äº†æ‰¾ä¸åˆ°äººäº†,å¦‚æ­¤å°±åªå‰©ä¸‹9å¼ çº¸ç»™åˆ«äººç”¨äº†,è¿™æ ·çš„äººå¤šèµ·æ¥å,æœ€åå¤§å®¶ä¸€å¼ çº¸éƒ½æ²¡æœ‰äº†;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<h1 id="goåç¨‹æ³„éœ²-goroutine-leak"><a href="#goåç¨‹æ³„éœ²-goroutine-leak" class="headerlink" title="goåç¨‹æ³„éœ²(goroutine leak)"></a>goåç¨‹æ³„éœ²(goroutine leak)</h1><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="TEXT"><figure class="iseeu highlight /text"><table><tr><td class="code"><pre><span class="line">åœ¨Goä¸­,goroutineå¾ˆè½»é‡çº§,éšä¾¿åˆ›å»ºæˆåƒä¸Šä¸‡ä¸ªgoroutineä¸æ˜¯é—®é¢˜,  </span><br><span class="line">ä½†è¦æ³¨æ„,è¦æ˜¯è¿™ä¹ˆå¤šçš„goroutineä¸€è‡´é€’å¢,è€Œä¸é€€å‡º,ä¸é‡Šæ”¾èµ„æº,ä¹Ÿä¼šé€ æˆèµ„æºè€—å°½ã€æœåŠ¡ä¸å¯è¾¾çš„æƒ…å†µ;</span><br></pre></td></tr></table></figure></div>

<h3 id="å¦‚ä½•å‘ç°"><a href="#å¦‚ä½•å‘ç°" class="headerlink" title="å¦‚ä½•å‘ç°"></a>å¦‚ä½•å‘ç°</h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// NumGoroutine returns the number of goroutines that currently exist.</span></span><br><span class="line">  runtime.NumGoroutine()</span><br></pre></td></tr></table></figure></div>
<p>æˆ‘ä»¬å¯ä»¥æŠŠè¿™ä¸ªæ•°æ®å°è£…æˆä¸€ä¸ªæœåŠ¡,é€šè¿‡æŸ¥çœ‹æ¯æ¬¡çš„åç¨‹æ•°é‡çš„å˜åŒ–å’Œå¢å‡,æˆ‘ä»¬å¯ä»¥åˆ¤æ–­æ˜¯å¦æœ‰goroutineæ³„éœ²å‘ç”Ÿ</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line">	<span class="string">&quot;runtime&quot;</span></span><br><span class="line">	<span class="string">&quot;strconv&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">//func getStackTraceHandler(w http.ResponseWriter, r *http.Request) &#123;</span></span><br><span class="line"><span class="comment">//	stack := debug.Stack()</span></span><br><span class="line"><span class="comment">//	w.Write(stack)</span></span><br><span class="line"><span class="comment">//	pprof.Lookup(&quot;goroutine&quot;).WriteTo(w, 2)</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getGCntHandler</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">	cnt := runtime.NumGoroutine()</span><br><span class="line">	fmt.Fprintf(w, strconv.Itoa(cnt))</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">//http.HandleFunc(&quot;/_stack&quot;, getStackTraceHandler)</span></span><br><span class="line">	http.HandleFunc(<span class="string">&quot;/_gc&quot;</span>, getGCntHandler)</span><br><span class="line">	err := http.ListenAndServe(<span class="string">&quot;:8080&quot;</span>, <span class="literal">nil</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatal(<span class="string">&quot;ListenAndServe: &quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<h3 id="å¦‚ä½•ç¡®è®¤æ³„éœ²å¤„"><a href="#å¦‚ä½•ç¡®è®¤æ³„éœ²å¤„" class="headerlink" title="å¦‚ä½•ç¡®è®¤æ³„éœ²å¤„"></a>å¦‚ä½•ç¡®è®¤æ³„éœ²å¤„</h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;log&quot;</span></span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line">	<span class="string">&quot;runtime&quot;</span></span><br><span class="line">	<span class="string">&quot;runtime/debug&quot;</span></span><br><span class="line">	<span class="string">&quot;runtime/pprof&quot;</span></span><br><span class="line">	<span class="string">&quot;strconv&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getStackTraceHandler</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">	stack := debug.Stack()</span><br><span class="line">	w.Write(stack)</span><br><span class="line">	pprof.Lookup(<span class="string">&quot;goroutine&quot;</span>).WriteTo(w, <span class="number">2</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getGCntHandler</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">	cnt := runtime.NumGoroutine()</span><br><span class="line">	fmt.Fprintf(w, strconv.Itoa(cnt))</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	http.HandleFunc(<span class="string">&quot;/_stack&quot;</span>, getStackTraceHandler)</span><br><span class="line">	http.HandleFunc(<span class="string">&quot;/_gc&quot;</span>, getGCntHandler)</span><br><span class="line">	err := http.ListenAndServe(<span class="string">&quot;:8080&quot;</span>, <span class="literal">nil</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		log.Fatal(<span class="string">&quot;ListenAndServe: &quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<h3 id="å¸¸è§çš„äº§ç”ŸåŸå› "><a href="#å¸¸è§çš„äº§ç”ŸåŸå› " class="headerlink" title="å¸¸è§çš„äº§ç”ŸåŸå› "></a>å¸¸è§çš„äº§ç”ŸåŸå› </h3><ul>
<li>ç”±äºchannelçš„è¯»/å†™ç«¯é€€å‡º,å¯¼è‡´channelçš„å†™/è¯»ç«¯goroutineä¸€ç›´é˜»å¡,è€Œæ— æ³•é€€å‡º</li>
<li>goroutineå†…éƒ¨è¿›å…¥æ­»å¾ªç¯,å¯¼è‡´èµ„æºä¸€ç›´æ— æ³•é‡Šæ”¾</li>
</ul>
<h3 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p>åŸºäºä»¥ä¸ŠåŸå› ,å¼€å‘æ—¶éœ€è¦é‡ç‚¹æ³¨æ„ä»¥ä¸‹å‡ ç‚¹:</p>
<ul>
<li>åˆ›å»ºgoroutineæ—¶å°±è¦æƒ³å¥½è¯¥goroutineè¯¥å¦‚ä½•ç»“æŸ.<br>æ¯”å¦‚ï¼š  <ul>
<li>goroutineå®Œæˆå®ƒçš„å·¥ä½œ,æ­£å¸¸return</li>
<li>ç”±äºå‘ç”Ÿäº†æ²¡æœ‰å¤„ç†çš„é”™è¯¯,è¿è¡Œæ—¶å¼‚å¸¸  </li>
<li>æœ‰å…¶ä»–çš„åç¨‹å‘Šè¯‰å®ƒç»ˆæ­¢</li>
</ul>
</li>
<li>ä½¿ç”¨channelæ—¶,è¦è€ƒè™‘åˆ°channelé˜»å¡æ—¶åç¨‹å¯èƒ½çš„è¡Œä¸º </li>
<li>åœ¨åš master-workeræ¨¡å¼ã€producer-consumeræ¨¡å¼ç­‰çš„å¼€å‘æ—¶</li>
</ul>
]]></content>
      <tags>
        <tag>golang</tag>
      </tags>
  </entry>
  <entry>
    <title>goçš„*å’Œ&amp;</title>
    <url>/2021/06/03/go-practice/go_practice_01/</url>
    <content><![CDATA[<p>goçš„*å’Œ&amp;çš„åŒºåˆ«</p>
<span id="more"></span>
<p><img src="/2021/06/03/go-practice/go_practice_01/1.png"></p>
<h3 id="å’Œ-amp-çš„åŒºåˆ«"><a href="#å’Œ-amp-çš„åŒºåˆ«" class="headerlink" title="*å’Œ&amp;çš„åŒºåˆ«"></a>*å’Œ&amp;çš„åŒºåˆ«</h3><blockquote>
<p>&amp;æ˜¯å–åœ°å€ç¬¦å·,å³å–å¾—æŸä¸ªå˜é‡çš„åœ°å€;å¦‚&amp;a<br>*æ˜¯æŒ‡é’ˆè¿ç®—ç¬¦,å¯ä»¥è¡¨ç¤ºä¸€ä¸ªå˜é‡æ˜¯æŒ‡é’ˆç±»å‹,ä¹Ÿå¯ä»¥è¡¨ç¤ºä¸€ä¸ªæŒ‡é’ˆå˜é‡æ‰€æŒ‡å‘çš„å­˜å‚¨å•å…ƒ,ä¹Ÿå°±æ˜¯è¿™ä¸ªåœ°å€æ‰€å­˜å‚¨çš„å€¼,å³æŒ‡é’ˆå–å€¼æˆ–è€….</p>
</blockquote>
]]></content>
      <categories>
        <category>GOå®è·µ</category>
      </categories>
      <tags>
        <tag>golang</tag>
      </tags>
  </entry>
  <entry>
    <title>goè‡ªå®šä¹‰json</title>
    <url>/2021/04/18/go-practice/json_practice01/</url>
    <content><![CDATA[<h5 id="goè‡ªå®šä¹‰json-CustomMarshalJSON"><a href="#goè‡ªå®šä¹‰json-CustomMarshalJSON" class="headerlink" title="goè‡ªå®šä¹‰json,CustomMarshalJSON"></a>goè‡ªå®šä¹‰json,CustomMarshalJSON</h5><blockquote>
<p>éœ€æ±‚æè¿°: golang çš„åŸç”Ÿ json package æœ‰æ—¶ä¼šæœ‰ä¸€äº›ä¸é¢„æœŸä¸ç¬¦åˆçš„æƒ…å†µ,<br>ä¾‹å¦‚å¯¹æ¥ç¼–ç (json.Marshal) golang ä¼šé»˜è®¤ â€œæ•´å‹æµ®ç‚¹æ•°â€ å¦‚: 1.00 è½¬æ¢ä¸ºjson çš„æ•´å‹ 1, ä½†æœ‰æ—¶å¹¶ä¸å¸Œæœ›è¿™ç§è½¬æ¢.<br>æ‰€ä»¥å°±æœ‰äº†CustomMarshalJSON,å³è‡ªå®šä¹‰json</p>
</blockquote>
<hr>
<span id="more"></span>

<p><img src="/2021/04/18/go-practice/json_practice01/1.png"></p>
<blockquote>
<p><a href="https://pkg.go.dev/encoding/json#ex-package--CustomMarshalJSON" title="Markdown">å®˜æ–¹ä¾‹å­</a></p>
</blockquote>
<h6 id="Marshaler-å’Œ-Unmarshaler-æºç "><a href="#Marshaler-å’Œ-Unmarshaler-æºç " class="headerlink" title="Marshaler å’Œ Unmarshaler æºç "></a>Marshaler å’Œ Unmarshaler æºç </h6><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// </span></span><br><span class="line"><span class="comment">// Marshaler is the interface implemented by types that</span></span><br><span class="line"><span class="comment">// can marshal themselves into valid JSON.</span></span><br><span class="line"><span class="keyword">type</span> Marshaler <span class="keyword">interface</span> &#123;</span><br><span class="line">	MarshalJSON() ([]<span class="keyword">byte</span>, error)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Unmarshaler is the interface implemented by types</span></span><br><span class="line"><span class="comment">// that can unmarshal a JSON description of themselves.</span></span><br><span class="line"><span class="comment">// The input can be assumed to be a valid encoding of</span></span><br><span class="line"><span class="comment">// a JSON value. UnmarshalJSON must copy the JSON data</span></span><br><span class="line"><span class="comment">// if it wishes to retain the data after returning.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// By convention, to approximate the behavior of Unmarshal itself,</span></span><br><span class="line"><span class="comment">// Unmarshalers implement UnmarshalJSON([]byte(&quot;null&quot;)) as a no-op.</span></span><br><span class="line"><span class="keyword">type</span> Unmarshaler <span class="keyword">interface</span> &#123;</span><br><span class="line">	UnmarshalJSON([]<span class="keyword">byte</span>) error</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
<h2 id="ä½ åªè¦èƒ½çœ‹æ‡‚ä¸€ä¸ªå•è¯themselvesï¼Œä½ å°±æ˜ç™½è¯¥æ€ä¹ˆè§£å†³ä¸Šé¢éœ€æ±‚æè¿°é‡Œçš„é—®é¢˜äº†ã€‚"><a href="#ä½ åªè¦èƒ½çœ‹æ‡‚ä¸€ä¸ªå•è¯themselvesï¼Œä½ å°±æ˜ç™½è¯¥æ€ä¹ˆè§£å†³ä¸Šé¢éœ€æ±‚æè¿°é‡Œçš„é—®é¢˜äº†ã€‚" class="headerlink" title="ä½ åªè¦èƒ½çœ‹æ‡‚ä¸€ä¸ªå•è¯themselvesï¼Œä½ å°±æ˜ç™½è¯¥æ€ä¹ˆè§£å†³ä¸Šé¢éœ€æ±‚æè¿°é‡Œçš„é—®é¢˜äº†ã€‚"></a>ä½ åªè¦èƒ½çœ‹æ‡‚ä¸€ä¸ªå•è¯<code>themselves</code>ï¼Œä½ å°±æ˜ç™½è¯¥æ€ä¹ˆè§£å†³ä¸Šé¢éœ€æ±‚æè¿°é‡Œçš„é—®é¢˜äº†ã€‚</h2><h6 id="ä¾‹1ï¼š"><a href="#ä¾‹1ï¼š" class="headerlink" title="ä¾‹1ï¼š"></a>ä¾‹1ï¼š</h6><blockquote>
<p>è§£å†³æµ®ç‚¹æ•°æ®ç±»å‹ç¼–ç å°æ•°ä½ä¸¢å¤±çš„é—®é¢˜</p>
</blockquote>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;bytes&quot;</span></span><br><span class="line">	<span class="string">&quot;encoding/json&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;strconv&quot;</span></span><br><span class="line">	<span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Person <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name <span class="keyword">string</span></span><br><span class="line">	Util <span class="keyword">float64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> StrictFloat64 <span class="keyword">float64</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è‡ªå®šä¹‰ç±»å‹ä¸Šå®ç° Marshaler çš„æ¥å£, åœ¨è¿›è¡Œ Marshal æ—¶å°±ä¼šä½¿ç”¨æ­¤é™¤çš„å®ç°æ¥è¿›è¡Œ json ç¼–ç </span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f StrictFloat64)</span> <span class="title">MarshalJSON</span><span class="params">()</span> <span class="params">([]<span class="keyword">byte</span>, error)</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> <span class="keyword">float64</span>(f) == <span class="keyword">float64</span>(<span class="keyword">int</span>(f)) &#123;</span><br><span class="line">		<span class="keyword">return</span> []<span class="keyword">byte</span>(strconv.FormatFloat(<span class="keyword">float64</span>(f), <span class="string">&#x27;f&#x27;</span>, <span class="number">-1</span>, <span class="number">64</span>)), <span class="literal">nil</span> <span class="comment">// å¯ä»¥è‡ªç”±è°ƒæ•´ç²¾åº¦</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> []<span class="keyword">byte</span>(strconv.FormatFloat(<span class="keyword">float64</span>(f), <span class="string">&#x27;f&#x27;</span>, <span class="number">-1</span>, <span class="number">64</span>)), <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> StrictPerson <span class="keyword">struct</span> &#123;</span><br><span class="line">	Name <span class="keyword">string</span></span><br><span class="line">	Util StrictFloat64</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	p1 := Person&#123;<span class="string">&quot;ross&quot;</span>, <span class="number">1.01</span>&#125;</span><br><span class="line">	p2 := Person&#123;<span class="string">&quot;jack&quot;</span>, <span class="number">1.00</span>&#125; </span><br><span class="line">	p1Json, _ := json.Marshal(p1)</span><br><span class="line">	fmt.Println(<span class="string">&quot;\&quot;ross\&quot;, 1.01 --&gt; &quot;</span> + <span class="keyword">string</span>(p1Json))</span><br><span class="line">	p2Json, _ := json.Marshal(p2)</span><br><span class="line">	fmt.Println(<span class="string">&quot;\&quot;ross\&quot;, 1.00 --&gt; &quot;</span> + <span class="keyword">string</span>(p2Json))</span><br><span class="line"></span><br><span class="line">	sp1 := StrictPerson&#123;<span class="string">&quot;ross&quot;</span>, <span class="number">1.01</span>&#125;</span><br><span class="line">	sp2 := StrictPerson&#123;<span class="string">&quot;jack&quot;</span>, <span class="number">1.00001</span>&#125; </span><br><span class="line">	sp1Json, _ := json.Marshal(sp1)</span><br><span class="line">	fmt.Println(<span class="string">&quot;\&quot;ross\&quot;, 1.01 (è‡ªå®šä¹‰ StrictFloat64 ç±»å‹)--&gt; &quot;</span> + <span class="keyword">string</span>(sp1Json))</span><br><span class="line">	sp2Json, _ := json.Marshal(sp2)</span><br><span class="line">	fmt.Println(<span class="string">&quot;\&quot;ross\&quot;, 1.00 (è‡ªå®šä¹‰ StrictFloat64 ç±»å‹) --&gt; &quot;</span> + <span class="keyword">string</span>(sp2Json))</span><br><span class="line"></span><br><span class="line">	p_Demo := &amp;StrictPerson&#123;&#125;</span><br><span class="line">	json.Unmarshal(sp2Json, p_Demo)</span><br><span class="line">	fmt.Printf(<span class="string">&quot;%#v&quot;</span>, p_Demo)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¾“å‡º:</span></span><br><span class="line"><span class="comment">//&quot;ross&quot;, 1.01 --&gt; &#123;&quot;Name&quot;:&quot;ross&quot;,&quot;Util&quot;:1.01&#125;</span></span><br><span class="line"><span class="comment">//&quot;ross&quot;, 1.00 --&gt; &#123;&quot;Name&quot;:&quot;jack&quot;,&quot;Util&quot;:1&#125;</span></span><br><span class="line"><span class="comment">//&quot;ross&quot;, 1.01 (è‡ªå®šä¹‰ StrictFloat64 ç±»å‹)--&gt; &#123;&quot;Name&quot;:&quot;ross&quot;,&quot;Util&quot;:1.01&#125;</span></span><br><span class="line"><span class="comment">//&quot;ross&quot;, 1.00 (è‡ªå®šä¹‰ StrictFloat64 ç±»å‹) --&gt; &#123;&quot;Name&quot;:&quot;jack&quot;,&quot;Util&quot;:1.00001&#125;</span></span><br><span class="line"><span class="comment">//&amp;main.StrictPerson&#123;Name:&quot;jack&quot;, Util:1.00001&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
<h6 id="ä¾‹2ï¼š"><a href="#ä¾‹2ï¼š" class="headerlink" title="ä¾‹2ï¼š"></a>ä¾‹2ï¼š</h6><blockquote>
<p>è§£å†³é2 RFC3339 æ ‡å‡†æ ¼å¼æ—¶é—´è½¬æ¢é—®é¢˜</p>
</blockquote>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> ExTime <span class="keyword">struct</span> &#123;</span><br><span class="line">	time.Time</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t *ExTime)</span> <span class="title">UnmarshalJSON</span><span class="params">(b []<span class="keyword">byte</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">	b = bytes.Trim(b, <span class="string">&quot;\&quot;&quot;</span>)  <span class="comment">// æ­¤é™¤éœ€è¦å»æ‰ä¼ å…¥çš„æ•°æ®çš„ä¸¤ç«¯çš„ &quot;&quot;</span></span><br><span class="line">	ext, err := time.Parse(ExTimeUnmarshalTimeFormat, <span class="keyword">string</span>(b))</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="comment">// do something</span></span><br><span class="line">	&#125;</span><br><span class="line">	*t = ExTime&#123;ext&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(t ExTime)</span> <span class="title">MarshalJSON</span><span class="params">()</span> <span class="params">([]<span class="keyword">byte</span>, error)</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> stamp = fmt.Sprintf(<span class="string">&quot;\&quot;%s\&quot;&quot;</span>, time.Time(t.Time).Format(ExTimeMarshalTimeFormat))</span><br><span class="line">	<span class="keyword">return</span> []<span class="keyword">byte</span>(stamp), <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ExTimeUnmarshalTimeFormat = <span class="string">&quot;2006-01-02 15:04:05&quot;</span></span><br><span class="line"><span class="keyword">var</span> ExTimeMarshalTimeFormat = <span class="string">&quot;2006-01-02 15:04:05&quot;</span></span><br></pre></td></tr></table></figure></div>

<h6 id="ä¾‹3ï¼š"><a href="#ä¾‹3ï¼š" class="headerlink" title="ä¾‹3ï¼š"></a>ä¾‹3ï¼š</h6><blockquote>
<p>è§£å†³å†…åµŒç»“æ„ä½“åºåˆ—åŒ–é—®é¢˜</p>
</blockquote>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Message <span class="keyword">struct</span> &#123;</span><br><span class="line">    From <span class="keyword">string</span>     <span class="string">`json:&quot;from&quot;`</span></span><br><span class="line">    To   <span class="keyword">string</span>     <span class="string">`json:&quot;to&quot;`</span></span><br><span class="line">    Data <span class="keyword">string</span> <span class="string">`json:&quot;data&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    msg := Message&#123;</span><br><span class="line">        From: <span class="string">&quot;XiaoMing&quot;</span>,</span><br><span class="line">        To:   <span class="string">&quot;LiGang&quot;</span>,</span><br><span class="line">        Data: <span class="string">`&#123;&quot;title&quot;:&quot;test&quot;,&quot;body&quot;:&quot;something&quot;&#125;`</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    jsonData, err := json.Marshal(msg)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="built_in">panic</span>(err)</span><br><span class="line">    &#125;</span><br><span class="line">    fmt.Println(<span class="keyword">string</span>(jsonData))</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼ŒDataå­—æ®µæ˜¯stringç±»å‹ï¼Œä½†æ˜¯ä¿å­˜çš„å†…å®¹æ˜¯jsonæ ¼å¼çš„æ•°æ®ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œç¨‹åºè¾“å‡ºï¼š</span></span><br><span class="line"><span class="comment">// &#123;&quot;from&quot;:&quot;XiaoMing&quot;,&quot;to&quot;:&quot;LiGang&quot;,&quot;data&quot;:&quot;&#123;\&quot;title\&quot;:\&quot;test\&quot;,\&quot;body\&quot;:\&quot;something\&quot;&#125;&quot;&#125;</span></span><br><span class="line"><span class="comment">// åºåˆ—åŒ–ä¹‹åçš„dataæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²,è€Œä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„jsonç»“æ„çš„å­—ç¬¦ä¸²</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è§£å†³åŠæ³•ï¼š</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> JsonString <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(j JsonString)</span> <span class="title">MarshalJSON</span><span class="params">()</span> <span class="params">([]<span class="keyword">byte</span>, error)</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;marshal...&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> []<span class="keyword">byte</span>(j), <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Message2 <span class="keyword">struct</span> &#123;</span><br><span class="line">    From <span class="keyword">string</span>     <span class="string">`json:&quot;from&quot;`</span></span><br><span class="line">    To   <span class="keyword">string</span>     <span class="string">`json:&quot;to&quot;`</span></span><br><span class="line">    Data JsonString <span class="string">`json:&quot;data&quot;`</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>]]></content>
      <categories>
        <category>GOå®è·µ</category>
      </categories>
      <tags>
        <tag>golang</tag>
      </tags>
  </entry>
  <entry>
    <title>shellå›å¿†å½•</title>
    <url>/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/</url>
    <content><![CDATA[<p>ä»javaåˆ‡æ¢åˆ°goä¹‹å,å°±å¾ˆå°‘ç™»åˆ°æœåŠ¡å™¨ä¸Šæ’æŸ¥é—®é¢˜äº†,åŠ ä¹‹CICDé¡ºåˆ©ä¸Šçº¿å’Œåº”ç”¨å·¥ç¨‹å¸ˆçš„é…å¤‡,åœ¨æœåŠ¡å™¨ä¸Šæ•²å‘½ä»¤å’Œå†™shellè„šæœ¬çš„æœºä¼šå°±æ›´å°‘äº†ã€‚<br>ä½†æ˜¯,è¿™é—¨ä¼ ç»Ÿæ‰‹è‰ºå’±ä¸èƒ½è½ä¸‹,é‚å†™ä¸‹è¯¥å›å¿†å½•,æƒ³åˆ°å“ªå†™åˆ°å“ªå§.è§è°…ï¼</p>
<span id="more"></span>

<p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/0.png"></p>
<h3 id="1-ä»€ä¹ˆæ˜¯shell"><a href="#1-ä»€ä¹ˆæ˜¯shell" class="headerlink" title="1,ä»€ä¹ˆæ˜¯shell"></a>1,ä»€ä¹ˆæ˜¯<code>shell</code></h3><p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/1.png"></p>
<h3 id="2-linux-çš„å¯åŠ¨è¿‡ç¨‹"><a href="#2-linux-çš„å¯åŠ¨è¿‡ç¨‹" class="headerlink" title="2,linux çš„å¯åŠ¨è¿‡ç¨‹"></a>2,<code>linux</code> çš„å¯åŠ¨è¿‡ç¨‹</h3><p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/2.png"></p>
<h3 id="3-shell-è„šæœ¬"><a href="#3-shell-è„šæœ¬" class="headerlink" title="3,shell è„šæœ¬"></a>3,<code>shell</code> è„šæœ¬</h3><p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/3.png">  </p>
<p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/4.png"></p>
<h3 id="3-1-ç®¡é“"><a href="#3-1-ç®¡é“" class="headerlink" title="3.1,ç®¡é“"></a>3.1,ç®¡é“</h3><p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/5.png"></p>
<h3 id="3-2-é‡å®šå‘"><a href="#3-2-é‡å®šå‘" class="headerlink" title="3.2,é‡å®šå‘"></a>3.2,é‡å®šå‘</h3><p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/6.png"></p>
<h3 id="3-3-å˜é‡"><a href="#3-3-å˜é‡" class="headerlink" title="3.3,å˜é‡"></a>3.3,å˜é‡</h3><p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/7.png">  </p>
<p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/8.png">  </p>
<p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/9.png">  </p>
<p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/10.png"></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> <span class="variable">$n</span> :ç¬¬nä¸ªå‚æ•°,å¦‚æœn&gt;=10,éœ€è¦å†™ä¸º<span class="variable">$&#123;10&#125;</span>çš„æ ¼å¼;</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="variable">$&#123;n-_&#125;</span> :ç¬¬nä¸ªå‚æ•°å¦‚æœä¸ºç©º,åˆ™è®¾ç½®ä¸º_,_ä¹Ÿå¯ä»¥ç”¨å…¶ä»–å­—ç¬¦æ›¿æ¢;</span></span><br></pre></td></tr></table></figure></div>

<p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/11.png"><br><a href="https://blog.csdn.net/smile_from_2015/article/details/80058351">è¯¦è§£</a></p>
<p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/12.png"></p>
<h3 id="3-4-è½¬ä¹‰ä¸å¼•ç”¨"><a href="#3-4-è½¬ä¹‰ä¸å¼•ç”¨" class="headerlink" title="3.4,è½¬ä¹‰ä¸å¼•ç”¨"></a>3.4,è½¬ä¹‰ä¸å¼•ç”¨</h3><p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/13.png"></p>
<h3 id="3-5-è¿ç®—ç¬¦"><a href="#3-5-è¿ç®—ç¬¦" class="headerlink" title="3.5,è¿ç®—ç¬¦"></a>3.5,è¿ç®—ç¬¦</h3><p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/14.png">  </p>
<p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/15.png"></p>
<p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/16.png"></p>
<p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/17.png"></p>
<p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/18.png"></p>
<p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/20.png">  </p>
<p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/21.png"></p>
<p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/22.png">  </p>
<p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/23.png"></p>
<p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/24.png">  </p>
<p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/25.png">  </p>
<p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/26.png">  </p>
<p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/27.png">  </p>
<h3 id="3-6-shell-è„šæœ¬çš„æµ‹è¯•å’Œåˆ¤æ–­"><a href="#3-6-shell-è„šæœ¬çš„æµ‹è¯•å’Œåˆ¤æ–­" class="headerlink" title="3.6,```shell``è„šæœ¬çš„æµ‹è¯•å’Œåˆ¤æ–­"></a>3.6,```shell``è„šæœ¬çš„æµ‹è¯•å’Œåˆ¤æ–­</h3><p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/28.png">  </p>
<p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/29.png"></p>
<p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/30.png">  </p>
<p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/31.png">  </p>
<p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/32.png">  </p>
<p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/33.png">  </p>
<p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/34.png">  </p>
<p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/35.png">  </p>
<p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/36.png"> </p>
<p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/37.png">  </p>
<p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/38.png">  </p>
<p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/39.png">  </p>
<p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/40.png"></p>
<p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/41.png">  </p>
<p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/42.png"></p>
<p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/43.png">  </p>
<p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/44.png">  </p>
<p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/45.png">  </p>
<p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/46.png"></p>
<p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/48.png"></p>
<p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/47.png">  </p>
<p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/49.png">  </p>
<p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/50.png">  </p>
<p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/51.png">  </p>
<p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/52.png">  </p>
<p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/53.png">  </p>
<h3 id="3-6-å‡½æ•°"><a href="#3-6-å‡½æ•°" class="headerlink" title="3.6,å‡½æ•°"></a>3.6,å‡½æ•°</h3><p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/54.png"></p>
<p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/55.png">  </p>
<p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/56.png">  </p>
<p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/57.png">  </p>
<p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/58.png">  </p>
<p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/59.png">  </p>
<p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/60.png"> </p>
<p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/61.png">  </p>
<h3 id="3-6-ä¿¡å·"><a href="#3-6-ä¿¡å·" class="headerlink" title="3.6,ä¿¡å·"></a>3.6,ä¿¡å·</h3><p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/62.png">  </p>
<p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/63.png"> </p>
<p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/64.png"> </p>
<h3 id="3-6-è®¡åˆ’ä»»åŠ¡"><a href="#3-6-è®¡åˆ’ä»»åŠ¡" class="headerlink" title="3.6,è®¡åˆ’ä»»åŠ¡"></a>3.6,è®¡åˆ’ä»»åŠ¡</h3><p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/65.png"></p>
<p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/66.png"></p>
<p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/67.png"> </p>
<p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/68.png"> </p>
<p><img src="/2021/07/01/uncatalog/ckv998l99000kv0r7d8izhbnp/69.png"> </p>
]]></content>
      <tags>
        <tag>linuxå›å¿†å½•</tag>
      </tags>
  </entry>
  <entry>
    <title>linuxå›å¿†å½•</title>
    <url>/2021/07/01/uncatalog/ckv998l9b000mv0r7fcfrav6u/</url>
    <content><![CDATA[<p>ä»javaåˆ‡æ¢åˆ°goä¹‹å,å°±å¾ˆå°‘ç™»åˆ°æœåŠ¡å™¨ä¸Šæ’æŸ¥é—®é¢˜äº†,åŠ ä¹‹CICDé¡ºåˆ©ä¸Šçº¿å’Œåº”ç”¨å·¥ç¨‹å¸ˆçš„é…å¤‡,åœ¨æœåŠ¡å™¨ä¸Šæ•²å‘½ä»¤å’Œå†™shellè„šæœ¬çš„æœºä¼šå°±æ›´å°‘äº†ã€‚<br>ä½†æ˜¯,è¿™é—¨ä¼ ç»Ÿæ‰‹è‰ºå’±ä¸èƒ½è½ä¸‹,é‚å†™ä¸‹è¯¥å›å¿†å½•,æƒ³åˆ°å“ªå†™åˆ°å“ªå§.è§è°…ï¼</p>
<span id="more"></span>

<p><img src="/2021/07/01/uncatalog/ckv998l9b000mv0r7fcfrav6u/0.png"></p>
<h3 id="1-åŸºç¡€"><a href="#1-åŸºç¡€" class="headerlink" title="1,åŸºç¡€"></a>1,åŸºç¡€</h3><h4 id="1-1-ä¸‡èƒ½manå‘½ä»¤"><a href="#1-1-ä¸‡èƒ½manå‘½ä»¤" class="headerlink" title="1.1 ä¸‡èƒ½manå‘½ä»¤"></a>1.1 ä¸‡èƒ½<code>man</code>å‘½ä»¤</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åŠŸèƒ½ï¼šæ ¼å¼åŒ–å¹¶æ˜¾ç¤ºåœ¨çº¿å¸®åŠ©æ‰‹å†Œé¡µé¢.(ä¹Ÿå°±æ˜¯æŸ¥çœ‹å‘½ä»¤çš„å¸®åŠ©ä¿¡æ¯)</span></span><br><span class="line">man ls</span><br><span class="line"><span class="meta">#</span><span class="bash"> è¾“å‡º:</span></span><br><span class="line">LS(1)                         General Commands Manual                         LS(1)</span><br><span class="line"></span><br><span class="line">NAME</span><br><span class="line">       ls, dir, vdir - åˆ—ç›®å½•å†…å®¹</span><br><span class="line"></span><br><span class="line">æè¦</span><br><span class="line">       ls [é€‰é¡¹] [æ–‡ä»¶å...]</span><br><span class="line"></span><br><span class="line">       POSIX æ ‡å‡†é€‰é¡¹: [-CFRacdilqrtu1]</span><br><span class="line"></span><br><span class="line">GNU é€‰é¡¹ (çŸ­æ ¼å¼):</span><br><span class="line">       [-1abcdfgiklmnopqrstuxABCDFGLNQRSUX]   [-w  cols]  [-T  cols]  [-I  pattern]</span><br><span class="line">       [--full-time] [--format=&#123;long,verbose,commas,across,vertical,single-column&#125;]</span><br><span class="line">       [--sort=&#123;none,time,size,extension&#125;] [--time=&#123;atime,access,use,ctime,status&#125;]</span><br><span class="line">       [--color[=&#123;none,auto,always&#125;]] [--help] [--version] [--]</span><br><span class="line"></span><br><span class="line">æè¿°ï¼ˆ DESCRIPTION ï¼‰</span><br><span class="line">       ç¨‹åºlså…ˆåˆ—å‡ºéç›®å½•çš„æ–‡ä»¶é¡¹ï¼Œç„¶åæ˜¯æ¯ä¸€ä¸ªç›®å½•ä¸­çš„â€œå¯æ˜¾ç¤ºâ€æ–‡ä»¶ã€‚å¦‚æœ</span><br><span class="line">       æ²¡æœ‰é€‰é¡¹ä¹‹å¤–çš„å‚æ•°ã€è¯‘æ³¨ï¼šå³æ–‡ä»¶åéƒ¨åˆ†ä¸ºç©ºã€‘å‡ºç°ï¼Œç¼ºçœä¸º  &quot;.&quot; ï¼ˆå½“å‰ç›®å½•ï¼‰ã€‚</span><br><span class="line">       é€‰é¡¹â€œ    -d    â€ä½¿å¾—ç›®å½•ä¸éç›®å½•é¡¹åŒæ ·å¯¹å¾…ã€‚é™¤éâ€œ    -a    â€    é€‰é¡¹å‡ºç°ï¼Œæ–‡</span><br><span class="line">       ä»¶åä»¥â€œ.â€å¼€å§‹çš„æ–‡ä»¶ä¸å±â€œå¯æ˜¾ç¤ºâ€æ–‡ä»¶ã€‚</span><br><span class="line"></span><br><span class="line">       ä»¥å½“å‰ç›®å½•ä¸ºå‡†ï¼Œæ¯ä¸€ç»„æ–‡ä»¶ï¼ˆåŒ…æ‹¬éç›®å½•æ–‡ä»¶é¡¹ï¼Œä»¥åŠæ¯ä¸€å†…å«æ–‡ä»¶çš„ç›®å½•ï¼‰åˆ†</span><br><span class="line">       åˆ«æŒ‰æ–‡ä»¶åæ¯”è¾ƒé¡ºåºæ’åºã€‚å¦‚æœâ€œ     -l      â€é€‰é¡¹å­˜åœ¨ï¼Œæ¯ç»„æ–‡ä»¶å‰æ˜¾ç¤ºä¸€æ‘˜è¦è¡Œ:</span><br><span class="line">       ç»™å‡ºè¯¥ç»„æ–‡ä»¶é•¿åº¦ä¹‹å’Œï¼ˆä»¥ 512 å­—èŠ‚ä¸ºå•ä½ï¼‰ã€‚</span><br><span class="line"></span><br><span class="line">       è¾“å‡ºæ˜¯åˆ°æ ‡å‡†è¾“å‡ºï¼ˆ    stdout    ï¼‰ã€‚é™¤éä»¥â€œ   -C   â€é€‰é¡¹è¦æ±‚æŒ‰å¤šåˆ—è¾“å‡ºï¼Œè¾“å‡º</span><br><span class="line">       å°†æ˜¯ä¸€è¡Œä¸€ä¸ªã€‚ç„¶è€Œï¼Œè¾“å‡ºåˆ°ç»ˆç«¯æ—¶ï¼Œå•åˆ—è¾“å‡ºæˆ–å¤šåˆ—è¾“å‡ºæ˜¯ä¸ç¡®å®šçš„ã€‚å¯ä»¥åˆ†åˆ«</span><br><span class="line">       ç”¨é€‰é¡¹â€œ -1 â€ æˆ–â€œ -C â€æ¥å¼ºåˆ¶æŒ‰å•åˆ—æˆ–å¤šåˆ—è¾“å‡ºã€‚</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
<h4 id="1-2-lså‘½ä»¤"><a href="#1-2-lså‘½ä»¤" class="headerlink" title="1.2 lså‘½ä»¤"></a>1.2 <code>ls</code>å‘½ä»¤</h4><p><a href="https://blog.csdn.net/sjzs5590/article/details/8254527b"><code>ls -l</code>è¾“å‡ºå­—æ®µè¯¦è§£</a></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1,æŸ¥çœ‹ç›®å½•å†…å®¹</span></span><br><span class="line">ls [dir_name]</span><br><span class="line"><span class="meta">#</span><span class="bash"> 2,é•¿æ ¼å¼æ˜¾ç¤ºç›®å½•å†…å®¹</span></span><br><span class="line">ls -l [dir_name]</span><br><span class="line"><span class="meta">#</span><span class="bash"> è¾“å‡º</span></span><br><span class="line">drwxr-xr-x 2 root root         6 7æœˆ   1 19:31 linux_demo</span><br><span class="line">-rwxr-xr-x 1 root root   2008912 1æœˆ  26 17:16 main</span><br><span class="line"></span><br><span class="line">ls -lh [dir_name] # è½¬ä¸ºMæˆ–è€…Gæ˜¾ç¤ºå¤§å°</span><br><span class="line"><span class="meta">#</span><span class="bash"> 3,æ˜¾ç¤ºå½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶åŠæ–‡ä»¶å¤¹åŒ…æ‹¬éšè—çš„.å’Œ..</span></span><br><span class="line">ls -a [dir_name]</span><br><span class="line"><span class="meta">#</span><span class="bash"> 4,é€’å½’æ˜¾ç¤º,è¿åŒå­ç›®å½•ä¸€åŒæ˜¾ç¤ºå‡ºæ¥ï¼Œä¹Ÿå°±æ‰€è¯´è¯¥ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶éƒ½ä¼šæ˜¾ç¤ºå‡ºæ¥</span></span><br><span class="line">ls -R [dir_name]</span><br></pre></td></tr></table></figure></div>


<h4 id="1-3-cdå‘½ä»¤"><a href="#1-3-cdå‘½ä»¤" class="headerlink" title="1.3 cdå‘½ä»¤"></a>1.3 <code>cd</code>å‘½ä»¤</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> è¿”å›åˆ°åˆšæ‰çš„ç›®å½•</span></span><br><span class="line">cd -</span><br></pre></td></tr></table></figure></div>

<h4 id="1-4-midirå‘½ä»¤"><a href="#1-4-midirå‘½ä»¤" class="headerlink" title="1.4 midirå‘½ä»¤"></a>1.4 <code>midir</code>å‘½ä»¤</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> é€’å½’åˆ›å»ºç›®å½•,å³ä½¿ä¸Šçº§ç›®å½•ä¸å­˜åœ¨,ä¼šæŒ‰ç›®å½•å±‚çº§è‡ªåŠ¨åˆ›å»ºç›®å½•</span></span><br><span class="line">mkdir -p  a/b/c</span><br></pre></td></tr></table></figure></div>

<h4 id="1-5-cpå‘½ä»¤"><a href="#1-5-cpå‘½ä»¤" class="headerlink" title="1.5 cpå‘½ä»¤"></a>1.5 <code>cp</code>å‘½ä»¤</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1,å¤åˆ¶ç›®å½•/æ–‡ä»¶åˆ°æŒ‡å®šä½ç½®</span></span><br><span class="line">cp source_file/source_dir  target_dir</span><br><span class="line"><span class="meta">#</span><span class="bash"> 2,å¤åˆ¶ç›®å½•/æ–‡ä»¶åˆ°æŒ‡å®šä½ç½®,ä¿ç•™åŸæœ‰æ–‡ä»¶/æ–‡ä»¶å¤¹çš„æ—¶é—´ã€å±ä¸»å’Œæƒé™</span></span><br><span class="line">cp -p source_file/source_dir  target_dir</span><br></pre></td></tr></table></figure></div>

<h4 id="1-6-mvå‘½ä»¤"><a href="#1-6-mvå‘½ä»¤" class="headerlink" title="1.6 mvå‘½ä»¤"></a>1.6 <code>mv</code>å‘½ä»¤</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ç§»åŠ¨/é‡å‘½å æ–‡ä»¶/æ–‡ä»¶å¤¹</span></span><br><span class="line">mv source_file/source_dir   target_file/source_dir</span><br></pre></td></tr></table></figure></div>

<h4 id="1-7-é€šé…ç¬¦"><a href="#1-7-é€šé…ç¬¦" class="headerlink" title="1.7 é€šé…ç¬¦"></a>1.7 é€šé…ç¬¦</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ?åŒ¹é…ä¸€ä¸ª</span></span><br><span class="line">mv file?  /root/tmp #å½“å‰ç›®å½•ä¸‹çš„fileaå°†ä¼šè¢«ç§»åŠ¨åˆ°/root/tmpç›®å½•ä¸‹,fileaaå°†ä¸ä¼šè¢«ç§»åŠ¨</span><br><span class="line"><span class="meta">#</span><span class="bash"> *åŒ¹é…æ‰€æœ‰</span></span><br><span class="line">mv file*  /root/tmp #å½“å‰ç›®å½•ä¸‹çš„fileaå’Œfileaaå°†ä¼šè¢«ç§»åŠ¨åˆ°/root/tmpç›®å½•ä¸‹</span><br></pre></td></tr></table></figure></div>

<h4 id="1-8-catå‘½ä»¤"><a href="#1-8-catå‘½ä»¤" class="headerlink" title="1.8 catå‘½ä»¤"></a>1.8 <code>cat</code>å‘½ä»¤</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æ–‡æœ¬å†…å®¹æ˜¾ç¤ºåˆ°ç»ˆç«¯</span></span><br><span class="line">cat file_name</span><br></pre></td></tr></table></figure></div>

<h4 id="1-9-headå‘½ä»¤"><a href="#1-9-headå‘½ä»¤" class="headerlink" title="1.9 headå‘½ä»¤"></a>1.9 <code>head</code>å‘½ä»¤</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹æ–‡ä»¶å¼€å¤´(nè¡Œ)</span></span><br><span class="line">head [-n] file_name</span><br></pre></td></tr></table></figure></div>

<h4 id="1-10-tailå‘½ä»¤"><a href="#1-10-tailå‘½ä»¤" class="headerlink" title="1.10 tailå‘½ä»¤"></a>1.10 <code>tail</code>å‘½ä»¤</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1,æŸ¥çœ‹æ–‡ä»¶ç»“å°¾(nè¡Œ)</span></span><br><span class="line">tail [-n] file_name</span><br><span class="line"><span class="meta">#</span><span class="bash"> 2,æŸ¥çœ‹æ–‡ä»¶ç»“å°¾,åŒæ­¥è·Ÿæ–°æ˜¾ç¤º</span></span><br><span class="line">tail -f file_name</span><br></pre></td></tr></table></figure></div>

<h4 id="1-11-wcå‘½ä»¤"><a href="#1-11-wcå‘½ä»¤" class="headerlink" title="1.11 wcå‘½ä»¤"></a>1.11 <code>wc</code>å‘½ä»¤</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1,æŸ¥çœ‹æ–‡ä»¶å†…å®¹è¡Œæ•°</span></span><br><span class="line">wc -l file_name</span><br></pre></td></tr></table></figure></div>

<h4 id="1-12-tailå‘½ä»¤"><a href="#1-12-tailå‘½ä»¤" class="headerlink" title="1.12 tailå‘½ä»¤"></a>1.12 <code>tail</code>å‘½ä»¤</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1,æŸ¥çœ‹æ–‡ä»¶ç»“å°¾</span></span><br><span class="line">tail file_name</span><br><span class="line"><span class="meta">#</span><span class="bash"> 2,æŸ¥çœ‹æ–‡ä»¶ç»“å°¾,åŒæ­¥è·Ÿæ–°æ˜¾ç¤º</span></span><br><span class="line">tail -f file_name</span><br></pre></td></tr></table></figure></div>

<h4 id="1-13-æ‰“åŒ…å‹ç¼©å’Œè§£å‹ç¼©å‘½ä»¤"><a href="#1-13-æ‰“åŒ…å‹ç¼©å’Œè§£å‹ç¼©å‘½ä»¤" class="headerlink" title="1.13 æ‰“åŒ…å‹ç¼©å’Œè§£å‹ç¼©å‘½ä»¤"></a>1.13 æ‰“åŒ…å‹ç¼©å’Œè§£å‹ç¼©å‘½ä»¤</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1,æ‰“åŒ…/å¤‡ä»½æ–‡ä»¶å¤¹</span></span><br><span class="line">tar cf dest_file_name.tar target_dir</span><br><span class="line">tar cf /tmp/etc-backup.tar /etc/</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2,è§£åŒ…æ–‡ä»¶</span></span><br><span class="line">tar xf dest_file_name.tar -C target_dir</span><br><span class="line">tar xf /tmp/etc-backup.tar -C /root</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3,æ‰“åŒ…/å¤‡ä»½,å¹¶å‹ç¼©æ–‡ä»¶å¤¹;gzipå‹ç¼©æ–¹å¼,å‹ç¼©é€Ÿåº¦æ›´å¿«</span></span><br><span class="line">tar zcf dest_file_name.tar.gz target_dir</span><br><span class="line">tar zcf /tmp/etc-backup.tar.gz /etc/</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 4,è§£å‹ç¼©æ–‡ä»¶;gzipå‹ç¼©æ–¹å¼</span></span><br><span class="line">tar zxf dest_file_name.tar.gz -C target_dir</span><br><span class="line">tar zxf /tmp/etc-backup.tar.gz -C /etc/</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 5,æ‰“åŒ…/å¤‡ä»½,å¹¶å‹ç¼©æ–‡ä»¶å¤¹;bzip2å‹ç¼©æ–¹å¼,å‹ç¼©æ–‡ä»¶æ›´å°</span></span><br><span class="line">tar jcf dest_file_name.tar.bz2 target_dir</span><br><span class="line">tar jcf /tmp/etc-backup.tar.bz2 /etc/</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 6,è§£å‹ç¼©æ–‡ä»¶;bzip2å‹ç¼©æ–¹å¼</span></span><br><span class="line">tar jxf dest_file_name.tar.bz2 -C target_dir</span><br><span class="line">tar jxf /tmp/etc-backup.tar.bz2 -C /etc/</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
<h3 id="2-å¤šæ¨¡å¼æ–‡æœ¬ç¼–è¾‘å™¨vim"><a href="#2-å¤šæ¨¡å¼æ–‡æœ¬ç¼–è¾‘å™¨vim" class="headerlink" title="2,å¤šæ¨¡å¼æ–‡æœ¬ç¼–è¾‘å™¨vim"></a>2,å¤šæ¨¡å¼æ–‡æœ¬ç¼–è¾‘å™¨<code>vim</code></h3><ul>
<li>æ­£å¸¸æ¨¡å¼</li>
<li>æ’å…¥æ¨¡å¼</li>
<li>å‘½ä»¤æ¨¡å¼</li>
<li>å¯è§†æ¨¡å¼<br><img src="/2021/07/01/uncatalog/ckv998l9b000mv0r7fcfrav6u/vim_op.png"></li>
</ul>
<h4 id="2-1-æ­£å¸¸æ¨¡å¼ä¸‹çš„æ“ä½œ"><a href="#2-1-æ­£å¸¸æ¨¡å¼ä¸‹çš„æ“ä½œ" class="headerlink" title="2.1 æ­£å¸¸æ¨¡å¼ä¸‹çš„æ“ä½œ"></a>2.1 æ­£å¸¸æ¨¡å¼ä¸‹çš„æ“ä½œ</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="TEXT"><figure class="iseeu highlight /text"><table><tr><td class="code"><pre><span class="line"># å¤åˆ¶</span><br><span class="line">å•è¡Œå¤åˆ¶:åœ¨æ­£å¸¸æ¨¡å¼ä¸‹è¾“å…¥yyå³å¯å¤åˆ¶å½“å‰è¡Œ,è¾“å…¥på³å¯ç²˜è´´åˆšæ‰çš„å¤åˆ¶</span><br><span class="line">å¤šè¡Œå¤åˆ¶:åœ¨æ­£å¸¸æ¨¡å¼ä¸‹è¾“å…¥è¦å¤åˆ¶çš„è¡Œæ•°n+yyå³å¯å¤åˆ¶nè¡Œ,è¾“å…¥på³å¯ç²˜è´´åˆšæ‰çš„å¤åˆ¶</span><br><span class="line">è¡Œå†…å¤åˆ¶:åœ¨æ­£å¸¸æ¨¡å¼ä¸‹è¾“å…¥y$å³å¯å¤åˆ¶ä»å½“å‰ä½ç½®åˆ°è¡Œæœ«çš„æ•°æ®,è¾“å…¥på³å¯ç²˜è´´åˆšæ‰çš„å¤åˆ¶</span><br><span class="line"></span><br><span class="line"># å‰ªåˆ‡</span><br><span class="line">å•è¡Œå‰ªåˆ‡:åœ¨æ­£å¸¸æ¨¡å¼ä¸‹è¾“å…¥ddå³å¯å‰ªåˆ‡å½“å‰è¡Œ,è¾“å…¥på³å¯ç²˜è´´åˆšæ‰çš„å‰ªåˆ‡</span><br><span class="line">å¤šè¡Œå¤åˆ¶:åœ¨æ­£å¸¸æ¨¡å¼ä¸‹è¾“å…¥è¦å‰ªåˆ‡çš„è¡Œæ•°n+ddå³å¯å‰ªåˆ‡nè¡Œ,è¾“å…¥på³å¯ç²˜è´´åˆšæ‰çš„å‰ªåˆ‡</span><br><span class="line">è¡Œå†…å‰ªåˆ‡:åœ¨æ­£å¸¸æ¨¡å¼ä¸‹è¾“å…¥d$å³å¯å‰ªåˆ‡ä»å½“å‰ä½ç½®åˆ°è¡Œæœ«çš„æ•°æ®,è¾“å…¥på³å¯ç²˜è´´åˆšæ‰çš„å‰ªåˆ‡</span><br><span class="line"></span><br><span class="line"># æ’¤é”€</span><br><span class="line">å•æ¬¡æ’¤é”€:å•è¾“u</span><br><span class="line">å¤šæ¬¡æ’¤é”€:å¤šæ¬¡è¾“å…¥u</span><br><span class="line">æ’¤é”€æ’¤é”€æ“ä½œ:ctrl + r</span><br><span class="line"></span><br><span class="line"># å…‰æ ‡ç§»åŠ¨</span><br><span class="line">æ˜¾ç¤ºè¡Œå·: å†’å·+set nu</span><br><span class="line">ç§»åŠ¨åˆ°ç¬¬nè¡Œ: n + shift + g</span><br><span class="line">ç§»åŠ¨åˆ°è¡Œé¦–: ^</span><br><span class="line">ç§»åŠ¨åˆ°è¡Œæœ«å°¾: $ </span><br><span class="line"></span><br><span class="line"># åˆ é™¤</span><br><span class="line">åˆ é™¤: x</span><br><span class="line">æ›¿æ¢: r</span><br></pre></td></tr></table></figure></div>

<h4 id="2-2-å‘½ä»¤æ¨¡å¼ä¸‹çš„æ“ä½œ"><a href="#2-2-å‘½ä»¤æ¨¡å¼ä¸‹çš„æ“ä½œ" class="headerlink" title="2.2 å‘½ä»¤æ¨¡å¼ä¸‹çš„æ“ä½œ"></a>2.2 å‘½ä»¤æ¨¡å¼ä¸‹çš„æ“ä½œ</h4><table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>:w</td>
<td>ä¿å­˜ç¼–è¾‘åçš„æ–‡ä»¶å†…å®¹ï¼Œä½†ä¸é€€å‡ºvimç¼–è¾‘å™¨ã€‚è¿™ä¸ªå‘½ä»¤çš„ä½œç”¨æ˜¯æŠŠå†…å­˜ç¼“å†²åŒºä¸­çš„æ•°æ®å†™åˆ°å¯åŠ¨vimæ—¶æŒ‡å®šçš„æ–‡ä»¶ä¸­ã€‚</td>
</tr>
<tr>
<td>:w!</td>
<td>å¼ºåˆ¶å†™æ–‡ä»¶ï¼Œå³å¼ºåˆ¶è¦†ç›–åŸæœ‰æ–‡ä»¶ã€‚å¦‚æœåŸæœ‰æ–‡ä»¶çš„è®¿é—®æƒé™ä¸å…è®¸å†™å…¥æ–‡ä»¶ï¼Œä¾‹å¦‚ï¼ŒåŸæœ‰çš„æ–‡ä»¶ä¸ºåªè¯»æ–‡ä»¶ï¼Œåˆ™å¯ä½¿ç”¨è¿™ä¸ªå‘½ä»¤å¼ºåˆ¶å†™å…¥ã€‚ä½†æ˜¯ï¼Œè¿™ç§å‘½ä»¤ç”¨æ³•ä»…å½“ç”¨æˆ·æ˜¯æ–‡ä»¶çš„å±ä¸»æ—¶æ‰é€‚ç”¨ï¼Œè€Œè¶…çº§ç”¨æˆ·åˆ™ä¸å—æ­¤é™åˆ¶ã€‚</td>
</tr>
<tr>
<td>:wq</td>
<td>ä¿å­˜æ–‡ä»¶å†…å®¹åé€€å‡ºvimç¼–è¾‘å™¨ã€‚è¿™ä¸ªå‘½ä»¤çš„ä½œç”¨æ˜¯æŠŠå†…å­˜ç¼“å†²åŒºä¸­çš„æ•°æ®å†™åˆ°å¯åŠ¨vimæ—¶æŒ‡å®šçš„æ–‡ä»¶ä¸­ï¼Œç„¶åé€€å‡ºvimç¼–è¾‘å™¨ã€‚å¦å¤–ä¸€ç§æ›¿ä»£çš„æ–¹æ³•æ˜¯ç”¨ZZå‘½ä»¤ã€‚</td>
</tr>
<tr>
<td>:wq!</td>
<td>å¼ºåˆ¶ä¿å­˜æ–‡ä»¶å†…å®¹åé€€å‡ºvimç¼–è¾‘å™¨ã€‚è¿™ä¸ªå‘½ä»¤çš„ä½œç”¨æ˜¯æŠŠå†…å­˜ç¼“å†²åŒºä¸­çš„æ•°æ®å¼ºåˆ¶å†™åˆ°å¯åŠ¨vimæ—¶æŒ‡å®šçš„æ–‡ä»¶ä¸­ï¼Œç„¶åé€€å‡ºvimç¼–è¾‘å™¨ã€‚</td>
</tr>
<tr>
<td>:q</td>
<td>åœ¨æœªåšä»»ä½•ç¼–è¾‘å¤„ç†è€Œå‡†å¤‡é€€å‡ºvimæ—¶ï¼Œå¯ä»¥ä½¿ç”¨æ­¤å‘½ä»¤ã€‚å¦‚æœå·²åšè¿‡ç¼–è¾‘å¤„ç†ï¼Œåˆ™vimä¸å…è®¸ç”¨æˆ·ä½¿ç”¨â€œ:qâ€å‘½ä»¤é€€å‡ºï¼ŒåŒæ—¶è¿˜ä¼šè¾“å‡ºä¸‹åˆ—è­¦å‘Šä¿¡æ¯ï¼šNo write since last change (:quit! overrides)</td>
</tr>
<tr>
<td>:q!</td>
<td>å¼ºåˆ¶é€€å‡ºvimç¼–è¾‘å™¨ï¼Œæ”¾å¼ƒç¼–è¾‘å¤„ç†çš„ç»“æœã€‚å¦‚æœç¡®å®ä¸éœ€è¦ä¿å­˜ä¿®æ”¹åçš„æ–‡ä»¶å†…å®¹ï¼Œå¯è¾“å…¥â€œ:q!â€å‘½ä»¤ï¼Œå¼ºè¡Œé€€å‡ºvimç¼–è¾‘å™¨ã€‚</td>
</tr>
<tr>
<td>:s/old/new</td>
<td>å°†å½“å‰è¡Œçš„å­—ç¬¦oldæ›¿æ¢ä¸ºnew</td>
</tr>
<tr>
<td>:%s/old/new/g</td>
<td>å…¨å±€çš„å­—ç¬¦oldæ›¿æ¢ä¸ºnew</td>
</tr>
<tr>
<td>:n,m%s/old/new/g</td>
<td>ç¬¬nè¡Œåˆ°ç¬¬mçš„å­—ç¬¦oldæ›¿æ¢ä¸ºnew</td>
</tr>
<tr>
<td>vim /etc/vimrc</td>
<td>ä¿®æ”¹vimé…ç½®</td>
</tr>
</tbody></table>
<h4 id="2-3-å¯è§†æ¨¡å¼ä¸‹çš„æ“ä½œ"><a href="#2-3-å¯è§†æ¨¡å¼ä¸‹çš„æ“ä½œ" class="headerlink" title="2.3 å¯è§†æ¨¡å¼ä¸‹çš„æ“ä½œ"></a>2.3 å¯è§†æ¨¡å¼ä¸‹çš„æ“ä½œ</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">è¿›å…¥å¯è§†æ¨¡å¼: v</span><br></pre></td></tr></table></figure></div>

<h3 id="3-ç”¨æˆ·ä¸æƒé™ç®¡ç†"><a href="#3-ç”¨æˆ·ä¸æƒé™ç®¡ç†" class="headerlink" title="3,ç”¨æˆ·ä¸æƒé™ç®¡ç†"></a>3,ç”¨æˆ·ä¸æƒé™ç®¡ç†</h3><h4 id="3-1-ç”¨æˆ·ç®¡ç†"><a href="#3-1-ç”¨æˆ·ç®¡ç†" class="headerlink" title="3.1 ç”¨æˆ·ç®¡ç†"></a>3.1 ç”¨æˆ·ç®¡ç†</h4><table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>useradd user_name</td>
<td>æ–°å»ºç”¨æˆ·</td>
</tr>
<tr>
<td>id user_name</td>
<td>æŸ¥çœ‹ç”¨æˆ·</td>
</tr>
<tr>
<td>userdel user_name</td>
<td>åˆ é™¤ç”¨æˆ·</td>
</tr>
<tr>
<td>passwd user_name</td>
<td>è®¾ç½®/ä¿®æ”¹ç”¨æˆ·å¯†ç </td>
</tr>
<tr>
<td>usermod user_name</td>
<td>ä¿®æ”¹ç”¨æˆ·å±æ€§,ç”¨æˆ·ç»„ç­‰</td>
</tr>
<tr>
<td>chage user_name</td>
<td>ä¿®æ”¹ç”¨æˆ·å±æ€§,å¯†ç è¿‡æœŸæ—¶é—´ç­‰</td>
</tr>
<tr>
<td>groupadd group_name</td>
<td>æ·»åŠ ç”¨æˆ·ç»„</td>
</tr>
<tr>
<td>groupdel group_name</td>
<td>åˆ é™¤ç”¨æˆ·ç»„</td>
</tr>
<tr>
<td>su - user_name</td>
<td>åˆ‡æ¢ç”¨æˆ·</td>
</tr>
<tr>
<td>exit</td>
<td>é€€å›åˆšæ‰çš„ç”¨æˆ·</td>
</tr>
</tbody></table>
<h4 id="3-2-ç”¨æˆ·åˆ‡æ¢"><a href="#3-2-ç”¨æˆ·åˆ‡æ¢" class="headerlink" title="3.2 ç”¨æˆ·åˆ‡æ¢"></a>3.2 ç”¨æˆ·åˆ‡æ¢</h4><table>
<thead>
<tr>
<th>å‘½ä»¤</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody><tr>
<td>su - user_name</td>
<td>åˆ‡æ¢ç”¨æˆ·</td>
</tr>
<tr>
<td>sudo command</td>
<td>ä»¥ç³»ç»Ÿç®¡ç†è€…çš„èº«ä»½æ‰§è¡ŒæŒ‡ä»¤ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç»ç”± sudo æ‰€æ‰§è¡Œçš„æŒ‡ä»¤å°±å¥½åƒæ˜¯ root äº²è‡ªæ‰§è¡Œ</td>
</tr>
</tbody></table>
<h4 id="3-3-ç”¨æˆ·å’Œç”¨æˆ·ç»„çš„é…ç½®æ–‡ä»¶"><a href="#3-3-ç”¨æˆ·å’Œç”¨æˆ·ç»„çš„é…ç½®æ–‡ä»¶" class="headerlink" title="3.3 ç”¨æˆ·å’Œç”¨æˆ·ç»„çš„é…ç½®æ–‡ä»¶"></a>3.3 ç”¨æˆ·å’Œç”¨æˆ·ç»„çš„é…ç½®æ–‡ä»¶</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="TEXT"><figure class="iseeu highlight /text"><table><tr><td class="code"><pre><span class="line">ä¸‰ä¸ªé…ç½®æ–‡ä»¶ï¼š</span><br><span class="line">/etc/passwd</span><br><span class="line">/etc/shadow</span><br><span class="line">/etc/group</span><br></pre></td></tr></table></figure></div>

<h4 id="3-3-æ–‡ä»¶-å¤¹-æƒé™"><a href="#3-3-æ–‡ä»¶-å¤¹-æƒé™" class="headerlink" title="3.3 æ–‡ä»¶(å¤¹)æƒé™"></a>3.3 æ–‡ä»¶(å¤¹)æƒé™</h4><p><img src="/2021/07/01/uncatalog/ckv998l9b000mv0r7fcfrav6u/1.png">  </p>
<p><img src="/2021/07/01/uncatalog/ckv998l9b000mv0r7fcfrav6u/2.png">  </p>
<p><img src="/2021/07/01/uncatalog/ckv998l9b000mv0r7fcfrav6u/3.png">  </p>
<p><img src="/2021/07/01/uncatalog/ckv998l9b000mv0r7fcfrav6u/4.png">  </p>
<p><img src="/2021/07/01/uncatalog/ckv998l9b000mv0r7fcfrav6u/5.png">   </p>
<h4 id="3-3-æ–‡ä»¶-å¤¹-æƒé™ä¿®æ”¹"><a href="#3-3-æ–‡ä»¶-å¤¹-æƒé™ä¿®æ”¹" class="headerlink" title="3.3 æ–‡ä»¶(å¤¹)æƒé™ä¿®æ”¹"></a>3.3 æ–‡ä»¶(å¤¹)æƒé™ä¿®æ”¹</h4><p><img src="/2021/07/01/uncatalog/ckv998l9b000mv0r7fcfrav6u/6.png">   </p>
<p>å­—æ¯æ–¹å¼ä¿®æ”¹æƒé™<br><img src="/2021/07/01/uncatalog/ckv998l9b000mv0r7fcfrav6u/7.png"><br>æ•°å­—æ–¹å¼ä¿®æ”¹æƒé™<br><img src="/2021/07/01/uncatalog/ckv998l9b000mv0r7fcfrav6u/8.png"> </p>
<h3 id="4-ç½‘ç»œç®¡ç†"><a href="#4-ç½‘ç»œç®¡ç†" class="headerlink" title="4,ç½‘ç»œç®¡ç†"></a>4,ç½‘ç»œç®¡ç†</h3><h4 id="4-1-ç½‘ç»œçŠ¶æ€æŸ¥çœ‹"><a href="#4-1-ç½‘ç»œçŠ¶æ€æŸ¥çœ‹" class="headerlink" title="4.1,ç½‘ç»œçŠ¶æ€æŸ¥çœ‹"></a>4.1,ç½‘ç»œçŠ¶æ€æŸ¥çœ‹</h4><p><img src="/2021/07/01/uncatalog/ckv998l9b000mv0r7fcfrav6u/9.png"></p>
<p><img src="/2021/07/01/uncatalog/ckv998l9b000mv0r7fcfrav6u/10.png">  </p>
<p><img src="/2021/07/01/uncatalog/ckv998l9b000mv0r7fcfrav6u/11.png">  </p>
<p><img src="/2021/07/01/uncatalog/ckv998l9b000mv0r7fcfrav6u/12.png"></p>
<h4 id="4-2-ç½‘ç»œé…ç½®-å¯ä»¥è·³è¿‡"><a href="#4-2-ç½‘ç»œé…ç½®-å¯ä»¥è·³è¿‡" class="headerlink" title="4.2,ç½‘ç»œé…ç½®(å¯ä»¥è·³è¿‡)"></a>4.2,ç½‘ç»œé…ç½®(å¯ä»¥è·³è¿‡)</h4><p><img src="/2021/07/01/uncatalog/ckv998l9b000mv0r7fcfrav6u/13.png">  </p>
<p><img src="/2021/07/01/uncatalog/ckv998l9b000mv0r7fcfrav6u/14.png"></p>
<h4 id="4-3-ç½‘ç»œæ•…éšœæ’æŸ¥"><a href="#4-3-ç½‘ç»œæ•…éšœæ’æŸ¥" class="headerlink" title="4.3,ç½‘ç»œæ•…éšœæ’æŸ¥"></a>4.3,ç½‘ç»œæ•…éšœæ’æŸ¥</h4><p><img src="/2021/07/01/uncatalog/ckv998l9b000mv0r7fcfrav6u/15.png"></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åˆ°ç›®æ ‡ä¸»æœº(ip/åŸŸå)æ˜¯å¦ç•…é€š</span></span><br><span class="line">ping ip/domain</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ£€æµ‹å‘å‡ºæ•°æ®åŒ…çš„ä¸»æœºåˆ°ç›®æ ‡ä¸»æœºä¹‹é—´æ‰€ç»è¿‡çš„ç½‘å…³æ•°é‡</span></span><br><span class="line">traceroute -w 1 </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> mtr æ˜¯ä¸€ä¸ªé›†åˆ ping å’Œ traceroute åŠŸèƒ½å¹¶èƒ½ç›´è§‚æ˜¾ç¤ºç»“æœçš„ç½‘ç»œè¯Šæ–­å·¥å…·</span></span><br><span class="line">mtr</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŠŠåŸŸåè§£ææˆip</span></span><br><span class="line">nslookup www.baidu.com</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ç«¯å£é€šç•…æƒ…å†µ</span></span><br><span class="line">telnet ip/domian + export </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŠ“åŒ…(åæ–‡è¯¦è®²)</span></span><br><span class="line">tcpdump</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹æœåŠ¡ç›‘å¬åœ°å€</span></span><br><span class="line">netstat -ntpl</span><br><span class="line">ss -ntpl</span><br></pre></td></tr></table></figure></div>

<h4 id="4-3-ç½‘ç»œæœåŠ¡ç®¡ç†-è·³è¿‡"><a href="#4-3-ç½‘ç»œæœåŠ¡ç®¡ç†-è·³è¿‡" class="headerlink" title="4.3,ç½‘ç»œæœåŠ¡ç®¡ç†(è·³è¿‡)"></a>4.3,ç½‘ç»œæœåŠ¡ç®¡ç†(è·³è¿‡)</h4><p><img src="/2021/07/01/uncatalog/ckv998l9b000mv0r7fcfrav6u/16.png"></p>
<h3 id="5-è½¯ä»¶åŒ…ç®¡ç†å™¨"><a href="#5-è½¯ä»¶åŒ…ç®¡ç†å™¨" class="headerlink" title="5,è½¯ä»¶åŒ…ç®¡ç†å™¨"></a>5,è½¯ä»¶åŒ…ç®¡ç†å™¨</h3><p><img src="/2021/07/01/uncatalog/ckv998l9b000mv0r7fcfrav6u/17.png">  </p>
<p><img src="/2021/07/01/uncatalog/ckv998l9b000mv0r7fcfrav6u/18.png">   </p>
<h4 id="5-1-rpmåŒ…"><a href="#5-1-rpmåŒ…" class="headerlink" title="5.1,rpmåŒ…"></a>5.1,rpmåŒ…</h4><p><img src="/2021/07/01/uncatalog/ckv998l9b000mv0r7fcfrav6u/19.png">  </p>
<p><img src="/2021/07/01/uncatalog/ckv998l9b000mv0r7fcfrav6u/20.png">   </p>
<h4 id="5-2-yumåŒ…"><a href="#5-2-yumåŒ…" class="headerlink" title="5.2,yumåŒ…"></a>5.2,yumåŒ…</h4><p><img src="/2021/07/01/uncatalog/ckv998l9b000mv0r7fcfrav6u/21.png">  </p>
<p><img src="/2021/07/01/uncatalog/ckv998l9b000mv0r7fcfrav6u/22.png">    </p>
<p><img src="/2021/07/01/uncatalog/ckv998l9b000mv0r7fcfrav6u/23.png">  </p>
<h4 id="5-2-é€šè¿‡æºä»£ç ç¼–è¯‘å®‰è£…è½¯ä»¶-è·³è¿‡"><a href="#5-2-é€šè¿‡æºä»£ç ç¼–è¯‘å®‰è£…è½¯ä»¶-è·³è¿‡" class="headerlink" title="5.2,é€šè¿‡æºä»£ç ç¼–è¯‘å®‰è£…è½¯ä»¶(è·³è¿‡)"></a>5.2,é€šè¿‡æºä»£ç ç¼–è¯‘å®‰è£…è½¯ä»¶(è·³è¿‡)</h4><h3 id="6-è¿›ç¨‹ç®¡ç†"><a href="#6-è¿›ç¨‹ç®¡ç†" class="headerlink" title="6,è¿›ç¨‹ç®¡ç†"></a>6,è¿›ç¨‹ç®¡ç†</h3><p><img src="/2021/07/01/uncatalog/ckv998l9b000mv0r7fcfrav6u/24.png">   </p>
<p><img src="/2021/07/01/uncatalog/ckv998l9b000mv0r7fcfrav6u/25.png">   </p>
<p><img src="/2021/07/01/uncatalog/ckv998l9b000mv0r7fcfrav6u/26.png">  </p>
<p><img src="/2021/07/01/uncatalog/ckv998l9b000mv0r7fcfrav6u/27.png">  </p>
]]></content>
      <tags>
        <tag>linuxå›å¿†å½•</tag>
      </tags>
  </entry>
  <entry>
    <title>node_exporteræºç é˜…è¯»</title>
    <url>/2021/10/27/uncatalog/ckv998l9f000qv0r7bn48dbig/</url>
    <content><![CDATA[<h2 id="node-exporteræºç é˜…è¯»"><a href="#node-exporteræºç é˜…è¯»" class="headerlink" title="node_exporteræºç é˜…è¯»"></a>node_exporteræºç é˜…è¯»</h2><span id="more"></span>
<p><img src="/2021/10/27/uncatalog/ckv998l9f000qv0r7bn48dbig/1.png"></p>
<p>åŸºäºprometheusçš„ç›‘æ§ç³»ç»Ÿæ­å»ºèµ·æ¥ä¹‹å,å¯¹äºå¤šæ ·åŒ–çš„ä¸šåŠ¡çº¿æ¥è¯´,<br>å®šåˆ¶åŒ–çš„é‡‡é›†ç›‘æ§æŒ‡æ ‡å¿…å°†æ˜¯ä¸šåŠ¡çº¿äº§å“ç»ç†çš„åˆä¸€ä¸ªéœ€æ±‚æ–¹å‘,æ‰€ä»¥,ä½œä¸ºå¹³å°å¼€å‘è€…æ¥è¯´,<br>é¢„åˆ¤äº§å“ç»ç†çš„é¢„åˆ¤ä¹Ÿæ˜¯ä¸€é¡¹åŸºæœ¬çš„èŒä¸šæŠ€èƒ½ğŸ¤£,å³:think deeper<br>åŸºäºæ­¤,å…ˆæŠŠnode_exporterçš„æºç ä¸€çª¥ç©¶ç«Ÿ.</p>
<blockquote>
<p>æœ¬ç¯‡æ–‡ç« ä¸»è¦æ˜¯æºç é˜…è¯»,æ¦‚å¿µå’ŒæŒ‡æ ‡ç›¸å…³çš„ä»‹ç»éœ€è¦è¯»è€…è‡ªè¡Œå»äº†è§£,ä¸è¿‡ä¸äº†è§£ä¹Ÿä¸å½±å“æœ¬ç¯‡æ–‡ç« çš„é˜…è¯»</p>
</blockquote>
<blockquote>
<p>é™„ä¸Š<a href="https://github.com/prometheus/node_exporter" title="Markdown">node_exporteræºç åœ°å€</a></p>
</blockquote>
<h1 id="1-ç›®å½•ç»“æ„"><a href="#1-ç›®å½•ç»“æ„" class="headerlink" title="1.ç›®å½•ç»“æ„"></a>1.ç›®å½•ç»“æ„</h1><p>æ€»çš„æ¥è¯´,node_exporterçš„ç›®å½•ç»“æ„è¿˜æ˜¯éå¸¸ç®€å•çš„ï¼š</p>
<ul>
<li><code>node_exporter.go</code>æ–‡ä»¶å³é¡¹ç›®çš„ä¸»å…¥å£</li>
<li><code>collector</code>æ–‡ä»¶å¤¹å³å­˜æ”¾å„ç§é‡‡é›†æŒ‡æ ‡çš„æ–‡ä»¶å¤¹<br>å…¶ä½™çš„å°±æ˜¯ä¸€äº›æ–‡æ¡£å’Œè¾…åŠ©è„šæœ¬,æºç é˜…è¯»æ—¶å¯ä»¥å¿½ç•¥;</li>
</ul>
<h1 id="2-é¡¹ç›®ä¸»å…¥å£-â€“-node-exporter-go"><a href="#2-é¡¹ç›®ä¸»å…¥å£-â€“-node-exporter-go" class="headerlink" title="2.é¡¹ç›®ä¸»å…¥å£ â€“ node_exporter.go"></a>2.é¡¹ç›®ä¸»å…¥å£ â€“ <code>node_exporter.go</code></h1><h3 id="2-1å®šä¹‰äº†ä¸€ä¸ªç»“æ„ä½“â€“handler"><a href="#2-1å®šä¹‰äº†ä¸€ä¸ªç»“æ„ä½“â€“handler" class="headerlink" title="2.1å®šä¹‰äº†ä¸€ä¸ªç»“æ„ä½“â€“handler"></a>2.1å®šä¹‰äº†ä¸€ä¸ªç»“æ„ä½“â€“<code>handler</code></h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// handlerçš„å®ä¾‹ç”±newHandleræ¥åˆ›å»º</span></span><br><span class="line"><span class="comment">// handlerå°è£…äº†ä¸€ä¸ªhttp.Handler</span></span><br><span class="line"><span class="comment">// å¯¹äºå¸¦filterså‚æ•°çš„è¯·æ±‚,ä¼šåŠ¨æ€åˆ›å»ºä¸€ä¸ªhttp.Handler</span></span><br><span class="line"><span class="comment">// filterså‚æ•°æ˜¯é’ˆå¯¹é‡‡é›†æŒ‡æ ‡çš„,å¦‚æœä¸éœ€è¦é‚£ä¹ˆå¤šé‡‡é›†æŒ‡æ ‡,å¯ä»¥é€šè¿‡filterså‚æ•°æŒ‡å®šè¿‡æ»¤æ‰,</span></span><br><span class="line"><span class="comment">// é‚£ä¹ˆåˆ›å»ºå‡ºæ¥çš„http.Handlerä¹Ÿå°±æ˜¯ä¸€ä¸ªfiltered http.Handler</span></span><br><span class="line"><span class="comment">// è¿™ä¸ªåˆ›å»ºå‡ºæ¥çš„http.Handlerä¼šèµ‹å€¼ç»™unfilteredHandler</span></span><br><span class="line"><span class="keyword">type</span> handler <span class="keyword">struct</span> &#123;</span><br><span class="line">	unfilteredHandler http.Handler</span><br><span class="line">	<span class="comment">// node_exporteræœ¬èº«çš„æŒ‡æ ‡ä¹Ÿè¦é‡‡é›†çš„è¯,å°±ä¼šç”¨åˆ°è¿™ä¸ªå•ç‹¬çš„registry</span></span><br><span class="line">	exporterMetricsRegistry *prometheus.Registry</span><br><span class="line">	<span class="comment">// æ˜¯å¦è¦é‡‡é›†node_exporteræœ¬èº«çš„æŒ‡æ ‡</span></span><br><span class="line">	includeExporterMetrics  <span class="keyword">bool</span></span><br><span class="line">	<span class="comment">// æœ€å¤§å¹¶å‘è¯·æ±‚æ•°,é»˜è®¤40,å¯é€šè¿‡å‘½ä»¤è¡Œä¼ å…¥</span></span><br><span class="line">	maxRequests             <span class="keyword">int</span></span><br><span class="line">	logger                  log.Logger</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p><code>prometheus</code>å¯¹äº<code>node_exporter</code>é‡‡é›†æ•°æ®çš„è·å–æ˜¯é€šè¿‡å‘<code>node_exporter</code>å‘é€æ‹‰å–è¯·æ±‚æ¥å®ç°çš„,<br>è€Œè¿™ä¸ªæ‹‰å–è¯·æ±‚å°±æ˜¯é€šè¿‡httpåè®®æ¥äº¤äº’çš„.æ‰€ä»¥è¿™ä¸ª<code>handler</code>å’Œæˆ‘ä»¬<code>web</code>é¡¹ç›®ä¸­çš„<code>handler</code>æ˜¯ä¸€ä¸ªæ¦‚å¿µ,<br>å³éƒ½å®ç°äº†<code>http.Handler</code>æ¥å£:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ServeHTTP implements http.Handler.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *handler)</span> <span class="title">ServeHTTP</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">	filters := r.URL.Query()[<span class="string">&quot;collect[]&quot;</span>]</span><br><span class="line">	level.Debug(h.logger).Log(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;collect query:&quot;</span>, <span class="string">&quot;filters&quot;</span>, filters)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(filters) == <span class="number">0</span> &#123;</span><br><span class="line">		<span class="comment">// No filters, use the prepared unfiltered handler.</span></span><br><span class="line">		h.unfilteredHandler.ServeHTTP(w, r)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// è¿™é‡Œä¼šè°ƒç”¨innerHandleræ¥åˆ›å»ºä¸Šé¢è®²åˆ°çš„handler</span></span><br><span class="line">	filteredHandler, err := h.innerHandler(filters...)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		level.Warn(h.logger).Log(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;Couldn&#x27;t create filtered metrics handler:&quot;</span>, <span class="string">&quot;err&quot;</span>, err)</span><br><span class="line">		w.WriteHeader(http.StatusBadRequest)</span><br><span class="line">		w.Write([]<span class="keyword">byte</span>(fmt.Sprintf(<span class="string">&quot;Couldn&#x27;t create filtered metrics handler: %s&quot;</span>, err)))</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	filteredHandler.ServeHTTP(w, r)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="2-2ä»ä¸»å…¥å£å‡½æ•°mainå¼€å§‹"><a href="#2-2ä»ä¸»å…¥å£å‡½æ•°mainå¼€å§‹" class="headerlink" title="2.2ä»ä¸»å…¥å£å‡½æ•°mainå¼€å§‹"></a>2.2ä»ä¸»å…¥å£å‡½æ•°<code>main</code>å¼€å§‹</h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// å‘½ä»¤è¡Œå‚æ•°å¤„ç†</span></span><br><span class="line">	<span class="keyword">var</span> (</span><br><span class="line">		listenAddress = kingpin.Flag(</span><br><span class="line">			<span class="string">&quot;web.listen-address&quot;</span>,</span><br><span class="line">			<span class="string">&quot;Address on which to expose metrics and web interface.&quot;</span>,</span><br><span class="line">		).Default(<span class="string">&quot;:9100&quot;</span>).String()</span><br><span class="line">		metricsPath = kingpin.Flag(</span><br><span class="line">			<span class="string">&quot;web.telemetry-path&quot;</span>,</span><br><span class="line">			<span class="string">&quot;Path under which to expose metrics.&quot;</span>,</span><br><span class="line">		).Default(<span class="string">&quot;/metrics&quot;</span>).String()</span><br><span class="line">		disableExporterMetrics = kingpin.Flag(</span><br><span class="line">			<span class="string">&quot;web.disable-exporter-metrics&quot;</span>,</span><br><span class="line">			<span class="string">&quot;Exclude metrics about the exporter itself (promhttp_*, process_*, go_*).&quot;</span>,</span><br><span class="line">		).Bool()</span><br><span class="line">		maxRequests = kingpin.Flag(</span><br><span class="line">			<span class="string">&quot;web.max-requests&quot;</span>,</span><br><span class="line">			<span class="string">&quot;Maximum number of parallel scrape requests. Use 0 to disable.&quot;</span>,</span><br><span class="line">		).Default(<span class="string">&quot;40&quot;</span>).Int()</span><br><span class="line">		disableDefaultCollectors = kingpin.Flag(</span><br><span class="line">			<span class="string">&quot;collector.disable-defaults&quot;</span>,</span><br><span class="line">			<span class="string">&quot;Set all collectors to disabled by default.&quot;</span>,</span><br><span class="line">		).Default(<span class="string">&quot;false&quot;</span>).Bool()</span><br><span class="line">		configFile = kingpin.Flag(</span><br><span class="line">			<span class="string">&quot;web.config&quot;</span>,</span><br><span class="line">			<span class="string">&quot;[EXPERIMENTAL] Path to config yaml file that can enable TLS or authentication.&quot;</span>,</span><br><span class="line">		).Default(<span class="string">&quot;&quot;</span>).String()</span><br><span class="line">	)</span><br><span class="line"></span><br><span class="line">	promlogConfig := &amp;promlog.Config&#123;&#125;</span><br><span class="line">	flag.AddFlags(kingpin.CommandLine, promlogConfig)</span><br><span class="line">	kingpin.Version(version.Print(<span class="string">&quot;node_exporter&quot;</span>))</span><br><span class="line">	kingpin.CommandLine.UsageWriter(os.Stdout)</span><br><span class="line">	kingpin.HelpFlag.Short(<span class="string">&#x27;h&#x27;</span>)</span><br><span class="line">	kingpin.Parse()</span><br><span class="line">	logger := promlog.New(promlogConfig)</span><br><span class="line">	<span class="comment">// å‘½ä»¤è¡Œå‚æ•°å¤„ç†ç»“æŸ</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment">// å¦‚æœè®¾ç½®disableDefaultCollectorsä¸ºtrue,å°†æŠŠé™¤äº†æ˜¾å¼ä»å‘½ä»¤è¡Œä¼ å…¥çš„é‡‡é›†æŒ‡æ ‡ä¹‹å¤–çš„æ‰€æœ‰æŒ‡æ ‡é‡‡é›†å™¨è®¾ç½®ä¸ºä¸é‡‡é›†</span></span><br><span class="line">	<span class="keyword">if</span> *disableDefaultCollectors &#123;</span><br><span class="line">		collector.DisableDefaultCollectors()</span><br><span class="line">	&#125;</span><br><span class="line">	level.Info(logger).Log(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;Starting node_exporter&quot;</span>, <span class="string">&quot;version&quot;</span>, version.Info())</span><br><span class="line">	level.Info(logger).Log(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;Build context&quot;</span>, <span class="string">&quot;build_context&quot;</span>, version.BuildContext())</span><br><span class="line">	<span class="comment">// ç”¨æˆ·</span></span><br><span class="line">	<span class="keyword">if</span> user, err := user.Current(); err == <span class="literal">nil</span> &amp;&amp; user.Uid == <span class="string">&quot;0&quot;</span> &#123;</span><br><span class="line">		level.Warn(logger).Log(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;Node Exporter is running as root user. This exporter is designed to run as unpriviledged user, root is not required.&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// newHandleræ˜¯é‡ç‚¹,åé¢ä¼šè®²åˆ°</span></span><br><span class="line">	http.Handle(*metricsPath, newHandler(!*disableExporterMetrics, *maxRequests, logger))</span><br><span class="line">	http.HandleFunc(<span class="string">&quot;/&quot;</span>, <span class="function"><span class="keyword">func</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">		w.Write([]<span class="keyword">byte</span>(<span class="string">`&lt;html&gt;</span></span><br><span class="line"><span class="string">			&lt;head&gt;&lt;title&gt;Node Exporter&lt;/title&gt;&lt;/head&gt;</span></span><br><span class="line"><span class="string">			&lt;body&gt;</span></span><br><span class="line"><span class="string">			&lt;h1&gt;Node Exporter&lt;/h1&gt;</span></span><br><span class="line"><span class="string">			&lt;p&gt;&lt;a href=&quot;`</span> + *metricsPath + <span class="string">`&quot;&gt;Metrics&lt;/a&gt;&lt;/p&gt;</span></span><br><span class="line"><span class="string">			&lt;/body&gt;</span></span><br><span class="line"><span class="string">			&lt;/html&gt;`</span>))</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// å¼€å¯httpæœåŠ¡,ç­‰å¾…prometheusæ¥æŠ“å–æ•°æ®</span></span><br><span class="line">	level.Info(logger).Log(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;Listening on&quot;</span>, <span class="string">&quot;address&quot;</span>, *listenAddress)</span><br><span class="line">	server := &amp;http.Server&#123;Addr: *listenAddress&#125;</span><br><span class="line">	<span class="keyword">if</span> err := web.ListenAndServe(server, *configFile, logger); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		level.Error(logger).Log(<span class="string">&quot;err&quot;</span>, err)</span><br><span class="line">		os.Exit(<span class="number">1</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<h3 id="2-3handlerçš„åˆ›å»ºè€…â€“newHandler"><a href="#2-3handlerçš„åˆ›å»ºè€…â€“newHandler" class="headerlink" title="2.3handlerçš„åˆ›å»ºè€…â€“newHandler"></a>2.3<code>handler</code>çš„åˆ›å»ºè€…â€“<code>newHandler</code></h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">newHandler</span><span class="params">(includeExporterMetrics <span class="keyword">bool</span>, maxRequests <span class="keyword">int</span>, logger log.Logger)</span> *<span class="title">handler</span></span> &#123;</span><br><span class="line">	<span class="comment">// handlerçš„ç»“æ„ä½“æˆå‘˜èµ‹å€¼</span></span><br><span class="line">	h := &amp;handler&#123;</span><br><span class="line">		exporterMetricsRegistry: prometheus.NewRegistry(),</span><br><span class="line">		includeExporterMetrics:  includeExporterMetrics,</span><br><span class="line">		maxRequests:             maxRequests,</span><br><span class="line">		logger:                  logger,</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> h.includeExporterMetrics &#123;</span><br><span class="line">		h.exporterMetricsRegistry.MustRegister(</span><br><span class="line">			promcollectors.NewProcessCollector(promcollectors.ProcessCollectorOpts&#123;&#125;),</span><br><span class="line">			promcollectors.NewGoCollector(),</span><br><span class="line">		)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// innerHandlerçœŸæ­£åˆ›å»ºhandlerçš„åœ°æ–¹</span></span><br><span class="line">	<span class="keyword">if</span> innerHandler, err := h.innerHandler(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(fmt.Sprintf(<span class="string">&quot;Couldn&#x27;t create metrics handler: %s&quot;</span>, err))</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		h.unfilteredHandler = innerHandler</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> h</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æ ¹æ®filterså…¥å‚åˆ›å»ºå¯¹åº”çš„http.Handler</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(h *handler)</span> <span class="title">innerHandler</span><span class="params">(filters ...<span class="keyword">string</span>)</span> <span class="params">(http.Handler, error)</span></span> &#123;</span><br><span class="line">	<span class="comment">// æ ¹æ®filtersæƒ…å†µåˆ›å»ºNodeCollector,åé¢ä¼šè®²è¿™ä¸ªNodeCollector</span></span><br><span class="line">	nc, err := collector.NewNodeCollector(h.logger, filters...)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, fmt.Errorf(<span class="string">&quot;couldn&#x27;t create collector: %s&quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Only log the creation of an unfiltered handler, which should happen</span></span><br><span class="line">	<span class="comment">// only once upon startup.</span></span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(filters) == <span class="number">0</span> &#123;</span><br><span class="line">		level.Info(h.logger).Log(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;Enabled collectors&quot;</span>)</span><br><span class="line">		collectors := []<span class="keyword">string</span>&#123;&#125;</span><br><span class="line">		<span class="keyword">for</span> n := <span class="keyword">range</span> nc.Collectors &#123;</span><br><span class="line">			collectors = <span class="built_in">append</span>(collectors, n)</span><br><span class="line">		&#125;</span><br><span class="line">		sort.Strings(collectors)</span><br><span class="line">		<span class="keyword">for</span> _, c := <span class="keyword">range</span> collectors &#123;</span><br><span class="line">			level.Info(h.logger).Log(<span class="string">&quot;collector&quot;</span>, c)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ä¸‹é¢å°±æ˜¯æ³¨å†Œå®ç°äº†prometheus.Collectoræ¥å£çš„node_exporter/è‡ªç ”exporterçš„é€šç”¨æµç¨‹</span></span><br><span class="line">	<span class="comment">// åœ¨node_exporterè¿™é‡Œ,ç”±NodeCollectorå®ç°prometheus.Collectoræ¥å£</span></span><br><span class="line">	r := prometheus.NewRegistry()</span><br><span class="line">	r.MustRegister(version.NewCollector(<span class="string">&quot;node_exporter&quot;</span>))</span><br><span class="line">	<span class="keyword">if</span> err := r.Register(nc); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, fmt.Errorf(<span class="string">&quot;couldn&#x27;t register node collector: %s&quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">	handler := promhttp.HandlerFor(</span><br><span class="line">		prometheus.Gatherers&#123;h.exporterMetricsRegistry, r&#125;,</span><br><span class="line">		promhttp.HandlerOpts&#123;</span><br><span class="line">			ErrorLog:            stdlog.New(log.NewStdlibAdapter(level.Error(h.logger)), <span class="string">&quot;&quot;</span>, <span class="number">0</span>),</span><br><span class="line">			ErrorHandling:       promhttp.ContinueOnError,</span><br><span class="line">			MaxRequestsInFlight: h.maxRequests,</span><br><span class="line">			Registry:            h.exporterMetricsRegistry,</span><br><span class="line">		&#125;,</span><br><span class="line">	)</span><br><span class="line">	<span class="keyword">if</span> h.includeExporterMetrics &#123;</span><br><span class="line">		<span class="comment">// Note that we have to use h.exporterMetricsRegistry here to</span></span><br><span class="line">		<span class="comment">// use the same promhttp metrics for all expositions.</span></span><br><span class="line">		handler = promhttp.InstrumentMetricHandler(</span><br><span class="line">			h.exporterMetricsRegistry, handler,</span><br><span class="line">		)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> handler, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<h1 id="3-node-exporter-è‡ªç ”exporterå¿…é¡»è¦å®ç°çš„ä¸€ä¸ªæ¥å£â€“prometheus-Collector"><a href="#3-node-exporter-è‡ªç ”exporterå¿…é¡»è¦å®ç°çš„ä¸€ä¸ªæ¥å£â€“prometheus-Collector" class="headerlink" title="3.node_exporter/è‡ªç ”exporterå¿…é¡»è¦å®ç°çš„ä¸€ä¸ªæ¥å£â€“prometheus.Collector"></a>3.<code>node_exporter</code>/è‡ªç ”<code>exporter</code>å¿…é¡»è¦å®ç°çš„ä¸€ä¸ªæ¥å£â€“<code>prometheus.Collector</code></h1><p>è¿™é‡Œæ¶‰åŠåˆ°<code>github.com/prometheus/client_golang/prometheus</code>çš„æºç ,ç•™åˆ°è®²è‡ªç ”exporterçš„æ—¶å€™ä¼šå‰–æ,<br>client_golangæ˜¯prometheusçš„å®˜æ–¹goåº“,æ—¢å¯ä»¥ç”¨äºé›†æˆç°æœ‰åº”ç”¨,ä¹Ÿå¯ä»¥ä½œä¸ºè¿æ¥Prometheus HTTP APIçš„åŸºç¡€åº“</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Collector is the interface implemented by anything that can be used by</span></span><br><span class="line"><span class="comment">// Prometheus to collect metrics. A Collector has to be registered for</span></span><br><span class="line"><span class="comment">// collection. See Registerer.Register.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// The stock metrics provided by this package (Gauge, Counter, Summary,</span></span><br><span class="line"><span class="comment">// Histogram, Untyped) are also Collectors (which only ever collect one metric,</span></span><br><span class="line"><span class="comment">// namely itself). An implementer of Collector may, however, collect multiple</span></span><br><span class="line"><span class="comment">// metrics in a coordinated fashion and/or create metrics on the fly. Examples</span></span><br><span class="line"><span class="comment">// for collectors already implemented in this library are the metric vectors</span></span><br><span class="line"><span class="comment">// (i.e. collection of multiple instances of the same Metric but with different</span></span><br><span class="line"><span class="comment">// label values) like GaugeVec or SummaryVec, and the ExpvarCollector.</span></span><br><span class="line"><span class="keyword">type</span> Collector <span class="keyword">interface</span> &#123;</span><br><span class="line">	<span class="comment">// Describe sends the super-set of all possible descriptors of metrics</span></span><br><span class="line">	<span class="comment">// collected by this Collector to the provided channel and returns once</span></span><br><span class="line">	<span class="comment">// the last descriptor has been sent. The sent descriptors fulfill the</span></span><br><span class="line">	<span class="comment">// consistency and uniqueness requirements described in the Desc</span></span><br><span class="line">	<span class="comment">// documentation.</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">// It is valid if one and the same Collector sends duplicate</span></span><br><span class="line">	<span class="comment">// descriptors. Those duplicates are simply ignored. However, two</span></span><br><span class="line">	<span class="comment">// different Collectors must not send duplicate descriptors.</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">// Sending no descriptor at all marks the Collector as â€œuncheckedâ€,</span></span><br><span class="line">	<span class="comment">// i.e. no checks will be performed at registration time, and the</span></span><br><span class="line">	<span class="comment">// Collector may yield any Metric it sees fit in its Collect method.</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">// This method idempotently sends the same descriptors throughout the</span></span><br><span class="line">	<span class="comment">// lifetime of the Collector. It may be called concurrently and</span></span><br><span class="line">	<span class="comment">// therefore must be implemented in a concurrency safe way.</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">// If a Collector encounters an error while executing this method, it</span></span><br><span class="line">	<span class="comment">// must send an invalid descriptor (created with NewInvalidDesc) to</span></span><br><span class="line">	<span class="comment">// signal the error to the registry.</span></span><br><span class="line">	Describe(<span class="keyword">chan</span>&lt;- *Desc)</span><br><span class="line">	<span class="comment">// Collect is called by the Prometheus registry when collecting</span></span><br><span class="line">	<span class="comment">// metrics. The implementation sends each collected metric via the</span></span><br><span class="line">	<span class="comment">// provided channel and returns once the last metric has been sent. The</span></span><br><span class="line">	<span class="comment">// descriptor of each sent metric is one of those returned by Describe</span></span><br><span class="line">	<span class="comment">// (unless the Collector is unchecked, see above). Returned metrics that</span></span><br><span class="line">	<span class="comment">// share the same descriptor must differ in their variable label</span></span><br><span class="line">	<span class="comment">// values.</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">// This method may be called concurrently and must therefore be</span></span><br><span class="line">	<span class="comment">// implemented in a concurrency safe way. Blocking occurs at the expense</span></span><br><span class="line">	<span class="comment">// of total performance of rendering all registered metrics. Ideally,</span></span><br><span class="line">	<span class="comment">// Collector implementations support concurrent readers.</span></span><br><span class="line">	Collect(<span class="keyword">chan</span>&lt;- Metric)</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<h3 id="3-1node-exporterä¸­prometheus-Collectoræ¥å£çš„å®ç°è€…â€“NodeCollector"><a href="#3-1node-exporterä¸­prometheus-Collectoræ¥å£çš„å®ç°è€…â€“NodeCollector" class="headerlink" title="3.1node_exporterä¸­prometheus.Collectoræ¥å£çš„å®ç°è€…â€“NodeCollector"></a>3.1<code>node_exporter</code>ä¸­<code>prometheus.Collector</code>æ¥å£çš„å®ç°è€…â€“<code>NodeCollector</code></h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// NodeCollector implements the prometheus.Collector interface.</span></span><br><span class="line"><span class="keyword">type</span> NodeCollector <span class="keyword">struct</span> &#123;</span><br><span class="line">	Collectors <span class="keyword">map</span>[<span class="keyword">string</span>]Collector</span><br><span class="line">	logger     log.Logger</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Describe implements the prometheus.Collector interface.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(n NodeCollector)</span> <span class="title">Describe</span><span class="params">(ch <span class="keyword">chan</span>&lt;- *prometheus.Desc)</span></span> &#123;</span><br><span class="line">    ch &lt;- scrapeDurationDesc</span><br><span class="line">    ch &lt;- scrapeSuccessDesc</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Collect implements the prometheus.Collector interface.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(n NodeCollector)</span> <span class="title">Collect</span><span class="params">(ch <span class="keyword">chan</span>&lt;- prometheus.Metric)</span></span> &#123;</span><br><span class="line">    wg := sync.WaitGroup&#123;&#125;</span><br><span class="line">    wg.Add(<span class="built_in">len</span>(n.Collectors))</span><br><span class="line">    <span class="keyword">for</span> name, c := <span class="keyword">range</span> n.Collectors &#123;</span><br><span class="line">        <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(name <span class="keyword">string</span>, c Collector)</span></span> &#123;</span><br><span class="line">        	<span class="comment">// æ‰§è¡Œå„ä¸ªé‡‡é›†æŒ‡æ ‡çš„é‡‡é›†æ–¹æ³•</span></span><br><span class="line">            execute(name, c, ch, n.logger)</span><br><span class="line">            wg.Done()</span><br><span class="line">        &#125;(name, c)</span><br><span class="line">    &#125;</span><br><span class="line">    wg.Wait()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<h1 id="4-ç»“æŸè¯­"><a href="#4-ç»“æŸè¯­" class="headerlink" title="4.ç»“æŸè¯­"></a>4.ç»“æŸè¯­</h1><p>æ•´ä½“æ¥çœ‹<code>node_exporter</code>çš„æºç å¯é˜…è¯»æ€§è¿˜æ˜¯éå¸¸é«˜çš„.æ¥ä¸‹æ¥å°†ä¼šå†™ä¸€ç¯‡è‡ªç ”<code>exporter</code>çš„å®è·µï¼›</p>
]]></content>
      <tags>
        <tag>prometheus</tag>
        <tag>æºç é˜…è¯»</tag>
        <tag>node_exporter</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸€æ¬¡slice bug</title>
    <url>/2021/03/22/uncatalog/slice_practice01/</url>
    <content><![CDATA[<hr>
<span id="more"></span>



<hr>
<p><img src="/2021/03/22/uncatalog/slice_practice01/1.png"></p>
<h5 id="ä¸€æ¬¡slice-bug"><a href="#ä¸€æ¬¡slice-bug" class="headerlink" title="ä¸€æ¬¡slice bug"></a>ä¸€æ¬¡slice bug</h5><blockquote>
<p>bugæºï¼šä»Šå¤©é‡æ„å‰åŒäº‹çš„é—ç•™ä»£ç ,åœ¨reviewè¿‡ç¨‹ä¸­,æœ‰æ®µä»£ç çœ‹èµ·æ¥æœ‰äº›åˆ«æ‰­,æœ‰å‡ åˆ†çº¿ç¨‹ä¸å®‰å…¨çš„å‘³é“<br>bugæè¿°ï¼šå¤šä¸ªåç¨‹å¾€åŒä¸€ä¸ªsliceé‡Œè¿½åŠ æ“ä½œéœ€è¦å¼€å‘è€…ä¿è¯çº¿ç¨‹å®‰å…¨<br>bugä¿®å¤ï¼š è¯¦è§ä»£ç   </p>
</blockquote>
<hr>
<h6 id="bugæº"><a href="#bugæº" class="headerlink" title="bugæº"></a>bugæº</h6><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ç®€åŒ–ç‰ˆbugå¤ç°</span></span><br><span class="line">    <span class="keyword">var</span> arr []<span class="keyword">string</span></span><br><span class="line">	<span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line">	wg.Add(<span class="number">10</span>)</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">		<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">			<span class="keyword">defer</span> wg.Done()</span><br><span class="line">			str := getStr()</span><br><span class="line">			arr = <span class="built_in">append</span>(arr, str)</span><br><span class="line">		&#125;()</span><br><span class="line">	&#125;</span><br><span class="line">	wg.Wait()</span><br><span class="line">	calculate(arr)</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
<hr>
<h6 id="ç–‘é—®ï¼šsliceçš„appendæ“ä½œæ˜¯å¦æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Ÿ"><a href="#ç–‘é—®ï¼šsliceçš„appendæ“ä½œæ˜¯å¦æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Ÿ" class="headerlink" title="ç–‘é—®ï¼šsliceçš„appendæ“ä½œæ˜¯å¦æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Ÿ"></a>ç–‘é—®ï¼šsliceçš„appendæ“ä½œæ˜¯å¦æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Ÿ</h6><blockquote>
<p>ç»“è®ºï¼šappendæ“ä½œå¹¶ä¸èƒ½ä¿è¯çº¿ç¨‹å®‰å…¨</p>
</blockquote>
<p>æˆ‘ä»¬çœ‹ä¸€çœ‹ä¸‹é¢çš„ä¸¤ä¸ªä¾‹å­(ä¾‹å­è½¬è‡ª<a href="https://studygolang.com/articles/13662" title="Markdown">studygolang</a> ä»…ä¸ºäº†è¯æ˜ç»“è®º)ï¼š  </p>
<ul>
<li>ä¾‹1:<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;sync&quot;</span></span><br><span class="line">    <span class="string">&quot;testing&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestAppend</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">    x := []<span class="keyword">string</span>&#123;<span class="string">&quot;start&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line">    wg := sync.WaitGroup&#123;&#125;</span><br><span class="line">    wg.Add(<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">defer</span> wg.Done()</span><br><span class="line">        y := <span class="built_in">append</span>(x, <span class="string">&quot;hello&quot;</span>, <span class="string">&quot;world&quot;</span>)</span><br><span class="line">        t.Log(<span class="built_in">cap</span>(y), <span class="built_in">len</span>(y))</span><br><span class="line">    &#125;()</span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">defer</span> wg.Done()</span><br><span class="line">        z := <span class="built_in">append</span>(x, <span class="string">&quot;goodbye&quot;</span>, <span class="string">&quot;bob&quot;</span>)</span><br><span class="line">        t.Log(<span class="built_in">cap</span>(z), <span class="built_in">len</span>(z))</span><br><span class="line">    &#125;()</span><br><span class="line">    wg.Wait()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></li>
<li>ä¾‹2:<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;testing&quot;</span></span><br><span class="line">    <span class="string">&quot;sync&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestAppend</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">	<span class="comment">//ä»¥ç»™è¿™ä¸ªåä¸º x çš„ slice åœ¨åˆ›å»ºæ˜¯é¢„ç•™ä¸€äº›å®¹é‡.è¿™æ˜¯è¾ƒä¾‹1å”¯ä¸€æ”¹åŠ¨çš„åœ°æ–¹</span></span><br><span class="line">    x := <span class="built_in">make</span>([]<span class="keyword">string</span>, <span class="number">0</span>, <span class="number">6</span>)</span><br><span class="line"></span><br><span class="line">    wg := sync.WaitGroup&#123;&#125;</span><br><span class="line">    wg.Add(<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">defer</span> wg.Done()</span><br><span class="line">        y := <span class="built_in">append</span>(x, <span class="string">&quot;hello&quot;</span>, <span class="string">&quot;world&quot;</span>)</span><br><span class="line">        t.Log(<span class="built_in">len</span>(y))</span><br><span class="line">    &#125;()</span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">defer</span> wg.Done()</span><br><span class="line">        z := <span class="built_in">append</span>(x, <span class="string">&quot;goodbye&quot;</span>, <span class="string">&quot;bob&quot;</span>)</span><br><span class="line">        t.Log(<span class="built_in">len</span>(z))</span><br><span class="line">    &#125;()</span><br><span class="line">    wg.Wait()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
å¦‚æœæˆ‘ä»¬æ‰§è¡Œè¿™ä¸ªæµ‹è¯•æ—¶å¸¦ä¸Š <code>-race</code>,å‘ç°å‡ºç°äº†<code>DATA RACE</code><blockquote>
<p>è§£é‡Šä¸ºä»€ä¹ˆæµ‹è¯•å¤±è´¥  </p>
</blockquote>
</li>
</ul>
<p>ç†è§£ä¸ºä»€ä¹ˆè¿™ä¸ªå¤±è´¥ä¼šå‘ç”Ÿï¼Œè¯·çœ‹çœ‹è¿™ä¸ªæ—§ä¾‹å­çš„ x çš„å†…å­˜å¸ƒå±€<br><img src="/2021/03/22/uncatalog/slice_practice01/5.png">  </p>
<p>x æ²¡æœ‰è¶³å¤Ÿçš„å®¹é‡è¿›è¡Œä¿®æ”¹</p>
<p>Go è¯­è¨€å‘ç°æ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜ç©ºé—´æ¥å­˜å‚¨ <em>hello</em>,<em>world</em> å’Œã€€<em>goodbye</em>, <em>bob</em>,  </p>
<p>äºæ˜¯åˆ†é…çš„æ–°çš„å†…å­˜ç»™ <em>y</em> ä¸ <em>z</em>ã€‚   </p>
<p>æ•°æ®ç«äº‰ä¸ä¼šåœ¨å¤šè¿›ç¨‹è¯»å–å†…å­˜æ—¶å‘ç”Ÿï¼Œ<em>x</em> æ²¡æœ‰è¢«ä¿®æ”¹ã€‚  </p>
<p>è¿™é‡Œæ²¡æœ‰å†²çªï¼Œä¹Ÿå°±æ²¡æœ‰ç«äº‰ã€‚  </p>
<p><img src="/2021/03/22/uncatalog/slice_practice01/2.png">  </p>
<p> <em>z</em> ä¸ <em>y</em> è·å–æ–°çš„å†…å­˜ç©ºé—´  </p>
<p>åœ¨æ–°çš„ä»£ç é‡Œï¼Œäº‹æƒ…ä¸ä¸€æ ·äº†<br><img src="/2021/03/22/uncatalog/slice_practice01/3.png"><br><em>x</em> æœ‰æ›´å¤šçš„å®¹é‡</p>
<p>åœ¨è¿™é‡Œï¼Œgo æ³¨æ„åˆ°æœ‰è¶³å¤Ÿçš„å†…å­˜å­˜æ”¾ <em>hello</em>, <em>world</em>ï¼Œ<br>å¦ä¸€ä¸ªåç¨‹ä¹Ÿå‘ç°æœ‰è¶³å¤Ÿçš„ç©ºé—´å­˜æ”¾ <em>goodbye</em>, <em>bob</em>ï¼Œ<br>è¿™ä¸ªç«äº‰çš„å‘ç”Ÿæ˜¯å› ä¸ºè¿™ä¸¤ä¸ªåç¨‹éƒ½å°è¯•å¾€åŒä¸€ä¸ªå†…å­˜ç©ºé—´å†™å…¥ï¼Œ<br>è°ä¹Ÿä¸çŸ¥é“è°æ˜¯èµ¢å®¶ã€‚<br><img src="/2021/03/22/uncatalog/slice_practice01/4.png"><br>è¿™æ˜¯ Go è¯­è¨€çš„ä¸€ä¸ªç‰¹æ€§è€Œé bug ï¼Œappend ä¸ä¼šå¼ºåˆ¶æ¯ä¸€æ¬¡è°ƒç”¨å®ƒéƒ½ç”³è¯·æ–°çš„å†…å­˜ã€‚<br>å®ƒå…è®¸ç”¨æˆ·åœ¨å¾ªç¯å†…è¿›è¡Œ append æ“ä½œæ—¶ä¸ä¼šç ´ååƒåœ¾å›æ”¶æœºåˆ¶ã€‚<br>ç¼ºç‚¹æ˜¯ä½ å¿…é¡»æ¸…æ¥šçŸ¥é“åœ¨å¤šä¸ªåç¨‹å¯¹ slice çš„æ“ä½œã€‚</p>
<h6 id="ç–‘é—®ï¼šsliceçš„appendæ“ä½œå¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Ÿ"><a href="#ç–‘é—®ï¼šsliceçš„appendæ“ä½œå¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Ÿ" class="headerlink" title="ç–‘é—®ï¼šsliceçš„appendæ“ä½œå¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Ÿ"></a>ç–‘é—®ï¼šsliceçš„appendæ“ä½œå¦‚ä½•ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Ÿ</h6><blockquote>
<p>æœ€ç®€å•çš„è§£å†³æ–¹æ³•æ˜¯ä¸ä½¿ç”¨å…±äº«çŠ¶æ€çš„ç¬¬ä¸€ä¸ªå˜é‡æ¥è¿›è¡Œ append ã€‚<br>   ç›¸åï¼Œæ ¹æ®ä½ çš„éœ€è¦æ¥ make ä¸€ä¸ªæ–°çš„ slice ï¼Œ<br>   ä½¿ç”¨è¿™ä¸ªæ–°çš„ slice ä½œä¸º append çš„ç¬¬ä¸€ä¸ªå˜é‡ã€‚<br>   ä¸‹é¢æ˜¯å¤±è´¥çš„æµ‹è¯•ç¤ºä¾‹çš„ä¿®æ­£ç‰ˆï¼Œè¿™é‡Œçš„æ›¿ä»£æ–¹æ³•æ˜¯ä½¿ç”¨ copy </p>
</blockquote>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;sync&quot;</span></span><br><span class="line">    <span class="string">&quot;testing&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TestAppend</span><span class="params">(t *testing.T)</span></span> &#123;</span><br><span class="line">    x := <span class="built_in">make</span>([]<span class="keyword">string</span>, <span class="number">0</span>, <span class="number">6</span>)</span><br><span class="line">    x = <span class="built_in">append</span>(x, <span class="string">&quot;start&quot;</span>)</span><br><span class="line"></span><br><span class="line">    wg := sync.WaitGroup&#123;&#125;</span><br><span class="line">    wg.Add(<span class="number">2</span>)</span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">defer</span> wg.Done()</span><br><span class="line">        y := <span class="built_in">make</span>([]<span class="keyword">string</span>, <span class="number">0</span>, <span class="built_in">len</span>(x)+<span class="number">2</span>)</span><br><span class="line">        y = <span class="built_in">append</span>(y, x...)</span><br><span class="line">        y = <span class="built_in">append</span>(y, <span class="string">&quot;hello&quot;</span>, <span class="string">&quot;world&quot;</span>)</span><br><span class="line">        t.Log(<span class="built_in">cap</span>(y), <span class="built_in">len</span>(y), y[<span class="number">0</span>])</span><br><span class="line">    &#125;()</span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">        <span class="keyword">defer</span> wg.Done()</span><br><span class="line">        z := <span class="built_in">make</span>([]<span class="keyword">string</span>, <span class="number">0</span>, <span class="built_in">len</span>(x)+<span class="number">2</span>)</span><br><span class="line">        z = <span class="built_in">append</span>(z, x...)</span><br><span class="line">        z = <span class="built_in">append</span>(z, <span class="string">&quot;goodbye&quot;</span>, <span class="string">&quot;bob&quot;</span>)</span><br><span class="line">        t.Log(<span class="built_in">cap</span>(z), <span class="built_in">len</span>(z), z[<span class="number">0</span>])</span><br><span class="line">    &#125;()</span><br><span class="line">    wg.Wait()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<hr>
<h6 id="ç–‘é—®ï¼šæ–‡ç« å¼€å¤´çš„é—®é¢˜è¯¥å¦‚ä½•è§£å†³å‘¢ï¼Ÿ"><a href="#ç–‘é—®ï¼šæ–‡ç« å¼€å¤´çš„é—®é¢˜è¯¥å¦‚ä½•è§£å†³å‘¢ï¼Ÿ" class="headerlink" title="ç–‘é—®ï¼šæ–‡ç« å¼€å¤´çš„é—®é¢˜è¯¥å¦‚ä½•è§£å†³å‘¢ï¼Ÿ"></a>ç–‘é—®ï¼šæ–‡ç« å¼€å¤´çš„é—®é¢˜è¯¥å¦‚ä½•è§£å†³å‘¢ï¼Ÿ</h6><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ç®€åŒ–ç‰ˆbugå¤ç°</span></span><br><span class="line">    <span class="keyword">var</span> arr []<span class="keyword">string</span></span><br><span class="line">	<span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line">	wg.Add(<span class="number">10</span>)</span><br><span class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">		<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">			<span class="keyword">defer</span> wg.Done()</span><br><span class="line">			str := getStr()</span><br><span class="line">			arr = <span class="built_in">append</span>(arr, str)</span><br><span class="line">		&#125;()</span><br><span class="line">	&#125;</span><br><span class="line">	wg.Wait()</span><br><span class="line">	calculate(arr)</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
<blockquote>
<p>è§£å†³æ–¹æ¡ˆï¼šå¼•å…¥<strong>channel</strong>æœºåˆ¶ï¼Œå°†<strong>æ¶ˆè´¹è€…</strong>å’Œ<strong>ç”Ÿäº§è€…</strong>è§£è€¦</p>
</blockquote>
<ul>
<li><p>è§£å†³æ–¹æ¡ˆ1ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line">   ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">string</span>, n)</span><br><span class="line">   <span class="keyword">var</span> arr []<span class="keyword">string</span></span><br><span class="line">   <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">for</span> i := <span class="keyword">range</span> ch &#123;</span><br><span class="line">		arr = <span class="built_in">append</span>(arr, i)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;()</span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line">wg.Add(<span class="number">10</span>)</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		<span class="keyword">defer</span> wg.Done()</span><br><span class="line">		str := getStr()</span><br><span class="line">		ch &lt;- str</span><br><span class="line">	&#125;()</span><br><span class="line">&#125;</span><br><span class="line">wg.Wait()</span><br><span class="line">   <span class="built_in">close</span>(ch)</span><br><span class="line">calculate(arr)</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
<p>é—®é¢˜è§£å†³äº†å—ï¼Ÿ<br>sliceçš„appendæ“ä½œçš„çº¿ç¨‹å®‰å…¨æœ‰ä¿éšœäº†,ä½†æ˜¯åˆå¼•å…¥äº†æ–°é—®é¢˜ï¼š </p>
<blockquote>
<p>å¦‚ä½•ä¿è¯ä¼ é€’ç»™<code>calculate()</code>çš„<code>arr</code>å–å°½äº†<code>ch</code>å‘¢ï¼Ÿ  </p>
</blockquote>
</li>
<li><p>ç»ˆææ–¹æ¡ˆ</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line">   ch := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">string</span>, n)</span><br><span class="line">   <span class="keyword">var</span> arr []<span class="keyword">string</span></span><br><span class="line">   <span class="keyword">var</span> wg0 sync.WaitGroup</span><br><span class="line">   <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">       wg0.Add(<span class="number">1</span>)</span><br><span class="line">	<span class="keyword">for</span> i := <span class="keyword">range</span> ch &#123;</span><br><span class="line">		arr = <span class="built_in">append</span>(arr, i)</span><br><span class="line">	&#125;</span><br><span class="line">       wg0.Done()</span><br><span class="line">&#125;()</span><br><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line">wg.Add(<span class="number">10</span>)</span><br><span class="line"><span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		<span class="keyword">defer</span> wg.Done()</span><br><span class="line">		str := getStr()</span><br><span class="line">		ch &lt;- str</span><br><span class="line">	&#125;()</span><br><span class="line">&#125;</span><br><span class="line">wg.Wait()</span><br><span class="line">   <span class="built_in">close</span>(ch)</span><br><span class="line">   wg0.Wait()</span><br><span class="line">calculate(arr)</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
<p><code>wg</code>ä¿è¯<code>str</code>éƒ½å‘é€åˆ°äº†<code>ch</code><br><code>wg0</code>ä¿è¯<code>ch</code>éƒ½è¢«å–å‡ºæ”¾åˆ°äº†<code>arr</code> </p>
</li>
</ul>
]]></content>
      <tags>
        <tag>golang</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸€ä¸ªå®¹æ˜“è¢«å¿½ç•¥çš„æ•°æ®åº“Bug</title>
    <url>/2021/05/10/go-practice/mysql_bug_practice01/</url>
    <content><![CDATA[<p>ä»Šå¤©reviewå°ç»„å†…å…¶ä»–å‡ ä¸ªæˆå‘˜çš„ä»£ç ï¼Œå‘ç°äº†ä¸€ä¸ªå¤§å®¶éƒ½åœ¨å†™çš„bugï¼Œå‘å„ä½åˆ†äº«ä¸€ä¸‹ï¼›</p>
<span id="more"></span>

<p><img src="/2021/05/10/go-practice/mysql_bug_practice01/1.png"></p>
<h5 id="ç›´æ¥ä¸Šä»£ç ï¼š"><a href="#ç›´æ¥ä¸Šä»£ç ï¼š" class="headerlink" title="ç›´æ¥ä¸Šä»£ç ï¼š"></a>ç›´æ¥ä¸Šä»£ç ï¼š</h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> sql_demo</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;database/sql&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">sql_demo</span><span class="params">()</span> <span class="title">error</span></span> &#123;</span><br><span class="line">	db, err := sql.Open(<span class="string">&quot;mysql&quot;</span>, <span class="string">&quot;xxxx:xxxx@tcp(localhost:3306)/xxxx?charset=utf8&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(err)</span><br><span class="line">		<span class="keyword">return</span> err</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> db.Close()</span><br><span class="line">	rows, err := db.Query(<span class="string">&quot;select id,name from sql_demo&quot;</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Println(err)</span><br><span class="line">		<span class="keyword">return</span> err</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> rows.Close()</span><br><span class="line">	<span class="keyword">var</span> id <span class="keyword">int</span></span><br><span class="line">	<span class="keyword">var</span> name <span class="keyword">string</span></span><br><span class="line">	<span class="keyword">for</span> rows.Next() &#123;</span><br><span class="line">		rerr := rows.Scan(&amp;id, &amp;name)</span><br><span class="line">		<span class="keyword">if</span> rerr == <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> rerr</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<h5 id="æ‰¾bugï¼š"><a href="#æ‰¾bugï¼š" class="headerlink" title="æ‰¾bugï¼š"></a>æ‰¾bugï¼š</h5><p>æ˜¯ä¸æ˜¯æ²¡æ‰¾åˆ°ï¼Ÿæ²¡å…³ç³»ï¼Œæˆ‘ä»¬çœ‹ä¸‹æºç :</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> sql_demo</span><br><span class="line"></span><br><span class="line"><span class="comment">// Next prepares the next result row for reading with the Scan method. It</span></span><br><span class="line"><span class="comment">// returns true on success, or false if there is no next result row or an error</span></span><br><span class="line"><span class="comment">// happened while preparing it. Err should be consulted to distinguish between</span></span><br><span class="line"><span class="comment">// the two cases.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Every call to Scan, even the first one, must be preceded by a call to Next.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(rs *Rows)</span> <span class="title">Next</span><span class="params">()</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> doClose, ok <span class="keyword">bool</span></span><br><span class="line">	withLock(rs.closemu.RLocker(), <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		doClose, ok = rs.nextLocked()</span><br><span class="line">	&#125;)</span><br><span class="line">	<span class="keyword">if</span> doClose &#123;</span><br><span class="line">		rs.Close()</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> ok</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>ç®€å•ç¿»è¯‘ä¸€ä¸‹ï¼šå½“ <code>no next result row</code>æˆ–è€…é‡åˆ° <code>error</code>çš„æ—¶å€™,<code>Next()</code>éƒ½ä¼šè¿”å›<code>false</code>,<br>æˆ‘ä»¬éœ€è¦è°ƒç”¨<code>Err</code>æ¥åŒºåˆ†è¿™ä¸¤ç§æƒ…å†µ;<br>æ‰€ä»¥bugæ‰¾åˆ°äº†ï¼Œè¿­ä»£è¿‡ç¨‹ä¸­ï¼Œå½“é‡åˆ°<code>error</code>æ—¶,æ¯”å¦‚ç½‘ç»œå¼‚å¸¸ç­‰ç­‰ï¼Œæ­¤æ—¶æ•°æ®å¯èƒ½åªè¯»åˆ°äº†ä¸€éƒ¨åˆ†ï¼Œ<code>rows.Next()</code>ä¼šè¿”å›<code>false</code>,<br>ç›´æ¥<code>return nil</code>,ä¼šæŠŠå¼‚å¸¸é—æ¼æ‰,é€ æˆä¸€ä¸ªéšå½¢<code>bug</code>;<br>æ­£ç¡®åšæ³•ï¼š<br>æŠŠ<code>return nil</code>æ”¹ä¸º<code>rows.Err()</code>å³å¯;</p>
]]></content>
      <categories>
        <category>GOå®è·µ</category>
      </categories>
      <tags>
        <tag>golang</tag>
      </tags>
  </entry>
  <entry>
    <title>å•ä¾‹æ¨¡å¼.md</title>
    <url>/2021/03/22/design/single01/</url>
    <content><![CDATA[<h4 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h4><blockquote>
<p>å•ä¾‹æ¨¡å¼(<strong>Singleton Design Pattern</strong>):ä¸€ä¸ªç±»åªå…è®¸åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼ˆæˆ–è€…å®ä¾‹ï¼‰  </p>
</blockquote>
<hr>
<h4 id="è¦è§£å†³çš„é—®é¢˜-ç”¨é€”"><a href="#è¦è§£å†³çš„é—®é¢˜-ç”¨é€”" class="headerlink" title="è¦è§£å†³çš„é—®é¢˜/ç”¨é€”"></a>è¦è§£å†³çš„é—®é¢˜/ç”¨é€”</h4><ul>
<li>èµ„æºè®¿é—®å†²çª</li>
<li>è¡¨ç¤ºå…¨å±€å”¯ä¸€ç±»,å¦‚<em>é…ç½®ä¿¡æ¯ç±»</em>ã€<em>è¿æ¥æ± ç±»</em>ã€<em>IDç”Ÿæˆå™¨ç±»</em>ç­‰</li>
</ul>
<hr>
<span id="more"></span>

<p><img src="/2021/03/22/design/single01/1.png"></p>
<h4 id="å¦‚ä½•å®ç°"><a href="#å¦‚ä½•å®ç°" class="headerlink" title="å¦‚ä½•å®ç°"></a>å¦‚ä½•å®ç°</h4><table>
<thead>
<tr>
<th>å®ç°æ–¹å¼</th>
<th>æ¦‚å¿µ</th>
<th>æ˜¯å¦çº¿ç¨‹å®‰å…¨</th>
<th>æ˜¯å¦æ”¯æŒå»¶è¿ŸåŠ è½½</th>
<th>é€‚ç”¨åœºæ™¯</th>
</tr>
</thead>
<tbody><tr>
<td>é¥¿æ±‰å¼</td>
<td>å•ä¾‹å®ä¾‹åœ¨ç±»åŠ è½½çš„æ—¶å€™<br>instanceé™æ€å®ä¾‹å°±å·²ç»åˆ›å»ºå¹¶åˆå§‹åŒ–å¥½äº†</td>
<td>æ˜¯</td>
<td>å¦</td>
<td>è¯¦è§ä»£ç </td>
</tr>
<tr>
<td>æ‡’æ±‰å¼</td>
<td>å•ä¾‹å®ä¾‹åœ¨ç¬¬ä¸€æ¬¡è¢«ä½¿ç”¨æ—¶æ„å»º</td>
<td>å¯ä»¥åŠ é”å®ç°çº¿ç¨‹å®‰å…¨</td>
<td>æ˜¯</td>
<td>è¯¦è§ä»£ç </td>
</tr>
<tr>
<td>åŒé‡æ£€æµ‹</td>
<td>åªè¦instanceè¢«åˆ›å»ºä¹‹åï¼Œå³ä¾¿å†è°ƒç”¨getInstance()å‡½æ•°ä¹Ÿä¸ä¼šå†è¿›å…¥åˆ°åŠ é”é€»è¾‘ä¸­äº†ã€‚<br>æ‰€ä»¥ï¼Œè¿™ç§å®ç°æ–¹å¼è§£å†³äº†æ‡’æ±‰å¼å¹¶å‘åº¦ä½çš„é—®é¢˜</td>
<td>æ˜¯</td>
<td>æ˜¯</td>
<td>è¯¦è§ä»£ç </td>
</tr>
<tr>
<td>é™æ€å†…éƒ¨ç±»</td>
<td>javaç‰¹æœ‰,åœ¨æ­¤ä¸åšè®²è§£</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>æšä¸¾</td>
<td>javaç‰¹æœ‰,åœ¨æ­¤ä¸åšè®²è§£</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>
</tbody></table>
<hr>
<h5 id="1-é¥¿æ±‰å¼"><a href="#1-é¥¿æ±‰å¼" class="headerlink" title="1.é¥¿æ±‰å¼"></a>1.é¥¿æ±‰å¼</h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">é¥¿æ±‰æ¨¡å¼é€‚ç”¨åœºæ™¯ï¼š</span></span><br><span class="line"><span class="comment">å¦‚æœåˆå§‹åŒ–è€—æ—¶é•¿ï¼Œé‚£æˆ‘ä»¬æœ€å¥½ä¸è¦ç­‰åˆ°çœŸæ­£è¦ç”¨å®ƒçš„æ—¶å€™ï¼Œ</span></span><br><span class="line"><span class="comment">æ‰å»æ‰§è¡Œè¿™ä¸ªè€—æ—¶é•¿çš„åˆå§‹åŒ–è¿‡ç¨‹ï¼Œè¿™ä¼šå½±å“åˆ°ç³»ç»Ÿçš„æ€§èƒ½</span></span><br><span class="line"><span class="comment">ï¼ˆæ¯”å¦‚ï¼Œåœ¨å“åº”å®¢æˆ·ç«¯æ¥å£è¯·æ±‚çš„æ—¶å€™ï¼Œåšè¿™ä¸ªåˆå§‹åŒ–æ“ä½œï¼Œ</span></span><br><span class="line"><span class="comment">ä¼šå¯¼è‡´æ­¤è¯·æ±‚çš„å“åº”æ—¶é—´å˜é•¿ï¼Œç”šè‡³è¶…æ—¶ï¼‰ã€‚</span></span><br><span class="line"><span class="comment">é‡‡ç”¨é¥¿æ±‰å¼å®ç°æ–¹å¼ï¼Œå°†è€—æ—¶çš„åˆå§‹åŒ–æ“ä½œï¼Œ</span></span><br><span class="line"><span class="comment">æå‰åˆ°ç¨‹åºå¯åŠ¨çš„æ—¶å€™å®Œæˆï¼Œè¿™æ ·å°±èƒ½é¿å…åœ¨ç¨‹åºè¿è¡Œçš„æ—¶å€™ï¼Œ</span></span><br><span class="line"><span class="comment">å†å»åˆå§‹åŒ–å¯¼è‡´çš„æ€§èƒ½é—®é¢˜ã€‚</span></span><br><span class="line"><span class="comment">å¦‚æœå®ä¾‹å ç”¨èµ„æºå¤šï¼ŒæŒ‰ç…§fail-fastçš„è®¾è®¡åŸåˆ™ï¼ˆæœ‰é—®é¢˜åŠæ—©æš´éœ²ï¼‰ï¼Œ</span></span><br><span class="line"><span class="comment">é‚£æˆ‘ä»¬ä¹Ÿå¸Œæœ›åœ¨ç¨‹åºå¯åŠ¨æ—¶å°±å°†è¿™ä¸ªå®ä¾‹åˆå§‹åŒ–å¥½ã€‚</span></span><br><span class="line"><span class="comment">å¦‚æœèµ„æºä¸å¤Ÿï¼Œå°±ä¼šåœ¨ç¨‹åºå¯åŠ¨çš„æ—¶å€™è§¦å‘æŠ¥é”™ï¼ˆæ¯”å¦‚Javaä¸­çš„ PermGen Space OOMï¼‰ï¼Œ</span></span><br><span class="line"><span class="comment">æˆ‘ä»¬å¯ä»¥ç«‹å³å»ä¿®å¤ã€‚è¿™æ ·ä¹Ÿèƒ½é¿å…åœ¨ç¨‹åºè¿è¡Œä¸€æ®µæ—¶é—´åï¼Œ</span></span><br><span class="line"><span class="comment">çªç„¶å› ä¸ºåˆå§‹åŒ–è¿™ä¸ªå®ä¾‹å ç”¨èµ„æºè¿‡å¤šï¼Œå¯¼è‡´ç³»ç»Ÿå´©æºƒï¼Œå½±å“ç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> es = &amp;EagerSingleton&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//func init() &#123;</span></span><br><span class="line"><span class="comment">//	å¦‚æœEagerSingletonæœ‰å±æ€§éœ€è¦åˆå§‹åŒ–,å¯ä»¥åœ¨initå†…è¿›è¡Œ</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetEsInstance</span><span class="params">()</span> *<span class="title">EagerSingleton</span></span>  &#123;</span><br><span class="line">	<span class="keyword">return</span> es</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> EagerSingleton <span class="keyword">struct</span> &#123;</span><br><span class="line">	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<hr>
<h5 id="2-æ‡’æ±‰å¼"><a href="#2-æ‡’æ±‰å¼" class="headerlink" title="2.æ‡’æ±‰å¼"></a>2.æ‡’æ±‰å¼</h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;sync&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">æ‡’æ±‰æ¨¡å¼é€‚ç”¨åœºæ™¯ï¼š</span></span><br><span class="line"><span class="comment">æ‡’æ±‰å¼ç›¸å¯¹äºé¥¿æ±‰å¼çš„ä¼˜åŠ¿æ˜¯æ”¯æŒå»¶è¿ŸåŠ è½½ã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> lz *LazySingleton</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> LazySingleton <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¬¬ä¸€ç§ï¼šéçº¿ç¨‹å®‰å…¨</span></span><br><span class="line"><span class="comment">//func GetLzInstance() *LazySingleton  &#123;</span></span><br><span class="line"><span class="comment">//	if lz == nil&#123;</span></span><br><span class="line"><span class="comment">//		lz = &amp;LazySingleton&#123;&#125;</span></span><br><span class="line"><span class="comment">//	&#125;</span></span><br><span class="line"><span class="comment">//	return lz</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¬¬äºŒç§ï¼šåŠ é”ï¼Œå¹¶å‘æ€§èƒ½æœ€å·®</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//var mu sync.Mutex</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//func GetLzInstance() *LazySingleton &#123;</span></span><br><span class="line"><span class="comment">//	mu.Lock()</span></span><br><span class="line"><span class="comment">//	defer mu.Unlock()</span></span><br><span class="line"><span class="comment">//	if lz == nil &#123;</span></span><br><span class="line"><span class="comment">//		lz = &amp;LazySingleton&#123;&#125;</span></span><br><span class="line"><span class="comment">//	&#125;</span></span><br><span class="line"><span class="comment">//	return lz</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¬¬ä¸‰ç§ï¼šé”+åŒé‡æ£€æŸ¥ï¼Œå¹¶å‘æ€§è¾ƒç¬¬äºŒç§ç¨å¥½ä¸€ç‚¹</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//var mu sync.Mutex</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//func GetLzInstance() *LazySingleton &#123;</span></span><br><span class="line"><span class="comment">//	if lz == nil &#123;</span></span><br><span class="line"><span class="comment">//		mu.Lock()</span></span><br><span class="line"><span class="comment">//		defer mu.Unlock()</span></span><br><span class="line"><span class="comment">//		if lz == nil &#123;</span></span><br><span class="line"><span class="comment">//			lz = &amp;LazySingleton&#123;&#125;</span></span><br><span class="line"><span class="comment">//		&#125;</span></span><br><span class="line"><span class="comment">//	&#125;</span></span><br><span class="line"><span class="comment">//	return lz</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¬¬å››ç§ï¼šæ‡’æ±‰å¼æœ€ä¼˜å®ç°,é€šè¿‡golangç‰¹æœ‰çš„sync.Onceæ¥å®ç°</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> once sync.Once</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetLzInstance</span><span class="params">()</span> *<span class="title">LazySingleton</span></span> &#123;</span><br><span class="line">	once.Do(<span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		lz = &amp;LazySingleton&#123;&#125;</span><br><span class="line">	&#125;)</span><br><span class="line">	<span class="keyword">return</span> lz</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>]]></content>
      <categories>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title>åˆ†å¸ƒå¼äº‹åŠ¡çš„ç‚¹ç‚¹æ»´æ»´--æ¦‚å¿µæ¦‚è§ˆ</title>
    <url>/2021/05/18/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/dtp01/</url>
    <content><![CDATA[<h4 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h4><blockquote>
<p>æœ€è¿‘ç€æ‰‹æŠŠå¾®æœåŠ¡é¡¹ç›®çš„æ•°æ®åº“è¿›è¡Œåˆ†åº“åˆ†è¡¨ï¼Œä¸å¯é¿å…çš„è¦å¢åŠ åˆ†å¸ƒå¼äº‹åŠ¡çš„è€ƒè™‘ï¼Œæ‰€ä»¥åœ¨æ­¤æŠŠç›¸å…³çŸ¥è¯†ç‚¹æ¢³ç†ä¸€ä¸‹ã€‚<br>æœ¬ä¸“é¢˜å°†ä¼šåˆ†ä¸ºä¸‰ç¯‡,ä»åˆ†å¸ƒå¼äº‹åŠ¡çš„æ¦‚å¿µåˆ°å„ç§ç†è®ºå’Œåè®®ã€‚</p>
</blockquote>
<span id="more"></span>

<p><img src="/2021/05/18/%E6%9E%B6%E6%9E%84%E8%AE%BE%E8%AE%A1/dtp01/1.png"><br>è®²åˆ†å¸ƒå¼äº‹åŠ¡ä¹‹å‰å…ˆåšä¸ªæ‰«ç›²ï¼Œäº†è§£å‡ ä¸ªæ¦‚å¿µï¼š</p>
<h3 id="1-å¾®æœåŠ¡"><a href="#1-å¾®æœåŠ¡" class="headerlink" title="1.å¾®æœåŠ¡"></a>1.å¾®æœåŠ¡</h3><blockquote>
<p>ä»¥ä¸‹å†…å®¹æ¥è‡ªç»´åŸºç™¾ç§‘</p>
</blockquote>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="TEXT"><figure class="iseeu highlight /text"><table><tr><td class="code"><pre><span class="line">å¾®æœåŠ¡ï¼ˆè‹±è¯­ï¼šMicroservicesï¼‰æ˜¯ä¸€ç§è½¯ä»¶æ¶æ„é£æ ¼ï¼Œ</span><br><span class="line">å®ƒæ˜¯ä»¥ä¸“æ³¨äºå•ä¸€è´£ä»»ä¸åŠŸèƒ½çš„å°å‹åŠŸèƒ½åŒºå— (Small Building Blocks) ä¸ºåŸºç¡€ï¼Œ</span><br><span class="line">åˆ©ç”¨æ¨¡å—åŒ–çš„æ–¹å¼ç»„åˆå‡ºå¤æ‚çš„å¤§å‹åº”ç”¨ç¨‹åºï¼Œ</span><br><span class="line">å„åŠŸèƒ½åŒºå—ä½¿ç”¨ä¸è¯­è¨€æ— å…³ (Language-Independent/Language agnosticï¼‰</span><br><span class="line">çš„APIé›†ç›¸äº’é€šä¿¡ã€‚</span><br><span class="line">å¾®æœåŠ¡çš„èµ·æºæ˜¯ç”± Peter Rodgers åšå£«äº 2005 å¹´åº¦äº‘è®¡ç®—åšè§ˆä¼š</span><br><span class="line">æå‡ºçš„å¾® Web æœåŠ¡ï¼ˆMicro-Web-Serviceï¼‰å¼€å§‹ï¼Œ</span><br><span class="line">Juval LÃ¶wy åˆ™æ˜¯ä¸ä»–æœ‰ç±»ä¼¼çš„å‰å¯¼æƒ³æ³•ï¼Œ</span><br><span class="line">å°†ç±»åˆ«å˜æˆç»†ç²’æœåŠ¡ï¼ˆgranular servicesï¼‰ï¼Œä»¥ä½œä¸ºå¾®è½¯ä¸‹ä¸€é˜¶æ®µçš„è½¯ä»¶æ¶æ„ï¼Œ</span><br><span class="line">å…¶æ ¸å¿ƒæƒ³æ³•æ˜¯è®©æœåŠ¡æ˜¯ç”±ç±»ä¼¼ Unix ç®¡é“çš„è®¿é—®æ–¹å¼ä½¿ç”¨ï¼Œ</span><br><span class="line">è€Œä¸”å¤æ‚çš„æœåŠ¡èƒŒåæ˜¯ä½¿ç”¨ç®€å• URI æ¥å¼€æ”¾æ¥å£ï¼Œä»»ä½•æœåŠ¡ï¼Œ</span><br><span class="line">ä»»ä½•ç»†ç²’éƒ½èƒ½è¢«å¼€æ”¾ï¼ˆexposedï¼‰ã€‚è¿™ä¸ªè®¾è®¡åœ¨ HP çš„å®éªŒå®¤è¢«å®ç°ï¼Œ</span><br><span class="line">å…·æœ‰æ”¹å˜å¤æ‚è½¯ä»¶ç³»ç»Ÿçš„å¼ºå¤§åŠ›é‡ã€‚</span><br></pre></td></tr></table></figure></div>

<h3 id="2-åˆ†å¸ƒå¼"><a href="#2-åˆ†å¸ƒå¼" class="headerlink" title="2.åˆ†å¸ƒå¼"></a>2.åˆ†å¸ƒå¼</h3><blockquote>
<p>ä»¥ä¸‹å†…å®¹æ¥è‡ªç»´åŸºç™¾ç§‘</p>
</blockquote>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="TEXT"><figure class="iseeu highlight /text"><table><tr><td class="code"><pre><span class="line">åˆ†å¸ƒå¼ç³»ç»Ÿæœ‰å¾ˆå¤šä¸åŒçš„å®šä¹‰ï¼Œ</span><br><span class="line">ä¸€èˆ¬è®¤ä¸ºï¼šâ€œä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿæ˜¯ä¸€äº›ç‹¬ç«‹çš„è®¡ç®—æœºé›†åˆï¼Œ</span><br><span class="line">ä½†æ˜¯å¯¹è¿™ä¸ªç³»ç»Ÿçš„ç”¨æˆ·æ¥è¯´ï¼Œç³»ç»Ÿå°±åƒä¸€å°è®¡ç®—æœºä¸€æ ·ã€‚â€</span><br><span class="line">è¿™ä¸ªå®šä¹‰æœ‰ä¸¤æ–¹é¢çš„å«ä¹‰ï¼š</span><br><span class="line">ç¬¬ä¸€ï¼Œä»ç¡¬ä»¶è§’åº¦æ¥è®²ï¼Œæ¯å°è®¡ç®—æœºéƒ½æ˜¯è‡ªä¸»çš„ï¼›</span><br><span class="line">ç¬¬äºŒï¼Œä»è½¯ä»¶è§’åº¦æ¥è®²ï¼Œç”¨æˆ·å°†æ•´ä¸ªç³»ç»Ÿçœ‹åšæ˜¯ä¸€å°è®¡ç®—æœºã€‚</span><br><span class="line">è¿™ä¸¤è€…éƒ½æ˜¯å¿…éœ€çš„ï¼Œç¼ºä¸€ä¸å¯</span><br></pre></td></tr></table></figure></div>

<h3 id="3-äº‹åŠ¡"><a href="#3-äº‹åŠ¡" class="headerlink" title="3.äº‹åŠ¡"></a>3.äº‹åŠ¡</h3><blockquote>
<p>ä»¥ä¸‹å†…å®¹æ¥è‡ªç»´åŸºç™¾ç§‘</p>
</blockquote>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="TEXT"><figure class="iseeu highlight /text"><table><tr><td class="code"><pre><span class="line">æ•°æ®åº“äº‹åŠ¡ï¼ˆç®€ç§°ï¼šäº‹åŠ¡ï¼‰æ˜¯æ•°æ®åº“ç®¡ç†ç³»ç»Ÿæ‰§è¡Œè¿‡ç¨‹ä¸­çš„ä¸€ä¸ªé€»è¾‘å•ä½ï¼Œ</span><br><span class="line">ç”±ä¸€ä¸ªæœ‰é™çš„æ•°æ®åº“æ“ä½œåºåˆ—æ„æˆã€‚</span><br><span class="line">æ•°æ®åº“äº‹åŠ¡é€šå¸¸åŒ…å«äº†ä¸€ä¸ªåºåˆ—çš„å¯¹æ•°æ®åº“çš„è¯»/å†™æ“ä½œã€‚</span><br><span class="line">åŒ…å«æœ‰ä»¥ä¸‹ä¸¤ä¸ªç›®çš„ï¼š</span><br><span class="line">ä¸ºæ•°æ®åº“æ“ä½œåºåˆ—æä¾›äº†ä¸€ä¸ªä»å¤±è´¥ä¸­æ¢å¤åˆ°æ­£å¸¸çŠ¶æ€çš„æ–¹æ³•ï¼Œ</span><br><span class="line">åŒæ—¶æä¾›äº†æ•°æ®åº“å³ä½¿åœ¨å¼‚å¸¸çŠ¶æ€ä¸‹ä»èƒ½ä¿æŒä¸€è‡´æ€§çš„æ–¹æ³•ã€‚</span><br><span class="line">å½“å¤šä¸ªåº”ç”¨ç¨‹åºåœ¨å¹¶å‘è®¿é—®æ•°æ®åº“æ—¶ï¼Œå¯ä»¥åœ¨è¿™äº›åº”ç”¨ç¨‹åºä¹‹é—´æä¾›ä¸€ä¸ªéš”ç¦»æ–¹æ³•ï¼Œ</span><br><span class="line">ä»¥é˜²æ­¢å½¼æ­¤çš„æ“ä½œäº’ç›¸å¹²æ‰°ã€‚</span><br><span class="line">é€šä¿—ç‚¹è®²å°±æ˜¯ï¼šæ•°æ®åº“äº‹åŠ¡å¯ä»¥ç¡®ä¿è¯¥äº‹åŠ¡èŒƒå›´å†…çš„æ‰€æœ‰æ“ä½œéƒ½å¯ä»¥å…¨éƒ¨æˆåŠŸæˆ–è€…å…¨éƒ¨å¤±è´¥ã€‚  </span><br><span class="line">å¦‚æœäº‹åŠ¡å¤±è´¥ï¼Œé‚£ä¹ˆæ•ˆæœå°±å’Œæ²¡æœ‰æ‰§è¡Œè¿™äº›SQLä¸€æ ·ï¼Œä¸ä¼šå¯¹æ•°æ®åº“æ•°æ®æœ‰ä»»ä½•æ”¹åŠ¨ã€‚</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
<h4 id="3-1-åˆ†å¸ƒå¼äº‹åŠ¡çš„èµ·æºï¼š"><a href="#3-1-åˆ†å¸ƒå¼äº‹åŠ¡çš„èµ·æºï¼š" class="headerlink" title="3.1 åˆ†å¸ƒå¼äº‹åŠ¡çš„èµ·æºï¼š"></a>3.1 åˆ†å¸ƒå¼äº‹åŠ¡çš„èµ·æºï¼š</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="TEXT"><figure class="iseeu highlight /text"><table><tr><td class="code"><pre><span class="line">åœ¨å•ä½“æ¶æ„ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ•°æ®åº“å±‚é¢å¯¹äº‹åŠ¡çš„æ”¯æŒæ¥ä¿è¯ä¸šåŠ¡ä¸Šçš„äº‹åŠ¡æ“ä½œã€‚  </span><br><span class="line">ä½†æ˜¯éšç€å¾®æœåŠ¡æ¶æ„çš„æ™®åŠï¼Œä¸€ä¸ªå¤§å‹ä¸šåŠ¡ç³»ç»Ÿå¾€å¾€ç”±è‹¥å¹²ä¸ªå­ç³»ç»Ÿæ„æˆï¼Œ  </span><br><span class="line">è¿™äº›å­ç³»ç»Ÿåˆæ‹¥æœ‰å„è‡ªç‹¬ç«‹çš„æ•°æ®åº“ã€‚å¾€å¾€ä¸€ä¸ªä¸šåŠ¡æµç¨‹éœ€è¦ç”±å¤šä¸ªå­ç³»ç»Ÿå…±åŒå®Œæˆï¼Œ  </span><br><span class="line">è€Œä¸”è¿™äº›æ“ä½œå¯èƒ½éœ€è¦åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­å®Œæˆã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬å°±éœ€è¦åœ¨æ•°æ®åº“ä¹‹ä¸Šé€šè¿‡æŸç§æ‰‹æ®µï¼Œ  </span><br><span class="line">å®ç°è·¨æ•°æ®åº“çš„äº‹åŠ¡æ”¯æŒï¼Œè¿™ä¹Ÿå°±æ˜¯å¤§å®¶å¸¸è¯´çš„â€œåˆ†å¸ƒå¼äº‹åŠ¡â€ã€‚</span><br><span class="line">åˆ†å¸ƒå¼äº‹åŠ¡æ¶‰åŠåˆ°æ“ä½œå¤šä¸ªæ•°æ®åº“çš„äº‹åŠ¡ï¼Œåˆ†å¸ƒå¼äº‹åŠ¡çš„å‚ä¸è€…ã€æ”¯æŒäº‹åŠ¡çš„æœåŠ¡å™¨ã€  </span><br><span class="line">èµ„æºæœåŠ¡å™¨ä»¥åŠäº‹åŠ¡ç®¡ç†å™¨åˆ†åˆ«ä½äºåˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸åŒèŠ‚ç‚¹ä¸Šã€‚  </span><br><span class="line">ä¸€ä¸ªåˆ†å¸ƒå¼äº‹åŠ¡å¯ä»¥çœ‹ä½œæ˜¯ç”±å¤šä¸ªåˆ†å¸ƒå¼çš„æ“ä½œåºåˆ—ç»„æˆçš„ï¼Œé€šå¸¸å¯ä»¥æŠŠè¿™ä¸€ç³»åˆ—åˆ†å¸ƒå¼çš„æ“ä½œåºåˆ—ç§°ä¸ºå­äº‹åŠ¡ï¼Œ  </span><br><span class="line">ä½†ç”±äºåœ¨åˆ†å¸ƒå¼äº‹åŠ¡ä¸­ï¼Œå„ä¸ªå­äº‹åŠ¡çš„æ‰§è¡Œæ˜¯åˆ†å¸ƒå¼çš„ï¼Œå› æ­¤è¦å®ç°ä¸€ç§èƒ½å¤Ÿä¿è¯ ACID ç‰¹æ€§çš„åˆ†å¸ƒå¼äº‹åŠ¡å¤„ç†ç³»ç»Ÿå°±æ˜¾å¾—æ ¼å¤–å¤æ‚ã€‚</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<h4 id="3-2-åˆ†å¸ƒå¼äº‹åŠ¡çš„ä¸¤ä¸ªå…¸å‹åº”ç”¨åœºæ™¯ï¼š"><a href="#3-2-åˆ†å¸ƒå¼äº‹åŠ¡çš„ä¸¤ä¸ªå…¸å‹åº”ç”¨åœºæ™¯ï¼š" class="headerlink" title="3.2 åˆ†å¸ƒå¼äº‹åŠ¡çš„ä¸¤ä¸ªå…¸å‹åº”ç”¨åœºæ™¯ï¼š"></a>3.2 åˆ†å¸ƒå¼äº‹åŠ¡çš„ä¸¤ä¸ªå…¸å‹åº”ç”¨åœºæ™¯ï¼š</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="TEXT"><figure class="iseeu highlight /text"><table><tr><td class="code"><pre><span class="line">1.æ•°æ®åº“åˆ†åº“åˆ†è¡¨ï¼š</span><br><span class="line">åœ¨å•åº“å•è¡¨åœºæ™¯ä¸‹ï¼Œå½“ä¸šåŠ¡æ•°æ®é‡è¾¾åˆ°å•åº“å•è¡¨çš„æé™æ—¶ï¼Œå°±éœ€è¦è€ƒè™‘åˆ†åº“åˆ†è¡¨ï¼Œ  </span><br><span class="line">å°†ä¹‹å‰çš„å•åº“å•è¡¨æ‹†åˆ†æˆå¤šåº“å¤šè¡¨ï¼›åˆ†åº“åˆ†è¡¨ä¹‹åï¼ŒåŸæ¥åœ¨å•ä¸ªæ•°æ®åº“ä¸Šçš„äº‹åŠ¡æ“ä½œï¼Œ  </span><br><span class="line">å¯èƒ½å°±å˜æˆè·¨å¤šä¸ªæ•°æ®åº“çš„æ“ä½œï¼Œæ­¤æ—¶å°±éœ€è¦ä½¿ç”¨åˆ†å¸ƒå¼äº‹åŠ¡ã€‚</span><br><span class="line"></span><br><span class="line">2.ä¸šåŠ¡æœåŠ¡åŒ–</span><br><span class="line">ä¸šåŠ¡æœåŠ¡åŒ–å³ä¸šåŠ¡æŒ‰ç…§é¢å‘æœåŠ¡ï¼ˆSOAï¼‰çš„æ¶æ„æ‹†åˆ†æ•´ä¸ªç½‘ç«™ç³»ç»Ÿï¼Œæ‰€æœ‰çš„ä¸šåŠ¡æ“ä½œéƒ½ä»¥æœåŠ¡çš„æ–¹å¼å¯¹å¤–å‘å¸ƒï¼Œ  </span><br><span class="line">è·¨åº”ç”¨ã€è·¨æœåŠ¡çš„æ“ä½œéœ€è¦ä½¿ç”¨åˆ†å¸ƒå¼äº‹åŠ¡æ‰èƒ½ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
<h4 id="3-3-åˆ†å¸ƒå¼äº‹åŠ¡æ¶‰åŠåˆ°çš„å‡ ä¸ªç†è®ºï¼š"><a href="#3-3-åˆ†å¸ƒå¼äº‹åŠ¡æ¶‰åŠåˆ°çš„å‡ ä¸ªç†è®ºï¼š" class="headerlink" title="3.3 åˆ†å¸ƒå¼äº‹åŠ¡æ¶‰åŠåˆ°çš„å‡ ä¸ªç†è®ºï¼š"></a>3.3 åˆ†å¸ƒå¼äº‹åŠ¡æ¶‰åŠåˆ°çš„å‡ ä¸ªç†è®ºï¼š</h4><h5 id="3-3-1-CAPï¼š"><a href="#3-3-1-CAPï¼š" class="headerlink" title="3.3.1.CAPï¼š"></a>3.3.1.CAPï¼š</h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="TEXT"><figure class="iseeu highlight /text"><table><tr><td class="code"><pre><span class="line">åˆ†å¸ƒå¼ç³»ç»Ÿä¸å¯èƒ½åŒæ—¶æ»¡è¶³</span><br><span class="line">ä¸€è‡´æ€§ï¼ˆCï¼šConsistencyï¼‰ã€</span><br><span class="line">å¯ç”¨æ€§ï¼ˆAï¼šAvailabilityï¼‰ã€</span><br><span class="line">åˆ†åŒºå®¹å¿æ€§ï¼ˆPï¼šPartition Toleranceï¼‰ã€</span><br><span class="line">æœ€å¤šåªèƒ½åŒæ—¶æ»¡è¶³å…¶ä¸­ä¸¤é¡¹ã€‚</span><br><span class="line"></span><br><span class="line">Consistency ä¸€è‡´æ€§:ä¸€è‡´æ€§æŒ‡çš„æ˜¯å¤šä¸ªæ•°æ®å‰¯æœ¬æ˜¯å¦èƒ½ä¿æŒä¸€è‡´çš„ç‰¹æ€§ï¼Œ  </span><br><span class="line">åœ¨ä¸€è‡´æ€§çš„æ¡ä»¶ä¸‹ï¼Œç³»ç»Ÿåœ¨æ‰§è¡Œæ•°æ®æ›´æ–°æ“ä½œä¹‹åèƒ½å¤Ÿä»ä¸€è‡´æ€§çŠ¶æ€è½¬ç§»åˆ°å¦ä¸€ä¸ªä¸€è‡´æ€§çŠ¶æ€ã€‚  </span><br><span class="line">å¯¹ç³»ç»Ÿçš„ä¸€ä¸ªæ•°æ®æ›´æ–°æˆåŠŸä¹‹åï¼Œå¦‚æœæ‰€æœ‰ç”¨æˆ·éƒ½èƒ½å¤Ÿè¯»å–åˆ°æœ€æ–°çš„å€¼ï¼Œè¯¥ç³»ç»Ÿå°±è¢«è®¤ä¸ºå…·æœ‰å¼ºä¸€è‡´æ€§ã€‚  </span><br><span class="line"></span><br><span class="line">Availability å¯ç”¨æ€§:å¯ç”¨æ€§æŒ‡åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨é¢å¯¹å„ç§å¼‚å¸¸æ—¶å¯ä»¥æä¾›æ­£å¸¸æœåŠ¡çš„èƒ½åŠ›ï¼Œ  </span><br><span class="line">å¯ä»¥ç”¨ç³»ç»Ÿå¯ç”¨æ—¶é—´å æ€»æ—¶é—´çš„æ¯”å€¼æ¥è¡¡é‡ï¼Œ4 ä¸ª 9 çš„å¯ç”¨æ€§è¡¨ç¤ºç³»ç»Ÿ 99.99% çš„æ—¶é—´æ˜¯å¯ç”¨çš„ã€‚  </span><br><span class="line">åœ¨å¯ç”¨æ€§æ¡ä»¶ä¸‹ï¼Œè¦æ±‚ç³»ç»Ÿæä¾›çš„æœåŠ¡ä¸€ç›´å¤„äºå¯ç”¨çš„çŠ¶æ€ï¼Œå¯¹äºç”¨æˆ·çš„æ¯ä¸€ä¸ªæ“ä½œè¯·æ±‚æ€»æ˜¯èƒ½å¤Ÿåœ¨æœ‰é™çš„æ—¶é—´å†…è¿”å›ç»“æœã€‚</span><br><span class="line"></span><br><span class="line">Parttition Tolerance åˆ†åŒºå®¹å¿æ€§:ç½‘ç»œåˆ†åŒºæŒ‡åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„èŠ‚ç‚¹è¢«åˆ’åˆ†ä¸ºå¤šä¸ªåŒºåŸŸï¼Œæ¯ä¸ªåŒºåŸŸå†…éƒ¨å¯ä»¥é€šä¿¡ï¼Œ  </span><br><span class="line">ä½†æ˜¯åŒºåŸŸä¹‹é—´æ— æ³•é€šä¿¡ã€‚åœ¨åˆ†åŒºå®¹å¿æ€§æ¡ä»¶ä¸‹ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿåœ¨é‡åˆ°ä»»ä½•ç½‘ç»œåˆ†åŒºæ•…éšœçš„æ—¶å€™ï¼Œ  </span><br><span class="line">ä»ç„¶éœ€è¦èƒ½å¯¹å¤–æä¾›ä¸€è‡´æ€§å’Œå¯ç”¨æ€§çš„æœåŠ¡ï¼Œé™¤éæ˜¯æ•´ä¸ªç½‘ç»œç¯å¢ƒéƒ½å‘ç”Ÿäº†æ•…éšœã€‚  </span><br></pre></td></tr></table></figure></div>
<p>å…³äºCAPçš„çŸ¥ä¹é«˜èµè§£é‡Šï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="TEXT"><figure class="iseeu highlight /text"><table><tr><td class="code"><pre><span class="line">ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿé‡Œé¢ï¼ŒèŠ‚ç‚¹ç»„æˆçš„ç½‘ç»œæœ¬æ¥åº”è¯¥æ˜¯è¿é€šçš„ã€‚ç„¶è€Œå¯èƒ½å› ä¸ºä¸€äº›æ•…éšœï¼Œä½¿å¾—æœ‰äº›èŠ‚ç‚¹ä¹‹é—´ä¸è¿é€šäº†ï¼Œ  </span><br><span class="line">æ•´ä¸ªç½‘ç»œå°±åˆ†æˆäº†å‡ å—åŒºåŸŸã€‚æ•°æ®å°±æ•£å¸ƒåœ¨äº†è¿™äº›ä¸è¿é€šçš„åŒºåŸŸä¸­ã€‚è¿™å°±å«åˆ†åŒºã€‚</span><br><span class="line">å½“ä½ ä¸€ä¸ªæ•°æ®é¡¹åªåœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸­ä¿å­˜ï¼Œé‚£ä¹ˆåˆ†åŒºå‡ºç°åï¼Œå’Œè¿™ä¸ªèŠ‚ç‚¹ä¸è¿é€šçš„éƒ¨åˆ†å°±è®¿é—®ä¸åˆ°è¿™ä¸ªæ•°æ®äº†ã€‚è¿™æ—¶åˆ†åŒºå°±æ˜¯æ— æ³•å®¹å¿çš„ã€‚</span><br><span class="line">æé«˜åˆ†åŒºå®¹å¿æ€§çš„åŠæ³•å°±æ˜¯ä¸€ä¸ªæ•°æ®é¡¹å¤åˆ¶åˆ°å¤šä¸ªèŠ‚ç‚¹ä¸Šï¼Œé‚£ä¹ˆå‡ºç°åˆ†åŒºä¹‹åï¼Œè¿™ä¸€æ•°æ®é¡¹å°±å¯èƒ½åˆ†å¸ƒåˆ°å„ä¸ªåŒºé‡Œã€‚å®¹å¿æ€§å°±æé«˜äº†ã€‚</span><br><span class="line">ç„¶è€Œï¼Œè¦æŠŠæ•°æ®å¤åˆ¶åˆ°å¤šä¸ªèŠ‚ç‚¹ï¼Œå°±ä¼šå¸¦æ¥ä¸€è‡´æ€§çš„é—®é¢˜ï¼Œå°±æ˜¯å¤šä¸ªèŠ‚ç‚¹ä¸Šé¢çš„æ•°æ®å¯èƒ½æ˜¯ä¸ä¸€è‡´çš„ã€‚  </span><br><span class="line">è¦ä¿è¯ä¸€è‡´ï¼Œæ¯æ¬¡å†™æ“ä½œå°±éƒ½è¦ç­‰å¾…å…¨éƒ¨èŠ‚ç‚¹å†™æˆåŠŸï¼Œè€Œè¿™ç­‰å¾…åˆä¼šå¸¦æ¥å¯ç”¨æ€§çš„é—®é¢˜ã€‚</span><br><span class="line">æ€»çš„æ¥è¯´å°±æ˜¯ï¼Œæ•°æ®å­˜åœ¨çš„èŠ‚ç‚¹è¶Šå¤šï¼Œåˆ†åŒºå®¹å¿æ€§è¶Šé«˜ï¼Œä½†è¦å¤åˆ¶æ›´æ–°çš„æ•°æ®å°±è¶Šå¤šï¼Œä¸€è‡´æ€§å°±è¶Šéš¾ä¿è¯ã€‚  </span><br><span class="line">ä¸ºäº†ä¿è¯ä¸€è‡´æ€§ï¼Œæ›´æ–°æ‰€æœ‰èŠ‚ç‚¹æ•°æ®æ‰€éœ€è¦çš„æ—¶é—´å°±è¶Šé•¿ï¼Œå¯ç”¨æ€§å°±ä¼šé™ä½ã€‚</span><br><span class="line"></span><br><span class="line">ç»¼ä¸Šï¼ŒCAP ç†è®ºå®é™…ä¸Šæ˜¯è¦åœ¨å¯ç”¨æ€§å’Œä¸€è‡´æ€§ä¹‹é—´åšæƒè¡¡ã€‚  </span><br><span class="line">å¯ç”¨æ€§å’Œä¸€è‡´æ€§å¾€å¾€æ˜¯å†²çªçš„ï¼Œå¾ˆéš¾ä½¿å®ƒä»¬åŒæ—¶æ»¡è¶³ã€‚åœ¨å¤šä¸ªèŠ‚ç‚¹ä¹‹é—´è¿›è¡Œæ•°æ®åŒæ­¥æ—¶ï¼Œ</span><br><span class="line">ä¸ºäº†ä¿è¯ä¸€è‡´æ€§ï¼ˆCPï¼‰ï¼Œä¸èƒ½è®¿é—®æœªåŒæ­¥å®Œæˆçš„èŠ‚ç‚¹ï¼Œä¹Ÿå°±å¤±å»äº†éƒ¨åˆ†å¯ç”¨æ€§ï¼›</span><br><span class="line">ä¸ºäº†ä¿è¯å¯ç”¨æ€§ï¼ˆAPï¼‰ï¼Œå…è®¸è¯»å–æ‰€æœ‰èŠ‚ç‚¹çš„æ•°æ®ï¼Œä½†æ˜¯æ•°æ®å¯èƒ½ä¸ä¸€è‡´ã€‚</span><br><span class="line">é€šå¸¸é‡‡å–çš„ç­–ç•¥æ˜¯ä¿è¯å¯ç”¨æ€§ï¼Œç‰ºç‰²éƒ¨åˆ†ä¸€è‡´æ€§ï¼Œåªç¡®ä¿æœ€ç»ˆä¸€è‡´æ€§ã€‚</span><br><span class="line">å½“ç„¶ï¼Œç‰ºç‰²ä¸€è‡´æ€§ï¼Œå¹¶ä¸æ˜¯å®Œå…¨ä¸ç®¡æ•°æ®çš„ä¸€è‡´æ€§ï¼Œå¦åˆ™æ•°æ®æ˜¯æ··ä¹±çš„ï¼Œé‚£ä¹ˆç³»ç»Ÿå¯ç”¨æ€§å†é«˜åˆ†å¸ƒå¼å†å¥½ä¹Ÿæ²¡æœ‰äº†ä»·å€¼ã€‚  </span><br><span class="line">ç‰ºç‰²ä¸€è‡´æ€§ï¼Œåªæ˜¯ä¸å†è¦æ±‚å…³ç³»å‹æ•°æ®åº“ä¸­çš„å¼ºä¸€è‡´æ€§ï¼Œè€Œæ˜¯åªè¦ç³»ç»Ÿèƒ½è¾¾åˆ°æœ€ç»ˆä¸€è‡´æ€§å³å¯ï¼Œè€ƒè™‘åˆ°å®¢æˆ·ä½“éªŒï¼Œ  </span><br><span class="line">è¿™ä¸ªæœ€ç»ˆä¸€è‡´çš„æ—¶é—´çª—å£ï¼Œè¦å°½å¯èƒ½çš„å¯¹ç”¨æˆ·é€æ˜ï¼Œä¹Ÿå°±æ˜¯éœ€è¦ä¿éšœâ€œç”¨æˆ·æ„ŸçŸ¥åˆ°çš„ä¸€è‡´æ€§â€ã€‚  </span><br><span class="line">é€šå¸¸æ˜¯é€šè¿‡æ•°æ®çš„å¤šä»½å¼‚æ­¥å¤åˆ¶æ¥å®ç°ç³»ç»Ÿçš„é«˜å¯ç”¨å’Œæ•°æ®çš„æœ€ç»ˆä¸€è‡´æ€§çš„ï¼Œâ€œç”¨æˆ·æ„ŸçŸ¥åˆ°çš„ä¸€è‡´æ€§â€çš„æ—¶é—´çª—å£åˆ™å–å†³äºæ•°æ®å¤åˆ¶åˆ°ä¸€è‡´çŠ¶æ€çš„æ—¶é—´ã€‚</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<h5 id="3-3-2-BASEï¼š"><a href="#3-3-2-BASEï¼š" class="headerlink" title="3.3.2.BASEï¼š"></a>3.3.2.BASEï¼š</h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="TEXT"><figure class="iseeu highlight /text"><table><tr><td class="code"><pre><span class="line">BASEç†è®ºæ˜¯æŒ‡ï¼ŒBasically Availableï¼ˆåŸºæœ¬å¯ç”¨ï¼‰ã€Soft-stateï¼ˆ è½¯çŠ¶æ€/æŸ”æ€§äº‹åŠ¡ï¼‰ã€Eventual Consistencyï¼ˆæœ€ç»ˆä¸€è‡´æ€§ï¼‰ã€‚  </span><br><span class="line">æ˜¯åŸºäºCAPå®šç†æ¼”åŒ–è€Œæ¥ï¼Œæ˜¯å¯¹CAPä¸­ä¸€è‡´æ€§å’Œå¯ç”¨æ€§æƒè¡¡çš„ç»“æœã€‚  </span><br><span class="line">æ ¸å¿ƒæ€æƒ³ï¼šå³ä½¿æ— æ³•åšåˆ°å¼ºä¸€è‡´æ€§ï¼Œä½†æ¯ä¸ªä¸šåŠ¡æ ¹æ®è‡ªèº«çš„ç‰¹ç‚¹ï¼Œé‡‡ç”¨é€‚å½“çš„æ–¹å¼æ¥ä½¿ç³»ç»Ÿè¾¾åˆ°æœ€ç»ˆä¸€è‡´æ€§ã€‚</span><br><span class="line"></span><br><span class="line"> åŸºæœ¬å¯ç”¨BAï¼šï¼ˆBasically Available ï¼‰ï¼šæŒ‡åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨å‡ºç°æ•…éšœçš„æ—¶å€™ï¼Œå…è®¸æŸå¤±éƒ¨åˆ†å¯ç”¨æ€§ï¼Œä¿è¯æ ¸å¿ƒå¯ç”¨ã€‚  </span><br><span class="line"> ä½†ä¸ç­‰ä»·äºä¸å¯ç”¨ã€‚æ¯”å¦‚ï¼šæœç´¢å¼•æ“0.5ç§’è¿”å›æŸ¥è¯¢ç»“æœï¼Œä½†ç”±äºæ•…éšœï¼Œ2ç§’å“åº”æŸ¥è¯¢ç»“æœï¼›  </span><br><span class="line"> ç½‘é¡µè®¿é—®è¿‡å¤§æ—¶ï¼Œéƒ¨åˆ†ç”¨æˆ·æä¾›é™çº§æœåŠ¡ç­‰ã€‚ç®€å•æ¥è¯´å°±æ˜¯åŸºæœ¬å¯ç”¨ã€‚</span><br><span class="line"> </span><br><span class="line">è½¯çŠ¶æ€S:(Soft State)ï¼šè½¯çŠ¶æ€æ˜¯æŒ‡å…è®¸ç³»ç»Ÿå­˜åœ¨ä¸­é—´çŠ¶æ€ï¼Œå¹¶ä¸”è¯¥ä¸­é—´çŠ¶æ€ä¸ä¼šå½±å“ç³»ç»Ÿæ•´ä½“å¯ç”¨æ€§ã€‚  </span><br><span class="line">å³å…è®¸ç³»ç»Ÿåœ¨ä¸åŒèŠ‚ç‚¹é—´å‰¯æœ¬åŒæ­¥çš„æ—¶å€™å­˜åœ¨å»¶æ—¶ã€‚ç®€å•æ¥è¯´å°±æ˜¯çŠ¶æ€å¯ä»¥åœ¨ä¸€æ®µæ—¶é—´å†…ä¸åŒ            æ­¥ã€‚</span><br><span class="line"></span><br><span class="line">æœ€ç»ˆä¸€è‡´æ€§Eï¼š(Eventually Consistent)ï¼šç³»ç»Ÿä¸­çš„æ‰€æœ‰æ•°æ®å‰¯æœ¬ç»è¿‡ä¸€å®šæ—¶é—´åï¼Œæœ€ç»ˆèƒ½å¤Ÿè¾¾åˆ°ä¸€è‡´çš„çŠ¶æ€ï¼Œä¸éœ€è¦å®æ—¶ä¿è¯ç³»ç»Ÿæ•°æ®çš„å¼ºä¸€è‡´æ€§ã€‚  </span><br><span class="line">æœ€ç»ˆä¸€è‡´æ€§æ˜¯å¼±ä¸€è‡´æ€§çš„ä¸€ç§ç‰¹æ®Šæƒ…å†µã€‚  </span><br><span class="line"></span><br><span class="line">BASEç†è®ºé¢å‘çš„æ˜¯å¤§å‹é«˜å¯ç”¨å¯æ‰©å±•çš„åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œé€šè¿‡ç‰ºç‰²å¼ºä¸€è‡´æ€§æ¥è·å¾—å¯ç”¨æ€§ã€‚  </span><br><span class="line">ACIDæ˜¯ä¼ ç»Ÿæ•°æ®åº“å¸¸ç”¨çš„æ¦‚å¿µè®¾è®¡ï¼Œè¿½æ±‚å¼ºä¸€è‡´æ€§æ¨¡å‹ã€‚  </span><br><span class="line">ç®€å•æ¥è¯´å°±æ˜¯åœ¨ä¸€å®šçš„æ—¶é—´çª—å£å†…ï¼Œ æœ€ç»ˆæ•°æ®è¾¾æˆä¸€è‡´å³å¯ã€‚  </span><br></pre></td></tr></table></figure></div>


<h5 id="3-3-3-æŸ”æ€§äº‹åŠ¡å’Œåˆšæ€§äº‹åŠ¡ï¼š"><a href="#3-3-3-æŸ”æ€§äº‹åŠ¡å’Œåˆšæ€§äº‹åŠ¡ï¼š" class="headerlink" title="3.3.3.æŸ”æ€§äº‹åŠ¡å’Œåˆšæ€§äº‹åŠ¡ï¼š"></a>3.3.3.æŸ”æ€§äº‹åŠ¡å’Œåˆšæ€§äº‹åŠ¡ï¼š</h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="TEXT"><figure class="iseeu highlight /text"><table><tr><td class="code"><pre><span class="line">åˆšæ€§äº‹åŠ¡æ»¡è¶³ACIDç†è®º</span><br><span class="line">ACIDèƒ½å¤Ÿä¿è¯äº‹åŠ¡çš„å¼ºä¸€è‡´æ€§ï¼Œå³æ•°æ®æ˜¯å®æ—¶ä¸€è‡´çš„ã€‚</span><br><span class="line">è¿™åœ¨æœ¬åœ°äº‹åŠ¡ä¸­æ˜¯æ²¡æœ‰é—®é¢˜çš„ï¼Œåœ¨åˆ†å¸ƒå¼äº‹åŠ¡ä¸­ï¼Œ</span><br><span class="line">å¼ºä¸€è‡´æ€§ä¼šæå¤§å½±å“åˆ†å¸ƒå¼ç³»ç»Ÿçš„æ€§èƒ½ï¼Œå› æ­¤åˆ†å¸ƒå¼ç³»ç»Ÿä¸­éµå¾ªBASEç†è®ºå³å¯ã€‚</span><br><span class="line">ä½†åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸åŒä¸šåŠ¡åœºæ™¯å¯¹ä¸€è‡´æ€§çš„è¦æ±‚ä¹Ÿä¸åŒã€‚</span><br><span class="line">å¦‚äº¤æ˜“åœºæ™¯ä¸‹ï¼Œå°±è¦æ±‚å¼ºä¸€è‡´æ€§ï¼Œæ­¤æ—¶å°±éœ€è¦éµå¾ªACIDç†è®ºï¼Œ</span><br><span class="line">è€Œåœ¨æ³¨å†ŒæˆåŠŸåå‘é€çŸ­ä¿¡éªŒè¯ç ç­‰åœºæ™¯ä¸‹ï¼Œå¹¶ä¸éœ€è¦å®æ—¶ä¸€è‡´ï¼Œ</span><br><span class="line">å› æ­¤éµå¾ªBASEç†è®ºå³å¯ã€‚</span><br><span class="line">å› æ­¤è¦æ ¹æ®å…·ä½“ä¸šåŠ¡åœºæ™¯ï¼Œåœ¨ACIDå’ŒBASEä¹‹é—´å¯»æ±‚å¹³è¡¡ã€‚</span><br><span class="line">æŸ”æ€§äº‹åŠ¡æ»¡è¶³BASEç†è®ºï¼ˆåŸºæœ¬å¯ç”¨ï¼Œæœ€ç»ˆä¸€è‡´ï¼‰</span><br><span class="line"></span><br><span class="line">æŸ”æ€§äº‹åŠ¡åˆ†ä¸ºï¼š</span><br><span class="line">ä¸¤é˜¶æ®µå‹ 2PC(two phase commitment)</span><br><span class="line">è¡¥å¿å‹TCC (try confirn/caclen</span><br><span class="line">å¼‚æ­¥ç¡®ä¿å‹ (é€šè¿‡ä¿¡æ¯ä¸­é—´ä»¶)</span><br><span class="line">æœ€å¤§åŠªåŠ›é€šçŸ¥å‹ã€‚</span><br></pre></td></tr></table></figure></div>
<blockquote>
<p>åˆ†å¸ƒå¼äº‹åŠ¡æ¶‰åŠåˆ°çš„æ¦‚å¿µè®²å®Œäº†ï¼Œæ¥ä¸‹æ¥ä¸¤ç¯‡å°†åˆ†åˆ«è®²ä¸‹åˆ†å¸ƒå¼äº‹åŠ¡çš„ä¸€äº›æŒ‡å¯¼ç†è®ºå’Œåè®®ã€‚</p>
</blockquote>
]]></content>
      <categories>
        <category>æ¶æ„è®¾è®¡</category>
      </categories>
      <tags>
        <tag>æ¶æ„è®¾è®¡</tag>
      </tags>
  </entry>
  <entry>
    <title>å·¥å‚æ¨¡å¼</title>
    <url>/2021/03/23/design/factory01/</url>
    <content><![CDATA[<hr>
<h4 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h4><blockquote>
<p>ç®€å•å·¥å‚æ¨¡å¼(Simple Factory Pattern)<br>å·¥å‚æ–¹æ³•æ¨¡å¼(Factory Method)ï¼šå®šä¹‰äº†ä¸€ä¸ªåˆ›å»ºå¯¹è±¡çš„æ¥å£ï¼Œä½†ç”±å­ç±»å†³å®šè¦å®ä¾‹åŒ–çš„ç±»æ˜¯å“ªä¸€ä¸ªã€‚å·¥å‚æ–¹æ³•è®©ç±»æŠŠå®ä¾‹åŒ–æ¨è¿Ÿåˆ°å­ç±»<br>æŠ½è±¡å·¥å‚æ¨¡å¼ï¼šæä¾›ä¸€ä¸ªæ¥å£ï¼Œç”¨äºåˆ›å»ºç›¸å…³æˆ–ä¾èµ–å¯¹è±¡çš„å®¶æ—ï¼Œè€Œä¸éœ€è¦æ˜ç¡®æŒ‡å®šå…·ä½“ç±»   </p>
</blockquote>
<hr>
<span id="more"></span>

<p><img src="/2021/03/23/design/factory01/1.png"></p>
<h4 id="è¦è§£å†³çš„é—®é¢˜-ç”¨é€”"><a href="#è¦è§£å†³çš„é—®é¢˜-ç”¨é€”" class="headerlink" title="è¦è§£å†³çš„é—®é¢˜/ç”¨é€”"></a>è¦è§£å†³çš„é—®é¢˜/ç”¨é€”</h4><ul>
<li>å½“åˆ›å»ºé€»è¾‘æ¯”è¾ƒå¤æ‚ï¼Œæ˜¯ä¸€ä¸ªâ€œå¤§å·¥ç¨‹â€çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±è€ƒè™‘ä½¿ç”¨<em>å·¥å‚æ¨¡å¼</em></li>
<li>å°è£…å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹ï¼Œå°†å¯¹è±¡çš„åˆ›å»ºå’Œä½¿ç”¨ç›¸åˆ†ç¦»</li>
<li>ä»£ç ä¸­å­˜åœ¨<code>if-else</code>åˆ†æ”¯åˆ¤æ–­ï¼ŒåŠ¨æ€åœ°æ ¹æ®ä¸åŒçš„ç±»å‹åˆ›å»ºä¸åŒçš„å¯¹è±¡ã€‚å°†è¿™ä¸€å¤§å¨<code>if-else</code>åˆ›å»ºå¯¹è±¡çš„ä»£ç æŠ½ç¦»å‡ºæ¥ï¼Œæ”¾åˆ°å·¥å‚ç±»ä¸­.</li>
<li>å°½ç®¡æˆ‘ä»¬ä¸éœ€è¦æ ¹æ®ä¸åŒçš„ç±»å‹åˆ›å»ºä¸åŒçš„å¯¹è±¡ï¼Œä½†æ˜¯ï¼Œå•ä¸ªå¯¹è±¡æœ¬èº«çš„åˆ›å»ºè¿‡ç¨‹æ¯”è¾ƒå¤æ‚ï¼Œ<br>æ¯”å¦‚è¦ç»„åˆå…¶ä»–ç±»å¯¹è±¡ï¼Œåšå„ç§åˆå§‹åŒ–æ“ä½œã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è€ƒè™‘ä½¿ç”¨<em>å·¥å‚æ¨¡å¼</em>ï¼Œå°†å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹å°è£…åˆ°å·¥å‚ç±»ä¸­</li>
</ul>
<hr>
<h4 id="å¦‚ä½•å®ç°"><a href="#å¦‚ä½•å®ç°" class="headerlink" title="å¦‚ä½•å®ç°"></a>å¦‚ä½•å®ç°</h4><h5 id="1-ç®€å•å·¥å‚æ¨¡å¼-Simple-Factory-Pattern"><a href="#1-ç®€å•å·¥å‚æ¨¡å¼-Simple-Factory-Pattern" class="headerlink" title="1,ç®€å•å·¥å‚æ¨¡å¼(Simple Factory Pattern)"></a>1,ç®€å•å·¥å‚æ¨¡å¼(Simple Factory Pattern)</h5> <div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">ç®€å•å·¥å‚æ¨¡å¼1(Simple Factory Pattern)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;errors&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">ç®€å•å·¥å‚æ¨¡å¼1(Simple Factory Pattern)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> rcpFactory1 *RuleConfigParserFactory1</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Load1</span><span class="params">(configFormat <span class="keyword">string</span>)</span> <span class="params">(RuleConfig, error)</span></span> &#123;</span><br><span class="line">	parser, err := rcpFactory1.createParser(configFormat)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">var</span> text <span class="keyword">string</span></span><br><span class="line">	<span class="comment">// load form config file</span></span><br><span class="line">	<span class="keyword">return</span> parser.Parse(text)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç®€å•å·¥å‚æ¨¡å¼1</span></span><br><span class="line"><span class="keyword">type</span> RuleConfigParserFactory1 <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *RuleConfigParserFactory1)</span> <span class="title">createParser</span><span class="params">(configFormat <span class="keyword">string</span>)</span> <span class="params">(IRuleConfigParser, error)</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> parser IRuleConfigParser</span><br><span class="line">	<span class="keyword">if</span> configFormat == <span class="string">&quot;json&quot;</span> &#123;</span><br><span class="line">		parser = &amp;JsonRuleConfigParser&#123;&#125;</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> configFormat == <span class="string">&quot;xml&quot;</span> &#123;</span><br><span class="line">		parser = &amp;XmlRuleConfigParser&#123;&#125;</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> configFormat == <span class="string">&quot;yml&quot;</span> &#123;</span><br><span class="line">		parser = &amp;YamlRuleConfigParser&#123;&#125;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, errors.New(<span class="string">&quot;configFormat invalid&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> parser, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> IRuleConfigParser <span class="keyword">interface</span> &#123;</span><br><span class="line">	Parse(text <span class="keyword">string</span>) (RuleConfig, error)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> JsonRuleConfigParser <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(j *JsonRuleConfigParser)</span> <span class="title">Parse</span><span class="params">(text <span class="keyword">string</span>)</span> <span class="params">(RuleConfig, error)</span></span> &#123;</span><br><span class="line">	<span class="built_in">panic</span>(<span class="string">&quot;implement me&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> YamlRuleConfigParser <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(y *YamlRuleConfigParser)</span> <span class="title">Parse</span><span class="params">(text <span class="keyword">string</span>)</span> <span class="params">(RuleConfig, error)</span></span> &#123;</span><br><span class="line">	<span class="built_in">panic</span>(<span class="string">&quot;implement me&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> XmlRuleConfigParser <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(x *XmlRuleConfigParser)</span> <span class="title">Parse</span><span class="params">(text <span class="keyword">string</span>)</span> <span class="params">(RuleConfig, error)</span></span> &#123;</span><br><span class="line">	<span class="built_in">panic</span>(<span class="string">&quot;implement me&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> RuleConfig <span class="keyword">interface</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
<p>è¿˜æœ‰ä¸€ç§ç®€å•å·¥å‚æ¨¡å¼çš„å®ç°,å’Œå•ä¾‹æ¨¡å¼ç›¸ç»“åˆ</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;errors&quot;</span></span><br><span class="line">	<span class="string">&quot;strings&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">ç®€å•å·¥å‚æ¨¡å¼2(Simple Factory Pattern)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> rcpFactory2 = &amp;RuleConfigParserFactory2&#123;</span><br><span class="line">	cacheParsers: <span class="keyword">map</span>[<span class="keyword">string</span>]IRuleConfigParser&#123;</span><br><span class="line">		<span class="string">&quot;json&quot;</span>: &amp;JsonRuleConfigParser&#123;&#125;,</span><br><span class="line">		<span class="string">&quot;xml&quot;</span>:  &amp;XmlRuleConfigParser&#123;&#125;,</span><br><span class="line">		<span class="string">&quot;yaml&quot;</span>: &amp;YamlRuleConfigParser&#123;&#125;,</span><br><span class="line">	&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Load2</span><span class="params">(configFormat <span class="keyword">string</span>)</span> <span class="params">(RuleConfig, error)</span></span> &#123;</span><br><span class="line">	parser, err := rcpFactory2.createParser(configFormat)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">var</span> text <span class="keyword">string</span></span><br><span class="line">	<span class="comment">// load form config file</span></span><br><span class="line">	<span class="keyword">return</span> parser.Parse(text)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç®€å•å·¥å‚æ¨¡å¼2</span></span><br><span class="line"><span class="keyword">type</span> RuleConfigParserFactory2 <span class="keyword">struct</span> &#123;</span><br><span class="line">	cacheParsers <span class="keyword">map</span>[<span class="keyword">string</span>]IRuleConfigParser</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *RuleConfigParserFactory2)</span> <span class="title">createParser</span><span class="params">(configFormat <span class="keyword">string</span>)</span> <span class="params">(IRuleConfigParser, error)</span></span> &#123;</span><br><span class="line">	configFormat = strings.ToLower(configFormat)</span><br><span class="line">	parser, ok := r.cacheParsers[configFormat]</span><br><span class="line">	<span class="keyword">if</span> !ok &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, errors.New(<span class="string">&quot;configFormat invalid&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> parser, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
<blockquote>
<p>ç®€å•å·¥å‚æ¨¡å¼æ€»ç»“ï¼šå°½ç®¡ç®€å•å·¥å‚æ¨¡å¼çš„ä»£ç å®ç°ä¸­ï¼Œæœ‰å¤šå¤„ifåˆ†æ”¯åˆ¤æ–­é€»è¾‘ï¼Œè¿èƒŒå¼€é—­åŸåˆ™ï¼Œ<br>  ä½†æƒè¡¡æ‰©å±•æ€§å’Œå¯è¯»æ€§ï¼Œè¿™æ ·çš„ä»£ç å®ç°åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ˆæ¯”å¦‚ï¼Œä¸éœ€è¦é¢‘ç¹åœ°æ·»åŠ parserï¼Œä¹Ÿæ²¡æœ‰å¤ªå¤šçš„parserï¼‰<br>  æ˜¯æ²¡æœ‰é—®é¢˜çš„</p>
</blockquote>
<h5 id="2-å·¥å‚æ–¹æ³•ï¼ˆFactory-Methodï¼‰"><a href="#2-å·¥å‚æ–¹æ³•ï¼ˆFactory-Methodï¼‰" class="headerlink" title="2,å·¥å‚æ–¹æ³•ï¼ˆFactory Methodï¼‰"></a>2,å·¥å‚æ–¹æ³•ï¼ˆFactory Methodï¼‰</h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;errors&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">å·¥å‚æ–¹æ³•1ï¼ˆFactory Methodï¼‰,è¿™ç§è®¾è®¡å¯ä»¥åœ¨å½“æˆ‘ä»¬æ–°å¢ä¸€ç§parserçš„æ—¶å€™ï¼Œåªéœ€è¦æ–°å¢ä¸€ä¸ªå®ç°äº†IRuleConfigParserFactoryæ¥å£çš„Factoryç±»å³å¯ã€‚</span></span><br><span class="line"><span class="comment"> æ‰€ä»¥ï¼Œå·¥å‚æ–¹æ³•æ¨¡å¼æ¯”èµ·ç®€å•å·¥å‚æ¨¡å¼æ›´åŠ ç¬¦åˆå¼€é—­åŸåˆ™</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">var</span> rcpFactory1 *RuleConfigParserFactory1</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Load1</span><span class="params">(configFormat <span class="keyword">string</span>)</span> <span class="params">(RuleConfig, error)</span></span> &#123;</span><br><span class="line">	factory, err := rcpFactory1.getFactory(configFormat)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">	&#125;</span><br><span class="line">	parser := factory.CreateParser()</span><br><span class="line">	<span class="keyword">var</span> text <span class="keyword">string</span></span><br><span class="line">	<span class="comment">// load form config file</span></span><br><span class="line">	<span class="keyword">return</span> parser.Parse(text)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç®€å•å·¥å‚æ¨¡å¼1</span></span><br><span class="line"><span class="keyword">type</span> RuleConfigParserFactory1 <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *RuleConfigParserFactory1)</span> <span class="title">getFactory</span><span class="params">(configFormat <span class="keyword">string</span>)</span> <span class="params">(IRuleConfigParserFactory, error)</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> factory RuleConfigParseFactory</span><br><span class="line">	<span class="keyword">if</span> configFormat == <span class="string">&quot;json&quot;</span> &#123;</span><br><span class="line">		factory = &amp;JsonRuleConfigParserFactory&#123;&#125;</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> configFormat == <span class="string">&quot;xml&quot;</span> &#123;</span><br><span class="line">		factory = &amp;XmlRuleConfigParserFactory&#123;&#125;</span><br><span class="line">	&#125; <span class="keyword">else</span> <span class="keyword">if</span> configFormat == <span class="string">&quot;yml&quot;</span> &#123;</span><br><span class="line">		factory = &amp;YamlRuleConfigParserFactory&#123;&#125;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, errors.New(<span class="string">&quot;configFormat invalid&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> factory, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> IRuleConfigParserFactory <span class="keyword">interface</span> &#123;</span><br><span class="line">	CreateParser() IRuleConfigParser</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> JsonRuleConfigParserFactory <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(j *JsonRuleConfigParserFactory)</span> <span class="title">CreateParser</span><span class="params">()</span> <span class="title">IRuleConfigParser</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;JsonRuleConfigParser&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> YamlRuleConfigParserFactory <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(j *YamlRuleConfigParserFactory)</span> <span class="title">CreateParser</span><span class="params">()</span> <span class="title">IRuleConfigParser</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;YamlRuleConfigParser&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> XmlRuleConfigParserFactory <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(j *XmlRuleConfigParserFactory)</span> <span class="title">CreateParser</span><span class="params">()</span> <span class="title">IRuleConfigParser</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;XmlRuleConfigParser&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> IRuleConfigParser <span class="keyword">interface</span> &#123;</span><br><span class="line">	Parse(text <span class="keyword">string</span>) (RuleConfig, error)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> JsonRuleConfigParser <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(j *JsonRuleConfigParser)</span> <span class="title">Parse</span><span class="params">(text <span class="keyword">string</span>)</span> <span class="params">(RuleConfig, error)</span></span> &#123;</span><br><span class="line">	<span class="built_in">panic</span>(<span class="string">&quot;implement me&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> YamlRuleConfigParser <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(y *YamlRuleConfigParser)</span> <span class="title">Parse</span><span class="params">(text <span class="keyword">string</span>)</span> <span class="params">(RuleConfig, error)</span></span> &#123;</span><br><span class="line">	<span class="built_in">panic</span>(<span class="string">&quot;implement me&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> XmlRuleConfigParser <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(x *XmlRuleConfigParser)</span> <span class="title">Parse</span><span class="params">(text <span class="keyword">string</span>)</span> <span class="params">(RuleConfig, error)</span></span> &#123;</span><br><span class="line">	<span class="built_in">panic</span>(<span class="string">&quot;implement me&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> RuleConfig <span class="keyword">interface</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
<p>è€ƒè™‘åˆ°å·¥å‚ç±»åªåŒ…å«æ–¹æ³•ï¼Œä¸åŒ…å«æˆå‘˜å˜é‡ï¼Œæ‰€ä»¥å®Œå…¨å¯ä»¥å¤ç”¨ï¼Œäºæ˜¯æœ‰äº†å·¥å‚æ–¹æ³•æ¨¡å¼çš„å¦å¤–ä¸€ç§å®ç°ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;errors&quot;</span></span><br><span class="line">	<span class="string">&quot;strings&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> å·¥å‚æ–¹æ³•2ï¼ˆFactory Methodï¼‰</span></span><br><span class="line"><span class="comment"> å·¥å‚æ–¹æ³•1ä¸­,å·¥å‚ç±»å¯¹è±¡çš„åˆ›å»ºé€»è¾‘åˆè€¦åˆè¿›äº†load()å‡½æ•°ä¸­ï¼Œ</span></span><br><span class="line"><span class="comment"> è·Ÿæˆ‘ä»¬æœ€åˆçš„ç®€å•å·¥å‚æ¨¡å¼1éå¸¸ç›¸ä¼¼ï¼Œå¼•å…¥å·¥å‚æ–¹æ³•éä½†æ²¡æœ‰è§£å†³é—®é¢˜ï¼Œåå€’è®©è®¾è®¡å˜å¾—æ›´åŠ å¤æ‚äº†</span></span><br><span class="line"><span class="comment"> è§£å†³åŠæ³•ï¼š</span></span><br><span class="line"><span class="comment"> æˆ‘ä»¬å¯ä»¥ä¸ºå·¥å‚ç±»å†åˆ›å»ºä¸€ä¸ªç®€å•å·¥å‚ï¼Œä¹Ÿå°±æ˜¯å·¥å‚çš„å·¥å‚ï¼Œç”¨æ¥åˆ›å»ºå·¥å‚ç±»å¯¹è±¡ã€‚</span></span><br><span class="line"><span class="comment"> RuleConfigParserFactory2ï¼Œ</span></span><br><span class="line"><span class="comment"> getFactory()è¿”å›çš„æ˜¯ç¼“å­˜å¥½çš„å•ä¾‹å·¥å‚å¯¹è±¡</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">var</span> rcpFactory2 = &amp;RuleConfigParserFactory2&#123;</span><br><span class="line">	m: <span class="keyword">map</span>[<span class="keyword">string</span>]RuleConfigParseFactory&#123;</span><br><span class="line">		<span class="string">&quot;json&quot;</span>: &amp;JsonRuleConfigParserFactory&#123;&#125;,</span><br><span class="line">		<span class="string">&quot;xml&quot;</span>:  &amp;XmlRuleConfigParserFactory&#123;&#125;,</span><br><span class="line">		<span class="string">&quot;yaml&quot;</span>: &amp;YamlRuleConfigParserFactory&#123;&#125;,</span><br><span class="line">	&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Load2</span><span class="params">(configFormat <span class="keyword">string</span>)</span> <span class="params">(RuleConfig, error)</span></span> &#123;</span><br><span class="line">	factory, err := rcpFactory2.getFactory(configFormat)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">	&#125;</span><br><span class="line">	parser := factory.CreateParser()</span><br><span class="line">	<span class="keyword">var</span> text <span class="keyword">string</span></span><br><span class="line">	<span class="comment">// load form config file</span></span><br><span class="line">	<span class="keyword">return</span> parser.Parse(text)</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç®€å•å·¥å‚æ¨¡å¼2</span></span><br><span class="line"><span class="keyword">type</span> RuleConfigParserFactory2 <span class="keyword">struct</span> &#123;</span><br><span class="line">	m <span class="keyword">map</span>[<span class="keyword">string</span>]RuleConfigParseFactory</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *RuleConfigParserFactory2)</span> <span class="title">getFactory</span><span class="params">(configFormat <span class="keyword">string</span>)</span> <span class="params">(RuleConfigParseFactory, error)</span></span> &#123;</span><br><span class="line">	configFormat = strings.ToLower(configFormat)</span><br><span class="line">	factory, ok := r.m[configFormat]</span><br><span class="line">	<span class="keyword">if</span> !ok &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, errors.New(<span class="string">&quot;configFormat invalid&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> factory, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
<blockquote>
<p>å·¥å‚æ–¹æ³•æ¨¡å¼æ€»ç»“:å¯¹äºè§„åˆ™é…ç½®æ–‡ä»¶è§£æè¿™ä¸ªåº”ç”¨åœºæ™¯æ¥è¯´ï¼Œå·¥å‚æ¨¡å¼éœ€è¦é¢å¤–åˆ›å»ºè¯¸å¤šFactoryç±»ï¼Œ<br>  ä¹Ÿä¼šå¢åŠ ä»£ç çš„å¤æ‚æ€§ï¼Œè€Œä¸”ï¼Œæ¯ä¸ªFactoryç±»åªæ˜¯åšç®€å•çš„newæ“ä½œï¼ŒåŠŸèƒ½éå¸¸å•è–„ï¼ˆåªæœ‰ä¸€è¡Œä»£ç ï¼‰ï¼Œ<br>  ä¹Ÿæ²¡å¿…è¦è®¾è®¡æˆç‹¬ç«‹çš„ç±»ï¼Œæ‰€ä»¥ï¼Œåœ¨è¿™ä¸ªåº”ç”¨åœºæ™¯ä¸‹ï¼Œç®€å•å·¥å‚æ¨¡å¼ç®€å•å¥½ç”¨ï¼Œæ¯”å·¥å‚æ–¹æ³•æ¨¡å¼æ›´åŠ åˆé€‚</p>
</blockquote>
<h4 id="æŠ½è±¡å·¥å‚ï¼ˆAbstract-Factoryï¼‰"><a href="#æŠ½è±¡å·¥å‚ï¼ˆAbstract-Factoryï¼‰" class="headerlink" title="æŠ½è±¡å·¥å‚ï¼ˆAbstract Factoryï¼‰"></a>æŠ½è±¡å·¥å‚ï¼ˆAbstract Factoryï¼‰</h4><blockquote>
<p>ä¸€ä¸ªfactoryæ¥å£åˆ›å»ºå¤šä¸ªparser<br> <div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">æŠ½è±¡å·¥å‚ï¼ˆAbstract Factoryï¼‰</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">type</span> IconfigParserFactory <span class="keyword">interface</span> &#123;</span><br><span class="line">	CreateRuleParser()</span><br><span class="line">	CreateSystemParser()</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div></p>
</blockquote>
]]></content>
      <categories>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title>å¸¸ç”¨é™æµç®—æ³•ä»‹ç»åŠæºç åˆ†æ</title>
    <url>/2021/05/26/uncatalog/ckv998l9x001mv0r7ggr51u53/</url>
    <content><![CDATA[<p>æ¼æ¡¶å’Œä»¤ç‰Œæ¡¶<br><a href="https://zhuanlan.zhihu.com/p/197402205">https://zhuanlan.zhihu.com/p/197402205</a></p>
<p>è¿‡è½½ä¿æŠ¤<br><img src="/2021/05/26/uncatalog/ckv998l9x001mv0r7ggr51u53/img.png" alt="img.png"></p>
]]></content>
      <tags>
        <tag>golang</tag>
      </tags>
  </entry>
  <entry>
    <title>éå¯¹ç§°åŠ å¯†</title>
    <url>/2021/05/06/go-practice/Asymmetric_Encryption_practice01/</url>
    <content><![CDATA[<h5 id="ä»ä¸€ä¸ªæ•…äº‹å¼€å§‹ï¼š"><a href="#ä»ä¸€ä¸ªæ•…äº‹å¼€å§‹ï¼š" class="headerlink" title="ä»ä¸€ä¸ªæ•…äº‹å¼€å§‹ï¼š"></a>ä»ä¸€ä¸ª<a href="http://www.youdzone.com/signature.html" title="Markdown">æ•…äº‹</a>å¼€å§‹ï¼š</h5><p>æˆ‘æ¥ç¿»è¯‘ä¸€ä¸‹è¿™ä¸ªæ•…äº‹ï¼š</p>
<span id="more"></span>
<p><img src="/2021/05/06/go-practice/Asymmetric_Encryption_practice01/1.png"><br>æ•…äº‹çš„ä¸»äººå…¬æ˜¯ Bobï¼Œä»–æœ‰ä¸‰ä¸ªå¥½æœ‹å‹ Patã€Doug å’Œ Susanã€‚<br>Bob ç»å¸¸è·Ÿä»–ä»¬å†™ä¿¡ï¼Œå› ä¸ºä»–çš„ä¿¡æ˜¯æ˜æ–‡ä¼ è¾“çš„ï¼Œåœ¨ä¼ é€’è¿‡ç¨‹å¯èƒ½è¢«äººæˆªè·å·çª¥ï¼Œ<br>ä¹Ÿå¯èƒ½è¢«äººæˆªè·ç„¶ååˆç¯¡æ”¹äº†ï¼Œæ›´æœ‰å¯èƒ½åˆ«äººä¼ªè£…æˆ Bob æœ¬äººè·Ÿä»–çš„å¥½æœ‹å‹é€šä¿¡ï¼Œ<br>æ€»ä¹‹æ˜¯ä¸å®‰å…¨çš„ã€‚ä»–å¾ˆè‹¦æ¼ï¼Œç»è¿‡ä¸€ç•ªè‹¦è‹¦æ¢ç´¢ï¼Œè¯¶ï¼Œä»–å‘ç°è®¡ç®—æœºå®‰å…¨å­¦é‡Œæœ‰ä¸€ç§å«éå¯¹ç§°åŠ å¯†ç®—æ³•çš„ä¸œä¸œï¼Œ<br>å¥½åƒå¯ä»¥å¸®åŠ©ä»–è§£å†³è¿™ä¸ªé—®é¢˜</p>
<p>è¯´æ˜ï¼šéå¯¹ç§°åŠ å¯†ç®—æ³•ï¼ˆRSAï¼‰æ˜¯å†…å®¹åŠ å¯†çš„ä¸€ç±»ç®—æ³•ï¼Œ<br>å®ƒæœ‰ä¸¤ä¸ªç§˜é’¥ï¼šå…¬é’¥ä¸ç§é’¥ã€‚å…¬é’¥æ˜¯å…¬å¼€çš„é’¥åŒ™ï¼Œæ‰€æœ‰äººéƒ½å¯ä»¥çŸ¥é“ï¼Œ<br>ç§é’¥æ˜¯ä¿å¯†çš„ï¼Œåªæœ‰æŒæœ‰è€…çŸ¥é“ã€‚é€šè¿‡å…¬é’¥åŠ å¯†çš„å†…å®¹ï¼Œåªèƒ½é€šè¿‡ç§é’¥è§£å¼€ã€‚<br>éå¯¹ç§°åŠ å¯†ç®—æ³•çš„å®‰å…¨æ€§å¾ˆé«˜ï¼Œä½†æ˜¯å› ä¸ºè®¡ç®—é‡åºå¤§ï¼Œæ¯”è¾ƒæ¶ˆè€—æ€§èƒ½ã€‚ å¥½äº†ï¼Œæ¥çœ‹çœ‹ Bob æ˜¯æ€ä¹ˆåº”ç”¨éå¯¹ç§°åŠ å¯†ç®—æ³•ä¸ä»–çš„å¥½æœ‹å‹é€šä¿¡çš„ï¼š 1ã€é¦–å…ˆ Bob å¼„åˆ°äº†ä¸¤æŠŠé’¥åŒ™ï¼šå…¬é’¥å’Œç§é’¥ï¼›<br><img src="/2021/05/06/go-practice/Asymmetric_Encryption_practice01/01.png"><br>2ã€Bob è‡ªå·±ä¿ç•™ä¸‹äº†ç§é’¥ï¼ŒæŠŠå…¬é’¥å¤åˆ¶æˆä¸‰ä»½é€ç»™äº†ä»–çš„ä¸‰ä¸ªå¥½æœ‹å‹ Patã€Doug å’Œ Susanï¼›<br><img src="/2021/05/06/go-practice/Asymmetric_Encryption_practice01/2.png"><br>3ã€æ­¤æ—¶ï¼ŒBob æ€»ç®—å¯ä»¥å®‰å¿ƒåœ°å’Œä»–çš„å¥½æœ‹å‹æ„‰å¿«åœ°é€šä¿¡äº†ã€‚<br>æ¯”å¦‚ Susan è¦å’Œä»–è®¨è®ºå…³äºå»å“ªåƒåˆé¥­çš„äº‹æƒ…ï¼Œ<br>Susan å°±å¯ä»¥å…ˆæŠŠè‡ªå·±çš„å†…å®¹ï¼ˆæ˜æ–‡ï¼‰é¦–å…ˆç”¨ Bob é€ç»™ä»–çš„å…¬é’¥åšä¸€æ¬¡åŠ å¯†ï¼Œç„¶åæŠŠåŠ å¯†çš„å†…å®¹ä¼ é€ç»™ Bobã€‚<br>Bob æ”¶åˆ°ä¿¡åï¼Œå†ç”¨è‡ªå·±çš„ç§é’¥è§£å¼€ä¿¡çš„å†…å®¹ï¼›<br><img src="/2021/05/06/go-practice/Asymmetric_Encryption_practice01/3.png"><br>è¯´æ˜ï¼šè¿™å…¶å®æ˜¯è®¡ç®—æœºå®‰å…¨å­¦é‡ŒåŠ å¯†çš„æ¦‚å¿µï¼ŒåŠ å¯†çš„ç›®çš„æ˜¯ä¸ºäº†ä¸è®©åˆ«äººçœ‹åˆ°ä¼ é€çš„å†…å®¹ï¼Œ<br>åŠ å¯†çš„æ‰‹æ®µæ˜¯é€šè¿‡ä¸€å®šçš„åŠ å¯†ç®—æ³•åŠçº¦å®šçš„å¯†é’¥è¿›è¡Œçš„ï¼ˆæ¯”å¦‚ä¸Šè¿°ç”¨äº†éå¯¹ç§°åŠ å¯†ç®—æ³•ä»¥åŠ Bob çš„å…¬é’¥ï¼‰ï¼Œ<br>è€Œè§£å¯†åˆ™éœ€è¦ç›¸å…³çš„è§£å¯†ç®—æ³•åŠçº¦å®šçš„ç§˜é’¥ï¼ˆå¦‚ä¸Šè¿°ç”¨äº†éå¯¹ç§°åŠ å¯†ç®—æ³•å’Œ Bob è‡ªå·±çš„ç§é’¥ï¼‰ï¼Œ<br>å¯ä»¥çœ‹å‡ºåŠ å¯†æ˜¯å¯é€†çš„ï¼ˆå¯è§£å¯†çš„ï¼‰ã€‚</p>
<p>4ã€Bob çœ‹å®Œä¿¡åï¼Œå†³å®šç»™ Susan å›ä¸€å°ä¿¡ã€‚<br>ä¸ºäº†é˜²æ­¢ä¿¡çš„å†…å®¹è¢«ç¯¡æ”¹ï¼ˆæˆ–è€…åˆ«äººä¼ªè£…æˆä»–çš„èº«ä»½è·Ÿ Susan é€šä¿¡ï¼‰ï¼Œ<br>ä»–å†³å®šå…ˆå¯¹ä¿¡çš„å†…å®¹ç”¨ hash ç®—æ³•åšä¸€æ¬¡å¤„ç†ï¼Œå¾—åˆ°ä¸€ä¸ªå­—ç¬¦ä¸²å“ˆå¸Œå€¼ï¼Œ<br>Bob åˆç”¨è‡ªå·±çš„ç§é’¥å¯¹å“ˆå¸Œå€¼åšäº†ä¸€æ¬¡åŠ å¯†å¾—åˆ°ä¸€ä¸ªç­¾åï¼Œ<br>ç„¶åæŠŠç­¾åå’Œä¿¡ï¼ˆæ˜æ–‡çš„ï¼‰ä¸€èµ·å‘é€ç»™ Susanï¼›<br><img src="/2021/05/06/go-practice/Asymmetric_Encryption_practice01/4.png"><br><img src="/2021/05/06/go-practice/Asymmetric_Encryption_practice01/5.png"><br><img src="/2021/05/06/go-practice/Asymmetric_Encryption_practice01/6.png"><br>è¯´æ˜ 2ï¼šBob çš„å†…å®¹å®è´¨æ˜¯æ˜æ–‡ä¼ è¾“çš„ï¼Œæ‰€ä»¥è¿™ä¸ªè¿‡ç¨‹æ˜¯å¯ä»¥è¢«äººæˆªè·å’Œçª¥æ¢çš„ï¼Œ<br>ä½†æ˜¯ Bob ä¸æ‹…å¿ƒè¢«äººçª¥æ¢ï¼Œä»–æ‹…å¿ƒçš„æ˜¯å†…å®¹è¢«äººç¯¡æ”¹æˆ–è€…æœ‰äººå†’å……è‡ªå·±è·Ÿ Susan é€šä¿¡ã€‚<br>è¿™é‡Œå…¶å®æ¶‰åŠåˆ°äº†è®¡ç®—æœºå®‰å…¨å­¦ä¸­çš„è®¤è¯æ¦‚å¿µï¼ŒBob è¦å‘ Susan è¯æ˜é€šä¿¡çš„å¯¹æ–¹æ˜¯ Bob æœ¬äººï¼Œ<br>å¦å¤–ä¹Ÿéœ€è¦ç¡®ä¿è‡ªå·±çš„å†…å®¹æ˜¯å®Œæ•´çš„ã€‚<br>5ã€Susan æ¥æ”¶åˆ°äº† Bob çš„ä¿¡ï¼Œé¦–å…ˆç”¨ Bob ç»™çš„å…¬é’¥å¯¹ç­¾åä½œäº†è§£å¯†å¤„ç†ï¼Œ<br>å¾—åˆ°äº†å“ˆå¸Œå€¼ Aï¼Œç„¶å Susan ç”¨äº†åŒæ ·çš„ Hash ç®—æ³•å¯¹ä¿¡çš„å†…å®¹ä½œäº†ä¸€æ¬¡å“ˆå¸Œå¤„ç†ï¼Œ<br>å¾—åˆ°å¦å¤–ä¸€ä¸ªå“ˆå¸Œå€¼ Bï¼Œå¯¹æ¯” A å’Œ Bï¼Œå¦‚æœè¿™ä¸¤ä¸ªå€¼æ˜¯ç›¸åŒçš„ï¼Œé‚£ä¹ˆå¯ä»¥ç¡®è®¤ä¿¡å°±æ˜¯ Bob æœ¬äººå†™çš„ï¼Œå¹¶ä¸”å†…å®¹æ²¡æœ‰è¢«ç¯¡æ”¹è¿‡ï¼›<br><img src="/2021/05/06/go-practice/Asymmetric_Encryption_practice01/7.png"><br>è¯´æ˜ï¼š4 è·Ÿ 5 å…¶å®æ„æˆäº†ä¸€æ¬¡å®Œæ•´çš„é€šè¿‡æ•°å­—ç­¾åè¿›è¡Œè®¤è¯çš„è¿‡ç¨‹ã€‚<br>æ•°å­—ç­¾åçš„è¿‡ç¨‹ç®€è¿°ä¸ºï¼šå‘é€æ–¹é€šè¿‡ä¸å¯é€†ç®—æ³•å¯¹å†…å®¹ text1 è¿›è¡Œå¤„ç†ï¼ˆå“ˆå¸Œï¼‰ï¼Œ<br>å¾—åˆ°çš„ç»“æœå€¼ hash1ï¼Œç„¶åç”¨ç§é’¥åŠ å¯† hash1 å¾—åˆ°ç»“æœå€¼ encry1ã€‚<br>å¯¹æ–¹æ¥æ”¶ text1 å’Œ encry1ï¼Œç”¨å…¬é’¥è§£å¯† encry1 å¾—åˆ° hash1ï¼Œ<br>ç„¶åç”¨ text1 è¿›è¡ŒåŒç­‰çš„ä¸å¯é€†å¤„ç†å¾—åˆ° hash2ï¼Œå¯¹ hash1 å’Œ hash2 è¿›è¡Œå¯¹æ¯”å³å¯è®¤è¯å‘é€æ–¹ã€‚<br>6ã€æ­¤æ—¶ï¼Œå¦å¤–ä¸€ç§æ¯”è¾ƒå¤æ‚å‡ºç°äº†ï¼ŒBob æ˜¯é€šè¿‡ç½‘ç»œæŠŠå…¬é’¥å¯„é€ç»™ä»–çš„ä¸‰ä¸ªå¥½æœ‹å‹çš„ï¼Œ<br>æœ‰ä¸€ä¸ªä¸æ€€å¥½æ„çš„å®¶ä¼™ Jerry æˆªè·äº† Bob ç»™ Doug çš„å…¬é’¥ã€‚<br>Jerry å¼€å§‹ä¼ªè£…æˆ Bob è·Ÿ Doug é€šä¿¡ï¼ŒDoug æ„Ÿè§‰é€šä¿¡çš„å¯¹è±¡ä¸åƒæ˜¯ Bobï¼Œä½†æ˜¯ä»–åˆæ— æ³•ç¡®è®¤ï¼›<br><img src="/2021/05/06/go-practice/Asymmetric_Encryption_practice01/8.png"><br>7ã€Bob æœ€ç»ˆå‘ç°äº†è‡ªå·±çš„å…¬é’¥è¢« Jerry æˆªè·äº†ï¼Œ<br>ä»–æ„Ÿè§‰è‡ªå·±çš„å…¬é’¥é€šè¿‡ç½‘ç»œä¼ è¾“ç»™è‡ªå·±çš„å°ä¼™ä¼´ä¼¼ä¹ä¹Ÿæ˜¯ä¸å®‰å…¨çš„ï¼Œ<br>ä¸æ€€å¥½æ„çš„å®¶ä¼™å¯ä»¥æˆªè·è¿™ä¸ªæ˜æ–‡ä¼ è¾“çš„å…¬é’¥ã€‚<br>ä¸ºæ­¤ä»–æƒ³åˆ°äº†å»ç¬¬ä¸‰æ–¹æƒå¨æœºæ„â€è¯ä¹¦ä¸­å¿ƒâ€ï¼ˆcertificate authorityï¼Œç®€ç§° CAï¼‰åšè®¤è¯ã€‚<br>è¯ä¹¦ä¸­å¿ƒç”¨è‡ªå·±çš„ç§é’¥å¯¹ Bob çš„å…¬é’¥å’Œå…¶å®ƒä¿¡æ¯åšäº†ä¸€æ¬¡åŠ å¯†ã€‚<br>è¿™æ · Bob é€šè¿‡ç½‘ç»œå°†æ•°å­—è¯ä¹¦ä¼ é€’ç»™ä»–çš„å°ä¼™ä¼´åï¼Œå°ä¼™ä¼´ä»¬å…ˆç”¨ CA ç»™çš„å…¬é’¥è§£å¯†è¯ä¹¦ï¼Œè¿™æ ·å°±å¯ä»¥å®‰å…¨è·å– Bob çš„å…¬é’¥äº†ã€‚<br><img src="/2021/05/06/go-practice/Asymmetric_Encryption_practice01/9.png">  </p>
<h5 id="éå¯¹ç§°åŠ å¯†å®¹æ˜“è¯¯è§£çš„ä¸€ä¸ªç‚¹â€“å…¬é’¥å’Œç§é’¥åˆ°åº•å“ªä¸ªæ‰æ˜¯ç”¨æ¥åŠ å¯†å’Œå“ªä¸ªç”¨æ¥è§£å¯†ï¼š"><a href="#éå¯¹ç§°åŠ å¯†å®¹æ˜“è¯¯è§£çš„ä¸€ä¸ªç‚¹â€“å…¬é’¥å’Œç§é’¥åˆ°åº•å“ªä¸ªæ‰æ˜¯ç”¨æ¥åŠ å¯†å’Œå“ªä¸ªç”¨æ¥è§£å¯†ï¼š" class="headerlink" title="éå¯¹ç§°åŠ å¯†å®¹æ˜“è¯¯è§£çš„ä¸€ä¸ªç‚¹â€“å…¬é’¥å’Œç§é’¥åˆ°åº•å“ªä¸ªæ‰æ˜¯ç”¨æ¥åŠ å¯†å’Œå“ªä¸ªç”¨æ¥è§£å¯†ï¼š"></a>éå¯¹ç§°åŠ å¯†å®¹æ˜“è¯¯è§£çš„ä¸€ä¸ªç‚¹â€“<a href="https://www.zhihu.com/question/25912483" title="Markdown">å…¬é’¥å’Œç§é’¥åˆ°åº•å“ªä¸ªæ‰æ˜¯ç”¨æ¥åŠ å¯†å’Œå“ªä¸ªç”¨æ¥è§£å¯†</a>ï¼š</h5><blockquote>
<p>å…¶ä¸­ä¸€ä¸ªé«˜èµå›ç­”ï¼š<br>ä¸è¦å»ç¡¬è®°ã€‚<br>ä½ åªè¦æƒ³ï¼šæ—¢ç„¶æ˜¯åŠ å¯†ï¼Œé‚£è‚¯å®šæ˜¯ä¸å¸Œæœ›åˆ«äººçŸ¥é“æˆ‘çš„æ¶ˆæ¯ï¼Œæ‰€ä»¥åªæœ‰æˆ‘æ‰èƒ½è§£å¯†ï¼Œæ‰€ä»¥å¯å¾—å‡ºå…¬é’¥è´Ÿè´£åŠ å¯†ï¼Œç§é’¥è´Ÿè´£è§£å¯†ï¼›<br>åŒç†ï¼Œæ—¢ç„¶æ˜¯ç­¾åï¼Œé‚£è‚¯å®šæ˜¯ä¸å¸Œæœ›æœ‰äººå†’å……æˆ‘å‘æ¶ˆæ¯ï¼Œåªæœ‰æˆ‘æ‰èƒ½å‘å¸ƒè¿™ä¸ªç­¾åï¼Œæ‰€ä»¥å¯å¾—å‡ºç§é’¥è´Ÿè´£ç­¾åï¼Œå…¬é’¥è´Ÿè´£éªŒè¯ã€‚</p>
</blockquote>
<h5 id="éå¯¹ç§°åŠ å¯†çš„ä¸€ä¸ªå®ç°â€“RSAç®—æ³•ï¼š"><a href="#éå¯¹ç§°åŠ å¯†çš„ä¸€ä¸ªå®ç°â€“RSAç®—æ³•ï¼š" class="headerlink" title="éå¯¹ç§°åŠ å¯†çš„ä¸€ä¸ªå®ç°â€“RSAç®—æ³•ï¼š"></a>éå¯¹ç§°åŠ å¯†çš„ä¸€ä¸ªå®ç°â€“RSAç®—æ³•ï¼š</h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> rsa_algorithm</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;bytes&quot;</span></span><br><span class="line">	<span class="string">&quot;crypto/rand&quot;</span></span><br><span class="line">	<span class="string">&quot;crypto/rsa&quot;</span></span><br><span class="line">	<span class="string">&quot;crypto/x509&quot;</span></span><br><span class="line">	<span class="string">&quot;encoding/pem&quot;</span></span><br><span class="line">	<span class="string">&quot;errors&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GenPair</span><span class="params">(bits <span class="keyword">int</span>, passwd <span class="keyword">string</span>)</span> <span class="params">(priKey, pubKey []<span class="keyword">byte</span>, err error)</span></span> &#123;</span><br><span class="line">	<span class="comment">// ç”Ÿæˆç§é’¥</span></span><br><span class="line">	<span class="keyword">var</span> privateKey *rsa.PrivateKey</span><br><span class="line">	<span class="keyword">if</span> privateKey, err = rsa.GenerateKey(rand.Reader, bits); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	priStream := x509.MarshalPKCS1PrivateKey(privateKey)</span><br><span class="line">	block := &amp;pem.Block&#123;Type: passwd, Bytes: priStream&#125;</span><br><span class="line">	priKey = pem.EncodeToMemory(block)</span><br><span class="line">	<span class="comment">// ç”Ÿæˆå…¬é’¥</span></span><br><span class="line">	publicKey := &amp;privateKey.PublicKey</span><br><span class="line">	<span class="keyword">var</span> pubStream []<span class="keyword">byte</span></span><br><span class="line">	<span class="keyword">if</span> pubStream, err = x509.MarshalPKIXPublicKey(publicKey); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	block = &amp;pem.Block&#123;Type: passwd, Bytes: pubStream&#125;</span><br><span class="line">	pubKey = pem.EncodeToMemory(block)</span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Encrypt</span><span class="params">(pubKey, origData []<span class="keyword">byte</span>)</span> <span class="params">([]<span class="keyword">byte</span>, error)</span></span> &#123;</span><br><span class="line">	block, _ := pem.Decode(pubKey)</span><br><span class="line">	<span class="keyword">if</span> block == <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, errors.New(<span class="string">&quot;public key error&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	publicKey, err := x509.ParsePKIXPublicKey(block.Bytes)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">	&#125;</span><br><span class="line">	pub := publicKey.(*rsa.PublicKey)</span><br><span class="line">	k := (pub.N.BitLen() + <span class="number">7</span>) / <span class="number">8</span></span><br><span class="line">	partLen := k - <span class="number">11</span></span><br><span class="line">	chunks := split(origData, partLen)</span><br><span class="line">	buf := bytes.NewBuffer(<span class="built_in">make</span>([]<span class="keyword">byte</span>, <span class="number">0</span>, k))</span><br><span class="line">	<span class="keyword">for</span> _, chunk := <span class="keyword">range</span> chunks &#123;</span><br><span class="line">		bytes, err := rsa.EncryptPKCS1v15(rand.Reader, pub, chunk)</span><br><span class="line">		<span class="comment">// fmt.Println(&quot;out chunk len:&quot;, len(bytes))</span></span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> []<span class="keyword">byte</span>&#123;&#125;, err</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> _, err = buf.Write(bytes); err != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> []<span class="keyword">byte</span>&#123;&#125;, err</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> buf.Bytes(), <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Decrypt</span><span class="params">(priKey, ciphertext []<span class="keyword">byte</span>)</span> <span class="params">([]<span class="keyword">byte</span>, error)</span></span> &#123;</span><br><span class="line">	block, _ := pem.Decode(priKey)</span><br><span class="line">	<span class="keyword">if</span> block == <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, errors.New(<span class="string">&quot;private key error!&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	privateKey, err := x509.ParsePKCS1PrivateKey(block.Bytes)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">	&#125;</span><br><span class="line">	partLen := (privateKey.N.BitLen() + <span class="number">7</span>) / <span class="number">8</span></span><br><span class="line">	chunks := split([]<span class="keyword">byte</span>(ciphertext), partLen)</span><br><span class="line">	buf := bytes.NewBuffer(<span class="built_in">make</span>([]<span class="keyword">byte</span>, <span class="number">0</span>, partLen))</span><br><span class="line">	<span class="keyword">for</span> _, chunk := <span class="keyword">range</span> chunks &#123;</span><br><span class="line">		bytes, err := rsa.DecryptPKCS1v15(rand.Reader, privateKey, chunk)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> []<span class="keyword">byte</span>&#123;&#125;, err</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> _, err = buf.Write(bytes); err != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> []<span class="keyword">byte</span>&#123;&#125;, err</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> buf.Bytes(), <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">split</span><span class="params">(buf []<span class="keyword">byte</span>, lim <span class="keyword">int</span>)</span> [][]<span class="title">byte</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> chunk []<span class="keyword">byte</span></span><br><span class="line">	chunks := <span class="built_in">make</span>([][]<span class="keyword">byte</span>, <span class="number">0</span>, <span class="built_in">len</span>(buf)/lim+<span class="number">1</span>)</span><br><span class="line">	<span class="keyword">for</span> <span class="built_in">len</span>(buf) &gt;= lim &#123;</span><br><span class="line">		chunk, buf = buf[:lim], buf[lim:]</span><br><span class="line">		chunks = <span class="built_in">append</span>(chunks, chunk)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(buf) &gt; <span class="number">0</span> &#123;</span><br><span class="line">		chunks = <span class="built_in">append</span>(chunks, buf)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> chunks</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<h5 id="éå¯¹ç§°åŠ å¯†çš„ä¸€ä¸ªåº”ç”¨â€“httpsï¼š"><a href="#éå¯¹ç§°åŠ å¯†çš„ä¸€ä¸ªåº”ç”¨â€“httpsï¼š" class="headerlink" title="éå¯¹ç§°åŠ å¯†çš„ä¸€ä¸ªåº”ç”¨â€“httpsï¼š"></a>éå¯¹ç§°åŠ å¯†çš„ä¸€ä¸ªåº”ç”¨â€“httpsï¼š</h5><p>é€šè¿‡ Bob ä¸ä»–çš„å°ä¼™ä¼´çš„é€šä¿¡ï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥å¤§è‡´äº†è§£ä¸€ä¸ªå®‰å…¨é€šä¿¡çš„è¿‡ç¨‹ï¼Œ<br>ä¹Ÿå¯ä»¥äº†è§£åŸºæœ¬çš„åŠ å¯†ã€è§£å¯†ã€è®¤è¯ç­‰æ¦‚å¿µã€‚HTTPS å°±æ˜¯åŸºäºè¿™æ ·ä¸€ä¸ªé€»è¾‘è®¾è®¡çš„ã€‚<br>é¦–å…ˆçœ‹çœ‹ç»„æˆ HTTPS çš„åè®®ï¼šHTTP åè®®å’Œ SSL/TSL åè®®ã€‚<br>HTTP åè®®å°±ä¸ç”¨è®²äº†ï¼Œè€Œ SSL/TSL å°±æ˜¯è´Ÿè´£åŠ å¯†è§£å¯†ç­‰å®‰å…¨å¤„ç†çš„æ¨¡å—ï¼Œ<br>æ‰€ä»¥ HTTPS çš„æ ¸å¿ƒåœ¨ SSL/TSL ä¸Šé¢ã€‚æ•´ä¸ªé€šä¿¡å¦‚ä¸‹ï¼š   </p>
<ul>
<li>1ã€æµè§ˆå™¨å‘èµ·å¾€æœåŠ¡å™¨çš„ 443 ç«¯å£å‘èµ·è¯·æ±‚ï¼Œè¯·æ±‚æºå¸¦äº†æµè§ˆå™¨æ”¯æŒçš„åŠ å¯†ç®—æ³•å’Œå“ˆå¸Œç®—æ³•ã€‚   </li>
<li>2ã€æœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚ï¼Œé€‰æ‹©æµè§ˆå™¨æ”¯æŒçš„åŠ å¯†ç®—æ³•å’Œå“ˆå¸Œç®—æ³•ã€‚   </li>
<li>3ã€æœåŠ¡å™¨ä¸‹å°†æ•°å­—è¯ä¹¦è¿”å›ç»™æµè§ˆå™¨ï¼Œè¿™é‡Œçš„æ•°å­—è¯ä¹¦å¯ä»¥æ˜¯å‘æŸä¸ªå¯é æœºæ„ç”³è¯·çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯è‡ªåˆ¶çš„ã€‚   </li>
<li>4ã€æµè§ˆå™¨è¿›å…¥æ•°å­—è¯ä¹¦è®¤è¯ç¯èŠ‚ï¼Œè¿™ä¸€éƒ¨åˆ†æ˜¯æµè§ˆå™¨å†…ç½®çš„ TSL å®Œæˆçš„ï¼š  <ul>
<li>4.1 é¦–å…ˆæµè§ˆå™¨ä¼šä»å†…ç½®çš„è¯ä¹¦åˆ—è¡¨ä¸­ç´¢å¼•ï¼Œæ‰¾åˆ°æœåŠ¡å™¨ä¸‹å‘è¯ä¹¦å¯¹åº”çš„æœºæ„ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œæ­¤æ—¶å°±ä¼šæç¤ºç”¨æˆ·è¯¥è¯ä¹¦æ˜¯ä¸æ˜¯ç”±æƒå¨æœºæ„é¢å‘ï¼Œæ˜¯ä¸å¯ä¿¡ä»»çš„ã€‚å¦‚æœæŸ¥åˆ°äº†å¯¹åº”çš„æœºæ„ï¼Œåˆ™å–å‡ºè¯¥æœºæ„é¢å‘çš„å…¬é’¥.</li>
<li>4.2 ç”¨æœºæ„çš„è¯ä¹¦å…¬é’¥è§£å¯†å¾—åˆ°è¯ä¹¦çš„å†…å®¹å’Œè¯ä¹¦ç­¾åï¼Œå†…å®¹åŒ…æ‹¬ç½‘ç«™çš„ç½‘å€ã€ç½‘ç«™çš„å…¬é’¥ã€è¯ä¹¦çš„æœ‰æ•ˆæœŸç­‰ã€‚æµè§ˆå™¨ä¼šå…ˆéªŒè¯è¯ä¹¦ç­¾åçš„åˆæ³•æ€§ï¼ˆéªŒè¯è¿‡ç¨‹ç±»ä¼¼ä¸Šé¢ Bob å’Œ Susan çš„é€šä¿¡ï¼‰ã€‚ç­¾åé€šè¿‡åï¼Œæµè§ˆå™¨éªŒè¯è¯ä¹¦è®°å½•çš„ç½‘å€æ˜¯å¦å’Œå½“å‰ç½‘å€æ˜¯ä¸€è‡´çš„ï¼Œä¸ä¸€è‡´ä¼šæç¤ºç”¨æˆ·ã€‚å¦‚æœç½‘å€ä¸€è‡´ä¼šæ£€æŸ¥è¯ä¹¦æœ‰æ•ˆæœŸï¼Œè¯ä¹¦è¿‡æœŸäº†ä¹Ÿä¼šæç¤ºç”¨æˆ·ã€‚è¿™äº›éƒ½é€šè¿‡è®¤è¯æ—¶ï¼Œæµè§ˆå™¨å°±å¯ä»¥å®‰å…¨ä½¿ç”¨è¯ä¹¦ä¸­çš„ç½‘ç«™å…¬é’¥äº†ã€‚</li>
<li>4.3 æµè§ˆå™¨ç”Ÿæˆä¸€ä¸ªéšæœºæ•° Rï¼Œå¹¶ä½¿ç”¨ç½‘ç«™å…¬é’¥å¯¹ R è¿›è¡ŒåŠ å¯†ã€‚</li>
</ul>
</li>
<li>5ã€æµè§ˆå™¨å°†åŠ å¯†çš„ R ä¼ é€ç»™æœåŠ¡å™¨ã€‚   </li>
<li>6ã€æœåŠ¡å™¨ç”¨è‡ªå·±çš„ç§é’¥è§£å¯†å¾—åˆ° Rã€‚</li>
<li>7ã€æœåŠ¡å™¨ä»¥ R ä¸ºå¯†é’¥ä½¿ç”¨äº†å¯¹ç§°åŠ å¯†ç®—æ³•åŠ å¯†ç½‘é¡µå†…å®¹å¹¶ä¼ è¾“ç»™æµè§ˆå™¨ã€‚</li>
<li>8ã€æµè§ˆå™¨ä»¥ R ä¸ºå¯†é’¥ä½¿ç”¨ä¹‹å‰çº¦å®šå¥½çš„è§£å¯†ç®—æ³•è·å–ç½‘é¡µå†…å®¹ã€‚<br><img src="/2021/05/06/go-practice/Asymmetric_Encryption_practice01/10.png"><blockquote>
<p>å¤‡æ³¨ 1ï¼šå‰ 5 æ­¥å…¶å®å°±æ˜¯ HTTPS çš„æ¡æ‰‹è¿‡ç¨‹ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸»è¦æ˜¯è®¤è¯æœåŠ¡ç«¯è¯ä¹¦ï¼ˆå†…ç½®çš„å…¬é’¥ï¼‰çš„åˆæ³•æ€§ã€‚<br>å› ä¸ºéå¯¹ç§°åŠ å¯†è®¡ç®—é‡è¾ƒå¤§ï¼Œæ•´ä¸ªé€šä¿¡è¿‡ç¨‹åªä¼šç”¨åˆ°ä¸€æ¬¡éå¯¹ç§°åŠ å¯†ç®—æ³•ï¼ˆä¸»è¦æ˜¯ç”¨æ¥ä¿æŠ¤ä¼ è¾“å®¢æˆ·ç«¯ç”Ÿæˆçš„ç”¨äºå¯¹ç§°åŠ å¯†çš„éšæœºæ•°ç§é’¥ï¼‰ã€‚<br>åç»­å†…å®¹çš„åŠ è§£å¯†éƒ½æ˜¯é€šè¿‡ä¸€å¼€å§‹çº¦å®šå¥½çš„å¯¹ç§°åŠ å¯†ç®—æ³•è¿›è¡Œçš„ã€‚</p>
<p>å¤‡æ³¨ 2ï¼šSSL/TLS æ˜¯ HTTPS å®‰å…¨æ€§çš„æ ¸å¿ƒæ¨¡å—ï¼ŒTLS çš„å‰èº«æ˜¯ SSLï¼ŒTLS1.0 å°±æ˜¯ SSL3.1ï¼Œ<br>TLS1.1 æ˜¯ SSL3.2ï¼ŒTLS1.2 åˆ™æ˜¯ SSL3.3ã€‚ SSL/TLS æ˜¯å»ºç«‹åœ¨ TCP åè®®ä¹‹ä¸Šï¼Œå› è€Œä¹Ÿæ˜¯åº”ç”¨å±‚çº§åˆ«çš„åè®®ã€‚<br>å…¶åŒ…æ‹¬ TLS Record Protocol å’Œ TLS Handshaking Protocols ä¸¤ä¸ªæ¨¡å—ï¼Œ<br>åè€…è´Ÿè´£æ¡æ‰‹è¿‡ç¨‹ä¸­çš„èº«ä»½è®¤è¯ï¼Œå‰è€…åˆ™ä¿è¯æ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­çš„å®Œæ•´æ€§å’Œç§å¯†æ€§</p>
</blockquote>
</li>
</ul>
]]></content>
      <categories>
        <category>GOå®è·µ</category>
      </categories>
      <tags>
        <tag>golang</tag>
      </tags>
  </entry>
  <entry>
    <title>exporterå¼€å‘(ä¸Šç¯‡)</title>
    <url>/2021/10/29/uncatalog/ckvcbok080000j0r7d9f9gqjj/</url>
    <content><![CDATA[<hr>
<span id="more"></span>
<p><img src="/2021/10/29/uncatalog/ckvcbok080000j0r7d9f9gqjj/1.png"></p>
<h1 id="exporterå¼€å‘-ä¸Šç¯‡"><a href="#exporterå¼€å‘-ä¸Šç¯‡" class="headerlink" title="exporterå¼€å‘(ä¸Šç¯‡)"></a>exporterå¼€å‘(ä¸Šç¯‡)</h1><p>  ä¸Šç¯‡æ–‡ç« å‰–æäº†<a href="https://bugkillerpro.github.io/2021/10/27/uncatalog/ckv998l9f000qv0r7bn48dbig/" title="Markdown">node_exporteræºç </a>ï¼Œæ¥ä¸‹æ¥å°±è¦è‡ªå·±å®è·µä¸‹<code>exporter</code>çš„å¼€å‘äº†ã€‚</p>
<h2 id="1ï¼Œä¸€ä¸ªâ€hello-worldâ€demoç‰ˆçš„exporter"><a href="#1ï¼Œä¸€ä¸ªâ€hello-worldâ€demoç‰ˆçš„exporter" class="headerlink" title="1ï¼Œä¸€ä¸ªâ€hello worldâ€demoç‰ˆçš„exporter"></a>1ï¼Œä¸€ä¸ªâ€hello worldâ€demoç‰ˆçš„exporter</h2><p>  æ­£å¼å¼€å¯<code>exporter</code>å¼€å‘ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥ä¸ª<code>exporter</code>å¼€å‘çš„<code>hello world</code></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">HelloWorldHandler</span><span class="params">(w http.ResponseWriter, r *http.Request)</span></span> &#123;</span><br><span class="line">	fmt.Fprintf(w, <span class="string">`metric_name&#123;label_name=&quot;label_value&quot;&#125; 80`</span> )</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span> <span class="params">()</span></span> &#123;</span><br><span class="line">	http.HandleFunc(<span class="string">&quot;/metrics&quot;</span>, HelloWorldHandler)</span><br><span class="line">	http.ListenAndServe(<span class="string">&quot;:8080&quot;</span>, <span class="literal">nil</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>  å¯åŠ¨èµ·æ¥ä¹‹åï¼Œæˆ‘ä»¬æŠŠå®ƒåŠ å…¥åˆ°prometheusçš„é…ç½®æ–‡ä»¶é‡Œ:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">scrape_configs:</span></span><br><span class="line">  <span class="comment"># The job name is added as a label `job=&lt;job_name&gt;` to any timeseries scraped from this config.</span></span><br><span class="line">  <span class="comment"># metrics_path defaults to &#x27;/metrics&#x27;</span></span><br><span class="line">  <span class="comment"># scheme defaults to &#x27;http&#x27;.</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;hello_world&#x27;</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">targets:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">localhost:8080</span></span><br></pre></td></tr></table></figure></div>
<p>  ç„¶åæŠŠå®ƒå’Œprometheuséƒ½å¯åŠ¨èµ·æ¥ï¼Œæˆ‘ä»¬çœ‹ä¸€ä¸‹prometheusçš„é‡‡é›†ç»“æœï¼š  </p>
<p>  <img src="/2021/10/29/uncatalog/ckvcbok080000j0r7d9f9gqjj/2.png"></p>
<p>  <img src="/2021/10/29/uncatalog/ckvcbok080000j0r7d9f9gqjj/3.png"></p>
<p>  åˆ°æ­¤ï¼Œæˆ‘ä»¬å·²ç»å®Œæˆäº†ä¸€ä¸ªç®€æ˜“ç‰ˆçš„è‡ªç ”<code>exporter</code>çš„<code>Demo</code>ã€‚</p>
<h2 id="2ï¼Œå¼€å‘exporteréœ€è¦éµå¾ªçš„è§„èŒƒ"><a href="#2ï¼Œå¼€å‘exporteréœ€è¦éµå¾ªçš„è§„èŒƒ" class="headerlink" title="2ï¼Œå¼€å‘exporteréœ€è¦éµå¾ªçš„è§„èŒƒ"></a>2ï¼Œå¼€å‘<code>exporter</code>éœ€è¦éµå¾ªçš„è§„èŒƒ</h2><p>  ä½œä¸ºä¸€ä¸ªä¼˜ç§€çš„å¼€æºç›‘æ§é¡¹ç›®ï¼ŒPrometheusçš„å¯æ‰©å±•æ€§æ˜¯éå¸¸å¼ºå¤§çš„ï¼Œæ‰€ä»¥æ‰å‡ºç°äº†å„ç§å¼ºå¤§çš„ä¸­é—´ç›¸å…³<code>exporter</code>ã€‚ä½†æ˜¯ï¼Œæ— è§„çŸ©ä¸æˆæ–¹åœ†ï¼Œ<br>è¦æ¥å…¥Prometheuså°±è¦éµå¾ªå®ƒçš„è§„èŒƒï¼Œäº†è§£äº†è¿™äº›ä¹‹åï¼Œä½ çš„<code>exporter</code>å¼€å‘ä¹‹è·¯å°†ä¼šéå¸¸é¡ºåˆ©ï¼Œå› ä¸ºè¿™ä¸ªè§„èŒƒå¾ˆç®€å•ï¼Œå°±åªæœ‰ä¸€ä¸ª<code>interface</code>:  </p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> prometheus</span><br><span class="line"></span><br><span class="line"><span class="comment">// Collector is the interface implemented by anything that can be used by</span></span><br><span class="line"><span class="comment">// Prometheus to collect metrics. A Collector has to be registered for</span></span><br><span class="line"><span class="comment">// collection. See Registerer.Register.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// The stock metrics provided by this package (Gauge, Counter, Summary,</span></span><br><span class="line"><span class="comment">// Histogram, Untyped) are also Collectors (which only ever collect one metric,</span></span><br><span class="line"><span class="comment">// namely itself). An implementer of Collector may, however, collect multiple</span></span><br><span class="line"><span class="comment">// metrics in a coordinated fashion and/or create metrics on the fly. Examples</span></span><br><span class="line"><span class="comment">// for collectors already implemented in this library are the metric vectors</span></span><br><span class="line"><span class="comment">// (i.e. collection of multiple instances of the same Metric but with different</span></span><br><span class="line"><span class="comment">// label values) like GaugeVec or SummaryVec, and the ExpvarCollector.</span></span><br><span class="line"><span class="keyword">type</span> Collector <span class="keyword">interface</span> &#123;</span><br><span class="line">	<span class="comment">// Describe sends the super-set of all possible descriptors of metrics</span></span><br><span class="line">	<span class="comment">// collected by this Collector to the provided channel and returns once</span></span><br><span class="line">	<span class="comment">// the last descriptor has been sent. The sent descriptors fulfill the</span></span><br><span class="line">	<span class="comment">// consistency and uniqueness requirements described in the Desc</span></span><br><span class="line">	<span class="comment">// documentation.</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">// It is valid if one and the same Collector sends duplicate</span></span><br><span class="line">	<span class="comment">// descriptors. Those duplicates are simply ignored. However, two</span></span><br><span class="line">	<span class="comment">// different Collectors must not send duplicate descriptors.</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">// Sending no descriptor at all marks the Collector as â€œuncheckedâ€,</span></span><br><span class="line">	<span class="comment">// i.e. no checks will be performed at registration time, and the</span></span><br><span class="line">	<span class="comment">// Collector may yield any Metric it sees fit in its Collect method.</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">// This method idempotently sends the same descriptors throughout the</span></span><br><span class="line">	<span class="comment">// lifetime of the Collector. It may be called concurrently and</span></span><br><span class="line">	<span class="comment">// therefore must be implemented in a concurrency safe way.</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">// If a Collector encounters an error while executing this method, it</span></span><br><span class="line">	<span class="comment">// must send an invalid descriptor (created with NewInvalidDesc) to</span></span><br><span class="line">	<span class="comment">// signal the error to the registry.</span></span><br><span class="line">	Describe(<span class="keyword">chan</span>&lt;- *Desc)</span><br><span class="line">	<span class="comment">// Collect is called by the Prometheus registry when collecting</span></span><br><span class="line">	<span class="comment">// metrics. The implementation sends each collected metric via the</span></span><br><span class="line">	<span class="comment">// provided channel and returns once the last metric has been sent. The</span></span><br><span class="line">	<span class="comment">// descriptor of each sent metric is one of those returned by Describe</span></span><br><span class="line">	<span class="comment">// (unless the Collector is unchecked, see above). Returned metrics that</span></span><br><span class="line">	<span class="comment">// share the same descriptor must differ in their variable label</span></span><br><span class="line">	<span class="comment">// values.</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">// This method may be called concurrently and must therefore be</span></span><br><span class="line">	<span class="comment">// implemented in a concurrency safe way. Blocking occurs at the expense</span></span><br><span class="line">	<span class="comment">// of total performance of rendering all registered metrics. Ideally,</span></span><br><span class="line">	<span class="comment">// Collector implementations support concurrent readers.</span></span><br><span class="line">	Collect(<span class="keyword">chan</span>&lt;- Metric)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>  è¿™ä¸ª<code>interface</code>å®šä¹‰åœ¨<a href="github.com/prometheus/client_golang/prometheus" title="Markdown">client_golang</a>ä¸­ï¼Œ<code>client_golang</code>æ˜¯<code>prometheus</code>çš„å®˜æ–¹<code>go</code>åº“,<br>æ—¢å¯ä»¥ç”¨äºé›†æˆç°æœ‰åº”ç”¨,ä¹Ÿå¯ä»¥ä½œä¸ºè¿æ¥<code>Prometheus HTTP API</code>çš„åŸºç¡€åº“ã€‚<br>  <code>Collector</code>è¿™ä¸ªæ¥å£é‡Œçš„æ¯ä¸ªå­—æ®µæˆ‘éƒ½ä¼šç»™å‡ºè¯¦ç»†çš„è§£æï¼Œåœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆäº†è§£å‡ ä¸ªå’Œæœ¬ç« å†…å®¹ç›¸å…³çš„åŸºæœ¬æ¦‚å¿µï¼Œå…³äºprometheusçš„è¯¦ç»†å†…å®¹ï¼Œè¿˜éœ€è¦è¯»è€…è‡ªå·±å»å­¦ä¹ ï¼› </p>
<h3 id="2-1-Prometheusç›‘æ§ç³»ç»Ÿçš„æ¶æ„å›¾"><a href="#2-1-Prometheusç›‘æ§ç³»ç»Ÿçš„æ¶æ„å›¾" class="headerlink" title="2.1 Prometheusç›‘æ§ç³»ç»Ÿçš„æ¶æ„å›¾"></a>2.1 Prometheusç›‘æ§ç³»ç»Ÿçš„æ¶æ„å›¾</h3><p>  <img src="/2021/10/29/uncatalog/ckvcbok080000j0r7d9f9gqjj/4.png"><br>  å’Œæœ¬ç¯‡ç›¸å…³çš„å°±æ˜¯å·¦ä¸‹è§’çš„éƒ¨åˆ†ï¼Œ<code>Prometheus targets</code>ä¹Ÿå°±æ˜¯å„ç§çš„<code>exporter</code>ã€‚<br>  <code>Prometheus server</code>ä»å„ä¸ª<code>target</code>ä¸Šè·å–é‡‡é›†æ•°æ®çš„æ–¹å¼æ˜¯<code>pull</code>ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡ <code>http</code>åè®®å‘å„ä¸ª<code>exporter</code>å‘é€<code>GET</code>è¯·æ±‚ï¼Œé»˜è®¤çš„è·¯å¾„å°±æ˜¯<code>/metrics</code>ï¼Œæ‰€ä»¥å°±åƒä¸Šé¢æˆ‘ä»¬çš„<code>hello world</code>ç‰ˆçš„<code>Demo</code>ä¸€æ ·ï¼Œéµå¾ªè¿™ç§è§„èŒƒå°±å¯ä»¥è¢«<code>Prometheus server</code>é‡‡é›†åˆ°ã€‚</p>
<h3 id="2-2-æ•°æ®ç»“æ„"><a href="#2-2-æ•°æ®ç»“æ„" class="headerlink" title="2.2 æ•°æ®ç»“æ„"></a>2.2 æ•°æ®ç»“æ„</h3><p>  æ•°æ®å·²ç»é‡‡é›†åˆ°äº†ï¼Œä½†æ˜¯<code>Prometheus server</code>æ€ä¹ˆèƒ½æ­£ç¡®çš„é¢†ä¼šåˆ°æˆ‘çš„æ„å›¾å‘¢ï¼Ÿä¹Ÿå°±æ˜¯è¯´å®ƒæ€ä¹ˆèƒ½æ­£ç¡®è§£æå‡ºæˆ‘çš„æ•°æ®å‘¢ï¼Ÿ<br>  é‚£å°±éœ€è¦æˆ‘ä»¬å‘é€çš„æ•°æ®éµå¾ª<a href="github.com/prometheus/client_golang/prometheus" title="Markdown">client_golang</a>é‡Œå®šä¹‰çš„çš„æ•°æ®ç»“æ„çš„è§„èŒƒäº†ã€‚<br>  <code>Prometheus client libraries</code> æä¾›äº†å››ç§æ ¸å¿ƒçš„ <code>metric types</code> ï¼Œæˆ‘åœ¨è¿™é‡Œç®€è¦åˆ—ä¸¾ä¸€ä¸‹:</p>
<table>
<thead>
<tr>
<th>metric types</th>
<th>æ¦‚å¿µ</th>
<th>ç”¨é€”</th>
</tr>
</thead>
<tbody><tr>
<td>Counter</td>
<td>æ”¶é›†çš„æ•°æ®æ˜¯æŒ‰ç…§æŸä¸ªè¶‹åŠ¿ï¼ˆå¢åŠ ï¼å‡å°‘ï¼‰ä¸€ç›´å˜åŒ–çš„</td>
<td>æœåŠ¡è¯·æ±‚æ€»é‡ã€é”™è¯¯æ€»æ•°ç­‰</td>
</tr>
<tr>
<td>Gauge</td>
<td>æ”¶é›†çš„æ•°æ®æ˜¯ä¸€ä¸ªç¬æ—¶çš„å€¼ï¼Œä¸æ—¶é—´æ²¡æœ‰å…³ç³»ï¼Œå¯ä»¥ä»»æ„å˜é«˜å˜ä½</td>
<td>å½“å‰ goroutines çš„æ•°é‡ã€å†…å­˜ä½¿ç”¨ç‡ã€ç£ç›˜ä½¿ç”¨ç‡ç­‰</td>
</tr>
<tr>
<td>Histogram</td>
<td>è¡¨ç¤ºä¸€æ®µæ—¶é—´èŒƒå›´å†…å¯¹æ•°æ®è¿›è¡Œé‡‡æ ·ï¼ˆé€šå¸¸æ˜¯è¯·æ±‚æŒç»­æ—¶é—´æˆ–å“åº”å¤§å°ï¼‰ï¼Œå¹¶èƒ½å¤Ÿå¯¹å…¶æŒ‡å®šåŒºé—´ä»¥åŠæ€»æ•°è¿›è¡Œç»Ÿè®¡ï¼Œé€šå¸¸å®ƒé‡‡é›†çš„æ•°æ®å±•ç¤ºä¸ºç›´æ–¹å›¾</td>
<td>è®¡ç®—æ•°æ®çš„åˆ†ä½æ•°</td>
</tr>
<tr>
<td>Summary</td>
<td>å’Œ Histogram ç±»ä¼¼</td>
<td>åŒä¸Š</td>
</tr>
</tbody></table>
<p>  è¿™é‡Œè¦è®²ä¸€ä¸‹<code>Histogram</code>å’Œ<code>Summary</code>çš„åŒºåˆ«:  </p>
<ul>
<li><code>Histogram</code>ï¼Œå°†æ—¶é—´èŒƒå›´å†…çš„æ•°æ®åˆ’åˆ†æˆä¸åŒçš„æ—¶é—´æ®µï¼Œå¹¶å„è‡ªè¯„ä¼°å…¶æ ·æœ¬ä¸ªæ•°åŠæ ·æœ¬å€¼ä¹‹å’Œï¼Œå› è€Œå¯ä»¥åœ¨<code>server</code>ç«¯è®¡ç®—å‡ºåˆ†ä½æ•°;</li>
<li><code>Summary</code>ï¼Œç›´æ¥åœ¨å®¢æˆ·ç«¯ï¼Œä¹Ÿå°±æ˜¯é‡‡é›†ç«¯ï¼Œä¸ŠæŠ¥è®¡ç®—å¥½çš„åˆ†ä½æ•°ï¼›</li>
</ul>
<p>  æ‰€ä»¥ï¼Œé‡ç‚¹å°±åœ¨äº<code>2.1</code>å’Œ<code>2.2</code>ï¼Œä¸€ä¸ªå®šä¹‰äº†æ€ä¹ˆç»™ï¼Œå¦ä¸€ä¸ªå®šä¹‰äº†ç»™ä»€ä¹ˆæ ·çš„æ•°æ®ã€‚</p>
<h2 id="3ï¼ŒCollectoræ¥å£è¯¦è§£"><a href="#3ï¼ŒCollectoræ¥å£è¯¦è§£" class="headerlink" title="3ï¼ŒCollectoræ¥å£è¯¦è§£"></a>3ï¼Œ<code>Collector</code>æ¥å£è¯¦è§£</h2><h2 id="3-1ï¼ŒCollectorç›¸å…³çš„é‡ç‚¹structå…³ç³»å›¾"><a href="#3-1ï¼ŒCollectorç›¸å…³çš„é‡ç‚¹structå…³ç³»å›¾" class="headerlink" title="3.1ï¼ŒCollectorç›¸å…³çš„é‡ç‚¹structå…³ç³»å›¾"></a>3.1ï¼Œ<code>Collector</code>ç›¸å…³çš„é‡ç‚¹<code>struct</code>å…³ç³»å›¾</h2><p><img src="/2021/10/29/uncatalog/ckvcbok080000j0r7d9f9gqjj/5.jpg"></p>
<h3 id="3-1-1ï¼ŒMetric"><a href="#3-1-1ï¼ŒMetric" class="headerlink" title="3.1.1ï¼ŒMetric"></a>3.1.1ï¼Œ<code>Metric</code></h3><p>  æŒ‡æ ‡ï¼Œå³å¯¹å•ä¸ªå€¼è¿›è¡Œå»ºæ¨¡çš„ç»“æœï¼Œä¸Šé¢è®²åˆ°çš„å››ç§<code>metric types</code>éƒ½æ˜¯å®ƒçš„å…·ä½“å®ç°ï¼Œå³åŒ…æ‹¬æˆ‘ä»¬è‡ªå®šä¹‰å¼€å‘åœ¨å†…çš„æ‰€æœ‰<code>exporter</code>ä¸Šå®šä¹‰çš„é‡‡é›†æ•°æ®ï¼Œå…¶ç±»å‹ï¼Œéƒ½æ˜¯<code>Metric</code>çš„å…·ä½“å®ç°;</p>
<ul>
<li>æ¥å£ Desc() *Desc : è¿”å›å…³äºMetricçš„æè¿°ç¬¦ã€‚</li>
<li>æ¥å£ Write(*dto.Metric) error : å°†Metricç¼–ç ä¸ºProtocol Bufferä¼ è¾“å¯¹è±¡</li>
</ul>
<h3 id="3-1-2ï¼ŒCollector"><a href="#3-1-2ï¼ŒCollector" class="headerlink" title="3.1.2ï¼ŒCollector"></a>3.1.2ï¼Œ<code>Collector</code></h3><p> å„ç§<code>exporter</code>ä¸Šçš„ä¸»è¦<code>struct</code>éƒ½æ˜¯<code>Collector</code>çš„å…·ä½“å®ç°ï¼Œå¦‚<a href="https://bugkillerpro.github.io/2021/10/27/uncatalog/ckv998l9f000qv0r7bn48dbig/" title="Markdown">node_exporteræºç </a>ä¸­çš„<code>NodeCollector</code>  </p>
<ul>
<li>æ¥å£ Describe(chan&lt;- *Desc) ï¼šä¼ é€’æŒ‡æ ‡æè¿°ç¬¦åˆ° channel</li>
<li>æ¥å£ Collect(chan&lt;- Metric) : æ‰§â¾æŠ“å–å‡½æ•°å¹¶è¿”å›æ•°æ®ï¼Œè¿”å›çš„æ•°æ®ä¼ é€’åˆ° channel ä¸­</li>
</ul>
<h3 id="3-1-3ï¼ŒMetricVec"><a href="#3-1-3ï¼ŒMetricVec" class="headerlink" title="3.1.3ï¼ŒMetricVec"></a>3.1.3ï¼Œ<code>MetricVec</code></h3><p>ç”¨æ¥åšä¸ºâ€˜ç›¸åŒæŒ‡æ ‡åï¼Œä¸åŒæ ‡ç­¾å€¼çš„â€™<code>Collector</code>ï¼Œæ¯”å¦‚ é‡‡é›†æŒ‡æ ‡åä¸º<code>number of HTTP requests</code>çš„æ•°æ®ï¼Œå¯ä»¥æ ¹æ®<code>response code</code>å’Œ<code>method</code>æ¥åŒºåˆ†ä¸åŒçš„æ ‡ç­¾å€¼ã€‚<code>MetricVec</code>ä¹Ÿæœ‰å››ç§å…·ä½“çš„å®ç°ï¼š  </p>
<ul>
<li>GaugeVec</li>
<li>CounterVec</li>
<li>SummaryVec</li>
<li>HistogramVec</li>
</ul>
<p>ä¸‹ä¸€ç¯‡æ–‡ç« ï¼Œå°†é€šè¿‡å…·ä½“çš„<code>exporter</code>å¼€å‘ä»£ç è®²è¿°ä¸‹ç›¸å…³çš„å®è·µã€‚</p>
]]></content>
      <tags>
        <tag>prometheus</tag>
        <tag>æºç é˜…è¯»</tag>
        <tag>exporterå¼€å‘</tag>
      </tags>
  </entry>
  <entry>
    <title>exporterå¼€å‘(ä¸‹ç¯‡)</title>
    <url>/2021/10/31/uncatalog/ckveojmmm000058r7hcfo45uz/</url>
    <content><![CDATA[<hr>
<span id="more"></span>
<p><img src="/2021/10/31/uncatalog/ckveojmmm000058r7hcfo45uz/1.png"></p>
<h1 id="exporterå¼€å‘-ä¸‹ç¯‡"><a href="#exporterå¼€å‘-ä¸‹ç¯‡" class="headerlink" title="exporterå¼€å‘(ä¸‹ç¯‡)"></a>exporterå¼€å‘(ä¸‹ç¯‡)</h1><p>  å‡†å¤‡å·¥ä½œå·²ç»åœ¨ä¸Šç¯‡è®²è¿‡äº†ï¼Œè¿™é‡Œæˆ‘ä»¬å°±ç›´æ¥å¼€å§‹æ’¸ä»£ç </p>
<h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><p>  ç›®å½•ç»“æ„ï¼š<br>  .<br>  â”œâ”€â”€ collector<br>  â”‚Â Â  â””â”€â”€ pid.go<br>  â””â”€â”€ main.go</p>
<p>  main.go</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;custom_exporters/demo_04/collector&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/prometheus/client_golang/prometheus&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/prometheus/client_golang/prometheus/promhttp&quot;</span></span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	prometheus.MustRegister(collector.NewPidCollector())</span><br><span class="line">	http.Handle(<span class="string">&quot;/metrics&quot;</span>, promhttp.Handler())</span><br><span class="line">	<span class="keyword">if</span> err := http.ListenAndServe(<span class="string">&quot;:8080&quot;</span>, <span class="literal">nil</span>); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Printf(<span class="string">&quot;Error occur when start server %v&quot;</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>  pid.go  </p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> collector</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;github.com/prometheus/client_golang/prometheus&quot;</span></span><br><span class="line">  <span class="string">&quot;github.com/shirou/gopsutil/host&quot;</span></span><br><span class="line">  <span class="string">&quot;os&quot;</span></span><br><span class="line">  <span class="string">&quot;sync&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> PidCollector <span class="keyword">struct</span> &#123;</span><br><span class="line">  pidDesc    *prometheus.Desc   <span class="comment">//å½“å‰collectorçš„pid</span></span><br><span class="line">  mutex          sync.Mutex</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewPidCollector</span><span class="params">()</span><span class="title">PidCollector</span></span>  &#123;</span><br><span class="line">  <span class="keyword">return</span> PidCollector&#123;pidDesc:  prometheus.NewDesc(</span><br><span class="line">    <span class="string">&quot;cur_collector_pid&quot;</span>,</span><br><span class="line">    <span class="string">&quot;å½“å‰collectorçš„pid&quot;</span>,</span><br><span class="line">    []<span class="keyword">string</span>&#123;<span class="string">&quot;HOST_NAME&quot;</span>&#125;,</span><br><span class="line">    <span class="literal">nil</span>)&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Describe implements the prometheus.Collector interface.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p PidCollector)</span> <span class="title">Describe</span><span class="params">(ch <span class="keyword">chan</span>&lt;- *prometheus.Desc)</span></span> &#123;</span><br><span class="line">  ch &lt;- p.pidDesc</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Collect implements the prometheus.Collector interface.This method may be called concurrently and must therefore be</span></span><br><span class="line"><span class="comment">// implemented in a concurrency safe way</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p PidCollector)</span> <span class="title">Collect</span><span class="params">(ch <span class="keyword">chan</span>&lt;- prometheus.Metric)</span></span> &#123;</span><br><span class="line">  p.mutex.Lock()</span><br><span class="line">  <span class="keyword">defer</span> p.mutex.Unlock()</span><br><span class="line">  host,_:= host.Info()</span><br><span class="line">  ch &lt;- prometheus.MustNewConstMetric(</span><br><span class="line">    p.pidDesc,</span><br><span class="line">    prometheus.GaugeValue,</span><br><span class="line">    <span class="keyword">float64</span>(os.Getpid()),</span><br><span class="line">    host.Hostname,</span><br><span class="line">  )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h2 id="prometheusé…ç½®"><a href="#prometheusé…ç½®" class="headerlink" title="prometheusé…ç½®"></a>prometheusé…ç½®</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">scrape_configs:</span></span><br><span class="line">  <span class="comment"># The job name is added as a label `job=&lt;job_name&gt;` to any timeseries scraped from this config.</span></span><br><span class="line">  <span class="comment"># metrics_path defaults to &#x27;/metrics&#x27;</span></span><br><span class="line">  <span class="comment"># scheme defaults to &#x27;http&#x27;.</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;pid collector&#x27;</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">targets:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">localhost:8080</span></span><br></pre></td></tr></table></figure></div>

<h2 id="æ•ˆæœ"><a href="#æ•ˆæœ" class="headerlink" title="æ•ˆæœ"></a>æ•ˆæœ</h2><p><img src="/2021/10/31/uncatalog/ckveojmmm000058r7hcfo45uz/2.png"></p>
<p><img src="/2021/10/31/uncatalog/ckveojmmm000058r7hcfo45uz/3.png"></p>
<h2 id="ç»“å°¾"><a href="#ç»“å°¾" class="headerlink" title="ç»“å°¾"></a>ç»“å°¾</h2><p>  è¿™åªæ˜¯ä¸€ä¸ªç®€å•çš„<code>collector</code>å®è·µï¼Œå¦‚æœæœ‰å¤šä¸ªæŒ‡æ ‡éœ€è¦é‡‡é›†ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨ <code>XXXCollector</code>ç»“æ„ä½“é‡Œé¢å®šä¹‰å¤šä¸ª<code>Desc</code>ï¼Œå…·ä½“æŒ‡æ ‡å€¼çš„è·å–ï¼Œéœ€è¦æ ¹æ®å…·ä½“åœºæ™¯æ¥å®ç°ã€‚</p>
]]></content>
      <tags>
        <tag>prometheus</tag>
        <tag>æºç é˜…è¯»</tag>
        <tag>exporterå¼€å‘</tag>
      </tags>
  </entry>
  <entry>
    <title>golangçš„å‡ ç§åç¨‹ç»ˆæ­¢æ–¹æ³•å’ŒåŒºåˆ«</title>
    <url>/2022/02/16/uncatalog/ckzpbwxd00000ecr7802m1nw2/</url>
    <content><![CDATA[<hr>
<span id="more"></span>
<p><img src="/2022/02/16/uncatalog/ckzpbwxd00000ecr7802m1nw2/1.png"></p>
<h1 id="return"><a href="#return" class="headerlink" title="return"></a>return</h1><p>ç»“æŸå½“å‰å‡½æ•°,å¹¶è¿”å›æŒ‡å®šå€¼,deferè°ƒç”¨ä¼šæ‰§è¡Œ;</p>
<h3 id="è¿™é‡Œéœ€è¦å¼•ç”³å‡ºæ¥ä¸€ä¸ªçŸ¥è¯†ç‚¹â€“returnå’Œdeferçš„æ‰§è¡Œé¡ºåºé—®é¢˜-å…ˆçœ‹ä¸€æ®µä»£ç ï¼š"><a href="#è¿™é‡Œéœ€è¦å¼•ç”³å‡ºæ¥ä¸€ä¸ªçŸ¥è¯†ç‚¹â€“returnå’Œdeferçš„æ‰§è¡Œé¡ºåºé—®é¢˜-å…ˆçœ‹ä¸€æ®µä»£ç ï¼š" class="headerlink" title="è¿™é‡Œéœ€è¦å¼•ç”³å‡ºæ¥ä¸€ä¸ªçŸ¥è¯†ç‚¹â€“returnå’Œdeferçš„æ‰§è¡Œé¡ºåºé—®é¢˜,å…ˆçœ‹ä¸€æ®µä»£ç ï¼š"></a>è¿™é‡Œéœ€è¦å¼•ç”³å‡ºæ¥ä¸€ä¸ªçŸ¥è¯†ç‚¹â€“returnå’Œdeferçš„æ‰§è¡Œé¡ºåºé—®é¢˜,å…ˆçœ‹ä¸€æ®µä»£ç ï¼š</h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;f1 result: &quot;</span>, f1())</span><br><span class="line">	fmt.Println(<span class="string">&quot;------&quot;</span>)</span><br><span class="line">	fmt.Println(<span class="string">&quot;f2 result: &quot;</span>, f2())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f1</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> i <span class="keyword">int</span></span><br><span class="line">	<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		i++</span><br><span class="line">		fmt.Println(<span class="string">&quot;f11: &quot;</span>, i)</span><br><span class="line">	&#125;()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		i++</span><br><span class="line">		fmt.Println(<span class="string">&quot;f12: &quot;</span>, i)</span><br><span class="line">	&#125;()</span><br><span class="line"></span><br><span class="line">	i = <span class="number">1000</span></span><br><span class="line">	<span class="keyword">return</span> i</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">f2</span><span class="params">()</span> <span class="params">(i <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		i++</span><br><span class="line">		fmt.Println(<span class="string">&quot;f21: &quot;</span>, i)</span><br><span class="line">	&#125;()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		i++</span><br><span class="line">		fmt.Println(<span class="string">&quot;f22: &quot;</span>, i)</span><br><span class="line">	&#125;()</span><br><span class="line"></span><br><span class="line">	i = <span class="number">1000</span></span><br><span class="line">	<span class="keyword">return</span> i</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<h3 id="è¾“å‡º"><a href="#è¾“å‡º" class="headerlink" title="è¾“å‡º:"></a>è¾“å‡º:</h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">f12:  1001</span><br><span class="line">f11:  1002</span><br><span class="line">f1 result:  1000</span><br><span class="line">------</span><br><span class="line">f22:  1001</span><br><span class="line">f21:  1002</span><br><span class="line">f2 result:  1002</span><br></pre></td></tr></table></figure></div>
<h3 id="åŸå› "><a href="#åŸå› " class="headerlink" title="åŸå› :"></a>åŸå› :</h3><ul>
<li>å¤šä¸ªdeferçš„æ‰§è¡Œé¡ºåºä¸ºâ€œåè¿›å…ˆå‡ºâ€</li>
<li>deferã€returnã€è¿”å›å€¼ä¸‰è€…çš„æ‰§è¡Œé€»è¾‘åº”è¯¥æ˜¯ï¼š<br>returnæœ€å…ˆæ‰§è¡Œï¼Œreturnè´Ÿè´£å°†ç»“æœå†™å…¥è¿”å›å€¼ä¸­<br>æ¥ç€deferå¼€å§‹æ‰§è¡Œä¸€äº›æ”¶å°¾å·¥ä½œ<br>æœ€åå‡½æ•°æºå¸¦å½“å‰è¿”å›å€¼é€€å‡º</li>
<li>å¦‚æœå‡½æ•°çš„è¿”å›å€¼æ˜¯æ— åçš„ï¼ˆä¸å¸¦å‘½åè¿”å›å€¼,å¦‚ä¸Šé¢ä¾‹å­ä¸­çš„<code>f1</code>ï¼‰<br>åˆ™goè¯­è¨€ä¼šåœ¨æ‰§è¡Œreturnçš„æ—¶å€™ä¼šæ‰§è¡Œä¸€ä¸ªç±»ä¼¼åˆ›å»ºä¸€ä¸ªä¸´æ—¶å˜é‡ä½œä¸ºä¿å­˜returnå€¼çš„åŠ¨ä½œ  </li>
<li>è€Œæœ‰åè¿”å›å€¼çš„å‡½æ•°ï¼ˆå¦‚ä¸Šé¢ä¾‹å­ä¸­çš„<code>f2</code>ï¼‰ï¼Œç”±äºè¿”å›å€¼åœ¨å‡½æ•°å®šä¹‰çš„æ—¶å€™å·²ç»å°†è¯¥å˜é‡è¿›è¡Œå®šä¹‰ï¼Œ<br>åœ¨æ‰§è¡Œreturnçš„æ—¶å€™ä¼šå…ˆæ‰§è¡Œè¿”å›å€¼ä¿å­˜æ“ä½œï¼Œè€Œåç»­çš„deferå‡½æ•°ä¼šæ”¹å˜è¿™ä¸ªè¿”å›å€¼ï¼Œ<br>ä½†æ˜¯ç”±äºä½¿ç”¨çš„å‡½æ•°å®šä¹‰çš„å˜é‡ï¼Œæ‰€ä»¥æ‰§è¡Œdeferæ“ä½œåå¯¹è¯¥å˜é‡çš„ä¿®æ”¹ä¼šå½±å“åˆ°returnçš„å€¼</li>
</ul>
<p>é’ˆå¯¹åé¢ä¸¤æ¡ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡<code>go tool compile </code>å·¥å…·æ¥è¿›è¡ŒéªŒè¯:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">go tool compile -S -N -l main.go &gt; main.s //  -N -lä¸¤ä¸ªå‘½ä»¤è¡Œé€‰é¡¹ç”¨äºå…³é—­Goç¼–è¯‘å™¨çš„ä¼˜åŒ–,ä¼˜åŒ–åçš„ä»£ç ä¼šæ©ç›–å®ç°ç»†èŠ‚</span><br></pre></td></tr></table></figure></div>
<p>æŸ¥çœ‹<code>main.s</code>æ–‡ä»¶,é‡ç‚¹æŸ¥çœ‹ä¸€ä¸‹å‡ è¡Œ:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="code"><pre><span class="line">0x00af 00175 (main.go:23)	MOVQ	$1000, &quot;&quot;.i+8(SP)</span><br><span class="line">0x00b8 00184 (main.go:24)	MOVQ	$1000, &quot;&quot;.~r0+144(SP) &#x2F;&#x2F; è¿™é‡Œå°±æ˜¯ä¸Šé¢æ‰€è¯´çš„åˆ›å»ºä¸€ä¸ªä¸´æ—¶å˜é‡ä½œä¸ºä¿å­˜returnå€¼çš„åŠ¨ä½œ</span><br><span class="line">0x00c4 00196 (main.go:24)	XCHGL	AX, AX</span><br><span class="line">0x00c5 00197 (main.go:24)	CALL	runtime.deferreturn(SB)</span><br><span class="line">0x00ca 00202 (main.go:24)	MOVQ	128(SP), BP</span><br><span class="line">0x00d2 00210 (main.go:24)	ADDQ	$136, SP</span><br><span class="line">0x00d9 00217 (main.go:24)	RET</span><br></pre></td></tr></table></figure></div>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="code"><pre><span class="line">0x009e 00158 (main.go:38)	MOVQ	$1000, &quot;&quot;.i+136(SP)</span><br><span class="line">0x00aa 00170 (main.go:39)	XCHGL	AX, AX</span><br><span class="line">0x00ab 00171 (main.go:39)	CALL	runtime.deferreturn(SB)</span><br><span class="line">0x00b0 00176 (main.go:39)	MOVQ	120(SP), BP</span><br><span class="line">0x00b5 00181 (main.go:39)	SUBQ	$-128, SP</span><br><span class="line">0x00b9 00185 (main.go:39)	RET</span><br></pre></td></tr></table></figure></div>
<h3 id="ä»£ç è§£è¯»"><a href="#ä»£ç è§£è¯»" class="headerlink" title="ä»£ç è§£è¯»:"></a>ä»£ç è§£è¯»:</h3><p>ä¸ºäº†å¼„æ¸…ä¸Šè¿°ä¸¤ç§æƒ…å†µçš„åŒºåˆ«ï¼Œæˆ‘ä»¬é¦–å…ˆè¦ç†è§£return è¿”å›å€¼çš„è¿è¡Œæœºåˆ¶:<br>return å¹¶éåŸå­æ“ä½œï¼Œåˆ†ä¸ºèµ‹å€¼ï¼Œå’Œè¿”å›å€¼ä¸¤æ­¥æ“ä½œ<br>f1 : å®é™…ä¸Šreturn æ‰§è¡Œäº†ä¸¤æ­¥æ“ä½œï¼Œå› ä¸ºè¿”å›å€¼æ²¡æœ‰å‘½åï¼Œ<br>æ‰€ä»¥return é»˜è®¤æŒ‡å®šäº†ä¸€ä¸ªä¸´æ—¶å˜é‡ï¼ˆå‡è®¾ä¸ºsï¼‰ï¼Œé¦–å…ˆå°†ièµ‹å€¼ç»™s,<br>åç»­çš„æ“ä½œå› ä¸ºæ˜¯é’ˆå¯¹i,è¿›è¡Œçš„ï¼Œæ‰€ä»¥ä¸ä¼šå½±å“s, æ­¤åå› ä¸ºsä¸ä¼šæ›´æ–°ï¼Œ<br>æ‰€ä»¥return s ä¸ä¼šæ”¹å˜ï¼Œç›¸å½“äºï¼š<br>var i int<br>s := i<br>return s<br>f2 : åŒä¸Šï¼Œs å°±ç›¸å½“äºå‘½åçš„å˜é‡i, å› ä¸ºæ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯åŸºäºå‘½åå˜é‡i(s),è¿”å›å€¼ä¹Ÿæ˜¯i,<br>æ‰€ä»¥æ¯ä¸€æ¬¡deferæ“ä½œï¼Œéƒ½ä¼šæ›´æ–°è¿”å›å€¼i</p>
<h1 id="runtime-Goexit"><a href="#runtime-Goexit" class="headerlink" title="runtime.Goexit()"></a>runtime.Goexit()</h1><p>ç»“æŸå½“å‰<code>goroutine</code>,å…¶ä»–çš„<code>goroutine</code>ä¸å—å½±å“,ä¸»ç¨‹åºä¹Ÿä¸€æ ·ç»§ç»­è¿è¡Œ,<code>defer</code>ä¼šè¢«è°ƒç”¨;<br>å¦‚æœåœ¨<code>main</code>å‡½æ•°ä¸­è°ƒç”¨,åˆ™<code>main goroutine</code>ç»ˆæ­¢,ç”±äº<code>main</code>å‡½æ•°æ²¡æœ‰<code>return</code>,åˆ™å…¶ä»–<code>groutine</code>ä¼šç»§ç»­æ‰§è¡Œ;(<code>main groutine</code>æ­£å¸¸é€€å‡º,åˆ™å…¶ä»–<code>groutine</code>éƒ½ä¼šé€€å‡º)</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æºç æ³¨é‡Šåœ¨æ­¤</span></span><br><span class="line"><span class="comment">// Goexit terminates the goroutine that calls it. No other goroutine is affected.</span></span><br><span class="line"><span class="comment">// Goexit runs all deferred calls before terminating the goroutine. Because Goexit</span></span><br><span class="line"><span class="comment">// is not a panic, any recover calls in those deferred functions will return nil.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Calling Goexit from the main goroutine terminates that goroutine</span></span><br><span class="line"><span class="comment">// without func main returning. Since func main has not returned,</span></span><br><span class="line"><span class="comment">// the program continues execution of other goroutines.</span></span><br><span class="line"><span class="comment">// If all other goroutines exit, the program crashes.</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<h1 id="os-Exit-code-int"><a href="#os-Exit-code-int" class="headerlink" title="os.Exit(code int)"></a>os.Exit(code int)</h1><p>ä¼šç»“æŸå½“å‰ç¨‹åº,ä¸ç®¡ä½ ä¸‰ä¸ƒäºŒåä¸€ã€‚å‡ ä¹ä¸ä¼šç”¨åˆ°</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æºç æ³¨é‡Šåœ¨æ­¤</span></span><br><span class="line"><span class="comment">// Exit causes the current program to exit with the given status code.</span></span><br><span class="line"><span class="comment">// Conventionally, code zero indicates success, non-zero an error.</span></span><br><span class="line"><span class="comment">// The program terminates immediately; deferred functions are not run.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// For portability, the status code should be in the range [0, 125].</span></span><br></pre></td></tr></table></figure></div>

<h1 id="panic-v-interface"><a href="#panic-v-interface" class="headerlink" title="panic(v interface{})"></a>panic(v interface{})</h1><p>åœæ­¢å½“å‰<code>goroutine</code>çš„æ­£å¸¸æ‰§è¡Œ,<code>defer</code>ä¼šæ‰§è¡Œ,<code>panic</code>ä¼šä¸€ç›´å‘ä¸Šä¼ é€’.</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// æºç æ³¨é‡Šåœ¨æ­¤</span></span><br><span class="line"><span class="comment">// The panic built-in function stops normal execution of the current</span></span><br><span class="line"><span class="comment">// goroutine. When a function F calls panic, normal execution of F stops</span></span><br><span class="line"><span class="comment">// immediately. Any functions whose execution was deferred by F are run in</span></span><br><span class="line"><span class="comment">// the usual way, and then F returns to its caller. To the caller G, the</span></span><br><span class="line"><span class="comment">// invocation of F then behaves like a call to panic, terminating G&#x27;s</span></span><br><span class="line"><span class="comment">// execution and running any deferred functions. This continues until all</span></span><br><span class="line"><span class="comment">// functions in the executing goroutine have stopped, in reverse order. At</span></span><br><span class="line"><span class="comment">// that point, the program is terminated with a non-zero exit code. This</span></span><br><span class="line"><span class="comment">// termination sequence is called panicking and can be controlled by the</span></span><br><span class="line"><span class="comment">// built-in function recover.</span></span><br></pre></td></tr></table></figure></div>
<h1 id="ç»“å°¾"><a href="#ç»“å°¾" class="headerlink" title="ç»“å°¾"></a>ç»“å°¾</h1><p>å¤šçœ‹æºç ï¼Œå¤šå®éªŒï¼Œå¥½è®°æ€§ä¸å¦‚çƒ‚ç¬”å¤´ã€‚</p>
]]></content>
      <tags>
        <tag>golang</tag>
      </tags>
  </entry>
  <entry>
    <title>k8sé›†ç¾¤æ­å»º</title>
    <url>/2022/02/17/uncatalog/ckzqm8tm30000dwr70rq7714w/</url>
    <content><![CDATA[<blockquote>
<p>ç½‘ç»œä¸Šçš„æ•™ç¨‹åœ¨å®‰è£…ç½‘ç»œæ’ä»¶çš„æ—¶å€™,æ€»ä¼šå‡ºé—®é¢˜,é‚å‡ºæ­¤æ‰‹æŠŠæ‰‹æ•™ç¨‹.</p>
</blockquote>
<span id="more"></span>
<p><img src="/2022/02/17/uncatalog/ckzqm8tm30000dwr70rq7714w/1.png"></p>
<h1 id="k8sé›†ç¾¤æ­å»º-k8så®‰è£…å®‰è£…ç½‘ç»œæ’ä»¶"><a href="#k8sé›†ç¾¤æ­å»º-k8så®‰è£…å®‰è£…ç½‘ç»œæ’ä»¶" class="headerlink" title="k8sé›†ç¾¤æ­å»º/k8så®‰è£…å®‰è£…ç½‘ç»œæ’ä»¶"></a>k8sé›†ç¾¤æ­å»º/k8så®‰è£…å®‰è£…ç½‘ç»œæ’ä»¶</h1><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="code"><pre><span class="line">Kubernetes ç®€ç§° k8sï¼Œæ˜¯ç”¨ 8 æ¥ä»£æ›¿ 8 ä¸ªå­—ç¬¦ â€œuberneteâ€ çš„ç¼©å†™</span><br></pre></td></tr></table></figure></div>
<p>k8s é›†ç¾¤å¤§ä½“ä¸Šåˆ†ä¸ºä¸¤å¤§ç±»ï¼š</p>
<ul>
<li>ä¸€ä¸»å¤šä»ï¼šä¸€å° master èŠ‚ç‚¹å’Œå¤šå° node èŠ‚ç‚¹ï¼Œæ­å»ºæ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯æœ‰å¯èƒ½å‡ºç° master å•æœºæ•…éšœ</li>
<li>å¤šä¸»å¤šä»ï¼š å¤šå° master èŠ‚ç‚¹å’Œå¤šå° node èŠ‚ç‚¹ï¼Œæ­å»ºæ¯”è¾ƒéº»çƒ¦ï¼Œä½†æ˜¯å®‰å…¨æ€§é«˜<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="TEXT"><figure class="iseeu highlight /text"><table><tr><td class="code"><pre><span class="line">ä¸ç®¡æ˜¯ ä¸€ä¸»å¤šä» å¼‚æˆ–è€…æ˜¯ å¤šä¸»å¤šä» ï¼Œè¿™é‡Œè‡³å°‘éƒ½æ˜¯éœ€è¦ä¸‰å°æœåŠ¡å™¨ï¼Œè€Œä¸”æ¯å°æœåŠ¡å™¨çš„è§„æ ¼è‡³å°‘å¾—åœ¨ 2Gå†…å­˜ 2é¢—CPU é…ç½®èµ·æ­¥;  </span><br></pre></td></tr></table></figure></div></li>
</ul>
<p>æ‰‹æŠŠæ‰‹å¼€å§‹æ­å»º:</p>
<h2 id="1-ç¯å¢ƒé…ç½®"><a href="#1-ç¯å¢ƒé…ç½®" class="headerlink" title="1,ç¯å¢ƒé…ç½®"></a>1,ç¯å¢ƒé…ç½®</h2><h3 id="1-1-ä¸»æœºåè§£æ"><a href="#1-1-ä¸»æœºåè§£æ" class="headerlink" title="1.1 ä¸»æœºåè§£æ"></a>1.1 ä¸»æœºåè§£æ</h3><p>æˆ‘è¿™é‡Œæœ‰ä¸‰å°æœåŠ¡å™¨,ipå’Œè§’è‰²åˆ†é…å¦‚ä¸‹ï¼š  </p>
<table>
<thead>
<tr>
<th>åºå·</th>
<th>ip</th>
<th>è§’è‰²</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>192.168.161.111</td>
<td>master</td>
</tr>
<tr>
<td>2</td>
<td>192.168.209.156</td>
<td>node1</td>
</tr>
<tr>
<td>3</td>
<td>192.168.209.157</td>
<td>node2</td>
</tr>
</tbody></table>
<hr>
<p>ä¸ºäº†é›†ç¾¤èŠ‚ç‚¹é—´çš„ç›´æ¥è°ƒç”¨ï¼Œæˆ‘ä»¬éœ€è¦é…ç½®ä¸€ä¸‹ä¸»æœºåè§£æï¼Œåˆ†åˆ«åœ¨ä¸‰å°æœåŠ¡å™¨ä¸Šç¼–è¾‘ <code>/etc/hosts</code>,æ·»åŠ ä¸€ä¸‹å†…å®¹:  </p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">192.168.161.111 master</span><br><span class="line">192.168.209.156 node1</span><br><span class="line">192.168.209.157 node2</span><br></pre></td></tr></table></figure></div>

<h3 id="1-2-åŒæ­¥æ—¶é—´"><a href="#1-2-åŒæ­¥æ—¶é—´" class="headerlink" title="1.2 åŒæ­¥æ—¶é—´"></a>1.2 åŒæ­¥æ—¶é—´</h3><p>é›†ç¾¤ä¸­çš„æ—¶é—´å¿…é¡»è¦ç²¾ç¡®ä¸€è‡´ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨<code>chronyd</code>æœåŠ¡ä»ç½‘ç»œåŒæ­¥æ—¶é—´ï¼Œä¸‰å°æœåŠ¡å™¨éœ€åšåŒæ ·çš„æ“ä½œ  </p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">systemctl start chroynd </span><br><span class="line">systemctl enable chroynd</span><br></pre></td></tr></table></figure></div>

<h3 id="1-3-ç¦ç”¨iptableså’ŒfirewalldæœåŠ¡"><a href="#1-3-ç¦ç”¨iptableså’ŒfirewalldæœåŠ¡" class="headerlink" title="1.3 ç¦ç”¨iptableså’ŒfirewalldæœåŠ¡"></a>1.3 ç¦ç”¨iptableså’ŒfirewalldæœåŠ¡</h3><p>kuberneteså’Œdockeråœ¨è¿è¡Œä¸­ä¼šäº§ç”Ÿå¤§é‡çš„iptablesè§„åˆ™ï¼Œä¸ºäº†ä¸è®©ç³»ç»Ÿè§„åˆ™è·Ÿå®ƒä»¬æ··æ·†ï¼Œç›´æ¥å…³é—­ç³»ç»Ÿçš„è§„åˆ™ã€‚ä¸‰å°è™šæ‹Ÿæœºéœ€åšåŒæ ·æ“ä½œ</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å…³é—­firewalldæœåŠ¡</span></span><br><span class="line">systemctl stop firewalld </span><br><span class="line">systemctl disable firewallld</span><br><span class="line"><span class="meta">#</span><span class="bash"> å…³é—­iptablesæœåŠ¡</span></span><br><span class="line">systemctl stop iptables</span><br><span class="line">systemctl disable iptables</span><br></pre></td></tr></table></figure></div>

<h3 id="1-4-ç¦ç”¨selinux"><a href="#1-4-ç¦ç”¨selinux" class="headerlink" title="1.4 ç¦ç”¨selinux"></a>1.4 ç¦ç”¨selinux</h3><p>selinuxæ˜¯linuxç³»ç»Ÿä¸‹çš„ä¸€ä¸ªå®‰å…¨æœåŠ¡ï¼Œå¦‚æœä¸å…³é—­å®ƒï¼Œåœ¨å®‰è£…é›†ç¾¤ä¸­ä¼šäº§ç”Ÿå„ç§å„æ ·çš„å¥‡è‘©é—®é¢˜</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æ°¸ä¹…å…³é—­</span></span><br><span class="line">sed -i &#x27;s/enforcing/disabled/&#x27; /etc/selinux/config</span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¸´æ—¶å…³é—­</span></span><br><span class="line">setenforce 0</span><br></pre></td></tr></table></figure></div>

<h3 id="1-5-ç¦ç”¨swapåˆ†åŒº"><a href="#1-5-ç¦ç”¨swapåˆ†åŒº" class="headerlink" title="1.5 ç¦ç”¨swapåˆ†åŒº"></a>1.5 ç¦ç”¨swapåˆ†åŒº</h3><p>swapåˆ†åŒºæŒ‡çš„æ˜¯è™šæ‹Ÿå†…å­˜åˆ†åŒºï¼Œå®ƒçš„ä½œç”¨æ˜¯åœ¨ç‰©ç†å†…å­˜ä½¿ç”¨å®Œä¹‹åï¼Œå°†ç£ç›˜ç©ºé—´è™šæ‹Ÿæˆå†…å­˜æ¥ä½¿ç”¨å¯ç”¨swapè®¾å¤‡ä¼šå¯¹ç³»ç»Ÿçš„æ€§èƒ½äº§ç”Ÿéå¸¸è´Ÿé¢çš„å½±å“ï¼Œ<br>å› æ­¤kubernetesè¦æ±‚æ¯ä¸ªèŠ‚ç‚¹éƒ½è¦ç¦ç”¨swapè®¾å¤‡ä½†æ˜¯å¦‚æœå› ä¸ºæŸäº›åŸå› ç¡®å®ä¸èƒ½å…³é—­swapåˆ†åŒºï¼Œå°±éœ€è¦åœ¨é›†ç¾¤å®‰è£…è¿‡ç¨‹ä¸­é€šè¿‡æ˜ç¡®çš„å‚æ•°è¿›è¡Œé…ç½®è¯´æ˜</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æ°¸ä¹…å…³é—­ ,æ³¨é‡Šæ‰swapé‚£ä¸€è¡Œ</span></span><br><span class="line">vim /etc/fstab</span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¸´æ—¶å…³é—­</span></span><br><span class="line">swapoff -a</span><br></pre></td></tr></table></figure></div>
<h3 id="1-6-ä¿®æ”¹Linuxçš„å†…æ ¸å‚æ•°"><a href="#1-6-ä¿®æ”¹Linuxçš„å†…æ ¸å‚æ•°" class="headerlink" title="1.6 ä¿®æ”¹Linuxçš„å†…æ ¸å‚æ•°"></a>1.6 ä¿®æ”¹Linuxçš„å†…æ ¸å‚æ•°</h3><p>æˆ‘ä»¬éœ€è¦ä¿®æ”¹linuxçš„å†…æ ¸å‚æ•°ï¼Œæ·»åŠ ç½‘æ¡¥è¿‡æ»¤å’Œåœ°å€è½¬å‘åŠŸèƒ½ï¼Œ<br>ç¼–è¾‘<code>/etc/sysctl.d/kubernetes.conf</code>æ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹é…ç½®</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class="line">net.bridge.bridge-nf-call-iptables = 1</span><br><span class="line">net.ipv4.ip_forward = 1</span><br></pre></td></tr></table></figure></div>
<p>æ·»åŠ åè¿›è¡Œä»¥ä¸‹æ“ä½œï¼š<br> <div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> é‡æ–°åŠ è½½é…ç½®</span></span><br><span class="line">sysctl -p</span><br><span class="line"><span class="meta">#</span><span class="bash"> åŠ è½½ç½‘æ¡¥è¿‡æ»¤æ¨¡å—</span></span><br><span class="line">modprobe br_netfilter</span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹ç½‘æ¡¥è¿‡æ»¤æ¨¡å—æ˜¯å¦åŠ è½½æˆåŠŸ</span></span><br><span class="line">lsmod | grep br_netfilter</span><br></pre></td></tr></table></figure></div></p>
<h3 id="1-7-é…ç½®-ipvs-åŠŸèƒ½"><a href="#1-7-é…ç½®-ipvs-åŠŸèƒ½" class="headerlink" title="1.7 é…ç½® ipvs åŠŸèƒ½"></a>1.7 é…ç½® ipvs åŠŸèƒ½</h3><p>åœ¨kubernetesä¸­serviceæœ‰ä¸¤ç§ä»£ç†æ¨¡å‹ï¼Œä¸€ç§æ˜¯åŸºäºiptablesçš„ï¼Œä¸€ç§æ˜¯åŸºäºipvsçš„ ç›¸æ¯”è¾ƒçš„è¯ï¼Œ<br>ipvsçš„æ€§èƒ½æ˜æ˜¾è¦é«˜ä¸€äº›ï¼Œä½†æ˜¯å¦‚æœè¦ä½¿ç”¨å®ƒï¼Œéœ€è¦æ‰‹åŠ¨è½½å…¥ipvsæ¨¡å—</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å®‰è£…ipsetå’Œipvsadm</span></span><br><span class="line">yum install ipset ipvsadmin -y</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ·»åŠ éœ€è¦åŠ è½½çš„æ¨¡å—å†™å…¥è„šæœ¬æ–‡ä»¶</span></span><br><span class="line">cat &lt;&lt;EOF &gt; /etc/sysconfig/modules/ipvs.modules</span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">modprobe -- ip_vs</span><br><span class="line">modprobe -- ip_vs_rr</span><br><span class="line">modprobe -- ip_vs_wrr</span><br><span class="line">modprobe -- ip_vs_sh</span><br><span class="line">modprobe -- nf_conntrack_ipv4</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¸ºè„šæœ¬æ–‡ä»¶æ·»åŠ æ‰§è¡Œæƒé™</span></span><br><span class="line">chmod +x /etc/sysconfig/modules/ipvs.modules</span><br><span class="line"> /bin/bash /etc/sysconfig/modules/ipvs.modules</span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹å¯¹åº”çš„æ¨¡å—æ˜¯å¦åŠ è½½æˆåŠŸ</span></span><br><span class="line"> lsmod | grep -e ip_vs -e nf_conntrack_ipv4</span><br></pre></td></tr></table></figure></div>
<p>å®Œæˆä»¥ä¸Šé…ç½®åé‡å¯æœåŠ¡å™¨ ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">reboot</span><br></pre></td></tr></table></figure></div>

<h2 id="2-dockerå®‰è£…"><a href="#2-dockerå®‰è£…" class="headerlink" title="2,dockerå®‰è£…"></a>2,dockerå®‰è£…</h2><ul>
<li>1.Linuxè¦æ±‚å†…æ ¸3.0ä»¥ä¸Š</li>
<li>2.CentOS 7</li>
</ul>
<h3 id="2-1-ç¯å¢ƒæŸ¥çœ‹"><a href="#2-1-ç¯å¢ƒæŸ¥çœ‹" class="headerlink" title="2.1 ç¯å¢ƒæŸ¥çœ‹"></a>2.1 ç¯å¢ƒæŸ¥çœ‹</h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">ç³»ç»Ÿå†…æ ¸è¦æ±‚3.0ä»¥ä¸Š</span></span><br><span class="line">[root@localhost ~]# uname -r</span><br><span class="line">3.10.0-1062.el7.x86_64</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">ç³»ç»Ÿç‰ˆæœ¬</span></span><br><span class="line">[root@localhost ~]# cat /etc/os-release </span><br><span class="line">NAME=&quot;CentOS Linux&quot;</span><br><span class="line">VERSION=&quot;7 (Core)&quot;</span><br><span class="line">ID=&quot;centos&quot;</span><br><span class="line">ID_LIKE=&quot;rhel fedora&quot;</span><br><span class="line">VERSION_ID=&quot;7&quot;</span><br><span class="line">PRETTY_NAME=&quot;CentOS Linux 7 (Core)&quot;</span><br><span class="line">ANSI_COLOR=&quot;0;31&quot;</span><br><span class="line">CPE_NAME=&quot;cpe:/o:centos:centos:7&quot;</span><br><span class="line">HOME_URL=&quot;https://www.centos.org/&quot;</span><br><span class="line">BUG_REPORT_URL=&quot;https://bugs.centos.org/&quot;</span><br><span class="line"></span><br><span class="line">CENTOS_MANTISBT_PROJECT=&quot;CentOS-7&quot;</span><br><span class="line">CENTOS_MANTISBT_PROJECT_VERSION=&quot;7&quot;</span><br><span class="line">REDHAT_SUPPORT_PRODUCT=&quot;centos&quot;</span><br><span class="line">REDHAT_SUPPORT_PRODUCT_VERSION=&quot;7&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<h3 id="2-2-å®‰è£…"><a href="#2-2-å®‰è£…" class="headerlink" title="2.2 å®‰è£…"></a>2.2 å®‰è£…</h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">1.å¸è½½æ—§ç‰ˆæœ¬</span></span><br><span class="line"> yum remove docker \</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">                   docker-client \</span></span><br><span class="line"><span class="bash">&gt;                   docker-client-latest \</span></span><br><span class="line"><span class="bash">&gt;                   docker-common \</span></span><br><span class="line"><span class="bash">&gt;                   docker-latest \</span></span><br><span class="line"><span class="bash">&gt;                   docker-latest-logrotate \</span></span><br><span class="line"><span class="bash">&gt;                   docker-logrotate \</span></span><br><span class="line"><span class="bash">&gt;                   docker-engine</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">2.éœ€è¦çš„å®‰è£…åŒ…</span></span><br><span class="line">yum install -y yum-utils</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">3.è®¾ç½®é•œåƒçš„ä»“åº“</span></span><br><span class="line">yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https://download.docker.com/linux/centos/docker-ce.repo</span><br><span class="line"><span class="meta">#</span><span class="bash">ä¸Šè¿°æ–¹æ³•é»˜è®¤æ˜¯ä»å›½å¤–çš„ï¼Œä¸æ¨è</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">æ¨èä½¿ç”¨å›½å†…çš„</span></span><br><span class="line">yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line">  </span><br><span class="line"><span class="meta">#</span><span class="bash">æ›´æ–°è½¯ä»¶åŒ…ç´¢å¼•</span></span><br><span class="line">yum makecache fast</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">4.å®‰è£…docker docker-ce ç¤¾åŒºç‰ˆ è€Œeeæ˜¯ä¼ä¸šç‰ˆ</span></span><br><span class="line">yum install docker-ce docker-ce-cli containerd.io # è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ç¤¾åŒºç‰ˆå³å¯</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">5.å¯åŠ¨docker</span></span><br><span class="line">systemctl start docker</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">6.ä½¿ç”¨docker version æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸ</span></span><br><span class="line">docker version</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">7.æµ‹è¯•</span></span><br><span class="line">docker run hello-world</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">8.æŸ¥çœ‹ä¸€ä¸‹ä¸‹è½½çš„hello-worldé•œåƒ</span></span><br><span class="line">[root@localhost /]# docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">hello-world         latest              bf756fb1ae65        5 months ago        13.3kB</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<h2 id="3-k8sé›†ç¾¤åˆå§‹åŒ–"><a href="#3-k8sé›†ç¾¤åˆå§‹åŒ–" class="headerlink" title="3,k8sé›†ç¾¤åˆå§‹åŒ–"></a>3,k8sé›†ç¾¤åˆå§‹åŒ–</h2><h3 id="3-1-ç”±äº-kubernetes-çš„é•œåƒæºåœ¨å›½å¤–ï¼Œé€Ÿåº¦æ¯”è¾ƒæ…¢ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åˆ‡æ¢æˆå›½å†…çš„é•œåƒæº"><a href="#3-1-ç”±äº-kubernetes-çš„é•œåƒæºåœ¨å›½å¤–ï¼Œé€Ÿåº¦æ¯”è¾ƒæ…¢ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åˆ‡æ¢æˆå›½å†…çš„é•œåƒæº" class="headerlink" title="3.1 ç”±äº kubernetes çš„é•œåƒæºåœ¨å›½å¤–ï¼Œé€Ÿåº¦æ¯”è¾ƒæ…¢ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åˆ‡æ¢æˆå›½å†…çš„é•œåƒæº"></a>3.1 ç”±äº <code>kubernetes</code> çš„é•œåƒæºåœ¨å›½å¤–ï¼Œé€Ÿåº¦æ¯”è¾ƒæ…¢ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åˆ‡æ¢æˆå›½å†…çš„é•œåƒæº</h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ç¼–è¾‘ /etc/yum.repos.d/kubernetes.repo æ·»åŠ ä¸€ä¸‹é…ç½®</span></span><br><span class="line">vim /etc/yum.repos.d/kubernetes.repo</span><br><span class="line">[kubernetes]</span><br><span class="line">name=Kubernetes</span><br><span class="line">baseurl=http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=0</span><br><span class="line">repo_gpgcheck=0</span><br><span class="line">gpgkey=http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg</span><br><span class="line">http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span><br></pre></td></tr></table></figure></div>

<h3 id="3-2-ç„¶åå®‰è£…kubeadmã€kubeletå’Œkubectl-ä¸‰ä¸ªç»„ä»¶"><a href="#3-2-ç„¶åå®‰è£…kubeadmã€kubeletå’Œkubectl-ä¸‰ä¸ªç»„ä»¶" class="headerlink" title="3.2 ç„¶åå®‰è£…kubeadmã€kubeletå’Œkubectl ä¸‰ä¸ªç»„ä»¶"></a>3.2 ç„¶åå®‰è£…<code>kubeadm</code>ã€<code>kubelet</code>å’Œ<code>kubectl</code> ä¸‰ä¸ªç»„ä»¶</h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">yum install --setopt=obsoletes=0 kubeadm-1.17.4-0 kubelet-1.17.4-0 kubectl-1.17.4-0 -y</span><br></pre></td></tr></table></figure></div>
<h3 id="3-3-é…ç½®-kubelet-çš„group"><a href="#3-3-é…ç½®-kubelet-çš„group" class="headerlink" title="3.3 é…ç½® kubelet çš„group"></a>3.3 é…ç½® kubelet çš„group</h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ç¼–è¾‘ /etc/sysconfig/kubeletï¼Œæ·»åŠ ä¸‹é¢çš„é…ç½®</span></span><br><span class="line">KUBELET_CGROUP_ARGS=&quot;--cgroup-driver=systemd&quot;</span><br><span class="line">KUBE_PROXY_MODE=&quot;ipvs&quot;</span><br></pre></td></tr></table></figure></div>

<h3 id="3-4-åˆå§‹åŒ–é›†ç¾¤ï¼Œä»…åœ¨masterä¸Šæ‰§è¡Œæ­¤æ­¥éª¤"><a href="#3-4-åˆå§‹åŒ–é›†ç¾¤ï¼Œä»…åœ¨masterä¸Šæ‰§è¡Œæ­¤æ­¥éª¤" class="headerlink" title="3.4 åˆå§‹åŒ–é›†ç¾¤ï¼Œä»…åœ¨masterä¸Šæ‰§è¡Œæ­¤æ­¥éª¤"></a>3.4 åˆå§‹åŒ–é›†ç¾¤ï¼Œä»…åœ¨<code>master</code>ä¸Šæ‰§è¡Œæ­¤æ­¥éª¤</h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åˆ›å»ºé›†ç¾¤</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ç”±äºé»˜è®¤æ‹‰å–é•œåƒåœ°å€ k8s.gcr.io å›½å†…æ— æ³•è®¿é—®ï¼Œè¿™é‡ŒæŒ‡å®šé˜¿é‡Œäº‘é•œåƒä»“åº“åœ°å€</span></span><br><span class="line">[root@master ~]# kubeadm init \</span><br><span class="line">--apiserver-advertise-address=192.168.161.1111 \</span><br><span class="line">--image-repository registry.aliyuncs.com/google_containers \</span><br><span class="line">--kubernetes-version=v1.17.4 \</span><br><span class="line">--pod-network-cidr=10.244.0.0/16 \</span><br><span class="line">--service-cidr=10.96.0.0/12 </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">ä½¿ç”¨ kubectl å·¥å…·</span></span><br><span class="line">[root@master ~]# mkdir -p $HOME/.kube</span><br><span class="line">[root@master ~]# sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span><br><span class="line">[root@master ~]# sudo chown $(id -u):$(id -g) $HOME/.kube/config</span><br></pre></td></tr></table></figure></div>

<h3 id="3-5-æŠŠnodeèŠ‚ç‚¹åŠ å…¥é›†ç¾¤"><a href="#3-5-æŠŠnodeèŠ‚ç‚¹åŠ å…¥é›†ç¾¤" class="headerlink" title="3.5 æŠŠnodeèŠ‚ç‚¹åŠ å…¥é›†ç¾¤"></a>3.5 æŠŠ<code>node</code>èŠ‚ç‚¹åŠ å…¥é›†ç¾¤</h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> token åœ¨ä¸Šä¸€æ­¥çš„ç»“æœä¸­</span></span><br><span class="line">kubeadm join 192.168.108.100:6443 --token xxx \ </span><br><span class="line">--discovery-token-ca-cert-hash sha256:xxx</span><br></pre></td></tr></table></figure></div>
<h3 id="3-6-å®‰è£…ç½‘ç»œæ’ä»¶ï¼Œè¿™ä¸€æ­¥ä¹Ÿæ˜¯å¾ˆå¤šæ•™ç¨‹éƒ½ä¼šå‡ºé”™çš„åœ°æ–¹"><a href="#3-6-å®‰è£…ç½‘ç»œæ’ä»¶ï¼Œè¿™ä¸€æ­¥ä¹Ÿæ˜¯å¾ˆå¤šæ•™ç¨‹éƒ½ä¼šå‡ºé”™çš„åœ°æ–¹" class="headerlink" title="3.6 å®‰è£…ç½‘ç»œæ’ä»¶ï¼Œè¿™ä¸€æ­¥ä¹Ÿæ˜¯å¾ˆå¤šæ•™ç¨‹éƒ½ä¼šå‡ºé”™çš„åœ°æ–¹"></a>3.6 å®‰è£…ç½‘ç»œæ’ä»¶ï¼Œè¿™ä¸€æ­¥ä¹Ÿæ˜¯å¾ˆå¤šæ•™ç¨‹éƒ½ä¼šå‡ºé”™çš„åœ°æ–¹</h3><p>kubernetesæ”¯æŒå¤šç§ç½‘ç»œæ’ä»¶ï¼Œæ¯”å¦‚flannelã€calicoã€canalç­‰ç­‰ï¼Œè¿™é‡Œé€‰æ‹©ä½¿ç”¨flanne<br>ä¸‹è½½ flanneld-v0.13.0-amd64.docker ï¼š<a href="https://github.com/flannel-io/flannel/releases/" title="Markdown">ä¸‹è½½åœ°å€</a><br>ä¸‹è½½å®Œæˆåï¼Œä¸Šä¼ è‡³ master æœåŠ¡å™¨ æ‰§è¡Œä»¥ä¸‹å‘½ä»¤</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">docker load &lt; flanneld-v0.13.0-amd64.docker</span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹é•œåƒï¼Œflannel</span></span><br><span class="line">docker images</span><br></pre></td></tr></table></figure></div>
<p>ç„¶åæˆ‘ä»¬éœ€è¦è·å–flannelçš„é…ç½®æ–‡ä»¶æ¥éƒ¨ç½² flannel æœåŠ¡</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> è¿™é‡Œå¾€å¾€ä¼šå¤±è´¥ï¼Œå¾€ä¸‹çœ‹</span></span><br><span class="line">wget https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml</span><br></pre></td></tr></table></figure></div>
<p>ä½†æ˜¯ç”±äºä¼—æ‰€å‘¨çŸ¥çš„ç½‘ç»œçš„åŸå› ï¼Œè¿™ä¸ªæ–‡ä»¶å¹¶ä¸èƒ½ä¿è¯ç½‘ç»œæ’ä»¶å®‰è£…æˆåŠŸï¼Œæ‰€ä»¥æˆ‘åœ¨è¿™é‡Œå‡†å¤‡äº†ä¸€ä¸ªæ–‡ä»¶ï¼Œé•œåƒåœ°å€å·²ç»æ›´æ¢é˜¿é‡Œæ•°æ®æºï¼›</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">wget https://github.com/BugKillerPro/blog_config_files/blob/main/kube-flannel.yml</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä½¿ç”¨é…ç½®æ–‡ä»¶å¯åŠ¨fannel</span></span><br><span class="line">kubectl apply -f kube-flannel.yml</span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹é›†ç¾¤èŠ‚ç‚¹çš„çŠ¶æ€</span></span><br><span class="line">kubectl get nodes</span><br></pre></td></tr></table></figure></div>
<p><img src="/2022/02/17/uncatalog/ckzqm8tm30000dwr70rq7714w/img_1.png" alt="img_1.png"></p>
<p>STATUSå…¨éƒ¨Readyå°±æˆåŠŸäº†ï¼Œç½‘ä¸Šçš„å…¶ä»–æ•™ç¨‹ï¼Œé—®é¢˜å¤§éƒ½æ— æ³•å…¨éƒ¨Ready.</p>
<h2 id="3-k8sé›†ç¾¤æµ‹è¯•"><a href="#3-k8sé›†ç¾¤æµ‹è¯•" class="headerlink" title="3,k8sé›†ç¾¤æµ‹è¯•"></a>3,k8sé›†ç¾¤æµ‹è¯•</h2><p>é›†ç¾¤å·²æ­å»ºå®Œæˆï¼Œæˆ‘ä»¬å†åˆ›å»ºä¸€ä¸ªNginxæœåŠ¡æµ‹è¯•ä¸‹</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">åˆ›å»ºä¸€ä¸ªnginxæœåŠ¡</span></span><br><span class="line">kubectl create deployment nginx  --image=nginx:1.14-alpine</span><br><span class="line"><span class="meta">#</span><span class="bash">æš´éœ²ç«¯å£</span></span><br><span class="line">kubectl expose deploy nginx  --port=80 --target-port=80  --type=NodePort</span><br><span class="line"><span class="meta">#</span><span class="bash">æŸ¥çœ‹æœåŠ¡</span></span><br><span class="line">kubectl get pod,svc</span><br></pre></td></tr></table></figure></div>
<p><img src="/2022/02/17/uncatalog/ckzqm8tm30000dwr70rq7714w/img_2.png" alt="img_2.png"></p>
<p><img src="/2022/02/17/uncatalog/ckzqm8tm30000dwr70rq7714w/img_3.png" alt="img_3.png"></p>
]]></content>
      <tags>
        <tag>äº‘åŸç”ŸåŸºç¡€ç³»åˆ—</tag>
        <tag>Kubernetes</tag>
      </tags>
  </entry>
  <entry>
    <title>äº‘åŸç”ŸåŸºç¡€ç³»åˆ—ä¹‹Kubernetes(ä¸‰)èµ„æºç®¡ç†</title>
    <url>/2022/06/09/uncatalog/cl46zbaxk00017or7fpbp30br/</url>
    <content><![CDATA[<hr>
<span id="more"></span>



<hr>
<h3 id="3-èµ„æºç®¡ç†"><a href="#3-èµ„æºç®¡ç†" class="headerlink" title="3. èµ„æºç®¡ç†"></a>3. èµ„æºç®¡ç†</h3><h4 id="3-1-èµ„æºç®¡ç†ä»‹ç»"><a href="#3-1-èµ„æºç®¡ç†ä»‹ç»" class="headerlink" title="3.1 èµ„æºç®¡ç†ä»‹ç»"></a>3.1 èµ„æºç®¡ç†ä»‹ç»</h4><p>åœ¨kubernetesä¸­ï¼Œæ‰€æœ‰çš„å†…å®¹éƒ½æŠ½è±¡ä¸ºèµ„æºï¼Œç”¨æˆ·éœ€è¦é€šè¿‡æ“ä½œèµ„æºæ¥ç®¡ç†kubernetesã€‚</p>
<blockquote>
<p>kubernetesçš„æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªé›†ç¾¤ç³»ç»Ÿï¼Œç”¨æˆ·å¯ä»¥åœ¨é›†ç¾¤ä¸­éƒ¨ç½²å„ç§æœåŠ¡ï¼Œæ‰€è°“çš„éƒ¨ç½²æœåŠ¡ï¼Œå…¶å®å°±æ˜¯åœ¨kubernetesé›†ç¾¤ä¸­è¿è¡Œä¸€ä¸ªä¸ªçš„å®¹å™¨ï¼Œå¹¶å°†æŒ‡å®šçš„ç¨‹åºè·‘åœ¨å®¹å™¨ä¸­ã€‚</p>
<p>kubernetesçš„æœ€å°ç®¡ç†å•å…ƒæ˜¯podè€Œä¸æ˜¯å®¹å™¨ï¼Œæ‰€ä»¥åªèƒ½å°†å®¹å™¨æ”¾åœ¨<code>Pod</code>ä¸­ï¼Œè€Œkubernetesä¸€èˆ¬ä¹Ÿä¸ä¼šç›´æ¥ç®¡ç†Podï¼Œè€Œæ˜¯é€šè¿‡<code>Podæ§åˆ¶å™¨</code>æ¥ç®¡ç†Podçš„ã€‚</p>
<p>Podå¯ä»¥æä¾›æœåŠ¡ä¹‹åï¼Œå°±è¦è€ƒè™‘å¦‚ä½•è®¿é—®Podä¸­æœåŠ¡ï¼Œkubernetesæä¾›äº†<code>Service</code>èµ„æºå®ç°è¿™ä¸ªåŠŸèƒ½ã€‚</p>
<p>å½“ç„¶ï¼Œå¦‚æœPodä¸­ç¨‹åºçš„æ•°æ®éœ€è¦æŒä¹…åŒ–ï¼Œkubernetesè¿˜æä¾›äº†å„ç§<code>å­˜å‚¨</code>ç³»ç»Ÿã€‚</p>
</blockquote>
<p><img src="/2022/06/09/uncatalog/cl46zbaxk00017or7fpbp30br/image-20200406225334627.png" alt="image-20200406225334627"></p>
<blockquote>
<p>å­¦ä¹ kubernetesçš„æ ¸å¿ƒï¼Œå°±æ˜¯å­¦ä¹ å¦‚ä½•å¯¹é›†ç¾¤ä¸Šçš„<code>Podã€Podæ§åˆ¶å™¨ã€Serviceã€å­˜å‚¨</code>ç­‰å„ç§èµ„æºè¿›è¡Œæ“ä½œ</p>
</blockquote>
<h4 id="3-2-YAMLè¯­è¨€ä»‹ç»"><a href="#3-2-YAMLè¯­è¨€ä»‹ç»" class="headerlink" title="3.2 YAMLè¯­è¨€ä»‹ç»"></a>3.2 YAMLè¯­è¨€ä»‹ç»</h4><p>YAMLæ˜¯ä¸€ä¸ªç±»ä¼¼ XMLã€JSON çš„æ ‡è®°æ€§è¯­è¨€ã€‚å®ƒå¼ºè°ƒä»¥<strong>æ•°æ®</strong>ä¸ºä¸­å¿ƒï¼Œå¹¶ä¸æ˜¯ä»¥æ ‡è¯†è¯­è¨€ä¸ºé‡ç‚¹ã€‚å› è€ŒYAMLæœ¬èº«çš„å®šä¹‰æ¯”è¾ƒç®€å•ï¼Œå·ç§°â€ä¸€ç§äººæ€§åŒ–çš„æ•°æ®æ ¼å¼è¯­è¨€â€ã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="code"><pre><span class="line">&lt;heima&gt;</span><br><span class="line">    &lt;age&gt;15&lt;&#x2F;age&gt;</span><br><span class="line">    &lt;address&gt;Beijing&lt;&#x2F;address&gt;</span><br><span class="line">&lt;&#x2F;heima&gt;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="code"><pre><span class="line">heima:</span><br><span class="line">  age: 15</span><br><span class="line">  address: Beijing</span><br></pre></td></tr></table></figure></div>

<p>YAMLçš„è¯­æ³•æ¯”è¾ƒç®€å•ï¼Œä¸»è¦æœ‰ä¸‹é¢å‡ ä¸ªï¼š</p>
<ul>
<li>å¤§å°å†™æ•æ„Ÿ</li>
<li>ä½¿ç”¨ç¼©è¿›è¡¨ç¤ºå±‚çº§å…³ç³»</li>
<li>ç¼©è¿›ä¸å…è®¸ä½¿ç”¨tabï¼Œåªå…è®¸ç©ºæ ¼( ä½ç‰ˆæœ¬é™åˆ¶ )</li>
<li>ç¼©è¿›çš„ç©ºæ ¼æ•°ä¸é‡è¦ï¼Œåªè¦ç›¸åŒå±‚çº§çš„å…ƒç´ å·¦å¯¹é½å³å¯</li>
<li>â€˜#â€™è¡¨ç¤ºæ³¨é‡Š</li>
</ul>
<p>YAMLæ”¯æŒä»¥ä¸‹å‡ ç§æ•°æ®ç±»å‹ï¼š</p>
<ul>
<li>çº¯é‡ï¼šå•ä¸ªçš„ã€ä¸å¯å†åˆ†çš„å€¼</li>
<li>å¯¹è±¡ï¼šé”®å€¼å¯¹çš„é›†åˆï¼Œåˆç§°ä¸ºæ˜ å°„ï¼ˆmappingï¼‰/ å“ˆå¸Œï¼ˆhashï¼‰ / å­—å…¸ï¼ˆdictionaryï¼‰</li>
<li>æ•°ç»„ï¼šä¸€ç»„æŒ‰æ¬¡åºæ’åˆ—çš„å€¼ï¼Œåˆç§°ä¸ºåºåˆ—ï¼ˆsequenceï¼‰ / åˆ—è¡¨ï¼ˆlistï¼‰</li>
</ul>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YML"><figure class="iseeu highlight /yml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># çº¯é‡, å°±æ˜¯æŒ‡çš„ä¸€ä¸ªç®€å•çš„å€¼ï¼Œå­—ç¬¦ä¸²ã€å¸ƒå°”å€¼ã€æ•´æ•°ã€æµ®ç‚¹æ•°ã€Nullã€æ—¶é—´ã€æ—¥æœŸ</span></span><br><span class="line"><span class="comment"># 1 å¸ƒå°”ç±»å‹</span></span><br><span class="line"><span class="attr">c1:</span> <span class="literal">true</span> <span class="string">(æˆ–è€…True)</span></span><br><span class="line"><span class="comment"># 2 æ•´å‹</span></span><br><span class="line"><span class="attr">c2:</span> <span class="number">234</span></span><br><span class="line"><span class="comment"># 3 æµ®ç‚¹å‹</span></span><br><span class="line"><span class="attr">c3:</span> <span class="number">3.14</span></span><br><span class="line"><span class="comment"># 4 nullç±»å‹ </span></span><br><span class="line"><span class="attr">c4:</span> <span class="string">~</span>  <span class="comment"># ä½¿ç”¨~è¡¨ç¤ºnull</span></span><br><span class="line"><span class="comment"># 5 æ—¥æœŸç±»å‹</span></span><br><span class="line"><span class="attr">c5:</span> <span class="number">2018-02-17</span>    <span class="comment"># æ—¥æœŸå¿…é¡»ä½¿ç”¨ISO 8601æ ¼å¼ï¼Œå³yyyy-MM-dd</span></span><br><span class="line"><span class="comment"># 6 æ—¶é—´ç±»å‹</span></span><br><span class="line"><span class="attr">c6:</span> <span class="number">2018-02-17T15:02:31+08:00</span>  <span class="comment"># æ—¶é—´ä½¿ç”¨ISO 8601æ ¼å¼ï¼Œæ—¶é—´å’Œæ—¥æœŸä¹‹é—´ä½¿ç”¨Tè¿æ¥ï¼Œæœ€åä½¿ç”¨+ä»£è¡¨æ—¶åŒº</span></span><br><span class="line"><span class="comment"># 7 å­—ç¬¦ä¸²ç±»å‹</span></span><br><span class="line"><span class="attr">c7:</span> <span class="string">heima</span>     <span class="comment"># ç®€å•å†™æ³•ï¼Œç›´æ¥å†™å€¼ , å¦‚æœå­—ç¬¦ä¸²ä¸­é—´æœ‰ç‰¹æ®Šå­—ç¬¦ï¼Œå¿…é¡»ä½¿ç”¨åŒå¼•å·æˆ–è€…å•å¼•å·åŒ…è£¹ </span></span><br><span class="line"><span class="attr">c8:</span> <span class="string">line1</span></span><br><span class="line">    <span class="string">line2</span>     <span class="comment"># å­—ç¬¦ä¸²è¿‡å¤šçš„æƒ…å†µå¯ä»¥æ‹†æˆå¤šè¡Œï¼Œæ¯ä¸€è¡Œä¼šè¢«è½¬åŒ–æˆä¸€ä¸ªç©ºæ ¼</span></span><br></pre></td></tr></table></figure></div>



<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å¯¹è±¡</span></span><br><span class="line"><span class="comment"># å½¢å¼ä¸€(æ¨è):</span></span><br><span class="line"><span class="attr">heima:</span></span><br><span class="line">  <span class="attr">age:</span> <span class="number">15</span></span><br><span class="line">  <span class="attr">address:</span> <span class="string">Beijing</span></span><br><span class="line"><span class="comment"># å½¢å¼äºŒ(äº†è§£):</span></span><br><span class="line"><span class="attr">heima:</span> &#123;<span class="attr">age:</span> <span class="number">15</span>,<span class="attr">address:</span> <span class="string">Beijing</span>&#125;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ•°ç»„</span></span><br><span class="line"><span class="comment"># å½¢å¼ä¸€(æ¨è):</span></span><br><span class="line"><span class="attr">address:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">é¡ºä¹‰</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">æ˜Œå¹³</span>  </span><br><span class="line"><span class="comment"># å½¢å¼äºŒ(äº†è§£):</span></span><br><span class="line"><span class="attr">address:</span> [<span class="string">é¡ºä¹‰</span>,<span class="string">æ˜Œå¹³</span>]</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>å°æç¤ºï¼š</p>
<p>1 ä¹¦å†™yamlåˆ‡è®°<code>:</code> åé¢è¦åŠ ä¸€ä¸ªç©ºæ ¼</p>
<p>2 å¦‚æœéœ€è¦å°†å¤šæ®µyamlé…ç½®æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œä¸­é—´è¦ä½¿ç”¨<code>---</code>åˆ†éš”</p>
<p>3 ä¸‹é¢æ˜¯ä¸€ä¸ªyamlè½¬jsonçš„ç½‘ç«™ï¼Œå¯ä»¥é€šè¿‡å®ƒéªŒè¯yamlæ˜¯å¦ä¹¦å†™æ­£ç¡®</p>
<p><a href="https://www.json2yaml.com/convert-yaml-to-json">https://www.json2yaml.com/convert-yaml-to-json</a></p>
</blockquote>
<h4 id="3-3-èµ„æºç®¡ç†æ–¹å¼"><a href="#3-3-èµ„æºç®¡ç†æ–¹å¼" class="headerlink" title="3.3 èµ„æºç®¡ç†æ–¹å¼"></a>3.3 èµ„æºç®¡ç†æ–¹å¼</h4><ul>
<li><p>å‘½ä»¤å¼å¯¹è±¡ç®¡ç†ï¼šç›´æ¥ä½¿ç”¨å‘½ä»¤å»æ“ä½œkubernetesèµ„æº</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="POWERSHELL"><figure class="iseeu highlight /powershell"><table><tr><td class="code"><pre><span class="line">kubectl run nginx<span class="literal">-pod</span> -<span class="literal">-image</span>=nginx:<span class="number">1.17</span>.<span class="number">1</span> -<span class="literal">-port</span>=<span class="number">80</span></span><br></pre></td></tr></table></figure></div></li>
<li><p>å‘½ä»¤å¼å¯¹è±¡é…ç½®ï¼šé€šè¿‡å‘½ä»¤é…ç½®å’Œé…ç½®æ–‡ä»¶å»æ“ä½œkubernetesèµ„æº</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="POWERSHELL"><figure class="iseeu highlight /powershell"><table><tr><td class="code"><pre><span class="line">kubectl create/patch <span class="operator">-f</span> nginx<span class="literal">-pod</span>.yaml</span><br></pre></td></tr></table></figure></div></li>
<li><p>å£°æ˜å¼å¯¹è±¡é…ç½®ï¼šé€šè¿‡applyå‘½ä»¤å’Œé…ç½®æ–‡ä»¶å»æ“ä½œkubernetesèµ„æº</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="POWERSHELL"><figure class="iseeu highlight /powershell"><table><tr><td class="code"><pre><span class="line">kubectl apply <span class="operator">-f</span> nginx<span class="literal">-pod</span>.yaml</span><br></pre></td></tr></table></figure></div></li>
</ul>
<table>
<thead>
<tr>
<th align="left">ç±»å‹</th>
<th align="left">æ“ä½œå¯¹è±¡</th>
<th align="left">é€‚ç”¨ç¯å¢ƒ</th>
<th align="left">ä¼˜ç‚¹</th>
<th align="left">ç¼ºç‚¹</th>
</tr>
</thead>
<tbody><tr>
<td align="left">å‘½ä»¤å¼å¯¹è±¡ç®¡ç†</td>
<td align="left">å¯¹è±¡</td>
<td align="left">æµ‹è¯•</td>
<td align="left">ç®€å•</td>
<td align="left">åªèƒ½æ“ä½œæ´»åŠ¨å¯¹è±¡ï¼Œæ— æ³•å®¡è®¡ã€è·Ÿè¸ª</td>
</tr>
<tr>
<td align="left">å‘½ä»¤å¼å¯¹è±¡é…ç½®</td>
<td align="left">æ–‡ä»¶</td>
<td align="left">å¼€å‘</td>
<td align="left">å¯ä»¥å®¡è®¡ã€è·Ÿè¸ª</td>
<td align="left">é¡¹ç›®å¤§æ—¶ï¼Œé…ç½®æ–‡ä»¶å¤šï¼Œæ“ä½œéº»çƒ¦</td>
</tr>
<tr>
<td align="left">å£°æ˜å¼å¯¹è±¡é…ç½®</td>
<td align="left">ç›®å½•</td>
<td align="left">å¼€å‘</td>
<td align="left">æ”¯æŒç›®å½•æ“ä½œ</td>
<td align="left">æ„å¤–æƒ…å†µä¸‹éš¾ä»¥è°ƒè¯•</td>
</tr>
</tbody></table>
<h5 id="3-3-1-å‘½ä»¤å¼å¯¹è±¡ç®¡ç†"><a href="#3-3-1-å‘½ä»¤å¼å¯¹è±¡ç®¡ç†" class="headerlink" title="3.3.1 å‘½ä»¤å¼å¯¹è±¡ç®¡ç†"></a>3.3.1 å‘½ä»¤å¼å¯¹è±¡ç®¡ç†</h5><p><strong>kubectlå‘½ä»¤</strong></p>
<p>kubectlæ˜¯kubernetesé›†ç¾¤çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œé€šè¿‡å®ƒèƒ½å¤Ÿå¯¹é›†ç¾¤æœ¬èº«è¿›è¡Œç®¡ç†ï¼Œå¹¶èƒ½å¤Ÿåœ¨é›†ç¾¤ä¸Šè¿›è¡Œå®¹å™¨åŒ–åº”ç”¨çš„å®‰è£…éƒ¨ç½²ã€‚kubectlå‘½ä»¤çš„è¯­æ³•å¦‚ä¸‹ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="code"><pre><span class="line">kubectl [command] [type] [name] [flags]</span><br></pre></td></tr></table></figure></div>

<p><strong>comand</strong>ï¼šæŒ‡å®šè¦å¯¹èµ„æºæ‰§è¡Œçš„æ“ä½œï¼Œä¾‹å¦‚createã€getã€delete</p>
<p><strong>type</strong>ï¼šæŒ‡å®šèµ„æºç±»å‹ï¼Œæ¯”å¦‚deploymentã€podã€service</p>
<p><strong>name</strong>ï¼šæŒ‡å®šèµ„æºçš„åç§°ï¼Œåç§°å¤§å°å†™æ•æ„Ÿ</p>
<p><strong>flags</strong>ï¼šæŒ‡å®šé¢å¤–çš„å¯é€‰å‚æ•°</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹æ‰€æœ‰pod</span></span><br><span class="line">kubectl get pod </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹æŸä¸ªpod</span></span><br><span class="line">kubectl get pod pod_name</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹æŸä¸ªpod,ä»¥yamlæ ¼å¼å±•ç¤ºç»“æœ</span></span><br><span class="line">kubectl get pod pod_name -o yaml</span><br></pre></td></tr></table></figure></div>

<p><strong>èµ„æºç±»å‹</strong></p>
<p>kubernetesä¸­æ‰€æœ‰çš„å†…å®¹éƒ½æŠ½è±¡ä¸ºèµ„æºï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤è¿›è¡ŒæŸ¥çœ‹:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="code"><pre><span class="line">kubectl api-resources</span><br></pre></td></tr></table></figure></div>

<p>ç»å¸¸ä½¿ç”¨çš„èµ„æºæœ‰ä¸‹é¢è¿™äº›ï¼š</p>
<table>
<thead>
<tr>
<th align="left">èµ„æºåˆ†ç±»</th>
<th align="left">èµ„æºåç§°</th>
<th align="left">ç¼©å†™</th>
<th align="left">èµ„æºä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td align="left">é›†ç¾¤çº§åˆ«èµ„æº</td>
<td align="left">nodes</td>
<td align="left">no</td>
<td align="left">é›†ç¾¤ç»„æˆéƒ¨åˆ†</td>
</tr>
<tr>
<td align="left">namespaces</td>
<td align="left">ns</td>
<td align="left">éš”ç¦»Pod</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">podèµ„æº</td>
<td align="left">pods</td>
<td align="left">po</td>
<td align="left">è£…è½½å®¹å™¨</td>
</tr>
<tr>
<td align="left">podèµ„æºæ§åˆ¶å™¨</td>
<td align="left">replicationcontrollers</td>
<td align="left">rc</td>
<td align="left">æ§åˆ¶podèµ„æº</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">replicasets</td>
<td align="left">rs</td>
<td align="left">æ§åˆ¶podèµ„æº</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">deployments</td>
<td align="left">deploy</td>
<td align="left">æ§åˆ¶podèµ„æº</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">daemonsets</td>
<td align="left">ds</td>
<td align="left">æ§åˆ¶podèµ„æº</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">jobs</td>
<td align="left"></td>
<td align="left">æ§åˆ¶podèµ„æº</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">cronjobs</td>
<td align="left">cj</td>
<td align="left">æ§åˆ¶podèµ„æº</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">horizontalpodautoscalers</td>
<td align="left">hpa</td>
<td align="left">æ§åˆ¶podèµ„æº</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">statefulsets</td>
<td align="left">sts</td>
<td align="left">æ§åˆ¶podèµ„æº</td>
</tr>
<tr>
<td align="left">æœåŠ¡å‘ç°èµ„æº</td>
<td align="left">services</td>
<td align="left">svc</td>
<td align="left">ç»Ÿä¸€podå¯¹å¤–æ¥å£</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">ingress</td>
<td align="left">ing</td>
<td align="left">ç»Ÿä¸€podå¯¹å¤–æ¥å£</td>
</tr>
<tr>
<td align="left">å­˜å‚¨èµ„æº</td>
<td align="left">volumeattachments</td>
<td align="left"></td>
<td align="left">å­˜å‚¨</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">persistentvolumes</td>
<td align="left">pv</td>
<td align="left">å­˜å‚¨</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">persistentvolumeclaims</td>
<td align="left">pvc</td>
<td align="left">å­˜å‚¨</td>
</tr>
<tr>
<td align="left">é…ç½®èµ„æº</td>
<td align="left">configmaps</td>
<td align="left">cm</td>
<td align="left">é…ç½®</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">secrets</td>
<td align="left"></td>
<td align="left">é…ç½®</td>
</tr>
</tbody></table>
<p><strong>æ“ä½œ</strong></p>
<p>kuberneteså…è®¸å¯¹èµ„æºè¿›è¡Œå¤šç§æ“ä½œï¼Œå¯ä»¥é€šè¿‡â€“helpæŸ¥çœ‹è¯¦ç»†çš„æ“ä½œå‘½ä»¤</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="code"><pre><span class="line">kubectl --help</span><br></pre></td></tr></table></figure></div>

<p>ç»å¸¸ä½¿ç”¨çš„æ“ä½œæœ‰ä¸‹é¢è¿™äº›ï¼š</p>
<table>
<thead>
<tr>
<th align="left">å‘½ä»¤åˆ†ç±»</th>
<th align="left">å‘½ä»¤</th>
<th align="left">ç¿»è¯‘</th>
<th align="left">å‘½ä»¤ä½œç”¨</th>
</tr>
</thead>
<tbody><tr>
<td align="left">åŸºæœ¬å‘½ä»¤</td>
<td align="left">create</td>
<td align="left">åˆ›å»º</td>
<td align="left">åˆ›å»ºä¸€ä¸ªèµ„æº</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">edit</td>
<td align="left">ç¼–è¾‘</td>
<td align="left">ç¼–è¾‘ä¸€ä¸ªèµ„æº</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">get</td>
<td align="left">è·å–</td>
<td align="left">è·å–ä¸€ä¸ªèµ„æº</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">patch</td>
<td align="left">æ›´æ–°</td>
<td align="left">æ›´æ–°ä¸€ä¸ªèµ„æº</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">delete</td>
<td align="left">åˆ é™¤</td>
<td align="left">åˆ é™¤ä¸€ä¸ªèµ„æº</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">explain</td>
<td align="left">è§£é‡Š</td>
<td align="left">å±•ç¤ºèµ„æºæ–‡æ¡£</td>
</tr>
<tr>
<td align="left">è¿è¡Œå’Œè°ƒè¯•</td>
<td align="left">run</td>
<td align="left">è¿è¡Œ</td>
<td align="left">åœ¨é›†ç¾¤ä¸­è¿è¡Œä¸€ä¸ªæŒ‡å®šçš„é•œåƒ</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">expose</td>
<td align="left">æš´éœ²</td>
<td align="left">æš´éœ²èµ„æºä¸ºService</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">describe</td>
<td align="left">æè¿°</td>
<td align="left">æ˜¾ç¤ºèµ„æºå†…éƒ¨ä¿¡æ¯</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">logs</td>
<td align="left">æ—¥å¿—è¾“å‡ºå®¹å™¨åœ¨ pod ä¸­çš„æ—¥å¿—</td>
<td align="left">è¾“å‡ºå®¹å™¨åœ¨ pod ä¸­çš„æ—¥å¿—</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">attach</td>
<td align="left">ç¼ ç»•è¿›å…¥è¿è¡Œä¸­çš„å®¹å™¨</td>
<td align="left">è¿›å…¥è¿è¡Œä¸­çš„å®¹å™¨</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">exec</td>
<td align="left">æ‰§è¡Œå®¹å™¨ä¸­çš„ä¸€ä¸ªå‘½ä»¤</td>
<td align="left">æ‰§è¡Œå®¹å™¨ä¸­çš„ä¸€ä¸ªå‘½ä»¤</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">cp</td>
<td align="left">å¤åˆ¶</td>
<td align="left">åœ¨Podå†…å¤–å¤åˆ¶æ–‡ä»¶</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">rollout</td>
<td align="left">é¦–æ¬¡å±•ç¤º</td>
<td align="left">ç®¡ç†èµ„æºçš„å‘å¸ƒ</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">scale</td>
<td align="left">è§„æ¨¡</td>
<td align="left">æ‰©(ç¼©)å®¹Podçš„æ•°é‡</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">autoscale</td>
<td align="left">è‡ªåŠ¨è°ƒæ•´</td>
<td align="left">è‡ªåŠ¨è°ƒæ•´Podçš„æ•°é‡</td>
</tr>
<tr>
<td align="left">é«˜çº§å‘½ä»¤</td>
<td align="left">apply</td>
<td align="left">rc</td>
<td align="left">é€šè¿‡æ–‡ä»¶å¯¹èµ„æºè¿›è¡Œé…ç½®</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">label</td>
<td align="left">æ ‡ç­¾</td>
<td align="left">æ›´æ–°èµ„æºä¸Šçš„æ ‡ç­¾</td>
</tr>
<tr>
<td align="left">å…¶ä»–å‘½ä»¤</td>
<td align="left">cluster-info</td>
<td align="left">é›†ç¾¤ä¿¡æ¯</td>
<td align="left">æ˜¾ç¤ºé›†ç¾¤ä¿¡æ¯</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">version</td>
<td align="left">ç‰ˆæœ¬</td>
<td align="left">æ˜¾ç¤ºå½“å‰Serverå’ŒClientçš„ç‰ˆæœ¬</td>
</tr>
</tbody></table>
<p>ä¸‹é¢ä»¥ä¸€ä¸ªnamespace / podçš„åˆ›å»ºå’Œåˆ é™¤ç®€å•æ¼”ç¤ºä¸‹å‘½ä»¤çš„ä½¿ç”¨ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åˆ›å»ºä¸€ä¸ªnamespace</span></span><br><span class="line">[root@master ~]# kubectl create namespace dev</span><br><span class="line">namespace/dev created</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> è·å–namespace</span></span><br><span class="line">[root@master ~]# kubectl get ns</span><br><span class="line">NAME              STATUS   AGE</span><br><span class="line">default           Active   21h</span><br><span class="line">dev               Active   21s</span><br><span class="line">kube-node-lease   Active   21h</span><br><span class="line">kube-public       Active   21h</span><br><span class="line">kube-system       Active   21h</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> åœ¨æ­¤namespaceä¸‹åˆ›å»ºå¹¶è¿è¡Œä¸€ä¸ªnginxçš„Pod</span></span><br><span class="line">[root@master ~]# kubectl run pod --image=nginx:latest -n dev</span><br><span class="line">kubectl run --generator=deployment/apps.v1 is DEPRECATED and will be removed in a future version. Use kubectl run --generator=run-pod/v1 or kubectl create instead.</span><br><span class="line">deployment.apps/pod created</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹æ–°åˆ›å»ºçš„pod</span></span><br><span class="line">[root@master ~]# kubectl get pod -n dev</span><br><span class="line">NAME  READY   STATUS    RESTARTS   AGE</span><br><span class="line">pod   1/1     Running   0          21s</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆ é™¤æŒ‡å®šçš„pod</span></span><br><span class="line">[root@master ~]# kubectl delete pod pod-864f9875b9-pcw7x</span><br><span class="line">pod &quot;pod&quot; deleted</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆ é™¤æŒ‡å®šçš„namespace</span></span><br><span class="line">[root@master ~]# kubectl delete ns dev</span><br><span class="line">namespace &quot;dev&quot; deleted</span><br></pre></td></tr></table></figure></div>

<h5 id="3-3-2-å‘½ä»¤å¼å¯¹è±¡é…ç½®"><a href="#3-3-2-å‘½ä»¤å¼å¯¹è±¡é…ç½®" class="headerlink" title="3.3.2 å‘½ä»¤å¼å¯¹è±¡é…ç½®"></a>3.3.2 å‘½ä»¤å¼å¯¹è±¡é…ç½®</h5><p>å‘½ä»¤å¼å¯¹è±¡é…ç½®å°±æ˜¯ä½¿ç”¨å‘½ä»¤é…åˆé…ç½®æ–‡ä»¶ä¸€èµ·æ¥æ“ä½œkubernetesèµ„æºã€‚</p>
<p>1ï¼‰ åˆ›å»ºä¸€ä¸ªnginxpod.yamlï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Namespace</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">dev</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginxpod</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx-containers</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:latest</span></span><br></pre></td></tr></table></figure></div>

<p>2ï¼‰æ‰§è¡Œcreateå‘½ä»¤ï¼Œåˆ›å»ºèµ„æºï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="POWERSHELL"><figure class="iseeu highlight /powershell"><table><tr><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">master</span> ~]<span class="comment"># kubectl create -f nginxpod.yaml</span></span><br><span class="line">namespace/dev created</span><br><span class="line">pod/nginxpod created</span><br></pre></td></tr></table></figure></div>

<p>æ­¤æ—¶å‘ç°åˆ›å»ºäº†ä¸¤ä¸ªèµ„æºå¯¹è±¡ï¼Œåˆ†åˆ«æ˜¯namespaceå’Œpod</p>
<p>3ï¼‰æ‰§è¡Œgetå‘½ä»¤ï¼ŒæŸ¥çœ‹èµ„æºï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">[root@master ~]#  kubectl get -f nginxpod.yaml</span><br><span class="line">NAME            STATUS   AGE</span><br><span class="line">namespace/dev   Active   18s</span><br><span class="line"></span><br><span class="line">NAME            READY   STATUS    RESTARTS   AGE</span><br><span class="line">pod/nginxpod    1/1     Running   0          17s</span><br></pre></td></tr></table></figure></div>

<p>è¿™æ ·å°±æ˜¾ç¤ºäº†ä¸¤ä¸ªèµ„æºå¯¹è±¡çš„ä¿¡æ¯</p>
<p>4ï¼‰æ‰§è¡Œdeleteå‘½ä»¤ï¼Œåˆ é™¤èµ„æºï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">[root@master ~]# kubectl delete -f nginxpod.yaml</span><br><span class="line">namespace &quot;dev&quot; deleted</span><br><span class="line">pod &quot;nginxpod&quot; deleted</span><br></pre></td></tr></table></figure></div>

<p>æ­¤æ—¶å‘ç°ä¸¤ä¸ªèµ„æºå¯¹è±¡è¢«åˆ é™¤äº†</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="code"><pre><span class="line">æ€»ç»“:</span><br><span class="line">    å‘½ä»¤å¼å¯¹è±¡é…ç½®çš„æ–¹å¼æ“ä½œèµ„æºï¼Œå¯ä»¥ç®€å•çš„è®¤ä¸ºï¼šå‘½ä»¤  +  yamlé…ç½®æ–‡ä»¶ï¼ˆé‡Œé¢æ˜¯å‘½ä»¤éœ€è¦çš„å„ç§å‚æ•°ï¼‰</span><br></pre></td></tr></table></figure></div>

<h5 id="3-3-3-å£°æ˜å¼å¯¹è±¡é…ç½®"><a href="#3-3-3-å£°æ˜å¼å¯¹è±¡é…ç½®" class="headerlink" title="3.3.3 å£°æ˜å¼å¯¹è±¡é…ç½®"></a>3.3.3 å£°æ˜å¼å¯¹è±¡é…ç½®</h5><p>å£°æ˜å¼å¯¹è±¡é…ç½®è·Ÿå‘½ä»¤å¼å¯¹è±¡é…ç½®å¾ˆç›¸ä¼¼ï¼Œä½†æ˜¯å®ƒåªæœ‰ä¸€ä¸ªå‘½ä»¤applyã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> é¦–å…ˆæ‰§è¡Œä¸€æ¬¡kubectl apply -f yamlæ–‡ä»¶ï¼Œå‘ç°åˆ›å»ºäº†èµ„æº</span></span><br><span class="line">[root@master ~]#  kubectl apply -f nginxpod.yaml</span><br><span class="line">namespace/dev created</span><br><span class="line">pod/nginxpod created</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å†æ¬¡æ‰§è¡Œä¸€æ¬¡kubectl apply -f yamlæ–‡ä»¶ï¼Œå‘ç°è¯´èµ„æºæ²¡æœ‰å˜åŠ¨</span></span><br><span class="line">[root@master ~]#  kubectl apply -f nginxpod.yaml</span><br><span class="line">namespace/dev unchanged</span><br><span class="line">pod/nginxpod unchanged</span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="POWERSHELL"><figure class="iseeu highlight /powershell"><table><tr><td class="code"><pre><span class="line">æ€»ç»“:</span><br><span class="line">    å…¶å®å£°æ˜å¼å¯¹è±¡é…ç½®å°±æ˜¯ä½¿ç”¨applyæè¿°ä¸€ä¸ªèµ„æºæœ€ç»ˆçš„çŠ¶æ€ï¼ˆåœ¨yamlä¸­å®šä¹‰çŠ¶æ€ï¼‰</span><br><span class="line">    ä½¿ç”¨applyæ“ä½œèµ„æºï¼š</span><br><span class="line">        å¦‚æœèµ„æºä¸å­˜åœ¨ï¼Œå°±åˆ›å»ºï¼Œç›¸å½“äº kubectl create</span><br><span class="line">        å¦‚æœèµ„æºå·²å­˜åœ¨ï¼Œå°±æ›´æ–°ï¼Œç›¸å½“äº kubectl patch</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>æ‰©å±•ï¼škubectlå¯ä»¥åœ¨nodeèŠ‚ç‚¹ä¸Šè¿è¡Œå— ?</p>
</blockquote>
<p>kubectlçš„è¿è¡Œæ˜¯éœ€è¦è¿›è¡Œé…ç½®çš„ï¼Œå®ƒçš„é…ç½®æ–‡ä»¶æ˜¯$HOME/.kubeï¼Œå¦‚æœæƒ³è¦åœ¨nodeèŠ‚ç‚¹è¿è¡Œæ­¤å‘½ä»¤ï¼Œéœ€è¦å°†masterä¸Šçš„.kubeæ–‡ä»¶å¤åˆ¶åˆ°nodeèŠ‚ç‚¹ä¸Šï¼Œå³åœ¨masterèŠ‚ç‚¹ä¸Šæ‰§è¡Œä¸‹é¢æ“ä½œï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">scp  -r  HOME/.kube   node1: HOME/</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>ä½¿ç”¨æ¨è: ä¸‰ç§æ–¹å¼åº”è¯¥æ€ä¹ˆç”¨ ?</p>
</blockquote>
<p>åˆ›å»º/æ›´æ–°èµ„æº ä½¿ç”¨å£°æ˜å¼å¯¹è±¡é…ç½® kubectl apply -f XXX.yaml</p>
<p>åˆ é™¤èµ„æº ä½¿ç”¨å‘½ä»¤å¼å¯¹è±¡é…ç½® kubectl delete -f XXX.yaml</p>
<p>æŸ¥è¯¢èµ„æº ä½¿ç”¨å‘½ä»¤å¼å¯¹è±¡ç®¡ç† kubectl get(describe) èµ„æºåç§°</p>
]]></content>
      <tags>
        <tag>äº‘åŸç”ŸåŸºç¡€ç³»åˆ—</tag>
        <tag>Kubernetes</tag>
      </tags>
  </entry>
  <entry>
    <title>äº‘åŸç”ŸåŸºç¡€ç³»åˆ—ä¹‹Kubernetes(ä¹)å®‰å…¨è®¤è¯</title>
    <url>/2022/06/09/uncatalog/cl46zbaxw00037or72v2f9efa/</url>
    <content><![CDATA[<hr>
<span id="more"></span>



<hr>
<h3 id="9-å®‰å…¨è®¤è¯"><a href="#9-å®‰å…¨è®¤è¯" class="headerlink" title="9. å®‰å…¨è®¤è¯"></a>9. å®‰å…¨è®¤è¯</h3><h4 id="9-1-è®¿é—®æ§åˆ¶æ¦‚è¿°"><a href="#9-1-è®¿é—®æ§åˆ¶æ¦‚è¿°" class="headerlink" title="9.1 è®¿é—®æ§åˆ¶æ¦‚è¿°"></a>9.1 è®¿é—®æ§åˆ¶æ¦‚è¿°</h4><p>Kubernetesä½œä¸ºä¸€ä¸ªåˆ†å¸ƒå¼é›†ç¾¤çš„ç®¡ç†å·¥å…·ï¼Œä¿è¯é›†ç¾¤çš„å®‰å…¨æ€§æ˜¯å…¶ä¸€ä¸ªé‡è¦çš„ä»»åŠ¡ã€‚æ‰€è°“çš„å®‰å…¨æ€§å…¶å®å°±æ˜¯ä¿è¯å¯¹Kubernetesçš„å„ç§<strong>å®¢æˆ·ç«¯</strong>è¿›è¡Œ<strong>è®¤è¯å’Œé‰´æƒ</strong>æ“ä½œã€‚</p>
<p><strong>å®¢æˆ·ç«¯</strong></p>
<p>åœ¨Kubernetesé›†ç¾¤ä¸­ï¼Œå®¢æˆ·ç«¯é€šå¸¸æœ‰ä¸¤ç±»ï¼š</p>
<ul>
<li><strong>User Account</strong>ï¼šä¸€èˆ¬æ˜¯ç‹¬ç«‹äºkubernetesä¹‹å¤–çš„å…¶ä»–æœåŠ¡ç®¡ç†çš„ç”¨æˆ·è´¦å·ã€‚</li>
<li><strong>Service Account</strong>ï¼škubernetesç®¡ç†çš„è´¦å·ï¼Œç”¨äºä¸ºPodä¸­çš„æœåŠ¡è¿›ç¨‹åœ¨è®¿é—®Kubernetesæ—¶æä¾›èº«ä»½æ ‡è¯†ã€‚</li>
</ul>
<p><img src="/2022/06/09/uncatalog/cl46zbaxw00037or72v2f9efa/image-20200520102949189.png" alt="img"></p>
<p><strong>è®¤è¯ã€æˆæƒä¸å‡†å…¥æ§åˆ¶</strong></p>
<p>ApiServeræ˜¯è®¿é—®åŠç®¡ç†èµ„æºå¯¹è±¡çš„å”¯ä¸€å…¥å£ã€‚ä»»ä½•ä¸€ä¸ªè¯·æ±‚è®¿é—®ApiServerï¼Œéƒ½è¦ç»è¿‡ä¸‹é¢ä¸‰ä¸ªæµç¨‹ï¼š</p>
<ul>
<li>Authenticationï¼ˆè®¤è¯ï¼‰ï¼šèº«ä»½é‰´åˆ«ï¼Œåªæœ‰æ­£ç¡®çš„è´¦å·æ‰èƒ½å¤Ÿé€šè¿‡è®¤è¯</li>
<li>Authorizationï¼ˆæˆæƒï¼‰ï¼š åˆ¤æ–­ç”¨æˆ·æ˜¯å¦æœ‰æƒé™å¯¹è®¿é—®çš„èµ„æºæ‰§è¡Œç‰¹å®šçš„åŠ¨ä½œ</li>
<li>Admission Controlï¼ˆå‡†å…¥æ§åˆ¶ï¼‰ï¼šç”¨äºè¡¥å……æˆæƒæœºåˆ¶ä»¥å®ç°æ›´åŠ ç²¾ç»†çš„è®¿é—®æ§åˆ¶åŠŸèƒ½ã€‚</li>
</ul>
<p><img src="/2022/06/09/uncatalog/cl46zbaxw00037or72v2f9efa/image-20200520103942580.png" alt="img"></p>
<h4 id="9-2-è®¤è¯ç®¡ç†"><a href="#9-2-è®¤è¯ç®¡ç†" class="headerlink" title="9.2 è®¤è¯ç®¡ç†"></a>9.2 è®¤è¯ç®¡ç†</h4><p>Kubernetesé›†ç¾¤å®‰å…¨çš„æœ€å…³é”®ç‚¹åœ¨äºå¦‚ä½•è¯†åˆ«å¹¶è®¤è¯å®¢æˆ·ç«¯èº«ä»½ï¼Œå®ƒæä¾›äº†3ç§å®¢æˆ·ç«¯èº«ä»½è®¤è¯æ–¹å¼ï¼š</p>
<ul>
<li><p>HTTP Baseè®¤è¯ï¼šé€šè¿‡ç”¨æˆ·å+å¯†ç çš„æ–¹å¼è®¤è¯</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="code"><pre><span class="line">è¿™ç§è®¤è¯æ–¹å¼æ˜¯æŠŠâ€œç”¨æˆ·å:å¯†ç â€ç”¨BASE64ç®—æ³•è¿›è¡Œç¼–ç åçš„å­—ç¬¦ä¸²æ”¾åœ¨HTTPè¯·æ±‚ä¸­çš„Header AuthorizationåŸŸé‡Œå‘é€ç»™æœåŠ¡ç«¯ã€‚æœåŠ¡ç«¯æ”¶åˆ°åè¿›è¡Œè§£ç ï¼Œè·å–ç”¨æˆ·ååŠå¯†ç ï¼Œç„¶åè¿›è¡Œç”¨æˆ·èº«ä»½è®¤è¯çš„è¿‡ç¨‹ã€‚</span><br></pre></td></tr></table></figure></div></li>
<li><p>HTTP Tokenè®¤è¯ï¼šé€šè¿‡ä¸€ä¸ªTokenæ¥è¯†åˆ«åˆæ³•ç”¨æˆ·</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="code"><pre><span class="line">è¿™ç§è®¤è¯æ–¹å¼æ˜¯ç”¨ä¸€ä¸ªå¾ˆé•¿çš„éš¾ä»¥è¢«æ¨¡ä»¿çš„å­—ç¬¦ä¸²--Tokenæ¥è¡¨æ˜å®¢æˆ·èº«ä»½çš„ä¸€ç§æ–¹å¼ã€‚æ¯ä¸ªTokenå¯¹åº”ä¸€ä¸ªç”¨æˆ·åï¼Œå½“å®¢æˆ·ç«¯å‘èµ·APIè°ƒç”¨è¯·æ±‚æ—¶ï¼Œéœ€è¦åœ¨HTTP Headeré‡Œæ”¾å…¥Tokenï¼ŒAPI Serveræ¥åˆ°Tokenåä¼šè·ŸæœåŠ¡å™¨ä¸­ä¿å­˜çš„tokenè¿›è¡Œæ¯”å¯¹ï¼Œç„¶åè¿›è¡Œç”¨æˆ·èº«ä»½è®¤è¯çš„è¿‡ç¨‹ã€‚</span><br></pre></td></tr></table></figure></div></li>
<li><p>HTTPSè¯ä¹¦è®¤è¯ï¼šåŸºäºCAæ ¹è¯ä¹¦ç­¾åçš„åŒå‘æ•°å­—è¯ä¹¦è®¤è¯æ–¹å¼</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="code"><pre><span class="line">è¿™ç§è®¤è¯æ–¹å¼æ˜¯å®‰å…¨æ€§æœ€é«˜çš„ä¸€ç§æ–¹å¼ï¼Œä½†æ˜¯åŒæ—¶ä¹Ÿæ˜¯æ“ä½œèµ·æ¥æœ€éº»çƒ¦çš„ä¸€ç§æ–¹å¼ã€‚</span><br></pre></td></tr></table></figure></div></li>
</ul>
<p><img src="/2022/06/09/uncatalog/cl46zbaxw00037or72v2f9efa/image-20200518211037434.png" alt="img"></p>
<p><strong>HTTPSè®¤è¯å¤§ä½“åˆ†ä¸º3ä¸ªè¿‡ç¨‹ï¼š</strong></p>
<ol>
<li><p>è¯ä¹¦ç”³è¯·å’Œä¸‹å‘</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="code"><pre><span class="line">HTTPSé€šä¿¡åŒæ–¹çš„æœåŠ¡å™¨å‘CAæœºæ„ç”³è¯·è¯ä¹¦ï¼ŒCAæœºæ„ä¸‹å‘æ ¹è¯ä¹¦ã€æœåŠ¡ç«¯è¯ä¹¦åŠç§é’¥ç»™ç”³è¯·è€…</span><br></pre></td></tr></table></figure></div></li>
<li><p>å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯çš„åŒå‘è®¤è¯</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="code"><pre><span class="line">1&gt; å®¢æˆ·ç«¯å‘æœåŠ¡å™¨ç«¯å‘èµ·è¯·æ±‚ï¼ŒæœåŠ¡ç«¯ä¸‹å‘è‡ªå·±çš„è¯ä¹¦ç»™å®¢æˆ·ç«¯ï¼Œ</span><br><span class="line">   å®¢æˆ·ç«¯æ¥æ”¶åˆ°è¯ä¹¦åï¼Œé€šè¿‡ç§é’¥è§£å¯†è¯ä¹¦ï¼Œåœ¨è¯ä¹¦ä¸­è·å¾—æœåŠ¡ç«¯çš„å…¬é’¥ï¼Œ</span><br><span class="line">   å®¢æˆ·ç«¯åˆ©ç”¨æœåŠ¡å™¨ç«¯çš„å…¬é’¥è®¤è¯è¯ä¹¦ä¸­çš„ä¿¡æ¯ï¼Œå¦‚æœä¸€è‡´ï¼Œåˆ™è®¤å¯è¿™ä¸ªæœåŠ¡å™¨</span><br><span class="line">2&gt; å®¢æˆ·ç«¯å‘é€è‡ªå·±çš„è¯ä¹¦ç»™æœåŠ¡å™¨ç«¯ï¼ŒæœåŠ¡ç«¯æ¥æ”¶åˆ°è¯ä¹¦åï¼Œé€šè¿‡ç§é’¥è§£å¯†è¯ä¹¦ï¼Œ</span><br><span class="line">   åœ¨è¯ä¹¦ä¸­è·å¾—å®¢æˆ·ç«¯çš„å…¬é’¥ï¼Œå¹¶ç”¨è¯¥å…¬é’¥è®¤è¯è¯ä¹¦ä¿¡æ¯ï¼Œç¡®è®¤å®¢æˆ·ç«¯æ˜¯å¦åˆæ³•</span><br></pre></td></tr></table></figure></div></li>
<li><p>æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯è¿›è¡Œé€šä¿¡</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="code"><pre><span class="line">æœåŠ¡å™¨ç«¯å’Œå®¢æˆ·ç«¯åå•†å¥½åŠ å¯†æ–¹æ¡ˆåï¼Œå®¢æˆ·ç«¯ä¼šäº§ç”Ÿä¸€ä¸ªéšæœºçš„ç§˜é’¥å¹¶åŠ å¯†ï¼Œç„¶åå‘é€åˆ°æœåŠ¡å™¨ç«¯ã€‚</span><br><span class="line">æœåŠ¡å™¨ç«¯æ¥æ”¶è¿™ä¸ªç§˜é’¥åï¼ŒåŒæ–¹æ¥ä¸‹æ¥é€šä¿¡çš„æ‰€æœ‰å†…å®¹éƒ½é€šè¿‡è¯¥éšæœºç§˜é’¥åŠ å¯†</span><br></pre></td></tr></table></figure></div></li>
</ol>
<blockquote>
<p>æ³¨æ„: Kuberneteså…è®¸åŒæ—¶é…ç½®å¤šç§è®¤è¯æ–¹å¼ï¼Œåªè¦å…¶ä¸­ä»»æ„ä¸€ä¸ªæ–¹å¼è®¤è¯é€šè¿‡å³å¯</p>
</blockquote>
<h4 id="9-3-æˆæƒç®¡ç†"><a href="#9-3-æˆæƒç®¡ç†" class="headerlink" title="9.3 æˆæƒç®¡ç†"></a>9.3 æˆæƒç®¡ç†</h4><p>æˆæƒå‘ç”Ÿåœ¨è®¤è¯æˆåŠŸä¹‹åï¼Œé€šè¿‡è®¤è¯å°±å¯ä»¥çŸ¥é“è¯·æ±‚ç”¨æˆ·æ˜¯è°ï¼Œ ç„¶åKubernetesä¼šæ ¹æ®äº‹å…ˆå®šä¹‰çš„æˆæƒç­–ç•¥æ¥å†³å®šç”¨æˆ·æ˜¯å¦æœ‰æƒé™è®¿é—®ï¼Œè¿™ä¸ªè¿‡ç¨‹å°±ç§°ä¸ºæˆæƒã€‚</p>
<p>æ¯ä¸ªå‘é€åˆ°ApiServerçš„è¯·æ±‚éƒ½å¸¦ä¸Šäº†ç”¨æˆ·å’Œèµ„æºçš„ä¿¡æ¯ï¼šæ¯”å¦‚å‘é€è¯·æ±‚çš„ç”¨æˆ·ã€è¯·æ±‚çš„è·¯å¾„ã€è¯·æ±‚çš„åŠ¨ä½œç­‰ï¼Œæˆæƒå°±æ˜¯æ ¹æ®è¿™äº›ä¿¡æ¯å’Œæˆæƒç­–ç•¥è¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœç¬¦åˆç­–ç•¥ï¼Œåˆ™è®¤ä¸ºæˆæƒé€šè¿‡ï¼Œå¦åˆ™ä¼šè¿”å›é”™è¯¯ã€‚</p>
<p>API Serverç›®å‰æ”¯æŒä»¥ä¸‹å‡ ç§æˆæƒç­–ç•¥ï¼š</p>
<ul>
<li>AlwaysDenyï¼šè¡¨ç¤ºæ‹’ç»æ‰€æœ‰è¯·æ±‚ï¼Œä¸€èˆ¬ç”¨äºæµ‹è¯•</li>
<li>AlwaysAllowï¼šå…è®¸æ¥æ”¶æ‰€æœ‰è¯·æ±‚ï¼Œç›¸å½“äºé›†ç¾¤ä¸éœ€è¦æˆæƒæµç¨‹ï¼ˆKubernetesé»˜è®¤çš„ç­–ç•¥ï¼‰</li>
<li>ABACï¼šåŸºäºå±æ€§çš„è®¿é—®æ§åˆ¶ï¼Œè¡¨ç¤ºä½¿ç”¨ç”¨æˆ·é…ç½®çš„æˆæƒè§„åˆ™å¯¹ç”¨æˆ·è¯·æ±‚è¿›è¡ŒåŒ¹é…å’Œæ§åˆ¶</li>
<li>Webhookï¼šé€šè¿‡è°ƒç”¨å¤–éƒ¨RESTæœåŠ¡å¯¹ç”¨æˆ·è¿›è¡Œæˆæƒ</li>
<li>Nodeï¼šæ˜¯ä¸€ç§ä¸“ç”¨æ¨¡å¼ï¼Œç”¨äºå¯¹kubeletå‘å‡ºçš„è¯·æ±‚è¿›è¡Œè®¿é—®æ§åˆ¶</li>
<li>RBACï¼šåŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼ˆkubeadmå®‰è£…æ–¹å¼ä¸‹çš„é»˜è®¤é€‰é¡¹ï¼‰</li>
</ul>
<p>RBAC(Role-Based Access Control) åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼Œä¸»è¦æ˜¯åœ¨æè¿°ä¸€ä»¶äº‹æƒ…ï¼š<strong>ç»™å“ªäº›å¯¹è±¡æˆäºˆäº†å“ªäº›æƒé™</strong></p>
<p>å…¶ä¸­æ¶‰åŠåˆ°äº†ä¸‹é¢å‡ ä¸ªæ¦‚å¿µï¼š</p>
<ul>
<li>å¯¹è±¡ï¼šUserã€Groupsã€ServiceAccount</li>
<li>è§’è‰²ï¼šä»£è¡¨ç€ä¸€ç»„å®šä¹‰åœ¨èµ„æºä¸Šçš„å¯æ“ä½œåŠ¨ä½œ(æƒé™)çš„é›†åˆ</li>
<li>ç»‘å®šï¼šå°†å®šä¹‰å¥½çš„è§’è‰²è·Ÿç”¨æˆ·ç»‘å®šåœ¨ä¸€èµ·</li>
</ul>
<p><img src="/2022/06/09/uncatalog/cl46zbaxw00037or72v2f9efa/image-20200519181209566.png" alt="img"></p>
<p>RBACå¼•å…¥äº†4ä¸ªé¡¶çº§èµ„æºå¯¹è±¡ï¼š</p>
<ul>
<li>Roleã€ClusterRoleï¼šè§’è‰²ï¼Œç”¨äºæŒ‡å®šä¸€ç»„æƒé™</li>
<li>RoleBindingã€ClusterRoleBindingï¼šè§’è‰²ç»‘å®šï¼Œç”¨äºå°†è§’è‰²ï¼ˆæƒé™ï¼‰èµ‹äºˆç»™å¯¹è±¡</li>
</ul>
<p><strong>Roleã€ClusterRole</strong></p>
<p>ä¸€ä¸ªè§’è‰²å°±æ˜¯ä¸€ç»„æƒé™çš„é›†åˆï¼Œè¿™é‡Œçš„æƒé™éƒ½æ˜¯è®¸å¯å½¢å¼çš„ï¼ˆç™½åå•ï¼‰ã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Roleåªèƒ½å¯¹å‘½åç©ºé—´å†…çš„èµ„æºè¿›è¡Œæˆæƒï¼Œéœ€è¦æŒ‡å®šnameapce</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Role</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1beta1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">authorization-role</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]  <span class="comment"># æ”¯æŒçš„APIç»„åˆ—è¡¨,&quot;&quot; ç©ºå­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºæ ¸å¿ƒAPIç¾¤</span></span><br><span class="line">  <span class="attr">resources:</span> [<span class="string">&quot;pods&quot;</span>] <span class="comment"># æ”¯æŒçš„èµ„æºå¯¹è±¡åˆ—è¡¨</span></span><br><span class="line">  <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;watch&quot;</span>, <span class="string">&quot;list&quot;</span>] <span class="comment"># å…è®¸çš„å¯¹èµ„æºå¯¹è±¡çš„æ“ä½œæ–¹æ³•åˆ—è¡¨</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ClusterRoleå¯ä»¥å¯¹é›†ç¾¤èŒƒå›´å†…èµ„æºã€è·¨namespacesçš„èŒƒå›´èµ„æºã€éèµ„æºç±»å‹è¿›è¡Œæˆæƒ</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1beta1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"> <span class="attr">name:</span> <span class="string">authorization-clusterrole</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">  <span class="attr">resources:</span> [<span class="string">&quot;pods&quot;</span>]</span><br><span class="line">  <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;watch&quot;</span>, <span class="string">&quot;list&quot;</span>]</span><br></pre></td></tr></table></figure></div>

<p>éœ€è¦è¯¦ç»†è¯´æ˜çš„æ˜¯ï¼Œrulesä¸­çš„å‚æ•°ï¼š</p>
<ul>
<li><p>apiGroups: æ”¯æŒçš„APIç»„åˆ—è¡¨</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;&quot;</span>,<span class="string">&quot;apps&quot;</span>, <span class="string">&quot;autoscaling&quot;</span>, <span class="string">&quot;batch&quot;</span></span><br></pre></td></tr></table></figure></div></li>
<li><p>resourcesï¼šæ”¯æŒçš„èµ„æºå¯¹è±¡åˆ—è¡¨</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;services&quot;</span>, <span class="string">&quot;endpoints&quot;</span>, <span class="string">&quot;pods&quot;</span>,<span class="string">&quot;secrets&quot;</span>,<span class="string">&quot;configmaps&quot;</span>,<span class="string">&quot;crontabs&quot;</span>,<span class="string">&quot;deployments&quot;</span>,<span class="string">&quot;jobs&quot;</span>,</span><br><span class="line"><span class="string">&quot;nodes&quot;</span>,<span class="string">&quot;rolebindings&quot;</span>,<span class="string">&quot;clusterroles&quot;</span>,<span class="string">&quot;daemonsets&quot;</span>,<span class="string">&quot;replicasets&quot;</span>,<span class="string">&quot;statefulsets&quot;</span>,</span><br><span class="line"><span class="string">&quot;horizontalpodautoscalers&quot;</span>,<span class="string">&quot;replicationcontrollers&quot;</span>,<span class="string">&quot;cronjobs&quot;</span></span><br></pre></td></tr></table></figure></div></li>
<li><p>verbsï¼šå¯¹èµ„æºå¯¹è±¡çš„æ“ä½œæ–¹æ³•åˆ—è¡¨</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="BASH"><figure class="iseeu highlight /bash"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;get&quot;</span>, <span class="string">&quot;list&quot;</span>, <span class="string">&quot;watch&quot;</span>, <span class="string">&quot;create&quot;</span>, <span class="string">&quot;update&quot;</span>, <span class="string">&quot;patch&quot;</span>, <span class="string">&quot;delete&quot;</span>, <span class="string">&quot;exec&quot;</span></span><br></pre></td></tr></table></figure></div></li>
</ul>
<p><strong>RoleBindingã€ClusterRoleBinding</strong></p>
<p>è§’è‰²ç»‘å®šç”¨æ¥æŠŠä¸€ä¸ªè§’è‰²ç»‘å®šåˆ°ä¸€ä¸ªç›®æ ‡å¯¹è±¡ä¸Šï¼Œç»‘å®šç›®æ ‡å¯ä»¥æ˜¯Userã€Groupæˆ–è€…ServiceAccountã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># RoleBindingå¯ä»¥å°†åŒä¸€namespaceä¸­çš„subjectç»‘å®šåˆ°æŸä¸ªRoleä¸‹ï¼Œåˆ™æ­¤subjectå³å…·æœ‰è¯¥Roleå®šä¹‰çš„æƒé™</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">RoleBinding</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1beta1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">authorization-role-binding</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">User</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">heima</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">Role</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">authorization-role</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ClusterRoleBindingåœ¨æ•´ä¸ªé›†ç¾¤çº§åˆ«å’Œæ‰€æœ‰namespaceså°†ç‰¹å®šçš„subjectä¸ClusterRoleç»‘å®šï¼Œæˆäºˆæƒé™</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1beta1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"> <span class="attr">name:</span> <span class="string">authorization-clusterrole-binding</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">User</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">heima</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">authorization-clusterrole</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br></pre></td></tr></table></figure></div>

<p><strong>RoleBindingå¼•ç”¨ClusterRoleè¿›è¡Œæˆæƒ</strong></p>
<p>RoleBindingå¯ä»¥å¼•ç”¨ClusterRoleï¼Œå¯¹å±äºåŒä¸€å‘½åç©ºé—´å†…ClusterRoleå®šä¹‰çš„èµ„æºä¸»ä½“è¿›è¡Œæˆæƒã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="code"><pre><span class="line">ä¸€ç§å¾ˆå¸¸ç”¨çš„åšæ³•å°±æ˜¯ï¼Œé›†ç¾¤ç®¡ç†å‘˜ä¸ºé›†ç¾¤èŒƒå›´é¢„å®šä¹‰å¥½ä¸€ç»„è§’è‰²ï¼ˆClusterRoleï¼‰ï¼Œç„¶ååœ¨å¤šä¸ªå‘½åç©ºé—´ä¸­é‡å¤ä½¿ç”¨è¿™äº›ClusterRoleã€‚è¿™æ ·å¯ä»¥å¤§å¹…æé«˜æˆæƒç®¡ç†å·¥ä½œæ•ˆç‡ï¼Œä¹Ÿä½¿å¾—å„ä¸ªå‘½åç©ºé—´ä¸‹çš„åŸºç¡€æ€§æˆæƒè§„åˆ™ä¸ä½¿ç”¨ä½“éªŒä¿æŒä¸€è‡´ã€‚</span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è™½ç„¶authorization-clusterroleæ˜¯ä¸€ä¸ªé›†ç¾¤è§’è‰²ï¼Œä½†æ˜¯å› ä¸ºä½¿ç”¨äº†RoleBinding</span></span><br><span class="line"><span class="comment"># æ‰€ä»¥heimaåªèƒ½è¯»å–devå‘½åç©ºé—´ä¸­çš„èµ„æº</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">RoleBinding</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1beta1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">authorization-role-binding-ns</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">User</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">heima</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">authorization-clusterrole</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br></pre></td></tr></table></figure></div>

<p><strong>å®æˆ˜ï¼šåˆ›å»ºä¸€ä¸ªåªèƒ½ç®¡ç†devç©ºé—´ä¸‹Podsèµ„æºçš„è´¦å·</strong></p>
<ol>
<li>åˆ›å»ºè´¦å·</li>
</ol>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1) åˆ›å»ºè¯ä¹¦</span></span><br><span class="line">[root@k8s-master01 pki]# cd /etc/kubernetes/pki/</span><br><span class="line">[root@k8s-master01 pki]# (umask 077;openssl genrsa -out devman.key 2048)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2) ç”¨apiserverçš„è¯ä¹¦å»ç­¾ç½²</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2-1) ç­¾åç”³è¯·ï¼Œç”³è¯·çš„ç”¨æˆ·æ˜¯devman,ç»„æ˜¯devgroup</span></span><br><span class="line">[root@k8s-master01 pki]# openssl req -new -key devman.key -out devman.csr -subj &quot;/CN=devman/O=devgroup&quot;     </span><br><span class="line"><span class="meta">#</span><span class="bash"> 2-2) ç­¾ç½²è¯ä¹¦</span></span><br><span class="line">[root@k8s-master01 pki]# openssl x509 -req -in devman.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out devman.crt -days 3650</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3) è®¾ç½®é›†ç¾¤ã€ç”¨æˆ·ã€ä¸Šä¸‹æ–‡ä¿¡æ¯</span></span><br><span class="line">[root@k8s-master01 pki]# kubectl config set-cluster kubernetes --embed-certs=true --certificate-authority=/etc/kubernetes/pki/ca.crt --server=https://192.168.109.100:6443</span><br><span class="line"></span><br><span class="line">[root@k8s-master01 pki]# kubectl config set-credentials devman --embed-certs=true --client-certificate=/etc/kubernetes/pki/devman.crt --client-key=/etc/kubernetes/pki/devman.key</span><br><span class="line"></span><br><span class="line">[root@k8s-master01 pki]# kubectl config set-context devman@kubernetes --cluster=kubernetes --user=devman</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆ‡æ¢è´¦æˆ·åˆ°devman</span></span><br><span class="line">[root@k8s-master01 pki]# kubectl config use-context devman@kubernetes</span><br><span class="line">Switched to context &quot;devman@kubernetes&quot;.</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹devä¸‹podï¼Œå‘ç°æ²¡æœ‰æƒé™</span></span><br><span class="line">[root@k8s-master01 pki]# kubectl get pods -n dev</span><br><span class="line">Error from server (Forbidden): pods is forbidden: User &quot;devman&quot; cannot list resource &quot;pods&quot; in API group &quot;&quot; in the namespace &quot;dev&quot;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆ‡æ¢åˆ°adminè´¦æˆ·</span></span><br><span class="line">[root@k8s-master01 pki]# kubectl config use-context kubernetes-admin@kubernetes</span><br><span class="line">Switched to context &quot;kubernetes-admin@kubernetes&quot;.</span><br></pre></td></tr></table></figure></div>

<p>2ï¼‰ åˆ›å»ºRoleå’ŒRoleBindingï¼Œä¸ºdevmanç”¨æˆ·æˆæƒ</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">kind:</span> <span class="string">Role</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1beta1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">dev-role</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span> [<span class="string">&quot;&quot;</span>]</span><br><span class="line">  <span class="attr">resources:</span> [<span class="string">&quot;pods&quot;</span>]</span><br><span class="line">  <span class="attr">verbs:</span> [<span class="string">&quot;get&quot;</span>, <span class="string">&quot;watch&quot;</span>, <span class="string">&quot;list&quot;</span>]</span><br><span class="line">  </span><br><span class="line"><span class="meta">---</span></span><br><span class="line"></span><br><span class="line"><span class="attr">kind:</span> <span class="string">RoleBinding</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1beta1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">authorization-role-binding</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">User</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">devman</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">Role</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">dev-role</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">[root@k8s-master01 pki]# kubectl create -f dev-role.yaml</span><br><span class="line">role.rbac.authorization.k8s.io/dev-role created</span><br><span class="line">rolebinding.rbac.authorization.k8s.io/authorization-role-binding created</span><br></pre></td></tr></table></figure></div>

<ol start="3">
<li>åˆ‡æ¢è´¦æˆ·ï¼Œå†æ¬¡éªŒè¯</li>
</ol>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åˆ‡æ¢è´¦æˆ·åˆ°devman</span></span><br><span class="line">[root@k8s-master01 pki]# kubectl config use-context devman@kubernetes</span><br><span class="line">Switched to context &quot;devman@kubernetes&quot;.</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å†æ¬¡æŸ¥çœ‹</span></span><br><span class="line">[root@k8s-master01 pki]# kubectl get pods -n dev</span><br><span class="line">NAME                                 READY   STATUS             RESTARTS   AGE</span><br><span class="line">nginx-deployment-66cb59b984-8wp2k    1/1     Running            0          4d1h</span><br><span class="line">nginx-deployment-66cb59b984-dc46j    1/1     Running            0          4d1h</span><br><span class="line">nginx-deployment-66cb59b984-thfck    1/1     Running            0          4d1h</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¸ºäº†ä¸å½±å“åé¢çš„å­¦ä¹ ,åˆ‡å›adminè´¦æˆ·</span></span><br><span class="line">[root@k8s-master01 pki]# kubectl config use-context kubernetes-admin@kubernetes</span><br><span class="line">Switched to context &quot;kubernetes-admin@kubernetes&quot;.</span><br></pre></td></tr></table></figure></div>

<h4 id="9-4-å‡†å…¥æ§åˆ¶"><a href="#9-4-å‡†å…¥æ§åˆ¶" class="headerlink" title="9.4 å‡†å…¥æ§åˆ¶"></a>9.4 å‡†å…¥æ§åˆ¶</h4><p>é€šè¿‡äº†å‰é¢çš„è®¤è¯å’Œæˆæƒä¹‹åï¼Œè¿˜éœ€è¦ç»è¿‡å‡†å…¥æ§åˆ¶å¤„ç†é€šè¿‡ä¹‹åï¼Œapiserveræ‰ä¼šå¤„ç†è¿™ä¸ªè¯·æ±‚ã€‚</p>
<p>å‡†å…¥æ§åˆ¶æ˜¯ä¸€ä¸ªå¯é…ç½®çš„æ§åˆ¶å™¨åˆ—è¡¨ï¼Œå¯ä»¥é€šè¿‡åœ¨Api-Serverä¸Šé€šè¿‡å‘½ä»¤è¡Œè®¾ç½®é€‰æ‹©æ‰§è¡Œå“ªäº›å‡†å…¥æ§åˆ¶å™¨ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="code"><pre><span class="line">--admission-control&#x3D;NamespaceLifecycle,LimitRanger,ServiceAccount,PersistentVolumeLabel,</span><br><span class="line">                      DefaultStorageClass,ResourceQuota,DefaultTolerationSeconds</span><br></pre></td></tr></table></figure></div>

<p>åªæœ‰å½“æ‰€æœ‰çš„å‡†å…¥æ§åˆ¶å™¨éƒ½æ£€æŸ¥é€šè¿‡ä¹‹åï¼Œapiserveræ‰æ‰§è¡Œè¯¥è¯·æ±‚ï¼Œå¦åˆ™è¿”å›æ‹’ç»ã€‚</p>
<p>å½“å‰å¯é…ç½®çš„Admission Controlå‡†å…¥æ§åˆ¶å¦‚ä¸‹ï¼š</p>
<ul>
<li>AlwaysAdmitï¼šå…è®¸æ‰€æœ‰è¯·æ±‚</li>
<li>AlwaysDenyï¼šç¦æ­¢æ‰€æœ‰è¯·æ±‚ï¼Œä¸€èˆ¬ç”¨äºæµ‹è¯•</li>
<li>AlwaysPullImagesï¼šåœ¨å¯åŠ¨å®¹å™¨ä¹‹å‰æ€»å»ä¸‹è½½é•œåƒ</li>
<li>DenyExecOnPrivilegedï¼šå®ƒä¼šæ‹¦æˆªæ‰€æœ‰æƒ³åœ¨Privileged Containerä¸Šæ‰§è¡Œå‘½ä»¤çš„è¯·æ±‚</li>
<li>ImagePolicyWebhookï¼šè¿™ä¸ªæ’ä»¶å°†å…è®¸åç«¯çš„ä¸€ä¸ªWebhookç¨‹åºæ¥å®Œæˆadmission controllerçš„åŠŸèƒ½ã€‚</li>
<li>Service Accountï¼šå®ç°ServiceAccountå®ç°äº†è‡ªåŠ¨åŒ–</li>
<li>SecurityContextDenyï¼šè¿™ä¸ªæ’ä»¶å°†ä½¿ç”¨SecurityContextçš„Podä¸­çš„å®šä¹‰å…¨éƒ¨å¤±æ•ˆ</li>
<li>ResourceQuotaï¼šç”¨äºèµ„æºé…é¢ç®¡ç†ç›®çš„ï¼Œè§‚å¯Ÿæ‰€æœ‰è¯·æ±‚ï¼Œç¡®ä¿åœ¨namespaceä¸Šçš„é…é¢ä¸ä¼šè¶…æ ‡</li>
<li>LimitRangerï¼šç”¨äºèµ„æºé™åˆ¶ç®¡ç†ï¼Œä½œç”¨äºnamespaceä¸Šï¼Œç¡®ä¿å¯¹Podè¿›è¡Œèµ„æºé™åˆ¶</li>
<li>InitialResourcesï¼šä¸ºæœªè®¾ç½®èµ„æºè¯·æ±‚ä¸é™åˆ¶çš„Podï¼Œæ ¹æ®å…¶é•œåƒçš„å†å²èµ„æºçš„ä½¿ç”¨æƒ…å†µè¿›è¡Œè®¾ç½®</li>
<li>NamespaceLifecycleï¼šå¦‚æœå°è¯•åœ¨ä¸€ä¸ªä¸å­˜åœ¨çš„namespaceä¸­åˆ›å»ºèµ„æºå¯¹è±¡ï¼Œåˆ™è¯¥åˆ›å»ºè¯·æ±‚å°†è¢«æ‹’ç»ã€‚å½“åˆ é™¤ä¸€ä¸ªnamespaceæ—¶ï¼Œç³»ç»Ÿå°†ä¼šåˆ é™¤è¯¥namespaceä¸­æ‰€æœ‰å¯¹è±¡ã€‚</li>
<li>DefaultStorageClassï¼šä¸ºäº†å®ç°å…±äº«å­˜å‚¨çš„åŠ¨æ€ä¾›åº”ï¼Œä¸ºæœªæŒ‡å®šStorageClassæˆ–PVçš„PVCå°è¯•åŒ¹é…é»˜è®¤çš„StorageClassï¼Œå°½å¯èƒ½å‡å°‘ç”¨æˆ·åœ¨ç”³è¯·PVCæ—¶æ‰€éœ€äº†è§£çš„åç«¯å­˜å‚¨ç»†èŠ‚</li>
<li>DefaultTolerationSecondsï¼šè¿™ä¸ªæ’ä»¶ä¸ºé‚£äº›æ²¡æœ‰è®¾ç½®forgiveness tolerationså¹¶å…·æœ‰notready:NoExecuteå’Œunreachable:NoExecuteä¸¤ç§taintsçš„Podè®¾ç½®é»˜è®¤çš„â€œå®¹å¿â€æ—¶é—´ï¼Œä¸º5min</li>
<li>PodSecurityPolicyï¼šè¿™ä¸ªæ’ä»¶ç”¨äºåœ¨åˆ›å»ºæˆ–ä¿®æ”¹Podæ—¶å†³å®šæ˜¯å¦æ ¹æ®Podçš„security contextå’Œå¯ç”¨çš„PodSecurityPolicyå¯¹Podçš„å®‰å…¨ç­–ç•¥è¿›è¡Œæ§åˆ¶</li>
</ul>
]]></content>
      <tags>
        <tag>äº‘åŸç”ŸåŸºç¡€ç³»åˆ—</tag>
        <tag>Kubernetes</tag>
      </tags>
  </entry>
  <entry>
    <title>äº‘åŸç”ŸåŸºç¡€ç³»åˆ—ä¹‹Kubernetes(å)DashBoard</title>
    <url>/2022/06/09/uncatalog/cl46zbaxy00047or77oe22gjt/</url>
    <content><![CDATA[<hr>
<span id="more"></span>



<hr>
<h3 id="10-DashBoard"><a href="#10-DashBoard" class="headerlink" title="10. DashBoard"></a>10. DashBoard</h3><p>ä¹‹å‰åœ¨kubernetesä¸­å®Œæˆçš„æ‰€æœ‰æ“ä½œéƒ½æ˜¯é€šè¿‡å‘½ä»¤è¡Œå·¥å…·kubectlå®Œæˆçš„ã€‚å…¶å®ï¼Œä¸ºäº†æä¾›æ›´ä¸°å¯Œçš„ç”¨æˆ·ä½“éªŒï¼Œkubernetesè¿˜å¼€å‘äº†ä¸€ä¸ªåŸºäºwebçš„ç”¨æˆ·ç•Œé¢ï¼ˆDashboardï¼‰ã€‚ç”¨æˆ·å¯ä»¥ä½¿ç”¨Dashboardéƒ¨ç½²å®¹å™¨åŒ–çš„åº”ç”¨ï¼Œè¿˜å¯ä»¥ç›‘æ§åº”ç”¨çš„çŠ¶æ€ï¼Œæ‰§è¡Œæ•…éšœæ’æŸ¥ä»¥åŠç®¡ç†kubernetesä¸­å„ç§èµ„æºã€‚</p>
<h4 id="10-1-éƒ¨ç½²Dashboard"><a href="#10-1-éƒ¨ç½²Dashboard" class="headerlink" title="10.1 éƒ¨ç½²Dashboard"></a>10.1 éƒ¨ç½²Dashboard</h4><ol>
<li>ä¸‹è½½yamlï¼Œå¹¶è¿è¡ŒDashboard</li>
</ol>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ä¸‹è½½yaml</span></span><br><span class="line">[root@k8s-master01 ~]# wget  https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.0/aio/deploy/recommended.yaml</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¿®æ”¹kubernetes-dashboardçš„Serviceç±»å‹</span></span><br><span class="line">kind: Service</span><br><span class="line">apiVersion: v1</span><br><span class="line">metadata:</span><br><span class="line">  labels:</span><br><span class="line">    k8s-app: kubernetes-dashboard</span><br><span class="line">  name: kubernetes-dashboard</span><br><span class="line">  namespace: kubernetes-dashboard</span><br><span class="line">spec:</span><br><span class="line">  type: NodePort  # æ–°å¢</span><br><span class="line">  ports:</span><br><span class="line">    - port: 443</span><br><span class="line">      targetPort: 8443</span><br><span class="line">      nodePort: 30009  # æ–°å¢</span><br><span class="line">  selector:</span><br><span class="line">    k8s-app: kubernetes-dashboard</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> éƒ¨ç½²</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl create -f recommended.yaml</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹namespaceä¸‹çš„kubernetes-dashboardä¸‹çš„èµ„æº</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl get pod,svc -n kubernetes-dashboard</span><br><span class="line">NAME                                            READY   STATUS    RESTARTS   AGE</span><br><span class="line">pod/dashboard-metrics-scraper-c79c65bb7-zwfvw   1/1     Running   0          111s</span><br><span class="line">pod/kubernetes-dashboard-56484d4c5-z95z5        1/1     Running   0          111s</span><br><span class="line"></span><br><span class="line">NAME                               TYPE       CLUSTER-IP      EXTERNAL-IP  PORT(S)         AGE</span><br><span class="line">service/dashboard-metrics-scraper  ClusterIP  10.96.89.218    &lt;none&gt;       8000/TCP        111s</span><br><span class="line">service/kubernetes-dashboard       NodePort   10.104.178.171  &lt;none&gt;       443:30009/TCP   111s</span><br></pre></td></tr></table></figure></div>

<p>2ï¼‰åˆ›å»ºè®¿é—®è´¦æˆ·ï¼Œè·å–token</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åˆ›å»ºè´¦å·</span></span><br><span class="line">[root@k8s-master01-1 ~]# kubectl create serviceaccount dashboard-admin -n kubernetes-dashboard</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æˆæƒ</span></span><br><span class="line">[root@k8s-master01-1 ~]# kubectl create clusterrolebinding dashboard-admin-rb --clusterrole=cluster-admin --serviceaccount=kubernetes-dashboard:dashboard-admin</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> è·å–è´¦å·token</span></span><br><span class="line">[root@k8s-master01 ~]#  kubectl get secrets -n kubernetes-dashboard | grep dashboard-admin</span><br><span class="line">dashboard-admin-token-xbqhh        kubernetes.io/service-account-token   3      2m35s</span><br><span class="line"></span><br><span class="line">[root@k8s-master01 ~]# kubectl describe secrets dashboard-admin-token-xbqhh -n kubernetes-dashboard</span><br><span class="line">Name:         dashboard-admin-token-xbqhh</span><br><span class="line">Namespace:    kubernetes-dashboard</span><br><span class="line">Labels:       &lt;none&gt;</span><br><span class="line">Annotations:  kubernetes.io/service-account.name: dashboard-admin</span><br><span class="line">              kubernetes.io/service-account.uid: 95d84d80-be7a-4d10-a2e0-68f90222d039</span><br><span class="line"></span><br><span class="line">Type:  kubernetes.io/service-account-token</span><br><span class="line"></span><br><span class="line">Data</span><br><span class="line">====</span><br><span class="line">namespace:  20 bytes</span><br><span class="line">token:      eyJhbGciOiJSUzI1NiIsImtpZCI6ImJrYkF4bW5XcDhWcmNGUGJtek5NODFuSXl1aWptMmU2M3o4LTY5a2FKS2cifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlcm5ldGVzLWRhc2hib2FyZCIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJkYXNoYm9hcmQtYWRtaW4tdG9rZW4teGJxaGgiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC5uYW1lIjoiZGFzaGJvYXJkLWFkbWluIiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQudWlkIjoiOTVkODRkODAtYmU3YS00ZDEwLWEyZTAtNjhmOTAyMjJkMDM5Iiwic3ViIjoic3lzdGVtOnNlcnZpY2VhY2NvdW50Omt1YmVybmV0ZXMtZGFzaGJvYXJkOmRhc2hib2FyZC1hZG1pbiJ9.NAl7e8ZfWWdDoPxkqzJzTB46sK9E8iuJYnUI9vnBaY3Jts7T1g1msjsBnbxzQSYgAG--cV0WYxjndzJY_UWCwaGPrQrt_GunxmOK9AUnzURqm55GR2RXIZtjsWVP2EBatsDgHRmuUbQvTFOvdJB4x3nXcYLN2opAaMqg3rnU2rr-A8zCrIuX_eca12wIp_QiuP3SF-tzpdLpsyRfegTJZl6YnSGyaVkC9id-cxZRb307qdCfXPfCHR_2rt5FVfxARgg_C0e3eFHaaYQO7CitxsnIoIXpOFNAR8aUrmopJyODQIPqBWUehb7FhlU1DCduHnIIXVC_UICZ-MKYewBDLw</span><br><span class="line">ca.crt:     1025 bytes</span><br></pre></td></tr></table></figure></div>

<p>3ï¼‰é€šè¿‡æµè§ˆå™¨è®¿é—®Dashboardçš„UI</p>
<p>åœ¨ç™»å½•é¡µé¢ä¸Šè¾“å…¥ä¸Šé¢çš„token</p>
<p><img src="/2022/06/09/uncatalog/cl46zbaxy00047or77oe22gjt/image-20200520144548997.png" alt="image-20200520144548997"></p>
<p>å‡ºç°ä¸‹é¢çš„é¡µé¢ä»£è¡¨æˆåŠŸ</p>
<p><img src="/2022/06/09/uncatalog/cl46zbaxy00047or77oe22gjt/image-20200520144959353.png" alt="image-20200520144959353"></p>
<h4 id="10-2-ä½¿ç”¨DashBoard"><a href="#10-2-ä½¿ç”¨DashBoard" class="headerlink" title="10.2 ä½¿ç”¨DashBoard"></a>10.2 ä½¿ç”¨DashBoard</h4><p>æœ¬ç« èŠ‚ä»¥Deploymentä¸ºä¾‹æ¼”ç¤ºDashBoardçš„ä½¿ç”¨</p>
<p><strong>æŸ¥çœ‹</strong></p>
<p>é€‰æ‹©æŒ‡å®šçš„å‘½åç©ºé—´<code>dev</code>ï¼Œç„¶åç‚¹å‡»<code>Deployments</code>ï¼ŒæŸ¥çœ‹devç©ºé—´ä¸‹çš„æ‰€æœ‰deployment</p>
<p><img src="/2022/06/09/uncatalog/cl46zbaxy00047or77oe22gjt/image-20200520154628679.png" alt="img"></p>
<p><strong>æ‰©ç¼©å®¹</strong></p>
<p>åœ¨<code>Deployment</code>ä¸Šç‚¹å‡»<code>è§„æ¨¡</code>ï¼Œç„¶åæŒ‡å®š<code>ç›®æ ‡å‰¯æœ¬æ•°é‡</code>ï¼Œç‚¹å‡»ç¡®å®š</p>
<p><img src="/2022/06/09/uncatalog/cl46zbaxy00047or77oe22gjt/image-20200520162605102.png" alt="img"></p>
<p><strong>ç¼–è¾‘</strong></p>
<p>åœ¨<code>Deployment</code>ä¸Šç‚¹å‡»<code>ç¼–è¾‘</code>ï¼Œç„¶åä¿®æ”¹<code>yamlæ–‡ä»¶</code>ï¼Œç‚¹å‡»ç¡®å®š</p>
<p><img src="/2022/06/09/uncatalog/cl46zbaxy00047or77oe22gjt/image-20200520163253644.png" alt="image-20200520163253644"></p>
<p><strong>æŸ¥çœ‹Pod</strong></p>
<p>ç‚¹å‡»<code>Pods</code>, æŸ¥çœ‹podsåˆ—è¡¨</p>
<p><img src="/2022/06/09/uncatalog/cl46zbaxy00047or77oe22gjt/image-20200520163552110.png" alt="img"></p>
<p><strong>æ“ä½œPod</strong></p>
<p>é€‰ä¸­æŸä¸ªPodï¼Œå¯ä»¥å¯¹å…¶æ‰§è¡Œæ—¥å¿—ï¼ˆlogsï¼‰ã€è¿›å…¥æ‰§è¡Œï¼ˆexecï¼‰ã€ç¼–è¾‘ã€åˆ é™¤æ“ä½œ</p>
<p><img src="/2022/06/09/uncatalog/cl46zbaxy00047or77oe22gjt/image-20200520163832827.png" alt="img"></p>
<blockquote>
<p>Dashboardæä¾›äº†kubectlçš„ç»å¤§éƒ¨åˆ†åŠŸèƒ½ï¼Œè¿™é‡Œä¸å†ä¸€ä¸€æ¼”ç¤º</p>
</blockquote>
]]></content>
      <tags>
        <tag>äº‘åŸç”ŸåŸºç¡€ç³»åˆ—</tag>
        <tag>Kubernetes</tag>
      </tags>
  </entry>
  <entry>
    <title>äº‘åŸç”ŸåŸºç¡€ç³»åˆ—ä¹‹Kubernetes(ä¸ƒ)Serviceè¯¦è§£</title>
    <url>/2022/06/09/uncatalog/cl46zbay9000j7or7b2e4b2pr/</url>
    <content><![CDATA[<hr>
<span id="more"></span>
<hr>
<h4 id="7-1-Serviceä»‹ç»"><a href="#7-1-Serviceä»‹ç»" class="headerlink" title="7.1 Serviceä»‹ç»"></a>7.1 Serviceä»‹ç»</h4><p>åœ¨kubernetesä¸­ï¼Œpodæ˜¯åº”ç”¨ç¨‹åºçš„è½½ä½“ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡podçš„ipæ¥è®¿é—®åº”ç”¨ç¨‹åºï¼Œä½†æ˜¯podçš„ipåœ°å€ä¸æ˜¯å›ºå®šçš„ï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€ä¸æ–¹ä¾¿ç›´æ¥é‡‡ç”¨podçš„ipå¯¹æœåŠ¡è¿›è¡Œè®¿é—®ã€‚</p>
<p>ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œkubernetesæä¾›äº†Serviceèµ„æºï¼ŒServiceä¼šå¯¹æä¾›åŒä¸€ä¸ªæœåŠ¡çš„å¤šä¸ªpodè¿›è¡Œèšåˆï¼Œå¹¶ä¸”æä¾›ä¸€ä¸ªç»Ÿä¸€çš„å…¥å£åœ°å€ã€‚é€šè¿‡è®¿é—®Serviceçš„å…¥å£åœ°å€å°±èƒ½è®¿é—®åˆ°åé¢çš„podæœåŠ¡ã€‚</p>
<p><img src="/2022/06/09/uncatalog/cl46zbay9000j7or7b2e4b2pr/image-20200408194716912-1626783758946.png" alt="img"></p>
<p>Serviceåœ¨å¾ˆå¤šæƒ…å†µä¸‹åªæ˜¯ä¸€ä¸ªæ¦‚å¿µï¼ŒçœŸæ­£èµ·ä½œç”¨çš„å…¶å®æ˜¯kube-proxyæœåŠ¡è¿›ç¨‹ï¼Œæ¯ä¸ªNodeèŠ‚ç‚¹ä¸Šéƒ½è¿è¡Œç€ä¸€ä¸ªkube-proxyæœåŠ¡è¿›ç¨‹ã€‚å½“åˆ›å»ºServiceçš„æ—¶å€™ä¼šé€šè¿‡api-serverå‘etcdå†™å…¥åˆ›å»ºçš„serviceçš„ä¿¡æ¯ï¼Œè€Œkube-proxyä¼šåŸºäºç›‘å¬çš„æœºåˆ¶å‘ç°è¿™ç§Serviceçš„å˜åŠ¨ï¼Œç„¶å<strong>å®ƒä¼šå°†æœ€æ–°çš„Serviceä¿¡æ¯è½¬æ¢æˆå¯¹åº”çš„è®¿é—®è§„åˆ™</strong>ã€‚</p>
<p><img src="/2022/06/09/uncatalog/cl46zbay9000j7or7b2e4b2pr/image-20200509121254425.png" alt="img"></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="code"><pre><span class="line"># 10.97.97.97:80 æ˜¯serviceæä¾›çš„è®¿é—®å…¥å£</span><br><span class="line"># å½“è®¿é—®è¿™ä¸ªå…¥å£çš„æ—¶å€™ï¼Œå¯ä»¥å‘ç°åé¢æœ‰ä¸‰ä¸ªpodçš„æœåŠ¡åœ¨ç­‰å¾…è°ƒç”¨ï¼Œ</span><br><span class="line"># kube-proxyä¼šåŸºäºrrï¼ˆè½®è¯¢ï¼‰çš„ç­–ç•¥ï¼Œå°†è¯·æ±‚åˆ†å‘åˆ°å…¶ä¸­ä¸€ä¸ªpodä¸Šå»</span><br><span class="line"># è¿™ä¸ªè§„åˆ™ä¼šåŒæ—¶åœ¨é›†ç¾¤å†…çš„æ‰€æœ‰èŠ‚ç‚¹ä¸Šéƒ½ç”Ÿæˆï¼Œæ‰€ä»¥åœ¨ä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹ï¼Œè®¿é—®éƒ½å¯ä»¥ã€‚</span><br><span class="line">[root@node1 ~]# ipvsadm -Ln</span><br><span class="line">IP Virtual Server version 1.2.1 (size&#x3D;4096)</span><br><span class="line">Prot LocalAddress:Port Scheduler Flags</span><br><span class="line">  -&gt; RemoteAddress:Port           Forward Weight ActiveConn InActConn</span><br><span class="line">TCP  10.97.97.97:80 rr</span><br><span class="line">  -&gt; 10.244.1.39:80               Masq    1      0          0</span><br><span class="line">  -&gt; 10.244.1.40:80               Masq    1      0          0</span><br><span class="line">  -&gt; 10.244.2.33:80               Masq    1      0          0</span><br></pre></td></tr></table></figure></div>

<p>kube-proxyç›®å‰æ”¯æŒä¸‰ç§å·¥ä½œæ¨¡å¼:</p>
<p>kube-proxyç›®å‰æ”¯æŒä¸‰ç§å·¥ä½œæ¨¡å¼:</p>
<h5 id="7-1-1-userspace-æ¨¡å¼"><a href="#7-1-1-userspace-æ¨¡å¼" class="headerlink" title="7.1.1 userspace æ¨¡å¼"></a>7.1.1 userspace æ¨¡å¼</h5><p>userspaceæ¨¡å¼ä¸‹ï¼Œkube-proxyä¼šä¸ºæ¯ä¸€ä¸ªServiceåˆ›å»ºä¸€ä¸ªç›‘å¬ç«¯å£ï¼Œå‘å‘Cluster IPçš„è¯·æ±‚è¢«Iptablesè§„åˆ™é‡å®šå‘åˆ°kube-proxyç›‘å¬çš„ç«¯å£ä¸Šï¼Œkube-proxyæ ¹æ®LBç®—æ³•é€‰æ‹©ä¸€ä¸ªæä¾›æœåŠ¡çš„Podå¹¶å’Œå…¶å»ºç«‹é“¾æ¥ï¼Œä»¥å°†è¯·æ±‚è½¬å‘åˆ°Podä¸Šã€‚  è¯¥æ¨¡å¼ä¸‹ï¼Œkube-proxyå……å½“äº†ä¸€ä¸ªå››å±‚è´Ÿè´£å‡è¡¡å™¨çš„è§’è‰²ã€‚ç”±äºkube-proxyè¿è¡Œåœ¨userspaceä¸­ï¼Œåœ¨è¿›è¡Œè½¬å‘å¤„ç†æ—¶ä¼šå¢åŠ å†…æ ¸å’Œç”¨æˆ·ç©ºé—´ä¹‹é—´çš„æ•°æ®æ‹·è´ï¼Œè™½ç„¶æ¯”è¾ƒç¨³å®šï¼Œä½†æ˜¯æ•ˆç‡æ¯”è¾ƒä½ã€‚</p>
<p><img src="/2022/06/09/uncatalog/cl46zbay9000j7or7b2e4b2pr/image-20200509151424280.png" alt="img"></p>
<h5 id="7-1-2-iptables-æ¨¡å¼"><a href="#7-1-2-iptables-æ¨¡å¼" class="headerlink" title="7.1.2 iptables æ¨¡å¼"></a>7.1.2 iptables æ¨¡å¼</h5><p>iptablesæ¨¡å¼ä¸‹ï¼Œkube-proxyä¸ºserviceåç«¯çš„æ¯ä¸ªPodåˆ›å»ºå¯¹åº”çš„iptablesè§„åˆ™ï¼Œç›´æ¥å°†å‘å‘Cluster IPçš„è¯·æ±‚é‡å®šå‘åˆ°ä¸€ä¸ªPod IPã€‚  è¯¥æ¨¡å¼ä¸‹kube-proxyä¸æ‰¿æ‹…å››å±‚è´Ÿè´£å‡è¡¡å™¨çš„è§’è‰²ï¼Œåªè´Ÿè´£åˆ›å»ºiptablesè§„åˆ™ã€‚è¯¥æ¨¡å¼çš„ä¼˜ç‚¹æ˜¯è¾ƒuserspaceæ¨¡å¼æ•ˆç‡æ›´é«˜ï¼Œä½†ä¸èƒ½æä¾›çµæ´»çš„LBç­–ç•¥ï¼Œå½“åç«¯Podä¸å¯ç”¨æ—¶ä¹Ÿæ— æ³•è¿›è¡Œé‡è¯•ã€‚</p>
<p><img src="/2022/06/09/uncatalog/cl46zbay9000j7or7b2e4b2pr/image-20200509152947714.png" alt="img"></p>
<h5 id="7-1-3-ipvs-æ¨¡å¼"><a href="#7-1-3-ipvs-æ¨¡å¼" class="headerlink" title="7.1.3 ipvs æ¨¡å¼"></a>7.1.3 ipvs æ¨¡å¼</h5><p>ipvsæ¨¡å¼å’Œiptablesç±»ä¼¼ï¼Œkube-proxyç›‘æ§Podçš„å˜åŒ–å¹¶åˆ›å»ºç›¸åº”çš„ipvsè§„åˆ™ã€‚ipvsç›¸å¯¹iptablesè½¬å‘æ•ˆç‡æ›´é«˜ã€‚é™¤æ­¤ä»¥å¤–ï¼Œipvsæ”¯æŒæ›´å¤šçš„LBç®—æ³•ã€‚</p>
<p><img src="/2022/06/09/uncatalog/cl46zbay9000j7or7b2e4b2pr/image-20200509153731363.png" alt="img"></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æ­¤æ¨¡å¼å¿…é¡»å®‰è£…ipvså†…æ ¸æ¨¡å—ï¼Œå¦åˆ™ä¼šé™çº§ä¸ºiptables</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¼€å¯ipvs</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl edit cm kube-proxy -n kube-system</span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¿®æ”¹mode: <span class="string">&quot;ipvs&quot;</span></span></span><br><span class="line">[root@k8s-master01 ~]# kubectl delete pod -l k8s-app=kube-proxy -n kube-system</span><br><span class="line">[root@node1 ~]# ipvsadm -Ln</span><br><span class="line">IP Virtual Server version 1.2.1 (size=4096)</span><br><span class="line">Prot LocalAddress:Port Scheduler Flags</span><br><span class="line"><span class="meta">  -&gt;</span><span class="bash"> RemoteAddress:Port           Forward Weight ActiveConn InActConn</span></span><br><span class="line">TCP  10.97.97.97:80 rr</span><br><span class="line"><span class="meta">  -&gt;</span><span class="bash"> 10.244.1.39:80               Masq    1      0          0</span></span><br><span class="line"><span class="meta">  -&gt;</span><span class="bash"> 10.244.1.40:80               Masq    1      0          0</span></span><br><span class="line"><span class="meta">  -&gt;</span><span class="bash"> 10.244.2.33:80               Masq    1      0          0</span></span><br></pre></td></tr></table></figure></div>

<h4 id="7-2-Serviceç±»å‹"><a href="#7-2-Serviceç±»å‹" class="headerlink" title="7.2 Serviceç±»å‹"></a>7.2 Serviceç±»å‹</h4><p>Serviceçš„èµ„æºæ¸…å•æ–‡ä»¶ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">kind:</span> <span class="string">Service</span>  <span class="comment"># èµ„æºç±»å‹</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span>  <span class="comment"># èµ„æºç‰ˆæœ¬</span></span><br><span class="line"><span class="attr">metadata:</span> <span class="comment"># å…ƒæ•°æ®</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">service</span> <span class="comment"># èµ„æºåç§°</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span> <span class="comment"># å‘½åç©ºé—´</span></span><br><span class="line"><span class="attr">spec:</span> <span class="comment"># æè¿°</span></span><br><span class="line">  <span class="attr">selector:</span> <span class="comment"># æ ‡ç­¾é€‰æ‹©å™¨ï¼Œç”¨äºç¡®å®šå½“å‰serviceä»£ç†å“ªäº›pod</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">type:</span> <span class="comment"># Serviceç±»å‹ï¼ŒæŒ‡å®šserviceçš„è®¿é—®æ–¹å¼</span></span><br><span class="line">  <span class="attr">clusterIP:</span>  <span class="comment"># è™šæ‹ŸæœåŠ¡çš„ipåœ°å€</span></span><br><span class="line">  <span class="attr">sessionAffinity:</span> <span class="comment"># sessionäº²å’Œæ€§ï¼Œæ”¯æŒClientIPã€Noneä¸¤ä¸ªé€‰é¡¹</span></span><br><span class="line">  <span class="attr">ports:</span> <span class="comment"># ç«¯å£ä¿¡æ¯</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">protocol:</span> <span class="string">TCP</span> </span><br><span class="line">      <span class="attr">port:</span> <span class="number">3017</span>  <span class="comment"># serviceç«¯å£</span></span><br><span class="line">      <span class="attr">targetPort:</span> <span class="number">5003</span> <span class="comment"># podç«¯å£</span></span><br><span class="line">      <span class="attr">nodePort:</span> <span class="number">31122</span> <span class="comment"># ä¸»æœºç«¯å£</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li>ClusterIPï¼šé»˜è®¤å€¼ï¼Œå®ƒæ˜¯Kubernetesç³»ç»Ÿè‡ªåŠ¨åˆ†é…çš„è™šæ‹ŸIPï¼Œåªèƒ½åœ¨é›†ç¾¤å†…éƒ¨è®¿é—®</li>
<li>NodePortï¼šå°†Serviceé€šè¿‡æŒ‡å®šçš„Nodeä¸Šçš„ç«¯å£æš´éœ²ç»™å¤–éƒ¨ï¼Œé€šè¿‡æ­¤æ–¹æ³•ï¼Œå°±å¯ä»¥åœ¨é›†ç¾¤å¤–éƒ¨è®¿é—®æœåŠ¡</li>
<li>LoadBalancerï¼šä½¿ç”¨å¤–æ¥è´Ÿè½½å‡è¡¡å™¨å®Œæˆåˆ°æœåŠ¡çš„è´Ÿè½½åˆ†å‘ï¼Œæ³¨æ„æ­¤æ¨¡å¼éœ€è¦å¤–éƒ¨äº‘ç¯å¢ƒæ”¯æŒ</li>
<li>ExternalNameï¼š æŠŠé›†ç¾¤å¤–éƒ¨çš„æœåŠ¡å¼•å…¥é›†ç¾¤å†…éƒ¨ï¼Œç›´æ¥ä½¿ç”¨</li>
</ul>
<h4 id="7-3-Serviceä½¿ç”¨"><a href="#7-3-Serviceä½¿ç”¨" class="headerlink" title="7.3 Serviceä½¿ç”¨"></a>7.3 Serviceä½¿ç”¨</h4><h5 id="7-3-1-å®éªŒç¯å¢ƒå‡†å¤‡"><a href="#7-3-1-å®éªŒç¯å¢ƒå‡†å¤‡" class="headerlink" title="7.3.1 å®éªŒç¯å¢ƒå‡†å¤‡"></a>7.3.1 å®éªŒç¯å¢ƒå‡†å¤‡</h5><p>åœ¨ä½¿ç”¨serviceä¹‹å‰ï¼Œé¦–å…ˆåˆ©ç”¨Deploymentåˆ›å»ºå‡º3ä¸ªpodï¼Œæ³¨æ„è¦ä¸ºpodè®¾ç½®<code>app=nginx-pod</code>çš„æ ‡ç­¾</p>
<p>åˆ›å»ºdeployment.yamlï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span>      </span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pc-deployment</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">spec:</span> </span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">nginx-pod</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">nginx-pod</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">nginx:1.17.1</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">[root@k8s-master01 ~]# kubectl create -f deployment.yaml</span><br><span class="line">deployment.apps/pc-deployment created</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹podè¯¦æƒ…</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl get pods -n dev -o wide --show-labels</span><br><span class="line">NAME                             READY   STATUS     IP            NODE     LABELS</span><br><span class="line">pc-deployment-66cb59b984-8p84h   1/1     Running    10.244.1.39   node1    app=nginx-pod</span><br><span class="line">pc-deployment-66cb59b984-vx8vx   1/1     Running    10.244.2.33   node2    app=nginx-pod</span><br><span class="line">pc-deployment-66cb59b984-wnncx   1/1     Running    10.244.1.40   node1    app=nginx-pod</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¸ºäº†æ–¹ä¾¿åé¢çš„æµ‹è¯•ï¼Œä¿®æ”¹ä¸‹ä¸‰å°nginxçš„index.htmlé¡µé¢ï¼ˆä¸‰å°ä¿®æ”¹çš„IPåœ°å€ä¸ä¸€è‡´ï¼‰</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> kubectl <span class="built_in">exec</span> -it pc-deployment-66cb59b984-8p84h -n dev /bin/sh</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">echo</span> <span class="string">&quot;10.244.1.39&quot;</span> &gt; /usr/share/nginx/html/index.html</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">ä¿®æ”¹å®Œæ¯•ä¹‹åï¼Œè®¿é—®æµ‹è¯•</span></span><br><span class="line">[root@k8s-master01 ~]# curl 10.244.1.39</span><br><span class="line">10.244.1.39</span><br><span class="line">[root@k8s-master01 ~]# curl 10.244.2.33</span><br><span class="line">10.244.2.33</span><br><span class="line">[root@k8s-master01 ~]# curl 10.244.1.40</span><br><span class="line">10.244.1.40</span><br></pre></td></tr></table></figure></div>

<h5 id="7-3-2-ClusterIPç±»å‹çš„Service"><a href="#7-3-2-ClusterIPç±»å‹çš„Service" class="headerlink" title="7.3.2 ClusterIPç±»å‹çš„Service"></a>7.3.2 ClusterIPç±»å‹çš„Service</h5><p>åˆ›å»ºservice-clusterip.yamlæ–‡ä»¶</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">service-clusterip</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx-pod</span></span><br><span class="line">  <span class="attr">clusterIP:</span> <span class="number">10.97</span><span class="number">.97</span><span class="number">.97</span> <span class="comment"># serviceçš„ipåœ°å€ï¼Œå¦‚æœä¸å†™ï¼Œé»˜è®¤ä¼šç”Ÿæˆä¸€ä¸ª</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">ClusterIP</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">80</span>  <span class="comment"># Serviceç«¯å£       </span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">80</span> <span class="comment"># podç«¯å£</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åˆ›å»ºservice</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl create -f service-clusterip.yaml</span><br><span class="line">service/service-clusterip created</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹service</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl get svc -n dev -o wide</span><br><span class="line">NAME                TYPE        CLUSTER-IP    EXTERNAL-IP   PORT(S)   AGE   SELECTOR</span><br><span class="line">service-clusterip   ClusterIP   10.97.97.97   &lt;none&gt;        80/TCP    13s   app=nginx-pod</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹serviceçš„è¯¦ç»†ä¿¡æ¯</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> åœ¨è¿™é‡Œæœ‰ä¸€ä¸ªEndpointsåˆ—è¡¨ï¼Œé‡Œé¢å°±æ˜¯å½“å‰serviceå¯ä»¥è´Ÿè½½åˆ°çš„æœåŠ¡å…¥å£</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl describe svc service-clusterip -n dev</span><br><span class="line">Name:              service-clusterip</span><br><span class="line">Namespace:         dev</span><br><span class="line">Labels:            &lt;none&gt;</span><br><span class="line">Annotations:       &lt;none&gt;</span><br><span class="line">Selector:          app=nginx-pod</span><br><span class="line">Type:              ClusterIP</span><br><span class="line">IP:                10.97.97.97</span><br><span class="line">Port:              &lt;unset&gt;  80/TCP</span><br><span class="line">TargetPort:        80/TCP</span><br><span class="line">Endpoints:         10.244.1.39:80,10.244.1.40:80,10.244.2.33:80</span><br><span class="line">Session Affinity:  None</span><br><span class="line">Events:            &lt;none&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹ipvsçš„æ˜ å°„è§„åˆ™</span></span><br><span class="line">[root@k8s-master01 ~]# ipvsadm -Ln</span><br><span class="line">TCP  10.97.97.97:80 rr</span><br><span class="line"><span class="meta">  -&gt;</span><span class="bash"> 10.244.1.39:80               Masq    1      0          0</span></span><br><span class="line"><span class="meta">  -&gt;</span><span class="bash"> 10.244.1.40:80               Masq    1      0          0</span></span><br><span class="line"><span class="meta">  -&gt;</span><span class="bash"> 10.244.2.33:80               Masq    1      0          0</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> è®¿é—®10.97.97.97:80è§‚å¯Ÿæ•ˆæœ</span></span><br><span class="line">[root@k8s-master01 ~]# curl 10.97.97.97:80</span><br><span class="line">10.244.2.33</span><br></pre></td></tr></table></figure></div>

<h5 id="7-3-3-Endpoint"><a href="#7-3-3-Endpoint" class="headerlink" title="7.3.3 Endpoint"></a>7.3.3 Endpoint</h5><p>Endpointæ˜¯kubernetesä¸­çš„ä¸€ä¸ªèµ„æºå¯¹è±¡ï¼Œå­˜å‚¨åœ¨etcdä¸­ï¼Œç”¨æ¥è®°å½•ä¸€ä¸ªserviceå¯¹åº”çš„æ‰€æœ‰podçš„è®¿é—®åœ°å€ï¼Œå®ƒæ˜¯æ ¹æ®serviceé…ç½®æ–‡ä»¶ä¸­selectoræè¿°äº§ç”Ÿçš„ã€‚</p>
<p>ä¸€ä¸ªServiceç”±ä¸€ç»„Podç»„æˆï¼Œè¿™äº›Podé€šè¿‡Endpointsæš´éœ²å‡ºæ¥ï¼Œ<strong>Endpointsæ˜¯å®ç°å®é™…æœåŠ¡çš„ç«¯ç‚¹é›†åˆ</strong>ã€‚æ¢å¥è¯è¯´ï¼Œserviceå’Œpodä¹‹é—´çš„è”ç³»æ˜¯é€šè¿‡endpointså®ç°çš„ã€‚</p>
<p><img src="/2022/06/09/uncatalog/cl46zbay9000j7or7b2e4b2pr/image-20200509191917069.png" alt="image-20200509191917069"></p>
<p><strong>è´Ÿè½½åˆ†å‘ç­–ç•¥</strong></p>
<p>å¯¹Serviceçš„è®¿é—®è¢«åˆ†å‘åˆ°äº†åç«¯çš„Podä¸Šå»ï¼Œç›®å‰kubernetesæä¾›äº†ä¸¤ç§è´Ÿè½½åˆ†å‘ç­–ç•¥ï¼š</p>
<ul>
<li><p>å¦‚æœä¸å®šä¹‰ï¼Œé»˜è®¤ä½¿ç”¨kube-proxyçš„ç­–ç•¥ï¼Œæ¯”å¦‚éšæœºã€è½®è¯¢</p>
</li>
<li><p>åŸºäºå®¢æˆ·ç«¯åœ°å€çš„ä¼šè¯ä¿æŒæ¨¡å¼ï¼Œå³æ¥è‡ªåŒä¸€ä¸ªå®¢æˆ·ç«¯å‘èµ·çš„æ‰€æœ‰è¯·æ±‚éƒ½ä¼šè½¬å‘åˆ°å›ºå®šçš„ä¸€ä¸ªPodä¸Š</p>
<p>æ­¤æ¨¡å¼å¯ä»¥ä½¿åœ¨specä¸­æ·»åŠ <code>sessionAffinity:ClientIP</code>é€‰é¡¹</p>
</li>
</ul>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹ipvsçš„æ˜ å°„è§„åˆ™ã€rr è½®è¯¢ã€‘</span></span><br><span class="line">[root@k8s-master01 ~]# ipvsadm -Ln</span><br><span class="line">TCP  10.97.97.97:80 rr</span><br><span class="line"><span class="meta">  -&gt;</span><span class="bash"> 10.244.1.39:80               Masq    1      0          0</span></span><br><span class="line"><span class="meta">  -&gt;</span><span class="bash"> 10.244.1.40:80               Masq    1      0          0</span></span><br><span class="line"><span class="meta">  -&gt;</span><span class="bash"> 10.244.2.33:80               Masq    1      0          0</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¾ªç¯è®¿é—®æµ‹è¯•</span></span><br><span class="line">[root@k8s-master01 ~]# while true;do curl 10.97.97.97:80; sleep 5; done;</span><br><span class="line">10.244.1.40</span><br><span class="line">10.244.1.39</span><br><span class="line">10.244.2.33</span><br><span class="line">10.244.1.40</span><br><span class="line">10.244.1.39</span><br><span class="line">10.244.2.33</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¿®æ”¹åˆ†å‘ç­–ç•¥----sessionAffinity:ClientIP</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹ipvsè§„åˆ™ã€persistent ä»£è¡¨æŒä¹…ã€‘</span></span><br><span class="line">[root@k8s-master01 ~]# ipvsadm -Ln</span><br><span class="line">TCP  10.97.97.97:80 rr persistent 10800</span><br><span class="line"><span class="meta">  -&gt;</span><span class="bash"> 10.244.1.39:80               Masq    1      0          0</span></span><br><span class="line"><span class="meta">  -&gt;</span><span class="bash"> 10.244.1.40:80               Masq    1      0          0</span></span><br><span class="line"><span class="meta">  -&gt;</span><span class="bash"> 10.244.2.33:80               Masq    1      0          0</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¾ªç¯è®¿é—®æµ‹è¯•</span></span><br><span class="line">[root@k8s-master01 ~]# while true;do curl 10.97.97.97; sleep 5; done;</span><br><span class="line">10.244.2.33</span><br><span class="line">10.244.2.33</span><br><span class="line">10.244.2.33</span><br><span class="line">  </span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆ é™¤service</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl delete -f service-clusterip.yaml</span><br><span class="line">service &quot;service-clusterip&quot; deleted</span><br></pre></td></tr></table></figure></div>

<h5 id="7-3-4-HeadLinessç±»å‹çš„Service"><a href="#7-3-4-HeadLinessç±»å‹çš„Service" class="headerlink" title="7.3.4 HeadLinessç±»å‹çš„Service"></a>7.3.4 HeadLinessç±»å‹çš„Service</h5><p>åœ¨æŸäº›åœºæ™¯ä¸­ï¼Œå¼€å‘äººå‘˜å¯èƒ½ä¸æƒ³ä½¿ç”¨Serviceæä¾›çš„è´Ÿè½½å‡è¡¡åŠŸèƒ½ï¼Œè€Œå¸Œæœ›è‡ªå·±æ¥æ§åˆ¶è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œé’ˆå¯¹è¿™ç§æƒ…å†µï¼Œkubernetesæä¾›äº†HeadLiness Serviceï¼Œè¿™ç±»Serviceä¸ä¼šåˆ†é…Cluster IPï¼Œå¦‚æœæƒ³è¦è®¿é—®serviceï¼Œåªèƒ½é€šè¿‡serviceçš„åŸŸåè¿›è¡ŒæŸ¥è¯¢ã€‚</p>
<p>åˆ›å»ºservice-headliness.yaml</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">service-headliness</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx-pod</span></span><br><span class="line">  <span class="attr">clusterIP:</span> <span class="string">None</span> <span class="comment"># å°†clusterIPè®¾ç½®ä¸ºNoneï¼Œå³å¯åˆ›å»ºheadliness Service</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">ClusterIP</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">80</span>    </span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åˆ›å»ºservice</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl create -f service-headliness.yaml</span><br><span class="line">service/service-headliness created</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> è·å–serviceï¼Œ å‘ç°CLUSTER-IPæœªåˆ†é…</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl get svc service-headliness -n dev -o wide</span><br><span class="line">NAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE   SELECTOR</span><br><span class="line">service-headliness   ClusterIP   None         &lt;none&gt;        80/TCP    11s   app=nginx-pod</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹serviceè¯¦æƒ…</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl describe svc service-headliness  -n dev</span><br><span class="line">Name:              service-headliness</span><br><span class="line">Namespace:         dev</span><br><span class="line">Labels:            &lt;none&gt;</span><br><span class="line">Annotations:       &lt;none&gt;</span><br><span class="line">Selector:          app=nginx-pod</span><br><span class="line">Type:              ClusterIP</span><br><span class="line">IP:                None</span><br><span class="line">Port:              &lt;unset&gt;  80/TCP</span><br><span class="line">TargetPort:        80/TCP</span><br><span class="line">Endpoints:         10.244.1.39:80,10.244.1.40:80,10.244.2.33:80</span><br><span class="line">Session Affinity:  None</span><br><span class="line">Events:            &lt;none&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹åŸŸåçš„è§£ææƒ…å†µ</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl exec -it pc-deployment-66cb59b984-8p84h -n dev /bin/sh</span><br><span class="line">/ # cat /etc/resolv.conf</span><br><span class="line">nameserver 10.96.0.10</span><br><span class="line">search dev.svc.cluster.local svc.cluster.local cluster.local</span><br><span class="line"></span><br><span class="line">[root@k8s-master01 ~]# dig @10.96.0.10 service-headliness.dev.svc.cluster.local</span><br><span class="line">service-headliness.dev.svc.cluster.local. 30 IN A 10.244.1.40</span><br><span class="line">service-headliness.dev.svc.cluster.local. 30 IN A 10.244.1.39</span><br><span class="line">service-headliness.dev.svc.cluster.local. 30 IN A 10.244.2.33</span><br></pre></td></tr></table></figure></div>

<h5 id="7-3-5-NodePortç±»å‹çš„Service"><a href="#7-3-5-NodePortç±»å‹çš„Service" class="headerlink" title="7.3.5 NodePortç±»å‹çš„Service"></a>7.3.5 NodePortç±»å‹çš„Service</h5><p>åœ¨ä¹‹å‰çš„æ ·ä¾‹ä¸­ï¼Œåˆ›å»ºçš„Serviceçš„ipåœ°å€åªæœ‰é›†ç¾¤å†…éƒ¨æ‰å¯ä»¥è®¿é—®ï¼Œå¦‚æœå¸Œæœ›å°†Serviceæš´éœ²ç»™é›†ç¾¤å¤–éƒ¨ä½¿ç”¨ï¼Œé‚£ä¹ˆå°±è¦ä½¿ç”¨åˆ°å¦å¤–ä¸€ç§ç±»å‹çš„Serviceï¼Œç§°ä¸ºNodePortç±»å‹ã€‚NodePortçš„å·¥ä½œåŸç†å…¶å®å°±æ˜¯<strong>å°†serviceçš„ç«¯å£æ˜ å°„åˆ°Nodeçš„ä¸€ä¸ªç«¯å£ä¸Š</strong>ï¼Œç„¶åå°±å¯ä»¥é€šè¿‡<code>NodeIp:NodePort</code>æ¥è®¿é—®serviceäº†ã€‚</p>
<p><img src="/2022/06/09/uncatalog/cl46zbay9000j7or7b2e4b2pr/image-20200620175731338.png" alt="img"></p>
<p>åˆ›å»ºservice-nodeport.yaml</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">service-nodeport</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx-pod</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">NodePort</span> <span class="comment"># serviceç±»å‹</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">nodePort:</span> <span class="number">30002</span> <span class="comment"># æŒ‡å®šç»‘å®šçš„nodeçš„ç«¯å£(é»˜è®¤çš„å–å€¼èŒƒå›´æ˜¯ï¼š30000-32767), å¦‚æœä¸æŒ‡å®šï¼Œä¼šé»˜è®¤åˆ†é…</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åˆ›å»ºservice</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl create -f service-nodeport.yaml</span><br><span class="line">service/service-nodeport created</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹service</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl get svc -n dev -o wide</span><br><span class="line">NAME               TYPE       CLUSTER-IP      EXTERNAL-IP   PORT(S)       SELECTOR</span><br><span class="line">service-nodeport   NodePort   10.105.64.191   &lt;none&gt;        80:30002/TCP  app=nginx-pod</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ¥ä¸‹æ¥å¯ä»¥é€šè¿‡ç”µè„‘ä¸»æœºçš„æµè§ˆå™¨å»è®¿é—®é›†ç¾¤ä¸­ä»»æ„ä¸€ä¸ªnodeipçš„30002ç«¯å£ï¼Œå³å¯è®¿é—®åˆ°pod</span></span><br></pre></td></tr></table></figure></div>

<h5 id="7-3-6-LoadBalancerç±»å‹çš„Service"><a href="#7-3-6-LoadBalancerç±»å‹çš„Service" class="headerlink" title="7.3.6 LoadBalancerç±»å‹çš„Service"></a>7.3.6 LoadBalancerç±»å‹çš„Service</h5><p>LoadBalancerå’ŒNodePortå¾ˆç›¸ä¼¼ï¼Œç›®çš„éƒ½æ˜¯å‘å¤–éƒ¨æš´éœ²ä¸€ä¸ªç«¯å£ï¼ŒåŒºåˆ«åœ¨äºLoadBalancerä¼šåœ¨é›†ç¾¤çš„å¤–éƒ¨å†æ¥åšä¸€ä¸ªè´Ÿè½½å‡è¡¡è®¾å¤‡ï¼Œè€Œè¿™ä¸ªè®¾å¤‡éœ€è¦å¤–éƒ¨ç¯å¢ƒæ”¯æŒçš„ï¼Œå¤–éƒ¨æœåŠ¡å‘é€åˆ°è¿™ä¸ªè®¾å¤‡ä¸Šçš„è¯·æ±‚ï¼Œä¼šè¢«è®¾å¤‡è´Ÿè½½ä¹‹åè½¬å‘åˆ°é›†ç¾¤ä¸­ã€‚</p>
<p><img src="/2022/06/09/uncatalog/cl46zbay9000j7or7b2e4b2pr/image-20200510103945494.png" alt="img"></p>
<h5 id="7-3-7-ExternalNameç±»å‹çš„Service"><a href="#7-3-7-ExternalNameç±»å‹çš„Service" class="headerlink" title="7.3.7 ExternalNameç±»å‹çš„Service"></a>7.3.7 ExternalNameç±»å‹çš„Service</h5><p>ExternalNameç±»å‹çš„Serviceç”¨äºå¼•å…¥é›†ç¾¤å¤–éƒ¨çš„æœåŠ¡ï¼Œå®ƒé€šè¿‡<code>externalName</code>å±æ€§æŒ‡å®šå¤–éƒ¨ä¸€ä¸ªæœåŠ¡çš„åœ°å€ï¼Œç„¶ååœ¨é›†ç¾¤å†…éƒ¨è®¿é—®æ­¤serviceå°±å¯ä»¥è®¿é—®åˆ°å¤–éƒ¨çš„æœåŠ¡äº†ã€‚</p>
<p><img src="/2022/06/09/uncatalog/cl46zbay9000j7or7b2e4b2pr/image-20200510113311209.png" alt="img"></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: service-externalname</span><br><span class="line">  namespace: dev</span><br><span class="line">spec:</span><br><span class="line">  type: ExternalName # serviceç±»å‹</span><br><span class="line">  externalName: www.baidu.com  #æ”¹æˆipåœ°å€ä¹Ÿå¯ä»¥</span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åˆ›å»ºservice</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl  create -f service-externalname.yaml</span><br><span class="line">service/service-externalname created</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> åŸŸåè§£æ</span></span><br><span class="line">[root@k8s-master01 ~]# dig @10.96.0.10 service-externalname.dev.svc.cluster.local</span><br><span class="line">service-externalname.dev.svc.cluster.local. 30 IN CNAME www.baidu.com.</span><br><span class="line">www.baidu.com.          30      IN      CNAME   www.a.shifen.com.</span><br><span class="line">www.a.shifen.com.       30      IN      A       39.156.66.18</span><br><span class="line">www.a.shifen.com.       30      IN      A       39.156.66.14</span><br></pre></td></tr></table></figure></div>

<h4 id="7-4-Ingressä»‹ç»"><a href="#7-4-Ingressä»‹ç»" class="headerlink" title="7.4 Ingressä»‹ç»"></a>7.4 Ingressä»‹ç»</h4><p>åœ¨å‰é¢è¯¾ç¨‹ä¸­å·²ç»æåˆ°ï¼ŒServiceå¯¹é›†ç¾¤ä¹‹å¤–æš´éœ²æœåŠ¡çš„ä¸»è¦æ–¹å¼æœ‰ä¸¤ç§ï¼šNotePortå’ŒLoadBalancerï¼Œä½†æ˜¯è¿™ä¸¤ç§æ–¹å¼ï¼Œéƒ½æœ‰ä¸€å®šçš„ç¼ºç‚¹ï¼š</p>
<ul>
<li>NodePortæ–¹å¼çš„ç¼ºç‚¹æ˜¯ä¼šå ç”¨å¾ˆå¤šé›†ç¾¤æœºå™¨çš„ç«¯å£ï¼Œé‚£ä¹ˆå½“é›†ç¾¤æœåŠ¡å˜å¤šçš„æ—¶å€™ï¼Œè¿™ä¸ªç¼ºç‚¹å°±æ„ˆå‘æ˜æ˜¾</li>
<li>LBæ–¹å¼çš„ç¼ºç‚¹æ˜¯æ¯ä¸ªserviceéœ€è¦ä¸€ä¸ªLBï¼Œæµªè´¹ã€éº»çƒ¦ï¼Œå¹¶ä¸”éœ€è¦kubernetesä¹‹å¤–è®¾å¤‡çš„æ”¯æŒ</li>
</ul>
<p>åŸºäºè¿™ç§ç°çŠ¶ï¼Œkubernetesæä¾›äº†Ingressèµ„æºå¯¹è±¡ï¼ŒIngressåªéœ€è¦ä¸€ä¸ªNodePortæˆ–è€…ä¸€ä¸ªLBå°±å¯ä»¥æ»¡è¶³æš´éœ²å¤šä¸ªServiceçš„éœ€æ±‚ã€‚å·¥ä½œæœºåˆ¶å¤§è‡´å¦‚ä¸‹å›¾è¡¨ç¤ºï¼š</p>
<p><img src="/2022/06/09/uncatalog/cl46zbay9000j7or7b2e4b2pr/image-20200623092808049.png" alt="img"></p>
<p>å®é™…ä¸Šï¼ŒIngressç›¸å½“äºä¸€ä¸ª7å±‚çš„è´Ÿè½½å‡è¡¡å™¨ï¼Œæ˜¯kuberneteså¯¹åå‘ä»£ç†çš„ä¸€ä¸ªæŠ½è±¡ï¼Œå®ƒçš„å·¥ä½œåŸç†ç±»ä¼¼äºNginxï¼Œå¯ä»¥ç†è§£æˆåœ¨<strong>Ingressé‡Œå»ºç«‹è¯¸å¤šæ˜ å°„è§„åˆ™ï¼ŒIngress Controlleré€šè¿‡ç›‘å¬è¿™äº›é…ç½®è§„åˆ™å¹¶è½¬åŒ–æˆNginxçš„åå‘ä»£ç†é…ç½® , ç„¶åå¯¹å¤–éƒ¨æä¾›æœåŠ¡</strong>ã€‚åœ¨è¿™é‡Œæœ‰ä¸¤ä¸ªæ ¸å¿ƒæ¦‚å¿µï¼š</p>
<ul>
<li>ingressï¼škubernetesä¸­çš„ä¸€ä¸ªå¯¹è±¡ï¼Œä½œç”¨æ˜¯å®šä¹‰è¯·æ±‚å¦‚ä½•è½¬å‘åˆ°serviceçš„è§„åˆ™</li>
<li>ingress controllerï¼šå…·ä½“å®ç°åå‘ä»£ç†åŠè´Ÿè½½å‡è¡¡çš„ç¨‹åºï¼Œå¯¹ingresså®šä¹‰çš„è§„åˆ™è¿›è¡Œè§£æï¼Œæ ¹æ®é…ç½®çš„è§„åˆ™æ¥å®ç°è¯·æ±‚è½¬å‘ï¼Œå®ç°æ–¹å¼æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚Nginx, Contour, Haproxyç­‰ç­‰</li>
</ul>
<p>Ingressï¼ˆä»¥Nginxä¸ºä¾‹ï¼‰çš„å·¥ä½œåŸç†å¦‚ä¸‹ï¼š</p>
<ol>
<li>ç”¨æˆ·ç¼–å†™Ingressè§„åˆ™ï¼Œè¯´æ˜å“ªä¸ªåŸŸåå¯¹åº”kubernetesé›†ç¾¤ä¸­çš„å“ªä¸ªService</li>
<li>Ingressæ§åˆ¶å™¨åŠ¨æ€æ„ŸçŸ¥IngressæœåŠ¡è§„åˆ™çš„å˜åŒ–ï¼Œç„¶åç”Ÿæˆä¸€æ®µå¯¹åº”çš„Nginxåå‘ä»£ç†é…ç½®</li>
<li>Ingressæ§åˆ¶å™¨ä¼šå°†ç”Ÿæˆçš„Nginxé…ç½®å†™å…¥åˆ°ä¸€ä¸ªè¿è¡Œç€çš„NginxæœåŠ¡ä¸­ï¼Œå¹¶åŠ¨æ€æ›´æ–°</li>
<li>åˆ°æ­¤ä¸ºæ­¢ï¼Œå…¶å®çœŸæ­£åœ¨å·¥ä½œçš„å°±æ˜¯ä¸€ä¸ªNginxäº†ï¼Œå†…éƒ¨é…ç½®äº†ç”¨æˆ·å®šä¹‰çš„è¯·æ±‚è½¬å‘è§„åˆ™</li>
</ol>
<p><img src="/2022/06/09/uncatalog/cl46zbay9000j7or7b2e4b2pr/image-20200516112704764.png" alt="img"></p>
<h4 id="7-5-Ingressä½¿ç”¨"><a href="#7-5-Ingressä½¿ç”¨" class="headerlink" title="7.5 Ingressä½¿ç”¨"></a>7.5 Ingressä½¿ç”¨</h4><h5 id="7-5-1-ç¯å¢ƒå‡†å¤‡-æ­å»ºingressç¯å¢ƒ"><a href="#7-5-1-ç¯å¢ƒå‡†å¤‡-æ­å»ºingressç¯å¢ƒ" class="headerlink" title="7.5.1 ç¯å¢ƒå‡†å¤‡ æ­å»ºingressç¯å¢ƒ"></a>7.5.1 ç¯å¢ƒå‡†å¤‡ æ­å»ºingressç¯å¢ƒ</h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="MAKEFILE"><figure class="iseeu highlight /makefile"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºæ–‡ä»¶å¤¹</span></span><br><span class="line">[root@k8s-master01 ~]<span class="comment"># mkdir ingress-controller</span></span><br><span class="line">[root@k8s-master01 ~]<span class="comment"># cd ingress-controller/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–ingress-nginxï¼Œæœ¬æ¬¡æ¡ˆä¾‹ä½¿ç”¨çš„æ˜¯0.30ç‰ˆæœ¬</span></span><br><span class="line">[root@k8s-master01 ingress-controller]<span class="comment"># wget https://raw.githubusercontent.com/kubernetes/ingress-nginx/nginx-0.30.0/deploy/static/mandatory.yaml</span></span><br><span class="line">[root@k8s-master01 ingress-controller]<span class="comment"># wget https://raw.githubusercontent.com/kubernetes/ingress-nginx/nginx-0.30.0/deploy/static/provider/baremetal/service-nodeport.yaml</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹mandatory.yamlæ–‡ä»¶ä¸­çš„ä»“åº“</span></span><br><span class="line"><span class="comment"># ä¿®æ”¹quay.io/kubernetes-ingress-controller/nginx-ingress-controller:0.30.0</span></span><br><span class="line"><span class="comment"># ä¸ºquay-mirror.qiniu.com/kubernetes-ingress-controller/nginx-ingress-controller:0.30.0</span></span><br><span class="line"><span class="comment"># åˆ›å»ºingress-nginx</span></span><br><span class="line">[root@k8s-master01 ingress-controller]<span class="comment"># kubectl apply -f ./</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ingress-nginx</span></span><br><span class="line">[root@k8s-master01 ingress-controller]<span class="comment"># kubectl get pod -n ingress-nginx</span></span><br><span class="line">NAME                                           READY   STATUS    RESTARTS   AGE</span><br><span class="line">pod/nginx-ingress-controller-fbf967dd5-4qpbp   1/1     Running   0          12h</span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹service</span></span><br><span class="line">[root@k8s-master01 ingress-controller]<span class="comment"># kubectl get svc -n ingress-nginx</span></span><br><span class="line">NAME            TYPE       CLUSTER-IP     EXTERNAL-IP   PORT(S)                      AGE</span><br><span class="line">ingress-nginx   NodePort   10.98.75.163   &lt;none&gt;        80:32240/TCP,443:31335/TCP   11h</span><br></pre></td></tr></table></figure></div>

<h5 id="7-5-2-å‡†å¤‡serviceå’Œpod"><a href="#7-5-2-å‡†å¤‡serviceå’Œpod" class="headerlink" title="7.5.2 å‡†å¤‡serviceå’Œpod"></a>7.5.2 å‡†å¤‡serviceå’Œpod</h5><p>ä¸ºäº†åé¢çš„å®éªŒæ¯”è¾ƒæ–¹ä¾¿ï¼Œåˆ›å»ºå¦‚ä¸‹å›¾æ‰€ç¤ºçš„æ¨¡å‹</p>
<p><img src="/2022/06/09/uncatalog/cl46zbay9000j7or7b2e4b2pr/image-20200516102419998.png" alt="img"></p>
<p>åˆ›å»ºtomcat-nginx.yaml</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-deployment</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">nginx-pod</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">nginx-pod</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">nginx:1.17.1</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">tomcat-deployment</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">tomcat-pod</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">tomcat-pod</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">tomcat</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">tomcat:8.5-jre10-slim</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">8080</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-service</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx-pod</span></span><br><span class="line">  <span class="attr">clusterIP:</span> <span class="string">None</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">ClusterIP</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">tomcat-service</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">tomcat-pod</span></span><br><span class="line">  <span class="attr">clusterIP:</span> <span class="string">None</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">ClusterIP</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">8080</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åˆ›å»º</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl create -f tomcat-nginx.yaml</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl get svc -n dev</span><br><span class="line">NAME             TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)    AGE</span><br><span class="line">nginx-service    ClusterIP   None         &lt;none&gt;        80/TCP     48s</span><br><span class="line">tomcat-service   ClusterIP   None         &lt;none&gt;        8080/TCP   48s</span><br></pre></td></tr></table></figure></div>

<h5 id="7-5-3-Httpä»£ç†"><a href="#7-5-3-Httpä»£ç†" class="headerlink" title="7.5.3 Httpä»£ç†"></a>7.5.3 Httpä»£ç†</h5><p>åˆ›å»ºingress-http.yaml</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">extensions/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ingress-http</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">nginx.itheima.com</span></span><br><span class="line">    <span class="attr">http:</span></span><br><span class="line">      <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/</span></span><br><span class="line">        <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">serviceName:</span> <span class="string">nginx-service</span></span><br><span class="line">          <span class="attr">servicePort:</span> <span class="number">80</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">tomcat.itheima.com</span></span><br><span class="line">    <span class="attr">http:</span></span><br><span class="line">      <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/</span></span><br><span class="line">        <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">serviceName:</span> <span class="string">tomcat-service</span></span><br><span class="line">          <span class="attr">servicePort:</span> <span class="number">8080</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åˆ›å»º</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl create -f ingress-http.yaml</span><br><span class="line">ingress.extensions/ingress-http created</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl get ing ingress-http -n dev</span><br><span class="line">NAME           HOSTS                                  ADDRESS   PORTS   AGE</span><br><span class="line">ingress-http   nginx.itheima.com,tomcat.itheima.com             80      22s</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹è¯¦æƒ…</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl describe ing ingress-http  -n dev</span><br><span class="line">...</span><br><span class="line">Rules:</span><br><span class="line">Host                Path  Backends</span><br><span class="line">----                ----  --------</span><br><span class="line">nginx.itheima.com   / nginx-service:80 (10.244.1.96:80,10.244.1.97:80,10.244.2.112:80)</span><br><span class="line">tomcat.itheima.com  / tomcat-service:8080(10.244.1.94:8080,10.244.1.95:8080,10.244.2.111:8080)</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ¥ä¸‹æ¥,åœ¨æœ¬åœ°ç”µè„‘ä¸Šé…ç½®hostæ–‡ä»¶,è§£æä¸Šé¢çš„ä¸¤ä¸ªåŸŸååˆ°192.168.109.100(master)ä¸Š</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ç„¶å,å°±å¯ä»¥åˆ†åˆ«è®¿é—®tomcat.itheima.com:32240  å’Œ  nginx.itheima.com:32240 æŸ¥çœ‹æ•ˆæœäº†</span></span><br></pre></td></tr></table></figure></div>

<h5 id="7-5-4-Httpsä»£ç†"><a href="#7-5-4-Httpsä»£ç†" class="headerlink" title="7.5.4 Httpsä»£ç†"></a>7.5.4 Httpsä»£ç†</h5><p>åˆ›å»ºè¯ä¹¦</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ç”Ÿæˆè¯ä¹¦</span></span><br><span class="line">openssl req -x509 -sha256 -nodes -days 365 -newkey rsa:2048 -keyout tls.key -out tls.crt -subj &quot;/C=CN/ST=BJ/L=BJ/O=nginx/CN=itheima.com&quot;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆ›å»ºå¯†é’¥</span></span><br><span class="line">kubectl create secret tls tls-secret --key tls.key --cert tls.crt</span><br></pre></td></tr></table></figure></div>

<p>åˆ›å»ºingress-https.yaml</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">extensions/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ingress-https</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">tls:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">hosts:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">nginx.itheima.com</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">tomcat.itheima.com</span></span><br><span class="line">      <span class="attr">secretName:</span> <span class="string">tls-secret</span> <span class="comment"># æŒ‡å®šç§˜é’¥</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">nginx.itheima.com</span></span><br><span class="line">    <span class="attr">http:</span></span><br><span class="line">      <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/</span></span><br><span class="line">        <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">serviceName:</span> <span class="string">nginx-service</span></span><br><span class="line">          <span class="attr">servicePort:</span> <span class="number">80</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">tomcat.itheima.com</span></span><br><span class="line">    <span class="attr">http:</span></span><br><span class="line">      <span class="attr">paths:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/</span></span><br><span class="line">        <span class="attr">backend:</span></span><br><span class="line">          <span class="attr">serviceName:</span> <span class="string">tomcat-service</span></span><br><span class="line">          <span class="attr">servicePort:</span> <span class="number">8080</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åˆ›å»º</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl create -f ingress-https.yaml</span><br><span class="line">ingress.extensions/ingress-https created</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl get ing ingress-https -n dev</span><br><span class="line">NAME            HOSTS                                  ADDRESS         PORTS     AGE</span><br><span class="line">ingress-https   nginx.itheima.com,tomcat.itheima.com   10.104.184.38   80, 443   2m42s</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹è¯¦æƒ…</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl describe ing ingress-https -n dev</span><br><span class="line">...</span><br><span class="line">TLS:</span><br><span class="line">  tls-secret terminates nginx.itheima.com,tomcat.itheima.com</span><br><span class="line">Rules:</span><br><span class="line">Host              Path Backends</span><br><span class="line">----              ---- --------</span><br><span class="line">nginx.itheima.com  /  nginx-service:80 (10.244.1.97:80,10.244.1.98:80,10.244.2.119:80)</span><br><span class="line">tomcat.itheima.com /  tomcat-service:8080(10.244.1.99:8080,10.244.2.117:8080,10.244.2.120:8080)</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¸‹é¢å¯ä»¥é€šè¿‡æµè§ˆå™¨è®¿é—®https://nginx.itheima.com:31335 å’Œ https://tomcat.itheima.com:31335æ¥æŸ¥çœ‹äº†</span></span><br></pre></td></tr></table></figure></div>
]]></content>
      <tags>
        <tag>äº‘åŸç”ŸåŸºç¡€ç³»åˆ—</tag>
        <tag>Kubernetes</tag>
      </tags>
  </entry>
  <entry>
    <title>äº‘åŸç”ŸåŸºç¡€ç³»åˆ—ä¹‹Kubernetes(å…«)æ•°æ®å­˜å‚¨</title>
    <url>/2022/06/09/uncatalog/cl46zbay9000k7or71j4vcb8a/</url>
    <content><![CDATA[<hr>
<span id="more"></span>



<hr>
<h3 id="8-æ•°æ®å­˜å‚¨"><a href="#8-æ•°æ®å­˜å‚¨" class="headerlink" title="8. æ•°æ®å­˜å‚¨"></a>8. æ•°æ®å­˜å‚¨</h3><p>åœ¨å‰é¢å·²ç»æåˆ°ï¼Œå®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸå¯èƒ½å¾ˆçŸ­ï¼Œä¼šè¢«é¢‘ç¹åœ°åˆ›å»ºå’Œé”€æ¯ã€‚é‚£ä¹ˆå®¹å™¨åœ¨é”€æ¯æ—¶ï¼Œä¿å­˜åœ¨å®¹å™¨ä¸­çš„æ•°æ®ä¹Ÿä¼šè¢«æ¸…é™¤ã€‚è¿™ç§ç»“æœå¯¹ç”¨æˆ·æ¥è¯´ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹æ˜¯ä¸ä¹æ„çœ‹åˆ°çš„ã€‚ä¸ºäº†æŒä¹…åŒ–ä¿å­˜å®¹å™¨çš„æ•°æ®ï¼Œkuberneteså¼•å…¥äº†Volumeçš„æ¦‚å¿µã€‚</p>
<p>Volumeæ˜¯Podä¸­èƒ½å¤Ÿè¢«å¤šä¸ªå®¹å™¨è®¿é—®çš„å…±äº«ç›®å½•ï¼Œå®ƒè¢«å®šä¹‰åœ¨Podä¸Šï¼Œç„¶åè¢«ä¸€ä¸ªPodé‡Œçš„å¤šä¸ªå®¹å™¨æŒ‚è½½åˆ°å…·ä½“çš„æ–‡ä»¶ç›®å½•ä¸‹ï¼Œkubernetesé€šè¿‡Volumeå®ç°åŒä¸€ä¸ªPodä¸­ä¸åŒå®¹å™¨ä¹‹é—´çš„æ•°æ®å…±äº«ä»¥åŠæ•°æ®çš„æŒä¹…åŒ–å­˜å‚¨ã€‚Volumeçš„ç”Ÿå‘½å®¹å™¨ä¸ä¸Podä¸­å•ä¸ªå®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸç›¸å…³ï¼Œå½“å®¹å™¨ç»ˆæ­¢æˆ–è€…é‡å¯æ—¶ï¼ŒVolumeä¸­çš„æ•°æ®ä¹Ÿä¸ä¼šä¸¢å¤±ã€‚</p>
<p>kubernetesçš„Volumeæ”¯æŒå¤šç§ç±»å‹ï¼Œæ¯”è¾ƒå¸¸è§çš„æœ‰ä¸‹é¢å‡ ä¸ªï¼š</p>
<ul>
<li>ç®€å•å­˜å‚¨ï¼šEmptyDirã€HostPathã€NFS</li>
<li>é«˜çº§å­˜å‚¨ï¼šPVã€PVC</li>
<li>é…ç½®å­˜å‚¨ï¼šConfigMapã€Secret</li>
</ul>
<h4 id="8-1-åŸºæœ¬å­˜å‚¨"><a href="#8-1-åŸºæœ¬å­˜å‚¨" class="headerlink" title="8.1 åŸºæœ¬å­˜å‚¨"></a>8.1 åŸºæœ¬å­˜å‚¨</h4><h5 id="8-1-1-EmptyDir"><a href="#8-1-1-EmptyDir" class="headerlink" title="8.1.1 EmptyDir"></a>8.1.1 EmptyDir</h5><p>EmptyDiræ˜¯æœ€åŸºç¡€çš„Volumeç±»å‹ï¼Œä¸€ä¸ªEmptyDirå°±æ˜¯Hostä¸Šçš„ä¸€ä¸ªç©ºç›®å½•ã€‚</p>
<p>EmptyDiræ˜¯åœ¨Podè¢«åˆ†é…åˆ°Nodeæ—¶åˆ›å»ºçš„ï¼Œå®ƒçš„åˆå§‹å†…å®¹ä¸ºç©ºï¼Œå¹¶ä¸”æ— é¡»æŒ‡å®šå®¿ä¸»æœºä¸Šå¯¹åº”çš„ç›®å½•æ–‡ä»¶ï¼Œå› ä¸ºkubernetesä¼šè‡ªåŠ¨åˆ†é…ä¸€ä¸ªç›®å½•ï¼Œå½“Podé”€æ¯æ—¶ï¼Œ EmptyDirä¸­çš„æ•°æ®ä¹Ÿä¼šè¢«æ°¸ä¹…åˆ é™¤ã€‚ EmptyDirç”¨é€”å¦‚ä¸‹ï¼š</p>
<ul>
<li>ä¸´æ—¶ç©ºé—´ï¼Œä¾‹å¦‚ç”¨äºæŸäº›åº”ç”¨ç¨‹åºè¿è¡Œæ—¶æ‰€éœ€çš„ä¸´æ—¶ç›®å½•ï¼Œä¸”æ— é¡»æ°¸ä¹…ä¿ç•™</li>
<li>ä¸€ä¸ªå®¹å™¨éœ€è¦ä»å¦ä¸€ä¸ªå®¹å™¨ä¸­è·å–æ•°æ®çš„ç›®å½•ï¼ˆå¤šå®¹å™¨å…±äº«ç›®å½•ï¼‰</li>
</ul>
<p>æ¥ä¸‹æ¥ï¼Œé€šè¿‡ä¸€ä¸ªå®¹å™¨ä¹‹é—´æ–‡ä»¶å…±äº«çš„æ¡ˆä¾‹æ¥ä½¿ç”¨ä¸€ä¸‹EmptyDirã€‚</p>
<p>åœ¨ä¸€ä¸ªPodä¸­å‡†å¤‡ä¸¤ä¸ªå®¹å™¨nginxå’Œbusyboxï¼Œç„¶åå£°æ˜ä¸€ä¸ªVolumeåˆ†åˆ«æŒ‚åœ¨åˆ°ä¸¤ä¸ªå®¹å™¨çš„ç›®å½•ä¸­ï¼Œç„¶ånginxå®¹å™¨è´Ÿè´£å‘Volumeä¸­å†™æ—¥å¿—ï¼Œbusyboxä¸­é€šè¿‡å‘½ä»¤å°†æ—¥å¿—å†…å®¹è¯»åˆ°æ§åˆ¶å°ã€‚</p>
<p><img src="/2022/06/09/uncatalog/cl46zbay9000k7or71j4vcb8a/image-20200413174713773.png" alt="img"></p>
<p>åˆ›å»ºä¸€ä¸ªvolume-emptydir.yaml</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">volume-emptydir</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:1.17.1</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">volumeMounts:</span>  <span class="comment"># å°†logs-volumeæŒ‚åœ¨åˆ°nginxå®¹å™¨ä¸­ï¼Œå¯¹åº”çš„ç›®å½•ä¸º /var/log/nginx</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">logs-volume</span></span><br><span class="line">      <span class="attr">mountPath:</span> <span class="string">/var/log/nginx</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">busybox:1.30</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;/bin/sh&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;tail -f /logs/access.log&quot;</span>] <span class="comment"># åˆå§‹å‘½ä»¤ï¼ŒåŠ¨æ€è¯»å–æŒ‡å®šæ–‡ä»¶ä¸­å†…å®¹</span></span><br><span class="line">    <span class="attr">volumeMounts:</span>  <span class="comment"># å°†logs-volume æŒ‚åœ¨åˆ°busyboxå®¹å™¨ä¸­ï¼Œå¯¹åº”çš„ç›®å½•ä¸º /logs</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">logs-volume</span></span><br><span class="line">      <span class="attr">mountPath:</span> <span class="string">/logs</span></span><br><span class="line">  <span class="attr">volumes:</span> <span class="comment"># å£°æ˜volumeï¼Œ nameä¸ºlogs-volumeï¼Œç±»å‹ä¸ºemptyDir</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">logs-volume</span></span><br><span class="line">    <span class="attr">emptyDir:</span> &#123;&#125;</span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åˆ›å»ºPod</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl create -f volume-emptydir.yaml</span><br><span class="line">pod/volume-emptydir created</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹pod</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl get pods volume-emptydir -n dev -o wide</span><br><span class="line">NAME                  READY   STATUS    RESTARTS   AGE      IP       NODE   ...... </span><br><span class="line">volume-emptydir       2/2     Running   0          97s   10.42.2.9   node1  ......</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> é€šè¿‡podIpè®¿é—®nginx</span></span><br><span class="line">[root@k8s-master01 ~]# curl 10.42.2.9</span><br><span class="line">......</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> é€šè¿‡kubectl logså‘½ä»¤æŸ¥çœ‹æŒ‡å®šå®¹å™¨çš„æ ‡å‡†è¾“å‡º</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl logs -f volume-emptydir -n dev -c busybox</span><br><span class="line">10.42.1.0 - - [27/Jun/2021:15:08:54 +0000] &quot;GET / HTTP/1.1&quot; 200 612 &quot;-&quot; &quot;curl/7.29.0&quot; &quot;-&quot;</span><br></pre></td></tr></table></figure></div>

<h5 id="8-1-2-HostPath"><a href="#8-1-2-HostPath" class="headerlink" title="8.1.2 HostPath"></a>8.1.2 HostPath</h5><p>ä¸ŠèŠ‚è¯¾æåˆ°ï¼ŒEmptyDirä¸­æ•°æ®ä¸ä¼šè¢«æŒä¹…åŒ–ï¼Œå®ƒä¼šéšç€Podçš„ç»“æŸè€Œé”€æ¯ï¼Œå¦‚æœæƒ³ç®€å•çš„å°†æ•°æ®æŒä¹…åŒ–åˆ°ä¸»æœºä¸­ï¼Œå¯ä»¥é€‰æ‹©HostPathã€‚</p>
<p>HostPathå°±æ˜¯å°†Nodeä¸»æœºä¸­ä¸€ä¸ªå®é™…ç›®å½•æŒ‚åœ¨åˆ°Podä¸­ï¼Œä»¥ä¾›å®¹å™¨ä½¿ç”¨ï¼Œè¿™æ ·çš„è®¾è®¡å°±å¯ä»¥ä¿è¯Podé”€æ¯äº†ï¼Œä½†æ˜¯æ•°æ®ä¾æ®å¯ä»¥å­˜åœ¨äºNodeä¸»æœºä¸Šã€‚</p>
<p><img src="/2022/06/09/uncatalog/cl46zbay9000k7or71j4vcb8a/image-20200413214031331.png" alt="img"></p>
<p>åˆ›å»ºä¸€ä¸ªvolume-hostpath.yamlï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">volume-hostpath</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:1.17.1</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">volumeMounts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">logs-volume</span></span><br><span class="line">      <span class="attr">mountPath:</span> <span class="string">/var/log/nginx</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">busybox:1.30</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;/bin/sh&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;tail -f /logs/access.log&quot;</span>]</span><br><span class="line">    <span class="attr">volumeMounts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">logs-volume</span></span><br><span class="line">      <span class="attr">mountPath:</span> <span class="string">/logs</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">logs-volume</span></span><br><span class="line">    <span class="attr">hostPath:</span> </span><br><span class="line">      <span class="attr">path:</span> <span class="string">/root/logs</span></span><br><span class="line">      <span class="attr">type:</span> <span class="string">DirectoryOrCreate</span>  <span class="comment"># ç›®å½•å­˜åœ¨å°±ä½¿ç”¨ï¼Œä¸å­˜åœ¨å°±å…ˆåˆ›å»ºåä½¿ç”¨</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="code"><pre><span class="line">å…³äºtypeçš„å€¼çš„ä¸€ç‚¹è¯´æ˜ï¼š</span><br><span class="line">    DirectoryOrCreate ç›®å½•å­˜åœ¨å°±ä½¿ç”¨ï¼Œä¸å­˜åœ¨å°±å…ˆåˆ›å»ºåä½¿ç”¨</span><br><span class="line">    Directory   ç›®å½•å¿…é¡»å­˜åœ¨</span><br><span class="line">    FileOrCreate  æ–‡ä»¶å­˜åœ¨å°±ä½¿ç”¨ï¼Œä¸å­˜åœ¨å°±å…ˆåˆ›å»ºåä½¿ç”¨</span><br><span class="line">    File æ–‡ä»¶å¿…é¡»å­˜åœ¨ </span><br><span class="line">    Socket  unixå¥—æ¥å­—å¿…é¡»å­˜åœ¨</span><br><span class="line">    CharDevice  å­—ç¬¦è®¾å¤‡å¿…é¡»å­˜åœ¨</span><br><span class="line">    BlockDevice å—è®¾å¤‡å¿…é¡»å­˜åœ¨</span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åˆ›å»ºPod</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl create -f volume-hostpath.yaml</span><br><span class="line">pod/volume-hostpath created</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹Pod</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl get pods volume-hostpath -n dev -o wide</span><br><span class="line">NAME                  READY   STATUS    RESTARTS   AGE   IP             NODE   ......</span><br><span class="line">pod-volume-hostpath   2/2     Running   0          16s   10.42.2.10     node1  ......</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">è®¿é—®nginx</span></span><br><span class="line">[root@k8s-master01 ~]# curl 10.42.2.10</span><br><span class="line"></span><br><span class="line">[root@k8s-master01 ~]# kubectl logs -f volume-emptydir -n dev -c busybox</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ¥ä¸‹æ¥å°±å¯ä»¥å»hostçš„/root/logsç›®å½•ä¸‹æŸ¥çœ‹å­˜å‚¨çš„æ–‡ä»¶äº†</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">##  æ³¨æ„: ä¸‹é¢çš„æ“ä½œéœ€è¦åˆ°Podæ‰€åœ¨çš„èŠ‚ç‚¹è¿è¡Œï¼ˆæ¡ˆä¾‹ä¸­æ˜¯node1ï¼‰</span></span></span><br><span class="line">[root@node1 ~]# ls /root/logs/</span><br><span class="line">access.log  error.log</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> åŒæ ·çš„é“ç†ï¼Œå¦‚æœåœ¨æ­¤ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œåˆ°å®¹å™¨ä¸­ä¹Ÿæ˜¯å¯ä»¥çœ‹åˆ°çš„</span></span><br></pre></td></tr></table></figure></div>

<h5 id="8-1-3-NFS"><a href="#8-1-3-NFS" class="headerlink" title="8.1.3 NFS"></a>8.1.3 NFS</h5><p>HostPathå¯ä»¥è§£å†³æ•°æ®æŒä¹…åŒ–çš„é—®é¢˜ï¼Œä½†æ˜¯ä¸€æ—¦NodeèŠ‚ç‚¹æ•…éšœäº†ï¼ŒPodå¦‚æœè½¬ç§»åˆ°äº†åˆ«çš„èŠ‚ç‚¹ï¼Œåˆä¼šå‡ºç°é—®é¢˜äº†ï¼Œæ­¤æ—¶éœ€è¦å‡†å¤‡å•ç‹¬çš„ç½‘ç»œå­˜å‚¨ç³»ç»Ÿï¼Œæ¯”è¾ƒå¸¸ç”¨çš„ç”¨NFSã€CIFSã€‚</p>
<p>NFSæ˜¯ä¸€ä¸ªç½‘ç»œæ–‡ä»¶å­˜å‚¨ç³»ç»Ÿï¼Œå¯ä»¥æ­å»ºä¸€å°NFSæœåŠ¡å™¨ï¼Œç„¶åå°†Podä¸­çš„å­˜å‚¨ç›´æ¥è¿æ¥åˆ°NFSç³»ç»Ÿä¸Šï¼Œè¿™æ ·çš„è¯ï¼Œæ— è®ºPodåœ¨èŠ‚ç‚¹ä¸Šæ€ä¹ˆè½¬ç§»ï¼Œåªè¦Nodeè·ŸNFSçš„å¯¹æ¥æ²¡é—®é¢˜ï¼Œæ•°æ®å°±å¯ä»¥æˆåŠŸè®¿é—®ã€‚</p>
<p><img src="/2022/06/09/uncatalog/cl46zbay9000k7or71j4vcb8a/image-20200413215133559.png" alt="img"></p>
<p>1ï¼‰é¦–å…ˆè¦å‡†å¤‡nfsçš„æœåŠ¡å™¨ï¼Œè¿™é‡Œä¸ºäº†ç®€å•ï¼Œç›´æ¥æ˜¯masterèŠ‚ç‚¹åšnfsæœåŠ¡å™¨</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åœ¨nfsä¸Šå®‰è£…nfsæœåŠ¡</span></span><br><span class="line">[root@nfs ~]# yum install nfs-utils -y</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å‡†å¤‡ä¸€ä¸ªå…±äº«ç›®å½•</span></span><br><span class="line">[root@nfs ~]# mkdir /root/data/nfs -pv</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å°†å…±äº«ç›®å½•ä»¥è¯»å†™æƒé™æš´éœ²ç»™192.168.5.0/24ç½‘æ®µä¸­çš„æ‰€æœ‰ä¸»æœº</span></span><br><span class="line">[root@nfs ~]# vim /etc/exports</span><br><span class="line">[root@nfs ~]# more /etc/exports</span><br><span class="line">/root/data/nfs     192.168.5.0/24(rw,no_root_squash)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¯åŠ¨nfsæœåŠ¡</span></span><br><span class="line">[root@nfs ~]# systemctl restart nfs</span><br></pre></td></tr></table></figure></div>

<p>2ï¼‰æ¥ä¸‹æ¥ï¼Œè¦åœ¨çš„æ¯ä¸ªnodeèŠ‚ç‚¹ä¸Šéƒ½å®‰è£…ä¸‹nfsï¼Œè¿™æ ·çš„ç›®çš„æ˜¯ä¸ºäº†nodeèŠ‚ç‚¹å¯ä»¥é©±åŠ¨nfsè®¾å¤‡</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åœ¨nodeä¸Šå®‰è£…nfsæœåŠ¡ï¼Œæ³¨æ„ä¸éœ€è¦å¯åŠ¨</span></span><br><span class="line">[root@k8s-master01 ~]# yum install nfs-utils -y</span><br></pre></td></tr></table></figure></div>

<p>3ï¼‰æ¥ä¸‹æ¥ï¼Œå°±å¯ä»¥ç¼–å†™podçš„é…ç½®æ–‡ä»¶äº†ï¼Œåˆ›å»ºvolume-nfs.yaml</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">volume-nfs</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:1.17.1</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">volumeMounts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">logs-volume</span></span><br><span class="line">      <span class="attr">mountPath:</span> <span class="string">/var/log/nginx</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">busybox:1.30</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;/bin/sh&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;tail -f /logs/access.log&quot;</span>] </span><br><span class="line">    <span class="attr">volumeMounts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">logs-volume</span></span><br><span class="line">      <span class="attr">mountPath:</span> <span class="string">/logs</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">logs-volume</span></span><br><span class="line">    <span class="attr">nfs:</span></span><br><span class="line">      <span class="attr">server:</span> <span class="number">192.168</span><span class="number">.5</span><span class="number">.6</span>  <span class="comment">#nfsæœåŠ¡å™¨åœ°å€</span></span><br><span class="line">      <span class="attr">path:</span> <span class="string">/root/data/nfs</span> <span class="comment">#å…±äº«æ–‡ä»¶è·¯å¾„</span></span><br></pre></td></tr></table></figure></div>

<p>4ï¼‰æœ€åï¼Œè¿è¡Œä¸‹podï¼Œè§‚å¯Ÿç»“æœ</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åˆ›å»ºpod</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl create -f volume-nfs.yaml</span><br><span class="line">pod/volume-nfs created</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹pod</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl get pods volume-nfs -n dev</span><br><span class="line">NAME                  READY   STATUS    RESTARTS   AGE</span><br><span class="line">volume-nfs        2/2     Running   0          2m9s</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹nfsæœåŠ¡å™¨ä¸Šçš„å…±äº«ç›®å½•ï¼Œå‘ç°å·²ç»æœ‰æ–‡ä»¶äº†</span></span><br><span class="line">[root@k8s-master01 ~]# ls /root/data/</span><br><span class="line">access.log  error.log</span><br></pre></td></tr></table></figure></div>

<h4 id="8-2-é«˜çº§å­˜å‚¨"><a href="#8-2-é«˜çº§å­˜å‚¨" class="headerlink" title="8.2 é«˜çº§å­˜å‚¨"></a>8.2 é«˜çº§å­˜å‚¨</h4><p>å‰é¢å·²ç»å­¦ä¹ äº†ä½¿ç”¨NFSæä¾›å­˜å‚¨ï¼Œæ­¤æ—¶å°±è¦æ±‚ç”¨æˆ·ä¼šæ­å»ºNFSç³»ç»Ÿï¼Œå¹¶ä¸”ä¼šåœ¨yamlé…ç½®nfsã€‚ç”±äºkubernetesæ”¯æŒçš„å­˜å‚¨ç³»ç»Ÿæœ‰å¾ˆå¤šï¼Œè¦æ±‚å®¢æˆ·å…¨éƒ½æŒæ¡ï¼Œæ˜¾ç„¶ä¸ç°å®ã€‚ä¸ºäº†èƒ½å¤Ÿå±è”½åº•å±‚å­˜å‚¨å®ç°çš„ç»†èŠ‚ï¼Œæ–¹ä¾¿ç”¨æˆ·ä½¿ç”¨ï¼Œ kuberneteså¼•å…¥PVå’ŒPVCä¸¤ç§èµ„æºå¯¹è±¡ã€‚</p>
<ul>
<li><p>PVï¼ˆPersistent Volumeï¼‰æ˜¯æŒä¹…åŒ–å·çš„æ„æ€ï¼Œæ˜¯å¯¹åº•å±‚çš„å…±äº«å­˜å‚¨çš„ä¸€ç§æŠ½è±¡ã€‚ä¸€èˆ¬æƒ…å†µä¸‹PVç”±kubernetesç®¡ç†å‘˜è¿›è¡Œåˆ›å»ºå’Œé…ç½®ï¼Œå®ƒä¸åº•å±‚å…·ä½“çš„å…±äº«å­˜å‚¨æŠ€æœ¯æœ‰å…³ï¼Œå¹¶é€šè¿‡æ’ä»¶å®Œæˆä¸å…±äº«å­˜å‚¨çš„å¯¹æ¥ã€‚</p>
</li>
<li><p>PVCï¼ˆPersistent Volume Claimï¼‰æ˜¯æŒä¹…å·å£°æ˜çš„æ„æ€ï¼Œæ˜¯ç”¨æˆ·å¯¹äºå­˜å‚¨éœ€æ±‚çš„ä¸€ç§å£°æ˜ã€‚æ¢å¥è¯è¯´ï¼ŒPVCå…¶å®å°±æ˜¯ç”¨æˆ·å‘kubernetesç³»ç»Ÿå‘å‡ºçš„ä¸€ç§èµ„æºéœ€æ±‚ç”³è¯·ã€‚</p>
</li>
</ul>
<p><img src="/2022/06/09/uncatalog/cl46zbay9000k7or71j4vcb8a/image-20200514194111567.png" alt="img"></p>
<p>ä½¿ç”¨äº†PVå’ŒPVCä¹‹åï¼Œå·¥ä½œå¯ä»¥å¾—åˆ°è¿›ä¸€æ­¥çš„ç»†åˆ†ï¼š</p>
<ul>
<li>å­˜å‚¨ï¼šå­˜å‚¨å·¥ç¨‹å¸ˆç»´æŠ¤</li>
<li>PVï¼š kubernetesç®¡ç†å‘˜ç»´æŠ¤</li>
<li>PVCï¼škubernetesç”¨æˆ·ç»´æŠ¤</li>
</ul>
<h5 id="8-2-1-PV"><a href="#8-2-1-PV" class="headerlink" title="8.2.1 PV"></a>8.2.1 PV</h5><p>PVæ˜¯å­˜å‚¨èµ„æºçš„æŠ½è±¡ï¼Œä¸‹é¢æ˜¯èµ„æºæ¸…å•æ–‡ä»¶:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span>  </span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolume</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pv2</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">nfs:</span> <span class="comment"># å­˜å‚¨ç±»å‹ï¼Œä¸åº•å±‚çœŸæ­£å­˜å‚¨å¯¹åº”</span></span><br><span class="line">  <span class="attr">capacity:</span>  <span class="comment"># å­˜å‚¨èƒ½åŠ›ï¼Œç›®å‰åªæ”¯æŒå­˜å‚¨ç©ºé—´çš„è®¾ç½®</span></span><br><span class="line">    <span class="attr">storage:</span> <span class="string">2Gi</span></span><br><span class="line">  <span class="attr">accessModes:</span>  <span class="comment"># è®¿é—®æ¨¡å¼</span></span><br><span class="line">  <span class="attr">storageClassName:</span> <span class="comment"># å­˜å‚¨ç±»åˆ«</span></span><br><span class="line">  <span class="attr">persistentVolumeReclaimPolicy:</span> <span class="comment"># å›æ”¶ç­–ç•¥</span></span><br></pre></td></tr></table></figure></div>

<p>PV çš„å…³é”®é…ç½®å‚æ•°è¯´æ˜ï¼š</p>
<ul>
<li><p><strong>å­˜å‚¨ç±»å‹</strong></p>
<p>åº•å±‚å®é™…å­˜å‚¨çš„ç±»å‹ï¼Œkubernetesæ”¯æŒå¤šç§å­˜å‚¨ç±»å‹ï¼Œæ¯ç§å­˜å‚¨ç±»å‹çš„é…ç½®éƒ½æœ‰æ‰€å·®å¼‚</p>
</li>
<li><p><strong>å­˜å‚¨èƒ½åŠ›ï¼ˆcapacityï¼‰</strong></p>
</li>
</ul>
<p>ç›®å‰åªæ”¯æŒå­˜å‚¨ç©ºé—´çš„è®¾ç½®( storage=1Gi )ï¼Œä¸è¿‡æœªæ¥å¯èƒ½ä¼šåŠ å…¥IOPSã€ååé‡ç­‰æŒ‡æ ‡çš„é…ç½®</p>
<ul>
<li><p><strong>è®¿é—®æ¨¡å¼ï¼ˆaccessModesï¼‰</strong></p>
<p>ç”¨äºæè¿°ç”¨æˆ·åº”ç”¨å¯¹å­˜å‚¨èµ„æºçš„è®¿é—®æƒé™ï¼Œè®¿é—®æƒé™åŒ…æ‹¬ä¸‹é¢å‡ ç§æ–¹å¼ï¼š</p>
<ul>
<li>ReadWriteOnceï¼ˆRWOï¼‰ï¼šè¯»å†™æƒé™ï¼Œä½†æ˜¯åªèƒ½è¢«å•ä¸ªèŠ‚ç‚¹æŒ‚è½½</li>
<li>ReadOnlyManyï¼ˆROXï¼‰ï¼š åªè¯»æƒé™ï¼Œå¯ä»¥è¢«å¤šä¸ªèŠ‚ç‚¹æŒ‚è½½</li>
<li>ReadWriteManyï¼ˆRWXï¼‰ï¼šè¯»å†™æƒé™ï¼Œå¯ä»¥è¢«å¤šä¸ªèŠ‚ç‚¹æŒ‚è½½</li>
</ul>
<p><code>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåº•å±‚ä¸åŒçš„å­˜å‚¨ç±»å‹å¯èƒ½æ”¯æŒçš„è®¿é—®æ¨¡å¼ä¸åŒ</code></p>
</li>
<li><p><strong>å›æ”¶ç­–ç•¥ï¼ˆpersistentVolumeReclaimPolicyï¼‰</strong></p>
<p>å½“PVä¸å†è¢«ä½¿ç”¨äº†ä¹‹åï¼Œå¯¹å…¶çš„å¤„ç†æ–¹å¼ã€‚ç›®å‰æ”¯æŒä¸‰ç§ç­–ç•¥ï¼š</p>
<ul>
<li>Retain ï¼ˆä¿ç•™ï¼‰ ä¿ç•™æ•°æ®ï¼Œéœ€è¦ç®¡ç†å‘˜æ‰‹å·¥æ¸…ç†æ•°æ®</li>
<li>Recycleï¼ˆå›æ”¶ï¼‰ æ¸…é™¤ PV ä¸­çš„æ•°æ®ï¼Œæ•ˆæœç›¸å½“äºæ‰§è¡Œ rm -rf /thevolume/*</li>
<li>Delete ï¼ˆåˆ é™¤ï¼‰ ä¸ PV ç›¸è¿çš„åç«¯å­˜å‚¨å®Œæˆ volume çš„åˆ é™¤æ“ä½œï¼Œå½“ç„¶è¿™å¸¸è§äºäº‘æœåŠ¡å•†çš„å­˜å‚¨æœåŠ¡</li>
</ul>
<p><code>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåº•å±‚ä¸åŒçš„å­˜å‚¨ç±»å‹å¯èƒ½æ”¯æŒçš„å›æ”¶ç­–ç•¥ä¸åŒ</code></p>
</li>
<li><p><strong>å­˜å‚¨ç±»åˆ«</strong></p>
<p>PVå¯ä»¥é€šè¿‡storageClassNameå‚æ•°æŒ‡å®šä¸€ä¸ªå­˜å‚¨ç±»åˆ«</p>
<ul>
<li>å…·æœ‰ç‰¹å®šç±»åˆ«çš„PVåªèƒ½ä¸è¯·æ±‚äº†è¯¥ç±»åˆ«çš„PVCè¿›è¡Œç»‘å®š</li>
<li>æœªè®¾å®šç±»åˆ«çš„PVåˆ™åªèƒ½ä¸ä¸è¯·æ±‚ä»»ä½•ç±»åˆ«çš„PVCè¿›è¡Œç»‘å®š</li>
</ul>
</li>
<li><p><strong>çŠ¶æ€ï¼ˆstatusï¼‰</strong></p>
<p>ä¸€ä¸ª PV çš„ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œå¯èƒ½ä¼šå¤„äº4ä¸­ä¸åŒçš„é˜¶æ®µï¼š</p>
<ul>
<li>Availableï¼ˆå¯ç”¨ï¼‰ï¼š è¡¨ç¤ºå¯ç”¨çŠ¶æ€ï¼Œè¿˜æœªè¢«ä»»ä½• PVC ç»‘å®š</li>
<li>Boundï¼ˆå·²ç»‘å®šï¼‰ï¼š è¡¨ç¤º PV å·²ç»è¢« PVC ç»‘å®š</li>
<li>Releasedï¼ˆå·²é‡Šæ”¾ï¼‰ï¼š è¡¨ç¤º PVC è¢«åˆ é™¤ï¼Œä½†æ˜¯èµ„æºè¿˜æœªè¢«é›†ç¾¤é‡æ–°å£°æ˜</li>
<li>Failedï¼ˆå¤±è´¥ï¼‰ï¼š è¡¨ç¤ºè¯¥ PV çš„è‡ªåŠ¨å›æ”¶å¤±è´¥</li>
</ul>
</li>
</ul>
<p><strong>å®éªŒ</strong></p>
<p>ä½¿ç”¨NFSä½œä¸ºå­˜å‚¨ï¼Œæ¥æ¼”ç¤ºPVçš„ä½¿ç”¨ï¼Œåˆ›å»º3ä¸ªPVï¼Œå¯¹åº”NFSä¸­çš„3ä¸ªæš´éœ²çš„è·¯å¾„ã€‚</p>
<ol>
<li>å‡†å¤‡NFSç¯å¢ƒ</li>
</ol>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åˆ›å»ºç›®å½•</span></span><br><span class="line">[root@nfs ~]# mkdir /root/data/&#123;pv1,pv2,pv3&#125; -pv</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æš´éœ²æœåŠ¡</span></span><br><span class="line">[root@nfs ~]# more /etc/exports</span><br><span class="line">/root/data/pv1     192.168.5.0/24(rw,no_root_squash)</span><br><span class="line">/root/data/pv2     192.168.5.0/24(rw,no_root_squash)</span><br><span class="line">/root/data/pv3     192.168.5.0/24(rw,no_root_squash)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> é‡å¯æœåŠ¡</span></span><br><span class="line">[root@nfs ~]#  systemctl restart nfs</span><br></pre></td></tr></table></figure></div>

<ol start="2">
<li>åˆ›å»ºpv.yaml</li>
</ol>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolume</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span>  <span class="string">pv1</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">capacity:</span> </span><br><span class="line">    <span class="attr">storage:</span> <span class="string">1Gi</span></span><br><span class="line">  <span class="attr">accessModes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">ReadWriteMany</span></span><br><span class="line">  <span class="attr">persistentVolumeReclaimPolicy:</span> <span class="string">Retain</span></span><br><span class="line">  <span class="attr">nfs:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/root/data/pv1</span></span><br><span class="line">    <span class="attr">server:</span> <span class="number">192.168</span><span class="number">.5</span><span class="number">.6</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolume</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span>  <span class="string">pv2</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">capacity:</span> </span><br><span class="line">    <span class="attr">storage:</span> <span class="string">2Gi</span></span><br><span class="line">  <span class="attr">accessModes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">ReadWriteMany</span></span><br><span class="line">  <span class="attr">persistentVolumeReclaimPolicy:</span> <span class="string">Retain</span></span><br><span class="line">  <span class="attr">nfs:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/root/data/pv2</span></span><br><span class="line">    <span class="attr">server:</span> <span class="number">192.168</span><span class="number">.5</span><span class="number">.6</span></span><br><span class="line">    </span><br><span class="line"><span class="meta">---</span></span><br><span class="line"></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolume</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span>  <span class="string">pv3</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">capacity:</span> </span><br><span class="line">    <span class="attr">storage:</span> <span class="string">3Gi</span></span><br><span class="line">  <span class="attr">accessModes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">ReadWriteMany</span></span><br><span class="line">  <span class="attr">persistentVolumeReclaimPolicy:</span> <span class="string">Retain</span></span><br><span class="line">  <span class="attr">nfs:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">/root/data/pv3</span></span><br><span class="line">    <span class="attr">server:</span> <span class="number">192.168</span><span class="number">.5</span><span class="number">.6</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åˆ›å»º pv</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl create -f pv.yaml</span><br><span class="line">persistentvolume/pv1 created</span><br><span class="line">persistentvolume/pv2 created</span><br><span class="line">persistentvolume/pv3 created</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹pv</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl get pv -o wide</span><br><span class="line">NAME   CAPACITY   ACCESS MODES  RECLAIM POLICY  STATUS      AGE   VOLUMEMODE</span><br><span class="line">pv1    1Gi        RWX            Retain        Available    10s   Filesystem</span><br><span class="line">pv2    2Gi        RWX            Retain        Available    10s   Filesystem</span><br><span class="line">pv3    3Gi        RWX            Retain        Available    9s    Filesystem</span><br></pre></td></tr></table></figure></div>

<h5 id="8-2-2-PVC"><a href="#8-2-2-PVC" class="headerlink" title="8.2.2 PVC"></a>8.2.2 PVC</h5><p>PVCæ˜¯èµ„æºçš„ç”³è¯·ï¼Œç”¨æ¥å£°æ˜å¯¹å­˜å‚¨ç©ºé—´ã€è®¿é—®æ¨¡å¼ã€å­˜å‚¨ç±»åˆ«éœ€æ±‚ä¿¡æ¯ã€‚ä¸‹é¢æ˜¯èµ„æºæ¸…å•æ–‡ä»¶:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolumeClaim</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pvc</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">accessModes:</span> <span class="comment"># è®¿é—®æ¨¡å¼</span></span><br><span class="line">  <span class="attr">selector:</span> <span class="comment"># é‡‡ç”¨æ ‡ç­¾å¯¹PVé€‰æ‹©</span></span><br><span class="line">  <span class="attr">storageClassName:</span> <span class="comment"># å­˜å‚¨ç±»åˆ«</span></span><br><span class="line">  <span class="attr">resources:</span> <span class="comment"># è¯·æ±‚ç©ºé—´</span></span><br><span class="line">    <span class="attr">requests:</span></span><br><span class="line">      <span class="attr">storage:</span> <span class="string">5Gi</span></span><br></pre></td></tr></table></figure></div>

<p>PVC çš„å…³é”®é…ç½®å‚æ•°è¯´æ˜ï¼š</p>
<ul>
<li><strong>è®¿é—®æ¨¡å¼ï¼ˆaccessModesï¼‰</strong></li>
</ul>
<p>ç”¨äºæè¿°ç”¨æˆ·åº”ç”¨å¯¹å­˜å‚¨èµ„æºçš„è®¿é—®æƒé™</p>
<ul>
<li><p><strong>é€‰æ‹©æ¡ä»¶ï¼ˆselectorï¼‰</strong></p>
<p>é€šè¿‡Label Selectorçš„è®¾ç½®ï¼Œå¯ä½¿PVCå¯¹äºç³»ç»Ÿä¸­å·±å­˜åœ¨çš„PVè¿›è¡Œç­›é€‰</p>
</li>
<li><p><strong>å­˜å‚¨ç±»åˆ«ï¼ˆstorageClassNameï¼‰</strong></p>
<p>PVCåœ¨å®šä¹‰æ—¶å¯ä»¥è®¾å®šéœ€è¦çš„åç«¯å­˜å‚¨çš„ç±»åˆ«ï¼Œåªæœ‰è®¾ç½®äº†è¯¥classçš„pvæ‰èƒ½è¢«ç³»ç»Ÿé€‰å‡º</p>
</li>
<li><p><strong>èµ„æºè¯·æ±‚ï¼ˆResources ï¼‰</strong></p>
<p>æè¿°å¯¹å­˜å‚¨èµ„æºçš„è¯·æ±‚</p>
</li>
</ul>
<p><strong>å®éªŒ</strong></p>
<ol>
<li>åˆ›å»ºpvc.yamlï¼Œç”³è¯·pv</li>
</ol>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolumeClaim</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pvc1</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">accessModes:</span> </span><br><span class="line">  <span class="bullet">-</span> <span class="string">ReadWriteMany</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">    <span class="attr">requests:</span></span><br><span class="line">      <span class="attr">storage:</span> <span class="string">1Gi</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolumeClaim</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pvc2</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">accessModes:</span> </span><br><span class="line">  <span class="bullet">-</span> <span class="string">ReadWriteMany</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">    <span class="attr">requests:</span></span><br><span class="line">      <span class="attr">storage:</span> <span class="string">1Gi</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolumeClaim</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pvc3</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">accessModes:</span> </span><br><span class="line">  <span class="bullet">-</span> <span class="string">ReadWriteMany</span></span><br><span class="line">  <span class="attr">resources:</span></span><br><span class="line">    <span class="attr">requests:</span></span><br><span class="line">      <span class="attr">storage:</span> <span class="string">1Gi</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åˆ›å»ºpvc</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl create -f pvc.yaml</span><br><span class="line">persistentvolumeclaim/pvc1 created</span><br><span class="line">persistentvolumeclaim/pvc2 created</span><br><span class="line">persistentvolumeclaim/pvc3 created</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹pvc</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl get pvc  -n dev -o wide</span><br><span class="line">NAME   STATUS   VOLUME   CAPACITY   ACCESS MODES   STORAGECLASS   AGE   VOLUMEMODE</span><br><span class="line">pvc1   Bound    pv1      1Gi        RWX                           15s   Filesystem</span><br><span class="line">pvc2   Bound    pv2      2Gi        RWX                           15s   Filesystem</span><br><span class="line">pvc3   Bound    pv3      3Gi        RWX                           15s   Filesystem</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹pv</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl get pv -o wide</span><br><span class="line">NAME  CAPACITY ACCESS MODES  RECLAIM POLICY  STATUS    CLAIM       AGE     VOLUMEMODE</span><br><span class="line">pv1    1Gi        RWx        Retain          Bound    dev/pvc1    3h37m    Filesystem</span><br><span class="line">pv2    2Gi        RWX        Retain          Bound    dev/pvc2    3h37m    Filesystem</span><br><span class="line">pv3    3Gi        RWX        Retain          Bound    dev/pvc3    3h37m    Filesystem   </span><br></pre></td></tr></table></figure></div>

<ol start="2">
<li>åˆ›å»ºpods.yaml, ä½¿ç”¨pv</li>
</ol>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pod1</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">busybox:1.30</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;/bin/sh&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;while true;do echo pod1 &gt;&gt; /root/out.txt; sleep 10; done;&quot;</span>]</span><br><span class="line">    <span class="attr">volumeMounts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">volume</span></span><br><span class="line">      <span class="attr">mountPath:</span> <span class="string">/root/</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">volume</span></span><br><span class="line">      <span class="attr">persistentVolumeClaim:</span></span><br><span class="line">        <span class="attr">claimName:</span> <span class="string">pvc1</span></span><br><span class="line">        <span class="attr">readOnly:</span> <span class="literal">false</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pod2</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">busybox:1.30</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;/bin/sh&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;while true;do echo pod2 &gt;&gt; /root/out.txt; sleep 10; done;&quot;</span>]</span><br><span class="line">    <span class="attr">volumeMounts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">volume</span></span><br><span class="line">      <span class="attr">mountPath:</span> <span class="string">/root/</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">volume</span></span><br><span class="line">      <span class="attr">persistentVolumeClaim:</span></span><br><span class="line">        <span class="attr">claimName:</span> <span class="string">pvc2</span></span><br><span class="line">        <span class="attr">readOnly:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åˆ›å»ºpod</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl create -f pods.yaml</span><br><span class="line">pod/pod1 created</span><br><span class="line">pod/pod2 created</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹pod</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl get pods -n dev -o wide</span><br><span class="line">NAME   READY   STATUS    RESTARTS   AGE   IP            NODE   </span><br><span class="line">pod1   1/1     Running   0          14s   10.244.1.69   node1   </span><br><span class="line">pod2   1/1     Running   0          14s   10.244.1.70   node1  </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹pvc</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl get pvc -n dev -o wide</span><br><span class="line">NAME   STATUS   VOLUME   CAPACITY   ACCESS MODES      AGE   VOLUMEMODE</span><br><span class="line">pvc1   Bound    pv1      1Gi        RWX               94m   Filesystem</span><br><span class="line">pvc2   Bound    pv2      2Gi        RWX               94m   Filesystem</span><br><span class="line">pvc3   Bound    pv3      3Gi        RWX               94m   Filesystem</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹pv</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl get pv -n dev -o wide</span><br><span class="line">NAME   CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM       AGE     VOLUMEMODE</span><br><span class="line">pv1    1Gi        RWX            Retain           Bound    dev/pvc1    5h11m   Filesystem</span><br><span class="line">pv2    2Gi        RWX            Retain           Bound    dev/pvc2    5h11m   Filesystem</span><br><span class="line">pv3    3Gi        RWX            Retain           Bound    dev/pvc3    5h11m   Filesystem</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹nfsä¸­çš„æ–‡ä»¶å­˜å‚¨</span></span><br><span class="line">[root@nfs ~]# more /root/data/pv1/out.txt</span><br><span class="line">node1</span><br><span class="line">node1</span><br><span class="line">[root@nfs ~]# more /root/data/pv2/out.txt</span><br><span class="line">node2</span><br><span class="line">node2</span><br></pre></td></tr></table></figure></div>

<h5 id="8-2-3-ç”Ÿå‘½å‘¨æœŸ"><a href="#8-2-3-ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="8.2.3 ç”Ÿå‘½å‘¨æœŸ"></a>8.2.3 ç”Ÿå‘½å‘¨æœŸ</h5><p>PVCå’ŒPVæ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼ŒPVå’ŒPVCä¹‹é—´çš„ç›¸äº’ä½œç”¨éµå¾ªä»¥ä¸‹ç”Ÿå‘½å‘¨æœŸï¼š</p>
<ul>
<li><p><strong>èµ„æºä¾›åº”</strong>ï¼šç®¡ç†å‘˜æ‰‹åŠ¨åˆ›å»ºåº•å±‚å­˜å‚¨å’ŒPV</p>
</li>
<li><p><strong>èµ„æºç»‘å®š</strong>ï¼šç”¨æˆ·åˆ›å»ºPVCï¼Œkubernetesè´Ÿè´£æ ¹æ®PVCçš„å£°æ˜å»å¯»æ‰¾PVï¼Œå¹¶ç»‘å®š</p>
<p>åœ¨ç”¨æˆ·å®šä¹‰å¥½PVCä¹‹åï¼Œç³»ç»Ÿå°†æ ¹æ®PVCå¯¹å­˜å‚¨èµ„æºçš„è¯·æ±‚åœ¨å·²å­˜åœ¨çš„PVä¸­é€‰æ‹©ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„</p>
<ul>
<li>ä¸€æ—¦æ‰¾åˆ°ï¼Œå°±å°†è¯¥PVä¸ç”¨æˆ·å®šä¹‰çš„PVCè¿›è¡Œç»‘å®šï¼Œç”¨æˆ·çš„åº”ç”¨å°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªPVCäº†</li>
<li>å¦‚æœæ‰¾ä¸åˆ°ï¼ŒPVCåˆ™ä¼šæ— é™æœŸå¤„äºPendingçŠ¶æ€ï¼Œç›´åˆ°ç­‰åˆ°ç³»ç»Ÿç®¡ç†å‘˜åˆ›å»ºäº†ä¸€ä¸ªç¬¦åˆå…¶è¦æ±‚çš„PV</li>
</ul>
<p>PVä¸€æ—¦ç»‘å®šåˆ°æŸä¸ªPVCä¸Šï¼Œå°±ä¼šè¢«è¿™ä¸ªPVCç‹¬å ï¼Œä¸èƒ½å†ä¸å…¶ä»–PVCè¿›è¡Œç»‘å®šäº†</p>
</li>
<li><p><strong>èµ„æºä½¿ç”¨</strong>ï¼šç”¨æˆ·å¯åœ¨podä¸­åƒvolumeä¸€æ ·ä½¿ç”¨pvc</p>
<p>Podä½¿ç”¨Volumeçš„å®šä¹‰ï¼Œå°†PVCæŒ‚è½½åˆ°å®¹å™¨å†…çš„æŸä¸ªè·¯å¾„è¿›è¡Œä½¿ç”¨ã€‚</p>
</li>
<li><p><strong>èµ„æºé‡Šæ”¾</strong>ï¼šç”¨æˆ·åˆ é™¤pvcæ¥é‡Šæ”¾pv</p>
<p>å½“å­˜å‚¨èµ„æºä½¿ç”¨å®Œæ¯•åï¼Œç”¨æˆ·å¯ä»¥åˆ é™¤PVCï¼Œä¸è¯¥PVCç»‘å®šçš„PVå°†ä¼šè¢«æ ‡è®°ä¸ºâ€œå·²é‡Šæ”¾â€ï¼Œä½†è¿˜ä¸èƒ½ç«‹åˆ»ä¸å…¶ä»–PVCè¿›è¡Œç»‘å®šã€‚é€šè¿‡ä¹‹å‰PVCå†™å…¥çš„æ•°æ®å¯èƒ½è¿˜è¢«ç•™åœ¨å­˜å‚¨è®¾å¤‡ä¸Šï¼Œåªæœ‰åœ¨æ¸…é™¤ä¹‹åè¯¥PVæ‰èƒ½å†æ¬¡ä½¿ç”¨ã€‚</p>
</li>
<li><p><strong>èµ„æºå›æ”¶</strong>ï¼škubernetesæ ¹æ®pvè®¾ç½®çš„å›æ”¶ç­–ç•¥è¿›è¡Œèµ„æºçš„å›æ”¶</p>
<p>å¯¹äºPVï¼Œç®¡ç†å‘˜å¯ä»¥è®¾å®šå›æ”¶ç­–ç•¥ï¼Œç”¨äºè®¾ç½®ä¸ä¹‹ç»‘å®šçš„PVCé‡Šæ”¾èµ„æºä¹‹åå¦‚ä½•å¤„ç†é—ç•™æ•°æ®çš„é—®é¢˜ã€‚åªæœ‰PVçš„å­˜å‚¨ç©ºé—´å®Œæˆå›æ”¶ï¼Œæ‰èƒ½ä¾›æ–°çš„PVCç»‘å®šå’Œä½¿ç”¨</p>
</li>
</ul>
<p><img src="/2022/06/09/uncatalog/cl46zbay9000k7or71j4vcb8a/image-20200515002806726.png" alt="img"></p>
<h4 id="8-3-é…ç½®å­˜å‚¨"><a href="#8-3-é…ç½®å­˜å‚¨" class="headerlink" title="8.3 é…ç½®å­˜å‚¨"></a>8.3 é…ç½®å­˜å‚¨</h4><h5 id="8-3-1-ConfigMap"><a href="#8-3-1-ConfigMap" class="headerlink" title="8.3.1 ConfigMap"></a>8.3.1 ConfigMap</h5><p>ConfigMapæ˜¯ä¸€ç§æ¯”è¾ƒç‰¹æ®Šçš„å­˜å‚¨å·ï¼Œå®ƒçš„ä¸»è¦ä½œç”¨æ˜¯ç”¨æ¥å­˜å‚¨é…ç½®ä¿¡æ¯çš„ã€‚</p>
<p>åˆ›å»ºconfigmap.yamlï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">configmap</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">info:</span> <span class="string">|</span></span><br><span class="line">    <span class="string">username:admin</span></span><br><span class="line">    <span class="string">password:123456</span></span><br></pre></td></tr></table></figure></div>

<p>æ¥ä¸‹æ¥ï¼Œä½¿ç”¨æ­¤é…ç½®æ–‡ä»¶åˆ›å»ºconfigmap</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åˆ›å»ºconfigmap</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl create -f configmap.yaml</span><br><span class="line">configmap/configmap created</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹configmapè¯¦æƒ…</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl describe cm configmap -n dev</span><br><span class="line">Name:         configmap</span><br><span class="line">Namespace:    dev</span><br><span class="line">Labels:       &lt;none&gt;</span><br><span class="line">Annotations:  &lt;none&gt;</span><br><span class="line"></span><br><span class="line">Data</span><br><span class="line">====</span><br><span class="line">info:</span><br><span class="line">----</span><br><span class="line">username:admin</span><br><span class="line">password:123456</span><br><span class="line"></span><br><span class="line">Events:  &lt;none&gt;</span><br></pre></td></tr></table></figure></div>

<p>æ¥ä¸‹æ¥åˆ›å»ºä¸€ä¸ªpod-configmap.yamlï¼Œå°†ä¸Šé¢åˆ›å»ºçš„configmapæŒ‚è½½è¿›å»</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pod-configmap</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:1.17.1</span></span><br><span class="line">    <span class="attr">volumeMounts:</span> <span class="comment"># å°†configmapæŒ‚è½½åˆ°ç›®å½•</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">config</span></span><br><span class="line">      <span class="attr">mountPath:</span> <span class="string">/configmap/config</span></span><br><span class="line">  <span class="attr">volumes:</span> <span class="comment"># å¼•ç”¨configmap</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">config</span></span><br><span class="line">    <span class="attr">configMap:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">configmap</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åˆ›å»ºpod</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl create -f pod-configmap.yaml</span><br><span class="line">pod/pod-configmap created</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹pod</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl get pod pod-configmap -n dev</span><br><span class="line">NAME            READY   STATUS    RESTARTS   AGE</span><br><span class="line">pod-configmap   1/1     Running   0          6s</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">è¿›å…¥å®¹å™¨</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl exec -it pod-configmap -n dev /bin/sh</span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">cd</span> /configmap/config/</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ls</span></span><br><span class="line">info</span><br><span class="line"><span class="meta">#</span><span class="bash"> more info</span></span><br><span class="line">username:admin</span><br><span class="line">password:123456</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¯ä»¥çœ‹åˆ°æ˜ å°„å·²ç»æˆåŠŸï¼Œæ¯ä¸ªconfigmapéƒ½æ˜ å°„æˆäº†ä¸€ä¸ªç›®å½•</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> key---&gt;æ–‡ä»¶     value----&gt;æ–‡ä»¶ä¸­çš„å†…å®¹</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ­¤æ—¶å¦‚æœæ›´æ–°configmapçš„å†…å®¹, å®¹å™¨ä¸­çš„å€¼ä¹Ÿä¼šåŠ¨æ€æ›´æ–°</span></span><br></pre></td></tr></table></figure></div>

<h5 id="8-3-2-Secret"><a href="#8-3-2-Secret" class="headerlink" title="8.3.2 Secret"></a>8.3.2 Secret</h5><p>åœ¨kubernetesä¸­ï¼Œè¿˜å­˜åœ¨ä¸€ç§å’ŒConfigMapéå¸¸ç±»ä¼¼çš„å¯¹è±¡ï¼Œç§°ä¸ºSecretå¯¹è±¡ã€‚å®ƒä¸»è¦ç”¨äºå­˜å‚¨æ•æ„Ÿä¿¡æ¯ï¼Œä¾‹å¦‚å¯†ç ã€ç§˜é’¥ã€è¯ä¹¦ç­‰ç­‰ã€‚</p>
<ol>
<li>é¦–å…ˆä½¿ç”¨base64å¯¹æ•°æ®è¿›è¡Œç¼–ç </li>
</ol>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">[root@k8s-master01 ~]# echo -n &#x27;admin&#x27; | base64 #å‡†å¤‡username</span><br><span class="line">YWRtaW4=</span><br><span class="line">[root@k8s-master01 ~]# echo -n &#x27;123456&#x27; | base64 #å‡†å¤‡password</span><br><span class="line">MTIzNDU2</span><br></pre></td></tr></table></figure></div>

<ol start="2">
<li>æ¥ä¸‹æ¥ç¼–å†™secret.yamlï¼Œå¹¶åˆ›å»ºSecret</li>
</ol>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Secret</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">secret</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">type:</span> <span class="string">Opaque</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">username:</span> <span class="string">YWRtaW4=</span></span><br><span class="line">  <span class="attr">password:</span> <span class="string">MTIzNDU2</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åˆ›å»ºsecret</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl create -f secret.yaml</span><br><span class="line">secret/secret created</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹secretè¯¦æƒ…</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl describe secret secret -n dev</span><br><span class="line">Name:         secret</span><br><span class="line">Namespace:    dev</span><br><span class="line">Labels:       &lt;none&gt;</span><br><span class="line">Annotations:  &lt;none&gt;</span><br><span class="line">Type:  Opaque</span><br><span class="line">Data</span><br><span class="line">====</span><br><span class="line">password:  6 bytes</span><br><span class="line">username:  5 bytes</span><br></pre></td></tr></table></figure></div>

<ol start="3">
<li>åˆ›å»ºpod-secret.yamlï¼Œå°†ä¸Šé¢åˆ›å»ºçš„secretæŒ‚è½½è¿›å»ï¼š</li>
</ol>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pod-secret</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:1.17.1</span></span><br><span class="line">    <span class="attr">volumeMounts:</span> <span class="comment"># å°†secretæŒ‚è½½åˆ°ç›®å½•</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">config</span></span><br><span class="line">      <span class="attr">mountPath:</span> <span class="string">/secret/config</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">config</span></span><br><span class="line">    <span class="attr">secret:</span></span><br><span class="line">      <span class="attr">secretName:</span> <span class="string">secret</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åˆ›å»ºpod</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl create -f pod-secret.yaml</span><br><span class="line">pod/pod-secret created</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹pod</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl get pod pod-secret -n dev</span><br><span class="line">NAME            READY   STATUS    RESTARTS   AGE</span><br><span class="line">pod-secret      1/1     Running   0          2m28s</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> è¿›å…¥å®¹å™¨ï¼ŒæŸ¥çœ‹secretä¿¡æ¯ï¼Œå‘ç°å·²ç»è‡ªåŠ¨è§£ç äº†</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl exec -it pod-secret /bin/sh -n dev</span><br><span class="line">/ # ls /secret/config/</span><br><span class="line">password  username</span><br><span class="line">/ # more /secret/config/username</span><br><span class="line">admin</span><br><span class="line">/ # more /secret/config/password</span><br><span class="line">123456</span><br></pre></td></tr></table></figure></div>

<p>è‡³æ­¤ï¼Œå·²ç»å®ç°äº†åˆ©ç”¨secretå®ç°äº†ä¿¡æ¯çš„ç¼–ç ã€‚</p>
]]></content>
      <tags>
        <tag>äº‘åŸç”ŸåŸºç¡€ç³»åˆ—</tag>
        <tag>Kubernetes</tag>
      </tags>
  </entry>
  <entry>
    <title>äº‘åŸç”ŸåŸºç¡€ç³»åˆ—ä¹‹Kubernetes(å››)å®æˆ˜å…¥é—¨</title>
    <url>/2022/06/09/uncatalog/cl46zbayd000p7or77mughk0e/</url>
    <content><![CDATA[<hr>
<span id="more"></span>



<hr>
<h3 id="4-å®æˆ˜å…¥é—¨"><a href="#4-å®æˆ˜å…¥é—¨" class="headerlink" title="4. å®æˆ˜å…¥é—¨"></a>4. å®æˆ˜å…¥é—¨</h3><p>æœ¬ç« èŠ‚å°†ä»‹ç»å¦‚ä½•åœ¨kubernetesé›†ç¾¤ä¸­éƒ¨ç½²ä¸€ä¸ªnginxæœåŠ¡ï¼Œå¹¶ä¸”èƒ½å¤Ÿå¯¹å…¶è¿›è¡Œè®¿é—®ã€‚</p>
<h4 id="4-1-Namespace"><a href="#4-1-Namespace" class="headerlink" title="4.1 Namespace"></a>4.1 Namespace</h4><p>Namespaceæ˜¯kubernetesç³»ç»Ÿä¸­çš„ä¸€ç§éå¸¸é‡è¦èµ„æºï¼Œå®ƒçš„ä¸»è¦ä½œç”¨æ˜¯ç”¨æ¥å®ç°<strong>å¤šå¥—ç¯å¢ƒçš„èµ„æºéš”ç¦»</strong>æˆ–è€…<strong>å¤šç§Ÿæˆ·çš„èµ„æºéš”ç¦»</strong>ã€‚</p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œkubernetesé›†ç¾¤ä¸­çš„æ‰€æœ‰çš„Podéƒ½æ˜¯å¯ä»¥ç›¸äº’è®¿é—®çš„ã€‚ä½†æ˜¯åœ¨å®é™…ä¸­ï¼Œå¯èƒ½ä¸æƒ³è®©ä¸¤ä¸ªPodä¹‹é—´è¿›è¡Œäº’ç›¸çš„è®¿é—®ï¼Œé‚£æ­¤æ—¶å°±å¯ä»¥å°†ä¸¤ä¸ªPodåˆ’åˆ†åˆ°ä¸åŒçš„namespaceä¸‹ã€‚kubernetesé€šè¿‡å°†é›†ç¾¤å†…éƒ¨çš„èµ„æºåˆ†é…åˆ°ä¸åŒçš„Namespaceä¸­ï¼Œå¯ä»¥å½¢æˆé€»è¾‘ä¸Šçš„â€ç»„â€ï¼Œä»¥æ–¹ä¾¿ä¸åŒçš„ç»„çš„èµ„æºè¿›è¡Œéš”ç¦»ä½¿ç”¨å’Œç®¡ç†ã€‚</p>
<p>å¯ä»¥é€šè¿‡kubernetesçš„æˆæƒæœºåˆ¶ï¼Œå°†ä¸åŒçš„namespaceäº¤ç»™ä¸åŒç§Ÿæˆ·è¿›è¡Œç®¡ç†ï¼Œè¿™æ ·å°±å®ç°äº†å¤šç§Ÿæˆ·çš„èµ„æºéš”ç¦»ã€‚æ­¤æ—¶è¿˜èƒ½ç»“åˆkubernetesçš„èµ„æºé…é¢æœºåˆ¶ï¼Œé™å®šä¸åŒç§Ÿæˆ·èƒ½å ç”¨çš„èµ„æºï¼Œä¾‹å¦‚CPUä½¿ç”¨é‡ã€å†…å­˜ä½¿ç”¨é‡ç­‰ç­‰ï¼Œæ¥å®ç°ç§Ÿæˆ·å¯ç”¨èµ„æºçš„ç®¡ç†ã€‚</p>
<p><img src="/2022/06/09/uncatalog/cl46zbayd000p7or77mughk0e/image-20200407100850484.png" alt="image-20200407100850484"></p>
<p>kubernetesåœ¨é›†ç¾¤å¯åŠ¨ä¹‹åï¼Œä¼šé»˜è®¤åˆ›å»ºå‡ ä¸ªnamespace</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">[root@master ~]# kubectl  get namespace</span><br><span class="line">NAME              STATUS   AGE</span><br><span class="line">default           Active   45h     #  æ‰€æœ‰æœªæŒ‡å®šNamespaceçš„å¯¹è±¡éƒ½ä¼šè¢«åˆ†é…åœ¨defaultå‘½åç©ºé—´</span><br><span class="line">kube-node-lease   Active   45h     #  é›†ç¾¤èŠ‚ç‚¹ä¹‹é—´çš„å¿ƒè·³ç»´æŠ¤ï¼Œv1.13å¼€å§‹å¼•å…¥</span><br><span class="line">kube-public       Active   45h     #  æ­¤å‘½åç©ºé—´ä¸‹çš„èµ„æºå¯ä»¥è¢«æ‰€æœ‰äººè®¿é—®ï¼ˆåŒ…æ‹¬æœªè®¤è¯ç”¨æˆ·ï¼‰</span><br><span class="line">kube-system       Active   45h     #  æ‰€æœ‰ç”±Kubernetesç³»ç»Ÿåˆ›å»ºçš„èµ„æºéƒ½å¤„äºè¿™ä¸ªå‘½åç©ºé—´</span><br></pre></td></tr></table></figure></div>

<p>ä¸‹é¢æ¥çœ‹namespaceèµ„æºçš„å…·ä½“æ“ä½œï¼š</p>
<h5 id="4-1-1-æŸ¥çœ‹"><a href="#4-1-1-æŸ¥çœ‹" class="headerlink" title="4.1.1 æŸ¥çœ‹"></a>4.1.1 <strong>æŸ¥çœ‹</strong></h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1 æŸ¥çœ‹æ‰€æœ‰çš„ns  å‘½ä»¤ï¼škubectl get ns</span></span><br><span class="line">[root@master ~]# kubectl get ns</span><br><span class="line">NAME              STATUS   AGE</span><br><span class="line">default           Active   45h</span><br><span class="line">kube-node-lease   Active   45h</span><br><span class="line">kube-public       Active   45h     </span><br><span class="line">kube-system       Active   45h     </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2 æŸ¥çœ‹æŒ‡å®šçš„ns   å‘½ä»¤ï¼škubectl get ns nsåç§°</span></span><br><span class="line">[root@master ~]# kubectl get ns default</span><br><span class="line">NAME      STATUS   AGE</span><br><span class="line">default   Active   45h</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3 æŒ‡å®šè¾“å‡ºæ ¼å¼  å‘½ä»¤ï¼škubectl get ns nsåç§°  -o æ ¼å¼å‚æ•°</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> kubernetesæ”¯æŒçš„æ ¼å¼æœ‰å¾ˆå¤šï¼Œæ¯”è¾ƒå¸¸è§çš„æ˜¯wideã€jsonã€yaml</span></span><br><span class="line">[root@master ~]# kubectl get ns default -o yaml</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Namespace</span><br><span class="line">metadata:</span><br><span class="line">  creationTimestamp: &quot;2021-05-08T04:44:16Z&quot;</span><br><span class="line">  name: default</span><br><span class="line">  resourceVersion: &quot;151&quot;</span><br><span class="line">  selfLink: /api/v1/namespaces/default</span><br><span class="line">  uid: 7405f73a-e486-43d4-9db6-145f1409f090</span><br><span class="line">spec:</span><br><span class="line">  finalizers:</span><br><span class="line">  - kubernetes</span><br><span class="line">status:</span><br><span class="line">  phase: Active</span><br><span class="line">  </span><br><span class="line"><span class="meta">#</span><span class="bash"> 4 æŸ¥çœ‹nsè¯¦æƒ…  å‘½ä»¤ï¼škubectl describe ns nsåç§°</span></span><br><span class="line">[root@master ~]# kubectl describe ns default</span><br><span class="line">Name:         default</span><br><span class="line">Labels:       &lt;none&gt;</span><br><span class="line">Annotations:  &lt;none&gt;</span><br><span class="line">Status:       Active  # Active å‘½åç©ºé—´æ­£åœ¨ä½¿ç”¨ä¸­  Terminating æ­£åœ¨åˆ é™¤å‘½åç©ºé—´</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ResourceQuota é’ˆå¯¹namespaceåšçš„èµ„æºé™åˆ¶</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> LimitRangeé’ˆå¯¹namespaceä¸­çš„æ¯ä¸ªç»„ä»¶åšçš„èµ„æºé™åˆ¶</span></span><br><span class="line">No resource quota.</span><br><span class="line">No LimitRange resource.</span><br></pre></td></tr></table></figure></div>

<h5 id="4-1-2-åˆ›å»º"><a href="#4-1-2-åˆ›å»º" class="headerlink" title="4.1.2 åˆ›å»º"></a>4.1.2 <strong>åˆ›å»º</strong></h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åˆ›å»ºnamespace</span></span><br><span class="line">[root@master ~]# kubectl create ns dev</span><br><span class="line">namespace/dev created</span><br></pre></td></tr></table></figure></div>

<h5 id="4-1-3-åˆ é™¤"><a href="#4-1-3-åˆ é™¤" class="headerlink" title="4.1.3 åˆ é™¤"></a>4.1.3 <strong>åˆ é™¤</strong></h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åˆ é™¤namespace</span></span><br><span class="line">[root@master ~]# kubectl delete ns dev</span><br><span class="line">namespace &quot;dev&quot; deleted</span><br></pre></td></tr></table></figure></div>

<h5 id="4-1-4-é…ç½®æ–¹å¼"><a href="#4-1-4-é…ç½®æ–¹å¼" class="headerlink" title="4.1.4 é…ç½®æ–¹å¼"></a>4.1.4 <strong>é…ç½®æ–¹å¼</strong></h5><p>é¦–å…ˆå‡†å¤‡ä¸€ä¸ªyamlæ–‡ä»¶ï¼šns-dev.yaml</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Namespace</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">dev</span></span><br></pre></td></tr></table></figure></div>

<p>ç„¶åå°±å¯ä»¥æ‰§è¡Œå¯¹åº”çš„åˆ›å»ºå’Œåˆ é™¤å‘½ä»¤äº†ï¼š</p>
<p>åˆ›å»ºï¼škubectl create -f ns-dev.yaml</p>
<p>åˆ é™¤ï¼škubectl delete -f ns-dev.yaml</p>
<h4 id="4-2-Pod"><a href="#4-2-Pod" class="headerlink" title="4.2 Pod"></a>4.2 Pod</h4><p>Podæ˜¯kubernetesé›†ç¾¤è¿›è¡Œç®¡ç†çš„æœ€å°å•å…ƒï¼Œç¨‹åºè¦è¿è¡Œå¿…é¡»éƒ¨ç½²åœ¨å®¹å™¨ä¸­ï¼Œè€Œå®¹å™¨å¿…é¡»å­˜åœ¨äºPodä¸­ã€‚</p>
<p>Podå¯ä»¥è®¤ä¸ºæ˜¯å®¹å™¨çš„å°è£…ï¼Œä¸€ä¸ªPodä¸­å¯ä»¥å­˜åœ¨ä¸€ä¸ªæˆ–è€…å¤šä¸ªå®¹å™¨ã€‚</p>
<p><img src="/2022/06/09/uncatalog/cl46zbayd000p7or77mughk0e/image-20200407121501907.png" alt="image-20200407121501907"></p>
<p>kubernetesåœ¨é›†ç¾¤å¯åŠ¨ä¹‹åï¼Œé›†ç¾¤ä¸­çš„å„ä¸ªç»„ä»¶ä¹Ÿéƒ½æ˜¯ä»¥Podæ–¹å¼è¿è¡Œçš„ã€‚å¯ä»¥é€šè¿‡ä¸‹é¢å‘½ä»¤æŸ¥çœ‹ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">[root@master ~]# kubectl get pod -n kube-system</span><br><span class="line">NAMESPACE     NAME                             READY   STATUS    RESTARTS   AGE</span><br><span class="line">kube-system   coredns-6955765f44-68g6v         1/1     Running   0          2d1h</span><br><span class="line">kube-system   coredns-6955765f44-cs5r8         1/1     Running   0          2d1h</span><br><span class="line">kube-system   etcd-master                      1/1     Running   0          2d1h</span><br><span class="line">kube-system   kube-apiserver-master            1/1     Running   0          2d1h</span><br><span class="line">kube-system   kube-controller-manager-master   1/1     Running   0          2d1h</span><br><span class="line">kube-system   kube-flannel-ds-amd64-47r25      1/1     Running   0          2d1h</span><br><span class="line">kube-system   kube-flannel-ds-amd64-ls5lh      1/1     Running   0          2d1h</span><br><span class="line">kube-system   kube-proxy-685tk                 1/1     Running   0          2d1h</span><br><span class="line">kube-system   kube-proxy-87spt                 1/1     Running   0          2d1h</span><br><span class="line">kube-system   kube-scheduler-master            1/1     Running   0          2d1h</span><br></pre></td></tr></table></figure></div>

<h5 id="4-2-1-åˆ›å»ºå¹¶è¿è¡Œ"><a href="#4-2-1-åˆ›å»ºå¹¶è¿è¡Œ" class="headerlink" title="4.2.1 åˆ›å»ºå¹¶è¿è¡Œ"></a>4.2.1 åˆ›å»ºå¹¶è¿è¡Œ</h5><p>kubernetesæ²¡æœ‰æä¾›å•ç‹¬è¿è¡ŒPodçš„å‘½ä»¤ï¼Œéƒ½æ˜¯é€šè¿‡Podæ§åˆ¶å™¨æ¥å®ç°çš„</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å‘½ä»¤æ ¼å¼ï¼š kubectl run (podæ§åˆ¶å™¨åç§°) [å‚æ•°]</span> </span><br><span class="line"><span class="meta">#</span><span class="bash"> --image  æŒ‡å®šPodçš„é•œåƒ</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> --port   æŒ‡å®šç«¯å£</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> --namespace  æŒ‡å®šnamespace</span></span><br><span class="line">[root@master ~]# kubectl run nginx --image=nginx:latest --port=80 --namespace dev </span><br><span class="line">deployment.apps/nginx created</span><br></pre></td></tr></table></figure></div>

<h5 id="4-2-2-æŸ¥çœ‹podä¿¡æ¯"><a href="#4-2-2-æŸ¥çœ‹podä¿¡æ¯" class="headerlink" title="4.2.2 æŸ¥çœ‹podä¿¡æ¯"></a>4.2.2 æŸ¥çœ‹podä¿¡æ¯</h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹PodåŸºæœ¬ä¿¡æ¯</span></span><br><span class="line">[root@master ~]# kubectl get pods -n dev</span><br><span class="line">NAME    READY   STATUS    RESTARTS   AGE</span><br><span class="line">nginx   1/1     Running   0          43s</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹Podçš„è¯¦ç»†ä¿¡æ¯</span></span><br><span class="line">[root@master ~]# kubectl describe pod nginx -n dev</span><br><span class="line">Name:         nginx</span><br><span class="line">Namespace:    dev</span><br><span class="line">Priority:     0</span><br><span class="line">Node:         node1/192.168.5.4</span><br><span class="line">Start Time:   Wed, 08 May 2021 09:29:24 +0800</span><br><span class="line">Labels:       pod-template-hash=5ff7956ff6</span><br><span class="line">              run=nginx</span><br><span class="line">Annotations:  &lt;none&gt;</span><br><span class="line">Status:       Running</span><br><span class="line">IP:           10.244.1.23</span><br><span class="line">IPs:</span><br><span class="line">  IP:           10.244.1.23</span><br><span class="line">Controlled By:  ReplicaSet/nginx</span><br><span class="line">Containers:</span><br><span class="line">  nginx:</span><br><span class="line">    Container ID:   docker://4c62b8c0648d2512380f4ffa5da2c99d16e05634979973449c98e9b829f6253c</span><br><span class="line">    Image:          nginx:latest</span><br><span class="line">    Image ID:       docker-pullable://nginx@sha256:485b610fefec7ff6c463ced9623314a04ed67e3945b9c08d7e53a47f6d108dc7</span><br><span class="line">    Port:           80/TCP</span><br><span class="line">    Host Port:      0/TCP</span><br><span class="line">    State:          Running</span><br><span class="line">      Started:      Wed, 08 May 2021 09:30:01 +0800</span><br><span class="line">    Ready:          True</span><br><span class="line">    Restart Count:  0</span><br><span class="line">    Environment:    &lt;none&gt;</span><br><span class="line">    Mounts:</span><br><span class="line">      /var/run/secrets/kubernetes.io/serviceaccount from default-token-hwvvw (ro)</span><br><span class="line">Conditions:</span><br><span class="line">  Type              Status</span><br><span class="line">  Initialized       True</span><br><span class="line">  Ready             True</span><br><span class="line">  ContainersReady   True</span><br><span class="line">  PodScheduled      True</span><br><span class="line">Volumes:</span><br><span class="line">  default-token-hwvvw:</span><br><span class="line">    Type:        Secret (a volume populated by a Secret)</span><br><span class="line">    SecretName:  default-token-hwvvw</span><br><span class="line">    Optional:    false</span><br><span class="line">QoS Class:       BestEffort</span><br><span class="line">Node-Selectors:  &lt;none&gt;</span><br><span class="line">Tolerations:     node.kubernetes.io/not-ready:NoExecute for 300s</span><br><span class="line">                 node.kubernetes.io/unreachable:NoExecute for 300s</span><br><span class="line">Events:</span><br><span class="line">  Type    Reason     Age        From               Message</span><br><span class="line">  ----    ------     ----       ----               -------</span><br><span class="line">  Normal  Scheduled  &lt;unknown&gt;  default-scheduler  Successfully assigned dev/nginx-5ff7956ff6-fg2db to node1</span><br><span class="line">  Normal  Pulling    4m11s      kubelet, node1     Pulling image &quot;nginx:latest&quot;</span><br><span class="line">  Normal  Pulled     3m36s      kubelet, node1     Successfully pulled image &quot;nginx:latest&quot;</span><br><span class="line">  Normal  Created    3m36s      kubelet, node1     Created container nginx</span><br><span class="line">  Normal  Started    3m36s      kubelet, node1     Started container nginx</span><br></pre></td></tr></table></figure></div>

<h5 id="4-2-3-è®¿é—®Pod"><a href="#4-2-3-è®¿é—®Pod" class="headerlink" title="4.2.3 è®¿é—®Pod"></a>4.2.3 è®¿é—®Pod</h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> è·å–podIP</span></span><br><span class="line">[root@master ~]# kubectl get pods -n dev -o wide</span><br><span class="line">NAME    READY   STATUS    RESTARTS   AGE    IP             NODE    ... </span><br><span class="line">nginx   1/1     Running   0          190s   10.244.1.23   node1   ...</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">è®¿é—®POD</span></span><br><span class="line">[root@master ~]# curl http://10.244.1.23:80</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">	&lt;title&gt;Welcome to nginx!&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">	&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></div>

<h5 id="4-2-4-åˆ é™¤æŒ‡å®šPod"><a href="#4-2-4-åˆ é™¤æŒ‡å®šPod" class="headerlink" title="4.2.4 åˆ é™¤æŒ‡å®šPod"></a>4.2.4 åˆ é™¤æŒ‡å®šPod</h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åˆ é™¤æŒ‡å®šPod</span></span><br><span class="line">[root@master ~]# kubectl delete pod nginx -n dev</span><br><span class="line">pod &quot;nginx&quot; deleted</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ­¤æ—¶ï¼Œæ˜¾ç¤ºåˆ é™¤PodæˆåŠŸï¼Œä½†æ˜¯å†æŸ¥è¯¢ï¼Œå‘ç°åˆæ–°äº§ç”Ÿäº†ä¸€ä¸ª</span> </span><br><span class="line">[root@master ~]# kubectl get pods -n dev</span><br><span class="line">NAME    READY   STATUS    RESTARTS   AGE</span><br><span class="line">nginx   1/1     Running   0          21s</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> è¿™æ˜¯å› ä¸ºå½“å‰Podæ˜¯ç”±Podæ§åˆ¶å™¨åˆ›å»ºçš„ï¼Œæ§åˆ¶å™¨ä¼šç›‘æ§PodçŠ¶å†µï¼Œä¸€æ—¦å‘ç°Podæ­»äº¡ï¼Œä¼šç«‹å³é‡å»º</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ­¤æ—¶è¦æƒ³åˆ é™¤Podï¼Œå¿…é¡»åˆ é™¤Podæ§åˆ¶å™¨</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å…ˆæ¥æŸ¥è¯¢ä¸€ä¸‹å½“å‰namespaceä¸‹çš„Podæ§åˆ¶å™¨</span></span><br><span class="line">[root@master ~]# kubectl get deploy -n  dev</span><br><span class="line">NAME    READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">nginx   1/1     1            1           9m7s</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ¥ä¸‹æ¥ï¼Œåˆ é™¤æ­¤PodPodæ§åˆ¶å™¨</span></span><br><span class="line">[root@master ~]# kubectl delete deploy nginx -n dev</span><br><span class="line">deployment.apps &quot;nginx&quot; deleted</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ç¨ç­‰ç‰‡åˆ»ï¼Œå†æŸ¥è¯¢Podï¼Œå‘ç°Podè¢«åˆ é™¤äº†</span></span><br><span class="line">[root@master ~]# kubectl get pods -n dev</span><br><span class="line">No resources found in dev namespace.</span><br></pre></td></tr></table></figure></div>

<h5 id="4-2-5-é…ç½®æ“ä½œ"><a href="#4-2-5-é…ç½®æ“ä½œ" class="headerlink" title="4.2.5 é…ç½®æ“ä½œ"></a>4.2.5 é…ç½®æ“ä½œ</h5><p>åˆ›å»ºä¸€ä¸ªpod-nginx.yamlï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">image:</span> <span class="string">nginx:latest</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">pod</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx-port</span></span><br><span class="line">      <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">      <span class="attr">protocol:</span> <span class="string">TCP</span></span><br></pre></td></tr></table></figure></div>

<p>ç„¶åå°±å¯ä»¥æ‰§è¡Œå¯¹åº”çš„åˆ›å»ºå’Œåˆ é™¤å‘½ä»¤äº†ï¼š</p>
<p>åˆ›å»ºï¼škubectl create -f pod-nginx.yaml</p>
<p>åˆ é™¤ï¼škubectl delete -f pod-nginx.yaml</p>
<h4 id="4-3-Label"><a href="#4-3-Label" class="headerlink" title="4.3 Label"></a>4.3 Label</h4><p>Labelæ˜¯kubernetesç³»ç»Ÿä¸­çš„ä¸€ä¸ªé‡è¦æ¦‚å¿µã€‚å®ƒçš„ä½œç”¨å°±æ˜¯åœ¨èµ„æºä¸Šæ·»åŠ æ ‡è¯†ï¼Œç”¨æ¥å¯¹å®ƒä»¬è¿›è¡ŒåŒºåˆ†å’Œé€‰æ‹©ã€‚</p>
<p>Labelçš„ç‰¹ç‚¹ï¼š</p>
<ul>
<li>ä¸€ä¸ªLabelä¼šä»¥key/valueé”®å€¼å¯¹çš„å½¢å¼é™„åŠ åˆ°å„ç§å¯¹è±¡ä¸Šï¼Œå¦‚Nodeã€Podã€Serviceç­‰ç­‰</li>
<li>ä¸€ä¸ªèµ„æºå¯¹è±¡å¯ä»¥å®šä¹‰ä»»æ„æ•°é‡çš„Label ï¼ŒåŒä¸€ä¸ªLabelä¹Ÿå¯ä»¥è¢«æ·»åŠ åˆ°ä»»æ„æ•°é‡çš„èµ„æºå¯¹è±¡ä¸Šå»</li>
<li>Labelé€šå¸¸åœ¨èµ„æºå¯¹è±¡å®šä¹‰æ—¶ç¡®å®šï¼Œå½“ç„¶ä¹Ÿå¯ä»¥åœ¨å¯¹è±¡åˆ›å»ºååŠ¨æ€æ·»åŠ æˆ–è€…åˆ é™¤</li>
</ul>
<p>å¯ä»¥é€šè¿‡Labelå®ç°èµ„æºçš„å¤šç»´åº¦åˆ†ç»„ï¼Œä»¥ä¾¿çµæ´»ã€æ–¹ä¾¿åœ°è¿›è¡Œèµ„æºåˆ†é…ã€è°ƒåº¦ã€é…ç½®ã€éƒ¨ç½²ç­‰ç®¡ç†å·¥ä½œã€‚</p>
<blockquote>
<p>ä¸€äº›å¸¸ç”¨çš„Label ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<ul>
<li>ç‰ˆæœ¬æ ‡ç­¾ï¼šâ€versionâ€:â€releaseâ€, â€œversionâ€:â€stableâ€â€¦â€¦</li>
<li>ç¯å¢ƒæ ‡ç­¾ï¼šâ€environmentâ€:â€devâ€ï¼Œâ€environmentâ€:â€testâ€ï¼Œâ€environmentâ€:â€proâ€</li>
<li>æ¶æ„æ ‡ç­¾ï¼šâ€tierâ€:â€frontendâ€ï¼Œâ€tierâ€:â€backendâ€</li>
</ul>
</blockquote>
<p>æ ‡ç­¾å®šä¹‰å®Œæ¯•ä¹‹åï¼Œè¿˜è¦è€ƒè™‘åˆ°æ ‡ç­¾çš„é€‰æ‹©ï¼Œè¿™å°±è¦ä½¿ç”¨åˆ°Label Selectorï¼Œå³ï¼š</p>
<p>Labelç”¨äºç»™æŸä¸ªèµ„æºå¯¹è±¡å®šä¹‰æ ‡è¯†</p>
<p>Label Selectorç”¨äºæŸ¥è¯¢å’Œç­›é€‰æ‹¥æœ‰æŸäº›æ ‡ç­¾çš„èµ„æºå¯¹è±¡</p>
<p>å½“å‰æœ‰ä¸¤ç§Label Selectorï¼š</p>
<ul>
<li><p>åŸºäºç­‰å¼çš„Label Selector</p>
<p>name = slave: é€‰æ‹©æ‰€æœ‰åŒ…å«Labelä¸­key=â€nameâ€ä¸”value=â€slaveâ€çš„å¯¹è±¡</p>
<p>env != production: é€‰æ‹©æ‰€æœ‰åŒ…æ‹¬Labelä¸­çš„key=â€envâ€ä¸”valueä¸ç­‰äºâ€productionâ€çš„å¯¹è±¡</p>
</li>
<li><p>åŸºäºé›†åˆçš„Label Selector</p>
<p>name in (master, slave): é€‰æ‹©æ‰€æœ‰åŒ…å«Labelä¸­çš„key=â€nameâ€ä¸”value=â€masterâ€æˆ–â€slaveâ€çš„å¯¹è±¡</p>
<p>name not in (frontend): é€‰æ‹©æ‰€æœ‰åŒ…å«Labelä¸­çš„key=â€nameâ€ä¸”valueä¸ç­‰äºâ€frontendâ€çš„å¯¹è±¡</p>
</li>
</ul>
<p>æ ‡ç­¾çš„é€‰æ‹©æ¡ä»¶å¯ä»¥ä½¿ç”¨å¤šä¸ªï¼Œæ­¤æ—¶å°†å¤šä¸ªLabel Selectorè¿›è¡Œç»„åˆï¼Œä½¿ç”¨é€—å·â€,â€è¿›è¡Œåˆ†éš”å³å¯ã€‚ä¾‹å¦‚ï¼š</p>
<p>name=slaveï¼Œenv!=production</p>
<p>name not in (frontend)ï¼Œenv!=production</p>
<h5 id="4-3-1-å‘½ä»¤æ–¹å¼"><a href="#4-3-1-å‘½ä»¤æ–¹å¼" class="headerlink" title="4.3.1 å‘½ä»¤æ–¹å¼"></a>4.3.1 å‘½ä»¤æ–¹å¼</h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ä¸ºpodèµ„æºæ‰“æ ‡ç­¾</span></span><br><span class="line">[root@master ~]# kubectl label pod nginx-pod version=1.0 -n dev</span><br><span class="line">pod/nginx-pod labeled</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¸ºpodèµ„æºæ›´æ–°æ ‡ç­¾</span></span><br><span class="line">[root@master ~]# kubectl label pod nginx-pod version=2.0 -n dev --overwrite</span><br><span class="line">pod/nginx-pod labeled</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹æ ‡ç­¾</span></span><br><span class="line">[root@master ~]# kubectl get pod nginx-pod  -n dev --show-labels</span><br><span class="line">NAME        READY   STATUS    RESTARTS   AGE   LABELS</span><br><span class="line">nginx-pod   1/1     Running   0          10m   version=2.0</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ç­›é€‰æ ‡ç­¾</span></span><br><span class="line">[root@master ~]# kubectl get pod -n dev -l version=2.0  --show-labels</span><br><span class="line">NAME        READY   STATUS    RESTARTS   AGE   LABELS</span><br><span class="line">nginx-pod   1/1     Running   0          17m   version=2.0</span><br><span class="line">[root@master ~]# kubectl get pod -n dev -l version!=2.0 --show-labels</span><br><span class="line">No resources found in dev namespace.</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">åˆ é™¤æ ‡ç­¾</span></span><br><span class="line">[root@master ~]# kubectl label pod nginx-pod version- -n dev</span><br><span class="line">pod/nginx-pod labeled</span><br></pre></td></tr></table></figure></div>

<h5 id="4-3-2-é…ç½®æ–¹å¼"><a href="#4-3-2-é…ç½®æ–¹å¼" class="headerlink" title="4.3.2 é…ç½®æ–¹å¼"></a>4.3.2 é…ç½®æ–¹å¼</h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">version:</span> <span class="string">&quot;3.0&quot;</span> </span><br><span class="line">    <span class="attr">env:</span> <span class="string">&quot;test&quot;</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">image:</span> <span class="string">nginx:latest</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">pod</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx-port</span></span><br><span class="line">      <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">      <span class="attr">protocol:</span> <span class="string">TCP</span></span><br></pre></td></tr></table></figure></div>

<p>ç„¶åå°±å¯ä»¥æ‰§è¡Œå¯¹åº”çš„æ›´æ–°å‘½ä»¤äº†ï¼škubectl apply -f pod-nginx.yaml</p>
<h4 id="4-4-Deployment"><a href="#4-4-Deployment" class="headerlink" title="4.4 Deployment"></a>4.4 Deployment</h4><p>åœ¨kubernetesä¸­ï¼ŒPodæ˜¯æœ€å°çš„æ§åˆ¶å•å…ƒï¼Œä½†æ˜¯kuberneteså¾ˆå°‘ç›´æ¥æ§åˆ¶Podï¼Œä¸€èˆ¬éƒ½æ˜¯é€šè¿‡Podæ§åˆ¶å™¨æ¥å®Œæˆçš„ã€‚Podæ§åˆ¶å™¨ç”¨äºpodçš„ç®¡ç†ï¼Œç¡®ä¿podèµ„æºç¬¦åˆé¢„æœŸçš„çŠ¶æ€ï¼Œå½“podçš„èµ„æºå‡ºç°æ•…éšœæ—¶ï¼Œä¼šå°è¯•è¿›è¡Œé‡å¯æˆ–é‡å»ºpodã€‚</p>
<p>åœ¨kubernetesä¸­Podæ§åˆ¶å™¨çš„ç§ç±»æœ‰å¾ˆå¤šï¼Œæœ¬ç« èŠ‚åªä»‹ç»ä¸€ç§ï¼šDeploymentã€‚</p>
<p><img src="/2022/06/09/uncatalog/cl46zbayd000p7or77mughk0e/image-20200408193950807.png" alt="image-20200408193950807"></p>
<h5 id="4-4-1å¾…æ“ä½œã€‚ã€‚ã€‚ã€‚ã€‚"><a href="#4-4-1å¾…æ“ä½œã€‚ã€‚ã€‚ã€‚ã€‚" class="headerlink" title="4.4.1å¾…æ“ä½œã€‚ã€‚ã€‚ã€‚ã€‚"></a>4.4.1å¾…æ“ä½œã€‚ã€‚ã€‚ã€‚ã€‚</h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å‘½ä»¤æ ¼å¼: kubectl create deployment åç§°  [å‚æ•°] </span></span><br><span class="line"><span class="comment"># --image  æŒ‡å®špodçš„é•œåƒ</span></span><br><span class="line"><span class="comment"># --port   æŒ‡å®šç«¯å£</span></span><br><span class="line"><span class="comment"># --replicas  æŒ‡å®šåˆ›å»ºpodæ•°é‡</span></span><br><span class="line"><span class="comment"># --namespace  æŒ‡å®šnamespace</span></span><br><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># kubectl run nginx --image=nginx:latest --port=80 --replicas=3 -n dev</span></span><br><span class="line"><span class="string">deployment.apps/nginx</span> <span class="string">created</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹åˆ›å»ºçš„Pod</span></span><br><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># kubectl get pods -n dev</span></span><br><span class="line"><span class="string">NAME</span>                     <span class="string">READY</span>   <span class="string">STATUS</span>    <span class="string">RESTARTS</span>   <span class="string">AGE</span></span><br><span class="line"><span class="string">nginx-5ff7956ff6-6k8cb</span>   <span class="number">1</span><span class="string">/1</span>     <span class="string">Running</span>   <span class="number">0</span>          <span class="string">19s</span></span><br><span class="line"><span class="string">nginx-5ff7956ff6-jxfjt</span>   <span class="number">1</span><span class="string">/1</span>     <span class="string">Running</span>   <span class="number">0</span>          <span class="string">19s</span></span><br><span class="line"><span class="string">nginx-5ff7956ff6-v6jqw</span>   <span class="number">1</span><span class="string">/1</span>     <span class="string">Running</span>   <span class="number">0</span>          <span class="string">19s</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹deploymentçš„ä¿¡æ¯</span></span><br><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># kubectl get deploy -n dev</span></span><br><span class="line"><span class="string">NAME</span>    <span class="string">READY</span>   <span class="string">UP-TO-DATE</span>   <span class="string">AVAILABLE</span>   <span class="string">AGE</span></span><br><span class="line"><span class="string">nginx</span>   <span class="number">3</span><span class="string">/3</span>     <span class="number">3</span>            <span class="number">3</span>           <span class="string">2m42s</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># UP-TO-DATEï¼šæˆåŠŸå‡çº§çš„å‰¯æœ¬æ•°é‡</span></span><br><span class="line"><span class="comment"># AVAILABLEï¼šå¯ç”¨å‰¯æœ¬çš„æ•°é‡</span></span><br><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># kubectl get deploy -n dev -o wide</span></span><br><span class="line"><span class="string">NAME</span>    <span class="string">READY</span> <span class="string">UP-TO-DATE</span>  <span class="string">AVAILABLE</span>   <span class="string">AGE</span>     <span class="string">CONTAINERS</span>   <span class="string">IMAGES</span>              <span class="string">SELECTOR</span></span><br><span class="line"><span class="string">nginx</span>   <span class="number">3</span><span class="string">/3</span>     <span class="number">3</span>         <span class="number">3</span>           <span class="string">2m51s</span>   <span class="string">nginx</span>        <span class="string">nginx:latest</span>        <span class="string">run=nginx</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹deploymentçš„è¯¦ç»†ä¿¡æ¯</span></span><br><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># kubectl describe deploy nginx -n dev</span></span><br><span class="line"><span class="attr">Name:</span>                   <span class="string">nginx</span></span><br><span class="line"><span class="attr">Namespace:</span>              <span class="string">dev</span></span><br><span class="line"><span class="attr">CreationTimestamp:</span>      <span class="string">Wed,</span> <span class="number">08</span> <span class="string">May</span> <span class="number">2021 11:14:14</span> <span class="string">+0800</span></span><br><span class="line"><span class="attr">Labels:</span>                 <span class="string">run=nginx</span></span><br><span class="line"><span class="attr">Annotations:            deployment.kubernetes.io/revision:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">Selector:</span>               <span class="string">run=nginx</span></span><br><span class="line"><span class="attr">Replicas:</span>               <span class="number">3</span> <span class="string">desired</span> <span class="string">|</span> <span class="number">3</span> <span class="string">updated</span> <span class="string">|</span> <span class="number">3</span> <span class="string">total</span> <span class="string">|</span> <span class="number">3</span> <span class="string">available</span> <span class="string">|</span> <span class="number">0</span> <span class="string">unavailable</span></span><br><span class="line"><span class="attr">StrategyType:</span>           <span class="string">RollingUpdate</span></span><br><span class="line"><span class="attr">MinReadySeconds:</span>        <span class="number">0</span></span><br><span class="line"><span class="attr">RollingUpdateStrategy:</span>  <span class="number">25</span><span class="string">%</span> <span class="string">max</span> <span class="string">unavailable,</span> <span class="number">25</span><span class="string">%</span> <span class="string">max</span> <span class="string">è¿è§„è¯æ±‡</span></span><br><span class="line"><span class="attr">Pod Template:</span></span><br><span class="line">  <span class="attr">Labels:</span>  <span class="string">run=nginx</span></span><br><span class="line">  <span class="attr">Containers:</span></span><br><span class="line">   <span class="attr">nginx:</span></span><br><span class="line">    <span class="attr">Image:</span>        <span class="string">nginx:latest</span></span><br><span class="line">    <span class="attr">Port:</span>         <span class="number">80</span><span class="string">/TCP</span></span><br><span class="line">    <span class="attr">Host Port:</span>    <span class="number">0</span><span class="string">/TCP</span></span><br><span class="line">    <span class="attr">Environment:</span>  <span class="string">&lt;none&gt;</span></span><br><span class="line">    <span class="attr">Mounts:</span>       <span class="string">&lt;none&gt;</span></span><br><span class="line">  <span class="attr">Volumes:</span>        <span class="string">&lt;none&gt;</span></span><br><span class="line"><span class="attr">Conditions:</span></span><br><span class="line">  <span class="string">Type</span>           <span class="string">Status</span>  <span class="string">Reason</span></span><br><span class="line">  <span class="string">----</span>           <span class="string">------</span>  <span class="string">------</span></span><br><span class="line">  <span class="string">Available</span>      <span class="literal">True</span>    <span class="string">MinimumReplicasAvailable</span></span><br><span class="line">  <span class="string">Progressing</span>    <span class="literal">True</span>    <span class="string">NewReplicaSetAvailable</span></span><br><span class="line"><span class="attr">OldReplicaSets:</span>  <span class="string">&lt;none&gt;</span></span><br><span class="line"><span class="attr">NewReplicaSet:</span>   <span class="string">nginx-5ff7956ff6</span> <span class="string">(3/3</span> <span class="string">replicas</span> <span class="string">created)</span></span><br><span class="line"><span class="attr">Events:</span></span><br><span class="line">  <span class="string">Type</span>    <span class="string">Reason</span>             <span class="string">Age</span>    <span class="string">From</span>                   <span class="string">Message</span></span><br><span class="line">  <span class="string">----</span>    <span class="string">------</span>             <span class="string">----</span>   <span class="string">----</span>                   <span class="string">-------</span></span><br><span class="line">  <span class="string">Normal</span>  <span class="string">ScalingReplicaSet</span>  <span class="string">5m43s</span>  <span class="string">deployment-controller</span>  <span class="string">Scaled</span> <span class="string">up</span> <span class="string">replicaset</span> <span class="string">nginx-5ff7956ff6</span> <span class="string">to</span> <span class="number">3</span></span><br><span class="line">  </span><br><span class="line"><span class="comment"># åˆ é™¤ </span></span><br><span class="line">[<span class="string">root@master</span> <span class="string">~</span>]<span class="comment"># kubectl delete deploy nginx -n dev</span></span><br><span class="line"><span class="string">deployment.apps</span> <span class="string">&quot;nginx&quot;</span> <span class="string">deleted</span></span><br></pre></td></tr></table></figure></div>



<h5 id="4-4-2-é…ç½®æ“ä½œ"><a href="#4-4-2-é…ç½®æ“ä½œ" class="headerlink" title="4.4.2 é…ç½®æ“ä½œ"></a>4.4.2 é…ç½®æ“ä½œ</h5><p>åˆ›å»ºä¸€ä¸ªdeploy-nginx.yamlï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">run:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">image:</span> <span class="string">nginx:latest</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">          <span class="attr">protocol:</span> <span class="string">TCP</span></span><br></pre></td></tr></table></figure></div>

<p>ç„¶åå°±å¯ä»¥æ‰§è¡Œå¯¹åº”çš„åˆ›å»ºå’Œåˆ é™¤å‘½ä»¤äº†ï¼š</p>
<p>åˆ›å»ºï¼škubectl create -f deploy-nginx.yaml</p>
<p>åˆ é™¤ï¼škubectl delete -f deploy-nginx.yaml</p>
<h4 id="4-5-Service"><a href="#4-5-Service" class="headerlink" title="4.5 Service"></a>4.5 Service</h4><p>é€šè¿‡ä¸ŠèŠ‚è¯¾çš„å­¦ä¹ ï¼Œå·²ç»èƒ½å¤Ÿåˆ©ç”¨Deploymentæ¥åˆ›å»ºä¸€ç»„Podæ¥æä¾›å…·æœ‰é«˜å¯ç”¨æ€§çš„æœåŠ¡ã€‚</p>
<p>è™½ç„¶æ¯ä¸ªPodéƒ½ä¼šåˆ†é…ä¸€ä¸ªå•ç‹¬çš„Pod IPï¼Œç„¶è€Œå´å­˜åœ¨å¦‚ä¸‹ä¸¤é—®é¢˜ï¼š</p>
<ul>
<li>Pod IP ä¼šéšç€Podçš„é‡å»ºäº§ç”Ÿå˜åŒ–</li>
<li>Pod IP ä»…ä»…æ˜¯é›†ç¾¤å†…å¯è§çš„è™šæ‹ŸIPï¼Œå¤–éƒ¨æ— æ³•è®¿é—®</li>
</ul>
<p>è¿™æ ·å¯¹äºè®¿é—®è¿™ä¸ªæœåŠ¡å¸¦æ¥äº†éš¾åº¦ã€‚å› æ­¤ï¼Œkubernetesè®¾è®¡äº†Serviceæ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>Serviceå¯ä»¥çœ‹ä½œæ˜¯ä¸€ç»„åŒç±»Pod<strong>å¯¹å¤–çš„è®¿é—®æ¥å£</strong>ã€‚å€ŸåŠ©Serviceï¼Œåº”ç”¨å¯ä»¥æ–¹ä¾¿åœ°å®ç°æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡ã€‚</p>
<p><img src="/2022/06/09/uncatalog/cl46zbayd000p7or77mughk0e/image-20200408194716912.png" alt="image-20200408194716912"></p>
<h5 id="4-5-1-åˆ›å»ºé›†ç¾¤å†…éƒ¨å¯è®¿é—®çš„Service"><a href="#4-5-1-åˆ›å»ºé›†ç¾¤å†…éƒ¨å¯è®¿é—®çš„Service" class="headerlink" title="4.5.1 åˆ›å»ºé›†ç¾¤å†…éƒ¨å¯è®¿é—®çš„Service"></a>4.5.1 åˆ›å»ºé›†ç¾¤å†…éƒ¨å¯è®¿é—®çš„Service</h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="code"><pre><span class="line"># æš´éœ²Service</span><br><span class="line">[root@master ~]# kubectl expose deploy nginx --name&#x3D;svc-nginx1 --type&#x3D;ClusterIP --port&#x3D;80 --target-port&#x3D;80 -n dev</span><br><span class="line">service&#x2F;svc-nginx1 exposed</span><br><span class="line"></span><br><span class="line"># æŸ¥çœ‹service</span><br><span class="line">[root@master ~]# kubectl get svc svc-nginx1 -n dev -o wide</span><br><span class="line">NAME         TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)   AGE     SELECTOR</span><br><span class="line">svc-nginx1   ClusterIP   10.109.179.231   &lt;none&gt;        80&#x2F;TCP    3m51s   run&#x3D;nginx</span><br><span class="line"></span><br><span class="line"># è¿™é‡Œäº§ç”Ÿäº†ä¸€ä¸ªCLUSTER-IPï¼Œè¿™å°±æ˜¯serviceçš„IPï¼Œåœ¨Serviceçš„ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œè¿™ä¸ªåœ°å€æ˜¯ä¸ä¼šå˜åŠ¨çš„</span><br><span class="line"># å¯ä»¥é€šè¿‡è¿™ä¸ªIPè®¿é—®å½“å‰serviceå¯¹åº”çš„POD</span><br><span class="line">[root@master ~]# curl 10.109.179.231:80</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;Welcome to nginx!&lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1&gt;Welcome to nginx!&lt;&#x2F;h1&gt;</span><br><span class="line">.......</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure></div>

<h5 id="4-5-2-åˆ›å»ºé›†ç¾¤å¤–éƒ¨ä¹Ÿå¯è®¿é—®çš„Service"><a href="#4-5-2-åˆ›å»ºé›†ç¾¤å¤–éƒ¨ä¹Ÿå¯è®¿é—®çš„Service" class="headerlink" title="4.5.2 åˆ›å»ºé›†ç¾¤å¤–éƒ¨ä¹Ÿå¯è®¿é—®çš„Service"></a>4.5.2 åˆ›å»ºé›†ç¾¤å¤–éƒ¨ä¹Ÿå¯è®¿é—®çš„Service</h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="code"><pre><span class="line"># ä¸Šé¢åˆ›å»ºçš„Serviceçš„typeç±»å‹ä¸ºClusterIPï¼Œè¿™ä¸ªipåœ°å€åªç”¨é›†ç¾¤å†…éƒ¨å¯è®¿é—®</span><br><span class="line"># å¦‚æœéœ€è¦åˆ›å»ºå¤–éƒ¨ä¹Ÿå¯ä»¥è®¿é—®çš„Serviceï¼Œéœ€è¦ä¿®æ”¹typeä¸ºNodePort</span><br><span class="line">[root@master ~]# kubectl expose deploy nginx --name&#x3D;svc-nginx2 --type&#x3D;NodePort --port&#x3D;80 --target-port&#x3D;80 -n dev</span><br><span class="line">service&#x2F;svc-nginx2 exposed</span><br><span class="line"></span><br><span class="line"># æ­¤æ—¶æŸ¥çœ‹ï¼Œä¼šå‘ç°å‡ºç°äº†NodePortç±»å‹çš„Serviceï¼Œè€Œä¸”æœ‰ä¸€å¯¹Portï¼ˆ80:31928&#x2F;TCï¼‰</span><br><span class="line">[root@master ~]# kubectl get svc  svc-nginx2  -n dev -o wide</span><br><span class="line">NAME          TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)        AGE    SELECTOR</span><br><span class="line">svc-nginx2    NodePort    10.100.94.0      &lt;none&gt;        80:31928&#x2F;TCP   9s     run&#x3D;nginx</span><br><span class="line"></span><br><span class="line"># æ¥ä¸‹æ¥å°±å¯ä»¥é€šè¿‡é›†ç¾¤å¤–çš„ä¸»æœºè®¿é—® èŠ‚ç‚¹IP:31928è®¿é—®æœåŠ¡äº†</span><br><span class="line"># ä¾‹å¦‚åœ¨çš„ç”µè„‘ä¸»æœºä¸Šé€šè¿‡æµè§ˆå™¨è®¿é—®ä¸‹é¢çš„åœ°å€</span><br><span class="line">http:&#x2F;&#x2F;192.168.90.100:31928&#x2F;</span><br></pre></td></tr></table></figure></div>

<h5 id="4-5-3-åˆ é™¤Service"><a href="#4-5-3-åˆ é™¤Service" class="headerlink" title="4.5.3 åˆ é™¤Service"></a>4.5.3 åˆ é™¤Service</h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">[root@master ~]# kubectl delete svc svc-nginx-1 -n dev </span><br><span class="line">service &quot;svc-nginx-1&quot; deleted</span><br></pre></td></tr></table></figure></div>

<h5 id="4-5-4-é…ç½®æ–¹å¼"><a href="#4-5-4-é…ç½®æ–¹å¼" class="headerlink" title="4.5.4 é…ç½®æ–¹å¼"></a>4.5.4 é…ç½®æ–¹å¼</h5><p>åˆ›å»ºä¸€ä¸ªsvc-nginx.yamlï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">svc-nginx</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">clusterIP:</span> <span class="number">10.109</span><span class="number">.179</span><span class="number">.231</span> <span class="comment">#å›ºå®šsvcçš„å†…ç½‘ip</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">protocol:</span> <span class="string">TCP</span></span><br><span class="line">    <span class="attr">targetPort:</span> <span class="number">80</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">run:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">ClusterIP</span></span><br></pre></td></tr></table></figure></div>

<p>ç„¶åå°±å¯ä»¥æ‰§è¡Œå¯¹åº”çš„åˆ›å»ºå’Œåˆ é™¤å‘½ä»¤äº†ï¼š</p>
<p>åˆ›å»ºï¼škubectl create -f svc-nginx.yaml</p>
<p>åˆ é™¤ï¼škubectl delete -f svc-nginx.yaml</p>
<blockquote>
<p><strong>å°ç»“</strong></p>
<p>è‡³æ­¤ï¼Œå·²ç»æŒæ¡äº†Namespaceã€Podã€Deploymentã€Serviceèµ„æºçš„åŸºæœ¬æ“ä½œï¼Œæœ‰äº†è¿™äº›æ“ä½œï¼Œå°±å¯ä»¥åœ¨kubernetesé›†ç¾¤ä¸­å®ç°ä¸€ä¸ªæœåŠ¡çš„ç®€å•éƒ¨ç½²å’Œè®¿é—®äº†ï¼Œä½†æ˜¯å¦‚æœæƒ³è¦æ›´å¥½çš„ä½¿ç”¨kubernetesï¼Œå°±éœ€è¦æ·±å…¥å­¦ä¹ è¿™å‡ ç§èµ„æºçš„ç»†èŠ‚å’ŒåŸç†ã€‚</p>
</blockquote>
]]></content>
      <tags>
        <tag>äº‘åŸç”ŸåŸºç¡€ç³»åˆ—</tag>
        <tag>Kubernetes</tag>
      </tags>
  </entry>
  <entry>
    <title>äº‘åŸç”ŸåŸºç¡€ç³»åˆ—ä¹‹Kubernetes(å…­)Podæ§åˆ¶å™¨è¯¦è§£</title>
    <url>/2022/06/09/uncatalog/cl46zbaye000q7or7bx6mhrl3/</url>
    <content><![CDATA[<hr>
<span id="more"></span>



<hr>
<h3 id="6-Podæ§åˆ¶å™¨è¯¦è§£"><a href="#6-Podæ§åˆ¶å™¨è¯¦è§£" class="headerlink" title="6. Podæ§åˆ¶å™¨è¯¦è§£"></a>6. Podæ§åˆ¶å™¨è¯¦è§£</h3><h4 id="6-1-Podæ§åˆ¶å™¨ä»‹ç»"><a href="#6-1-Podæ§åˆ¶å™¨ä»‹ç»" class="headerlink" title="6.1 Podæ§åˆ¶å™¨ä»‹ç»"></a>6.1 Podæ§åˆ¶å™¨ä»‹ç»</h4><p>Podæ˜¯kubernetesçš„æœ€å°ç®¡ç†å•å…ƒï¼Œåœ¨kubernetesä¸­ï¼ŒæŒ‰ç…§podçš„åˆ›å»ºæ–¹å¼å¯ä»¥å°†å…¶åˆ†ä¸ºä¸¤ç±»ï¼š</p>
<ul>
<li>è‡ªä¸»å¼podï¼škubernetesç›´æ¥åˆ›å»ºå‡ºæ¥çš„Podï¼Œè¿™ç§podåˆ é™¤åå°±æ²¡æœ‰äº†ï¼Œä¹Ÿä¸ä¼šé‡å»º</li>
<li>æ§åˆ¶å™¨åˆ›å»ºçš„podï¼škubernetesé€šè¿‡æ§åˆ¶å™¨åˆ›å»ºçš„podï¼Œè¿™ç§podåˆ é™¤äº†ä¹‹åè¿˜ä¼šè‡ªåŠ¨é‡å»º</li>
</ul>
<blockquote>
<p><strong><code>ä»€ä¹ˆæ˜¯Podæ§åˆ¶å™¨</code></strong></p>
<p>Podæ§åˆ¶å™¨æ˜¯ç®¡ç†podçš„ä¸­é—´å±‚ï¼Œä½¿ç”¨Podæ§åˆ¶å™¨ä¹‹åï¼Œåªéœ€è¦å‘Šè¯‰Podæ§åˆ¶å™¨ï¼Œæƒ³è¦å¤šå°‘ä¸ªä»€ä¹ˆæ ·çš„Podå°±å¯ä»¥äº†ï¼Œå®ƒä¼šåˆ›å»ºå‡ºæ»¡è¶³æ¡ä»¶çš„Podå¹¶ç¡®ä¿æ¯ä¸€ä¸ªPodèµ„æºå¤„äºç”¨æˆ·æœŸæœ›çš„ç›®æ ‡çŠ¶æ€ã€‚å¦‚æœPodèµ„æºåœ¨è¿è¡Œä¸­å‡ºç°æ•…éšœï¼Œå®ƒä¼šåŸºäºæŒ‡å®šç­–ç•¥é‡æ–°ç¼–æ’Podã€‚</p>
</blockquote>
<p>åœ¨kubernetesä¸­ï¼Œæœ‰å¾ˆå¤šç±»å‹çš„podæ§åˆ¶å™¨ï¼Œæ¯ç§éƒ½æœ‰è‡ªå·±çš„é€‚åˆçš„åœºæ™¯ï¼Œå¸¸è§çš„æœ‰ä¸‹é¢è¿™äº›ï¼š</p>
<ul>
<li>ReplicationControllerï¼šæ¯”è¾ƒåŸå§‹çš„podæ§åˆ¶å™¨ï¼Œå·²ç»è¢«åºŸå¼ƒï¼Œç”±ReplicaSetæ›¿ä»£</li>
<li>ReplicaSetï¼šä¿è¯å‰¯æœ¬æ•°é‡ä¸€ç›´ç»´æŒåœ¨æœŸæœ›å€¼ï¼Œå¹¶æ”¯æŒpodæ•°é‡æ‰©ç¼©å®¹ï¼Œé•œåƒç‰ˆæœ¬å‡çº§</li>
<li>Deploymentï¼šé€šè¿‡æ§åˆ¶ReplicaSetæ¥æ§åˆ¶Podï¼Œå¹¶æ”¯æŒæ»šåŠ¨å‡çº§ã€å›é€€ç‰ˆæœ¬</li>
<li>Horizontal Pod Autoscalerï¼šå¯ä»¥æ ¹æ®é›†ç¾¤è´Ÿè½½è‡ªåŠ¨æ°´å¹³è°ƒæ•´Podçš„æ•°é‡ï¼Œå®ç°å‰Šå³°å¡«è°·</li>
<li>DaemonSetï¼šåœ¨é›†ç¾¤ä¸­çš„æŒ‡å®šNodeä¸Šè¿è¡Œä¸”ä»…è¿è¡Œä¸€ä¸ªå‰¯æœ¬ï¼Œä¸€èˆ¬ç”¨äºå®ˆæŠ¤è¿›ç¨‹ç±»çš„ä»»åŠ¡</li>
<li>Jobï¼šå®ƒåˆ›å»ºå‡ºæ¥çš„podåªè¦å®Œæˆä»»åŠ¡å°±ç«‹å³é€€å‡ºï¼Œä¸éœ€è¦é‡å¯æˆ–é‡å»ºï¼Œç”¨äºæ‰§è¡Œä¸€æ¬¡æ€§ä»»åŠ¡</li>
<li>Cronjobï¼šå®ƒåˆ›å»ºçš„Podè´Ÿè´£å‘¨æœŸæ€§ä»»åŠ¡æ§åˆ¶ï¼Œä¸éœ€è¦æŒç»­åå°è¿è¡Œ</li>
<li>StatefulSetï¼šç®¡ç†æœ‰çŠ¶æ€åº”ç”¨</li>
</ul>
<h4 id="6-2-ReplicaSet-RS"><a href="#6-2-ReplicaSet-RS" class="headerlink" title="6.2 ReplicaSet(RS)"></a>6.2 ReplicaSet(RS)</h4><p>ReplicaSetçš„ä¸»è¦ä½œç”¨æ˜¯<strong>ä¿è¯ä¸€å®šæ•°é‡çš„podæ­£å¸¸è¿è¡Œ</strong>ï¼Œå®ƒä¼šæŒç»­ç›‘å¬è¿™äº›Podçš„è¿è¡ŒçŠ¶æ€ï¼Œä¸€æ—¦Podå‘ç”Ÿæ•…éšœï¼Œå°±ä¼šé‡å¯æˆ–é‡å»ºã€‚åŒæ—¶å®ƒè¿˜æ”¯æŒå¯¹podæ•°é‡çš„æ‰©ç¼©å®¹å’Œé•œåƒç‰ˆæœ¬çš„å‡é™çº§ã€‚</p>
<p><img src="/2022/06/09/uncatalog/cl46zbaye000q7or7bx6mhrl3/image-20200612005334159.png" alt="img"></p>
<p>ReplicaSetçš„èµ„æºæ¸…å•æ–‡ä»¶ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span> <span class="comment"># ç‰ˆæœ¬å·</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ReplicaSet</span> <span class="comment"># ç±»å‹       </span></span><br><span class="line"><span class="attr">metadata:</span> <span class="comment"># å…ƒæ•°æ®</span></span><br><span class="line">  <span class="attr">name:</span> <span class="comment"># rsåç§° </span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="comment"># æ‰€å±å‘½åç©ºé—´ </span></span><br><span class="line">  <span class="attr">labels:</span> <span class="comment">#æ ‡ç­¾</span></span><br><span class="line">    <span class="attr">controller:</span> <span class="string">rs</span></span><br><span class="line"><span class="attr">spec:</span> <span class="comment"># è¯¦æƒ…æè¿°</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span> <span class="comment"># å‰¯æœ¬æ•°é‡</span></span><br><span class="line">  <span class="attr">selector:</span> <span class="comment"># é€‰æ‹©å™¨ï¼Œé€šè¿‡å®ƒæŒ‡å®šè¯¥æ§åˆ¶å™¨ç®¡ç†å“ªäº›pod</span></span><br><span class="line">    <span class="attr">matchLabels:</span>      <span class="comment"># LabelsåŒ¹é…è§„åˆ™</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">nginx-pod</span></span><br><span class="line">    <span class="attr">matchExpressions:</span> <span class="comment"># ExpressionsåŒ¹é…è§„åˆ™</span></span><br><span class="line">      <span class="bullet">-</span> &#123;<span class="attr">key:</span> <span class="string">app</span>, <span class="attr">operator:</span> <span class="string">In</span>, <span class="attr">values:</span> [<span class="string">nginx-pod</span>]&#125;</span><br><span class="line">  <span class="attr">template:</span> <span class="comment"># æ¨¡æ¿ï¼Œå½“å‰¯æœ¬æ•°é‡ä¸è¶³æ—¶ï¼Œä¼šæ ¹æ®ä¸‹é¢çš„æ¨¡æ¿åˆ›å»ºpodå‰¯æœ¬</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">nginx-pod</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">nginx:1.17.1</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure></div>

<p>åœ¨è¿™é‡Œé¢ï¼Œéœ€è¦æ–°äº†è§£çš„é…ç½®é¡¹å°±æ˜¯<code>spec</code>ä¸‹é¢å‡ ä¸ªé€‰é¡¹ï¼š</p>
<ul>
<li><p>replicasï¼šæŒ‡å®šå‰¯æœ¬æ•°é‡ï¼Œå…¶å®å°±æ˜¯å½“å‰rsåˆ›å»ºå‡ºæ¥çš„podçš„æ•°é‡ï¼Œé»˜è®¤ä¸º1</p>
</li>
<li><p>selectorï¼šé€‰æ‹©å™¨ï¼Œå®ƒçš„ä½œç”¨æ˜¯å»ºç«‹podæ§åˆ¶å™¨å’Œpodä¹‹é—´çš„å…³è”å…³ç³»ï¼Œé‡‡ç”¨çš„Label Selectoræœºåˆ¶</p>
<p>åœ¨podæ¨¡æ¿ä¸Šå®šä¹‰labelï¼Œåœ¨æ§åˆ¶å™¨ä¸Šå®šä¹‰é€‰æ‹©å™¨ï¼Œå°±å¯ä»¥è¡¨æ˜å½“å‰æ§åˆ¶å™¨èƒ½ç®¡ç†å“ªäº›podäº†</p>
</li>
<li><p>templateï¼šæ¨¡æ¿ï¼Œå°±æ˜¯å½“å‰æ§åˆ¶å™¨åˆ›å»ºpodæ‰€ä½¿ç”¨çš„æ¨¡æ¿æ¿ï¼Œé‡Œé¢å…¶å®å°±æ˜¯å‰ä¸€ç« å­¦è¿‡çš„podçš„å®šä¹‰</p>
</li>
</ul>
<p><strong>åˆ›å»ºReplicaSet</strong></p>
<p>åˆ›å»ºpc-replicaset.yamlæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ReplicaSet</span>   </span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pc-replicaset</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">selector:</span> </span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">nginx-pod</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">nginx-pod</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">nginx:1.17.1</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åˆ›å»ºrs</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl create -f pc-replicaset.yaml</span><br><span class="line">replicaset.apps/pc-replicaset created</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹rs</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> DESIRED:æœŸæœ›å‰¯æœ¬æ•°é‡</span>  </span><br><span class="line"><span class="meta">#</span><span class="bash"> CURRENT:å½“å‰å‰¯æœ¬æ•°é‡</span>  </span><br><span class="line"><span class="meta">#</span><span class="bash"> READY:å·²ç»å‡†å¤‡å¥½æä¾›æœåŠ¡çš„å‰¯æœ¬æ•°é‡</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl get rs pc-replicaset -n dev -o wide</span><br><span class="line">NAME          DESIRED   CURRENT READY AGE   CONTAINERS   IMAGES             SELECTOR</span><br><span class="line">pc-replicaset 3         3       3     22s   nginx        nginx:1.17.1       app=nginx-pod</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹å½“å‰æ§åˆ¶å™¨åˆ›å»ºå‡ºæ¥çš„pod</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> è¿™é‡Œå‘ç°æ§åˆ¶å™¨åˆ›å»ºå‡ºæ¥çš„podçš„åç§°æ˜¯åœ¨æ§åˆ¶å™¨åç§°åé¢æ‹¼æ¥äº†-xxxxxéšæœºç </span></span><br><span class="line">[root@k8s-master01 ~]# kubectl get pod -n dev</span><br><span class="line">NAME                          READY   STATUS    RESTARTS   AGE</span><br><span class="line">pc-replicaset-6vmvt   1/1     Running   0          54s</span><br><span class="line">pc-replicaset-fmb8f   1/1     Running   0          54s</span><br><span class="line">pc-replicaset-snrk2   1/1     Running   0          54s</span><br></pre></td></tr></table></figure></div>

<p><strong>æ‰©ç¼©å®¹</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ç¼–è¾‘rsçš„å‰¯æœ¬æ•°é‡ï¼Œä¿®æ”¹spec:replicas: 6å³å¯</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl edit rs pc-replicaset -n dev</span><br><span class="line">replicaset.apps/pc-replicaset edited</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹pod</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl get pods -n dev</span><br><span class="line">NAME                          READY   STATUS    RESTARTS   AGE</span><br><span class="line">pc-replicaset-6vmvt   1/1     Running   0          114m</span><br><span class="line">pc-replicaset-cftnp   1/1     Running   0          10s</span><br><span class="line">pc-replicaset-fjlm6   1/1     Running   0          10s</span><br><span class="line">pc-replicaset-fmb8f   1/1     Running   0          114m</span><br><span class="line">pc-replicaset-s2whj   1/1     Running   0          10s</span><br><span class="line">pc-replicaset-snrk2   1/1     Running   0          114m</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨å‘½ä»¤å®ç°</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä½¿ç”¨scaleå‘½ä»¤å®ç°æ‰©ç¼©å®¹ï¼Œ åé¢--replicas=nç›´æ¥æŒ‡å®šç›®æ ‡æ•°é‡å³å¯</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl scale rs pc-replicaset --replicas=2 -n dev</span><br><span class="line">replicaset.apps/pc-replicaset scaled</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å‘½ä»¤è¿è¡Œå®Œæ¯•ï¼Œç«‹å³æŸ¥çœ‹ï¼Œå‘ç°å·²ç»æœ‰4ä¸ªå¼€å§‹å‡†å¤‡é€€å‡ºäº†</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl get pods -n dev</span><br><span class="line">NAME                       READY   STATUS        RESTARTS   AGE</span><br><span class="line">pc-replicaset-6vmvt   0/1     Terminating   0          118m</span><br><span class="line">pc-replicaset-cftnp   0/1     Terminating   0          4m17s</span><br><span class="line">pc-replicaset-fjlm6   0/1     Terminating   0          4m17s</span><br><span class="line">pc-replicaset-fmb8f   1/1     Running       0          118m</span><br><span class="line">pc-replicaset-s2whj   0/1     Terminating   0          4m17s</span><br><span class="line">pc-replicaset-snrk2   1/1     Running       0          118m</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">ç¨ç­‰ç‰‡åˆ»ï¼Œå°±åªå‰©ä¸‹2ä¸ªäº†</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl get pods -n dev</span><br><span class="line">NAME                       READY   STATUS    RESTARTS   AGE</span><br><span class="line">pc-replicaset-fmb8f   1/1     Running   0          119m</span><br><span class="line">pc-replicaset-snrk2   1/1     Running   0          119m</span><br></pre></td></tr></table></figure></div>

<p><strong>é•œåƒå‡çº§</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ç¼–è¾‘rsçš„å®¹å™¨é•œåƒ - image: nginx:1.17.2</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl edit rs pc-replicaset -n dev</span><br><span class="line">replicaset.apps/pc-replicaset edited</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å†æ¬¡æŸ¥çœ‹ï¼Œå‘ç°é•œåƒç‰ˆæœ¬å·²ç»å˜æ›´äº†</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl get rs -n dev -o wide</span><br><span class="line">NAME                DESIRED  CURRENT   READY   AGE    CONTAINERS   IMAGES        ...</span><br><span class="line">pc-replicaset       2        2         2       140m   nginx         nginx:1.17.2  ...</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> åŒæ ·çš„é“ç†ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨å‘½ä»¤å®Œæˆè¿™ä¸ªå·¥ä½œ</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> kubectl <span class="built_in">set</span> image rs rsåç§° å®¹å™¨=é•œåƒç‰ˆæœ¬ -n namespace</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl set image rs pc-replicaset nginx=nginx:1.17.1  -n dev</span><br><span class="line">replicaset.apps/pc-replicaset image updated</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å†æ¬¡æŸ¥çœ‹ï¼Œå‘ç°é•œåƒç‰ˆæœ¬å·²ç»å˜æ›´äº†</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl get rs -n dev -o wide</span><br><span class="line">NAME                 DESIRED  CURRENT   READY   AGE    CONTAINERS   IMAGES            ...</span><br><span class="line">pc-replicaset        2        2         2       145m   nginx        nginx:1.17.1 ... </span><br></pre></td></tr></table></figure></div>

<p><strong>åˆ é™¤ReplicaSet</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ä½¿ç”¨kubectl deleteå‘½ä»¤ä¼šåˆ é™¤æ­¤RSä»¥åŠå®ƒç®¡ç†çš„Pod</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> åœ¨kubernetesåˆ é™¤RSå‰ï¼Œä¼šå°†RSçš„replicasclearè°ƒæ•´ä¸º0ï¼Œç­‰å¾…æ‰€æœ‰çš„Podè¢«åˆ é™¤åï¼Œåœ¨æ‰§è¡ŒRSå¯¹è±¡çš„åˆ é™¤</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl delete rs pc-replicaset -n dev</span><br><span class="line">replicaset.apps &quot;pc-replicaset&quot; deleted</span><br><span class="line">[root@k8s-master01 ~]# kubectl get pod -n dev -o wide</span><br><span class="line">No resources found in dev namespace.</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¦‚æœå¸Œæœ›ä»…ä»…åˆ é™¤RSå¯¹è±¡ï¼ˆä¿ç•™Podï¼‰ï¼Œå¯ä»¥ä½¿ç”¨kubectl deleteå‘½ä»¤æ—¶æ·»åŠ --cascade=<span class="literal">false</span>é€‰é¡¹ï¼ˆä¸æ¨èï¼‰ã€‚</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl delete rs pc-replicaset -n dev --cascade=false</span><br><span class="line">replicaset.apps &quot;pc-replicaset&quot; deleted</span><br><span class="line">[root@k8s-master01 ~]# kubectl get pods -n dev</span><br><span class="line">NAME                  READY   STATUS    RESTARTS   AGE</span><br><span class="line">pc-replicaset-cl82j   1/1     Running   0          75s</span><br><span class="line">pc-replicaset-dslhb   1/1     Running   0          75s</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¹Ÿå¯ä»¥ä½¿ç”¨yamlç›´æ¥åˆ é™¤(æ¨è)</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl delete -f pc-replicaset.yaml</span><br><span class="line">replicaset.apps &quot;pc-replicaset&quot; deleted</span><br></pre></td></tr></table></figure></div>

<h4 id="6-3-Deployment-Deploy"><a href="#6-3-Deployment-Deploy" class="headerlink" title="6.3 Deployment(Deploy)"></a>6.3 Deployment(Deploy)</h4><p>ä¸ºäº†æ›´å¥½çš„è§£å†³æœåŠ¡ç¼–æ’çš„é—®é¢˜ï¼Œkubernetesåœ¨V1.2ç‰ˆæœ¬å¼€å§‹ï¼Œå¼•å…¥äº†Deploymentæ§åˆ¶å™¨ã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼Œè¿™ç§æ§åˆ¶å™¨å¹¶ä¸ç›´æ¥ç®¡ç†podï¼Œè€Œæ˜¯é€šè¿‡ç®¡ç†ReplicaSetæ¥ç®€ä»‹ç®¡ç†Podï¼Œå³ï¼šDeploymentç®¡ç†ReplicaSetï¼ŒReplicaSetç®¡ç†Podã€‚æ‰€ä»¥Deploymentæ¯”ReplicaSetåŠŸèƒ½æ›´åŠ å¼ºå¤§ã€‚</p>
<p>ä¸ºäº†æ›´å¥½çš„è§£å†³æœåŠ¡ç¼–æ’çš„é—®é¢˜ï¼Œkubernetesåœ¨V1.2ç‰ˆæœ¬å¼€å§‹ï¼Œå¼•å…¥äº†Deploymentæ§åˆ¶å™¨ã€‚å€¼å¾—ä¸€æçš„æ˜¯ï¼Œè¿™ç§æ§åˆ¶å™¨å¹¶ä¸ç›´æ¥ç®¡ç†podï¼Œè€Œæ˜¯é€šè¿‡ç®¡ç†ReplicaSetæ¥ç®€ä»‹ç®¡ç†Podï¼Œå³ï¼šDeploymentç®¡ç†ReplicaSetï¼ŒReplicaSetç®¡ç†Podã€‚æ‰€ä»¥Deploymentæ¯”ReplicaSetåŠŸèƒ½æ›´åŠ å¼ºå¤§ã€‚</p>
<p><img src="/2022/06/09/uncatalog/cl46zbaye000q7or7bx6mhrl3/image-20200612005524778.png" alt="img"></p>
<p>Deploymentä¸»è¦åŠŸèƒ½æœ‰ä¸‹é¢å‡ ä¸ªï¼š</p>
<ul>
<li>æ”¯æŒReplicaSetçš„æ‰€æœ‰åŠŸèƒ½</li>
<li>æ”¯æŒå‘å¸ƒçš„åœæ­¢ã€ç»§ç»­</li>
<li>æ”¯æŒæ»šåŠ¨å‡çº§å’Œå›æ»šç‰ˆæœ¬</li>
</ul>
<p>Deploymentçš„èµ„æºæ¸…å•æ–‡ä»¶ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span> <span class="comment"># ç‰ˆæœ¬å·</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span> <span class="comment"># ç±»å‹       </span></span><br><span class="line"><span class="attr">metadata:</span> <span class="comment"># å…ƒæ•°æ®</span></span><br><span class="line">  <span class="attr">name:</span> <span class="comment"># rsåç§° </span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="comment"># æ‰€å±å‘½åç©ºé—´ </span></span><br><span class="line">  <span class="attr">labels:</span> <span class="comment">#æ ‡ç­¾</span></span><br><span class="line">    <span class="attr">controller:</span> <span class="string">deploy</span></span><br><span class="line"><span class="attr">spec:</span> <span class="comment"># è¯¦æƒ…æè¿°</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span> <span class="comment"># å‰¯æœ¬æ•°é‡</span></span><br><span class="line">  <span class="attr">revisionHistoryLimit:</span> <span class="number">3</span> <span class="comment"># ä¿ç•™å†å²ç‰ˆæœ¬</span></span><br><span class="line">  <span class="attr">paused:</span> <span class="literal">false</span> <span class="comment"># æš‚åœéƒ¨ç½²ï¼Œé»˜è®¤æ˜¯false</span></span><br><span class="line">  <span class="attr">progressDeadlineSeconds:</span> <span class="number">600</span> <span class="comment"># éƒ¨ç½²è¶…æ—¶æ—¶é—´ï¼ˆsï¼‰ï¼Œé»˜è®¤æ˜¯600</span></span><br><span class="line">  <span class="attr">strategy:</span> <span class="comment"># ç­–ç•¥</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">RollingUpdate</span> <span class="comment"># æ»šåŠ¨æ›´æ–°ç­–ç•¥</span></span><br><span class="line">    <span class="attr">rollingUpdate:</span> <span class="comment"># æ»šåŠ¨æ›´æ–°</span></span><br><span class="line">      <span class="string">è¿è§„è¯æ±‡:</span> <span class="number">30</span><span class="string">%</span> <span class="comment"># æœ€å¤§é¢å¤–å¯ä»¥å­˜åœ¨çš„å‰¯æœ¬æ•°ï¼Œå¯ä»¥ä¸ºç™¾åˆ†æ¯”ï¼Œä¹Ÿå¯ä»¥ä¸ºæ•´æ•°</span></span><br><span class="line">      <span class="attr">maxUnavailable:</span> <span class="number">30</span><span class="string">%</span> <span class="comment"># æœ€å¤§ä¸å¯ç”¨çŠ¶æ€çš„ Pod çš„æœ€å¤§å€¼ï¼Œå¯ä»¥ä¸ºç™¾åˆ†æ¯”ï¼Œä¹Ÿå¯ä»¥ä¸ºæ•´æ•°</span></span><br><span class="line">  <span class="attr">selector:</span> <span class="comment"># é€‰æ‹©å™¨ï¼Œé€šè¿‡å®ƒæŒ‡å®šè¯¥æ§åˆ¶å™¨ç®¡ç†å“ªäº›pod</span></span><br><span class="line">    <span class="attr">matchLabels:</span>      <span class="comment"># LabelsåŒ¹é…è§„åˆ™</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">nginx-pod</span></span><br><span class="line">    <span class="attr">matchExpressions:</span> <span class="comment"># ExpressionsåŒ¹é…è§„åˆ™</span></span><br><span class="line">      <span class="bullet">-</span> &#123;<span class="attr">key:</span> <span class="string">app</span>, <span class="attr">operator:</span> <span class="string">In</span>, <span class="attr">values:</span> [<span class="string">nginx-pod</span>]&#125;</span><br><span class="line">  <span class="attr">template:</span> <span class="comment"># æ¨¡æ¿ï¼Œå½“å‰¯æœ¬æ•°é‡ä¸è¶³æ—¶ï¼Œä¼šæ ¹æ®ä¸‹é¢çš„æ¨¡æ¿åˆ›å»ºpodå‰¯æœ¬</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">nginx-pod</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">nginx:1.17.1</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure></div>

<h5 id="6-3-1-åˆ›å»ºdeployment"><a href="#6-3-1-åˆ›å»ºdeployment" class="headerlink" title="6.3.1 åˆ›å»ºdeployment"></a>6.3.1 åˆ›å»ºdeployment</h5><p>åˆ›å»ºpc-deployment.yamlï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span>      </span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pc-deployment</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">spec:</span> </span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">3</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">nginx-pod</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">nginx-pod</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">nginx:1.17.1</span></span><br></pre></td></tr></table></figure></div>

<h5 id="6-3-2-æ‰©ç¼©å®¹"><a href="#6-3-2-æ‰©ç¼©å®¹" class="headerlink" title="6.3.2 æ‰©ç¼©å®¹"></a>6.3.2 æ‰©ç¼©å®¹</h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å˜æ›´å‰¯æœ¬æ•°é‡ä¸º5ä¸ª</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl scale deploy pc-deployment --replicas=5  -n dev</span><br><span class="line">deployment.apps/pc-deployment scaled</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹deployment</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl get deploy pc-deployment -n dev</span><br><span class="line">NAME            READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">pc-deployment   5/5     5            5           2m</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹pod</span></span><br><span class="line">[root@k8s-master01 ~]#  kubectl get pods -n dev</span><br><span class="line">NAME                             READY   STATUS    RESTARTS   AGE</span><br><span class="line">pc-deployment-6696798b78-d2c8n   1/1     Running   0          4m19s</span><br><span class="line">pc-deployment-6696798b78-jxmdq   1/1     Running   0          94s</span><br><span class="line">pc-deployment-6696798b78-mktqv   1/1     Running   0          93s</span><br><span class="line">pc-deployment-6696798b78-smpvp   1/1     Running   0          4m19s</span><br><span class="line">pc-deployment-6696798b78-wvjd8   1/1     Running   0          4m19s</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ç¼–è¾‘deploymentçš„å‰¯æœ¬æ•°é‡ï¼Œä¿®æ”¹spec:replicas: 4å³å¯</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl edit deploy pc-deployment -n dev</span><br><span class="line">deployment.apps/pc-deployment edited</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹pod</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl get pods -n dev</span><br><span class="line">NAME                             READY   STATUS    RESTARTS   AGE</span><br><span class="line">pc-deployment-6696798b78-d2c8n   1/1     Running   0          5m23s</span><br><span class="line">pc-deployment-6696798b78-jxmdq   1/1     Running   0          2m38s</span><br><span class="line">pc-deployment-6696798b78-smpvp   1/1     Running   0          5m23s</span><br><span class="line">pc-deployment-6696798b78-wvjd8   1/1     Running   0          5m23s</span><br></pre></td></tr></table></figure></div>

<p><strong>é•œåƒæ›´æ–°</strong></p>
<p>deploymentæ”¯æŒä¸¤ç§æ›´æ–°ç­–ç•¥:<code>é‡å»ºæ›´æ–°</code>å’Œ<code>æ»šåŠ¨æ›´æ–°</code>,å¯ä»¥é€šè¿‡<code>strategy</code>æŒ‡å®šç­–ç•¥ç±»å‹,æ”¯æŒä¸¤ä¸ªå±æ€§:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="MARKDOWN"><figure class="iseeu highlight /markdown"><table><tr><td class="code"><pre><span class="line">strategyï¼šæŒ‡å®šæ–°çš„Podæ›¿æ¢æ—§çš„Podçš„ç­–ç•¥ï¼Œ æ”¯æŒä¸¤ä¸ªå±æ€§ï¼š</span><br><span class="line">  typeï¼šæŒ‡å®šç­–ç•¥ç±»å‹ï¼Œæ”¯æŒä¸¤ç§ç­–ç•¥</span><br><span class="line"><span class="code">    Recreateï¼šåœ¨åˆ›å»ºå‡ºæ–°çš„Podä¹‹å‰ä¼šå…ˆæ€æ‰æ‰€æœ‰å·²å­˜åœ¨çš„Pod</span></span><br><span class="line"><span class="code">    RollingUpdateï¼šæ»šåŠ¨æ›´æ–°ï¼Œå°±æ˜¯æ€æ­»ä¸€éƒ¨åˆ†ï¼Œå°±å¯åŠ¨ä¸€éƒ¨åˆ†ï¼Œåœ¨æ›´æ–°è¿‡ç¨‹ä¸­ï¼Œå­˜åœ¨ä¸¤ä¸ªç‰ˆæœ¬Pod</span></span><br><span class="line"><span class="code">  rollingUpdateï¼šå½“typeä¸ºRollingUpdateæ—¶ç”Ÿæ•ˆï¼Œç”¨äºä¸ºRollingUpdateè®¾ç½®å‚æ•°ï¼Œæ”¯æŒä¸¤ä¸ªå±æ€§ï¼š</span></span><br><span class="line"><span class="code">    maxUnavailableï¼šç”¨æ¥æŒ‡å®šåœ¨å‡çº§è¿‡ç¨‹ä¸­ä¸å¯ç”¨Podçš„æœ€å¤§æ•°é‡ï¼Œé»˜è®¤ä¸º25%ã€‚</span></span><br><span class="line"><span class="code">    è¿è§„è¯æ±‡ï¼š ç”¨æ¥æŒ‡å®šåœ¨å‡çº§è¿‡ç¨‹ä¸­å¯ä»¥è¶…è¿‡æœŸæœ›çš„Podçš„æœ€å¤§æ•°é‡ï¼Œé»˜è®¤ä¸º25%ã€‚</span></span><br></pre></td></tr></table></figure></div>

<p>é‡å»ºæ›´æ–°</p>
<ol>
<li>ç¼–è¾‘pc-deployment.yaml,åœ¨specèŠ‚ç‚¹ä¸‹æ·»åŠ æ›´æ–°ç­–ç•¥</li>
</ol>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">strategy:</span> <span class="comment"># ç­–ç•¥</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">Recreate</span> <span class="comment"># é‡å»ºæ›´æ–°</span></span><br></pre></td></tr></table></figure></div>

<ol start="2">
<li>åˆ›å»ºdeployè¿›è¡ŒéªŒè¯</li>
</ol>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å˜æ›´é•œåƒ</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl set image deployment pc-deployment nginx=nginx:1.17.2 -n dev</span><br><span class="line">deployment.apps/pc-deployment image updated</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> è§‚å¯Ÿå‡çº§è¿‡ç¨‹</span></span><br><span class="line">[root@k8s-master01 ~]#  kubectl get pods -n dev -w</span><br><span class="line">NAME                             READY   STATUS    RESTARTS   AGE</span><br><span class="line">pc-deployment-5d89bdfbf9-65qcw   1/1     Running   0          31s</span><br><span class="line">pc-deployment-5d89bdfbf9-w5nzv   1/1     Running   0          31s</span><br><span class="line">pc-deployment-5d89bdfbf9-xpt7w   1/1     Running   0          31s</span><br><span class="line"></span><br><span class="line">pc-deployment-5d89bdfbf9-xpt7w   1/1     Terminating   0          41s</span><br><span class="line">pc-deployment-5d89bdfbf9-65qcw   1/1     Terminating   0          41s</span><br><span class="line">pc-deployment-5d89bdfbf9-w5nzv   1/1     Terminating   0          41s</span><br><span class="line"></span><br><span class="line">pc-deployment-675d469f8b-grn8z   0/1     Pending       0          0s</span><br><span class="line">pc-deployment-675d469f8b-hbl4v   0/1     Pending       0          0s</span><br><span class="line">pc-deployment-675d469f8b-67nz2   0/1     Pending       0          0s</span><br><span class="line"></span><br><span class="line">pc-deployment-675d469f8b-grn8z   0/1     ContainerCreating   0          0s</span><br><span class="line">pc-deployment-675d469f8b-hbl4v   0/1     ContainerCreating   0          0s</span><br><span class="line">pc-deployment-675d469f8b-67nz2   0/1     ContainerCreating   0          0s</span><br><span class="line"></span><br><span class="line">pc-deployment-675d469f8b-grn8z   1/1     Running             0          1s</span><br><span class="line">pc-deployment-675d469f8b-67nz2   1/1     Running             0          1s</span><br><span class="line">pc-deployment-675d469f8b-hbl4v   1/1     Running             0          2s</span><br></pre></td></tr></table></figure></div>

<p>æ»šåŠ¨æ›´æ–°</p>
<ol>
<li>ç¼–è¾‘pc-deployment.yaml,åœ¨specèŠ‚ç‚¹ä¸‹æ·»åŠ æ›´æ–°ç­–ç•¥</li>
</ol>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">strategy:</span> <span class="comment"># ç­–ç•¥</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">RollingUpdate</span> <span class="comment"># æ»šåŠ¨æ›´æ–°ç­–ç•¥</span></span><br><span class="line">    <span class="attr">rollingUpdate:</span></span><br><span class="line">      <span class="string">è¿è§„è¯æ±‡:</span> <span class="number">25</span><span class="string">%</span> </span><br><span class="line">      <span class="attr">maxUnavailable:</span> <span class="number">25</span><span class="string">%</span></span><br></pre></td></tr></table></figure></div>

<ol start="2">
<li>åˆ›å»ºdeployè¿›è¡ŒéªŒè¯</li>
</ol>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å˜æ›´é•œåƒ</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl set image deployment pc-deployment nginx=nginx:1.17.3 -n dev </span><br><span class="line">deployment.apps/pc-deployment image updated</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> è§‚å¯Ÿå‡çº§è¿‡ç¨‹</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl get pods -n dev -w</span><br><span class="line">NAME                           READY   STATUS    RESTARTS   AGE</span><br><span class="line">pc-deployment-c848d767-8rbzt   1/1     Running   0          31m</span><br><span class="line">pc-deployment-c848d767-h4p68   1/1     Running   0          31m</span><br><span class="line">pc-deployment-c848d767-hlmz4   1/1     Running   0          31m</span><br><span class="line">pc-deployment-c848d767-rrqcn   1/1     Running   0          31m</span><br><span class="line"></span><br><span class="line">pc-deployment-966bf7f44-226rx   0/1     Pending             0          0s</span><br><span class="line">pc-deployment-966bf7f44-226rx   0/1     ContainerCreating   0          0s</span><br><span class="line">pc-deployment-966bf7f44-226rx   1/1     Running             0          1s</span><br><span class="line">pc-deployment-c848d767-h4p68    0/1     Terminating         0          34m</span><br><span class="line"></span><br><span class="line">pc-deployment-966bf7f44-cnd44   0/1     Pending             0          0s</span><br><span class="line">pc-deployment-966bf7f44-cnd44   0/1     ContainerCreating   0          0s</span><br><span class="line">pc-deployment-966bf7f44-cnd44   1/1     Running             0          2s</span><br><span class="line">pc-deployment-c848d767-hlmz4    0/1     Terminating         0          34m</span><br><span class="line"></span><br><span class="line">pc-deployment-966bf7f44-px48p   0/1     Pending             0          0s</span><br><span class="line">pc-deployment-966bf7f44-px48p   0/1     ContainerCreating   0          0s</span><br><span class="line">pc-deployment-966bf7f44-px48p   1/1     Running             0          0s</span><br><span class="line">pc-deployment-c848d767-8rbzt    0/1     Terminating         0          34m</span><br><span class="line"></span><br><span class="line">pc-deployment-966bf7f44-dkmqp   0/1     Pending             0          0s</span><br><span class="line">pc-deployment-966bf7f44-dkmqp   0/1     ContainerCreating   0          0s</span><br><span class="line">pc-deployment-966bf7f44-dkmqp   1/1     Running             0          2s</span><br><span class="line">pc-deployment-c848d767-rrqcn    0/1     Terminating         0          34m</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> è‡³æ­¤ï¼Œæ–°ç‰ˆæœ¬çš„podåˆ›å»ºå®Œæ¯•ï¼Œå°±ç‰ˆæœ¬çš„podé”€æ¯å®Œæ¯•</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¸­é—´è¿‡ç¨‹æ˜¯æ»šåŠ¨è¿›è¡Œçš„ï¼Œä¹Ÿå°±æ˜¯è¾¹é”€æ¯è¾¹åˆ›å»º</span></span><br></pre></td></tr></table></figure></div>

<p>æ»šåŠ¨æ›´æ–°çš„è¿‡ç¨‹ï¼š</p>
<p><img src="/2022/06/09/uncatalog/cl46zbaye000q7or7bx6mhrl3/image-20200416140251491.png" alt="img"></p>
<p>é•œåƒæ›´æ–°ä¸­rsçš„å˜åŒ–</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹rs,å‘ç°åŸæ¥çš„rsçš„ä¾æ—§å­˜åœ¨ï¼Œåªæ˜¯podæ•°é‡å˜ä¸ºäº†0ï¼Œè€Œååˆæ–°äº§ç”Ÿäº†ä¸€ä¸ªrsï¼Œpodæ•°é‡ä¸º4</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å…¶å®è¿™å°±æ˜¯deploymentèƒ½å¤Ÿè¿›è¡Œç‰ˆæœ¬å›é€€çš„å¥¥å¦™æ‰€åœ¨ï¼Œåé¢ä¼šè¯¦ç»†è§£é‡Š</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl get rs -n dev</span><br><span class="line">NAME                       DESIRED   CURRENT   READY   AGE</span><br><span class="line">pc-deployment-6696798b78   0         0         0       7m37s</span><br><span class="line">pc-deployment-6696798b11   0         0         0       5m37s</span><br><span class="line">pc-deployment-c848d76789   4         4         4       72s</span><br></pre></td></tr></table></figure></div>

<h5 id="6-3-3-ç‰ˆæœ¬å›é€€"><a href="#6-3-3-ç‰ˆæœ¬å›é€€" class="headerlink" title="6.3.3 ç‰ˆæœ¬å›é€€"></a>6.3.3 ç‰ˆæœ¬å›é€€</h5><p>deploymentæ”¯æŒç‰ˆæœ¬å‡çº§è¿‡ç¨‹ä¸­çš„æš‚åœã€ç»§ç»­åŠŸèƒ½ä»¥åŠç‰ˆæœ¬å›é€€ç­‰è¯¸å¤šåŠŸèƒ½ï¼Œä¸‹é¢å…·ä½“æ¥çœ‹.</p>
<p>kubectl rolloutï¼š ç‰ˆæœ¬å‡çº§ç›¸å…³åŠŸèƒ½ï¼Œæ”¯æŒä¸‹é¢çš„é€‰é¡¹ï¼š</p>
<ul>
<li>status    æ˜¾ç¤ºå½“å‰å‡çº§çŠ¶æ€</li>
<li>history   æ˜¾ç¤º å‡çº§å†å²è®°å½•</li>
<li>pause    æš‚åœç‰ˆæœ¬å‡çº§è¿‡ç¨‹</li>
<li>resume   ç»§ç»­å·²ç»æš‚åœçš„ç‰ˆæœ¬å‡çº§è¿‡ç¨‹</li>
<li>restart    é‡å¯ç‰ˆæœ¬å‡çº§è¿‡ç¨‹</li>
<li>undo å›æ»šåˆ°ä¸Šä¸€çº§ç‰ˆæœ¬ï¼ˆå¯ä»¥ä½¿ç”¨â€“to-revisionå›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬ï¼‰</li>
</ul>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹å½“å‰å‡çº§ç‰ˆæœ¬çš„çŠ¶æ€</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl rollout status deploy pc-deployment -n dev</span><br><span class="line">deployment &quot;pc-deployment&quot; successfully rolled out</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹å‡çº§å†å²è®°å½•</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl rollout history deploy pc-deployment -n dev</span><br><span class="line">deployment.apps/pc-deployment</span><br><span class="line">REVISION  CHANGE-CAUSE</span><br><span class="line">1         kubectl create --filename=pc-deployment.yaml --record=true</span><br><span class="line">2         kubectl create --filename=pc-deployment.yaml --record=true</span><br><span class="line">3         kubectl create --filename=pc-deployment.yaml --record=true</span><br><span class="line"><span class="meta">#</span><span class="bash"> å¯ä»¥å‘ç°æœ‰ä¸‰æ¬¡ç‰ˆæœ¬è®°å½•ï¼Œè¯´æ˜å®Œæˆè¿‡ä¸¤æ¬¡å‡çº§</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ç‰ˆæœ¬å›æ»š</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> è¿™é‡Œç›´æ¥ä½¿ç”¨--to-revision=1å›æ»šåˆ°äº†1ç‰ˆæœ¬ï¼Œ å¦‚æœçœç•¥è¿™ä¸ªé€‰é¡¹ï¼Œå°±æ˜¯å›é€€åˆ°ä¸Šä¸ªç‰ˆæœ¬ï¼Œå°±æ˜¯2ç‰ˆæœ¬</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl rollout undo deployment pc-deployment --to-revision=1 -n dev</span><br><span class="line">deployment.apps/pc-deployment rolled back</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹å‘ç°ï¼Œé€šè¿‡nginxé•œåƒç‰ˆæœ¬å¯ä»¥å‘ç°åˆ°äº†ç¬¬ä¸€ç‰ˆ</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl get deploy -n dev -o wide</span><br><span class="line">NAME            READY   UP-TO-DATE   AVAILABLE   AGE   CONTAINERS   IMAGES         </span><br><span class="line">pc-deployment   4/4     4            4           74m   nginx        nginx:1.17.1   </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹rsï¼Œå‘ç°ç¬¬ä¸€ä¸ªrsä¸­æœ‰4ä¸ªpodè¿è¡Œï¼Œåé¢ä¸¤ä¸ªç‰ˆæœ¬çš„rsä¸­podä¸ºè¿è¡Œ</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å…¶å®deploymentä¹‹æ‰€ä»¥å¯æ˜¯å®ç°ç‰ˆæœ¬çš„å›æ»šï¼Œå°±æ˜¯é€šè¿‡è®°å½•ä¸‹å†å²rsæ¥å®ç°çš„ï¼Œ</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¸€æ—¦æƒ³å›æ»šåˆ°å“ªä¸ªç‰ˆæœ¬ï¼Œåªéœ€è¦å°†å½“å‰ç‰ˆæœ¬podæ•°é‡é™ä¸º0ï¼Œç„¶åå°†å›æ»šç‰ˆæœ¬çš„podæå‡ä¸ºç›®æ ‡æ•°é‡å°±å¯ä»¥äº†</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl get rs -n dev</span><br><span class="line">NAME                       DESIRED   CURRENT   READY   AGE</span><br><span class="line">pc-deployment-6696798b78   4         4         4       78m</span><br><span class="line">pc-deployment-966bf7f44    0         0         0       37m</span><br><span class="line">pc-deployment-c848d767     0         0         0       71m</span><br></pre></td></tr></table></figure></div>

<h5 id="6-3-4-é‡‘ä¸é›€å‘å¸ƒ"><a href="#6-3-4-é‡‘ä¸é›€å‘å¸ƒ" class="headerlink" title="6.3.4 é‡‘ä¸é›€å‘å¸ƒ"></a>6.3.4 é‡‘ä¸é›€å‘å¸ƒ</h5><p>Deploymentæ§åˆ¶å™¨æ”¯æŒæ§åˆ¶æ›´æ–°è¿‡ç¨‹ä¸­çš„æ§åˆ¶ï¼Œå¦‚â€œæš‚åœ(pause)â€æˆ–â€œç»§ç»­(resume)â€æ›´æ–°æ“ä½œã€‚</p>
<p>æ¯”å¦‚æœ‰ä¸€æ‰¹æ–°çš„Podèµ„æºåˆ›å»ºå®Œæˆåç«‹å³æš‚åœæ›´æ–°è¿‡ç¨‹ï¼Œæ­¤æ—¶ï¼Œä»…å­˜åœ¨ä¸€éƒ¨åˆ†æ–°ç‰ˆæœ¬çš„åº”ç”¨ï¼Œä¸»ä½“éƒ¨åˆ†è¿˜æ˜¯æ—§çš„ç‰ˆæœ¬ã€‚ç„¶åï¼Œå†ç­›é€‰ä¸€å°éƒ¨åˆ†çš„ç”¨æˆ·è¯·æ±‚è·¯ç”±åˆ°æ–°ç‰ˆæœ¬çš„Podåº”ç”¨ï¼Œç»§ç»­è§‚å¯Ÿèƒ½å¦ç¨³å®šåœ°æŒ‰æœŸæœ›çš„æ–¹å¼è¿è¡Œã€‚ç¡®å®šæ²¡é—®é¢˜ä¹‹åå†ç»§ç»­å®Œæˆä½™ä¸‹çš„Podèµ„æºæ»šåŠ¨æ›´æ–°ï¼Œå¦åˆ™ç«‹å³å›æ»šæ›´æ–°æ“ä½œã€‚è¿™å°±æ˜¯æ‰€è°“çš„é‡‘ä¸é›€å‘å¸ƒã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æ›´æ–°deploymentçš„ç‰ˆæœ¬ï¼Œå¹¶é…ç½®æš‚åœdeployment</span></span><br><span class="line">[root@k8s-master01 ~]#  kubectl set image deploy pc-deployment nginx=nginx:1.17.4 -n dev &amp;&amp; kubectl rollout pause deployment pc-deployment  -n dev</span><br><span class="line">deployment.apps/pc-deployment image updated</span><br><span class="line">deployment.apps/pc-deployment paused</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">è§‚å¯Ÿæ›´æ–°çŠ¶æ€</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl rollout status deploy pc-deployment -n devã€€</span><br><span class="line">Waiting for deployment &quot;pc-deployment&quot; rollout to finish: 2 out of 4 new replicas have been updated...</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ç›‘æ§æ›´æ–°çš„è¿‡ç¨‹ï¼Œå¯ä»¥çœ‹åˆ°å·²ç»æ–°å¢äº†ä¸€ä¸ªèµ„æºï¼Œä½†æ˜¯å¹¶æœªæŒ‰ç…§é¢„æœŸçš„çŠ¶æ€å»åˆ é™¤ä¸€ä¸ªæ—§çš„èµ„æºï¼Œå°±æ˜¯å› ä¸ºä½¿ç”¨äº†pauseæš‚åœå‘½ä»¤</span></span><br><span class="line"></span><br><span class="line">[root@k8s-master01 ~]# kubectl get rs -n dev -o wide</span><br><span class="line">NAME                       DESIRED   CURRENT   READY   AGE     CONTAINERS   IMAGES         </span><br><span class="line">pc-deployment-5d89bdfbf9   3         3         3       19m     nginx        nginx:1.17.1   </span><br><span class="line">pc-deployment-675d469f8b   0         0         0       14m     nginx        nginx:1.17.2   </span><br><span class="line">pc-deployment-6c9f56fcfb   2         2         2       3m16s   nginx        nginx:1.17.4   </span><br><span class="line">[root@k8s-master01 ~]# kubectl get pods -n dev</span><br><span class="line">NAME                             READY   STATUS    RESTARTS   AGE</span><br><span class="line">pc-deployment-5d89bdfbf9-rj8sq   1/1     Running   0          7m33s</span><br><span class="line">pc-deployment-5d89bdfbf9-ttwgg   1/1     Running   0          7m35s</span><br><span class="line">pc-deployment-5d89bdfbf9-v4wvc   1/1     Running   0          7m34s</span><br><span class="line">pc-deployment-6c9f56fcfb-996rt   1/1     Running   0          3m31s</span><br><span class="line">pc-deployment-6c9f56fcfb-j2gtj   1/1     Running   0          3m31s</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ç¡®ä¿æ›´æ–°çš„podæ²¡é—®é¢˜äº†ï¼Œç»§ç»­æ›´æ–°</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl rollout resume deploy pc-deployment -n dev</span><br><span class="line">deployment.apps/pc-deployment resumed</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹æœ€åçš„æ›´æ–°æƒ…å†µ</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl get rs -n dev -o wide</span><br><span class="line">NAME                       DESIRED   CURRENT   READY   AGE     CONTAINERS   IMAGES         </span><br><span class="line">pc-deployment-5d89bdfbf9   0         0         0       21m     nginx        nginx:1.17.1   </span><br><span class="line">pc-deployment-675d469f8b   0         0         0       16m     nginx        nginx:1.17.2   </span><br><span class="line">pc-deployment-6c9f56fcfb   4         4         4       5m11s   nginx        nginx:1.17.4   </span><br><span class="line"></span><br><span class="line">[root@k8s-master01 ~]# kubectl get pods -n dev</span><br><span class="line">NAME                             READY   STATUS    RESTARTS   AGE</span><br><span class="line">pc-deployment-6c9f56fcfb-7bfwh   1/1     Running   0          37s</span><br><span class="line">pc-deployment-6c9f56fcfb-996rt   1/1     Running   0          5m27s</span><br><span class="line">pc-deployment-6c9f56fcfb-j2gtj   1/1     Running   0          5m27s</span><br><span class="line">pc-deployment-6c9f56fcfb-rf84v   1/1     Running   0          37s</span><br></pre></td></tr></table></figure></div>

<p><strong>åˆ é™¤Deployment</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åˆ é™¤deploymentï¼Œå…¶ä¸‹çš„rså’Œpodä¹Ÿå°†è¢«åˆ é™¤</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl delete -f pc-deployment.yaml</span><br><span class="line">deployment.apps &quot;pc-deployment&quot; deleted</span><br></pre></td></tr></table></figure></div>

<h4 id="6-4-Horizontal-Pod-Autoscaler-HPA"><a href="#6-4-Horizontal-Pod-Autoscaler-HPA" class="headerlink" title="6.4 Horizontal Pod Autoscaler(HPA)"></a>6.4 Horizontal Pod Autoscaler(HPA)</h4><p>åœ¨å‰é¢çš„è¯¾ç¨‹ä¸­ï¼Œæˆ‘ä»¬å·²ç»å¯ä»¥å®ç°é€šè¿‡æ‰‹å·¥æ‰§è¡Œ<code>kubectl scale</code>å‘½ä»¤å®ç°Podæ‰©å®¹æˆ–ç¼©å®¹ï¼Œä½†æ˜¯è¿™æ˜¾ç„¶ä¸ç¬¦åˆKubernetesçš„å®šä½ç›®æ ‡â€“è‡ªåŠ¨åŒ–ã€æ™ºèƒ½åŒ–ã€‚ KubernetesæœŸæœ›å¯ä»¥å®ç°é€šè¿‡ç›‘æµ‹Podçš„ä½¿ç”¨æƒ…å†µï¼Œå®ç°podæ•°é‡çš„è‡ªåŠ¨è°ƒæ•´ï¼Œäºæ˜¯å°±äº§ç”Ÿäº†Horizontal Pod Autoscalerï¼ˆHPAï¼‰è¿™ç§æ§åˆ¶å™¨ã€‚</p>
<p>HPAå¯ä»¥è·å–æ¯ä¸ªPodåˆ©ç”¨ç‡ï¼Œç„¶åå’ŒHPAä¸­å®šä¹‰çš„æŒ‡æ ‡è¿›è¡Œå¯¹æ¯”ï¼ŒåŒæ—¶è®¡ç®—å‡ºéœ€è¦ä¼¸ç¼©çš„å…·ä½“å€¼ï¼Œæœ€åå®ç°Podçš„æ•°é‡çš„è°ƒæ•´ã€‚å…¶å®HPAä¸ä¹‹å‰çš„Deploymentä¸€æ ·ï¼Œä¹Ÿå±äºä¸€ç§Kubernetesèµ„æºå¯¹è±¡ï¼Œå®ƒé€šè¿‡è¿½è¸ªåˆ†æRCæ§åˆ¶çš„æ‰€æœ‰ç›®æ ‡Podçš„è´Ÿè½½å˜åŒ–æƒ…å†µï¼Œæ¥ç¡®å®šæ˜¯å¦éœ€è¦é’ˆå¯¹æ€§åœ°è°ƒæ•´ç›®æ ‡Podçš„å‰¯æœ¬æ•°ï¼Œè¿™æ˜¯HPAçš„å®ç°åŸç†ã€‚</p>
<p><img src="/2022/06/09/uncatalog/cl46zbaye000q7or7bx6mhrl3/image-20200608155858271.png" alt="img"></p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥åšä¸€ä¸ªå®éªŒ</p>
<h5 id="6-4-1-å®‰è£…metrics-server"><a href="#6-4-1-å®‰è£…metrics-server" class="headerlink" title="6.4.1 å®‰è£…metrics-server"></a>6.4.1 å®‰è£…metrics-server</h5><p>metrics-serverå¯ä»¥ç”¨æ¥æ”¶é›†é›†ç¾¤ä¸­çš„èµ„æºä½¿ç”¨æƒ…å†µ</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å®‰è£…git</span></span><br><span class="line">[root@k8s-master01 ~]# yum install git -y</span><br><span class="line"><span class="meta">#</span><span class="bash"> è·å–metrics-server, æ³¨æ„ä½¿ç”¨çš„ç‰ˆæœ¬</span></span><br><span class="line">[root@k8s-master01 ~]# git clone -b v0.3.6 https://github.com/kubernetes-incubator/metrics-server</span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¿®æ”¹deployment, æ³¨æ„ä¿®æ”¹çš„æ˜¯é•œåƒå’Œåˆå§‹åŒ–å‚æ•°</span></span><br><span class="line">[root@k8s-master01 ~]# cd /root/metrics-server/deploy/1.8+/</span><br><span class="line">[root@k8s-master01 1.8+]# vim metrics-server-deployment.yaml</span><br><span class="line">æŒ‰å›¾ä¸­æ·»åŠ ä¸‹é¢é€‰é¡¹</span><br><span class="line">hostNetwork: true</span><br><span class="line">image: registry.cn-hangzhou.aliyuncs.com/google_containers/metrics-server-amd64:v0.3.6</span><br><span class="line">args:</span><br><span class="line">- --kubelet-insecure-tls</span><br><span class="line">- --kubelet-preferred-address-types=InternalIP,Hostname,InternalDNS,ExternalDNS,ExternalIP</span><br></pre></td></tr></table></figure></div>

<p><img src="/2022/06/09/uncatalog/cl46zbaye000q7or7bx6mhrl3/image-20200608163326496.png" alt="image-20200608163326496"></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å®‰è£…metrics-server</span></span><br><span class="line">[root@k8s-master01 1.8+]# kubectl apply -f ./</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹podè¿è¡Œæƒ…å†µ</span></span><br><span class="line">[root@k8s-master01 1.8+]# kubectl get pod -n kube-system</span><br><span class="line">metrics-server-6b976979db-2xwbj   1/1     Running   0          90s</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä½¿ç”¨kubectl top node æŸ¥çœ‹èµ„æºä½¿ç”¨æƒ…å†µ</span></span><br><span class="line">[root@k8s-master01 1.8+]# kubectl top node</span><br><span class="line">NAME           CPU(cores)   CPU%   MEMORY(bytes)   MEMORY%</span><br><span class="line">k8s-master01   289m         14%    1582Mi          54%       </span><br><span class="line">k8s-node01     81m          4%     1195Mi          40%       </span><br><span class="line">k8s-node02     72m          3%     1211Mi          41%  </span><br><span class="line">[root@k8s-master01 1.8+]# kubectl top pod -n kube-system</span><br><span class="line">NAME                              CPU(cores)   MEMORY(bytes)</span><br><span class="line">coredns-6955765f44-7ptsb          3m           9Mi</span><br><span class="line">coredns-6955765f44-vcwr5          3m           8Mi</span><br><span class="line">etcd-master                       14m          145Mi</span><br><span class="line">...</span><br><span class="line"><span class="meta">#</span><span class="bash"> è‡³æ­¤,metrics-serverå®‰è£…å®Œæˆ</span></span><br></pre></td></tr></table></figure></div>

<h5 id="6-4-2-å‡†å¤‡deploymentå’Œservie"><a href="#6-4-2-å‡†å¤‡deploymentå’Œservie" class="headerlink" title="6.4.2 å‡†å¤‡deploymentå’Œservie"></a>6.4.2 å‡†å¤‡deploymentå’Œservie</h5><p>åˆ›å»ºpc-hpa-pod.yamlæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">strategy:</span> <span class="comment"># ç­–ç•¥</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">RollingUpdate</span> <span class="comment"># æ»šåŠ¨æ›´æ–°ç­–ç•¥</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">nginx-pod</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">nginx-pod</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">nginx:1.17.1</span></span><br><span class="line">        <span class="attr">resources:</span> <span class="comment"># èµ„æºé…é¢</span></span><br><span class="line">          <span class="attr">limits:</span>  <span class="comment"># é™åˆ¶èµ„æºï¼ˆä¸Šé™ï¼‰</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">&quot;1&quot;</span> <span class="comment"># CPUé™åˆ¶ï¼Œå•ä½æ˜¯coreæ•°</span></span><br><span class="line">          <span class="attr">requests:</span> <span class="comment"># è¯·æ±‚èµ„æºï¼ˆä¸‹é™ï¼‰</span></span><br><span class="line">            <span class="attr">cpu:</span> <span class="string">&quot;100m&quot;</span>  <span class="comment"># CPUé™åˆ¶ï¼Œå•ä½æ˜¯coreæ•°</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åˆ›å»ºdeployment</span></span><br><span class="line">[root@k8s-master01 1.8+]# kubectl run nginx --image=nginx:1.17.1 --requests=cpu=100m -n dev</span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆ›å»ºservice</span></span><br><span class="line">[root@k8s-master01 1.8+]# kubectl expose deployment nginx --type=NodePort --port=80 -n dev</span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹</span></span><br><span class="line">[root@k8s-master01 1.8+]# kubectl get deployment,pod,svc -n dev</span><br><span class="line">NAME                    READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">deployment.apps/nginx   1/1     1            1           47s</span><br><span class="line"></span><br><span class="line">NAME                         READY   STATUS    RESTARTS   AGE</span><br><span class="line">pod/nginx-7df9756ccc-bh8dr   1/1     Running   0          47s</span><br><span class="line"></span><br><span class="line">NAME            TYPE       CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE</span><br><span class="line">service/nginx   NodePort   10.101.18.29   &lt;none&gt;        80:31830/TCP   35s</span><br></pre></td></tr></table></figure></div>

<h5 id="6-4-3-éƒ¨ç½²HPA"><a href="#6-4-3-éƒ¨ç½²HPA" class="headerlink" title="6.4.3 éƒ¨ç½²HPA"></a>6.4.3 éƒ¨ç½²HPA</h5><p>åˆ›å»ºpc-hpa.yamlæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">autoscaling/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">HorizontalPodAutoscaler</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pc-hpa</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">minReplicas:</span> <span class="number">1</span>  <span class="comment">#æœ€å°podæ•°é‡</span></span><br><span class="line">  <span class="attr">maxReplicas:</span> <span class="number">10</span> <span class="comment">#æœ€å¤§podæ•°é‡</span></span><br><span class="line">  <span class="attr">targetCPUUtilizationPercentage:</span> <span class="number">3</span> <span class="comment"># CPUä½¿ç”¨ç‡æŒ‡æ ‡</span></span><br><span class="line">  <span class="attr">scaleTargetRef:</span>   <span class="comment"># æŒ‡å®šè¦æ§åˆ¶çš„nginxä¿¡æ¯</span></span><br><span class="line">    <span class="attr">apiVersion:</span>  <span class="string">/v1</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">Deployment</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">nginx</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åˆ›å»ºhpa</span></span><br><span class="line">[root@k8s-master01 1.8+]# kubectl create -f pc-hpa.yaml</span><br><span class="line">horizontalpodautoscaler.autoscaling/pc-hpa created</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹hpa</span></span><br><span class="line">    [root@k8s-master01 1.8+]# kubectl get hpa -n dev</span><br><span class="line">NAME     REFERENCE          TARGETS   MINPODS   MAXPODS   REPLICAS   AGE</span><br><span class="line">pc-hpa   Deployment/nginx   0%/3%     1         10        1          62s</span><br></pre></td></tr></table></figure></div>

<h5 id="6-4-4-æµ‹è¯•"><a href="#6-4-4-æµ‹è¯•" class="headerlink" title="6.4.4 æµ‹è¯•"></a>6.4.4 æµ‹è¯•</h5><p>ä½¿ç”¨å‹æµ‹å·¥å…·å¯¹serviceåœ°å€<code>192.168.5.4:31830</code>è¿›è¡Œå‹æµ‹ï¼Œç„¶åé€šè¿‡æ§åˆ¶å°æŸ¥çœ‹hpaå’Œpodçš„å˜åŒ–</p>
<p>hpaå˜åŒ–</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">[root@k8s-master01 ~]# kubectl get hpa -n dev -w</span><br><span class="line">NAME   REFERENCE      TARGETS  MINPODS  MAXPODS  REPLICAS  AGE</span><br><span class="line">pc-hpa  Deployment/nginx  0%/3%   1     10     1      4m11s</span><br><span class="line">pc-hpa  Deployment/nginx  0%/3%   1     10     1      5m19s</span><br><span class="line">pc-hpa  Deployment/nginx  22%/3%   1     10     1      6m50s</span><br><span class="line">pc-hpa  Deployment/nginx  22%/3%   1     10     4      7m5s</span><br><span class="line">pc-hpa  Deployment/nginx  22%/3%   1     10     8      7m21s</span><br><span class="line">pc-hpa  Deployment/nginx  6%/3%   1     10     8      7m51s</span><br><span class="line">pc-hpa  Deployment/nginx  0%/3%   1     10     8      9m6s</span><br><span class="line">pc-hpa  Deployment/nginx  0%/3%   1     10     8      13m</span><br><span class="line">pc-hpa  Deployment/nginx  0%/3%   1     10     1      14m</span><br></pre></td></tr></table></figure></div>

<p>deploymentå˜åŒ–</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">[root@k8s-master01 ~]# kubectl get deployment -n dev -w</span><br><span class="line">NAME    READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">nginx   1/1     1            1           11m</span><br><span class="line">nginx   1/4     1            1           13m</span><br><span class="line">nginx   1/4     1            1           13m</span><br><span class="line">nginx   1/4     1            1           13m</span><br><span class="line">nginx   1/4     4            1           13m</span><br><span class="line">nginx   1/8     4            1           14m</span><br><span class="line">nginx   1/8     4            1           14m</span><br><span class="line">nginx   1/8     4            1           14m</span><br><span class="line">nginx   1/8     8            1           14m</span><br><span class="line">nginx   2/8     8            2           14m</span><br><span class="line">nginx   3/8     8            3           14m</span><br><span class="line">nginx   4/8     8            4           14m</span><br><span class="line">nginx   5/8     8            5           14m</span><br><span class="line">nginx   6/8     8            6           14m</span><br><span class="line">nginx   7/8     8            7           14m</span><br><span class="line">nginx   8/8     8            8           15m</span><br><span class="line">nginx   8/1     8            8           20m</span><br><span class="line">nginx   8/1     8            8           20m</span><br><span class="line">nginx   1/1     1            1           20m</span><br></pre></td></tr></table></figure></div>

<p>podå˜åŒ–</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="code"><pre><span class="line">[root@k8s-master01 ~]# kubectl get pods -n dev -w</span><br><span class="line">NAME                     READY   STATUS    RESTARTS   AGE</span><br><span class="line">nginx-7df9756ccc-bh8dr   1&#x2F;1     Running   0          11m</span><br><span class="line">nginx-7df9756ccc-cpgrv   0&#x2F;1     Pending   0          0s</span><br><span class="line">nginx-7df9756ccc-8zhwk   0&#x2F;1     Pending   0          0s</span><br><span class="line">nginx-7df9756ccc-rr9bn   0&#x2F;1     Pending   0          0s</span><br><span class="line">nginx-7df9756ccc-cpgrv   0&#x2F;1     ContainerCreating   0          0s</span><br><span class="line">nginx-7df9756ccc-8zhwk   0&#x2F;1     ContainerCreating   0          0s</span><br><span class="line">nginx-7df9756ccc-rr9bn   0&#x2F;1     ContainerCreating   0          0s</span><br><span class="line">nginx-7df9756ccc-m9gsj   0&#x2F;1     Pending             0          0s</span><br><span class="line">nginx-7df9756ccc-g56qb   0&#x2F;1     Pending             0          0s</span><br><span class="line">nginx-7df9756ccc-sl9c6   0&#x2F;1     Pending             0          0s</span><br><span class="line">nginx-7df9756ccc-fgst7   0&#x2F;1     Pending             0          0s</span><br><span class="line">nginx-7df9756ccc-g56qb   0&#x2F;1     ContainerCreating   0          0s</span><br><span class="line">nginx-7df9756ccc-m9gsj   0&#x2F;1     ContainerCreating   0          0s</span><br><span class="line">nginx-7df9756ccc-sl9c6   0&#x2F;1     ContainerCreating   0          0s</span><br><span class="line">nginx-7df9756ccc-fgst7   0&#x2F;1     ContainerCreating   0          0s</span><br><span class="line">nginx-7df9756ccc-8zhwk   1&#x2F;1     Running             0          19s</span><br><span class="line">nginx-7df9756ccc-rr9bn   1&#x2F;1     Running             0          30s</span><br><span class="line">nginx-7df9756ccc-m9gsj   1&#x2F;1     Running             0          21s</span><br><span class="line">nginx-7df9756ccc-cpgrv   1&#x2F;1     Running             0          47s</span><br><span class="line">nginx-7df9756ccc-sl9c6   1&#x2F;1     Running             0          33s</span><br><span class="line">nginx-7df9756ccc-g56qb   1&#x2F;1     Running             0          48s</span><br><span class="line">nginx-7df9756ccc-fgst7   1&#x2F;1     Running             0          66s</span><br><span class="line">nginx-7df9756ccc-fgst7   1&#x2F;1     Terminating         0          6m50s</span><br><span class="line">nginx-7df9756ccc-8zhwk   1&#x2F;1     Terminating         0          7m5s</span><br><span class="line">nginx-7df9756ccc-cpgrv   1&#x2F;1     Terminating         0          7m5s</span><br><span class="line">nginx-7df9756ccc-g56qb   1&#x2F;1     Terminating         0          6m50s</span><br><span class="line">nginx-7df9756ccc-rr9bn   1&#x2F;1     Terminating         0          7m5s</span><br><span class="line">nginx-7df9756ccc-m9gsj   1&#x2F;1     Terminating         0          6m50s</span><br><span class="line">nginx-7df9756ccc-sl9c6   1&#x2F;1     Terminating         0          6m50s</span><br></pre></td></tr></table></figure></div>

<h4 id="6-5-DaemonSet-DS"><a href="#6-5-DaemonSet-DS" class="headerlink" title="6.5 DaemonSet(DS)"></a>6.5 DaemonSet(DS)</h4><p>DaemonSetç±»å‹çš„æ§åˆ¶å™¨å¯ä»¥ä¿è¯åœ¨é›†ç¾¤ä¸­çš„æ¯ä¸€å°ï¼ˆæˆ–æŒ‡å®šï¼‰èŠ‚ç‚¹ä¸Šéƒ½è¿è¡Œä¸€ä¸ªå‰¯æœ¬ã€‚ä¸€èˆ¬é€‚ç”¨äºæ—¥å¿—æ”¶é›†ã€èŠ‚ç‚¹ç›‘æ§ç­‰åœºæ™¯ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä¸€ä¸ªPodæä¾›çš„åŠŸèƒ½æ˜¯èŠ‚ç‚¹çº§åˆ«çš„ï¼ˆæ¯ä¸ªèŠ‚ç‚¹éƒ½éœ€è¦ä¸”åªéœ€è¦ä¸€ä¸ªï¼‰ï¼Œé‚£ä¹ˆè¿™ç±»Podå°±é€‚åˆä½¿ç”¨DaemonSetç±»å‹çš„æ§åˆ¶å™¨åˆ›å»ºã€‚</p>
<p><img src="/2022/06/09/uncatalog/cl46zbaye000q7or7bx6mhrl3/image-20200612010223537.png" alt="img"></p>
<p>DaemonSetæ§åˆ¶å™¨çš„ç‰¹ç‚¹ï¼š</p>
<ul>
<li>æ¯å½“å‘é›†ç¾¤ä¸­æ·»åŠ ä¸€ä¸ªèŠ‚ç‚¹æ—¶ï¼ŒæŒ‡å®šçš„ Pod å‰¯æœ¬ä¹Ÿå°†æ·»åŠ åˆ°è¯¥èŠ‚ç‚¹ä¸Š</li>
<li>å½“èŠ‚ç‚¹ä»é›†ç¾¤ä¸­ç§»é™¤æ—¶ï¼ŒPod ä¹Ÿå°±è¢«åƒåœ¾å›æ”¶äº†</li>
</ul>
<p>ä¸‹é¢å…ˆæ¥çœ‹ä¸‹DaemonSetçš„èµ„æºæ¸…å•æ–‡ä»¶</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span> <span class="comment"># ç‰ˆæœ¬å·</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">DaemonSet</span> <span class="comment"># ç±»å‹       </span></span><br><span class="line"><span class="attr">metadata:</span> <span class="comment"># å…ƒæ•°æ®</span></span><br><span class="line">  <span class="attr">name:</span> <span class="comment"># rsåç§° </span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="comment"># æ‰€å±å‘½åç©ºé—´ </span></span><br><span class="line">  <span class="attr">labels:</span> <span class="comment">#æ ‡ç­¾</span></span><br><span class="line">    <span class="attr">controller:</span> <span class="string">daemonset</span></span><br><span class="line"><span class="attr">spec:</span> <span class="comment"># è¯¦æƒ…æè¿°</span></span><br><span class="line">  <span class="attr">revisionHistoryLimit:</span> <span class="number">3</span> <span class="comment"># ä¿ç•™å†å²ç‰ˆæœ¬</span></span><br><span class="line">  <span class="attr">updateStrategy:</span> <span class="comment"># æ›´æ–°ç­–ç•¥</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">RollingUpdate</span> <span class="comment"># æ»šåŠ¨æ›´æ–°ç­–ç•¥</span></span><br><span class="line">    <span class="attr">rollingUpdate:</span> <span class="comment"># æ»šåŠ¨æ›´æ–°</span></span><br><span class="line">      <span class="attr">maxUnavailable:</span> <span class="number">1</span> <span class="comment"># æœ€å¤§ä¸å¯ç”¨çŠ¶æ€çš„ Pod çš„æœ€å¤§å€¼ï¼Œå¯ä»¥ä¸ºç™¾åˆ†æ¯”ï¼Œä¹Ÿå¯ä»¥ä¸ºæ•´æ•°</span></span><br><span class="line">  <span class="attr">selector:</span> <span class="comment"># é€‰æ‹©å™¨ï¼Œé€šè¿‡å®ƒæŒ‡å®šè¯¥æ§åˆ¶å™¨ç®¡ç†å“ªäº›pod</span></span><br><span class="line">    <span class="attr">matchLabels:</span>      <span class="comment"># LabelsåŒ¹é…è§„åˆ™</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">nginx-pod</span></span><br><span class="line">    <span class="attr">matchExpressions:</span> <span class="comment"># ExpressionsåŒ¹é…è§„åˆ™</span></span><br><span class="line">      <span class="bullet">-</span> &#123;<span class="attr">key:</span> <span class="string">app</span>, <span class="attr">operator:</span> <span class="string">In</span>, <span class="attr">values:</span> [<span class="string">nginx-pod</span>]&#125;</span><br><span class="line">  <span class="attr">template:</span> <span class="comment"># æ¨¡æ¿ï¼Œå½“å‰¯æœ¬æ•°é‡ä¸è¶³æ—¶ï¼Œä¼šæ ¹æ®ä¸‹é¢çš„æ¨¡æ¿åˆ›å»ºpodå‰¯æœ¬</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">nginx-pod</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">nginx:1.17.1</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">containerPort:</span> <span class="number">80</span></span><br></pre></td></tr></table></figure></div>

<p>åˆ›å»ºpc-daemonset.yamlï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">DaemonSet</span>      </span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pc-daemonset</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">spec:</span> </span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">nginx-pod</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">nginx-pod</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">nginx:1.17.1</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åˆ›å»ºdaemonset</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl create -f  pc-daemonset.yaml</span><br><span class="line">daemonset.apps/pc-daemonset created</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹daemonset</span></span><br><span class="line">[root@k8s-master01 ~]#  kubectl get ds -n dev -o wide</span><br><span class="line">NAME        DESIRED  CURRENT  READY  UP-TO-DATE  AVAILABLE   AGE   CONTAINERS   IMAGES         </span><br><span class="line">pc-daemonset   2        2        2      2           2        24s   nginx        nginx:1.17.1   </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹pod,å‘ç°åœ¨æ¯ä¸ªNodeä¸Šéƒ½è¿è¡Œä¸€ä¸ªpod</span></span><br><span class="line">[root@k8s-master01 ~]#  kubectl get pods -n dev -o wide</span><br><span class="line">NAME                 READY   STATUS    RESTARTS   AGE   IP            NODE    </span><br><span class="line">pc-daemonset-9bck8   1/1     Running   0          37s   10.244.1.43   node1     </span><br><span class="line">pc-daemonset-k224w   1/1     Running   0          37s   10.244.2.74   node2      </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆ é™¤daemonset</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl delete -f pc-daemonset.yaml</span><br><span class="line">daemonset.apps &quot;pc-daemonset&quot; deleted</span><br></pre></td></tr></table></figure></div>

<h4 id="6-6-Job"><a href="#6-6-Job" class="headerlink" title="6.6 Job"></a>6.6 Job</h4><p>Jobï¼Œä¸»è¦ç”¨äºè´Ÿè´£**æ‰¹é‡å¤„ç†(ä¸€æ¬¡è¦å¤„ç†æŒ‡å®šæ•°é‡ä»»åŠ¡)<strong>çŸ­æš‚çš„</strong>ä¸€æ¬¡æ€§(æ¯ä¸ªä»»åŠ¡ä»…è¿è¡Œä¸€æ¬¡å°±ç»“æŸ)**ä»»åŠ¡ã€‚Jobç‰¹ç‚¹å¦‚ä¸‹ï¼š</p>
<ul>
<li>å½“Jobåˆ›å»ºçš„podæ‰§è¡ŒæˆåŠŸç»“æŸæ—¶ï¼ŒJobå°†è®°å½•æˆåŠŸç»“æŸçš„podæ•°é‡</li>
<li>å½“æˆåŠŸç»“æŸçš„podè¾¾åˆ°æŒ‡å®šçš„æ•°é‡æ—¶ï¼ŒJobå°†å®Œæˆæ‰§è¡Œ</li>
</ul>
<p><img src="/2022/06/09/uncatalog/cl46zbaye000q7or7bx6mhrl3/image-20200618213054113.png" alt="img"></p>
<p>Jobçš„èµ„æºæ¸…å•æ–‡ä»¶ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">batch/v1</span> <span class="comment"># ç‰ˆæœ¬å·</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Job</span> <span class="comment"># ç±»å‹       </span></span><br><span class="line"><span class="attr">metadata:</span> <span class="comment"># å…ƒæ•°æ®</span></span><br><span class="line">  <span class="attr">name:</span> <span class="comment"># rsåç§° </span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="comment"># æ‰€å±å‘½åç©ºé—´ </span></span><br><span class="line">  <span class="attr">labels:</span> <span class="comment">#æ ‡ç­¾</span></span><br><span class="line">    <span class="attr">controller:</span> <span class="string">job</span></span><br><span class="line"><span class="attr">spec:</span> <span class="comment"># è¯¦æƒ…æè¿°</span></span><br><span class="line">  <span class="attr">completions:</span> <span class="number">1</span> <span class="comment"># æŒ‡å®šjobéœ€è¦æˆåŠŸè¿è¡ŒPodsçš„æ¬¡æ•°ã€‚é»˜è®¤å€¼: 1</span></span><br><span class="line">  <span class="attr">parallelism:</span> <span class="number">1</span> <span class="comment"># æŒ‡å®šjobåœ¨ä»»ä¸€æ—¶åˆ»åº”è¯¥å¹¶å‘è¿è¡ŒPodsçš„æ•°é‡ã€‚é»˜è®¤å€¼: 1</span></span><br><span class="line">  <span class="attr">activeDeadlineSeconds:</span> <span class="number">30</span> <span class="comment"># æŒ‡å®šjobå¯è¿è¡Œçš„æ—¶é—´æœŸé™ï¼Œè¶…è¿‡æ—¶é—´è¿˜æœªç»“æŸï¼Œç³»ç»Ÿå°†ä¼šå°è¯•è¿›è¡Œç»ˆæ­¢ã€‚</span></span><br><span class="line">  <span class="attr">backoffLimit:</span> <span class="number">6</span> <span class="comment"># æŒ‡å®šjobå¤±è´¥åè¿›è¡Œé‡è¯•çš„æ¬¡æ•°ã€‚é»˜è®¤æ˜¯6</span></span><br><span class="line">  <span class="attr">manualSelector:</span> <span class="literal">true</span> <span class="comment"># æ˜¯å¦å¯ä»¥ä½¿ç”¨selectoré€‰æ‹©å™¨é€‰æ‹©podï¼Œé»˜è®¤æ˜¯false</span></span><br><span class="line">  <span class="attr">selector:</span> <span class="comment"># é€‰æ‹©å™¨ï¼Œé€šè¿‡å®ƒæŒ‡å®šè¯¥æ§åˆ¶å™¨ç®¡ç†å“ªäº›pod</span></span><br><span class="line">    <span class="attr">matchLabels:</span>      <span class="comment"># LabelsåŒ¹é…è§„åˆ™</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">counter-pod</span></span><br><span class="line">    <span class="attr">matchExpressions:</span> <span class="comment"># ExpressionsåŒ¹é…è§„åˆ™</span></span><br><span class="line">      <span class="bullet">-</span> &#123;<span class="attr">key:</span> <span class="string">app</span>, <span class="attr">operator:</span> <span class="string">In</span>, <span class="attr">values:</span> [<span class="string">counter-pod</span>]&#125;</span><br><span class="line">  <span class="attr">template:</span> <span class="comment"># æ¨¡æ¿ï¼Œå½“å‰¯æœ¬æ•°é‡ä¸è¶³æ—¶ï¼Œä¼šæ ¹æ®ä¸‹é¢çš„æ¨¡æ¿åˆ›å»ºpodå‰¯æœ¬</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">counter-pod</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">restartPolicy:</span> <span class="string">Never</span> <span class="comment"># é‡å¯ç­–ç•¥åªèƒ½è®¾ç½®ä¸ºNeveræˆ–è€…OnFailure</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">counter</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">busybox:1.30</span></span><br><span class="line">        <span class="attr">command:</span> [<span class="string">&quot;bin/sh&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;for i in 9 8 7 6 5 4 3 2 1; do echo $i;sleep 2;done&quot;</span>]</span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="MARKDOWN"><figure class="iseeu highlight /markdown"><table><tr><td class="code"><pre><span class="line">å…³äºé‡å¯ç­–ç•¥è®¾ç½®çš„è¯´æ˜ï¼š</span><br><span class="line"><span class="code">    å¦‚æœæŒ‡å®šä¸ºOnFailureï¼Œåˆ™jobä¼šåœ¨podå‡ºç°æ•…éšœæ—¶é‡å¯å®¹å™¨ï¼Œè€Œä¸æ˜¯åˆ›å»ºpodï¼Œfailedæ¬¡æ•°ä¸å˜</span></span><br><span class="line"><span class="code">    å¦‚æœæŒ‡å®šä¸ºNeverï¼Œåˆ™jobä¼šåœ¨podå‡ºç°æ•…éšœæ—¶åˆ›å»ºæ–°çš„podï¼Œå¹¶ä¸”æ•…éšœpodä¸ä¼šæ¶ˆå¤±ï¼Œä¹Ÿä¸ä¼šé‡å¯ï¼Œfailedæ¬¡æ•°åŠ 1</span></span><br><span class="line"><span class="code">    å¦‚æœæŒ‡å®šä¸ºAlwaysçš„è¯ï¼Œå°±æ„å‘³ç€ä¸€ç›´é‡å¯ï¼Œæ„å‘³ç€jobä»»åŠ¡ä¼šé‡å¤å»æ‰§è¡Œäº†ï¼Œå½“ç„¶ä¸å¯¹ï¼Œæ‰€ä»¥ä¸èƒ½è®¾ç½®ä¸ºAlways</span></span><br></pre></td></tr></table></figure></div>

<p>åˆ›å»ºpc-job.yamlï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">batch/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Job</span>      </span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pc-job</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">manualSelector:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">matchLabels:</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">counter-pod</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">      <span class="attr">labels:</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">counter-pod</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">restartPolicy:</span> <span class="string">Never</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">counter</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">busybox:1.30</span></span><br><span class="line">        <span class="attr">command:</span> [<span class="string">&quot;bin/sh&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;for i in 9 8 7 6 5 4 3 2 1; do echo $i;sleep 3;done&quot;</span>]</span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åˆ›å»ºjob</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl create -f pc-job.yaml</span><br><span class="line">job.batch/pc-job created</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹job</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl get job -n dev -o wide  -w</span><br><span class="line">NAME     COMPLETIONS   DURATION   AGE   CONTAINERS   IMAGES         SELECTOR</span><br><span class="line">pc-job   0/1           21s        21s   counter      busybox:1.30   app=counter-pod</span><br><span class="line">pc-job   1/1           31s        79s   counter      busybox:1.30   app=counter-pod</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> é€šè¿‡è§‚å¯ŸpodçŠ¶æ€å¯ä»¥çœ‹åˆ°ï¼Œpodåœ¨è¿è¡Œå®Œæ¯•ä»»åŠ¡åï¼Œå°±ä¼šå˜æˆCompletedçŠ¶æ€</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl get pods -n dev -w</span><br><span class="line">NAME           READY   STATUS     RESTARTS      AGE</span><br><span class="line">pc-job-rxg96   1/1     Running     0            29s</span><br><span class="line">pc-job-rxg96   0/1     Completed   0            33s</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ¥ä¸‹æ¥ï¼Œè°ƒæ•´ä¸‹podè¿è¡Œçš„æ€»æ•°é‡å’Œå¹¶è¡Œæ•°é‡ å³ï¼šåœ¨specä¸‹è®¾ç½®ä¸‹é¢ä¸¤ä¸ªé€‰é¡¹</span></span><br><span class="line"><span class="meta">#</span><span class="bash">  completions: 6 <span class="comment"># æŒ‡å®šjobéœ€è¦æˆåŠŸè¿è¡ŒPodsçš„æ¬¡æ•°ä¸º6</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">  parallelism: 3 <span class="comment"># æŒ‡å®šjobå¹¶å‘è¿è¡ŒPodsçš„æ•°é‡ä¸º3</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">  ç„¶åé‡æ–°è¿è¡Œjobï¼Œè§‚å¯Ÿæ•ˆæœï¼Œæ­¤æ—¶ä¼šå‘ç°ï¼Œjobä¼šæ¯æ¬¡è¿è¡Œ3ä¸ªpodï¼Œæ€»å…±æ‰§è¡Œäº†6ä¸ªpod</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl get pods -n dev -w</span><br><span class="line">NAME           READY   STATUS    RESTARTS   AGE</span><br><span class="line">pc-job-684ft   1/1     Running   0          5s</span><br><span class="line">pc-job-jhj49   1/1     Running   0          5s</span><br><span class="line">pc-job-pfcvh   1/1     Running   0          5s</span><br><span class="line">pc-job-684ft   0/1     Completed   0          11s</span><br><span class="line">pc-job-v7rhr   0/1     Pending     0          0s</span><br><span class="line">pc-job-v7rhr   0/1     Pending     0          0s</span><br><span class="line">pc-job-v7rhr   0/1     ContainerCreating   0          0s</span><br><span class="line">pc-job-jhj49   0/1     Completed           0          11s</span><br><span class="line">pc-job-fhwf7   0/1     Pending             0          0s</span><br><span class="line">pc-job-fhwf7   0/1     Pending             0          0s</span><br><span class="line">pc-job-pfcvh   0/1     Completed           0          11s</span><br><span class="line">pc-job-5vg2j   0/1     Pending             0          0s</span><br><span class="line">pc-job-fhwf7   0/1     ContainerCreating   0          0s</span><br><span class="line">pc-job-5vg2j   0/1     Pending             0          0s</span><br><span class="line">pc-job-5vg2j   0/1     ContainerCreating   0          0s</span><br><span class="line">pc-job-fhwf7   1/1     Running             0          2s</span><br><span class="line">pc-job-v7rhr   1/1     Running             0          2s</span><br><span class="line">pc-job-5vg2j   1/1     Running             0          3s</span><br><span class="line">pc-job-fhwf7   0/1     Completed           0          12s</span><br><span class="line">pc-job-v7rhr   0/1     Completed           0          12s</span><br><span class="line">pc-job-5vg2j   0/1     Completed           0          12s</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆ é™¤job</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl delete -f pc-job.yaml</span><br><span class="line">job.batch &quot;pc-job&quot; deleted</span><br></pre></td></tr></table></figure></div>

<h4 id="6-7-CronJob-CJ"><a href="#6-7-CronJob-CJ" class="headerlink" title="6.7 CronJob(CJ)"></a>6.7 CronJob(CJ)</h4><p>CronJobæ§åˆ¶å™¨ä»¥ Jobæ§åˆ¶å™¨èµ„æºä¸ºå…¶ç®¡æ§å¯¹è±¡ï¼Œå¹¶å€ŸåŠ©å®ƒç®¡ç†podèµ„æºå¯¹è±¡ï¼ŒJobæ§åˆ¶å™¨å®šä¹‰çš„ä½œä¸šä»»åŠ¡åœ¨å…¶æ§åˆ¶å™¨èµ„æºåˆ›å»ºä¹‹åä¾¿ä¼šç«‹å³æ‰§è¡Œï¼Œä½†CronJobå¯ä»¥ä»¥ç±»ä¼¼äºLinuxæ“ä½œç³»ç»Ÿçš„å‘¨æœŸæ€§ä»»åŠ¡ä½œä¸šè®¡åˆ’çš„æ–¹å¼æ§åˆ¶å…¶è¿è¡Œ<strong>æ—¶é—´ç‚¹</strong>åŠ<strong>é‡å¤è¿è¡Œ</strong>çš„æ–¹å¼ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>CronJobå¯ä»¥åœ¨ç‰¹å®šçš„æ—¶é—´ç‚¹(åå¤çš„)å»è¿è¡Œjobä»»åŠ¡</strong>ã€‚</p>
<p><img src="/2022/06/09/uncatalog/cl46zbaye000q7or7bx6mhrl3/image-20200618213149531.png" alt="img"></p>
<p>CronJobçš„èµ„æºæ¸…å•æ–‡ä»¶ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">batch/v1beta1</span> <span class="comment"># ç‰ˆæœ¬å·</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CronJob</span> <span class="comment"># ç±»å‹       </span></span><br><span class="line"><span class="attr">metadata:</span> <span class="comment"># å…ƒæ•°æ®</span></span><br><span class="line">  <span class="attr">name:</span> <span class="comment"># rsåç§° </span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="comment"># æ‰€å±å‘½åç©ºé—´ </span></span><br><span class="line">  <span class="attr">labels:</span> <span class="comment">#æ ‡ç­¾</span></span><br><span class="line">    <span class="attr">controller:</span> <span class="string">cronjob</span></span><br><span class="line"><span class="attr">spec:</span> <span class="comment"># è¯¦æƒ…æè¿°</span></span><br><span class="line">  <span class="attr">schedule:</span> <span class="comment"># cronæ ¼å¼çš„ä½œä¸šè°ƒåº¦è¿è¡Œæ—¶é—´ç‚¹,ç”¨äºæ§åˆ¶ä»»åŠ¡åœ¨ä»€ä¹ˆæ—¶é—´æ‰§è¡Œ</span></span><br><span class="line">  <span class="attr">concurrencyPolicy:</span> <span class="comment"># å¹¶å‘æ‰§è¡Œç­–ç•¥ï¼Œç”¨äºå®šä¹‰å‰ä¸€æ¬¡ä½œä¸šè¿è¡Œå°šæœªå®Œæˆæ—¶æ˜¯å¦ä»¥åŠå¦‚ä½•è¿è¡Œåä¸€æ¬¡çš„ä½œä¸š</span></span><br><span class="line">  <span class="attr">failedJobHistoryLimit:</span> <span class="comment"># ä¸ºå¤±è´¥çš„ä»»åŠ¡æ‰§è¡Œä¿ç•™çš„å†å²è®°å½•æ•°ï¼Œé»˜è®¤ä¸º1</span></span><br><span class="line">  <span class="attr">successfulJobHistoryLimit:</span> <span class="comment"># ä¸ºæˆåŠŸçš„ä»»åŠ¡æ‰§è¡Œä¿ç•™çš„å†å²è®°å½•æ•°ï¼Œé»˜è®¤ä¸º3</span></span><br><span class="line">  <span class="attr">startingDeadlineSeconds:</span> <span class="comment"># å¯åŠ¨ä½œä¸šé”™è¯¯çš„è¶…æ—¶æ—¶é•¿</span></span><br><span class="line">  <span class="attr">jobTemplate:</span> <span class="comment"># jobæ§åˆ¶å™¨æ¨¡æ¿ï¼Œç”¨äºä¸ºcronjobæ§åˆ¶å™¨ç”Ÿæˆjobå¯¹è±¡;ä¸‹é¢å…¶å®å°±æ˜¯jobçš„å®šä¹‰</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">completions:</span> <span class="number">1</span></span><br><span class="line">      <span class="attr">parallelism:</span> <span class="number">1</span></span><br><span class="line">      <span class="attr">activeDeadlineSeconds:</span> <span class="number">30</span></span><br><span class="line">      <span class="attr">backoffLimit:</span> <span class="number">6</span></span><br><span class="line">      <span class="attr">manualSelector:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">selector:</span></span><br><span class="line">        <span class="attr">matchLabels:</span></span><br><span class="line">          <span class="attr">app:</span> <span class="string">counter-pod</span></span><br><span class="line">        <span class="attr">matchExpressions:</span> <span class="string">è§„åˆ™</span></span><br><span class="line">          <span class="bullet">-</span> &#123;<span class="attr">key:</span> <span class="string">app</span>, <span class="attr">operator:</span> <span class="string">In</span>, <span class="attr">values:</span> [<span class="string">counter-pod</span>]&#125;</span><br><span class="line">      <span class="attr">template:</span></span><br><span class="line">        <span class="attr">metadata:</span></span><br><span class="line">          <span class="attr">labels:</span></span><br><span class="line">            <span class="attr">app:</span> <span class="string">counter-pod</span></span><br><span class="line">        <span class="attr">spec:</span></span><br><span class="line">          <span class="attr">restartPolicy:</span> <span class="string">Never</span> </span><br><span class="line">          <span class="attr">containers:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">counter</span></span><br><span class="line">            <span class="attr">image:</span> <span class="string">busybox:1.30</span></span><br><span class="line">            <span class="attr">command:</span> [<span class="string">&quot;bin/sh&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;for i in 9 8 7 6 5 4 3 2 1; do echo $i;sleep 20;done&quot;</span>]</span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="MARKDOWN"><figure class="iseeu highlight /markdown"><table><tr><td class="code"><pre><span class="line">éœ€è¦é‡ç‚¹è§£é‡Šçš„å‡ ä¸ªé€‰é¡¹ï¼š</span><br><span class="line">schedule: cronè¡¨è¾¾å¼ï¼Œç”¨äºæŒ‡å®šä»»åŠ¡çš„æ‰§è¡Œæ—¶é—´</span><br><span class="line"><span class="code">    */1    *      *    *     *</span></span><br><span class="line"><span class="code">    &lt;åˆ†é’Ÿ&gt; &lt;å°æ—¶&gt; &lt;æ—¥&gt; &lt;æœˆä»½&gt; &lt;æ˜ŸæœŸ&gt;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">    åˆ†é’Ÿ å€¼ä» 0 åˆ° 59.</span></span><br><span class="line"><span class="code">    å°æ—¶ å€¼ä» 0 åˆ° 23.</span></span><br><span class="line"><span class="code">    æ—¥ å€¼ä» 1 åˆ° 31.</span></span><br><span class="line"><span class="code">    æœˆ å€¼ä» 1 åˆ° 12.</span></span><br><span class="line"><span class="code">    æ˜ŸæœŸ å€¼ä» 0 åˆ° 6, 0 ä»£è¡¨æ˜ŸæœŸæ—¥</span></span><br><span class="line"><span class="code">    å¤šä¸ªæ—¶é—´å¯ä»¥ç”¨é€—å·éš”å¼€ï¼› èŒƒå›´å¯ä»¥ç”¨è¿å­—ç¬¦ç»™å‡ºï¼›*å¯ä»¥ä½œä¸ºé€šé…ç¬¦ï¼› /è¡¨ç¤ºæ¯...</span></span><br><span class="line"><span class="code">concurrencyPolicy:</span></span><br><span class="line"><span class="code">    Allow:   å…è®¸Jobså¹¶å‘è¿è¡Œ(é»˜è®¤)</span></span><br><span class="line"><span class="code">    Forbid:  ç¦æ­¢å¹¶å‘è¿è¡Œï¼Œå¦‚æœä¸Šä¸€æ¬¡è¿è¡Œå°šæœªå®Œæˆï¼Œåˆ™è·³è¿‡ä¸‹ä¸€æ¬¡è¿è¡Œ</span></span><br><span class="line"><span class="code">    Replace: æ›¿æ¢ï¼Œå–æ¶ˆå½“å‰æ­£åœ¨è¿è¡Œçš„ä½œä¸šå¹¶ç”¨æ–°ä½œä¸šæ›¿æ¢å®ƒ</span></span><br></pre></td></tr></table></figure></div>

<p>åˆ›å»ºpc-cronjob.yamlï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">batch/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CronJob</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pc-cronjob</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">controller:</span> <span class="string">cronjob</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">schedule:</span> <span class="string">&quot;*/1 * * * *&quot;</span></span><br><span class="line">  <span class="attr">jobTemplate:</span></span><br><span class="line">    <span class="attr">metadata:</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">template:</span></span><br><span class="line">        <span class="attr">spec:</span></span><br><span class="line">          <span class="attr">restartPolicy:</span> <span class="string">Never</span></span><br><span class="line">          <span class="attr">containers:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">counter</span></span><br><span class="line">            <span class="attr">image:</span> <span class="string">busybox:1.30</span></span><br><span class="line">            <span class="attr">command:</span> [<span class="string">&quot;bin/sh&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;for i in 9 8 7 6 5 4 3 2 1; do echo $i;sleep 3;done&quot;</span>]</span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åˆ›å»ºcronjob</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl create -f pc-cronjob.yaml</span><br><span class="line">cronjob.batch/pc-cronjob created</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹cronjob</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl get cronjobs -n dev</span><br><span class="line">NAME         SCHEDULE      SUSPEND   ACTIVE   LAST SCHEDULE   AGE</span><br><span class="line">pc-cronjob   */1 * * * *   False     0        &lt;none&gt;          6s</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹job</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl get jobs -n dev</span><br><span class="line">NAME                    COMPLETIONS   DURATION   AGE</span><br><span class="line">pc-cronjob-1592587800   1/1           28s        3m26s</span><br><span class="line">pc-cronjob-1592587860   1/1           28s        2m26s</span><br><span class="line">pc-cronjob-1592587920   1/1           28s        86s</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹pod</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl get pods -n dev</span><br><span class="line">pc-cronjob-1592587800-x4tsm   0/1     Completed   0          2m24s</span><br><span class="line">pc-cronjob-1592587860-r5gv4   0/1     Completed   0          84s</span><br><span class="line">pc-cronjob-1592587920-9dxxq   1/1     Running     0          24s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆ é™¤cronjob</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl  delete -f pc-cronjob.yaml</span><br><span class="line">cronjob.batch &quot;pc-cronjob&quot; deleted</span><br></pre></td></tr></table></figure></div>
]]></content>
      <tags>
        <tag>äº‘åŸç”ŸåŸºç¡€ç³»åˆ—</tag>
        <tag>Kubernetes</tag>
      </tags>
  </entry>
  <entry>
    <title>äº‘åŸç”ŸåŸºç¡€ç³»åˆ—ä¹‹Kubernetes(äº”)Podè¯¦è§£</title>
    <url>/2022/06/09/uncatalog/cl46zbayg000v7or7a4o0f4yd/</url>
    <content><![CDATA[<hr>
<span id="more"></span>



<hr>
<h4 id="5-1-Podä»‹ç»"><a href="#5-1-Podä»‹ç»" class="headerlink" title="5.1 Podä»‹ç»"></a>5.1 Podä»‹ç»</h4><h5 id="5-1-1-Podç»“æ„"><a href="#5-1-1-Podç»“æ„" class="headerlink" title="5.1.1 Podç»“æ„"></a>5.1.1 Podç»“æ„</h5><p><img src="/2022/06/09/uncatalog/cl46zbayg000v7or7a4o0f4yd/image-20200407121501907-1626781151898.png" alt="image-20200407121501907"></p>
<p>æ¯ä¸ªPodä¸­éƒ½å¯ä»¥åŒ…å«ä¸€ä¸ªæˆ–è€…å¤šä¸ªå®¹å™¨ï¼Œè¿™äº›å®¹å™¨å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼š</p>
<ul>
<li><p>ç”¨æˆ·ç¨‹åºæ‰€åœ¨çš„å®¹å™¨ï¼Œæ•°é‡å¯å¤šå¯å°‘</p>
</li>
<li><p>Pauseå®¹å™¨ï¼Œè¿™æ˜¯æ¯ä¸ªPodéƒ½ä¼šæœ‰çš„ä¸€ä¸ª<strong>æ ¹å®¹å™¨</strong>ï¼Œå®ƒçš„ä½œç”¨æœ‰ä¸¤ä¸ªï¼š</p>
<ul>
<li><p>å¯ä»¥ä»¥å®ƒä¸ºä¾æ®ï¼Œè¯„ä¼°æ•´ä¸ªPodçš„å¥åº·çŠ¶æ€</p>
</li>
<li><p>å¯ä»¥åœ¨æ ¹å®¹å™¨ä¸Šè®¾ç½®Ipåœ°å€ï¼Œå…¶å®ƒå®¹å™¨éƒ½æ­¤Ipï¼ˆPod IPï¼‰ï¼Œä»¥å®ç°Podå†…éƒ¨çš„ç½‘è·¯é€šä¿¡</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="code"><pre><span class="line">è¿™é‡Œæ˜¯Podå†…éƒ¨çš„é€šè®¯ï¼ŒPodçš„ä¹‹é—´çš„é€šè®¯é‡‡ç”¨è™šæ‹ŸäºŒå±‚ç½‘ç»œæŠ€æœ¯æ¥å®ç°ï¼Œæˆ‘ä»¬å½“å‰ç¯å¢ƒç”¨çš„æ˜¯Flannel</span><br></pre></td></tr></table></figure></div></li>
</ul>
</li>
</ul>
<h5 id="5-1-2-Podå®šä¹‰"><a href="#5-1-2-Podå®šä¹‰" class="headerlink" title="5.1.2 Podå®šä¹‰"></a>5.1.2 Podå®šä¹‰</h5><p>ä¸‹é¢æ˜¯Podçš„èµ„æºæ¸…å•ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span>     <span class="comment">#å¿…é€‰ï¼Œç‰ˆæœ¬å·ï¼Œä¾‹å¦‚v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span>       ã€€ <span class="comment">#å¿…é€‰ï¼Œèµ„æºç±»å‹ï¼Œä¾‹å¦‚ Pod</span></span><br><span class="line"><span class="attr">metadata:</span>       ã€€ <span class="comment">#å¿…é€‰ï¼Œå…ƒæ•°æ®</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">string</span>     <span class="comment">#å¿…é€‰ï¼ŒPodåç§°</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">string</span>  <span class="comment">#Podæ‰€å±çš„å‘½åç©ºé—´,é»˜è®¤ä¸º&quot;default&quot;</span></span><br><span class="line">  <span class="attr">labels:</span>       ã€€ã€€  <span class="comment">#è‡ªå®šä¹‰æ ‡ç­¾åˆ—è¡¨</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">string</span>      ã€€          </span><br><span class="line"><span class="attr">spec:</span>  <span class="comment">#å¿…é€‰ï¼ŒPodä¸­å®¹å™¨çš„è¯¦ç»†å®šä¹‰</span></span><br><span class="line">  <span class="attr">containers:</span>  <span class="comment">#å¿…é€‰ï¼ŒPodä¸­å®¹å™¨åˆ—è¡¨</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">string</span>   <span class="comment">#å¿…é€‰ï¼Œå®¹å™¨åç§°</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">string</span>  <span class="comment">#å¿…é€‰ï¼Œå®¹å™¨çš„é•œåƒåç§°</span></span><br><span class="line">    <span class="attr">imagePullPolicy:</span> [ <span class="string">Always|Never|IfNotPresent</span> ]  <span class="comment">#è·å–é•œåƒçš„ç­–ç•¥ </span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">string</span>]   <span class="comment">#å®¹å™¨çš„å¯åŠ¨å‘½ä»¤åˆ—è¡¨ï¼Œå¦‚ä¸æŒ‡å®šï¼Œä½¿ç”¨æ‰“åŒ…æ—¶ä½¿ç”¨çš„å¯åŠ¨å‘½ä»¤</span></span><br><span class="line">    <span class="attr">args:</span> [<span class="string">string</span>]      <span class="comment">#å®¹å™¨çš„å¯åŠ¨å‘½ä»¤å‚æ•°åˆ—è¡¨</span></span><br><span class="line">    <span class="attr">workingDir:</span> <span class="string">string</span>  <span class="comment">#å®¹å™¨çš„å·¥ä½œç›®å½•</span></span><br><span class="line">    <span class="attr">volumeMounts:</span>       <span class="comment">#æŒ‚è½½åˆ°å®¹å™¨å†…éƒ¨çš„å­˜å‚¨å·é…ç½®</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">string</span>      <span class="comment">#å¼•ç”¨podå®šä¹‰çš„å…±äº«å­˜å‚¨å·çš„åç§°ï¼Œéœ€ç”¨volumes[]éƒ¨åˆ†å®šä¹‰çš„çš„å·å</span></span><br><span class="line">      <span class="attr">mountPath:</span> <span class="string">string</span> <span class="comment">#å­˜å‚¨å·åœ¨å®¹å™¨å†…mountçš„ç»å¯¹è·¯å¾„ï¼Œåº”å°‘äº512å­—ç¬¦</span></span><br><span class="line">      <span class="attr">readOnly:</span> <span class="string">boolean</span> <span class="comment">#æ˜¯å¦ä¸ºåªè¯»æ¨¡å¼</span></span><br><span class="line">    <span class="attr">ports:</span> <span class="comment">#éœ€è¦æš´éœ²çš„ç«¯å£åº“å·åˆ—è¡¨</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">string</span>        <span class="comment">#ç«¯å£çš„åç§°</span></span><br><span class="line">      <span class="attr">containerPort:</span> <span class="string">int</span>  <span class="comment">#å®¹å™¨éœ€è¦ç›‘å¬çš„ç«¯å£å·</span></span><br><span class="line">      <span class="attr">hostPort:</span> <span class="string">int</span>       <span class="comment">#å®¹å™¨æ‰€åœ¨ä¸»æœºéœ€è¦ç›‘å¬çš„ç«¯å£å·ï¼Œé»˜è®¤ä¸Containerç›¸åŒ</span></span><br><span class="line">      <span class="attr">protocol:</span> <span class="string">string</span>    <span class="comment">#ç«¯å£åè®®ï¼Œæ”¯æŒTCPå’ŒUDPï¼Œé»˜è®¤TCP</span></span><br><span class="line">    <span class="attr">env:</span>   <span class="comment">#å®¹å™¨è¿è¡Œå‰éœ€è®¾ç½®çš„ç¯å¢ƒå˜é‡åˆ—è¡¨</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">string</span>  <span class="comment">#ç¯å¢ƒå˜é‡åç§°</span></span><br><span class="line">      <span class="attr">value:</span> <span class="string">string</span> <span class="comment">#ç¯å¢ƒå˜é‡çš„å€¼</span></span><br><span class="line">    <span class="attr">resources:</span> <span class="comment">#èµ„æºé™åˆ¶å’Œè¯·æ±‚çš„è®¾ç½®</span></span><br><span class="line">      <span class="attr">limits:</span>  <span class="comment">#èµ„æºé™åˆ¶çš„è®¾ç½®</span></span><br><span class="line">        <span class="attr">cpu:</span> <span class="string">string</span>     <span class="comment">#Cpuçš„é™åˆ¶ï¼Œå•ä½ä¸ºcoreæ•°ï¼Œå°†ç”¨äºdocker run --cpu-shareså‚æ•°</span></span><br><span class="line">        <span class="attr">memory:</span> <span class="string">string</span>  <span class="comment">#å†…å­˜é™åˆ¶ï¼Œå•ä½å¯ä»¥ä¸ºMib/Gibï¼Œå°†ç”¨äºdocker run --memoryå‚æ•°</span></span><br><span class="line">      <span class="attr">requests:</span> <span class="comment">#èµ„æºè¯·æ±‚çš„è®¾ç½®</span></span><br><span class="line">        <span class="attr">cpu:</span> <span class="string">string</span>    <span class="comment">#Cpuè¯·æ±‚ï¼Œå®¹å™¨å¯åŠ¨çš„åˆå§‹å¯ç”¨æ•°é‡</span></span><br><span class="line">        <span class="attr">memory:</span> <span class="string">string</span> <span class="comment">#å†…å­˜è¯·æ±‚,å®¹å™¨å¯åŠ¨çš„åˆå§‹å¯ç”¨æ•°é‡</span></span><br><span class="line">    <span class="attr">lifecycle:</span> <span class="comment">#ç”Ÿå‘½å‘¨æœŸé’©å­</span></span><br><span class="line">        <span class="attr">postStart:</span> <span class="comment">#å®¹å™¨å¯åŠ¨åç«‹å³æ‰§è¡Œæ­¤é’©å­,å¦‚æœæ‰§è¡Œå¤±è´¥,ä¼šæ ¹æ®é‡å¯ç­–ç•¥è¿›è¡Œé‡å¯</span></span><br><span class="line">        <span class="attr">preStop:</span> <span class="comment">#å®¹å™¨ç»ˆæ­¢å‰æ‰§è¡Œæ­¤é’©å­,æ— è®ºç»“æœå¦‚ä½•,å®¹å™¨éƒ½ä¼šç»ˆæ­¢</span></span><br><span class="line">    <span class="attr">livenessProbe:</span>  <span class="comment">#å¯¹Podå†…å„å®¹å™¨å¥åº·æ£€æŸ¥çš„è®¾ç½®ï¼Œå½“æ¢æµ‹æ— å“åº”å‡ æ¬¡åå°†è‡ªåŠ¨é‡å¯è¯¥å®¹å™¨</span></span><br><span class="line">      <span class="attr">exec:</span>       ã€€ <span class="comment">#å¯¹Podå®¹å™¨å†…æ£€æŸ¥æ–¹å¼è®¾ç½®ä¸ºexecæ–¹å¼</span></span><br><span class="line">        <span class="attr">command:</span> [<span class="string">string</span>]  <span class="comment">#execæ–¹å¼éœ€è¦åˆ¶å®šçš„å‘½ä»¤æˆ–è„šæœ¬</span></span><br><span class="line">      <span class="attr">httpGet:</span>       <span class="comment">#å¯¹Podå†…ä¸ªå®¹å™¨å¥åº·æ£€æŸ¥æ–¹æ³•è®¾ç½®ä¸ºHttpGetï¼Œéœ€è¦åˆ¶å®šPathã€port</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">string</span></span><br><span class="line">        <span class="attr">port:</span> <span class="string">number</span></span><br><span class="line">        <span class="attr">host:</span> <span class="string">string</span></span><br><span class="line">        <span class="attr">scheme:</span> <span class="string">string</span></span><br><span class="line">        <span class="attr">HttpHeaders:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">string</span></span><br><span class="line">          <span class="attr">value:</span> <span class="string">string</span></span><br><span class="line">      <span class="attr">tcpSocket:</span>     <span class="comment">#å¯¹Podå†…ä¸ªå®¹å™¨å¥åº·æ£€æŸ¥æ–¹å¼è®¾ç½®ä¸ºtcpSocketæ–¹å¼</span></span><br><span class="line">         <span class="attr">port:</span> <span class="string">number</span></span><br><span class="line">       <span class="attr">initialDelaySeconds:</span> <span class="number">0</span>       <span class="comment">#å®¹å™¨å¯åŠ¨å®Œæˆåé¦–æ¬¡æ¢æµ‹çš„æ—¶é—´ï¼Œå•ä½ä¸ºç§’</span></span><br><span class="line">       <span class="attr">timeoutSeconds:</span> <span class="number">0</span>    ã€€ã€€    <span class="comment">#å¯¹å®¹å™¨å¥åº·æ£€æŸ¥æ¢æµ‹ç­‰å¾…å“åº”çš„è¶…æ—¶æ—¶é—´ï¼Œå•ä½ç§’ï¼Œé»˜è®¤1ç§’</span></span><br><span class="line">       <span class="attr">periodSeconds:</span> <span class="number">0</span>     ã€€ã€€    <span class="comment">#å¯¹å®¹å™¨ç›‘æ§æ£€æŸ¥çš„å®šæœŸæ¢æµ‹æ—¶é—´è®¾ç½®ï¼Œå•ä½ç§’ï¼Œé»˜è®¤10ç§’ä¸€æ¬¡</span></span><br><span class="line">       <span class="attr">successThreshold:</span> <span class="number">0</span></span><br><span class="line">       <span class="attr">failureThreshold:</span> <span class="number">0</span></span><br><span class="line">       <span class="attr">securityContext:</span></span><br><span class="line">         <span class="attr">privileged:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">restartPolicy:</span> [<span class="string">Always</span> <span class="string">|</span> <span class="string">Never</span> <span class="string">|</span> <span class="string">OnFailure</span>]  <span class="comment">#Podçš„é‡å¯ç­–ç•¥</span></span><br><span class="line">  <span class="attr">nodeName:</span> <span class="string">&lt;string&gt;</span> <span class="comment">#è®¾ç½®NodeNameè¡¨ç¤ºå°†è¯¥Podè°ƒåº¦åˆ°æŒ‡å®šåˆ°åç§°çš„nodeèŠ‚ç‚¹ä¸Š</span></span><br><span class="line">  <span class="attr">nodeSelector:</span> <span class="string">obeject</span> <span class="comment">#è®¾ç½®NodeSelectorè¡¨ç¤ºå°†è¯¥Podè°ƒåº¦åˆ°åŒ…å«è¿™ä¸ªlabelçš„nodeä¸Š</span></span><br><span class="line">  <span class="attr">imagePullSecrets:</span> <span class="comment">#Pullé•œåƒæ—¶ä½¿ç”¨çš„secretåç§°ï¼Œä»¥keyï¼šsecretkeyæ ¼å¼æŒ‡å®š</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">string</span></span><br><span class="line">  <span class="attr">hostNetwork:</span> <span class="literal">false</span>   <span class="comment">#æ˜¯å¦ä½¿ç”¨ä¸»æœºç½‘ç»œæ¨¡å¼ï¼Œé»˜è®¤ä¸ºfalseï¼Œå¦‚æœè®¾ç½®ä¸ºtrueï¼Œè¡¨ç¤ºä½¿ç”¨å®¿ä¸»æœºç½‘ç»œ</span></span><br><span class="line">  <span class="attr">volumes:</span>   <span class="comment">#åœ¨è¯¥podä¸Šå®šä¹‰å…±äº«å­˜å‚¨å·åˆ—è¡¨</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">string</span>    <span class="comment">#å…±äº«å­˜å‚¨å·åç§° ï¼ˆvolumesç±»å‹æœ‰å¾ˆå¤šç§ï¼‰</span></span><br><span class="line">    <span class="attr">emptyDir:</span> &#123;&#125;       <span class="comment">#ç±»å‹ä¸ºemtyDirçš„å­˜å‚¨å·ï¼Œä¸PodåŒç”Ÿå‘½å‘¨æœŸçš„ä¸€ä¸ªä¸´æ—¶ç›®å½•ã€‚ä¸ºç©ºå€¼</span></span><br><span class="line">    <span class="attr">hostPath:</span> <span class="string">string</span>   <span class="comment">#ç±»å‹ä¸ºhostPathçš„å­˜å‚¨å·ï¼Œè¡¨ç¤ºæŒ‚è½½Podæ‰€åœ¨å®¿ä¸»æœºçš„ç›®å½•</span></span><br><span class="line">      <span class="attr">path:</span> <span class="string">string</span>      ã€€ã€€        <span class="comment">#Podæ‰€åœ¨å®¿ä¸»æœºçš„ç›®å½•ï¼Œå°†è¢«ç”¨äºåŒæœŸä¸­mountçš„ç›®å½•</span></span><br><span class="line">    <span class="attr">secret:</span>       ã€€ã€€ã€€<span class="comment">#ç±»å‹ä¸ºsecretçš„å­˜å‚¨å·ï¼ŒæŒ‚è½½é›†ç¾¤ä¸å®šä¹‰çš„secretå¯¹è±¡åˆ°å®¹å™¨å†…éƒ¨</span></span><br><span class="line">      <span class="attr">scretname:</span> <span class="string">string</span>  </span><br><span class="line">      <span class="attr">items:</span>     </span><br><span class="line">      <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">string</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">string</span></span><br><span class="line">    <span class="attr">configMap:</span>         <span class="comment">#ç±»å‹ä¸ºconfigMapçš„å­˜å‚¨å·ï¼ŒæŒ‚è½½é¢„å®šä¹‰çš„configMapå¯¹è±¡åˆ°å®¹å™¨å†…éƒ¨</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">string</span></span><br><span class="line">      <span class="attr">items:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">string</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">string</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment">#å°æç¤ºï¼š</span></span><br><span class="line"><span class="comment">#   åœ¨è¿™é‡Œï¼Œå¯é€šè¿‡ä¸€ä¸ªå‘½ä»¤æ¥æŸ¥çœ‹æ¯ç§èµ„æºçš„å¯é…ç½®é¡¹</span></span><br><span class="line"><span class="comment">#   kubectl explain èµ„æºç±»å‹         æŸ¥çœ‹æŸç§èµ„æºå¯ä»¥é…ç½®çš„ä¸€çº§å±æ€§</span></span><br><span class="line"><span class="comment">#   kubectl explain èµ„æºç±»å‹.å±æ€§     æŸ¥çœ‹å±æ€§çš„å­å±æ€§</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># kubectl explain pod</span></span><br><span class="line"><span class="attr">KIND:</span>     <span class="string">Pod</span></span><br><span class="line"><span class="attr">VERSION:</span>  <span class="string">v1</span></span><br><span class="line"><span class="attr">FIELDS:</span></span><br><span class="line">   <span class="string">apiVersion</span>   <span class="string">&lt;string&gt;</span></span><br><span class="line">   <span class="string">kind</span> <span class="string">&lt;string&gt;</span></span><br><span class="line">   <span class="string">metadata</span>     <span class="string">&lt;Object&gt;</span></span><br><span class="line">   <span class="string">spec</span> <span class="string">&lt;Object&gt;</span></span><br><span class="line">   <span class="string">status</span>       <span class="string">&lt;Object&gt;</span></span><br><span class="line"></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># kubectl explain pod.metadata</span></span><br><span class="line"><span class="attr">KIND:</span>     <span class="string">Pod</span></span><br><span class="line"><span class="attr">VERSION:</span>  <span class="string">v1</span></span><br><span class="line"><span class="attr">RESOURCE:</span> <span class="string">metadata</span> <span class="string">&lt;Object&gt;</span></span><br><span class="line"><span class="attr">FIELDS:</span></span><br><span class="line">   <span class="string">annotations</span>  <span class="string">&lt;map[string]string&gt;</span></span><br><span class="line">   <span class="string">clusterName</span>  <span class="string">&lt;string&gt;</span></span><br><span class="line">   <span class="string">creationTimestamp</span>    <span class="string">&lt;string&gt;</span></span><br><span class="line">   <span class="string">deletionGracePeriodSeconds</span>   <span class="string">&lt;integer&gt;</span></span><br><span class="line">   <span class="string">deletionTimestamp</span>    <span class="string">&lt;string&gt;</span></span><br><span class="line">   <span class="string">finalizers</span>   <span class="string">&lt;[]string&gt;</span></span><br><span class="line">   <span class="string">generateName</span> <span class="string">&lt;string&gt;</span></span><br><span class="line">   <span class="string">generation</span>   <span class="string">&lt;integer&gt;</span></span><br><span class="line">   <span class="string">labels</span>       <span class="string">&lt;map[string]string&gt;</span></span><br><span class="line">   <span class="string">managedFields</span>        <span class="string">&lt;[]Object&gt;</span></span><br><span class="line">   <span class="string">name</span> <span class="string">&lt;string&gt;</span></span><br><span class="line">   <span class="string">namespace</span>    <span class="string">&lt;string&gt;</span></span><br><span class="line">   <span class="string">ownerReferences</span>      <span class="string">&lt;[]Object&gt;</span></span><br><span class="line">   <span class="string">resourceVersion</span>      <span class="string">&lt;string&gt;</span></span><br><span class="line">   <span class="string">selfLink</span>     <span class="string">&lt;string&gt;</span></span><br><span class="line">   <span class="string">uid</span>  <span class="string">&lt;string&gt;</span></span><br></pre></td></tr></table></figure></div>

<p>åœ¨kubernetesä¸­åŸºæœ¬æ‰€æœ‰èµ„æºçš„ä¸€çº§å±æ€§éƒ½æ˜¯ä¸€æ ·çš„ï¼Œä¸»è¦åŒ…å«5éƒ¨åˆ†ï¼š</p>
<ul>
<li>apiVersion <string> ç‰ˆæœ¬ï¼Œç”±kuberneteså†…éƒ¨å®šä¹‰ï¼Œç‰ˆæœ¬å·å¿…é¡»å¯ä»¥ç”¨ kubectl api-versions æŸ¥è¯¢åˆ°</string></li>
<li>kind <string> ç±»å‹ï¼Œç”±kuberneteså†…éƒ¨å®šä¹‰ï¼Œç‰ˆæœ¬å·å¿…é¡»å¯ä»¥ç”¨ kubectl api-resources æŸ¥è¯¢åˆ°</string></li>
<li>metadata <Object> å…ƒæ•°æ®ï¼Œä¸»è¦æ˜¯èµ„æºæ ‡è¯†å’Œè¯´æ˜ï¼Œå¸¸ç”¨çš„æœ‰nameã€namespaceã€labelsç­‰</Object></li>
<li>spec <Object> æè¿°ï¼Œè¿™æ˜¯é…ç½®ä¸­æœ€é‡è¦çš„ä¸€éƒ¨åˆ†ï¼Œé‡Œé¢æ˜¯å¯¹å„ç§èµ„æºé…ç½®çš„è¯¦ç»†æè¿°</Object></li>
<li>status <Object> çŠ¶æ€ä¿¡æ¯ï¼Œé‡Œé¢çš„å†…å®¹ä¸éœ€è¦å®šä¹‰ï¼Œç”±kubernetesè‡ªåŠ¨ç”Ÿæˆ</Object></li>
</ul>
<p>åœ¨ä¸Šé¢çš„å±æ€§ä¸­ï¼Œspecæ˜¯æ¥ä¸‹æ¥ç ”ç©¶çš„é‡ç‚¹ï¼Œç»§ç»­çœ‹ä¸‹å®ƒçš„å¸¸è§å­å±æ€§:</p>
<ul>
<li>containers &lt;[]Object&gt; å®¹å™¨åˆ—è¡¨ï¼Œç”¨äºå®šä¹‰å®¹å™¨çš„è¯¦ç»†ä¿¡æ¯</li>
<li>nodeName <String> æ ¹æ®nodeNameçš„å€¼å°†podè°ƒåº¦åˆ°æŒ‡å®šçš„NodeèŠ‚ç‚¹ä¸Š</String></li>
<li>nodeSelector &lt;map[]&gt; æ ¹æ®NodeSelectorä¸­å®šä¹‰çš„ä¿¡æ¯é€‰æ‹©å°†è¯¥Podè°ƒåº¦åˆ°åŒ…å«è¿™äº›labelçš„Node ä¸Š</li>
<li>hostNetwork <boolean> æ˜¯å¦ä½¿ç”¨ä¸»æœºç½‘ç»œæ¨¡å¼ï¼Œé»˜è®¤ä¸ºfalseï¼Œå¦‚æœè®¾ç½®ä¸ºtrueï¼Œè¡¨ç¤ºä½¿ç”¨å®¿ä¸»æœºç½‘ç»œ</boolean></li>
<li>volumes &lt;[]Object&gt; å­˜å‚¨å·ï¼Œç”¨äºå®šä¹‰Podä¸Šé¢æŒ‚åœ¨çš„å­˜å‚¨ä¿¡æ¯</li>
<li>restartPolicy <string> é‡å¯ç­–ç•¥ï¼Œè¡¨ç¤ºPodåœ¨é‡åˆ°æ•…éšœçš„æ—¶å€™çš„å¤„ç†ç­–ç•¥</string></li>
</ul>
<h4 id="5-2-Podé…ç½®"><a href="#5-2-Podé…ç½®" class="headerlink" title="5.2 Podé…ç½®"></a>5.2 Podé…ç½®</h4><p>æœ¬å°èŠ‚ä¸»è¦æ¥ç ”ç©¶<code>pod.spec.containers</code>å±æ€§ï¼Œè¿™ä¹Ÿæ˜¯podé…ç½®ä¸­æœ€ä¸ºå…³é”®çš„ä¸€é¡¹é…ç½®ã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># kubectl explain pod.spec.containers</span></span><br><span class="line"><span class="attr">KIND:</span>     <span class="string">Pod</span></span><br><span class="line"><span class="attr">VERSION:</span>  <span class="string">v1</span></span><br><span class="line"><span class="attr">RESOURCE:</span> <span class="string">containers</span> <span class="string">&lt;[]Object&gt;</span>   <span class="comment"># æ•°ç»„ï¼Œä»£è¡¨å¯ä»¥æœ‰å¤šä¸ªå®¹å™¨</span></span><br><span class="line"><span class="attr">FIELDS:</span></span><br><span class="line">   <span class="string">name</span>  <span class="string">&lt;string&gt;</span>     <span class="comment"># å®¹å™¨åç§°</span></span><br><span class="line">   <span class="string">image</span> <span class="string">&lt;string&gt;</span>     <span class="comment"># å®¹å™¨éœ€è¦çš„é•œåƒåœ°å€</span></span><br><span class="line">   <span class="string">imagePullPolicy</span>  <span class="string">&lt;string&gt;</span> <span class="comment"># é•œåƒæ‹‰å–ç­–ç•¥ </span></span><br><span class="line">   <span class="string">command</span>  <span class="string">&lt;[]string&gt;</span> <span class="comment"># å®¹å™¨çš„å¯åŠ¨å‘½ä»¤åˆ—è¡¨ï¼Œå¦‚ä¸æŒ‡å®šï¼Œä½¿ç”¨æ‰“åŒ…æ—¶ä½¿ç”¨çš„å¯åŠ¨å‘½ä»¤</span></span><br><span class="line">   <span class="string">args</span>     <span class="string">&lt;[]string&gt;</span> <span class="comment"># å®¹å™¨çš„å¯åŠ¨å‘½ä»¤éœ€è¦çš„å‚æ•°åˆ—è¡¨</span></span><br><span class="line">   <span class="string">env</span>      <span class="string">&lt;[]Object&gt;</span> <span class="comment"># å®¹å™¨ç¯å¢ƒå˜é‡çš„é…ç½®</span></span><br><span class="line">   <span class="string">ports</span>    <span class="string">&lt;[]Object&gt;</span>     <span class="comment"># å®¹å™¨éœ€è¦æš´éœ²çš„ç«¯å£å·åˆ—è¡¨</span></span><br><span class="line">   <span class="string">resources</span> <span class="string">&lt;Object&gt;</span>      <span class="comment"># èµ„æºé™åˆ¶å’Œèµ„æºè¯·æ±‚çš„è®¾ç½®</span></span><br></pre></td></tr></table></figure></div>

<h5 id="5-2-1-åŸºæœ¬é…ç½®"><a href="#5-2-1-åŸºæœ¬é…ç½®" class="headerlink" title="5.2.1 åŸºæœ¬é…ç½®"></a>5.2.1 åŸºæœ¬é…ç½®</h5><p>åˆ›å»ºpod-base.yamlæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pod-base</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">user:</span> <span class="string">heima</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:1.17.1</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">busybox:1.30</span></span><br></pre></td></tr></table></figure></div>

<p><img src="/2022/06/09/uncatalog/cl46zbayg000v7or7a4o0f4yd/image-20210617223823675-1626781695411.png" alt="image-20210617223823675"></p>
<p>ä¸Šé¢å®šä¹‰äº†ä¸€ä¸ªæ¯”è¾ƒç®€å•Podçš„é…ç½®ï¼Œé‡Œé¢æœ‰ä¸¤ä¸ªå®¹å™¨ï¼š</p>
<ul>
<li>nginxï¼šç”¨1.17.1ç‰ˆæœ¬çš„nginxé•œåƒåˆ›å»ºï¼Œï¼ˆnginxæ˜¯ä¸€ä¸ªè½»é‡çº§webå®¹å™¨ï¼‰</li>
<li>busyboxï¼šç”¨1.30ç‰ˆæœ¬çš„busyboxé•œåƒåˆ›å»ºï¼Œï¼ˆbusyboxæ˜¯ä¸€ä¸ªå°å·§çš„linuxå‘½ä»¤é›†åˆï¼‰</li>
</ul>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºPod</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">pod</span>]<span class="comment"># kubectl apply -f pod-base.yaml</span></span><br><span class="line"><span class="string">pod/pod-base</span> <span class="string">created</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹PodçŠ¶å†µ</span></span><br><span class="line"><span class="comment"># READY 1/2 : è¡¨ç¤ºå½“å‰Podä¸­æœ‰2ä¸ªå®¹å™¨ï¼Œå…¶ä¸­1ä¸ªå‡†å¤‡å°±ç»ªï¼Œ1ä¸ªæœªå°±ç»ª</span></span><br><span class="line"><span class="comment"># RESTARTS  : é‡å¯æ¬¡æ•°ï¼Œå› ä¸ºæœ‰1ä¸ªå®¹å™¨æ•…éšœäº†ï¼ŒPodä¸€ç›´åœ¨é‡å¯è¯•å›¾æ¢å¤å®ƒ</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">pod</span>]<span class="comment"># kubectl get pod -n dev</span></span><br><span class="line"><span class="string">NAME</span>       <span class="string">READY</span>   <span class="string">STATUS</span>    <span class="string">RESTARTS</span>   <span class="string">AGE</span></span><br><span class="line"><span class="string">pod-base</span>   <span class="number">1</span><span class="string">/2</span>     <span class="string">Running</span>   <span class="number">4</span>          <span class="string">95s</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¯ä»¥é€šè¿‡describeæŸ¥çœ‹å†…éƒ¨çš„è¯¦æƒ…</span></span><br><span class="line"><span class="comment"># æ­¤æ—¶å·²ç»è¿è¡Œèµ·æ¥äº†ä¸€ä¸ªåŸºæœ¬çš„Podï¼Œè™½ç„¶å®ƒæš‚æ—¶æœ‰é—®é¢˜</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">pod</span>]<span class="comment"># kubectl describe pod pod-base -n dev</span></span><br></pre></td></tr></table></figure></div>

<h5 id="5-2-2-é•œåƒæ‹‰å–"><a href="#5-2-2-é•œåƒæ‹‰å–" class="headerlink" title="5.2.2 é•œåƒæ‹‰å–"></a>5.2.2 é•œåƒæ‹‰å–</h5><p>åˆ›å»ºpod-imagepullpolicy.yamlæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pod-imagepullpolicy</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:1.17.1</span></span><br><span class="line">    <span class="attr">imagePullPolicy:</span> <span class="string">Never</span> <span class="comment"># ç”¨äºè®¾ç½®é•œåƒæ‹‰å–ç­–ç•¥</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">busybox:1.30</span></span><br></pre></td></tr></table></figure></div>

<p><img src="/2022/06/09/uncatalog/cl46zbayg000v7or7a4o0f4yd/image-20210617223923659.png" alt="image-20210617223923659"></p>
<p>imagePullPolicyï¼Œç”¨äºè®¾ç½®é•œåƒæ‹‰å–ç­–ç•¥ï¼Œkubernetesæ”¯æŒé…ç½®ä¸‰ç§æ‹‰å–ç­–ç•¥ï¼š</p>
<ul>
<li>Alwaysï¼šæ€»æ˜¯ä»è¿œç¨‹ä»“åº“æ‹‰å–é•œåƒï¼ˆä¸€ç›´è¿œç¨‹ä¸‹è½½ï¼‰</li>
<li>IfNotPresentï¼šæœ¬åœ°æœ‰åˆ™ä½¿ç”¨æœ¬åœ°é•œåƒï¼Œæœ¬åœ°æ²¡æœ‰åˆ™ä»è¿œç¨‹ä»“åº“æ‹‰å–é•œåƒï¼ˆæœ¬åœ°æœ‰å°±æœ¬åœ° æœ¬åœ°æ²¡è¿œç¨‹ä¸‹è½½ï¼‰</li>
<li>Neverï¼šåªä½¿ç”¨æœ¬åœ°é•œåƒï¼Œä»ä¸å»è¿œç¨‹ä»“åº“æ‹‰å–ï¼Œæœ¬åœ°æ²¡æœ‰å°±æŠ¥é”™ ï¼ˆä¸€ç›´ä½¿ç”¨æœ¬åœ°ï¼‰</li>
</ul>
<blockquote>
<p>é»˜è®¤å€¼è¯´æ˜ï¼š</p>
<p>å¦‚æœé•œåƒtagä¸ºå…·ä½“ç‰ˆæœ¬å·ï¼Œ é»˜è®¤ç­–ç•¥æ˜¯ï¼šIfNotPresent</p>
<p>å¦‚æœé•œåƒtagä¸ºï¼šlatestï¼ˆæœ€ç»ˆç‰ˆæœ¬ï¼‰ ï¼Œé»˜è®¤ç­–ç•¥æ˜¯always</p>
</blockquote>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºPod</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">pod</span>]<span class="comment"># kubectl create -f pod-imagepullpolicy.yaml</span></span><br><span class="line"><span class="string">pod/pod-imagepullpolicy</span> <span class="string">created</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹Podè¯¦æƒ…</span></span><br><span class="line"><span class="comment"># æ­¤æ—¶æ˜æ˜¾å¯ä»¥çœ‹åˆ°nginxé•œåƒæœ‰ä¸€æ­¥Pulling image &quot;nginx:1.17.1&quot;çš„è¿‡ç¨‹</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">pod</span>]<span class="comment"># kubectl describe pod pod-imagepullpolicy -n dev</span></span><br><span class="line"><span class="string">......</span></span><br><span class="line"><span class="attr">Events:</span></span><br><span class="line">  <span class="string">Type</span>     <span class="string">Reason</span>     <span class="string">Age</span>               <span class="string">From</span>               <span class="string">Message</span></span><br><span class="line">  <span class="string">----</span>     <span class="string">------</span>     <span class="string">----</span>              <span class="string">----</span>               <span class="string">-------</span></span><br><span class="line">  <span class="string">Normal</span>   <span class="string">Scheduled</span>  <span class="string">&lt;unknown&gt;</span>         <span class="string">default-scheduler</span>  <span class="string">Successfully</span> <span class="string">assigned</span> <span class="string">dev/pod-imagePullPolicy</span> <span class="string">to</span> <span class="string">node1</span></span><br><span class="line">  <span class="string">Normal</span>   <span class="string">Pulling</span>    <span class="string">32s</span>               <span class="string">kubelet,</span> <span class="string">node1</span>     <span class="string">Pulling</span> <span class="string">image</span> <span class="string">&quot;nginx:1.17.1&quot;</span></span><br><span class="line">  <span class="string">Normal</span>   <span class="string">Pulled</span>     <span class="string">26s</span>               <span class="string">kubelet,</span> <span class="string">node1</span>     <span class="string">Successfully</span> <span class="string">pulled</span> <span class="string">image</span> <span class="string">&quot;nginx:1.17.1&quot;</span></span><br><span class="line">  <span class="string">Normal</span>   <span class="string">Created</span>    <span class="string">26s</span>               <span class="string">kubelet,</span> <span class="string">node1</span>     <span class="string">Created</span> <span class="string">container</span> <span class="string">nginx</span></span><br><span class="line">  <span class="string">Normal</span>   <span class="string">Started</span>    <span class="string">25s</span>               <span class="string">kubelet,</span> <span class="string">node1</span>     <span class="string">Started</span> <span class="string">container</span> <span class="string">nginx</span></span><br><span class="line">  <span class="string">Normal</span>   <span class="string">Pulled</span>     <span class="string">7s</span> <span class="string">(x3</span> <span class="string">over</span> <span class="string">25s)</span>  <span class="string">kubelet,</span> <span class="string">node1</span>     <span class="string">Container</span> <span class="string">image</span> <span class="string">&quot;busybox:1.30&quot;</span> <span class="string">already</span> <span class="string">present</span> <span class="string">on</span> <span class="string">machine</span></span><br><span class="line">  <span class="string">Normal</span>   <span class="string">Created</span>    <span class="string">7s</span> <span class="string">(x3</span> <span class="string">over</span> <span class="string">25s)</span>  <span class="string">kubelet,</span> <span class="string">node1</span>     <span class="string">Created</span> <span class="string">container</span> <span class="string">busybox</span></span><br><span class="line">  <span class="string">Normal</span>   <span class="string">Started</span>    <span class="string">7s</span> <span class="string">(x3</span> <span class="string">over</span> <span class="string">25s)</span>  <span class="string">kubelet,</span> <span class="string">node1</span>     <span class="string">Started</span> <span class="string">container</span> <span class="string">busybox</span></span><br></pre></td></tr></table></figure></div>

<h5 id="5-2-3-å¯åŠ¨å‘½ä»¤"><a href="#5-2-3-å¯åŠ¨å‘½ä»¤" class="headerlink" title="5.2.3 å¯åŠ¨å‘½ä»¤"></a>5.2.3 å¯åŠ¨å‘½ä»¤</h5><p>åœ¨å‰é¢çš„æ¡ˆä¾‹ä¸­ï¼Œä¸€ç›´æœ‰ä¸€ä¸ªé—®é¢˜æ²¡æœ‰è§£å†³ï¼Œå°±æ˜¯çš„busyboxå®¹å™¨ä¸€ç›´æ²¡æœ‰æˆåŠŸè¿è¡Œï¼Œé‚£ä¹ˆåˆ°åº•æ˜¯ä»€ä¹ˆåŸå› å¯¼è‡´è¿™ä¸ªå®¹å™¨çš„æ•…éšœå‘¢ï¼Ÿ</p>
<p>åŸæ¥busyboxå¹¶ä¸æ˜¯ä¸€ä¸ªç¨‹åºï¼Œè€Œæ˜¯ç±»ä¼¼äºä¸€ä¸ªå·¥å…·ç±»çš„é›†åˆï¼Œkubernetesé›†ç¾¤å¯åŠ¨ç®¡ç†åï¼Œå®ƒä¼šè‡ªåŠ¨å…³é—­ã€‚è§£å†³æ–¹æ³•å°±æ˜¯è®©å…¶ä¸€ç›´åœ¨è¿è¡Œï¼Œè¿™å°±ç”¨åˆ°äº†commandé…ç½®ã€‚</p>
<p>åˆ›å»ºpod-command.yamlæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pod-command</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:1.17.1</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">busybox:1.30</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;/bin/sh&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;touch /tmp/hello.txt;while true;do /bin/echo $(date +%T) &gt;&gt; /tmp/hello.txt; sleep 3; done;&quot;</span>]</span><br></pre></td></tr></table></figure></div>

<p><img src="/2022/06/09/uncatalog/cl46zbayg000v7or7a4o0f4yd/image-20210617224457945.png" alt="image-20210617224457945"></p>
<p>commandï¼Œç”¨äºåœ¨podä¸­çš„å®¹å™¨åˆå§‹åŒ–å®Œæ¯•ä¹‹åè¿è¡Œä¸€ä¸ªå‘½ä»¤ã€‚</p>
<blockquote>
<p>ç¨å¾®è§£é‡Šä¸‹ä¸Šé¢å‘½ä»¤çš„æ„æ€ï¼š</p>
<p>â€œ/bin/shâ€,â€-câ€, ä½¿ç”¨shæ‰§è¡Œå‘½ä»¤</p>
<p>touch /tmp/hello.txt; åˆ›å»ºä¸€ä¸ª/tmp/hello.txt æ–‡ä»¶</p>
<p>while true;do /bin/echo $(date +%T) &gt;&gt; /tmp/hello.txt; sleep 3; done; æ¯éš”3ç§’å‘æ–‡ä»¶ä¸­å†™å…¥å½“å‰æ—¶é—´</p>
</blockquote>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºPod</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">pod</span>]<span class="comment"># kubectl create  -f pod-command.yaml</span></span><br><span class="line"><span class="string">pod/pod-command</span> <span class="string">created</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹PodçŠ¶æ€</span></span><br><span class="line"><span class="comment"># æ­¤æ—¶å‘ç°ä¸¤ä¸ªpodéƒ½æ­£å¸¸è¿è¡Œäº†</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">pod</span>]<span class="comment"># kubectl get pods pod-command -n dev</span></span><br><span class="line"><span class="string">NAME</span>          <span class="string">READY</span>   <span class="string">STATUS</span>   <span class="string">RESTARTS</span>   <span class="string">AGE</span></span><br><span class="line"><span class="string">pod-command</span>   <span class="number">2</span><span class="string">/2</span>     <span class="string">Runing</span>   <span class="number">0</span>          <span class="string">2s</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿›å…¥podä¸­çš„busyboxå®¹å™¨ï¼ŒæŸ¥çœ‹æ–‡ä»¶å†…å®¹</span></span><br><span class="line"><span class="comment"># è¡¥å……ä¸€ä¸ªå‘½ä»¤: kubectl exec  podåç§° -n å‘½åç©ºé—´ -it -c å®¹å™¨åç§° /bin/sh  åœ¨å®¹å™¨å†…éƒ¨æ‰§è¡Œå‘½ä»¤</span></span><br><span class="line"><span class="comment"># ä½¿ç”¨è¿™ä¸ªå‘½ä»¤å°±å¯ä»¥è¿›å…¥æŸä¸ªå®¹å™¨çš„å†…éƒ¨ï¼Œç„¶åè¿›è¡Œç›¸å…³æ“ä½œäº†</span></span><br><span class="line"><span class="comment"># æ¯”å¦‚ï¼Œå¯ä»¥æŸ¥çœ‹txtæ–‡ä»¶çš„å†…å®¹</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">pod</span>]<span class="comment"># kubectl exec pod-command -n dev -it -c busybox /bin/sh</span></span><br><span class="line"><span class="string">/</span> <span class="comment"># tail -f /tmp/hello.txt</span></span><br><span class="line"><span class="number">14</span><span class="string">:44:19</span></span><br><span class="line"><span class="number">14</span><span class="string">:44:22</span></span><br><span class="line"><span class="number">14</span><span class="string">:44:25</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">ç‰¹åˆ«è¯´æ˜ï¼š</span></span><br><span class="line">    <span class="string">é€šè¿‡ä¸Šé¢å‘ç°commandå·²ç»å¯ä»¥å®Œæˆå¯åŠ¨å‘½ä»¤å’Œä¼ é€’å‚æ•°çš„åŠŸèƒ½ï¼Œä¸ºä»€ä¹ˆè¿™é‡Œè¿˜è¦æä¾›ä¸€ä¸ªargsé€‰é¡¹ï¼Œç”¨äºä¼ é€’å‚æ•°å‘¢?è¿™å…¶å®è·Ÿdockeræœ‰ç‚¹å…³ç³»ï¼Œkubernetesä¸­çš„commandã€argsä¸¤é¡¹å…¶å®æ˜¯å®ç°è¦†ç›–Dockerfileä¸­ENTRYPOINTçš„åŠŸèƒ½ã€‚</span></span><br><span class="line"> <span class="number">1</span> <span class="string">å¦‚æœcommandå’Œargså‡æ²¡æœ‰å†™ï¼Œé‚£ä¹ˆç”¨Dockerfileçš„é…ç½®ã€‚</span></span><br><span class="line"> <span class="number">2</span> <span class="string">å¦‚æœcommandå†™äº†ï¼Œä½†argsæ²¡æœ‰å†™ï¼Œé‚£ä¹ˆDockerfileé»˜è®¤çš„é…ç½®ä¼šè¢«å¿½ç•¥ï¼Œæ‰§è¡Œè¾“å…¥çš„command</span></span><br><span class="line"> <span class="number">3</span> <span class="string">å¦‚æœcommandæ²¡å†™ï¼Œä½†argså†™äº†ï¼Œé‚£ä¹ˆDockerfileä¸­é…ç½®çš„ENTRYPOINTçš„å‘½ä»¤ä¼šè¢«æ‰§è¡Œï¼Œä½¿ç”¨å½“å‰argsçš„å‚æ•°</span></span><br><span class="line"> <span class="number">4</span> <span class="string">å¦‚æœcommandå’Œargséƒ½å†™äº†ï¼Œé‚£ä¹ˆDockerfileçš„é…ç½®è¢«å¿½ç•¥ï¼Œæ‰§è¡Œcommandå¹¶è¿½åŠ ä¸Šargså‚æ•°</span></span><br></pre></td></tr></table></figure></div>

<h5 id="5-2-4-ç¯å¢ƒå˜é‡"><a href="#5-2-4-ç¯å¢ƒå˜é‡" class="headerlink" title="5.2.4 ç¯å¢ƒå˜é‡"></a>5.2.4 ç¯å¢ƒå˜é‡</h5><p>åˆ›å»ºpod-env.yamlæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pod-env</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">busybox</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">busybox:1.30</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&quot;/bin/sh&quot;</span>,<span class="string">&quot;-c&quot;</span>,<span class="string">&quot;while true;do /bin/echo $(date +%T);sleep 60; done;&quot;</span>]</span><br><span class="line">    <span class="attr">env:</span> <span class="comment"># è®¾ç½®ç¯å¢ƒå˜é‡åˆ—è¡¨</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">&quot;username&quot;</span></span><br><span class="line">      <span class="attr">value:</span> <span class="string">&quot;admin&quot;</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">&quot;password&quot;</span></span><br><span class="line">      <span class="attr">value:</span> <span class="string">&quot;123456&quot;</span></span><br></pre></td></tr></table></figure></div>

<p>envï¼Œç¯å¢ƒå˜é‡ï¼Œç”¨äºåœ¨podä¸­çš„å®¹å™¨è®¾ç½®ç¯å¢ƒå˜é‡ã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åˆ›å»ºPod</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl create -f pod-env.yaml</span><br><span class="line">pod/pod-env created</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> è¿›å…¥å®¹å™¨ï¼Œè¾“å‡ºç¯å¢ƒå˜é‡</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl exec pod-env -n dev -c busybox -it /bin/sh</span><br><span class="line">/ # echo $username</span><br><span class="line">admin</span><br><span class="line">/ # echo $password</span><br><span class="line">123456</span><br></pre></td></tr></table></figure></div>

<p>è¿™ç§æ–¹å¼ä¸æ˜¯å¾ˆæ¨èï¼Œæ¨èå°†è¿™äº›é…ç½®å•ç‹¬å­˜å‚¨åœ¨é…ç½®æ–‡ä»¶ä¸­ï¼Œè¿™ç§æ–¹å¼å°†åœ¨åé¢ä»‹ç»ã€‚</p>
<h5 id="5-2-5-ç«¯å£è®¾ç½®"><a href="#5-2-5-ç«¯å£è®¾ç½®" class="headerlink" title="5.2.5 ç«¯å£è®¾ç½®"></a>5.2.5 ç«¯å£è®¾ç½®</h5><p>æœ¬å°èŠ‚æ¥ä»‹ç»å®¹å™¨çš„ç«¯å£è®¾ç½®ï¼Œä¹Ÿå°±æ˜¯containersçš„portsé€‰é¡¹ã€‚</p>
<p>é¦–å…ˆçœ‹ä¸‹portsæ”¯æŒçš„å­é€‰é¡¹ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># kubectl explain pod.spec.containers.ports</span></span><br><span class="line"><span class="attr">KIND:</span>     <span class="string">Pod</span></span><br><span class="line"><span class="attr">VERSION:</span>  <span class="string">v1</span></span><br><span class="line"><span class="attr">RESOURCE:</span> <span class="string">ports</span> <span class="string">&lt;[]Object&gt;</span></span><br><span class="line"><span class="attr">FIELDS:</span></span><br><span class="line">   <span class="string">name</span>         <span class="string">&lt;string&gt;</span>  <span class="comment"># ç«¯å£åç§°ï¼Œå¦‚æœæŒ‡å®šï¼Œå¿…é¡»ä¿è¯nameåœ¨podä¸­æ˜¯å”¯ä¸€çš„		</span></span><br><span class="line">   <span class="string">containerPort&lt;integer&gt;</span> <span class="comment"># å®¹å™¨è¦ç›‘å¬çš„ç«¯å£(0&lt;x&lt;65536)</span></span><br><span class="line">   <span class="string">hostPort</span>     <span class="string">&lt;integer&gt;</span> <span class="comment"># å®¹å™¨è¦åœ¨ä¸»æœºä¸Šå…¬å¼€çš„ç«¯å£ï¼Œå¦‚æœè®¾ç½®ï¼Œä¸»æœºä¸Šåªèƒ½è¿è¡Œå®¹å™¨çš„ä¸€ä¸ªå‰¯æœ¬(ä¸€èˆ¬çœç•¥) </span></span><br><span class="line">   <span class="string">hostIP</span>       <span class="string">&lt;string&gt;</span>  <span class="comment"># è¦å°†å¤–éƒ¨ç«¯å£ç»‘å®šåˆ°çš„ä¸»æœºIP(ä¸€èˆ¬çœç•¥)</span></span><br><span class="line">   <span class="string">protocol</span>     <span class="string">&lt;string&gt;</span>  <span class="comment"># ç«¯å£åè®®ã€‚å¿…é¡»æ˜¯UDPã€TCPæˆ–SCTPã€‚é»˜è®¤ä¸ºâ€œTCPâ€ã€‚</span></span><br></pre></td></tr></table></figure></div>

<p>æ¥ä¸‹æ¥ï¼Œç¼–å†™ä¸€ä¸ªæµ‹è¯•æ¡ˆä¾‹ï¼Œåˆ›å»ºpod-ports.yaml</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pod-ports</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:1.17.1</span></span><br><span class="line">    <span class="attr">ports:</span> <span class="comment"># è®¾ç½®å®¹å™¨æš´éœ²çš„ç«¯å£åˆ—è¡¨</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx-port</span></span><br><span class="line">      <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">      <span class="attr">protocol:</span> <span class="string">TCP</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åˆ›å»ºPod</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl create -f pod-ports.yaml</span><br><span class="line">pod/pod-ports created</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹pod</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> åœ¨ä¸‹é¢å¯ä»¥æ˜æ˜¾çœ‹åˆ°é…ç½®ä¿¡æ¯</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl get pod pod-ports -n dev -o yaml</span><br><span class="line">......</span><br><span class="line">spec:</span><br><span class="line">  containers:</span><br><span class="line">  - image: nginx:1.17.1</span><br><span class="line">    imagePullPolicy: IfNotPresent</span><br><span class="line">    name: nginx</span><br><span class="line">    ports:</span><br><span class="line">    - containerPort: 80</span><br><span class="line">      name: nginx-port</span><br><span class="line">      protocol: TCP</span><br><span class="line">......</span><br></pre></td></tr></table></figure></div>

<p>è®¿é—®å®¹å™¨ä¸­çš„ç¨‹åºéœ€è¦ä½¿ç”¨çš„æ˜¯<code>Podip:containerPort</code></p>
<h5 id="5-2-6-èµ„æºé…é¢"><a href="#5-2-6-èµ„æºé…é¢" class="headerlink" title="5.2.6 èµ„æºé…é¢"></a>5.2.6 èµ„æºé…é¢</h5><p>å®¹å™¨ä¸­çš„ç¨‹åºè¦è¿è¡Œï¼Œè‚¯å®šæ˜¯è¦å ç”¨ä¸€å®šèµ„æºçš„ï¼Œæ¯”å¦‚cpuå’Œå†…å­˜ç­‰ï¼Œå¦‚æœä¸å¯¹æŸä¸ªå®¹å™¨çš„èµ„æºåšé™åˆ¶ï¼Œé‚£ä¹ˆå®ƒå°±å¯èƒ½åƒæ‰å¤§é‡èµ„æºï¼Œå¯¼è‡´å…¶å®ƒå®¹å™¨æ— æ³•è¿è¡Œã€‚é’ˆå¯¹è¿™ç§æƒ…å†µï¼Œkubernetesæä¾›äº†å¯¹å†…å­˜å’Œcpuçš„èµ„æºè¿›è¡Œé…é¢çš„æœºåˆ¶ï¼Œè¿™ç§æœºåˆ¶ä¸»è¦é€šè¿‡resourcesé€‰é¡¹å®ç°ï¼Œä»–æœ‰ä¸¤ä¸ªå­é€‰é¡¹ï¼š</p>
<ul>
<li>limitsï¼šç”¨äºé™åˆ¶è¿è¡Œæ—¶å®¹å™¨çš„æœ€å¤§å ç”¨èµ„æºï¼Œå½“å®¹å™¨å ç”¨èµ„æºè¶…è¿‡limitsæ—¶ä¼šè¢«ç»ˆæ­¢ï¼Œå¹¶è¿›è¡Œé‡å¯</li>
<li>requests ï¼šç”¨äºè®¾ç½®å®¹å™¨éœ€è¦çš„æœ€å°èµ„æºï¼Œå¦‚æœç¯å¢ƒèµ„æºä¸å¤Ÿï¼Œå®¹å™¨å°†æ— æ³•å¯åŠ¨</li>
</ul>
<p>å¯ä»¥é€šè¿‡ä¸Šé¢ä¸¤ä¸ªé€‰é¡¹è®¾ç½®èµ„æºçš„ä¸Šä¸‹é™ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œç¼–å†™ä¸€ä¸ªæµ‹è¯•æ¡ˆä¾‹ï¼Œåˆ›å»ºpod-resources.yaml</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pod-resources</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:1.17.1</span></span><br><span class="line">    <span class="attr">resources:</span> <span class="comment"># èµ„æºé…é¢</span></span><br><span class="line">      <span class="attr">limits:</span>  <span class="comment"># é™åˆ¶èµ„æºï¼ˆä¸Šé™ï¼‰</span></span><br><span class="line">        <span class="attr">cpu:</span> <span class="string">&quot;2&quot;</span> <span class="comment"># CPUé™åˆ¶ï¼Œå•ä½æ˜¯coreæ•°</span></span><br><span class="line">        <span class="attr">memory:</span> <span class="string">&quot;10Gi&quot;</span> <span class="comment"># å†…å­˜é™åˆ¶</span></span><br><span class="line">      <span class="attr">requests:</span> <span class="comment"># è¯·æ±‚èµ„æºï¼ˆä¸‹é™ï¼‰</span></span><br><span class="line">        <span class="attr">cpu:</span> <span class="string">&quot;1&quot;</span>  <span class="comment"># CPUé™åˆ¶ï¼Œå•ä½æ˜¯coreæ•°</span></span><br><span class="line">        <span class="attr">memory:</span> <span class="string">&quot;10Mi&quot;</span>  <span class="comment"># å†…å­˜é™åˆ¶</span></span><br></pre></td></tr></table></figure></div>

<p>åœ¨è¿™å¯¹cpuå’Œmemoryçš„å•ä½åšä¸€ä¸ªè¯´æ˜ï¼š</p>
<ul>
<li>cpuï¼šcoreæ•°ï¼Œå¯ä»¥ä¸ºæ•´æ•°æˆ–å°æ•°</li>
<li>memoryï¼š å†…å­˜å¤§å°ï¼Œå¯ä»¥ä½¿ç”¨Giã€Miã€Gã€Mç­‰å½¢å¼</li>
</ul>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># è¿è¡ŒPod</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># kubectl create  -f pod-resources.yaml</span></span><br><span class="line"><span class="string">pod/pod-resources</span> <span class="string">created</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹å‘ç°podè¿è¡Œæ­£å¸¸</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># kubectl get pod pod-resources -n dev</span></span><br><span class="line"><span class="string">NAME</span>            <span class="string">READY</span>   <span class="string">STATUS</span>    <span class="string">RESTARTS</span>   <span class="string">AGE</span>  </span><br><span class="line"><span class="string">pod-resources</span>   <span class="number">1</span><span class="string">/1</span>     <span class="string">Running</span>   <span class="number">0</span>          <span class="string">39s</span>   </span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¥ä¸‹æ¥ï¼Œåœæ­¢Pod</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># kubectl delete  -f pod-resources.yaml</span></span><br><span class="line"><span class="string">pod</span> <span class="string">&quot;pod-resources&quot;</span> <span class="string">deleted</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç¼–è¾‘podï¼Œä¿®æ”¹resources.requests.memoryçš„å€¼ä¸º10Gi</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># vim pod-resources.yaml</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å†æ¬¡å¯åŠ¨pod</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># kubectl create  -f pod-resources.yaml</span></span><br><span class="line"><span class="string">pod/pod-resources</span> <span class="string">created</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹PodçŠ¶æ€ï¼Œå‘ç°Podå¯åŠ¨å¤±è´¥</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># kubectl get pod pod-resources -n dev -o wide</span></span><br><span class="line"><span class="string">NAME</span>            <span class="string">READY</span>   <span class="string">STATUS</span>    <span class="string">RESTARTS</span>   <span class="string">AGE</span>          </span><br><span class="line"><span class="string">pod-resources</span>   <span class="number">0</span><span class="string">/1</span>     <span class="string">Pending</span>   <span class="number">0</span>          <span class="string">20s</span>    </span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹podè¯¦æƒ…ä¼šå‘ç°ï¼Œå¦‚ä¸‹æç¤º</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># kubectl describe pod pod-resources -n dev</span></span><br><span class="line"><span class="string">......</span></span><br><span class="line"><span class="attr">Warning  FailedScheduling  35s   default-scheduler  0/3 nodes are available:</span> <span class="number">1</span> <span class="string">node(s)</span> <span class="string">had</span> <span class="string">taint</span> &#123;<span class="attr">node-role.kubernetes.io/master:</span> &#125;<span class="string">,</span> <span class="string">that</span> <span class="string">the</span> <span class="string">pod</span> <span class="string">didn&#x27;t</span> <span class="string">tolerate,</span> <span class="number">2</span> <span class="string">Insufficient</span> <span class="string">memory.(å†…å­˜ä¸è¶³)</span></span><br></pre></td></tr></table></figure></div>

<h4 id="5-3-Podç”Ÿå‘½å‘¨æœŸ"><a href="#5-3-Podç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="5.3 Podç”Ÿå‘½å‘¨æœŸ"></a>5.3 Podç”Ÿå‘½å‘¨æœŸ</h4><p>æˆ‘ä»¬ä¸€èˆ¬å°†podå¯¹è±¡ä»åˆ›å»ºè‡³ç»ˆçš„è¿™æ®µæ—¶é—´èŒƒå›´ç§°ä¸ºpodçš„ç”Ÿå‘½å‘¨æœŸï¼Œå®ƒä¸»è¦åŒ…å«ä¸‹é¢çš„è¿‡ç¨‹ï¼š</p>
<ul>
<li>podåˆ›å»ºè¿‡ç¨‹</li>
<li>è¿è¡Œåˆå§‹åŒ–å®¹å™¨ï¼ˆinit containerï¼‰è¿‡ç¨‹</li>
<li>è¿è¡Œä¸»å®¹å™¨ï¼ˆmain containerï¼‰<ul>
<li>å®¹å™¨å¯åŠ¨åé’©å­ï¼ˆpost startï¼‰ã€å®¹å™¨ç»ˆæ­¢å‰é’©å­ï¼ˆpre stopï¼‰</li>
<li>å®¹å™¨çš„å­˜æ´»æ€§æ¢æµ‹ï¼ˆliveness probeï¼‰ã€å°±ç»ªæ€§æ¢æµ‹ï¼ˆreadiness probeï¼‰</li>
</ul>
</li>
<li>podç»ˆæ­¢è¿‡ç¨‹</li>
</ul>
<p><img src="/2022/06/09/uncatalog/cl46zbayg000v7or7a4o0f4yd/image-20200412111402706-1626782188724.png" alt="image-20200412111402706"></p>
<p>åœ¨æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­ï¼ŒPodä¼šå‡ºç°5ç§<strong>çŠ¶æ€</strong>ï¼ˆ<strong>ç›¸ä½</strong>ï¼‰ï¼Œåˆ†åˆ«å¦‚ä¸‹ï¼š</p>
<ul>
<li>æŒ‚èµ·ï¼ˆPendingï¼‰ï¼šapiserverå·²ç»åˆ›å»ºäº†podèµ„æºå¯¹è±¡ï¼Œä½†å®ƒå°šæœªè¢«è°ƒåº¦å®Œæˆæˆ–è€…ä»å¤„äºä¸‹è½½é•œåƒçš„è¿‡ç¨‹ä¸­</li>
<li>è¿è¡Œä¸­ï¼ˆRunningï¼‰ï¼špodå·²ç»è¢«è°ƒåº¦è‡³æŸèŠ‚ç‚¹ï¼Œå¹¶ä¸”æ‰€æœ‰å®¹å™¨éƒ½å·²ç»è¢«kubeletåˆ›å»ºå®Œæˆ</li>
<li>æˆåŠŸï¼ˆSucceededï¼‰ï¼špodä¸­çš„æ‰€æœ‰å®¹å™¨éƒ½å·²ç»æˆåŠŸç»ˆæ­¢å¹¶ä¸”ä¸ä¼šè¢«é‡å¯</li>
<li>å¤±è´¥ï¼ˆFailedï¼‰ï¼šæ‰€æœ‰å®¹å™¨éƒ½å·²ç»ç»ˆæ­¢ï¼Œä½†è‡³å°‘æœ‰ä¸€ä¸ªå®¹å™¨ç»ˆæ­¢å¤±è´¥ï¼Œå³å®¹å™¨è¿”å›äº†é0å€¼çš„é€€å‡ºçŠ¶æ€</li>
<li>æœªçŸ¥ï¼ˆUnknownï¼‰ï¼šapiserveræ— æ³•æ­£å¸¸è·å–åˆ°podå¯¹è±¡çš„çŠ¶æ€ä¿¡æ¯ï¼Œé€šå¸¸ç”±ç½‘ç»œé€šä¿¡å¤±è´¥æ‰€å¯¼è‡´</li>
</ul>
<h5 id="5-3-1-åˆ›å»ºå’Œç»ˆæ­¢"><a href="#5-3-1-åˆ›å»ºå’Œç»ˆæ­¢" class="headerlink" title="5.3.1 åˆ›å»ºå’Œç»ˆæ­¢"></a>5.3.1 åˆ›å»ºå’Œç»ˆæ­¢</h5><p><strong>podçš„åˆ›å»ºè¿‡ç¨‹</strong></p>
<ol>
<li><p>ç”¨æˆ·é€šè¿‡kubectlæˆ–å…¶ä»–apiå®¢æˆ·ç«¯æäº¤éœ€è¦åˆ›å»ºçš„podä¿¡æ¯ç»™apiServer</p>
</li>
<li><p>apiServerå¼€å§‹ç”Ÿæˆpodå¯¹è±¡çš„ä¿¡æ¯ï¼Œå¹¶å°†ä¿¡æ¯å­˜å…¥etcdï¼Œç„¶åè¿”å›ç¡®è®¤ä¿¡æ¯è‡³å®¢æˆ·ç«¯</p>
</li>
<li><p>apiServerå¼€å§‹åæ˜ etcdä¸­çš„podå¯¹è±¡çš„å˜åŒ–ï¼Œå…¶å®ƒç»„ä»¶ä½¿ç”¨watchæœºåˆ¶æ¥è·Ÿè¸ªæ£€æŸ¥apiServerä¸Šçš„å˜åŠ¨</p>
</li>
<li><p>schedulerå‘ç°æœ‰æ–°çš„podå¯¹è±¡è¦åˆ›å»ºï¼Œå¼€å§‹ä¸ºPodåˆ†é…ä¸»æœºå¹¶å°†ç»“æœä¿¡æ¯æ›´æ–°è‡³apiServer</p>
</li>
<li><p>nodeèŠ‚ç‚¹ä¸Šçš„kubeletå‘ç°æœ‰podè°ƒåº¦è¿‡æ¥ï¼Œå°è¯•è°ƒç”¨dockerå¯åŠ¨å®¹å™¨ï¼Œå¹¶å°†ç»“æœå›é€è‡³apiServer</p>
</li>
<li><p>apiServerå°†æ¥æ”¶åˆ°çš„podçŠ¶æ€ä¿¡æ¯å­˜å…¥etcdä¸­</p>
<p><img src="/2022/06/09/uncatalog/cl46zbayg000v7or7a4o0f4yd/image-20200406184656917-1626782168787.png" alt="image-20200406184656917"></p>
</li>
</ol>
<p><strong>podçš„ç»ˆæ­¢è¿‡ç¨‹</strong></p>
<ol>
<li>ç”¨æˆ·å‘apiServerå‘é€åˆ é™¤podå¯¹è±¡çš„å‘½ä»¤</li>
<li>apiServcerä¸­çš„podå¯¹è±¡ä¿¡æ¯ä¼šéšç€æ—¶é—´çš„æ¨ç§»è€Œæ›´æ–°ï¼Œåœ¨å®½é™æœŸå†…ï¼ˆé»˜è®¤30sï¼‰ï¼Œpodè¢«è§†ä¸ºdead</li>
<li>å°†podæ ‡è®°ä¸ºterminatingçŠ¶æ€</li>
<li>kubeletåœ¨ç›‘æ§åˆ°podå¯¹è±¡è½¬ä¸ºterminatingçŠ¶æ€çš„åŒæ—¶å¯åŠ¨podå…³é—­è¿‡ç¨‹</li>
<li>ç«¯ç‚¹æ§åˆ¶å™¨ç›‘æ§åˆ°podå¯¹è±¡çš„å…³é—­è¡Œä¸ºæ—¶å°†å…¶ä»æ‰€æœ‰åŒ¹é…åˆ°æ­¤ç«¯ç‚¹çš„serviceèµ„æºçš„ç«¯ç‚¹åˆ—è¡¨ä¸­ç§»é™¤</li>
<li>å¦‚æœå½“å‰podå¯¹è±¡å®šä¹‰äº†preStopé’©å­å¤„ç†å™¨ï¼Œåˆ™åœ¨å…¶æ ‡è®°ä¸ºterminatingåå³ä¼šä»¥åŒæ­¥çš„æ–¹å¼å¯åŠ¨æ‰§è¡Œ</li>
<li>podå¯¹è±¡ä¸­çš„å®¹å™¨è¿›ç¨‹æ”¶åˆ°åœæ­¢ä¿¡å·</li>
<li>å®½é™æœŸç»“æŸåï¼Œè‹¥podä¸­è¿˜å­˜åœ¨ä»åœ¨è¿è¡Œçš„è¿›ç¨‹ï¼Œé‚£ä¹ˆpodå¯¹è±¡ä¼šæ”¶åˆ°ç«‹å³ç»ˆæ­¢çš„ä¿¡å·</li>
<li>kubeletè¯·æ±‚apiServerå°†æ­¤podèµ„æºçš„å®½é™æœŸè®¾ç½®ä¸º0ä»è€Œå®Œæˆåˆ é™¤æ“ä½œï¼Œæ­¤æ—¶podå¯¹äºç”¨æˆ·å·²ä¸å¯è§</li>
</ol>
<h5 id="5-3-2-åˆå§‹åŒ–å®¹å™¨"><a href="#5-3-2-åˆå§‹åŒ–å®¹å™¨" class="headerlink" title="5.3.2 åˆå§‹åŒ–å®¹å™¨"></a>5.3.2 åˆå§‹åŒ–å®¹å™¨</h5><p>åˆå§‹åŒ–å®¹å™¨æ˜¯åœ¨podçš„ä¸»å®¹å™¨å¯åŠ¨ä¹‹å‰è¦è¿è¡Œçš„å®¹å™¨ï¼Œä¸»è¦æ˜¯åšä¸€äº›ä¸»å®¹å™¨çš„å‰ç½®å·¥ä½œï¼Œå®ƒå…·æœ‰ä¸¤å¤§ç‰¹å¾ï¼š</p>
<ol>
<li>åˆå§‹åŒ–å®¹å™¨å¿…é¡»è¿è¡Œå®Œæˆç›´è‡³ç»“æŸï¼Œè‹¥æŸåˆå§‹åŒ–å®¹å™¨è¿è¡Œå¤±è´¥ï¼Œé‚£ä¹ˆkuberneteséœ€è¦é‡å¯å®ƒç›´åˆ°æˆåŠŸå®Œæˆ</li>
<li>åˆå§‹åŒ–å®¹å™¨å¿…é¡»æŒ‰ç…§å®šä¹‰çš„é¡ºåºæ‰§è¡Œï¼Œå½“ä¸”ä»…å½“å‰ä¸€ä¸ªæˆåŠŸä¹‹åï¼Œåé¢çš„ä¸€ä¸ªæ‰èƒ½è¿è¡Œ</li>
</ol>
<p>åˆå§‹åŒ–å®¹å™¨æœ‰å¾ˆå¤šçš„åº”ç”¨åœºæ™¯ï¼Œä¸‹é¢åˆ—å‡ºçš„æ˜¯æœ€å¸¸è§çš„å‡ ä¸ªï¼š</p>
<ul>
<li>æä¾›ä¸»å®¹å™¨é•œåƒä¸­ä¸å…·å¤‡çš„å·¥å…·ç¨‹åºæˆ–è‡ªå®šä¹‰ä»£ç </li>
<li>åˆå§‹åŒ–å®¹å™¨è¦å…ˆäºåº”ç”¨å®¹å™¨ä¸²è¡Œå¯åŠ¨å¹¶è¿è¡Œå®Œæˆï¼Œå› æ­¤å¯ç”¨äºå»¶ååº”ç”¨å®¹å™¨çš„å¯åŠ¨ç›´è‡³å…¶ä¾èµ–çš„æ¡ä»¶å¾—åˆ°æ»¡è¶³</li>
</ul>
<p>æ¥ä¸‹æ¥åšä¸€ä¸ªæ¡ˆä¾‹ï¼Œæ¨¡æ‹Ÿä¸‹é¢è¿™ä¸ªéœ€æ±‚ï¼š</p>
<p>å‡è®¾è¦ä»¥ä¸»å®¹å™¨æ¥è¿è¡Œnginxï¼Œä½†æ˜¯è¦æ±‚åœ¨è¿è¡Œnginxä¹‹å‰å…ˆè¦èƒ½å¤Ÿè¿æ¥ä¸Šmysqlå’Œredisæ‰€åœ¨æœåŠ¡å™¨</p>
<p>ä¸ºäº†ç®€åŒ–æµ‹è¯•ï¼Œäº‹å…ˆè§„å®šå¥½mysql<code>(192.168.90.14)</code>å’Œredis<code>(192.168.90.15)</code>æœåŠ¡å™¨çš„åœ°å€</p>
<p>åˆ›å»ºpod-initcontainer.yamlï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pod-initcontainer</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">main-container</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:1.17.1</span></span><br><span class="line">    <span class="attr">ports:</span> </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx-port</span></span><br><span class="line">      <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">  <span class="attr">initContainers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">test-mysql</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">busybox:1.30</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&#x27;sh&#x27;</span>, <span class="string">&#x27;-c&#x27;</span>, <span class="string">&#x27;until ping 192.168.90.14 -c 1 ; do echo waiting for mysql...; sleep 2; done;&#x27;</span>]</span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">test-redis</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">busybox:1.30</span></span><br><span class="line">    <span class="attr">command:</span> [<span class="string">&#x27;sh&#x27;</span>, <span class="string">&#x27;-c&#x27;</span>, <span class="string">&#x27;until ping 192.168.90.15 -c 1 ; do echo waiting for reids...; sleep 2; done;&#x27;</span>]</span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºpod</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># kubectl create -f pod-initcontainer.yaml</span></span><br><span class="line"><span class="string">pod/pod-initcontainer</span> <span class="string">created</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹podçŠ¶æ€</span></span><br><span class="line"><span class="comment"># å‘ç°podå¡åœ¨å¯åŠ¨ç¬¬ä¸€ä¸ªåˆå§‹åŒ–å®¹å™¨è¿‡ç¨‹ä¸­ï¼Œåé¢çš„å®¹å™¨ä¸ä¼šè¿è¡Œ</span></span><br><span class="line"><span class="string">root@k8s-master01</span> <span class="string">~]#</span> <span class="string">kubectl</span> <span class="string">describe</span> <span class="string">pod</span>  <span class="string">pod-initcontainer</span> <span class="string">-n</span> <span class="string">dev</span></span><br><span class="line"><span class="string">........</span></span><br><span class="line"><span class="attr">Events:</span></span><br><span class="line">  <span class="string">Type</span>    <span class="string">Reason</span>     <span class="string">Age</span>   <span class="string">From</span>               <span class="string">Message</span></span><br><span class="line">  <span class="string">----</span>    <span class="string">------</span>     <span class="string">----</span>  <span class="string">----</span>               <span class="string">-------</span></span><br><span class="line">  <span class="string">Normal</span>  <span class="string">Scheduled</span>  <span class="string">49s</span>   <span class="string">default-scheduler</span>  <span class="string">Successfully</span> <span class="string">assigned</span> <span class="string">dev/pod-initcontainer</span> <span class="string">to</span> <span class="string">node1</span></span><br><span class="line">  <span class="string">Normal</span>  <span class="string">Pulled</span>     <span class="string">48s</span>   <span class="string">kubelet,</span> <span class="string">node1</span>     <span class="string">Container</span> <span class="string">image</span> <span class="string">&quot;busybox:1.30&quot;</span> <span class="string">already</span> <span class="string">present</span> <span class="string">on</span> <span class="string">machine</span></span><br><span class="line">  <span class="string">Normal</span>  <span class="string">Created</span>    <span class="string">48s</span>   <span class="string">kubelet,</span> <span class="string">node1</span>     <span class="string">Created</span> <span class="string">container</span> <span class="string">test-mysql</span></span><br><span class="line">  <span class="string">Normal</span>  <span class="string">Started</span>    <span class="string">48s</span>   <span class="string">kubelet,</span> <span class="string">node1</span>     <span class="string">Started</span> <span class="string">container</span> <span class="string">test-mysql</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åŠ¨æ€æŸ¥çœ‹pod</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># kubectl get pods pod-initcontainer -n dev -w</span></span><br><span class="line"><span class="string">NAME</span>                             <span class="string">READY</span>   <span class="string">STATUS</span>     <span class="string">RESTARTS</span>   <span class="string">AGE</span></span><br><span class="line"><span class="string">pod-initcontainer</span>                <span class="number">0</span><span class="string">/1</span>     <span class="string">Init:0/2</span>   <span class="number">0</span>          <span class="string">15s</span></span><br><span class="line"><span class="string">pod-initcontainer</span>                <span class="number">0</span><span class="string">/1</span>     <span class="string">Init:1/2</span>   <span class="number">0</span>          <span class="string">52s</span></span><br><span class="line"><span class="string">pod-initcontainer</span>                <span class="number">0</span><span class="string">/1</span>     <span class="string">Init:1/2</span>   <span class="number">0</span>          <span class="string">53s</span></span><br><span class="line"><span class="string">pod-initcontainer</span>                <span class="number">0</span><span class="string">/1</span>     <span class="string">PodInitializing</span>   <span class="number">0</span>          <span class="string">89s</span></span><br><span class="line"><span class="string">pod-initcontainer</span>                <span class="number">1</span><span class="string">/1</span>     <span class="string">Running</span>           <span class="number">0</span>          <span class="string">90s</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¥ä¸‹æ¥æ–°å¼€ä¸€ä¸ªshellï¼Œä¸ºå½“å‰æœåŠ¡å™¨æ–°å¢ä¸¤ä¸ªipï¼Œè§‚å¯Ÿpodçš„å˜åŒ–</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># ifconfig ens33:1 192.168.90.14 netmask 255.255.255.0 up</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># ifconfig ens33:2 192.168.90.15 netmask 255.255.255.0 up</span></span><br></pre></td></tr></table></figure></div>

<h5 id="5-3-3-é’©å­å‡½æ•°"><a href="#5-3-3-é’©å­å‡½æ•°" class="headerlink" title="5.3.3 é’©å­å‡½æ•°"></a>5.3.3 é’©å­å‡½æ•°</h5><p>é’©å­å‡½æ•°èƒ½å¤Ÿæ„ŸçŸ¥è‡ªèº«ç”Ÿå‘½å‘¨æœŸä¸­çš„äº‹ä»¶ï¼Œå¹¶åœ¨ç›¸åº”çš„æ—¶åˆ»åˆ°æ¥æ—¶è¿è¡Œç”¨æˆ·æŒ‡å®šçš„ç¨‹åºä»£ç ã€‚</p>
<p>kubernetesåœ¨ä¸»å®¹å™¨çš„å¯åŠ¨ä¹‹åå’Œåœæ­¢ä¹‹å‰æä¾›äº†ä¸¤ä¸ªé’©å­å‡½æ•°ï¼š</p>
<ul>
<li>post startï¼šå®¹å™¨åˆ›å»ºä¹‹åæ‰§è¡Œï¼Œå¦‚æœå¤±è´¥äº†ä¼šé‡å¯å®¹å™¨</li>
<li>pre stop ï¼šå®¹å™¨ç»ˆæ­¢ä¹‹å‰æ‰§è¡Œï¼Œæ‰§è¡Œå®Œæˆä¹‹åå®¹å™¨å°†æˆåŠŸç»ˆæ­¢ï¼Œåœ¨å…¶å®Œæˆä¹‹å‰ä¼šé˜»å¡åˆ é™¤å®¹å™¨çš„æ“ä½œ</li>
</ul>
<p>é’©å­å¤„ç†å™¨æ”¯æŒä½¿ç”¨ä¸‹é¢ä¸‰ç§æ–¹å¼å®šä¹‰åŠ¨ä½œï¼š</p>
<ul>
<li><p>Execå‘½ä»¤ï¼šåœ¨å®¹å™¨å†…æ‰§è¡Œä¸€æ¬¡å‘½ä»¤</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">â€¦â€¦</span></span><br><span class="line">  <span class="attr">lifecycle:</span></span><br><span class="line">    <span class="attr">postStart:</span> </span><br><span class="line">      <span class="attr">exec:</span></span><br><span class="line">        <span class="attr">command:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">cat</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">/tmp/healthy</span></span><br><span class="line"><span class="string">â€¦â€¦</span></span><br></pre></td></tr></table></figure></div></li>
<li><p>TCPSocketï¼šåœ¨å½“å‰å®¹å™¨å°è¯•è®¿é—®æŒ‡å®šçš„socket</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">â€¦â€¦</span>      </span><br><span class="line">  <span class="attr">lifecycle:</span></span><br><span class="line">    <span class="attr">postStart:</span></span><br><span class="line">      <span class="attr">tcpSocket:</span></span><br><span class="line">        <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line"><span class="string">â€¦â€¦</span></span><br></pre></td></tr></table></figure></div></li>
<li><p>HTTPGetï¼šåœ¨å½“å‰å®¹å™¨ä¸­å‘æŸurlå‘èµ·httpè¯·æ±‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">â€¦â€¦</span></span><br><span class="line">  <span class="attr">lifecycle:</span></span><br><span class="line">    <span class="attr">postStart:</span></span><br><span class="line">      <span class="attr">httpGet:</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">/</span> <span class="comment">#URIåœ°å€</span></span><br><span class="line">        <span class="attr">port:</span> <span class="number">80</span> <span class="comment">#ç«¯å£å·</span></span><br><span class="line">        <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.5</span><span class="number">.3</span> <span class="comment">#ä¸»æœºåœ°å€</span></span><br><span class="line">        <span class="attr">scheme:</span> <span class="string">HTTP</span> <span class="comment">#æ”¯æŒçš„åè®®ï¼Œhttpæˆ–è€…https</span></span><br><span class="line"><span class="string">â€¦â€¦</span></span><br></pre></td></tr></table></figure></div></li>
</ul>
<p>æ¥ä¸‹æ¥ï¼Œä»¥execæ–¹å¼ä¸ºä¾‹ï¼Œæ¼”ç¤ºä¸‹é’©å­å‡½æ•°çš„ä½¿ç”¨ï¼Œåˆ›å»ºpod-hook-exec.yamlæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pod-hook-exec</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">main-container</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:1.17.1</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx-port</span></span><br><span class="line">      <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">lifecycle:</span></span><br><span class="line">      <span class="attr">postStart:</span> </span><br><span class="line">        <span class="attr">exec:</span> <span class="comment"># åœ¨å®¹å™¨å¯åŠ¨çš„æ—¶å€™æ‰§è¡Œä¸€ä¸ªå‘½ä»¤ï¼Œä¿®æ”¹æ‰nginxçš„é»˜è®¤é¦–é¡µå†…å®¹</span></span><br><span class="line">          <span class="attr">command:</span> [<span class="string">&quot;/bin/sh&quot;</span>, <span class="string">&quot;-c&quot;</span>, <span class="string">&quot;echo postStart... &gt; /usr/share/nginx/html/index.html&quot;</span>]</span><br><span class="line">      <span class="attr">preStop:</span></span><br><span class="line">        <span class="attr">exec:</span> <span class="comment"># åœ¨å®¹å™¨åœæ­¢ä¹‹å‰åœæ­¢nginxæœåŠ¡</span></span><br><span class="line">          <span class="attr">command:</span> [<span class="string">&quot;/usr/sbin/nginx&quot;</span>,<span class="string">&quot;-s&quot;</span>,<span class="string">&quot;quit&quot;</span>]</span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºpod</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># kubectl create -f pod-hook-exec.yaml</span></span><br><span class="line"><span class="string">pod/pod-hook-exec</span> <span class="string">created</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹pod</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># kubectl get pods  pod-hook-exec -n dev -o wide</span></span><br><span class="line"><span class="string">NAME</span>           <span class="string">READY</span>   <span class="string">STATUS</span>     <span class="string">RESTARTS</span>   <span class="string">AGE</span>    <span class="string">IP</span>            <span class="string">NODE</span>    </span><br><span class="line"><span class="string">pod-hook-exec</span>  <span class="number">1</span><span class="string">/1</span>     <span class="string">Running</span>    <span class="number">0</span>          <span class="string">29s</span>    <span class="number">10.244</span><span class="number">.2</span><span class="number">.48</span>   <span class="string">node2</span>   </span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¿é—®pod</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># curl 10.244.2.48</span></span><br><span class="line"><span class="string">postStart...</span></span><br></pre></td></tr></table></figure></div>

<h5 id="5-3-4-å®¹å™¨æ¢æµ‹"><a href="#5-3-4-å®¹å™¨æ¢æµ‹" class="headerlink" title="5.3.4 å®¹å™¨æ¢æµ‹"></a>5.3.4 å®¹å™¨æ¢æµ‹</h5><p>å®¹å™¨æ¢æµ‹ç”¨äºæ£€æµ‹å®¹å™¨ä¸­çš„åº”ç”¨å®ä¾‹æ˜¯å¦æ­£å¸¸å·¥ä½œï¼Œæ˜¯ä¿éšœä¸šåŠ¡å¯ç”¨æ€§çš„ä¸€ç§ä¼ ç»Ÿæœºåˆ¶ã€‚å¦‚æœç»è¿‡æ¢æµ‹ï¼Œå®ä¾‹çš„çŠ¶æ€ä¸ç¬¦åˆé¢„æœŸï¼Œé‚£ä¹ˆkuberneteså°±ä¼šæŠŠè¯¥é—®é¢˜å®ä¾‹â€ æ‘˜é™¤ â€œï¼Œä¸æ‰¿æ‹…ä¸šåŠ¡æµé‡ã€‚kubernetesæä¾›äº†ä¸¤ç§æ¢é’ˆæ¥å®ç°å®¹å™¨æ¢æµ‹ï¼Œåˆ†åˆ«æ˜¯ï¼š</p>
<ul>
<li>liveness probesï¼šå­˜æ´»æ€§æ¢é’ˆï¼Œç”¨äºæ£€æµ‹åº”ç”¨å®ä¾‹å½“å‰æ˜¯å¦å¤„äºæ­£å¸¸è¿è¡ŒçŠ¶æ€ï¼Œå¦‚æœä¸æ˜¯ï¼Œk8sä¼šé‡å¯å®¹å™¨</li>
<li>readiness probesï¼šå°±ç»ªæ€§æ¢é’ˆï¼Œç”¨äºæ£€æµ‹åº”ç”¨å®ä¾‹å½“å‰æ˜¯å¦å¯ä»¥æ¥æ”¶è¯·æ±‚ï¼Œå¦‚æœä¸èƒ½ï¼Œk8sä¸ä¼šè½¬å‘æµé‡</li>
</ul>
<blockquote>
<p>livenessProbe å†³å®šæ˜¯å¦é‡å¯å®¹å™¨ï¼ŒreadinessProbe å†³å®šæ˜¯å¦å°†è¯·æ±‚è½¬å‘ç»™å®¹å™¨ã€‚</p>
</blockquote>
<p>ä¸Šé¢ä¸¤ç§æ¢é’ˆç›®å‰å‡æ”¯æŒä¸‰ç§æ¢æµ‹æ–¹å¼ï¼š</p>
<ul>
<li><p>Execå‘½ä»¤ï¼šåœ¨å®¹å™¨å†…æ‰§è¡Œä¸€æ¬¡å‘½ä»¤ï¼Œå¦‚æœå‘½ä»¤æ‰§è¡Œçš„é€€å‡ºç ä¸º0ï¼Œåˆ™è®¤ä¸ºç¨‹åºæ­£å¸¸ï¼Œå¦åˆ™ä¸æ­£å¸¸</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">â€¦â€¦</span></span><br><span class="line">  <span class="attr">livenessProbe:</span></span><br><span class="line">    <span class="attr">exec:</span></span><br><span class="line">      <span class="attr">command:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">cat</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">/tmp/healthy</span></span><br><span class="line"><span class="string">â€¦â€¦</span></span><br></pre></td></tr></table></figure></div></li>
<li><p>TCPSocketï¼šå°†ä¼šå°è¯•è®¿é—®ä¸€ä¸ªç”¨æˆ·å®¹å™¨çš„ç«¯å£ï¼Œå¦‚æœèƒ½å¤Ÿå»ºç«‹è¿™æ¡è¿æ¥ï¼Œåˆ™è®¤ä¸ºç¨‹åºæ­£å¸¸ï¼Œå¦åˆ™ä¸æ­£å¸¸</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">â€¦â€¦</span>      </span><br><span class="line">  <span class="attr">livenessProbe:</span></span><br><span class="line">    <span class="attr">tcpSocket:</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line"><span class="string">â€¦â€¦</span></span><br></pre></td></tr></table></figure></div></li>
<li><p>HTTPGetï¼šè°ƒç”¨å®¹å™¨å†…Webåº”ç”¨çš„URLï¼Œå¦‚æœè¿”å›çš„çŠ¶æ€ç åœ¨200å’Œ399ä¹‹é—´ï¼Œåˆ™è®¤ä¸ºç¨‹åºæ­£å¸¸ï¼Œå¦åˆ™ä¸æ­£å¸¸</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">â€¦â€¦</span></span><br><span class="line">  <span class="attr">livenessProbe:</span></span><br><span class="line">    <span class="attr">httpGet:</span></span><br><span class="line">      <span class="attr">path:</span> <span class="string">/</span> <span class="comment">#URIåœ°å€</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">80</span> <span class="comment">#ç«¯å£å·</span></span><br><span class="line">      <span class="attr">host:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span> <span class="comment">#ä¸»æœºåœ°å€</span></span><br><span class="line">      <span class="attr">scheme:</span> <span class="string">HTTP</span> <span class="comment">#æ”¯æŒçš„åè®®ï¼Œhttpæˆ–è€…https</span></span><br><span class="line"><span class="string">â€¦â€¦</span></span><br></pre></td></tr></table></figure></div></li>
</ul>
<p>ä¸‹é¢ä»¥liveness probesä¸ºä¾‹ï¼Œåšå‡ ä¸ªæ¼”ç¤ºï¼š</p>
<p><strong>æ–¹å¼ä¸€ï¼šExec</strong></p>
<p>åˆ›å»ºpod-liveness-exec.yaml</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pod-liveness-exec</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:1.17.1</span></span><br><span class="line">    <span class="attr">ports:</span> </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx-port</span></span><br><span class="line">      <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">livenessProbe:</span></span><br><span class="line">      <span class="attr">exec:</span></span><br><span class="line">        <span class="attr">command:</span> [<span class="string">&quot;/bin/cat&quot;</span>,<span class="string">&quot;/tmp/hello.txt&quot;</span>] <span class="comment"># æ‰§è¡Œä¸€ä¸ªæŸ¥çœ‹æ–‡ä»¶çš„å‘½ä»¤</span></span><br></pre></td></tr></table></figure></div>

<p>åˆ›å»ºpodï¼Œè§‚å¯Ÿæ•ˆæœ</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºPod</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># kubectl create -f pod-liveness-exec.yaml</span></span><br><span class="line"><span class="string">pod/pod-liveness-exec</span> <span class="string">created</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹Podè¯¦æƒ…</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># kubectl describe pods pod-liveness-exec -n dev</span></span><br><span class="line"><span class="string">......</span></span><br><span class="line">  <span class="string">Normal</span>   <span class="string">Created</span>    <span class="string">20s</span> <span class="string">(x2</span> <span class="string">over</span> <span class="string">50s)</span>  <span class="string">kubelet,</span> <span class="string">node1</span>     <span class="string">Created</span> <span class="string">container</span> <span class="string">nginx</span></span><br><span class="line">  <span class="string">Normal</span>   <span class="string">Started</span>    <span class="string">20s</span> <span class="string">(x2</span> <span class="string">over</span> <span class="string">50s)</span>  <span class="string">kubelet,</span> <span class="string">node1</span>     <span class="string">Started</span> <span class="string">container</span> <span class="string">nginx</span></span><br><span class="line">  <span class="string">Normal</span>   <span class="string">Killing</span>    <span class="string">20s</span>                <span class="string">kubelet,</span> <span class="string">node1</span>     <span class="string">Container</span> <span class="string">nginx</span> <span class="string">failed</span> <span class="string">liveness</span> <span class="string">probe,</span> <span class="string">will</span> <span class="string">be</span> <span class="string">restarted</span></span><br><span class="line">  <span class="string">Warning</span>  <span class="string">Unhealthy</span>  <span class="string">0s</span> <span class="string">(x5</span> <span class="string">over</span> <span class="string">40s)</span>   <span class="string">kubelet,</span> <span class="attr">node1     Liveness probe failed: cat:</span> <span class="string">can&#x27;t</span> <span class="string">open</span> <span class="string">&#x27;/tmp/hello11.txt&#x27;</span><span class="string">:</span> <span class="literal">No</span> <span class="string">such</span> <span class="string">file</span> <span class="string">or</span> <span class="string">directory</span></span><br><span class="line">  </span><br><span class="line"><span class="comment"># è§‚å¯Ÿä¸Šé¢çš„ä¿¡æ¯å°±ä¼šå‘ç°nginxå®¹å™¨å¯åŠ¨ä¹‹åå°±è¿›è¡Œäº†å¥åº·æ£€æŸ¥</span></span><br><span class="line"><span class="comment"># æ£€æŸ¥å¤±è´¥ä¹‹åï¼Œå®¹å™¨è¢«killæ‰ï¼Œç„¶åå°è¯•è¿›è¡Œé‡å¯ï¼ˆè¿™æ˜¯é‡å¯ç­–ç•¥çš„ä½œç”¨ï¼Œåé¢è®²è§£ï¼‰</span></span><br><span class="line"><span class="comment"># ç¨ç­‰ä¸€ä¼šä¹‹åï¼Œå†è§‚å¯Ÿpodä¿¡æ¯ï¼Œå°±å¯ä»¥çœ‹åˆ°RESTARTSä¸å†æ˜¯0ï¼Œè€Œæ˜¯ä¸€ç›´å¢é•¿</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># kubectl get pods pod-liveness-exec -n dev</span></span><br><span class="line"><span class="string">NAME</span>                <span class="string">READY</span>   <span class="string">STATUS</span>             <span class="string">RESTARTS</span>   <span class="string">AGE</span></span><br><span class="line"><span class="string">pod-liveness-exec</span>   <span class="number">0</span><span class="string">/1</span>     <span class="string">CrashLoopBackOff</span>   <span class="number">2</span>          <span class="string">3m19s</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å½“ç„¶æ¥ä¸‹æ¥ï¼Œå¯ä»¥ä¿®æ”¹æˆä¸€ä¸ªå­˜åœ¨çš„æ–‡ä»¶ï¼Œæ¯”å¦‚/tmp/hello.txtï¼Œå†è¯•ï¼Œç»“æœå°±æ­£å¸¸äº†......</span></span><br></pre></td></tr></table></figure></div>

<p><strong>æ–¹å¼äºŒï¼šTCPSocket</strong></p>
<p>åˆ›å»ºpod-liveness-tcpsocket.yaml</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pod-liveness-tcpsocket</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:1.17.1</span></span><br><span class="line">    <span class="attr">ports:</span> </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx-port</span></span><br><span class="line">      <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">livenessProbe:</span></span><br><span class="line">      <span class="attr">tcpSocket:</span></span><br><span class="line">        <span class="attr">port:</span> <span class="number">8080</span> <span class="comment"># å°è¯•è®¿é—®8080ç«¯å£</span></span><br></pre></td></tr></table></figure></div>

<p>åˆ›å»ºpodï¼Œè§‚å¯Ÿæ•ˆæœ</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºPod</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># kubectl create -f pod-liveness-tcpsocket.yaml</span></span><br><span class="line"><span class="string">pod/pod-liveness-tcpsocket</span> <span class="string">created</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹Podè¯¦æƒ…</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># kubectl describe pods pod-liveness-tcpsocket -n dev</span></span><br><span class="line"><span class="string">......</span></span><br><span class="line">  <span class="string">Normal</span>   <span class="string">Scheduled</span>  <span class="string">31s</span>                            <span class="string">default-scheduler</span>  <span class="string">Successfully</span> <span class="string">assigned</span> <span class="string">dev/pod-liveness-tcpsocket</span> <span class="string">to</span> <span class="string">node2</span></span><br><span class="line">  <span class="string">Normal</span>   <span class="string">Pulled</span>     <span class="string">&lt;invalid&gt;</span>                      <span class="string">kubelet,</span> <span class="string">node2</span>     <span class="string">Container</span> <span class="string">image</span> <span class="string">&quot;nginx:1.17.1&quot;</span> <span class="string">already</span> <span class="string">present</span> <span class="string">on</span> <span class="string">machine</span></span><br><span class="line">  <span class="string">Normal</span>   <span class="string">Created</span>    <span class="string">&lt;invalid&gt;</span>                      <span class="string">kubelet,</span> <span class="string">node2</span>     <span class="string">Created</span> <span class="string">container</span> <span class="string">nginx</span></span><br><span class="line">  <span class="string">Normal</span>   <span class="string">Started</span>    <span class="string">&lt;invalid&gt;</span>                      <span class="string">kubelet,</span> <span class="string">node2</span>     <span class="string">Started</span> <span class="string">container</span> <span class="string">nginx</span></span><br><span class="line">  <span class="string">Warning</span>  <span class="string">Unhealthy</span>  <span class="string">&lt;invalid&gt;</span> <span class="string">(x2</span> <span class="string">over</span> <span class="string">&lt;invalid&gt;)</span>  <span class="string">kubelet,</span> <span class="attr">node2     Liveness probe failed: dial tcp 10.244.2.44:8080: connect:</span> <span class="string">connection</span> <span class="string">refused</span></span><br><span class="line">  </span><br><span class="line"><span class="comment"># è§‚å¯Ÿä¸Šé¢çš„ä¿¡æ¯ï¼Œå‘ç°å°è¯•è®¿é—®8080ç«¯å£,ä½†æ˜¯å¤±è´¥äº†</span></span><br><span class="line"><span class="comment"># ç¨ç­‰ä¸€ä¼šä¹‹åï¼Œå†è§‚å¯Ÿpodä¿¡æ¯ï¼Œå°±å¯ä»¥çœ‹åˆ°RESTARTSä¸å†æ˜¯0ï¼Œè€Œæ˜¯ä¸€ç›´å¢é•¿</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># kubectl get pods pod-liveness-tcpsocket  -n dev</span></span><br><span class="line"><span class="string">NAME</span>                     <span class="string">READY</span>   <span class="string">STATUS</span>             <span class="string">RESTARTS</span>   <span class="string">AGE</span></span><br><span class="line"><span class="string">pod-liveness-tcpsocket</span>   <span class="number">0</span><span class="string">/1</span>     <span class="string">CrashLoopBackOff</span>   <span class="number">2</span>          <span class="string">3m19s</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å½“ç„¶æ¥ä¸‹æ¥ï¼Œå¯ä»¥ä¿®æ”¹æˆä¸€ä¸ªå¯ä»¥è®¿é—®çš„ç«¯å£ï¼Œæ¯”å¦‚80ï¼Œå†è¯•ï¼Œç»“æœå°±æ­£å¸¸äº†......</span></span><br></pre></td></tr></table></figure></div>

<p><strong>æ–¹å¼ä¸‰ï¼šHTTPGet</strong></p>
<p>åˆ›å»ºpod-liveness-httpget.yaml</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pod-liveness-httpget</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:1.17.1</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx-port</span></span><br><span class="line">      <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">livenessProbe:</span></span><br><span class="line">      <span class="attr">httpGet:</span>  <span class="comment"># å…¶å®å°±æ˜¯è®¿é—®http://127.0.0.1:80/hello  </span></span><br><span class="line">        <span class="attr">scheme:</span> <span class="string">HTTP</span> <span class="comment">#æ”¯æŒçš„åè®®ï¼Œhttpæˆ–è€…https</span></span><br><span class="line">        <span class="attr">port:</span> <span class="number">80</span> <span class="comment">#ç«¯å£å·</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">/hello</span> <span class="comment">#URIåœ°å€</span></span><br></pre></td></tr></table></figure></div>

<p>åˆ›å»ºpodï¼Œè§‚å¯Ÿæ•ˆæœ</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºPod</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># kubectl create -f pod-liveness-httpget.yaml</span></span><br><span class="line"><span class="string">pod/pod-liveness-httpget</span> <span class="string">created</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹Podè¯¦æƒ…</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># kubectl describe pod pod-liveness-httpget -n dev</span></span><br><span class="line"><span class="string">.......</span></span><br><span class="line">  <span class="string">Normal</span>   <span class="string">Pulled</span>     <span class="string">6s</span> <span class="string">(x3</span> <span class="string">over</span> <span class="string">64s)</span>  <span class="string">kubelet,</span> <span class="string">node1</span>     <span class="string">Container</span> <span class="string">image</span> <span class="string">&quot;nginx:1.17.1&quot;</span> <span class="string">already</span> <span class="string">present</span> <span class="string">on</span> <span class="string">machine</span></span><br><span class="line">  <span class="string">Normal</span>   <span class="string">Created</span>    <span class="string">6s</span> <span class="string">(x3</span> <span class="string">over</span> <span class="string">64s)</span>  <span class="string">kubelet,</span> <span class="string">node1</span>     <span class="string">Created</span> <span class="string">container</span> <span class="string">nginx</span></span><br><span class="line">  <span class="string">Normal</span>   <span class="string">Started</span>    <span class="string">6s</span> <span class="string">(x3</span> <span class="string">over</span> <span class="string">63s)</span>  <span class="string">kubelet,</span> <span class="string">node1</span>     <span class="string">Started</span> <span class="string">container</span> <span class="string">nginx</span></span><br><span class="line">  <span class="string">Warning</span>  <span class="string">Unhealthy</span>  <span class="string">6s</span> <span class="string">(x6</span> <span class="string">over</span> <span class="string">56s)</span>  <span class="string">kubelet,</span> <span class="attr">node1     Liveness probe failed: HTTP probe failed with statuscode:</span> <span class="number">404</span></span><br><span class="line">  <span class="string">Normal</span>   <span class="string">Killing</span>    <span class="string">6s</span> <span class="string">(x2</span> <span class="string">over</span> <span class="string">36s)</span>  <span class="string">kubelet,</span> <span class="string">node1</span>     <span class="string">Container</span> <span class="string">nginx</span> <span class="string">failed</span> <span class="string">liveness</span> <span class="string">probe,</span> <span class="string">will</span> <span class="string">be</span> <span class="string">restarted</span></span><br><span class="line">  </span><br><span class="line"><span class="comment"># è§‚å¯Ÿä¸Šé¢ä¿¡æ¯ï¼Œå°è¯•è®¿é—®è·¯å¾„ï¼Œä½†æ˜¯æœªæ‰¾åˆ°,å‡ºç°404é”™è¯¯</span></span><br><span class="line"><span class="comment"># ç¨ç­‰ä¸€ä¼šä¹‹åï¼Œå†è§‚å¯Ÿpodä¿¡æ¯ï¼Œå°±å¯ä»¥çœ‹åˆ°RESTARTSä¸å†æ˜¯0ï¼Œè€Œæ˜¯ä¸€ç›´å¢é•¿</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># kubectl get pod pod-liveness-httpget -n dev</span></span><br><span class="line"><span class="string">NAME</span>                   <span class="string">READY</span>   <span class="string">STATUS</span>    <span class="string">RESTARTS</span>   <span class="string">AGE</span></span><br><span class="line"><span class="string">pod-liveness-httpget</span>   <span class="number">1</span><span class="string">/1</span>     <span class="string">Running</span>   <span class="number">5</span>          <span class="string">3m17s</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å½“ç„¶æ¥ä¸‹æ¥ï¼Œå¯ä»¥ä¿®æ”¹æˆä¸€ä¸ªå¯ä»¥è®¿é—®çš„è·¯å¾„pathï¼Œæ¯”å¦‚/ï¼Œå†è¯•ï¼Œç»“æœå°±æ­£å¸¸äº†......</span></span><br></pre></td></tr></table></figure></div>

<p>è‡³æ­¤ï¼Œå·²ç»ä½¿ç”¨liveness Probeæ¼”ç¤ºäº†ä¸‰ç§æ¢æµ‹æ–¹å¼ï¼Œä½†æ˜¯æŸ¥çœ‹livenessProbeçš„å­å±æ€§ï¼Œä¼šå‘ç°é™¤äº†è¿™ä¸‰ç§æ–¹å¼ï¼Œè¿˜æœ‰ä¸€äº›å…¶ä»–çš„é…ç½®ï¼Œåœ¨è¿™é‡Œä¸€å¹¶è§£é‡Šä¸‹ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># kubectl explain pod.spec.containers.livenessProbe</span></span><br><span class="line"><span class="attr">FIELDS:</span></span><br><span class="line">   <span class="string">exec</span> <span class="string">&lt;Object&gt;</span>  </span><br><span class="line">   <span class="string">tcpSocket</span>    <span class="string">&lt;Object&gt;</span></span><br><span class="line">   <span class="string">httpGet</span>      <span class="string">&lt;Object&gt;</span></span><br><span class="line">   <span class="string">initialDelaySeconds</span>  <span class="string">&lt;integer&gt;</span>  <span class="comment"># å®¹å™¨å¯åŠ¨åç­‰å¾…å¤šå°‘ç§’æ‰§è¡Œç¬¬ä¸€æ¬¡æ¢æµ‹</span></span><br><span class="line">   <span class="string">timeoutSeconds</span>       <span class="string">&lt;integer&gt;</span>  <span class="comment"># æ¢æµ‹è¶…æ—¶æ—¶é—´ã€‚é»˜è®¤1ç§’ï¼Œæœ€å°1ç§’</span></span><br><span class="line">   <span class="string">periodSeconds</span>        <span class="string">&lt;integer&gt;</span>  <span class="comment"># æ‰§è¡Œæ¢æµ‹çš„é¢‘ç‡ã€‚é»˜è®¤æ˜¯10ç§’ï¼Œæœ€å°1ç§’</span></span><br><span class="line">   <span class="string">failureThreshold</span>     <span class="string">&lt;integer&gt;</span>  <span class="comment"># è¿ç»­æ¢æµ‹å¤±è´¥å¤šå°‘æ¬¡æ‰è¢«è®¤å®šä¸ºå¤±è´¥ã€‚é»˜è®¤æ˜¯3ã€‚æœ€å°å€¼æ˜¯1</span></span><br><span class="line">   <span class="string">successThreshold</span>     <span class="string">&lt;integer&gt;</span>  <span class="comment"># è¿ç»­æ¢æµ‹æˆåŠŸå¤šå°‘æ¬¡æ‰è¢«è®¤å®šä¸ºæˆåŠŸã€‚é»˜è®¤æ˜¯1</span></span><br></pre></td></tr></table></figure></div>

<p>ä¸‹é¢ç¨å¾®é…ç½®ä¸¤ä¸ªï¼Œæ¼”ç¤ºä¸‹æ•ˆæœå³å¯ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># more pod-liveness-httpget.yaml</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pod-liveness-httpget</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:1.17.1</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx-port</span></span><br><span class="line">      <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">livenessProbe:</span></span><br><span class="line">      <span class="attr">httpGet:</span></span><br><span class="line">        <span class="attr">scheme:</span> <span class="string">HTTP</span></span><br><span class="line">        <span class="attr">port:</span> <span class="number">80</span> </span><br><span class="line">        <span class="attr">path:</span> <span class="string">/</span></span><br><span class="line">      <span class="attr">initialDelaySeconds:</span> <span class="number">30</span> <span class="comment"># å®¹å™¨å¯åŠ¨å30så¼€å§‹æ¢æµ‹</span></span><br><span class="line">      <span class="attr">timeoutSeconds:</span> <span class="number">5</span> <span class="comment"># æ¢æµ‹è¶…æ—¶æ—¶é—´ä¸º5s</span></span><br></pre></td></tr></table></figure></div>

<h5 id="5-3-5-é‡å¯ç­–ç•¥"><a href="#5-3-5-é‡å¯ç­–ç•¥" class="headerlink" title="5.3.5 é‡å¯ç­–ç•¥"></a>5.3.5 é‡å¯ç­–ç•¥</h5><p>åœ¨ä¸Šä¸€èŠ‚ä¸­ï¼Œä¸€æ—¦å®¹å™¨æ¢æµ‹å‡ºç°äº†é—®é¢˜ï¼Œkuberneteså°±ä¼šå¯¹å®¹å™¨æ‰€åœ¨çš„Podè¿›è¡Œé‡å¯ï¼Œå…¶å®è¿™æ˜¯ç”±podçš„é‡å¯ç­–ç•¥å†³å®šçš„ï¼Œpodçš„é‡å¯ç­–ç•¥æœ‰ 3 ç§ï¼Œåˆ†åˆ«å¦‚ä¸‹ï¼š</p>
<ul>
<li>Always ï¼šå®¹å™¨å¤±æ•ˆæ—¶ï¼Œè‡ªåŠ¨é‡å¯è¯¥å®¹å™¨ï¼Œè¿™ä¹Ÿæ˜¯é»˜è®¤å€¼ã€‚</li>
<li>OnFailure ï¼š å®¹å™¨ç»ˆæ­¢è¿è¡Œä¸”é€€å‡ºç ä¸ä¸º0æ—¶é‡å¯</li>
<li>Never ï¼š ä¸è®ºçŠ¶æ€ä¸ºä½•ï¼Œéƒ½ä¸é‡å¯è¯¥å®¹å™¨</li>
</ul>
<p>é‡å¯ç­–ç•¥é€‚ç”¨äºpodå¯¹è±¡ä¸­çš„æ‰€æœ‰å®¹å™¨ï¼Œé¦–æ¬¡éœ€è¦é‡å¯çš„å®¹å™¨ï¼Œå°†åœ¨å…¶éœ€è¦æ—¶ç«‹å³è¿›è¡Œé‡å¯ï¼Œéšåå†æ¬¡éœ€è¦é‡å¯çš„æ“ä½œå°†ç”±kubeletå»¶è¿Ÿä¸€æ®µæ—¶é—´åè¿›è¡Œï¼Œä¸”åå¤çš„é‡å¯æ“ä½œçš„å»¶è¿Ÿæ—¶é•¿ä»¥æ­¤ä¸º10sã€20sã€40sã€80sã€160så’Œ300sï¼Œ300sæ˜¯æœ€å¤§å»¶è¿Ÿæ—¶é•¿ã€‚</p>
<p>åˆ›å»ºpod-restartpolicy.yamlï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pod-restartpolicy</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:1.17.1</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx-port</span></span><br><span class="line">      <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">    <span class="attr">livenessProbe:</span></span><br><span class="line">      <span class="attr">httpGet:</span></span><br><span class="line">        <span class="attr">scheme:</span> <span class="string">HTTP</span></span><br><span class="line">        <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">        <span class="attr">path:</span> <span class="string">/hello</span></span><br><span class="line">  <span class="attr">restartPolicy:</span> <span class="string">Never</span> <span class="comment"># è®¾ç½®é‡å¯ç­–ç•¥ä¸ºNever</span></span><br></pre></td></tr></table></figure></div>

<p>è¿è¡ŒPodæµ‹è¯•</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºPod</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># kubectl create -f pod-restartpolicy.yaml</span></span><br><span class="line"><span class="string">pod/pod-restartpolicy</span> <span class="string">created</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹Podè¯¦æƒ…ï¼Œå‘ç°nginxå®¹å™¨å¤±è´¥</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># kubectl  describe pods pod-restartpolicy  -n dev</span></span><br><span class="line"><span class="string">......</span></span><br><span class="line">  <span class="string">Warning</span>  <span class="string">Unhealthy</span>  <span class="string">15s</span> <span class="string">(x3</span> <span class="string">over</span> <span class="string">35s)</span>  <span class="string">kubelet,</span> <span class="attr">node1     Liveness probe failed: HTTP probe failed with statuscode:</span> <span class="number">404</span></span><br><span class="line">  <span class="string">Normal</span>   <span class="string">Killing</span>    <span class="string">15s</span>                <span class="string">kubelet,</span> <span class="string">node1</span>     <span class="string">Container</span> <span class="string">nginx</span> <span class="string">failed</span> <span class="string">liveness</span> <span class="string">probe</span></span><br><span class="line">  </span><br><span class="line"><span class="comment"># å¤šç­‰ä¸€ä¼šï¼Œå†è§‚å¯Ÿpodçš„é‡å¯æ¬¡æ•°ï¼Œå‘ç°ä¸€ç›´æ˜¯0ï¼Œå¹¶æœªé‡å¯   </span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># kubectl  get pods pod-restartpolicy -n dev</span></span><br><span class="line"><span class="string">NAME</span>                   <span class="string">READY</span>   <span class="string">STATUS</span>    <span class="string">RESTARTS</span>   <span class="string">AGE</span></span><br><span class="line"><span class="string">pod-restartpolicy</span>      <span class="number">0</span><span class="string">/1</span>     <span class="string">Running</span>   <span class="number">0</span>          <span class="string">5min42s</span></span><br></pre></td></tr></table></figure></div>

<h4 id="5-4-Podè°ƒåº¦"><a href="#5-4-Podè°ƒåº¦" class="headerlink" title="5.4 Podè°ƒåº¦"></a>5.4 Podè°ƒåº¦</h4><p>åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸€ä¸ªPodåœ¨å“ªä¸ªNodeèŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œæ˜¯ç”±Schedulerç»„ä»¶é‡‡ç”¨ç›¸åº”çš„ç®—æ³•è®¡ç®—å‡ºæ¥çš„ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯ä¸å—äººå·¥æ§åˆ¶çš„ã€‚ä½†æ˜¯åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œè¿™å¹¶ä¸æ»¡è¶³çš„éœ€æ±‚ï¼Œå› ä¸ºå¾ˆå¤šæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æƒ³æ§åˆ¶æŸäº›Podåˆ°è¾¾æŸäº›èŠ‚ç‚¹ä¸Šï¼Œé‚£ä¹ˆåº”è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿè¿™å°±è¦æ±‚äº†è§£kuberneteså¯¹Podçš„è°ƒåº¦è§„åˆ™ï¼Œkubernetesæä¾›äº†å››å¤§ç±»è°ƒåº¦æ–¹å¼ï¼š</p>
<ul>
<li>è‡ªåŠ¨è°ƒåº¦ï¼šè¿è¡Œåœ¨å“ªä¸ªèŠ‚ç‚¹ä¸Šå®Œå…¨ç”±Schedulerç»è¿‡ä¸€ç³»åˆ—çš„ç®—æ³•è®¡ç®—å¾—å‡º</li>
<li>å®šå‘è°ƒåº¦ï¼šNodeNameã€NodeSelector</li>
<li>äº²å’Œæ€§è°ƒåº¦ï¼šNodeAffinityã€PodAffinityã€PodAntiAffinity</li>
<li>æ±¡ç‚¹ï¼ˆå®¹å¿ï¼‰è°ƒåº¦ï¼šTaintsã€Toleration</li>
</ul>
<h5 id="5-4-1-å®šå‘è°ƒåº¦"><a href="#5-4-1-å®šå‘è°ƒåº¦" class="headerlink" title="5.4.1 å®šå‘è°ƒåº¦"></a>5.4.1 å®šå‘è°ƒåº¦</h5><p>å®šå‘è°ƒåº¦ï¼ŒæŒ‡çš„æ˜¯åˆ©ç”¨åœ¨podä¸Šå£°æ˜nodeNameæˆ–è€…nodeSelectorï¼Œä»¥æ­¤å°†Podè°ƒåº¦åˆ°æœŸæœ›çš„nodeèŠ‚ç‚¹ä¸Šã€‚æ³¨æ„ï¼Œè¿™é‡Œçš„è°ƒåº¦æ˜¯å¼ºåˆ¶çš„ï¼Œè¿™å°±æ„å‘³ç€å³ä½¿è¦è°ƒåº¦çš„ç›®æ ‡Nodeä¸å­˜åœ¨ï¼Œä¹Ÿä¼šå‘ä¸Šé¢è¿›è¡Œè°ƒåº¦ï¼Œåªä¸è¿‡podè¿è¡Œå¤±è´¥è€Œå·²ã€‚</p>
<p><strong>NodeName</strong></p>
<p>NodeNameç”¨äºå¼ºåˆ¶çº¦æŸå°†Podè°ƒåº¦åˆ°æŒ‡å®šçš„Nameçš„NodeèŠ‚ç‚¹ä¸Šã€‚è¿™ç§æ–¹å¼ï¼Œå…¶å®æ˜¯ç›´æ¥è·³è¿‡Schedulerçš„è°ƒåº¦é€»è¾‘ï¼Œç›´æ¥å°†Podè°ƒåº¦åˆ°æŒ‡å®šåç§°çš„èŠ‚ç‚¹ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œå®éªŒä¸€ä¸‹ï¼šåˆ›å»ºä¸€ä¸ªpod-nodename.yamlæ–‡ä»¶</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pod-nodename</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:1.17.1</span></span><br><span class="line">  <span class="attr">nodeName:</span> <span class="string">node1</span> <span class="comment"># æŒ‡å®šè°ƒåº¦åˆ°node1èŠ‚ç‚¹ä¸Š</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment">#åˆ›å»ºPod</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># kubectl create -f pod-nodename.yaml</span></span><br><span class="line"><span class="string">pod/pod-nodename</span> <span class="string">created</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹Podè°ƒåº¦åˆ°NODEå±æ€§ï¼Œç¡®å®æ˜¯è°ƒåº¦åˆ°äº†node1èŠ‚ç‚¹ä¸Š</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># kubectl get pods pod-nodename -n dev -o wide</span></span><br><span class="line"><span class="string">NAME</span>           <span class="string">READY</span>   <span class="string">STATUS</span>    <span class="string">RESTARTS</span>   <span class="string">AGE</span>   <span class="string">IP</span>            <span class="string">NODE</span>      <span class="string">......</span></span><br><span class="line"><span class="string">pod-nodename</span>   <span class="number">1</span><span class="string">/1</span>     <span class="string">Running</span>   <span class="number">0</span>          <span class="string">56s</span>   <span class="number">10.244</span><span class="number">.1</span><span class="number">.87</span>   <span class="string">node1</span>     <span class="string">......</span>   </span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¥ä¸‹æ¥ï¼Œåˆ é™¤podï¼Œä¿®æ”¹nodeNameçš„å€¼ä¸ºnode3ï¼ˆå¹¶æ²¡æœ‰node3èŠ‚ç‚¹ï¼‰</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># kubectl delete -f pod-nodename.yaml</span></span><br><span class="line"><span class="string">pod</span> <span class="string">&quot;pod-nodename&quot;</span> <span class="string">deleted</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># vim pod-nodename.yaml</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># kubectl create -f pod-nodename.yaml</span></span><br><span class="line"><span class="string">pod/pod-nodename</span> <span class="string">created</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å†æ¬¡æŸ¥çœ‹ï¼Œå‘ç°å·²ç»å‘Node3èŠ‚ç‚¹è°ƒåº¦ï¼Œä½†æ˜¯ç”±äºä¸å­˜åœ¨node3èŠ‚ç‚¹ï¼Œæ‰€ä»¥podæ— æ³•æ­£å¸¸è¿è¡Œ</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># kubectl get pods pod-nodename -n dev -o wide</span></span><br><span class="line"><span class="string">NAME</span>           <span class="string">READY</span>   <span class="string">STATUS</span>    <span class="string">RESTARTS</span>   <span class="string">AGE</span>   <span class="string">IP</span>       <span class="string">NODE</span>    <span class="string">......</span></span><br><span class="line"><span class="string">pod-nodename</span>   <span class="number">0</span><span class="string">/1</span>     <span class="string">Pending</span>   <span class="number">0</span>          <span class="string">6s</span>    <span class="string">&lt;none&gt;</span>   <span class="string">node3</span>   <span class="string">......</span>           </span><br></pre></td></tr></table></figure></div>

<p><strong>NodeSelector</strong></p>
<p>NodeSelectorç”¨äºå°†podè°ƒåº¦åˆ°æ·»åŠ äº†æŒ‡å®šæ ‡ç­¾çš„nodeèŠ‚ç‚¹ä¸Šã€‚å®ƒæ˜¯é€šè¿‡kubernetesçš„label-selectoræœºåˆ¶å®ç°çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨podåˆ›å»ºä¹‹å‰ï¼Œä¼šç”±schedulerä½¿ç”¨MatchNodeSelectorè°ƒåº¦ç­–ç•¥è¿›è¡ŒlabelåŒ¹é…ï¼Œæ‰¾å‡ºç›®æ ‡nodeï¼Œç„¶åå°†podè°ƒåº¦åˆ°ç›®æ ‡èŠ‚ç‚¹ï¼Œè¯¥åŒ¹é…è§„åˆ™æ˜¯å¼ºåˆ¶çº¦æŸã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œå®éªŒä¸€ä¸‹ï¼š</p>
<p>1 é¦–å…ˆåˆ†åˆ«ä¸ºnodeèŠ‚ç‚¹æ·»åŠ æ ‡ç­¾</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">[root@k8s-master01 ~]# kubectl label nodes node1 nodeenv=pro</span><br><span class="line">node/node2 labeled</span><br><span class="line">[root@k8s-master01 ~]# kubectl label nodes node2 nodeenv=test</span><br><span class="line">node/node2 labeled</span><br></pre></td></tr></table></figure></div>

<p>2 åˆ›å»ºä¸€ä¸ªpod-nodeselector.yamlæ–‡ä»¶ï¼Œå¹¶ä½¿ç”¨å®ƒåˆ›å»ºPod</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pod-nodeselector</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:1.17.1</span></span><br><span class="line">  <span class="attr">nodeSelector:</span> </span><br><span class="line">    <span class="attr">nodeenv:</span> <span class="string">pro</span> <span class="comment"># æŒ‡å®šè°ƒåº¦åˆ°å…·æœ‰nodeenv=proæ ‡ç­¾çš„èŠ‚ç‚¹ä¸Š</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment">#åˆ›å»ºPod</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># kubectl create -f pod-nodeselector.yaml</span></span><br><span class="line"><span class="string">pod/pod-nodeselector</span> <span class="string">created</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æŸ¥çœ‹Podè°ƒåº¦åˆ°NODEå±æ€§ï¼Œç¡®å®æ˜¯è°ƒåº¦åˆ°äº†node1èŠ‚ç‚¹ä¸Š</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># kubectl get pods pod-nodeselector -n dev -o wide</span></span><br><span class="line"><span class="string">NAME</span>               <span class="string">READY</span>   <span class="string">STATUS</span>    <span class="string">RESTARTS</span>   <span class="string">AGE</span>     <span class="string">IP</span>          <span class="string">NODE</span>    <span class="string">......</span></span><br><span class="line"><span class="string">pod-nodeselector</span>   <span class="number">1</span><span class="string">/1</span>     <span class="string">Running</span>   <span class="number">0</span>          <span class="string">47s</span>   <span class="number">10.244</span><span class="number">.1</span><span class="number">.87</span>   <span class="string">node1</span>   <span class="string">......</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¥ä¸‹æ¥ï¼Œåˆ é™¤podï¼Œä¿®æ”¹nodeSelectorçš„å€¼ä¸ºnodeenv: xxxxï¼ˆä¸å­˜åœ¨æ‰“æœ‰æ­¤æ ‡ç­¾çš„èŠ‚ç‚¹ï¼‰</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># kubectl delete -f pod-nodeselector.yaml</span></span><br><span class="line"><span class="string">pod</span> <span class="string">&quot;pod-nodeselector&quot;</span> <span class="string">deleted</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># vim pod-nodeselector.yaml</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># kubectl create -f pod-nodeselector.yaml</span></span><br><span class="line"><span class="string">pod/pod-nodeselector</span> <span class="string">created</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#å†æ¬¡æŸ¥çœ‹ï¼Œå‘ç°podæ— æ³•æ­£å¸¸è¿è¡Œ,Nodeçš„å€¼ä¸ºnone</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># kubectl get pods -n dev -o wide</span></span><br><span class="line"><span class="string">NAME</span>               <span class="string">READY</span>   <span class="string">STATUS</span>    <span class="string">RESTARTS</span>   <span class="string">AGE</span>     <span class="string">IP</span>       <span class="string">NODE</span>    </span><br><span class="line"><span class="string">pod-nodeselector</span>   <span class="number">0</span><span class="string">/1</span>     <span class="string">Pending</span>   <span class="number">0</span>          <span class="string">2m20s</span>   <span class="string">&lt;none&gt;</span>   <span class="string">&lt;none&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹è¯¦æƒ…,å‘ç°node selectoråŒ¹é…å¤±è´¥çš„æç¤º</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># kubectl describe pods pod-nodeselector -n dev</span></span><br><span class="line"><span class="string">.......</span></span><br><span class="line"><span class="attr">Events:</span></span><br><span class="line">  <span class="string">Type</span>     <span class="string">Reason</span>            <span class="string">Age</span>        <span class="string">From</span>               <span class="string">Message</span></span><br><span class="line">  <span class="string">----</span>     <span class="string">------</span>            <span class="string">----</span>       <span class="string">----</span>               <span class="string">-------</span></span><br><span class="line">  <span class="string">Warning</span>  <span class="string">FailedScheduling</span>  <span class="string">&lt;unknown&gt;</span>  <span class="attr">default-scheduler  0/3 nodes are available:</span> <span class="number">3</span> <span class="string">node(s)</span> <span class="string">didn&#x27;t</span> <span class="string">match</span> <span class="string">node</span> <span class="string">selector.</span></span><br></pre></td></tr></table></figure></div>

<h5 id="5-4-2-äº²å’Œæ€§è°ƒåº¦"><a href="#5-4-2-äº²å’Œæ€§è°ƒåº¦" class="headerlink" title="5.4.2 äº²å’Œæ€§è°ƒåº¦"></a>5.4.2 äº²å’Œæ€§è°ƒåº¦</h5><p>ä¸Šä¸€èŠ‚ï¼Œä»‹ç»äº†ä¸¤ç§å®šå‘è°ƒåº¦çš„æ–¹å¼ï¼Œä½¿ç”¨èµ·æ¥éå¸¸æ–¹ä¾¿ï¼Œä½†æ˜¯ä¹Ÿæœ‰ä¸€å®šçš„é—®é¢˜ï¼Œé‚£å°±æ˜¯å¦‚æœæ²¡æœ‰æ»¡è¶³æ¡ä»¶çš„Nodeï¼Œé‚£ä¹ˆPodå°†ä¸ä¼šè¢«è¿è¡Œï¼Œå³ä½¿åœ¨é›†ç¾¤ä¸­è¿˜æœ‰å¯ç”¨Nodeåˆ—è¡¨ä¹Ÿä¸è¡Œï¼Œè¿™å°±é™åˆ¶äº†å®ƒçš„ä½¿ç”¨åœºæ™¯ã€‚</p>
<p>åŸºäºä¸Šé¢çš„é—®é¢˜ï¼Œkubernetesè¿˜æä¾›äº†ä¸€ç§äº²å’Œæ€§è°ƒåº¦ï¼ˆAffinityï¼‰ã€‚å®ƒåœ¨NodeSelectorçš„åŸºç¡€ä¹‹ä¸Šçš„è¿›è¡Œäº†æ‰©å±•ï¼Œå¯ä»¥é€šè¿‡é…ç½®çš„å½¢å¼ï¼Œå®ç°ä¼˜å…ˆé€‰æ‹©æ»¡è¶³æ¡ä»¶çš„Nodeè¿›è¡Œè°ƒåº¦ï¼Œå¦‚æœæ²¡æœ‰ï¼Œä¹Ÿå¯ä»¥è°ƒåº¦åˆ°ä¸æ»¡è¶³æ¡ä»¶çš„èŠ‚ç‚¹ä¸Šï¼Œä½¿è°ƒåº¦æ›´åŠ çµæ´»ã€‚</p>
<p>Affinityä¸»è¦åˆ†ä¸ºä¸‰ç±»ï¼š</p>
<ul>
<li>nodeAffinity(nodeäº²å’Œæ€§ï¼‰: ä»¥nodeä¸ºç›®æ ‡ï¼Œè§£å†³podå¯ä»¥è°ƒåº¦åˆ°å“ªäº›nodeçš„é—®é¢˜</li>
<li>podAffinity(podäº²å’Œæ€§) : ä»¥podä¸ºç›®æ ‡ï¼Œè§£å†³podå¯ä»¥å’Œå“ªäº›å·²å­˜åœ¨çš„podéƒ¨ç½²åœ¨åŒä¸€ä¸ªæ‹“æ‰‘åŸŸä¸­çš„é—®é¢˜</li>
<li>podAntiAffinity(podåäº²å’Œæ€§) : ä»¥podä¸ºç›®æ ‡ï¼Œè§£å†³podä¸èƒ½å’Œå“ªäº›å·²å­˜åœ¨podéƒ¨ç½²åœ¨åŒä¸€ä¸ªæ‹“æ‰‘åŸŸä¸­çš„é—®é¢˜</li>
</ul>
<blockquote>
<p>å…³äºäº²å’Œæ€§(åäº²å’Œæ€§)ä½¿ç”¨åœºæ™¯çš„è¯´æ˜ï¼š</p>
<p><strong>äº²å’Œæ€§</strong>ï¼šå¦‚æœä¸¤ä¸ªåº”ç”¨é¢‘ç¹äº¤äº’ï¼Œé‚£å°±æœ‰å¿…è¦åˆ©ç”¨äº²å’Œæ€§è®©ä¸¤ä¸ªåº”ç”¨çš„å°½å¯èƒ½çš„é è¿‘ï¼Œè¿™æ ·å¯ä»¥å‡å°‘å› ç½‘ç»œé€šä¿¡è€Œå¸¦æ¥çš„æ€§èƒ½æŸè€—ã€‚</p>
<p><strong>åäº²å’Œæ€§</strong>ï¼šå½“åº”ç”¨çš„é‡‡ç”¨å¤šå‰¯æœ¬éƒ¨ç½²æ—¶ï¼Œæœ‰å¿…è¦é‡‡ç”¨åäº²å’Œæ€§è®©å„ä¸ªåº”ç”¨å®ä¾‹æ‰“æ•£åˆ†å¸ƒåœ¨å„ä¸ªnodeä¸Šï¼Œè¿™æ ·å¯ä»¥æé«˜æœåŠ¡çš„é«˜å¯ç”¨æ€§ã€‚</p>
</blockquote>
<p><strong>NodeAffinity</strong></p>
<p>é¦–å…ˆæ¥çœ‹ä¸€ä¸‹<code>NodeAffinity</code>çš„å¯é…ç½®é¡¹ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="MARKDOWN"><figure class="iseeu highlight /markdown"><table><tr><td class="code"><pre><span class="line">pod.spec.affinity.nodeAffinity</span><br><span class="line">  requiredDuringSchedulingIgnoredDuringExecution  NodeèŠ‚ç‚¹å¿…é¡»æ»¡è¶³æŒ‡å®šçš„æ‰€æœ‰è§„åˆ™æ‰å¯ä»¥ï¼Œç›¸å½“äºç¡¬é™åˆ¶</span><br><span class="line"><span class="code">    nodeSelectorTerms  èŠ‚ç‚¹é€‰æ‹©åˆ—è¡¨</span></span><br><span class="line"><span class="code">      matchFields   æŒ‰èŠ‚ç‚¹å­—æ®µåˆ—å‡ºçš„èŠ‚ç‚¹é€‰æ‹©å™¨è¦æ±‚åˆ—è¡¨</span></span><br><span class="line"><span class="code">      matchExpressions   æŒ‰èŠ‚ç‚¹æ ‡ç­¾åˆ—å‡ºçš„èŠ‚ç‚¹é€‰æ‹©å™¨è¦æ±‚åˆ—è¡¨(æ¨è)</span></span><br><span class="line"><span class="code">        key    é”®</span></span><br><span class="line"><span class="code">        values å€¼</span></span><br><span class="line"><span class="code">        operat or å…³ç³»ç¬¦ æ”¯æŒExists, DoesNotExist, In, NotIn, Gt, Lt</span></span><br><span class="line"><span class="code">  preferredDuringSchedulingIgnoredDuringExecution ä¼˜å…ˆè°ƒåº¦åˆ°æ»¡è¶³æŒ‡å®šçš„è§„åˆ™çš„Nodeï¼Œç›¸å½“äºè½¯é™åˆ¶ (å€¾å‘)</span></span><br><span class="line"><span class="code">    preference   ä¸€ä¸ªèŠ‚ç‚¹é€‰æ‹©å™¨é¡¹ï¼Œä¸ç›¸åº”çš„æƒé‡ç›¸å…³è”</span></span><br><span class="line"><span class="code">      matchFields   æŒ‰èŠ‚ç‚¹å­—æ®µåˆ—å‡ºçš„èŠ‚ç‚¹é€‰æ‹©å™¨è¦æ±‚åˆ—è¡¨</span></span><br><span class="line"><span class="code">      matchExpressions   æŒ‰èŠ‚ç‚¹æ ‡ç­¾åˆ—å‡ºçš„èŠ‚ç‚¹é€‰æ‹©å™¨è¦æ±‚åˆ—è¡¨(æ¨è)</span></span><br><span class="line"><span class="code">        key    é”®</span></span><br><span class="line"><span class="code">        values å€¼</span></span><br><span class="line"><span class="code">        operator å…³ç³»ç¬¦ æ”¯æŒIn, NotIn, Exists, DoesNotExist, Gt, Lt</span></span><br><span class="line"><span class="code">	weight å€¾å‘æƒé‡ï¼Œåœ¨èŒƒå›´1-100ã€‚</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="string">å…³ç³»ç¬¦çš„ä½¿ç”¨è¯´æ˜:</span></span><br><span class="line"></span><br><span class="line"><span class="bullet">-</span> <span class="attr">matchExpressions:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">nodeenv</span>              <span class="comment"># åŒ¹é…å­˜åœ¨æ ‡ç­¾çš„keyä¸ºnodeenvçš„èŠ‚ç‚¹</span></span><br><span class="line">    <span class="attr">operator:</span> <span class="string">Exists</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">nodeenv</span>              <span class="comment"># åŒ¹é…æ ‡ç­¾çš„keyä¸ºnodeenv,ä¸”valueæ˜¯&quot;xxx&quot;æˆ–&quot;yyy&quot;çš„èŠ‚ç‚¹</span></span><br><span class="line">    <span class="attr">operator:</span> <span class="string">In</span></span><br><span class="line">    <span class="attr">values:</span> [<span class="string">&quot;xxx&quot;</span>,<span class="string">&quot;yyy&quot;</span>]</span><br><span class="line">  <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">nodeenv</span>              <span class="comment"># åŒ¹é…æ ‡ç­¾çš„keyä¸ºnodeenv,ä¸”valueå¤§äº&quot;xxx&quot;çš„èŠ‚ç‚¹</span></span><br><span class="line">    <span class="attr">operator:</span> <span class="string">Gt</span></span><br><span class="line">    <span class="attr">values:</span> <span class="string">&quot;xxx&quot;</span></span><br></pre></td></tr></table></figure></div>

<p>æ¥ä¸‹æ¥é¦–å…ˆæ¼”ç¤ºä¸€ä¸‹<code>requiredDuringSchedulingIgnoredDuringExecution</code> ,</p>
<p>åˆ›å»ºpod-nodeaffinity-required.yaml</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pod-nodeaffinity-required</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:1.17.1</span></span><br><span class="line">  <span class="attr">affinity:</span>  <span class="comment">#äº²å’Œæ€§è®¾ç½®</span></span><br><span class="line">    <span class="attr">nodeAffinity:</span> <span class="comment">#è®¾ç½®nodeäº²å’Œæ€§</span></span><br><span class="line">      <span class="attr">requiredDuringSchedulingIgnoredDuringExecution:</span> <span class="comment"># ç¡¬é™åˆ¶</span></span><br><span class="line">        <span class="attr">nodeSelectorTerms:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">matchExpressions:</span> <span class="comment"># åŒ¹é…envçš„å€¼åœ¨[&quot;xxx&quot;,&quot;yyy&quot;]ä¸­çš„æ ‡ç­¾</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">nodeenv</span></span><br><span class="line">            <span class="attr">operator:</span> <span class="string">In</span></span><br><span class="line">            <span class="attr">values:</span> [<span class="string">&quot;xxx&quot;</span>,<span class="string">&quot;yyy&quot;</span>]</span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºpod</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># kubectl create -f pod-nodeaffinity-required.yaml</span></span><br><span class="line"><span class="string">pod/pod-nodeaffinity-required</span> <span class="string">created</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹podçŠ¶æ€ ï¼ˆè¿è¡Œå¤±è´¥ï¼‰</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># kubectl get pods pod-nodeaffinity-required -n dev -o wide</span></span><br><span class="line"><span class="string">NAME</span>                        <span class="string">READY</span>   <span class="string">STATUS</span>    <span class="string">RESTARTS</span>   <span class="string">AGE</span>   <span class="string">IP</span>       <span class="string">NODE</span>    <span class="string">......</span> </span><br><span class="line"><span class="string">pod-nodeaffinity-required</span>   <span class="number">0</span><span class="string">/1</span>     <span class="string">Pending</span>   <span class="number">0</span>          <span class="string">16s</span>   <span class="string">&lt;none&gt;</span>   <span class="string">&lt;none&gt;</span>  <span class="string">......</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹Podçš„è¯¦æƒ…</span></span><br><span class="line"><span class="comment"># å‘ç°è°ƒåº¦å¤±è´¥ï¼Œæç¤ºnodeé€‰æ‹©å¤±è´¥</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># kubectl describe pod pod-nodeaffinity-required -n dev</span></span><br><span class="line"><span class="string">......</span></span><br><span class="line">  <span class="string">Warning</span>  <span class="string">FailedScheduling</span>  <span class="string">&lt;unknown&gt;</span>  <span class="attr">default-scheduler  0/3 nodes are available:</span> <span class="number">3</span> <span class="string">node(s)</span> <span class="string">didn&#x27;t</span> <span class="string">match</span> <span class="string">node</span> <span class="string">selector.</span></span><br><span class="line">  <span class="string">Warning</span>  <span class="string">FailedScheduling</span>  <span class="string">&lt;unknown&gt;</span>  <span class="attr">default-scheduler  0/3 nodes are available:</span> <span class="number">3</span> <span class="string">node(s)</span> <span class="string">didn&#x27;t</span> <span class="string">match</span> <span class="string">node</span> <span class="string">selector.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#æ¥ä¸‹æ¥ï¼Œåœæ­¢pod</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># kubectl delete -f pod-nodeaffinity-required.yaml</span></span><br><span class="line"><span class="string">pod</span> <span class="string">&quot;pod-nodeaffinity-required&quot;</span> <span class="string">deleted</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¿®æ”¹æ–‡ä»¶ï¼Œå°†values: [&quot;xxx&quot;,&quot;yyy&quot;]------&gt; [&quot;pro&quot;,&quot;yyy&quot;]</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># vim pod-nodeaffinity-required.yaml</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å†æ¬¡å¯åŠ¨</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># kubectl create -f pod-nodeaffinity-required.yaml</span></span><br><span class="line"><span class="string">pod/pod-nodeaffinity-required</span> <span class="string">created</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ­¤æ—¶æŸ¥çœ‹ï¼Œå‘ç°è°ƒåº¦æˆåŠŸï¼Œå·²ç»å°†podè°ƒåº¦åˆ°äº†node1ä¸Š</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># kubectl get pods pod-nodeaffinity-required -n dev -o wide</span></span><br><span class="line"><span class="string">NAME</span>                        <span class="string">READY</span>   <span class="string">STATUS</span>    <span class="string">RESTARTS</span>   <span class="string">AGE</span>   <span class="string">IP</span>            <span class="string">NODE</span>  <span class="string">......</span> </span><br><span class="line"><span class="string">pod-nodeaffinity-required</span>   <span class="number">1</span><span class="string">/1</span>     <span class="string">Running</span>   <span class="number">0</span>          <span class="string">11s</span>   <span class="number">10.244</span><span class="number">.1</span><span class="number">.89</span>   <span class="string">node1</span> <span class="string">......</span></span><br></pre></td></tr></table></figure></div>

<p>æ¥ä¸‹æ¥å†æ¼”ç¤ºä¸€ä¸‹<code>requiredDuringSchedulingIgnoredDuringExecution</code> ,</p>
<p>åˆ›å»ºpod-nodeaffinity-preferred.yaml</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pod-nodeaffinity-preferred</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:1.17.1</span></span><br><span class="line">  <span class="attr">affinity:</span>  <span class="comment">#äº²å’Œæ€§è®¾ç½®</span></span><br><span class="line">    <span class="attr">nodeAffinity:</span> <span class="comment">#è®¾ç½®nodeäº²å’Œæ€§</span></span><br><span class="line">      <span class="attr">preferredDuringSchedulingIgnoredDuringExecution:</span> <span class="comment"># è½¯é™åˆ¶</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">weight:</span> <span class="number">1</span></span><br><span class="line">        <span class="attr">preference:</span></span><br><span class="line">          <span class="attr">matchExpressions:</span> <span class="comment"># åŒ¹é…envçš„å€¼åœ¨[&quot;xxx&quot;,&quot;yyy&quot;]ä¸­çš„æ ‡ç­¾(å½“å‰ç¯å¢ƒæ²¡æœ‰)</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">nodeenv</span></span><br><span class="line">            <span class="attr">operator:</span> <span class="string">In</span></span><br><span class="line">            <span class="attr">values:</span> [<span class="string">&quot;xxx&quot;</span>,<span class="string">&quot;yyy&quot;</span>]</span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºpod</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># kubectl create -f pod-nodeaffinity-preferred.yaml</span></span><br><span class="line"><span class="string">pod/pod-nodeaffinity-preferred</span> <span class="string">created</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹podçŠ¶æ€ ï¼ˆè¿è¡ŒæˆåŠŸï¼‰</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># kubectl get pod pod-nodeaffinity-preferred -n dev</span></span><br><span class="line"><span class="string">NAME</span>                         <span class="string">READY</span>   <span class="string">STATUS</span>    <span class="string">RESTARTS</span>   <span class="string">AGE</span></span><br><span class="line"><span class="string">pod-nodeaffinity-preferred</span>   <span class="number">1</span><span class="string">/1</span>     <span class="string">Running</span>   <span class="number">0</span>          <span class="string">40s</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="code"><pre><span class="line">NodeAffinityè§„åˆ™è®¾ç½®çš„æ³¨æ„äº‹é¡¹ï¼š</span><br><span class="line">    1 å¦‚æœåŒæ—¶å®šä¹‰äº†nodeSelectorå’ŒnodeAffinityï¼Œé‚£ä¹ˆå¿…é¡»ä¸¤ä¸ªæ¡ä»¶éƒ½å¾—åˆ°æ»¡è¶³ï¼ŒPodæ‰èƒ½è¿è¡Œåœ¨æŒ‡å®šçš„Nodeä¸Š</span><br><span class="line">    2 å¦‚æœnodeAffinityæŒ‡å®šäº†å¤šä¸ªnodeSelectorTermsï¼Œé‚£ä¹ˆåªéœ€è¦å…¶ä¸­ä¸€ä¸ªèƒ½å¤ŸåŒ¹é…æˆåŠŸå³å¯</span><br><span class="line">    3 å¦‚æœä¸€ä¸ªnodeSelectorTermsä¸­æœ‰å¤šä¸ªmatchExpressions ï¼Œåˆ™ä¸€ä¸ªèŠ‚ç‚¹å¿…é¡»æ»¡è¶³æ‰€æœ‰çš„æ‰èƒ½åŒ¹é…æˆåŠŸ</span><br><span class="line">    4 å¦‚æœä¸€ä¸ªpodæ‰€åœ¨çš„Nodeåœ¨Podè¿è¡ŒæœŸé—´å…¶æ ‡ç­¾å‘ç”Ÿäº†æ”¹å˜ï¼Œä¸å†ç¬¦åˆè¯¥Podçš„èŠ‚ç‚¹äº²å’Œæ€§éœ€æ±‚ï¼Œåˆ™ç³»ç»Ÿå°†å¿½ç•¥æ­¤å˜åŒ–</span><br></pre></td></tr></table></figure></div>

<p><strong>PodAffinity</strong></p>
<p>PodAffinityä¸»è¦å®ç°ä»¥è¿è¡Œçš„Podä¸ºå‚ç…§ï¼Œå®ç°è®©æ–°åˆ›å»ºçš„Podè·Ÿå‚ç…§podåœ¨ä¸€ä¸ªåŒºåŸŸçš„åŠŸèƒ½ã€‚</p>
<p>é¦–å…ˆæ¥çœ‹ä¸€ä¸‹<code>PodAffinity</code>çš„å¯é…ç½®é¡¹ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="MARKDOWN"><figure class="iseeu highlight /markdown"><table><tr><td class="code"><pre><span class="line">pod.spec.affinity.podAffinity</span><br><span class="line">  requiredDuringSchedulingIgnoredDuringExecution  ç¡¬é™åˆ¶</span><br><span class="line"><span class="code">    namespaces       æŒ‡å®šå‚ç…§podçš„namespace</span></span><br><span class="line"><span class="code">    topologyKey      æŒ‡å®šè°ƒåº¦ä½œç”¨åŸŸ</span></span><br><span class="line"><span class="code">    labelSelector    æ ‡ç­¾é€‰æ‹©å™¨</span></span><br><span class="line"><span class="code">      matchExpressions  æŒ‰èŠ‚ç‚¹æ ‡ç­¾åˆ—å‡ºçš„èŠ‚ç‚¹é€‰æ‹©å™¨è¦æ±‚åˆ—è¡¨(æ¨è)</span></span><br><span class="line"><span class="code">        key    é”®</span></span><br><span class="line"><span class="code">        values å€¼</span></span><br><span class="line"><span class="code">        operator å…³ç³»ç¬¦ æ”¯æŒIn, NotIn, Exists, DoesNotExist.</span></span><br><span class="line"><span class="code">      matchLabels    æŒ‡å¤šä¸ªmatchExpressionsæ˜ å°„çš„å†…å®¹</span></span><br><span class="line"><span class="code">  preferredDuringSchedulingIgnoredDuringExecution è½¯é™åˆ¶</span></span><br><span class="line"><span class="code">    podAffinityTerm  é€‰é¡¹</span></span><br><span class="line"><span class="code">      namespaces      </span></span><br><span class="line"><span class="code">      topologyKey</span></span><br><span class="line"><span class="code">      labelSelector</span></span><br><span class="line"><span class="code">        matchExpressions  </span></span><br><span class="line"><span class="code">          key    é”®</span></span><br><span class="line"><span class="code">          values å€¼</span></span><br><span class="line"><span class="code">          operator</span></span><br><span class="line"><span class="code">        matchLabels </span></span><br><span class="line"><span class="code">    weight å€¾å‘æƒé‡ï¼Œåœ¨èŒƒå›´1-100</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="MARKDOWN"><figure class="iseeu highlight /markdown"><table><tr><td class="code"><pre><span class="line">topologyKeyç”¨äºæŒ‡å®šè°ƒåº¦æ—¶ä½œç”¨åŸŸ,ä¾‹å¦‚:</span><br><span class="line"><span class="code">    å¦‚æœæŒ‡å®šä¸ºkubernetes.io/hostnameï¼Œé‚£å°±æ˜¯ä»¥NodeèŠ‚ç‚¹ä¸ºåŒºåˆ†èŒƒå›´</span></span><br><span class="line"><span class="code">	å¦‚æœæŒ‡å®šä¸ºbeta.kubernetes.io/os,åˆ™ä»¥NodeèŠ‚ç‚¹çš„æ“ä½œç³»ç»Ÿç±»å‹æ¥åŒºåˆ†</span></span><br></pre></td></tr></table></figure></div>

<p>æ¥ä¸‹æ¥ï¼Œæ¼”ç¤ºä¸‹<code>requiredDuringSchedulingIgnoredDuringExecution</code>,</p>
<p>1ï¼‰é¦–å…ˆåˆ›å»ºä¸€ä¸ªå‚ç…§Podï¼Œpod-podaffinity-target.yamlï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pod-podaffinity-target</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">podenv:</span> <span class="string">pro</span> <span class="comment">#è®¾ç½®æ ‡ç­¾</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:1.17.1</span></span><br><span class="line">  <span class="attr">nodeName:</span> <span class="string">node1</span> <span class="comment"># å°†ç›®æ ‡podåç¡®æŒ‡å®šåˆ°node1ä¸Š</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å¯åŠ¨ç›®æ ‡pod</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl create -f pod-podaffinity-target.yaml</span><br><span class="line">pod/pod-podaffinity-target created</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹podçŠ¶å†µ</span></span><br><span class="line">[root@k8s-master01 ~]# kubectl get pods  pod-podaffinity-target -n dev</span><br><span class="line">NAME                     READY   STATUS    RESTARTS   AGE</span><br><span class="line">pod-podaffinity-target   1/1     Running   0          4s</span><br></pre></td></tr></table></figure></div>

<p>2ï¼‰åˆ›å»ºpod-podaffinity-required.yamlï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pod-podaffinity-required</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:1.17.1</span></span><br><span class="line">  <span class="attr">affinity:</span>  <span class="comment">#äº²å’Œæ€§è®¾ç½®</span></span><br><span class="line">    <span class="attr">podAffinity:</span> <span class="comment">#è®¾ç½®podäº²å’Œæ€§</span></span><br><span class="line">      <span class="attr">requiredDuringSchedulingIgnoredDuringExecution:</span> <span class="comment"># ç¡¬é™åˆ¶</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">labelSelector:</span></span><br><span class="line">          <span class="attr">matchExpressions:</span> <span class="comment"># åŒ¹é…envçš„å€¼åœ¨[&quot;xxx&quot;,&quot;yyy&quot;]ä¸­çš„æ ‡ç­¾</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">podenv</span></span><br><span class="line">            <span class="attr">operator:</span> <span class="string">In</span></span><br><span class="line">            <span class="attr">values:</span> [<span class="string">&quot;xxx&quot;</span>,<span class="string">&quot;yyy&quot;</span>]</span><br><span class="line">        <span class="attr">topologyKey:</span> <span class="string">kubernetes.io/hostname</span></span><br></pre></td></tr></table></figure></div>

<p>ä¸Šé¢é…ç½®è¡¨è¾¾çš„æ„æ€æ˜¯ï¼šæ–°Podå¿…é¡»è¦ä¸æ‹¥æœ‰æ ‡ç­¾nodeenv=xxxæˆ–è€…nodeenv=yyyçš„podåœ¨åŒä¸€Nodeä¸Šï¼Œæ˜¾ç„¶ç°åœ¨æ²¡æœ‰è¿™æ ·podï¼Œæ¥ä¸‹æ¥ï¼Œè¿è¡Œæµ‹è¯•ä¸€ä¸‹ã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å¯åŠ¨pod</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># kubectl create -f pod-podaffinity-required.yaml</span></span><br><span class="line"><span class="string">pod/pod-podaffinity-required</span> <span class="string">created</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹podçŠ¶æ€ï¼Œå‘ç°æœªè¿è¡Œ</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># kubectl get pods pod-podaffinity-required -n dev</span></span><br><span class="line"><span class="string">NAME</span>                       <span class="string">READY</span>   <span class="string">STATUS</span>    <span class="string">RESTARTS</span>   <span class="string">AGE</span></span><br><span class="line"><span class="string">pod-podaffinity-required</span>   <span class="number">0</span><span class="string">/1</span>     <span class="string">Pending</span>   <span class="number">0</span>          <span class="string">9s</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># kubectl describe pods pod-podaffinity-required  -n dev</span></span><br><span class="line"><span class="string">......</span></span><br><span class="line"><span class="attr">Events:</span></span><br><span class="line">  <span class="string">Type</span>     <span class="string">Reason</span>            <span class="string">Age</span>        <span class="string">From</span>               <span class="string">Message</span></span><br><span class="line">  <span class="string">----</span>     <span class="string">------</span>            <span class="string">----</span>       <span class="string">----</span>               <span class="string">-------</span></span><br><span class="line">  <span class="string">Warning</span>  <span class="string">FailedScheduling</span>  <span class="string">&lt;unknown&gt;</span>  <span class="attr">default-scheduler  0/3 nodes are available:</span> <span class="number">2</span> <span class="string">node(s)</span> <span class="string">didn&#x27;t</span> <span class="string">match</span> <span class="string">pod</span> <span class="string">affinity</span> <span class="string">rules,</span> <span class="number">1</span> <span class="string">node(s)</span> <span class="string">had</span> <span class="string">taints</span> <span class="string">that</span> <span class="string">the</span> <span class="string">pod</span> <span class="string">didn&#x27;t</span> <span class="string">tolerate.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ¥ä¸‹æ¥ä¿®æ”¹  values: [&quot;xxx&quot;,&quot;yyy&quot;]-----&gt;values:[&quot;pro&quot;,&quot;yyy&quot;]</span></span><br><span class="line"><span class="comment"># æ„æ€æ˜¯ï¼šæ–°Podå¿…é¡»è¦ä¸æ‹¥æœ‰æ ‡ç­¾nodeenv=xxxæˆ–è€…nodeenv=yyyçš„podåœ¨åŒä¸€Nodeä¸Š</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># vim pod-podaffinity-required.yaml</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç„¶åé‡æ–°åˆ›å»ºpodï¼ŒæŸ¥çœ‹æ•ˆæœ</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># kubectl delete -f  pod-podaffinity-required.yaml</span></span><br><span class="line"><span class="string">pod</span> <span class="string">&quot;pod-podaffinity-required&quot;</span> <span class="string">de</span> <span class="string">leted</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># kubectl create -f pod-podaffinity-required.yaml</span></span><br><span class="line"><span class="string">pod/pod-podaffinity-required</span> <span class="string">created</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å‘ç°æ­¤æ—¶Podè¿è¡Œæ­£å¸¸</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># kubectl get pods pod-podaffinity-required -n dev</span></span><br><span class="line"><span class="string">NAME</span>                       <span class="string">READY</span>   <span class="string">STATUS</span>    <span class="string">RESTARTS</span>   <span class="string">AGE</span>   <span class="string">LABELS</span></span><br><span class="line"><span class="string">pod-podaffinity-required</span>   <span class="number">1</span><span class="string">/1</span>     <span class="string">Running</span>   <span class="number">0</span>          <span class="string">6s</span>    <span class="string">&lt;none&gt;</span></span><br></pre></td></tr></table></figure></div>

<p>å…³äº<code>PodAffinity</code>çš„ <code>preferredDuringSchedulingIgnoredDuringExecution</code>ï¼Œè¿™é‡Œä¸å†æ¼”ç¤ºã€‚</p>
<p><strong>PodAntiAffinity</strong></p>
<p>PodAntiAffinityä¸»è¦å®ç°ä»¥è¿è¡Œçš„Podä¸ºå‚ç…§ï¼Œè®©æ–°åˆ›å»ºçš„Podè·Ÿå‚ç…§podä¸åœ¨ä¸€ä¸ªåŒºåŸŸä¸­çš„åŠŸèƒ½ã€‚</p>
<p>å®ƒçš„é…ç½®æ–¹å¼å’Œé€‰é¡¹è·ŸPodAffintyæ˜¯ä¸€æ ·çš„ï¼Œè¿™é‡Œä¸å†åšè¯¦ç»†è§£é‡Šï¼Œç›´æ¥åšä¸€ä¸ªæµ‹è¯•æ¡ˆä¾‹ã€‚</p>
<p>1ï¼‰ç»§ç»­ä½¿ç”¨ä¸Šä¸ªæ¡ˆä¾‹ä¸­ç›®æ ‡pod</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">[root@k8s-master01 ~]# kubectl get pods -n dev -o wide --show-labels</span><br><span class="line">NAME                     READY   STATUS    RESTARTS   AGE     IP            NODE    LABELS</span><br><span class="line">pod-podaffinity-required 1/1     Running   0          3m29s   10.244.1.38   node1   &lt;none&gt;     </span><br><span class="line">pod-podaffinity-target   1/1     Running   0          9m25s   10.244.1.37   node1   podenv=pro</span><br></pre></td></tr></table></figure></div>

<p>2ï¼‰åˆ›å»ºpod-podantiaffinity-required.yamlï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pod-podantiaffinity-required</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:1.17.1</span></span><br><span class="line">  <span class="attr">affinity:</span>  <span class="comment">#äº²å’Œæ€§è®¾ç½®</span></span><br><span class="line">    <span class="attr">podAntiAffinity:</span> <span class="comment">#è®¾ç½®podäº²å’Œæ€§</span></span><br><span class="line">      <span class="attr">requiredDuringSchedulingIgnoredDuringExecution:</span> <span class="comment"># ç¡¬é™åˆ¶</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">labelSelector:</span></span><br><span class="line">          <span class="attr">matchExpressions:</span> <span class="comment"># åŒ¹é…podenvçš„å€¼åœ¨[&quot;pro&quot;]ä¸­çš„æ ‡ç­¾</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">podenv</span></span><br><span class="line">            <span class="attr">operator:</span> <span class="string">In</span></span><br><span class="line">            <span class="attr">values:</span> [<span class="string">&quot;pro&quot;</span>]</span><br><span class="line">        <span class="attr">topologyKey:</span> <span class="string">kubernetes.io/hostname</span></span><br></pre></td></tr></table></figure></div>

<p>ä¸Šé¢é…ç½®è¡¨è¾¾çš„æ„æ€æ˜¯ï¼šæ–°Podå¿…é¡»è¦ä¸æ‹¥æœ‰æ ‡ç­¾nodeenv=proçš„podä¸åœ¨åŒä¸€Nodeä¸Šï¼Œè¿è¡Œæµ‹è¯•ä¸€ä¸‹ã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºpod</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># kubectl create -f pod-podantiaffinity-required.yaml</span></span><br><span class="line"><span class="string">pod/pod-podantiaffinity-required</span> <span class="string">created</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æŸ¥çœ‹pod</span></span><br><span class="line"><span class="comment"># å‘ç°è°ƒåº¦åˆ°äº†node2ä¸Š</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># kubectl get pods pod-podantiaffinity-required -n dev -o wide</span></span><br><span class="line"><span class="string">NAME</span>                           <span class="string">READY</span>   <span class="string">STATUS</span>    <span class="string">RESTARTS</span>   <span class="string">AGE</span>   <span class="string">IP</span>            <span class="string">NODE</span>   <span class="string">..</span> </span><br><span class="line"><span class="string">pod-podantiaffinity-required</span>   <span class="number">1</span><span class="string">/1</span>     <span class="string">Running</span>   <span class="number">0</span>          <span class="string">30s</span>   <span class="number">10.244</span><span class="number">.1</span><span class="number">.96</span>   <span class="string">node2</span>  <span class="string">..</span></span><br></pre></td></tr></table></figure></div>

<h5 id="5-4-3-æ±¡ç‚¹å’Œå®¹å¿"><a href="#5-4-3-æ±¡ç‚¹å’Œå®¹å¿" class="headerlink" title="5.4.3 æ±¡ç‚¹å’Œå®¹å¿"></a>5.4.3 æ±¡ç‚¹å’Œå®¹å¿</h5><p><strong>æ±¡ç‚¹ï¼ˆTaintsï¼‰</strong></p>
<p>å‰é¢çš„è°ƒåº¦æ–¹å¼éƒ½æ˜¯ç«™åœ¨Podçš„è§’åº¦ä¸Šï¼Œé€šè¿‡åœ¨Podä¸Šæ·»åŠ å±æ€§ï¼Œæ¥ç¡®å®šPodæ˜¯å¦è¦è°ƒåº¦åˆ°æŒ‡å®šçš„Nodeä¸Šï¼Œå…¶å®æˆ‘ä»¬ä¹Ÿå¯ä»¥ç«™åœ¨Nodeçš„è§’åº¦ä¸Šï¼Œé€šè¿‡åœ¨Nodeä¸Šæ·»åŠ <strong>æ±¡ç‚¹</strong>å±æ€§ï¼Œæ¥å†³å®šæ˜¯å¦å…è®¸Podè°ƒåº¦è¿‡æ¥ã€‚</p>
<p>Nodeè¢«è®¾ç½®ä¸Šæ±¡ç‚¹ä¹‹åå°±å’ŒPodä¹‹é—´å­˜åœ¨äº†ä¸€ç§ç›¸æ–¥çš„å…³ç³»ï¼Œè¿›è€Œæ‹’ç»Podè°ƒåº¦è¿›æ¥ï¼Œç”šè‡³å¯ä»¥å°†å·²ç»å­˜åœ¨çš„Podé©±é€å‡ºå»ã€‚</p>
<p>æ±¡ç‚¹çš„æ ¼å¼ä¸ºï¼š<code>key=value:effect</code>, keyå’Œvalueæ˜¯æ±¡ç‚¹çš„æ ‡ç­¾ï¼Œeffectæè¿°æ±¡ç‚¹çš„ä½œç”¨ï¼Œæ”¯æŒå¦‚ä¸‹ä¸‰ä¸ªé€‰é¡¹ï¼š</p>
<ul>
<li>PreferNoScheduleï¼škuberneteså°†å°½é‡é¿å…æŠŠPodè°ƒåº¦åˆ°å…·æœ‰è¯¥æ±¡ç‚¹çš„Nodeä¸Šï¼Œé™¤éæ²¡æœ‰å…¶ä»–èŠ‚ç‚¹å¯è°ƒåº¦</li>
<li>NoScheduleï¼škuberneteså°†ä¸ä¼šæŠŠPodè°ƒåº¦åˆ°å…·æœ‰è¯¥æ±¡ç‚¹çš„Nodeä¸Šï¼Œä½†ä¸ä¼šå½±å“å½“å‰Nodeä¸Šå·²å­˜åœ¨çš„Pod</li>
<li>NoExecuteï¼škuberneteså°†ä¸ä¼šæŠŠPodè°ƒåº¦åˆ°å…·æœ‰è¯¥æ±¡ç‚¹çš„Nodeä¸Šï¼ŒåŒæ—¶ä¹Ÿä¼šå°†Nodeä¸Šå·²å­˜åœ¨çš„Podé©±ç¦»</li>
</ul>
<p><img src="/2022/06/09/uncatalog/cl46zbayg000v7or7a4o0f4yd/image-20200605021831545.png" alt="image-20200605021606508"></p>
<p>ä½¿ç”¨kubectlè®¾ç½®å’Œå»é™¤æ±¡ç‚¹çš„å‘½ä»¤ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> è®¾ç½®æ±¡ç‚¹</span></span><br><span class="line">kubectl taint nodes node1 key=value:effect</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å»é™¤æ±¡ç‚¹</span></span><br><span class="line">kubectl taint nodes node1 key:effect-</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å»é™¤æ‰€æœ‰æ±¡ç‚¹</span></span><br><span class="line">kubectl taint nodes node1 key-</span><br></pre></td></tr></table></figure></div>

<p>æ¥ä¸‹æ¥ï¼Œæ¼”ç¤ºä¸‹æ±¡ç‚¹çš„æ•ˆæœï¼š</p>
<ol>
<li>å‡†å¤‡èŠ‚ç‚¹node1ï¼ˆä¸ºäº†æ¼”ç¤ºæ•ˆæœæ›´åŠ æ˜æ˜¾ï¼Œæš‚æ—¶åœæ­¢node2èŠ‚ç‚¹ï¼‰</li>
<li>ä¸ºnode1èŠ‚ç‚¹è®¾ç½®ä¸€ä¸ªæ±¡ç‚¹: <code>tag=heima:PreferNoSchedule</code>ï¼›ç„¶ååˆ›å»ºpod1( pod1 å¯ä»¥ )</li>
<li>ä¿®æ”¹ä¸ºnode1èŠ‚ç‚¹è®¾ç½®ä¸€ä¸ªæ±¡ç‚¹: <code>tag=heima:NoSchedule</code>ï¼›ç„¶ååˆ›å»ºpod2( pod1 æ­£å¸¸ pod2 å¤±è´¥ )</li>
<li>ä¿®æ”¹ä¸ºnode1èŠ‚ç‚¹è®¾ç½®ä¸€ä¸ªæ±¡ç‚¹: <code>tag=heima:NoExecute</code>ï¼›ç„¶ååˆ›å»ºpod3 ( 3ä¸ªpodéƒ½å¤±è´¥ )</li>
</ol>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä¸ºnode1è®¾ç½®æ±¡ç‚¹(PreferNoSchedule)</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># kubectl taint nodes node1 tag=heima:PreferNoSchedule</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºpod1</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># kubectl run taint1 --image=nginx:1.17.1 -n dev</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># kubectl get pods -n dev -o wide</span></span><br><span class="line"><span class="string">NAME</span>                      <span class="string">READY</span>   <span class="string">STATUS</span>    <span class="string">RESTARTS</span>   <span class="string">AGE</span>     <span class="string">IP</span>           <span class="string">NODE</span>   </span><br><span class="line"><span class="string">taint1-7665f7fd85-574h4</span>   <span class="number">1</span><span class="string">/1</span>     <span class="string">Running</span>   <span class="number">0</span>          <span class="string">2m24s</span>   <span class="number">10.244</span><span class="number">.1</span><span class="number">.59</span>   <span class="string">node1</span>    </span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸ºnode1è®¾ç½®æ±¡ç‚¹(å–æ¶ˆPreferNoScheduleï¼Œè®¾ç½®NoSchedule)</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># kubectl taint nodes node1 tag:PreferNoSchedule-</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># kubectl taint nodes node1 tag=heima:NoSchedule</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºpod2</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># kubectl run taint2 --image=nginx:1.17.1 -n dev</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># kubectl get pods taint2 -n dev -o wide</span></span><br><span class="line"><span class="string">NAME</span>                      <span class="string">READY</span>   <span class="string">STATUS</span>    <span class="string">RESTARTS</span>   <span class="string">AGE</span>     <span class="string">IP</span>            <span class="string">NODE</span></span><br><span class="line"><span class="string">taint1-7665f7fd85-574h4</span>   <span class="number">1</span><span class="string">/1</span>     <span class="string">Running</span>   <span class="number">0</span>          <span class="string">2m24s</span>   <span class="number">10.244</span><span class="number">.1</span><span class="number">.59</span>   <span class="string">node1</span> </span><br><span class="line"><span class="string">taint2-544694789-6zmlf</span>    <span class="number">0</span><span class="string">/1</span>     <span class="string">Pending</span>   <span class="number">0</span>          <span class="string">21s</span>     <span class="string">&lt;none&gt;</span>        <span class="string">&lt;none&gt;</span>   </span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸ºnode1è®¾ç½®æ±¡ç‚¹(å–æ¶ˆNoScheduleï¼Œè®¾ç½®NoExecute)</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># kubectl taint nodes node1 tag:NoSchedule-</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># kubectl taint nodes node1 tag=heima:NoExecute</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºpod3</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># kubectl run taint3 --image=nginx:1.17.1 -n dev</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># kubectl get pods -n dev -o wide</span></span><br><span class="line"><span class="string">NAME</span>                      <span class="string">READY</span>   <span class="string">STATUS</span>    <span class="string">RESTARTS</span>   <span class="string">AGE</span>   <span class="string">IP</span>       <span class="string">NODE</span>     <span class="string">NOMINATED</span> </span><br><span class="line"><span class="string">taint1-7665f7fd85-htkmp</span>   <span class="number">0</span><span class="string">/1</span>     <span class="string">Pending</span>   <span class="number">0</span>          <span class="string">35s</span>   <span class="string">&lt;none&gt;</span>   <span class="string">&lt;none&gt;</span>   <span class="string">&lt;none&gt;</span>    </span><br><span class="line"><span class="string">taint2-544694789-bn7wb</span>    <span class="number">0</span><span class="string">/1</span>     <span class="string">Pending</span>   <span class="number">0</span>          <span class="string">35s</span>   <span class="string">&lt;none&gt;</span>   <span class="string">&lt;none&gt;</span>   <span class="string">&lt;none&gt;</span>     </span><br><span class="line"><span class="string">taint3-6d78dbd749-tktkq</span>   <span class="number">0</span><span class="string">/1</span>     <span class="string">Pending</span>   <span class="number">0</span>          <span class="string">6s</span>    <span class="string">&lt;none&gt;</span>   <span class="string">&lt;none&gt;</span>   <span class="string">&lt;none&gt;</span>     </span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="code"><pre><span class="line">å°æç¤ºï¼š</span><br><span class="line">    ä½¿ç”¨kubeadmæ­å»ºçš„é›†ç¾¤ï¼Œé»˜è®¤å°±ä¼šç»™masterèŠ‚ç‚¹æ·»åŠ ä¸€ä¸ªæ±¡ç‚¹æ ‡è®°,æ‰€ä»¥podå°±ä¸ä¼šè°ƒåº¦åˆ°masterèŠ‚ç‚¹ä¸Š.</span><br></pre></td></tr></table></figure></div>

<p><strong>å®¹å¿ï¼ˆTolerationï¼‰</strong></p>
<p>ä¸Šé¢ä»‹ç»äº†æ±¡ç‚¹çš„ä½œç”¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨nodeä¸Šæ·»åŠ æ±¡ç‚¹ç”¨äºæ‹’ç»podè°ƒåº¦ä¸Šæ¥ï¼Œä½†æ˜¯å¦‚æœå°±æ˜¯æƒ³å°†ä¸€ä¸ªpodè°ƒåº¦åˆ°ä¸€ä¸ªæœ‰æ±¡ç‚¹çš„nodeä¸Šå»ï¼Œè¿™æ—¶å€™åº”è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿè¿™å°±è¦ä½¿ç”¨åˆ°<strong>å®¹å¿</strong>ã€‚</p>
<p><img src="/2022/06/09/uncatalog/cl46zbayg000v7or7a4o0f4yd/image-20200514095913741.png" alt="image-20200514095913741"></p>
<blockquote>
<p>æ±¡ç‚¹å°±æ˜¯æ‹’ç»ï¼Œå®¹å¿å°±æ˜¯å¿½ç•¥ï¼ŒNodeé€šè¿‡æ±¡ç‚¹æ‹’ç»podè°ƒåº¦ä¸Šå»ï¼ŒPodé€šè¿‡å®¹å¿å¿½ç•¥æ‹’ç»</p>
</blockquote>
<p>ä¸‹é¢å…ˆé€šè¿‡ä¸€ä¸ªæ¡ˆä¾‹çœ‹ä¸‹æ•ˆæœï¼š</p>
<ol>
<li>ä¸Šä¸€å°èŠ‚ï¼Œå·²ç»åœ¨node1èŠ‚ç‚¹ä¸Šæ‰“ä¸Šäº†<code>NoExecute</code>çš„æ±¡ç‚¹ï¼Œæ­¤æ—¶podæ˜¯è°ƒåº¦ä¸ä¸Šå»çš„</li>
<li>æœ¬å°èŠ‚ï¼Œå¯ä»¥é€šè¿‡ç»™podæ·»åŠ å®¹å¿ï¼Œç„¶åå°†å…¶è°ƒåº¦ä¸Šå»</li>
</ol>
<p>åˆ›å»ºpod-toleration.yaml,å†…å®¹å¦‚ä¸‹</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Pod</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">pod-toleration</span></span><br><span class="line">  <span class="attr">namespace:</span> <span class="string">dev</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">containers:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:1.17.1</span></span><br><span class="line">  <span class="attr">tolerations:</span>      <span class="comment"># æ·»åŠ å®¹å¿</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">key:</span> <span class="string">&quot;tag&quot;</span>        <span class="comment"># è¦å®¹å¿çš„æ±¡ç‚¹çš„key</span></span><br><span class="line">    <span class="attr">operator:</span> <span class="string">&quot;Equal&quot;</span> <span class="comment"># æ“ä½œç¬¦</span></span><br><span class="line">    <span class="attr">value:</span> <span class="string">&quot;heima&quot;</span>    <span class="comment"># å®¹å¿çš„æ±¡ç‚¹çš„value</span></span><br><span class="line">    <span class="attr">effect:</span> <span class="string">&quot;NoExecute&quot;</span>   <span class="comment"># æ·»åŠ å®¹å¿çš„è§„åˆ™ï¼Œè¿™é‡Œå¿…é¡»å’Œæ ‡è®°çš„æ±¡ç‚¹è§„åˆ™ç›¸åŒ</span></span><br></pre></td></tr></table></figure></div>

<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ·»åŠ å®¹å¿ä¹‹å‰çš„pod</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># kubectl get pods -n dev -o wide</span></span><br><span class="line"><span class="string">NAME</span>             <span class="string">READY</span>   <span class="string">STATUS</span>    <span class="string">RESTARTS</span>   <span class="string">AGE</span>   <span class="string">IP</span>       <span class="string">NODE</span>     <span class="string">NOMINATED</span> </span><br><span class="line"><span class="string">pod-toleration</span>   <span class="number">0</span><span class="string">/1</span>     <span class="string">Pending</span>   <span class="number">0</span>          <span class="string">3s</span>    <span class="string">&lt;none&gt;</span>   <span class="string">&lt;none&gt;</span>   <span class="string">&lt;none&gt;</span>           </span><br><span class="line"></span><br><span class="line"><span class="comment"># æ·»åŠ å®¹å¿ä¹‹åçš„pod</span></span><br><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># kubectl get pods -n dev -o wide</span></span><br><span class="line"><span class="string">NAME</span>             <span class="string">READY</span>   <span class="string">STATUS</span>    <span class="string">RESTARTS</span>   <span class="string">AGE</span>   <span class="string">IP</span>            <span class="string">NODE</span>    <span class="string">NOMINATED</span></span><br><span class="line"><span class="string">pod-toleration</span>   <span class="number">1</span><span class="string">/1</span>     <span class="string">Running</span>   <span class="number">0</span>          <span class="string">3s</span>    <span class="number">10.244</span><span class="number">.1</span><span class="number">.62</span>   <span class="string">node1</span>   <span class="string">&lt;none&gt;</span>        </span><br></pre></td></tr></table></figure></div>

<p>ä¸‹é¢çœ‹ä¸€ä¸‹å®¹å¿çš„è¯¦ç»†é…ç½®:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line">[<span class="string">root@k8s-master01</span> <span class="string">~</span>]<span class="comment"># kubectl explain pod.spec.tolerations</span></span><br><span class="line"><span class="string">......</span></span><br><span class="line"><span class="attr">FIELDS:</span></span><br><span class="line">   <span class="string">key</span>       <span class="comment"># å¯¹åº”ç€è¦å®¹å¿çš„æ±¡ç‚¹çš„é”®ï¼Œç©ºæ„å‘³ç€åŒ¹é…æ‰€æœ‰çš„é”®</span></span><br><span class="line">   <span class="string">value</span>     <span class="comment"># å¯¹åº”ç€è¦å®¹å¿çš„æ±¡ç‚¹çš„å€¼</span></span><br><span class="line">   <span class="string">operator</span>  <span class="comment"># key-valueçš„è¿ç®—ç¬¦ï¼Œæ”¯æŒEqualå’ŒExistsï¼ˆé»˜è®¤ï¼‰</span></span><br><span class="line">   <span class="string">effect</span>    <span class="comment"># å¯¹åº”æ±¡ç‚¹çš„effectï¼Œç©ºæ„å‘³ç€åŒ¹é…æ‰€æœ‰å½±å“</span></span><br><span class="line">   <span class="string">tolerationSeconds</span>   <span class="comment"># å®¹å¿æ—¶é—´, å½“effectä¸ºNoExecuteæ—¶ç”Ÿæ•ˆï¼Œè¡¨ç¤ºpodåœ¨Nodeä¸Šçš„åœç•™æ—¶é—´</span></span><br></pre></td></tr></table></figure></div>

]]></content>
      <tags>
        <tag>äº‘åŸç”ŸåŸºç¡€ç³»åˆ—</tag>
        <tag>Kubernetes</tag>
      </tags>
  </entry>
  <entry>
    <title>äº‘åŸç”ŸåŸºç¡€ç³»åˆ—ä¹‹Docker(ä¸€)åŸºç¡€</title>
    <url>/2022/06/09/uncatalog/cl46zbgi6000y7or7g7cnd6w6/</url>
    <content><![CDATA[<hr>
<span id="more"></span>



<hr>
<h1 id="Dockeræ¦‚è¿°"><a href="#Dockeræ¦‚è¿°" class="headerlink" title="Dockeræ¦‚è¿°"></a>Dockeræ¦‚è¿°</h1><h2 id="Dockerä¸ºä»€ä¹ˆä¼šå‡ºç°ï¼Ÿ"><a href="#Dockerä¸ºä»€ä¹ˆä¼šå‡ºç°ï¼Ÿ" class="headerlink" title="Dockerä¸ºä»€ä¹ˆä¼šå‡ºç°ï¼Ÿ"></a>Dockerä¸ºä»€ä¹ˆä¼šå‡ºç°ï¼Ÿ</h2><p>ä¸€æ¬¾äº§å“ï¼š å¼€å‘â€“ä¸Šçº¿ ä¸¤å¥—ç¯å¢ƒï¼åº”ç”¨ç¯å¢ƒï¼Œåº”ç”¨é…ç½®ï¼</p>
<p>å¼€å‘ â€” è¿ç»´ã€‚ é—®é¢˜ï¼šæˆ‘åœ¨æˆ‘çš„ç”µè„‘ä¸Šå¯ä»¥å…è®¸ï¼ç‰ˆæœ¬æ›´æ–°ï¼Œå¯¼è‡´æœåŠ¡ä¸å¯ç”¨ï¼å¯¹äºè¿ç»´æ¥è¯´è€ƒéªŒååˆ†å¤§ï¼Ÿ</p>
<p>ç¯å¢ƒé…ç½®æ˜¯ååˆ†çš„éº»çƒ¦ï¼Œæ¯ä¸€ä¸ªåŠå…¶éƒ½è¦éƒ¨ç½²ç¯å¢ƒ(é›†ç¾¤Redisã€ESã€Hadoopâ€¦) !è´¹äº‹è´¹åŠ›ã€‚</p>
<p>å‘å¸ƒä¸€ä¸ªé¡¹ç›®( jar + (Redis MySQL JDK ES) ),é¡¹ç›®èƒ½ä¸èƒ½å¸¦ä¸Šç¯å¢ƒå®‰è£…æ‰“åŒ…ï¼</p>
<p>ä¹‹å‰åœ¨æœåŠ¡å™¨é…ç½®ä¸€ä¸ªåº”ç”¨çš„ç¯å¢ƒ Redis MySQL JDK ES Hadoop é…ç½®è¶…éº»çƒ¦äº†ï¼Œä¸èƒ½å¤Ÿè·¨å¹³å°ã€‚</p>
<p>å¼€å‘ç¯å¢ƒWindowsï¼Œæœ€åå‘å¸ƒåˆ°Linuxï¼</p>
<p><strong>ä¼ ç»Ÿï¼š</strong>å¼€å‘jarï¼Œè¿ç»´æ¥åšï¼</p>
<p><strong>ç°åœ¨ï¼š</strong>å¼€å‘æ‰“åŒ…éƒ¨ç½²ä¸Šçº¿ï¼Œä¸€å¥—æµç¨‹åšå®Œï¼</p>
<p><strong>å®‰å“æµç¨‹ï¼š</strong>java â€” apk â€”å‘å¸ƒï¼ˆåº”ç”¨å•†åº—ï¼‰ä¸€ å¼ ä¸‰ä½¿ç”¨apkä¸€å®‰è£…å³å¯ç”¨ï¼</p>
<p><strong>dockeræµç¨‹ï¼š</strong> java-jarï¼ˆç¯å¢ƒï¼‰â€” æ‰“åŒ…é¡¹ç›®å¸¯ä¸Šç¯å¢ƒï¼ˆé•œåƒï¼‰â€” ( Dockerä»“åº“ï¼šå•†åº—ï¼‰â€”ä¸‹è½½æˆ‘ä»¬å‘å¸ƒçš„é•œåƒ â€”ç›´æ¥è¿è¡Œå³å¯ï¼</p>
<p>Dockerç»™ä»¥ä¸Šçš„é—®é¢˜ï¼Œæå‡ºäº†è§£å†³æ–¹æ¡ˆï¼</p>
<p><img src="/2022/06/09/uncatalog/cl46zbgi6000y7or7g7cnd6w6/image-20200610142308099.png" alt="image-20200610142308099"></p>
<p>Dockerçš„æ€æƒ³æ¥æºäºé›†è£…ç®±ï¼</p>
<p>JRE â€”å¤šä¸ªåº”ç”¨ï¼ˆç«¯å£å†²çªï¼‰â€”åŸæ¥éƒ½æ˜¯äº¤å‰çš„ï¼</p>
<p>éš”ç¦»ï¼šDockeræ ¸å¿ƒæ€æƒ³ï¼æ‰“åŒ…è£…ç®±ï¼æ¯ä¸ªç®±å­éƒ½æ˜¯ç›¸äº’éš”ç¦»çš„ã€‚</p>
<p>Dockeré€šè¿‡éš”ç¦»æœºåˆ¶å¯ä»¥å°†æœåŠ¡å™¨åˆ©ç”¨åˆ°æè‡´ï¼</p>
<p>æœ¬è´¨ï¼šæ‰€æœ‰çš„æŠ€æœ¯éƒ½æ˜¯å› ä¸ºå‡ºç°äº†ä¸€äº›é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦å»è§£å†³ï¼Œæ‰å»å­¦ä¹ ï¼</p>
<h2 id="Dockerçš„å†å²"><a href="#Dockerçš„å†å²" class="headerlink" title="Dockerçš„å†å²"></a>Dockerçš„å†å²</h2><p>2010å¹´ï¼Œå‡ ä¸ªçš„å¹´è½»äººï¼Œå°±åœ¨ç¾å›½æˆç«‹äº†ä¸€å®¶å…¬å¸ <strong>dotcloud</strong></p>
<p>åšä¸€äº›passçš„äº‘è®¡ç®—æœåŠ¡ï¼LXCï¼ˆLinux Containerå®¹å™¨ï¼‰æœ‰å…³çš„å®¹å™¨æŠ€æœ¯ï¼</p>
<p>Linux Containerå®¹å™¨æ˜¯ä¸€ç§å†…æ ¸è™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œå¯ä»¥æä¾›è½»é‡çº§çš„è™šæ‹ŸåŒ–ï¼Œä»¥ä¾¿éš”ç¦»è¿›ç¨‹å’Œèµ„æºã€‚</p>
<p>ä»–ä»¬å°†è‡ªå·±çš„æŠ€æœ¯ï¼ˆå®¹å™¨åŒ–æŠ€æœ¯ï¼‰å‘½åå°±æ˜¯ Docker</p>
<p>Dockeråˆšåˆšå»¶ç”Ÿçš„æ—¶å€™ï¼Œæ²¡æœ‰å¼•èµ·è¡Œä¸šçš„æ³¨æ„ï¼dotCloudï¼Œå°±æ´»ä¸ä¸‹å»ï¼</p>
<p><strong>å¼€æº</strong></p>
<p>2013å¹´ï¼ŒDockerå¼€æºï¼</p>
<p>è¶Šæ¥è¶Šå¤šçš„äººå‘ç°dockerçš„ä¼˜ç‚¹ï¼ç«äº†ã€‚Dockeræ¯ä¸ªæœˆéƒ½ä¼šæ›´æ–°ä¸€ä¸ªç‰ˆæœ¬ï¼</p>
<p>2014å¹´4æœˆ9æ—¥ï¼ŒDocker1.0å‘å¸ƒï¼</p>
<p>dockerä¸ºä»€ä¹ˆè¿™ä¹ˆç«ï¼Ÿååˆ†çš„è½»å·§ï¼</p>
<p>åœ¨å®¹å™¨æŠ€æœ¯å‡ºæ¥ä¹‹å‰ï¼Œæˆ‘ä»¬éƒ½æ˜¯ä½¿ç”¨è™šæ‹ŸæœºæŠ€æœ¯ï¼</p>
<p>è™šæ‹Ÿæœºï¼šåœ¨windowä¸­è£…ä¸€ä¸ªVMwareï¼Œé€šè¿‡è¿™ä¸ªè½¯ä»¶æˆ‘ä»¬å¯ä»¥è™šæ‹Ÿå‡ºæ¥ä¸€å°æˆ–è€…å¤šå°ç”µè„‘ï¼ç¬¨é‡ï¼</p>
<p>è™šæ‹Ÿæœºä¹Ÿå±äºè™šæ‹ŸåŒ–æŠ€æœ¯ï¼ŒDockerå®¹å™¨æŠ€æœ¯ï¼Œä¹Ÿæ˜¯ä¸€ç§è™šæ‹ŸåŒ–æŠ€æœ¯ï¼</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">VMware : linux centos åŸç”Ÿé•œåƒï¼ˆä¸€ä¸ªç”µè„‘ï¼ï¼‰ éš”ç¦»ã€éœ€è¦å¼€å¯å¤šä¸ªè™šæ‹Ÿæœºï¼ å‡ ä¸ªG å‡ åˆ†é’Ÿ</span><br><span class="line">docker: éš”ç¦»ï¼Œé•œåƒï¼ˆæœ€æ ¸å¿ƒçš„ç¯å¢ƒ 4m + jdk + mysqlï¼‰ååˆ†çš„å°å·§ï¼Œè¿è¡Œé•œåƒå°±å¯ä»¥äº†ï¼å°å·§ï¼ å‡ ä¸ªM ç§’çº§å¯åŠ¨ï¼</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>èŠèŠDocker</p>
</blockquote>
<p>DockeråŸºäºGoè¯­è¨€å¼€å‘çš„ï¼å¼€æºé¡¹ç›®ï¼</p>
<p>dockerå®˜ç½‘ï¼š<a href="https://www.docker.com/">https://www.docker.com/</a></p>
<p><img src="/2022/06/09/uncatalog/cl46zbgi6000y7or7g7cnd6w6/image-20200610143923433.png" alt="image-20200610143923433"></p>
<p>æ–‡æ¡£ï¼š<a href="https://docs.docker.com/">https://docs.docker.com/</a> Dockerçš„æ–‡æ¡£æ˜¯è¶…çº§è¯¦ç»†çš„ï¼</p>
<p>ä»“åº“ï¼š<a href="https://hub.docker.com/">https://hub.docker.com/</a></p>
<h2 id="Dockerèƒ½å¹²å˜›"><a href="#Dockerèƒ½å¹²å˜›" class="headerlink" title="Dockerèƒ½å¹²å˜›"></a>Dockerèƒ½å¹²å˜›</h2><blockquote>
<p>ä¹‹å‰çš„è™šæ‹ŸæœºæŠ€æœ¯</p>
</blockquote>
<p><img src="/2022/06/09/uncatalog/cl46zbgi6000y7or7g7cnd6w6/image-20200610144126122.png" alt="image-20200610144126122"></p>
<blockquote>
<p>è™šæ‹ŸæœºæŠ€æœ¯ç¼ºç‚¹</p>
</blockquote>
<p>1ã€ èµ„æºå ç”¨ååˆ†å¤š</p>
<p>2ã€ å†—ä½™æ­¥éª¤å¤š</p>
<p>3ã€ å¯åŠ¨å¾ˆæ…¢ï¼</p>
<blockquote>
<p>å®¹å™¨æŠ€æœ¯</p>
</blockquote>
<p>å®¹å™¨åŒ–æŠ€æœ¯ä¸æ˜¯æ¨¡æ‹Ÿä¸€ä¸ªå®Œæ•´çš„æ“ä½œç³»ç»Ÿ</p>
<p><img src="/2022/06/09/uncatalog/cl46zbgi6000y7or7g7cnd6w6/image-20200610144338073.png" alt="image-20200610144338073"></p>
<p>æ¯”è¾ƒDockerå’Œè™šæ‹ŸæœºæŠ€æœ¯çš„ä¸åŒï¼š</p>
<ul>
<li>ä¼ ç»Ÿè™šæ‹Ÿæœºï¼Œè™šæ‹Ÿå‡ºä¸€å¥—å®¹å™¨å†…çš„åº”ç”¨ç›´æ¥è¿è¡Œåœ¨å®¿ä¸»æœºç¡¬ä»¶ï¼Œè¿è¡Œä¸€ä¸ªå®Œæ•´çš„æ“ä½œç³»ç»Ÿï¼Œç„¶ååœ¨è¿™ä¸ªç³»ç»Ÿä¸Šå®‰è£…å’Œè¿è¡Œè½¯ä»¶</li>
<li>å®¹å™¨å†…çš„åº”ç”¨ç›´æ¥è¿è¡Œåœ¨å®¿ä¸»æœºå†…ï¼Œå®¹å™¨æ˜¯æ²¡æœ‰è‡ªå·±çš„å†…æ ¸çš„ï¼Œä¹Ÿæ²¡æœ‰è™šæ‹Ÿæˆ‘ä»¬çš„ç¡¬ä»¶ï¼Œæ‰€ä»¥å°±è½»ä¾¿äº†</li>
<li>æ¯ä¸ªå®¹å™¨é—´æ˜¯ç›¸äº’éš”ç¦»çš„ï¼Œæ¯ä¸ªå®¹å™¨å†…éƒ½æœ‰ä¸€ä¸ªå±äºè‡ªå·±çš„æ–‡ä»¶ç³»ç»Ÿï¼Œäº’ä¸å½±å“</li>
</ul>
<blockquote>
<p>DevOps (å¼€å‘ã€è¿ç»´)</p>
</blockquote>
<p><strong>åº”ç”¨æ›´å¿«é€Ÿçš„äº¤ä»˜å’Œéƒ¨ç½²</strong></p>
<p>ä¼ ç»Ÿï¼šä¸€å †å¸®åŠ©æ–‡æ¡£ï¼Œå®‰è£…ç¨‹åº</p>
<p>Dockerï¼šæ‰“åŒ…é•œåƒå‘å¸ƒæµ‹è¯•ï¼Œä¸€é”®è¿è¡Œ</p>
<p><strong>æ›´ä¾¿æ·çš„å‡çº§å’Œæ‰©ç¼©å®¹</strong></p>
<p>ä½¿ç”¨äº†Dockerä¹‹åï¼Œæˆ‘ä»¬éƒ¨ç½²åº”ç”¨å°±å’Œæ­ç§¯æœ¨ä¸€æ ·ï¼</p>
<p>é¡¹ç›®æ‰“åŒ…ä¸ºä¸€ä¸ªé•œåƒï¼Œæ‰©å±•æœåŠ¡å™¨A! æœåŠ¡å™¨B</p>
<p><strong>æ›´ç®€å•çš„ç³»ç»Ÿè¿ç»´</strong></p>
<p>åœ¨å®¹å™¨åŒ–ä¹‹åï¼Œæˆ‘ä»¬çš„å¼€å‘ï¼Œæµ‹è¯•ç¯å¢ƒéƒ½æ˜¯é«˜åº¦ä¸€è‡´çš„ã€‚</p>
<p><strong>æ›´é«˜æ•ˆçš„è®¡ç®—èµ„æºåˆ©ç”¨</strong></p>
<p>Dockeræ˜¯å†…æ ¸çº§åˆ«çš„è™šæ‹ŸåŒ–ï¼Œå¯ä»¥åœ¨ä¸€ä¸ªç‰©ç†æœºä¸Šè¿è¡Œå¾ˆå¤šä¸ªå®¹å™¨å®ä¾‹ï¼æœåŠ¡å™¨çš„æ€§èƒ½å¯ä»¥è¢«å‹æ¦¨åˆ°æè‡´ã€‚</p>
<hr>
<h1 id="Dockerå®‰è£…"><a href="#Dockerå®‰è£…" class="headerlink" title="Dockerå®‰è£…"></a>Dockerå®‰è£…</h1><h2 id="Dockerçš„åŸºæœ¬ç»„æˆ"><a href="#Dockerçš„åŸºæœ¬ç»„æˆ" class="headerlink" title="Dockerçš„åŸºæœ¬ç»„æˆ"></a>Dockerçš„åŸºæœ¬ç»„æˆ</h2><p><img src="/2022/06/09/uncatalog/cl46zbgi6000y7or7g7cnd6w6/image-20200610145818895.png" alt="image-20200610145818895"></p>
<p><strong>é•œåƒï¼ˆimageï¼‰ï¼š</strong></p>
<p>dockeré•œåƒå°±å¥½æ¯”æ˜¯ä¸€ä¸ªç›®æ ‡ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªç›®æ ‡æ¥åˆ›å»ºå®¹å™¨æœåŠ¡ï¼Œtomcaté•œåƒ==&gt;run==&gt;å®¹å™¨ï¼ˆæä¾›æœåŠ¡å™¨ï¼‰ï¼Œé€šè¿‡è¿™ä¸ªé•œåƒå¯ä»¥åˆ›å»ºå¤šä¸ªå®¹å™¨ï¼ˆæœ€ç»ˆæœåŠ¡è¿è¡Œæˆ–è€…é¡¹ç›®è¿è¡Œå°±æ˜¯åœ¨å®¹å™¨ä¸­çš„ï¼‰ã€‚</p>
<p><strong>å®¹å™¨ï¼ˆcontainerï¼‰:</strong></p>
<p>Dockeråˆ©ç”¨å®¹å™¨æŠ€æœ¯ï¼Œç‹¬ç«‹è¿è¡Œä¸€ä¸ªæˆ–è€…ä¸€ç»„åº”ç”¨ï¼Œé€šè¿‡é•œåƒæ¥åˆ›å»ºçš„.</p>
<p>å¯åŠ¨ï¼Œåœæ­¢ï¼Œåˆ é™¤ï¼ŒåŸºæœ¬å‘½ä»¤</p>
<p>ç›®å‰å°±å¯ä»¥æŠŠè¿™ä¸ªå®¹å™¨ç†è§£ä¸ºå°±æ˜¯ä¸€ä¸ªç®€æ˜“çš„ Linuxç³»ç»Ÿã€‚</p>
<p><strong>ä»“åº“ï¼ˆrepositoryï¼‰:</strong></p>
<p>ä»“åº“å°±æ˜¯å­˜æ”¾é•œåƒçš„åœ°æ–¹ï¼</p>
<p>ä»“åº“åˆ†ä¸ºå…¬æœ‰ä»“åº“å’Œç§æœ‰ä»“åº“ã€‚(å¾ˆç±»ä¼¼git)</p>
<p>Docker Hubæ˜¯å›½å¤–çš„ã€‚</p>
<p>é˜¿é‡Œäº‘â€¦éƒ½æœ‰å®¹å™¨æœåŠ¡å™¨ (é…ç½®é•œåƒåŠ é€Ÿ!)</p>
<h2 id="å®‰è£…Docker"><a href="#å®‰è£…Docker" class="headerlink" title="å®‰è£…Docker"></a>å®‰è£…Docker</h2><blockquote>
<p>ç¯å¢ƒå‡†å¤‡</p>
</blockquote>
<p>1.Linuxè¦æ±‚å†…æ ¸3.0ä»¥ä¸Š</p>
<p>2.CentOS 7</p>
<blockquote>
<p>ç¯å¢ƒæŸ¥çœ‹</p>
</blockquote>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">ç³»ç»Ÿå†…æ ¸è¦æ±‚3.0ä»¥ä¸Š</span></span><br><span class="line">[root@localhost ~]# uname -r</span><br><span class="line">3.10.0-1062.el7.x86_64</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">ç³»ç»Ÿç‰ˆæœ¬</span></span><br><span class="line">[root@localhost ~]# cat /etc/os-release </span><br><span class="line">NAME=&quot;CentOS Linux&quot;</span><br><span class="line">VERSION=&quot;7 (Core)&quot;</span><br><span class="line">ID=&quot;centos&quot;</span><br><span class="line">ID_LIKE=&quot;rhel fedora&quot;</span><br><span class="line">VERSION_ID=&quot;7&quot;</span><br><span class="line">PRETTY_NAME=&quot;CentOS Linux 7 (Core)&quot;</span><br><span class="line">ANSI_COLOR=&quot;0;31&quot;</span><br><span class="line">CPE_NAME=&quot;cpe:/o:centos:centos:7&quot;</span><br><span class="line">HOME_URL=&quot;https://www.centos.org/&quot;</span><br><span class="line">BUG_REPORT_URL=&quot;https://bugs.centos.org/&quot;</span><br><span class="line"></span><br><span class="line">CENTOS_MANTISBT_PROJECT=&quot;CentOS-7&quot;</span><br><span class="line">CENTOS_MANTISBT_PROJECT_VERSION=&quot;7&quot;</span><br><span class="line">REDHAT_SUPPORT_PRODUCT=&quot;centos&quot;</span><br><span class="line">REDHAT_SUPPORT_PRODUCT_VERSION=&quot;7&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>



<blockquote>
<p>å®‰è£…</p>
</blockquote>
<p>å¸®åŠ©æ–‡æ¡£ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">1.å¸è½½æ—§ç‰ˆæœ¬</span></span><br><span class="line"> yum remove docker \</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">                   docker-client \</span></span><br><span class="line"><span class="bash">&gt;                   docker-client-latest \</span></span><br><span class="line"><span class="bash">&gt;                   docker-common \</span></span><br><span class="line"><span class="bash">&gt;                   docker-latest \</span></span><br><span class="line"><span class="bash">&gt;                   docker-latest-logrotate \</span></span><br><span class="line"><span class="bash">&gt;                   docker-logrotate \</span></span><br><span class="line"><span class="bash">&gt;                   docker-engine</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">2.éœ€è¦çš„å®‰è£…åŒ…</span></span><br><span class="line">yum install -y yum-utils</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">3.è®¾ç½®é•œåƒçš„ä»“åº“</span></span><br><span class="line">yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https://download.docker.com/linux/centos/docker-ce.repo</span><br><span class="line"><span class="meta">#</span><span class="bash">ä¸Šè¿°æ–¹æ³•é»˜è®¤æ˜¯ä»å›½å¤–çš„ï¼Œä¸æ¨è</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">æ¨èä½¿ç”¨å›½å†…çš„</span></span><br><span class="line">yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line">  </span><br><span class="line"><span class="meta">#</span><span class="bash">æ›´æ–°è½¯ä»¶åŒ…ç´¢å¼•</span></span><br><span class="line">yum makecache fast</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">4.å®‰è£…docker docker-ce ç¤¾åŒºç‰ˆ è€Œeeæ˜¯ä¼ä¸šç‰ˆ</span></span><br><span class="line">yum install docker-ce docker-ce-cli containerd.io # è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ç¤¾åŒºç‰ˆå³å¯</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">5.å¯åŠ¨docker</span></span><br><span class="line">systemctl start docker</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">6.ä½¿ç”¨docker version æŸ¥çœ‹æ˜¯å¦å®‰è£…æˆåŠŸ</span></span><br><span class="line">docker version</span><br></pre></td></tr></table></figure></div>

<p><img src="/2022/06/09/uncatalog/cl46zbgi6000y7or7g7cnd6w6/image-20200610153718450.png" alt="image-20200610153718450"></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">7.æµ‹è¯•</span></span><br><span class="line">docker run hello-world</span><br></pre></td></tr></table></figure></div>

<p><img src="/2022/06/09/uncatalog/cl46zbgi6000y7or7g7cnd6w6/image-20200610154108118.png" alt="image-20200610154108118"></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">8.æŸ¥çœ‹ä¸€ä¸‹ä¸‹è½½çš„hello-worldé•œåƒ</span></span><br><span class="line">[root@localhost /]# docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">hello-world         latest              bf756fb1ae65        5 months ago        13.3kB</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>äº†è§£ï¼šå¸è½½docker</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">1.å¸è½½ä¾èµ–</span></span><br><span class="line">yum remove docker-ce docker-ce-cli containerd.io</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">2. åˆ é™¤èµ„æº</span></span><br><span class="line">rm -rf /var/lib/docker</span><br><span class="line"><span class="meta">#</span><span class="bash"> /var/lib/docker æ˜¯dockerçš„é»˜è®¤å·¥ä½œè·¯å¾„ï¼</span></span><br></pre></td></tr></table></figure></div>

<p>é˜¿é‡Œäº‘é•œåƒåŠ é€Ÿ</p>
<p><strong>1ã€ç™»å½•é˜¿é‡Œäº‘æ‰¾åˆ°å®¹å™¨æœåŠ¡â€”â€”&gt;é•œåƒåŠ é€Ÿå™¨</strong></p>
<p><img src="/2022/06/09/uncatalog/cl46zbgi6000y7or7g7cnd6w6/image-20200610155156310.png" alt="image-20200610155156310"></p>
<p><strong>2ã€é…ç½®ä½¿ç”¨</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">sudo mkdir -p /etc/docker</span><br><span class="line"></span><br><span class="line">sudo tee /etc/docker/daemon.json &lt;&lt;-&#x27;EOF&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot;: [&quot;https://cdoid6va.mirror.aliyuncs.com&quot;]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line"></span><br><span class="line">sudo systemctl restart docker</span><br></pre></td></tr></table></figure></div>



<h2 id="å›é¡¾hello-worldæµç¨‹"><a href="#å›é¡¾hello-worldæµç¨‹" class="headerlink" title="å›é¡¾hello-worldæµç¨‹"></a>å›é¡¾hello-worldæµç¨‹</h2><p><img src="/2022/06/09/uncatalog/cl46zbgi6000y7or7g7cnd6w6/image-20200610160359287.png" alt="image-20200610160359287"></p>
<p><strong>docker run æµç¨‹å›¾</strong></p>
<p><img src="/2022/06/09/uncatalog/cl46zbgi6000y7or7g7cnd6w6/image-20200610160609037.png" alt="image-20200610160609037"></p>
<h2 id="åº•å±‚åŸç†"><a href="#åº•å±‚åŸç†" class="headerlink" title="åº•å±‚åŸç†"></a>åº•å±‚åŸç†</h2><p><strong>Dockeræ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Ÿ</strong></p>
<p>Dockeræ˜¯ä¸€ä¸ªClient-Serverç»“æ„çš„ç³»ç»Ÿï¼ŒDockerçš„å®ˆæŠ¤è¿›ç¨‹è¿è¡Œåœ¨å®¿ä¸»æœºä¸Šï¼Œé€šè¿‡Socketä»å®¢æˆ·ç«¯è®¿é—®ï¼</p>
<p>DockerServeræ¥å—åˆ°Docker-Clientçš„æŒ‡ä»¤ï¼Œå°±ä¼šæ‰§è¡Œè¿™ä¸ªå‘½ä»¤ï¼</p>
<p><img src="/2022/06/09/uncatalog/cl46zbgi6000y7or7g7cnd6w6/image-20200610161147612.png" alt="image-20200610161147612"></p>
<p><strong>Dockerä¸ºä»€ä¹ˆæ¯”VMå¿«ï¼Ÿ</strong></p>
<p>1ã€Dockeræœ‰ç€æ¯”è™šæ‹Ÿæœºæ›´å°‘çš„æŠ½è±¡å±‚</p>
<p>2ã€Dockeråˆ©ç”¨çš„æ˜¯å®¿ä¸»æœºçš„å†…æ ¸ï¼Œvméœ€è¦Guest Osã€‚</p>
<p><img src="/2022/06/09/uncatalog/cl46zbgi6000y7or7g7cnd6w6/image-20200610161342662.png" alt="image-20200610161342662"></p>
<p>æ‰€ä»¥è¯´ï¼Œæ–°å»ºä¸€ä¸ªå®¹å™¨çš„æ—¶å€™ï¼Œdockerä¸éœ€è¦åƒè™šæ‹Ÿæœºä¸€æ ·é‡æ–°åŠ è½½ä¸€ä¸ªæ“ä½œç³»ç»Ÿå†…æ ¸ï¼Œé¿å…å¼•å¯¼ã€‚è™šæ‹Ÿæœºæ˜¯åŠ è½½Guest Osï¼Œåˆ†é’Ÿçº§åˆ«çš„ï¼Œè€Œdockeræ˜¯åˆ©ç”¨å½“å‰å®¿ä¸»æœºçš„æ“ä½œç³»ç»Ÿï¼Œçœç•¥äº†å¤æ‚çš„è¿‡ç¨‹ï¼Œç§’çº§çš„ï¼</p>
<p><img src="/2022/06/09/uncatalog/cl46zbgi6000y7or7g7cnd6w6/image-20200610161845790.png" alt="image-20200610161845790"></p>
<hr>
<h1 id="Dockerçš„å¸¸ç”¨å‘½ä»¤"><a href="#Dockerçš„å¸¸ç”¨å‘½ä»¤" class="headerlink" title="Dockerçš„å¸¸ç”¨å‘½ä»¤"></a>Dockerçš„å¸¸ç”¨å‘½ä»¤</h1><h2 id="å¸®åŠ©å‘½ä»¤"><a href="#å¸®åŠ©å‘½ä»¤" class="headerlink" title="å¸®åŠ©å‘½ä»¤"></a>å¸®åŠ©å‘½ä»¤</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">docker version     # æ˜¾ç¤ºdockerçš„ç‰ˆæœ¬ä¿¡æ¯</span><br><span class="line">docker info        # æ˜¾ç¤ºdockerçš„ç³»ç»Ÿä¿¡æ¯ï¼ŒåŒ…æ‹¬é•œåƒå’Œå®¹å™¨çš„æ•°é‡</span><br><span class="line">docker å‘½ä»¤ --help  # å¸®åŠ©å‘½ä»¤</span><br></pre></td></tr></table></figure></div>

<p>å¸®åŠ©æ–‡æ¡£çš„åœ°å€ï¼š<a href="https://docs.docker.com/engine/reference/commandline/build/">https://docs.docker.com/engine/reference/commandline/build/</a></p>
<h2 id="é•œåƒå‘½ä»¤"><a href="#é•œåƒå‘½ä»¤" class="headerlink" title="é•œåƒå‘½ä»¤"></a>é•œåƒå‘½ä»¤</h2><p><strong>docker images</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">[root@localhost /]# docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">hello-world         latest              bf756fb1ae65        5 months ago        13.3kB</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">è§£é‡Š</span></span><br><span class="line">REPOSITORY  é•œåƒçš„ä»“åº“æº</span><br><span class="line">TAG         é•œåƒæ ‡ç­¾</span><br><span class="line">IMAGE ID    é•œåƒid</span><br><span class="line">CREATED     é•œåƒçš„åˆ›å»ºæ—¶é—´</span><br><span class="line">SIZE        é•œåƒçš„å¤§å°</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">å¯é€‰é¡¹</span></span><br><span class="line">Options:</span><br><span class="line">  -a, --all             # åˆ—å‡ºæ‰€æœ‰é•œåƒ</span><br><span class="line">  -q, --quiet           # åªæ˜¾ç¤ºé•œåƒid</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p><strong>docker search æœç´¢é•œåƒ</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">[root@localhost /]# docker search mysql</span><br><span class="line">NAME                              DESCRIPTION                                     STARS               OFFICIAL            AUTOMATED</span><br><span class="line">mysql                             MySQL is a widely used, open-source relationâ€¦   9604                [OK]                </span><br><span class="line">mariadb                           MariaDB is a community-developed fork of MySâ€¦   3490                [OK]                </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">å¯é€‰é¡¹ï¼Œé€šè¿‡æ”¶è—æ¥è¿‡æ»¤</span></span><br><span class="line">--filter=STARS=3000  #æœç´¢å‡ºæ¥çš„é•œåƒå°±æ˜¯STARSå¤§äº3000çš„</span><br><span class="line">[root@localhost /]# docker search mysql --filter=STARS=3000</span><br><span class="line">NAME                DESCRIPTION                                     STARS               OFFICIAL            AUTOMATED</span><br><span class="line">mysql               MySQL is a widely used, open-source relationâ€¦   9604                [OK]                </span><br><span class="line">mariadb             MariaDB is a community-developed fork of MySâ€¦   3490                [OK]                </span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p><strong>docker pull ä¸‹è½½é•œåƒ</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ä¸‹è½½é•œåƒ docker pull é•œåƒå[:tag]</span></span><br><span class="line">[root@localhost /]# docker pull mysql</span><br><span class="line">Using default tag: latest    # å¦‚æœä¸å†™ tag,é»˜è®¤å°±æ˜¯latest</span><br><span class="line">latest: Pulling from library/mysql</span><br><span class="line">8559a31e96f4: Pull complete  # åˆ†å±‚ä¸‹è½½ï¼Œdocker imageçš„æ ¸å¿ƒ è”åˆæ–‡ä»¶ç³»ç»Ÿ</span><br><span class="line">d51ce1c2e575: Pull complete </span><br><span class="line">c2344adc4858: Pull complete </span><br><span class="line">fcf3ceff18fc: Pull complete </span><br><span class="line">16da0c38dc5b: Pull complete </span><br><span class="line">b905d1797e97: Pull complete </span><br><span class="line">4b50d1c6b05c: Pull complete </span><br><span class="line">c75914a65ca2: Pull complete </span><br><span class="line">1ae8042bdd09: Pull complete </span><br><span class="line">453ac13c00a3: Pull complete </span><br><span class="line">9e680cd72f08: Pull complete </span><br><span class="line">a6b5dc864b6c: Pull complete </span><br><span class="line">Digest: sha256:8b7b328a7ff6de46ef96bcf83af048cb00a1c86282bfca0cb119c84568b4caf6 # ç­¾å</span><br><span class="line">Status: Downloaded newer image for mysql:latest</span><br><span class="line">docker.io/library/mysql:latest  # çœŸå®åœ°å€</span><br><span class="line"></span><br><span class="line">docker pull mysql ç­‰ä»·äº: docker pull docker.io/library/mysql:latest</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŒ‡å®šç‰ˆæœ¬ä¸‹è½½</span></span><br><span class="line">[root@localhost /]# docker pull mysql:5.7</span><br><span class="line">5.7: Pulling from library/mysql</span><br><span class="line">8559a31e96f4: Already exists   # è”åˆæ–‡ä»¶ç³»ç»Ÿçš„å¥½å¤„ï¼šä¸Šé¢ä¸‹è½½è¿‡çš„MySQLä¸5.7ç‰ˆæœ¬çš„MySQLæœ‰ç›¸åŒçš„æ–‡ä»¶æ—¶ä¸éœ€è¦é‡å¤ä¸‹è½½</span><br><span class="line">d51ce1c2e575: Already exists </span><br><span class="line">c2344adc4858: Already exists </span><br><span class="line">fcf3ceff18fc: Already exists </span><br><span class="line">16da0c38dc5b: Already exists </span><br><span class="line">b905d1797e97: Already exists </span><br><span class="line">4b50d1c6b05c: Already exists </span><br><span class="line">d85174a87144: Pull complete </span><br><span class="line">a4ad33703fa8: Pull complete </span><br><span class="line">f7a5433ce20d: Pull complete </span><br><span class="line">3dcd2a278b4a: Pull complete </span><br><span class="line">Digest: sha256:32f9d9a069f7a735e28fd44ea944d53c61f990ba71460c5c183e610854ca4854</span><br><span class="line">Status: Downloaded newer image for mysql:5.7</span><br><span class="line">docker.io/library/mysql:5.7</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p><img src="/2022/06/09/uncatalog/cl46zbgi6000y7or7g7cnd6w6/image-20200610165130055.png" alt="image-20200610165130055"></p>
<p><strong>docker rmi åˆ é™¤é•œåƒ</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">[root@localhost /]# docker rmi -f é•œåƒid  				 #åˆ é™¤æŒ‡å®šé•œåƒ</span><br><span class="line">[root@localhost /]# docker rmi -f é•œåƒid é•œåƒid é•œåƒid  	   #åˆ é™¤å¤šä¸ªé•œåƒ</span><br><span class="line">[root@localhost /]# docker rmi -f $(docker images -aq)     #åˆ é™¤å…¨éƒ¨é•œåƒ</span><br></pre></td></tr></table></figure></div>

<h2 id="å®¹å™¨å‘½ä»¤"><a href="#å®¹å™¨å‘½ä»¤" class="headerlink" title="å®¹å™¨å‘½ä»¤"></a>å®¹å™¨å‘½ä»¤</h2><p><strong>è¯´æ˜ï¼šæœ‰äº†é•œåƒæ‰å¯ä»¥åˆ›å»ºå®¹å™¨ï¼Œlinux,ä¸‹è½½ä¸€ä¸ªcentosé•œåƒæ¥å­¦ä¹ </strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">docker pull centos</span><br></pre></td></tr></table></figure></div>

<p><strong>æ–°å»ºå®¹å™¨å¹¶å¯åŠ¨</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">docker run [å¯é€‰å‚æ•°] image</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å‚æ•°è¯´æ˜</span></span><br><span class="line">--name=&quot;Name&quot;	å®¹å™¨åå­— tomcat01 tomcat02 ï¼Œç”¨æ¥åŒºåˆ†å®¹å™¨</span><br><span class="line">-d              åå°æ–¹å¼è¿è¡Œ</span><br><span class="line">-it             ä½¿ç”¨äº¤äº’æ–¹å¼è¿è¡Œï¼Œè¿›å…¥å®¹å™¨æŸ¥çœ‹å†…å®¹</span><br><span class="line">-p              æŒ‡å®šå®¹å™¨çš„ç«¯å£ -p 8080:80</span><br><span class="line">	-p  ip:ä¸»æœº(å³å®¿ä¸»æœº)ç«¯å£ï¼šå®¹å™¨ç«¯å£</span><br><span class="line">	-p  ä¸»æœºç«¯å£ï¼šå®¹å™¨ç«¯å£  #è¿™ç§æ–¹å¼å¸¸ç”¨</span><br><span class="line">	-p  å®¹å™¨ç«¯å£</span><br><span class="line">	å®¹å™¨ç«¯å£P</span><br><span class="line">-P              éšæœºæŒ‡å®šç«¯å£(å¤§å†™P)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æµ‹è¯•ï¼Œå¯åŠ¨å¹¶è¿›å…¥å®¹å™¨</span></span><br><span class="line">[root@localhost /]# docker run -it centos /bin/bash</span><br><span class="line">[root@8b4c74381205 /]# ls     #æŸ¥çœ‹å®¹å™¨å†…çš„centos,åŸºç¡€ç‰ˆæœ¬ï¼Œå¾ˆå¤šå‘½ä»¤éƒ½æ˜¯ä¸å®Œå–„çš„ï¼</span><br><span class="line">bin  etc   lib	  lost+found  mnt  proc  run   srv  tmp  var</span><br><span class="line">dev  home  lib64  media       opt  root  sbin  sys  usr</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä»å®¹å™¨ä¸­é€€å›ä¸»æœº</span></span><br><span class="line">[root@8b4c74381205 /]# exit</span><br><span class="line">exit</span><br><span class="line">[root@localhost /]# ls</span><br><span class="line">123  bin   dev  home  lib64  mnt  proc  run   srv  tmp  var</span><br><span class="line">222  boot  etc  lib   media  opt  root  sbin  sys  usr</span><br></pre></td></tr></table></figure></div>

<p><strong>åˆ—å‡ºæ‰€æœ‰è¿è¡Œçš„å®¹å™¨</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> docker ps å‘½ä»¤</span></span><br><span class="line">(ä¸åŠ ï¼‰ # åˆ—å‡ºå½“å‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨</span><br><span class="line">-a     # åˆ—å‡ºå½“å‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨ + å¸¦å‡ºå†å²è¿è¡Œè¿‡çš„å®¹å™¨</span><br><span class="line">-n=?   # æ˜¾ç¤ºæœ€è¿‘åˆ›å»ºçš„å®¹å™¨</span><br><span class="line">-q    # åªæ˜¾ç¤ºå½“å‰å®¹å™¨çš„ç¼–å·</span><br><span class="line">[root@localhost /]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line">[root@localhost /]# docker ps -a</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                          PORTS               NAMES</span><br><span class="line">8b4c74381205        centos              &quot;/bin/bash&quot;         4 minutes ago       Exited (0) About a minute ago                       epic_wilson</span><br><span class="line">fb87667bbc19        bf756fb1ae65        &quot;/hello&quot;            2 hours ago         Exited (0) 2 hours ago                              awesome_banach</span><br><span class="line">[root@localhost /]# docker ps -a -n=1</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS                     PORTS               NAMES</span><br><span class="line">8b4c74381205        centos              &quot;/bin/bash&quot;         9 minutes ago       Exited (0) 6 minutes ago                       epic_wilson</span><br><span class="line">[root@localhost /]# docker ps -aq</span><br><span class="line">8b4c74381205</span><br><span class="line">fb87667bbc19</span><br></pre></td></tr></table></figure></div>

<p><strong>é€€å‡ºå®¹å™¨</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">exit   # ç›´æ¥é€€å‡ºå®¹å™¨</span><br><span class="line">Ctrl + p + q  # å®¹å™¨ä¸åœæ­¢é€€å‡º</span><br></pre></td></tr></table></figure></div>

<p><strong>åˆ é™¤å®¹å™¨</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">docker rm å®¹å™¨id				   # åˆ é™¤æŒ‡å®šå®¹å™¨ï¼Œä¸èƒ½åˆ é™¤æ­£åœ¨è¿è¡Œçš„å®¹å™¨ï¼Œå¦‚æœè¦å¼ºåˆ¶åˆ é™¤ rm -f</span><br><span class="line">docker rm -f $(docker ps -aq)    # åˆ é™¤æ‰€æœ‰å®¹å™¨ </span><br><span class="line">docker ps -a -q|xargs docker rm  # åˆ é™¤æ‰€æœ‰å®¹å™¨</span><br></pre></td></tr></table></figure></div>

<p><strong>å¯åŠ¨å’Œåœæ­¢å®¹å™¨çš„æ“ä½œ</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">docker start å®¹å™¨id     # å¯åŠ¨å®¹å™¨</span><br><span class="line">docker restart å®¹å™¨id   # é‡å¯å®¹å™¨</span><br><span class="line">docker stop å®¹å™¨id      # åœæ­¢å½“å‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨</span><br><span class="line">docker kill å®¹å™¨id      # å¼ºåˆ¶åœæ­¢å½“å‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨</span><br></pre></td></tr></table></figure></div>

<h2 id="å¸¸ç”¨å…¶ä»–å‘½ä»¤"><a href="#å¸¸ç”¨å…¶ä»–å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å…¶ä»–å‘½ä»¤"></a>å¸¸ç”¨å…¶ä»–å‘½ä»¤</h2><p><strong>åå°å¯åŠ¨å®¹å™¨</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å‘½ä»¤ docker run -d é•œåƒå</span></span><br><span class="line"></span><br><span class="line">[root@localhost /]# docker run -d centos</span><br><span class="line">e9d60f206fa19963203db6c42c2f83c5120eb90eeee2b7ba9fdc4589370fd6b6</span><br><span class="line">[root@localhost /]# docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND             CREATED             STATUS              PORTS               NAMES</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> é—®é¢˜docker ps,å‘ç° centos åœæ­¢äº†</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¸¸è§çš„å‘ï¼Œdocker å®¹å™¨ä½¿ç”¨åå°è¿è¡Œï¼Œå°±å¿…é¡»è¦æœ‰ä¸€ä¸ªå‰å°è¿›ç¨‹ï¼Œdockerå‘ç°æ²¡æœ‰åº”ç”¨ï¼Œå°±ä¼šè‡ªåŠ¨åœæ­¢</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> nginx,å®¹å™¨å¯åŠ¨åï¼Œå‘ç°è‡ªå·±æ²¡æœ‰æä¾›æœåŠ¡ï¼Œå°±ä¼šç«‹åˆ»åœæ­¢ï¼Œå°±æ˜¯æ²¡æœ‰ç¨‹åºäº†</span></span><br></pre></td></tr></table></figure></div>

<p><strong>æŸ¥çœ‹æ—¥å¿—</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">docker logs -f -t --tail æ•°å­— å®¹å™¨id</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ˜¾ç¤ºæ—¥å¿—</span></span><br><span class="line">-tf 	# æ˜¾ç¤ºæ—¥å¿—</span><br><span class="line">--tail  # è¦æ˜¾ç¤ºçš„æ—¥å¿—æ¡æ•°</span><br><span class="line">[root@localhost /]# docker logs -tf --tail 10 ce989f90023d </span><br></pre></td></tr></table></figure></div>

<p><strong>æŸ¥çœ‹å®¹å™¨ä¸­è¿›ç¨‹ä¿¡æ¯</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å‘½ä»¤ docker top å®¹å™¨id</span></span><br><span class="line">[root@localhost /]# docker top ce989f90023d</span><br><span class="line">UID                 PID                 PPID                C                   STIME               TTY                 TIME     </span><br><span class="line">root                12249               12232               0                   22:44               pts/0               00:00:00 </span><br></pre></td></tr></table></figure></div>

<p><strong>æŸ¥çœ‹é•œåƒçš„å…ƒæ•°æ®</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å‘½ä»¤</span></span><br><span class="line">docker inspect å®¹å™¨id</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æµ‹è¯•</span></span><br><span class="line">[root@localhost /]# docker inspect ce989f90023d</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Id&quot;: &quot;ce989f90023dedc0b3f39c057b91f5c0b17180b3aef7aea0df8c93731e724244&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2020-06-10T14:44:45.025360147Z&quot;,</span><br><span class="line">        &quot;Path&quot;: &quot;/bin/bash&quot;,</span><br><span class="line">        &quot;Args&quot;: [],</span><br><span class="line">        &quot;State&quot;: &#123;</span><br><span class="line">            &quot;Status&quot;: &quot;running&quot;,</span><br><span class="line">            &quot;Running&quot;: true,</span><br><span class="line">            &quot;Paused&quot;: false,</span><br><span class="line">            &quot;Restarting&quot;: false,</span><br><span class="line">            &quot;OOMKilled&quot;: false,</span><br><span class="line">            &quot;Dead&quot;: false,</span><br><span class="line">            &quot;Pid&quot;: 12249,</span><br><span class="line">            &quot;ExitCode&quot;: 0,</span><br><span class="line">            &quot;Error&quot;: &quot;&quot;,</span><br><span class="line">            &quot;StartedAt&quot;: &quot;2020-06-10T14:44:45.770227584Z&quot;,</span><br><span class="line">            &quot;FinishedAt&quot;: &quot;0001-01-01T00:00:00Z&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Image&quot;: &quot;sha256:470671670cac686c7cf0081e0b37da2e9f4f768ddc5f6a26102ccd1c6954c1ee&quot;,</span><br><span class="line">        &quot;ResolvConfPath&quot;: &quot;/var/lib/docker/containers/ce989f90023dedc0b3f39c057b91f5c0b17180b3aef7aea0df8c93731e724244/resolv.conf&quot;,</span><br><span class="line">        &quot;HostnamePath&quot;: &quot;/var/lib/docker/containers/ce989f90023dedc0b3f39c057b91f5c0b17180b3aef7aea0df8c93731e724244/hostname&quot;,</span><br><span class="line">        &quot;HostsPath&quot;: &quot;/var/lib/docker/containers/ce989f90023dedc0b3f39c057b91f5c0b17180b3aef7aea0df8c93731e724244/hosts&quot;,</span><br><span class="line">        &quot;LogPath&quot;: &quot;/var/lib/docker/containers/ce989f90023dedc0b3f39c057b91f5c0b17180b3aef7aea0df8c93731e724244/ce989f90023dedc0b3f39c057b91f5c0b17180b3aef7aea0df8c93731e724244-json.log&quot;,</span><br><span class="line">        &quot;Name&quot;: &quot;/nifty_johnson&quot;,</span><br><span class="line">        &quot;RestartCount&quot;: 0,</span><br><span class="line">        &quot;Driver&quot;: &quot;overlay2&quot;,</span><br><span class="line">        &quot;Platform&quot;: &quot;linux&quot;,</span><br><span class="line">        &quot;MountLabel&quot;: &quot;&quot;,</span><br><span class="line">        &quot;ProcessLabel&quot;: &quot;&quot;,</span><br><span class="line">        &quot;AppArmorProfile&quot;: &quot;&quot;,</span><br><span class="line">        &quot;ExecIDs&quot;: null,</span><br><span class="line">        &quot;HostConfig&quot;: &#123;</span><br><span class="line">            &quot;Binds&quot;: null,</span><br><span class="line">            &quot;ContainerIDFile&quot;: &quot;&quot;,</span><br><span class="line">            &quot;LogConfig&quot;: &#123;</span><br><span class="line">                &quot;Type&quot;: &quot;json-file&quot;,</span><br><span class="line">                &quot;Config&quot;: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;NetworkMode&quot;: &quot;default&quot;,</span><br><span class="line">            &quot;PortBindings&quot;: &#123;&#125;,</span><br><span class="line">            &quot;RestartPolicy&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;no&quot;,</span><br><span class="line">                &quot;MaximumRetryCount&quot;: 0</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;AutoRemove&quot;: false,</span><br><span class="line">            &quot;VolumeDriver&quot;: &quot;&quot;,</span><br><span class="line">            &quot;VolumesFrom&quot;: null,</span><br><span class="line">            &quot;CapAdd&quot;: null,</span><br><span class="line">            &quot;CapDrop&quot;: null,</span><br><span class="line">            &quot;Capabilities&quot;: null,</span><br><span class="line">            &quot;Dns&quot;: [],</span><br><span class="line">            &quot;DnsOptions&quot;: [],</span><br><span class="line">            &quot;DnsSearch&quot;: [],</span><br><span class="line">            &quot;ExtraHosts&quot;: null,</span><br><span class="line">            &quot;GroupAdd&quot;: null,</span><br><span class="line">            &quot;IpcMode&quot;: &quot;private&quot;,</span><br><span class="line">            &quot;Cgroup&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Links&quot;: null,</span><br><span class="line">            &quot;OomScoreAdj&quot;: 0,</span><br><span class="line">            &quot;PidMode&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Privileged&quot;: false,</span><br><span class="line">            &quot;PublishAllPorts&quot;: false,</span><br><span class="line">            &quot;ReadonlyRootfs&quot;: false,</span><br><span class="line">            &quot;SecurityOpt&quot;: null,</span><br><span class="line">            &quot;UTSMode&quot;: &quot;&quot;,</span><br><span class="line">            &quot;UsernsMode&quot;: &quot;&quot;,</span><br><span class="line">            &quot;ShmSize&quot;: 67108864,</span><br><span class="line">            &quot;Runtime&quot;: &quot;runc&quot;,</span><br><span class="line">            &quot;ConsoleSize&quot;: [</span><br><span class="line">                0,</span><br><span class="line">                0</span><br><span class="line">            ],</span><br><span class="line">            &quot;Isolation&quot;: &quot;&quot;,</span><br><span class="line">            &quot;CpuShares&quot;: 0,</span><br><span class="line">            &quot;Memory&quot;: 0,</span><br><span class="line">            &quot;NanoCpus&quot;: 0,</span><br><span class="line">            &quot;CgroupParent&quot;: &quot;&quot;,</span><br><span class="line">            &quot;BlkioWeight&quot;: 0,</span><br><span class="line">            &quot;BlkioWeightDevice&quot;: [],</span><br><span class="line">            &quot;BlkioDeviceReadBps&quot;: null,</span><br><span class="line">            &quot;BlkioDeviceWriteBps&quot;: null,</span><br><span class="line">            &quot;BlkioDeviceReadIOps&quot;: null,</span><br><span class="line">            &quot;BlkioDeviceWriteIOps&quot;: null,</span><br><span class="line">            &quot;CpuPeriod&quot;: 0,</span><br><span class="line">            &quot;CpuQuota&quot;: 0,</span><br><span class="line">            &quot;CpuRealtimePeriod&quot;: 0,</span><br><span class="line">            &quot;CpuRealtimeRuntime&quot;: 0,</span><br><span class="line">            &quot;CpusetCpus&quot;: &quot;&quot;,</span><br><span class="line">            &quot;CpusetMems&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Devices&quot;: [],</span><br><span class="line">            &quot;DeviceCgroupRules&quot;: null,</span><br><span class="line">            &quot;DeviceRequests&quot;: null,</span><br><span class="line">            &quot;KernelMemory&quot;: 0,</span><br><span class="line">            &quot;KernelMemoryTCP&quot;: 0,</span><br><span class="line">            &quot;MemoryReservation&quot;: 0,</span><br><span class="line">            &quot;MemorySwap&quot;: 0,</span><br><span class="line">            &quot;MemorySwappiness&quot;: null,</span><br><span class="line">            &quot;OomKillDisable&quot;: false,</span><br><span class="line">            &quot;PidsLimit&quot;: null,</span><br><span class="line">            &quot;Ulimits&quot;: null,</span><br><span class="line">            &quot;CpuCount&quot;: 0,</span><br><span class="line">            &quot;CpuPercent&quot;: 0,</span><br><span class="line">            &quot;IOMaximumIOps&quot;: 0,</span><br><span class="line">            &quot;IOMaximumBandwidth&quot;: 0,</span><br><span class="line">            &quot;MaskedPaths&quot;: [</span><br><span class="line">                &quot;/proc/asound&quot;,</span><br><span class="line">                &quot;/proc/acpi&quot;,</span><br><span class="line">                &quot;/proc/kcore&quot;,</span><br><span class="line">                &quot;/proc/keys&quot;,</span><br><span class="line">                &quot;/proc/latency_stats&quot;,</span><br><span class="line">                &quot;/proc/timer_list&quot;,</span><br><span class="line">                &quot;/proc/timer_stats&quot;,</span><br><span class="line">                &quot;/proc/sched_debug&quot;,</span><br><span class="line">                &quot;/proc/scsi&quot;,</span><br><span class="line">                &quot;/sys/firmware&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;ReadonlyPaths&quot;: [</span><br><span class="line">                &quot;/proc/bus&quot;,</span><br><span class="line">                &quot;/proc/fs&quot;,</span><br><span class="line">                &quot;/proc/irq&quot;,</span><br><span class="line">                &quot;/proc/sys&quot;,</span><br><span class="line">                &quot;/proc/sysrq-trigger&quot;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;GraphDriver&quot;: &#123;</span><br><span class="line">            &quot;Data&quot;: &#123;</span><br><span class="line">                &quot;LowerDir&quot;: &quot;/var/lib/docker/overlay2/bce8b2400427de29dd406d54ec08b3c07dc95530e80d37977a156ca971b37641-init/diff:/var/lib/docker/overlay2/d4cd3bedb1e7340e62bb292c1e0d5ae37b1d1689ffc1640da67b2a8325facc21/diff&quot;,</span><br><span class="line">                &quot;MergedDir&quot;: &quot;/var/lib/docker/overlay2/bce8b2400427de29dd406d54ec08b3c07dc95530e80d37977a156ca971b37641/merged&quot;,</span><br><span class="line">                &quot;UpperDir&quot;: &quot;/var/lib/docker/overlay2/bce8b2400427de29dd406d54ec08b3c07dc95530e80d37977a156ca971b37641/diff&quot;,</span><br><span class="line">                &quot;WorkDir&quot;: &quot;/var/lib/docker/overlay2/bce8b2400427de29dd406d54ec08b3c07dc95530e80d37977a156ca971b37641/work&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;Name&quot;: &quot;overlay2&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Mounts&quot;: [],</span><br><span class="line">        &quot;Config&quot;: &#123;</span><br><span class="line">            &quot;Hostname&quot;: &quot;ce989f90023d&quot;,</span><br><span class="line">            &quot;Domainname&quot;: &quot;&quot;,</span><br><span class="line">            &quot;User&quot;: &quot;&quot;,</span><br><span class="line">            &quot;AttachStdin&quot;: true,</span><br><span class="line">            &quot;AttachStdout&quot;: true,</span><br><span class="line">            &quot;AttachStderr&quot;: true,</span><br><span class="line">            &quot;Tty&quot;: true,</span><br><span class="line">            &quot;OpenStdin&quot;: true,</span><br><span class="line">            &quot;StdinOnce&quot;: true,</span><br><span class="line">            &quot;Env&quot;: [</span><br><span class="line">                &quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Cmd&quot;: [</span><br><span class="line">                &quot;/bin/bash&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Image&quot;: &quot;centos&quot;,</span><br><span class="line">            &quot;Volumes&quot;: null,</span><br><span class="line">            &quot;WorkingDir&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Entrypoint&quot;: null,</span><br><span class="line">            &quot;OnBuild&quot;: null,</span><br><span class="line">            &quot;Labels&quot;: &#123;</span><br><span class="line">                &quot;org.label-schema.build-date&quot;: &quot;20200114&quot;,</span><br><span class="line">                &quot;org.label-schema.license&quot;: &quot;GPLv2&quot;,</span><br><span class="line">                &quot;org.label-schema.name&quot;: &quot;CentOS Base Image&quot;,</span><br><span class="line">                &quot;org.label-schema.schema-version&quot;: &quot;1.0&quot;,</span><br><span class="line">                &quot;org.label-schema.vendor&quot;: &quot;CentOS&quot;,</span><br><span class="line">                &quot;org.opencontainers.image.created&quot;: &quot;2020-01-14 00:00:00-08:00&quot;,</span><br><span class="line">                &quot;org.opencontainers.image.licenses&quot;: &quot;GPL-2.0-only&quot;,</span><br><span class="line">                &quot;org.opencontainers.image.title&quot;: &quot;CentOS Base Image&quot;,</span><br><span class="line">                &quot;org.opencontainers.image.vendor&quot;: &quot;CentOS&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;NetworkSettings&quot;: &#123;</span><br><span class="line">            &quot;Bridge&quot;: &quot;&quot;,</span><br><span class="line">            &quot;SandboxID&quot;: &quot;74d140bbc60432c5fdce865fa48f78c1138923dd292e708a25c4de17de812d56&quot;,</span><br><span class="line">            &quot;HairpinMode&quot;: false,</span><br><span class="line">            &quot;LinkLocalIPv6Address&quot;: &quot;&quot;,</span><br><span class="line">            &quot;LinkLocalIPv6PrefixLen&quot;: 0,</span><br><span class="line">            &quot;Ports&quot;: &#123;&#125;,</span><br><span class="line">            &quot;SandboxKey&quot;: &quot;/var/run/docker/netns/74d140bbc604&quot;,</span><br><span class="line">            &quot;SecondaryIPAddresses&quot;: null,</span><br><span class="line">            &quot;SecondaryIPv6Addresses&quot;: null,</span><br><span class="line">            &quot;EndpointID&quot;: &quot;3580dd1064b07f434c61e316f14cb7d7b53a3d6d7c9c0f77eb6570f1781623bc&quot;,</span><br><span class="line">            &quot;Gateway&quot;: &quot;172.17.0.1&quot;,</span><br><span class="line">            &quot;GlobalIPv6Address&quot;: &quot;&quot;,</span><br><span class="line">            &quot;GlobalIPv6PrefixLen&quot;: 0,</span><br><span class="line">            &quot;IPAddress&quot;: &quot;172.17.0.3&quot;,</span><br><span class="line">            &quot;IPPrefixLen&quot;: 16,</span><br><span class="line">            &quot;IPv6Gateway&quot;: &quot;&quot;,</span><br><span class="line">            &quot;MacAddress&quot;: &quot;02:42:ac:11:00:03&quot;,</span><br><span class="line">            &quot;Networks&quot;: &#123;</span><br><span class="line">                &quot;bridge&quot;: &#123;</span><br><span class="line">                    &quot;IPAMConfig&quot;: null,</span><br><span class="line">                    &quot;Links&quot;: null,</span><br><span class="line">                    &quot;Aliases&quot;: null,</span><br><span class="line">                    &quot;NetworkID&quot;: &quot;58fd9703e96d12128c30f244be3205e3fe31fc7d1fb7fffdddba72d981e782f4&quot;,</span><br><span class="line">                    &quot;EndpointID&quot;: &quot;3580dd1064b07f434c61e316f14cb7d7b53a3d6d7c9c0f77eb6570f1781623bc&quot;,</span><br><span class="line">                    &quot;Gateway&quot;: &quot;172.17.0.1&quot;,</span><br><span class="line">                    &quot;IPAddress&quot;: &quot;172.17.0.3&quot;,</span><br><span class="line">                    &quot;IPPrefixLen&quot;: 16,</span><br><span class="line">                    &quot;IPv6Gateway&quot;: &quot;&quot;,</span><br><span class="line">                    &quot;GlobalIPv6Address&quot;: &quot;&quot;,</span><br><span class="line">                    &quot;GlobalIPv6PrefixLen&quot;: 0,</span><br><span class="line">                    &quot;MacAddress&quot;: &quot;02:42:ac:11:00:03&quot;,</span><br><span class="line">                    &quot;DriverOpts&quot;: null</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure></div>

<p><strong>è¿›å…¥å½“å‰æ­£åœ¨è¿è¡Œçš„å®¹å™¨</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æˆ‘ä»¬é€šå¸¸å®¹å™¨éƒ½æ˜¯ä½¿ç”¨åå°æ–¹å¼è¿è¡Œçš„ï¼Œéœ€è¦è¿›å…¥å®¹å™¨ï¼Œä¿®æ”¹ä¸€äº›é…ç½®</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å‘½ä»¤</span></span><br><span class="line">docker exec -it å®¹å™¨id bashShell</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æµ‹è¯•</span></span><br><span class="line">[root@localhost /]# docker exec -it ce989f90023d /bin/bash</span><br><span class="line">[root@ce989f90023d /]# ls</span><br><span class="line">bin  dev  etc  home  lib  lib64  lost+found  media  mnt  opt  proc  root  run  sbin  srv  sys  tmp  usr  var</span><br><span class="line">[root@ce989f90023d /]# ps -ef</span><br><span class="line">UID         PID   PPID  C STIME TTY          TIME CMD</span><br><span class="line">root          1      0  0 14:44 pts/0    00:00:00 /bin/bash</span><br><span class="line">root         15      0  0 15:19 pts/1    00:00:00 /bin/bash</span><br><span class="line">root         29     15  0 15:20 pts/1    00:00:00 ps -ef</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ–¹å¼äºŒ</span></span><br><span class="line">docker attach å®¹å™¨id</span><br><span class="line"><span class="meta">#</span><span class="bash"> æµ‹è¯•</span></span><br><span class="line">[root@localhost /]# docker attach ce989f90023d</span><br><span class="line">æ­£åœ¨æ‰§è¡Œå½“å‰çš„ä»£ç ...</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> docker <span class="built_in">exec</span>		<span class="comment"># è¿›å…¥å®¹å™¨åå¼€å¯ä¸€ä¸ªæ–°çš„ç»ˆç«¯ï¼Œå¯ä»¥åœ¨é‡Œé¢æ“ä½œï¼ˆå¸¸ç”¨ï¼‰</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> docker attach 	<span class="comment"># è¿›å…¥å®¹å™¨æ­£åœ¨æ‰§è¡Œçš„ç»ˆç«¯ï¼Œä¸ä¼šå¯åŠ¨æ–°çš„è¿›ç¨‹</span></span></span><br></pre></td></tr></table></figure></div>

<p><strong>ä»å®¹å™¨å†…æ‹·è´æ–‡ä»¶åˆ°ä¸»æœºä¸Š</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">docker cp å®¹å™¨id:å®¹å™¨å†…ç›®æ ‡æ–‡ä»¶è·¯å¾„  ç›®çš„ä¸»æœºè·¯å¾„</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹å½“å‰ä¸»æœºç›®å½•</span></span><br><span class="line">[root@localhost home]# ls</span><br><span class="line">ztx</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> è¿›å…¥dockerå®¹å™¨å†…éƒ¨</span></span><br><span class="line">[root@localhost home]# docker attach ce989f90023d</span><br><span class="line">[root@ce989f90023d /]# cd /home/</span><br><span class="line">[root@ce989f90023d home]# ls</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> åœ¨å®¹å™¨å†…æ–°å»ºä¸€ä¸ªæ–‡ä»¶</span></span><br><span class="line">[root@ce989f90023d home]# touch test.java</span><br><span class="line">[root@ce989f90023d home]# exit</span><br><span class="line">exit</span><br><span class="line">[root@localhost home]# docker ps -a</span><br><span class="line">CONTAINER ID     IMAGE      COMMAND       CREATED           STATUS                PORTS           NAMES</span><br><span class="line">ce989f90023d     centos  &quot;/bin/bash&quot;  44 minutes ago  Exited (0) 46 seconds ago               nifty_johnson</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å°†dockerå†…æ–‡ä»¶æ‹·è´åˆ°ä¸»æœºä¸Š</span></span><br><span class="line">[root@localhost home]# docker cp ce989f90023d:/home/test.java /home</span><br><span class="line">[root@localhost home]# ls</span><br><span class="line">test.java  ztx</span><br><span class="line">[root@localhost home]# </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ‹·è´æ˜¯ä¸€ä¸ªæ‰‹åŠ¨è¿‡ç¨‹ï¼Œæœªæ¥æˆ‘ä»¬ä½¿ç”¨ -v å·çš„æŠ€æœ¯ï¼Œå¯ä»¥å®ç°è‡ªåŠ¨åŒæ­¥</span> </span><br></pre></td></tr></table></figure></div>

<h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p><img src="/2022/06/09/uncatalog/cl46zbgi6000y7or7g7cnd6w6/image-20200611085918923.png" alt="image-20200611085918923"></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">attach      Attach to a running container 	      # å½“å‰shellä¸‹attachè¿æ¥æŒ‡å®šè¿è¡Œçš„é•œåƒ</span><br><span class="line">build       Build an image from a Dockerfile        # é€šè¿‡Dockerfileå®šåˆ¶é•œåƒ</span><br><span class="line">commit      Create a new image from a container changes  #æäº¤å½“å‰å®¹å™¨ä¸ºæ–°çš„é•œåƒ</span><br><span class="line">cp          Copy files/folders between a container and the local filesystem #ä»å®¹å™¨ä¸­æ‹·è´æŒ‡å®šæ–‡ä»¶æˆ–ç›®å½•åˆ°å®¿ä¸»æœºä¸­</span><br><span class="line">create      Create a new container 				  # åˆ›å»ºä¸€ä¸ªæ–°çš„å®¹å™¨ï¼ŒåŒrun,ä½†ä¸å¯åŠ¨å®¹å™¨</span><br><span class="line">diff        Inspect changes to files or directories on a container&#x27;s filesystem #æŸ¥çœ‹dockerå®¹å™¨çš„å˜åŒ–</span><br><span class="line">events      Get real time events from the server 	  # ä»dockeræœåŠ¡è·å–å®¹å™¨å®æ—¶äº‹ä»¶</span><br><span class="line">exec        Run a command in a running container    # åœ¨å·²å­˜åœ¨çš„å®¹å™¨ä¸Šè¿è¡Œå‘½ä»¤</span><br><span class="line">export      Export a container filesystem as a tar archive # å¯¼å‡ºå®¹å™¨çš„å†…å®¹æµä½œä¸ºä¸€ä¸ªtarå½’æ¡£æ–‡ä»¶[å¯¹åº”import]</span><br><span class="line">history     Show the history of an image            # å±•ç¤ºä¸€ä¸ªé•œåƒå½¢æˆå†å²</span><br><span class="line">images      List images                             # åˆ—å‡ºç³»ç»Ÿå½“å‰çš„é•œåƒ</span><br><span class="line">import      Import the contents from a tarball to create a filesystem image # ä»taråŒ…ä¸­çš„å†…å®¹åˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶ç³»ç»Ÿé•œåƒ[å¯¹åº”export]</span><br><span class="line">info        Display system-wide information         # æ˜¾ç¤ºç³»ç»Ÿç›¸å…³ä¿¡æ¯</span><br><span class="line">inspect     Return low-level information on Docker objects # æŸ¥çœ‹å®¹å™¨è¯¦ç»†ä¿¡æ¯</span><br><span class="line">kill        Kill one or more running containers     # æ€æ­»æŒ‡å®šçš„dockerå®¹å™¨</span><br><span class="line">load        Load an image from a tar archive or STDIN # ä»ä¸€ä¸ªtaråŒ…åŠ è½½ä¸€ä¸ªé•œåƒ[å¯¹åº”save]</span><br><span class="line">login       Log in to a Docker registry			  # æ³¨å†Œæˆ–è€…ç™»å½•ä¸€ä¸ªdockeræºæœåŠ¡å™¨</span><br><span class="line">logout      Log out from a Docker registry		  # ä»å½“å‰Docker registryé€€å‡º</span><br><span class="line">logs        Fetch the logs of a container			  # è¾“å‡ºå½“å‰å®¹å™¨æ—¥å¿—ä¿¡æ¯</span><br><span class="line">pause       Pause all processes within one or more containers 	     # æš‚åœå®¹å™¨</span><br><span class="line">port        List port mappings or a specific mapping for the container # æŸ¥çœ‹æ˜ å°„ç«¯å£å¯¹åº”å®¹å™¨å†…éƒ¨æºç«¯å£</span><br><span class="line">ps          List containers						  # åˆ—å‡ºå®¹å™¨åˆ—è¡¨</span><br><span class="line">pull        Pull an image or a repository from a registry # ä»dockeré•œåƒæºæœåŠ¡å™¨æ‹‰å–æŒ‡å®šé•œåƒæˆ–åº“é•œåƒ</span><br><span class="line">push        Push an image or a repository to a registry   # æ¨é€æŒ‡å®šé•œåƒæˆ–è€…åº“é•œåƒè‡³dockeræºæœåŠ¡å™¨</span><br><span class="line">rename      Rename a container					  # ç»™dockerå®¹å™¨é‡æ–°å‘½å</span><br><span class="line">restart     Restart one or more containers		  # é‡å¯è¿è¡Œçš„å®¹å™¨</span><br><span class="line">rm          Remove one or more containers			  # ç§»é™¤ä¸€ä¸ªæˆ–è€…å¤šä¸ªå®¹å™¨</span><br><span class="line">rmi         Remove one or more images				  # ç§»é™¤ä¸€ä¸ªæˆ–è€…å¤šä¸ªé•œåƒ[æ— å®¹å™¨ä½¿ç”¨è¯¥é•œåƒæ—¶æ‰å¯åˆ é™¤ï¼Œå¦åˆ™éœ€åˆ é™¤ç›¸å…³å®¹å™¨æ‰å¯ç»§ç»­æˆ– -f å¼ºåˆ¶åˆ é™¤]</span><br><span class="line">run         Run a command in a new container		  # åˆ›å»ºä¸€ä¸ªæ–°çš„å®¹å™¨å¹¶è¿è¡Œä¸€ä¸ªå‘½ä»¤</span><br><span class="line">save        Save one or more images to a tar archive (streamed to STDOUT by default) # ä¿å­˜ä¸€ä¸ªé•œåƒä¸ºä¸€ä¸ªtaråŒ…[å¯¹åº”load]</span><br><span class="line">search      Search the Docker Hub for images		  # åœ¨docker hubä¸­æœç´¢é•œåƒ</span><br><span class="line">start       Start one or more stopped containers	  # å¯åŠ¨å®¹å™¨</span><br><span class="line">stats       Display a live stream of container(s) resource usage statistics # å®æ—¶æ˜¾ç¤ºå®¹å™¨èµ„æºä½¿ç”¨ç»Ÿè®¡</span><br><span class="line">stop        Stop one or more running containers	  # åœæ­¢å®¹å™¨</span><br><span class="line">tag         Create a tag TARGET_IMAGE that refers to SOURCE_IMAGE # ç»™æºä¸­é•œåƒæ‰“æ ‡ç­¾</span><br><span class="line">top         Display the running processes of a container   	  # æŸ¥çœ‹å®¹å™¨ä¸­è¿è¡Œçš„è¿›ç¨‹ä¿¡æ¯</span><br><span class="line">unpause     Unpause all processes within one or more containers # å–æ¶ˆæš‚åœå®¹å™¨</span><br><span class="line">update      Update configuration of one or more containers	  # æ›´æ–°ä¸€ä¸ªæˆ–å¤šä¸ªå®¹å™¨é…ç½®</span><br><span class="line">version     Show the Docker version information	  # æŸ¥çœ‹dockerç‰ˆæœ¬å· </span><br><span class="line">wait        Block until one or more containers stop, then print their exit codes # æˆªå–å®¹å™¨åœæ­¢æ—¶çš„é€€å‡ºçŠ¶æ€å€¼</span><br></pre></td></tr></table></figure></div>

<h2 id="ä½œä¸šç»ƒä¹ "><a href="#ä½œä¸šç»ƒä¹ " class="headerlink" title="ä½œä¸šç»ƒä¹ "></a>ä½œä¸šç»ƒä¹ </h2><blockquote>
<p>ä½œä¸š1ï¼šDocker å®‰è£…Nginx</p>
</blockquote>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1.æœç´¢é•œåƒ search å»ºè®®å»dockeræœç´¢ï¼Œå¯ä»¥çœ‹åˆ°å¸®åŠ©æ–‡æ¡£</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2.ä¸‹è½½é•œåƒ pull</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3.è¿è¡Œæµ‹è¯•</span></span><br><span class="line">[root@localhost /]# docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">nginx               latest              2622e6cca7eb        23 hours ago        132MB</span><br><span class="line">centos              latest              470671670cac        4 months ago        237MB</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> -d åå°è¿è¡Œ</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> --name ç»™å®¹å™¨å‘½å</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> -p å®¿ä¸»æœºç«¯å£ï¼šå®¹å™¨å†…éƒ¨ç«¯å£   ã€ç«¯å£æ˜ å°„æ“ä½œã€‘</span></span><br><span class="line">[root@localhost /]# docker run -d --name nginx01 -p 3344:80 nginx</span><br><span class="line">d60570d1e45024e3687e3bf3105a6959af8ee68d34f0c62a7deee1c16ec6579f</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                  NAMES</span><br><span class="line">d60570d1e450        nginx               &quot;/docker-entrypoint.â€¦&quot;   2 minutes ago       Up 2 minutes        0.0.0.0:3344-&gt;80/tcp   nginx01</span><br><span class="line"><span class="meta">#</span><span class="bash"> æœ¬åœ°æµ‹è¯•è®¿é—®nginx</span></span><br><span class="line">[root@localhost /]# curl localhost:3344</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> è¿›å…¥å®¹å™¨</span></span><br><span class="line">[root@localhost /]# docker exec -it nginx01 /bin/bash</span><br><span class="line">root@d60570d1e450:/# whereis nginx</span><br><span class="line">nginx: /usr/sbin/nginx /usr/lib/nginx /etc/nginx /usr/share/nginx</span><br><span class="line">root@d60570d1e450:/# cd /etc/nginx/</span><br><span class="line">root@d60570d1e450:/etc/nginx# ls</span><br><span class="line">conf.d	fastcgi_params	koi-utf  koi-win  mime.types  modules  nginx.conf  scgi_params	uwsgi_params  win-utf</span><br></pre></td></tr></table></figure></div>

<p><strong>ç«¯å£æš´éœ²çš„æ¦‚å¿µ</strong></p>
<p><img src="/2022/06/09/uncatalog/cl46zbgi6000y7or7g7cnd6w6/image-20200611085948617.png" alt="image-20200611085948617"></p>
<p><strong>æ€è€ƒé—®é¢˜ï¼š</strong>æˆ‘ä»¬æ¯æ¬¡æ”¹åŠ¨nginxé…ç½®æ–‡ä»¶ï¼Œéƒ½éœ€è¦è¿›å…¥å®¹å™¨å†…éƒ¨ï¼Ÿååˆ†éº»çƒ¦ï¼Œæˆ‘è¦æ˜¯å¯ä»¥åœ¨å®¹å™¨å¤–éƒ¨æä¾›ä¸€ä¸ªæ˜ å°„è·¯å¾„ï¼Œè¾¾åˆ°åœ¨å®¹å™¨å¤–éƒ¨ä¿®æ”¹æ–‡ä»¶åï¼Œå®¹å™¨å†…éƒ¨å°±å¯ä»¥è‡ªåŠ¨ä¿®æ”¹ï¼Ÿ-v æ•°æ®å· æŠ€æœ¯ï¼</p>
<blockquote>
<p>ä½œä¸š2ï¼šDockeræ¥è£…ä¸€ä¸ªtomcat</p>
</blockquote>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å®˜æ–¹æ–‡æ¡£</span></span><br><span class="line">docker run -it --rm tomcat:9.0</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æˆ‘ä»¬ä¹‹å‰çš„å¯åŠ¨éƒ½æ˜¯åå°ï¼Œåœæ­¢äº†å®¹å™¨ä¹‹åï¼Œå®¹å™¨è¿˜æ˜¯å¯ä»¥æŸ¥åˆ° docker run -it --rm,ä¸€èˆ¬ç”¨æ¥æµ‹è¯•ï¼Œç”¨å®Œå°±åˆ é™¤</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¸‹è½½å†å¯åŠ¨</span></span><br><span class="line">docker pull tomcat</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¯åŠ¨è¿è¡Œ</span></span><br><span class="line">docker run -d -p 3355:8080 --name tomcat01 tomcat</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">æµ‹è¯•è®¿é—®æ²¡æœ‰é—®é¢˜</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> è¿›å…¥å®¹å™¨</span></span><br><span class="line">[root@localhost /]# docker exec -it tomcat01 /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å‘ç°é—®é¢˜ï¼š1ã€linuxå‘½ä»¤å°‘äº† 2ã€webappså†…æ²¡æœ‰å†…å®¹ï¼ˆè¿™æ˜¯é˜¿é‡Œäº‘é•œåƒçš„åŸå› ï¼šé»˜è®¤æ˜¯æœ€å°é•œåƒï¼Œæ‰€æœ‰ä¸å¿…è¦çš„éƒ½åˆ é™¤ï¼‰</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¿è¯æœ€å°å¯è¿è¡Œç¯å¢ƒ</span></span><br><span class="line"><span class="meta">#</span><span class="bash">è§£å†³æ–¹æ³•ï¼šå°†webapps.distç›®å½•ä¸‹å†…å®¹æ‹·è‡³webappsä¸‹</span></span><br><span class="line">root@c435d5b974a7:/usr/local/tomcat# cd webapps</span><br><span class="line">root@c435d5b974a7:/usr/local/tomcat/webapps# ls</span><br><span class="line">root@c435d5b974a7:/usr/local/tomcat/webapps# cd ..</span><br><span class="line">root@c435d5b974a7:/usr/local/tomcat# ls</span><br><span class="line">BUILDING.txt  CONTRIBUTING.md  LICENSE	NOTICE	README.md  RELEASE-NOTES  RUNNING.txt  bin  conf  lib  logs  native-jni-lib  temp  webapps  webapps.dist  work</span><br><span class="line">root@c435d5b974a7:/usr/local/tomcat# cd webapps.dist/</span><br><span class="line">root@c435d5b974a7:/usr/local/tomcat/webapps.dist# ls</span><br><span class="line">ROOT  docs  examples  host-manager  manager</span><br><span class="line">root@c435d5b974a7:/usr/local/tomcat/webapps.dist# cd ..</span><br><span class="line">root@c435d5b974a7:/usr/local/tomcat# cp -r webapps.dist/* webapps </span><br><span class="line">root@c435d5b974a7:/usr/local/tomcat# cd webapps</span><br><span class="line">root@c435d5b974a7:/usr/local/tomcat/webapps# ls</span><br><span class="line">ROOT  docs  examples  host-manager  manager</span><br></pre></td></tr></table></figure></div>

<p>æ‹·è´å®Œæˆå°±å¯ä»¥è®¿é—®äº†ï¼š</p>
<p><img src="/2022/06/09/uncatalog/cl46zbgi6000y7or7g7cnd6w6/image-20200611090019494.png" alt="image-20200611090019494"></p>
<p><strong>æ€è€ƒé—®é¢˜ï¼š</strong>æˆ‘ä»¬ä»¥åè¦éƒ¨ç½²é¡¹ç›®ï¼Œå¦‚æœæ¯æ¬¡éƒ½è¦è¿›å…¥å®¹å™¨æ˜¯ä¸æ˜¯ååˆ†éº»çƒ¦ï¼Ÿæˆ‘è¦æ˜¯å¯ä»¥åœ¨å®¹å™¨å¤–éƒ¨æä¾›æ˜ å°„è·¯å¾„ï¼Œwebapps,æˆ‘ä»¬åœ¨å¤–éƒ¨æ”¾ç½®é¡¹ç›®ï¼Œå°±è‡ªåŠ¨åŒæ­¥åˆ°å†…éƒ¨å°±å¥½äº†ï¼</p>
<blockquote>
<p>ä½œä¸š3ï¼šéƒ¨ç½²es+kibana</p>
</blockquote>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> es æš´éœ²çš„ç«¯å£å¾ˆå¤šï¼</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> es ååˆ†è€—å†…å­˜</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> es çš„æ•°æ®ä¸€èˆ¬éœ€è¦æ”¾ç½®åˆ°å®‰å…¨ç›®å½•ï¼æŒ‚è½½</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> --net somenetworkï¼Ÿç½‘ç»œé…ç½®</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¯åŠ¨ elasticsearch</span></span><br><span class="line">docker run -d --name elasticsearch -p 9200:9200 -p 9300:9300 -e &quot;discovery.type=single-node&quot; elasticsearch:7.6.2</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¯åŠ¨äº† Linuxå°±å¯å¡ä½äº†   docker stats æŸ¥çœ‹cpuçš„çŠ¶æ€</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> es æ˜¯ååˆ†è€—å†…å­˜çš„</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æµ‹è¯•ä¸€ä¸‹esæ˜¯å¦æˆåŠŸäº†</span></span><br><span class="line">[root@localhost /]# curl localhost:9200</span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot; : &quot;83b0d5dca26e&quot;,</span><br><span class="line">  &quot;cluster_name&quot; : &quot;docker-cluster&quot;,</span><br><span class="line">  &quot;cluster_uuid&quot; : &quot;MjhNfYTvRVui1UCrAwMdqw&quot;,</span><br><span class="line">  &quot;version&quot; : &#123;</span><br><span class="line">    &quot;number&quot; : &quot;7.6.2&quot;,</span><br><span class="line">    &quot;build_flavor&quot; : &quot;default&quot;,</span><br><span class="line">    &quot;build_type&quot; : &quot;docker&quot;,</span><br><span class="line">    &quot;build_hash&quot; : &quot;ef48eb35cf30adf4db14086e8aabd07ef6fb113f&quot;,</span><br><span class="line">    &quot;build_date&quot; : &quot;2020-03-26T06:34:37.794943Z&quot;,</span><br><span class="line">    &quot;build_snapshot&quot; : false,</span><br><span class="line">    &quot;lucene_version&quot; : &quot;8.4.0&quot;,</span><br><span class="line">    &quot;minimum_wire_compatibility_version&quot; : &quot;6.8.0&quot;,</span><br><span class="line">    &quot;minimum_index_compatibility_version&quot; : &quot;6.0.0-beta1&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;tagline&quot; : &quot;You Know, for Search&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹dockerå®¹å™¨å ç”¨èµ„æºæƒ…å†µ</span></span><br></pre></td></tr></table></figure></div>

<p><img src="/2022/06/09/uncatalog/cl46zbgi6000y7or7g7cnd6w6/image-20200611124706727.png" alt="image-20200611124706727"></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> èµ¶ç´§å…³é—­å®¹å™¨ï¼Œå¢åŠ å†…å­˜é™åˆ¶ï¼Œä¿®æ”¹é…ç½®æ–‡ä»¶ -e ç¯å¢ƒé…ç½®ä¿®æ”¹</span></span><br><span class="line">docker run -d --name elasticsearch02 -p 9200:9200 -p 9300:9300 -e &quot;discovery.type=single-node&quot; -e ES_JAVA_OPTS=&quot;-Xms64m -Xmx512m&quot; elasticsearch:7.6.2</span><br><span class="line"> </span><br><span class="line"><span class="meta"> #</span><span class="bash"> æŸ¥çœ‹dockerå®¹å™¨å ç”¨èµ„æºæƒ…å†µ</span></span><br></pre></td></tr></table></figure></div>

<p><img src="/2022/06/09/uncatalog/cl46zbgi6000y7or7g7cnd6w6/image-20200611124755826.png" alt="image-20200611124755826"></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">[root@localhost /]# curl localhost:9200</span><br><span class="line">&#123;</span><br><span class="line">  &quot;name&quot; : &quot;5a262b522bbf&quot;,</span><br><span class="line">  &quot;cluster_name&quot; : &quot;docker-cluster&quot;,</span><br><span class="line">  &quot;cluster_uuid&quot; : &quot;rGMaCpVXScGaZcv_UtK3gQ&quot;,</span><br><span class="line">  &quot;version&quot; : &#123;</span><br><span class="line">    &quot;number&quot; : &quot;7.6.2&quot;,</span><br><span class="line">    &quot;build_flavor&quot; : &quot;default&quot;,</span><br><span class="line">    &quot;build_type&quot; : &quot;docker&quot;,</span><br><span class="line">    &quot;build_hash&quot; : &quot;ef48eb35cf30adf4db14086e8aabd07ef6fb113f&quot;,</span><br><span class="line">    &quot;build_date&quot; : &quot;2020-03-26T06:34:37.794943Z&quot;,</span><br><span class="line">    &quot;build_snapshot&quot; : false,</span><br><span class="line">    &quot;lucene_version&quot; : &quot;8.4.0&quot;,</span><br><span class="line">    &quot;minimum_wire_compatibility_version&quot; : &quot;6.8.0&quot;,</span><br><span class="line">    &quot;minimum_index_compatibility_version&quot; : &quot;6.0.0-beta1&quot;</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;tagline&quot; : &quot;You Know, for Search&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>



<blockquote>
<p>ä½œä¸š4ï¼šä½¿ç”¨ kibana è¿æ¥ es ? æ€è€ƒç½‘ç»œå¦‚ä½•æ‰èƒ½è¿æ¥è¿‡å»ï¼</p>
</blockquote>
<p><img src="/2022/06/09/uncatalog/cl46zbgi6000y7or7g7cnd6w6/image-20200611125352717.png" alt="image-20200611125352717"></p>
<h2 id="å¯è§†åŒ–"><a href="#å¯è§†åŒ–" class="headerlink" title="å¯è§†åŒ–"></a>å¯è§†åŒ–</h2><ul>
<li>portainerï¼ˆçº¿ç”¨è¿™ä¸ªï¼‰</li>
</ul>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">docker run -d -p 8088:9000 \</span><br><span class="line">--restart=always -v /var/run/docker.sock:/var/run/docker.sock --privileged=true portainer/portainer</span><br></pre></td></tr></table></figure></div>

<ul>
<li>Rancher ï¼ˆCI/CDå†ç”¨ï¼‰</li>
</ul>
<h2 id="ä»€ä¹ˆæ˜¯portainer"><a href="#ä»€ä¹ˆæ˜¯portainer" class="headerlink" title="ä»€ä¹ˆæ˜¯portainer ?"></a>ä»€ä¹ˆæ˜¯portainer ?</h2><p>Dockerå›¾å½¢åŒ–ç•Œé¢ç®¡ç†å·¥å…·ï¼æä¾›ä¸€ä¸ªåå°é¢æ¿ä¾›æˆ‘ä»¬æ“ä½œï¼</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">docker run -d -p 8088:9000 \</span><br><span class="line">--restart=always -v /var/run/docker.sock:/var/run/docker.sock --privileged=true portainer/portainer</span><br></pre></td></tr></table></figure></div>

<p>å¤–éƒ¨è®¿é—®æµ‹è¯•ï¼š<a href="http://ip:8088/">http://ip:8088/</a></p>
<p>é€šè¿‡å®ƒæ¥è®¿é—®äº†;</p>
<p><img src="/2022/06/09/uncatalog/cl46zbgi6000y7or7g7cnd6w6/image-20200611141621853.png" alt="image-20200611141621853"></p>
<p>é€‰æ‹©æœ¬åœ°çš„ï¼š</p>
<p><img src="/2022/06/09/uncatalog/cl46zbgi6000y7or7g7cnd6w6/image-20200611142004773.png" alt="image-20200611142004773"></p>
<p>è¿›å…¥ä¹‹åçš„é¢æ¿ï¼š</p>
<p><img src="/2022/06/09/uncatalog/cl46zbgi6000y7or7g7cnd6w6/image-20200611144838665.png" alt="image-20200611144838665"></p>
<p><img src="/2022/06/09/uncatalog/cl46zbgi6000y7or7g7cnd6w6/image-20200611144900114.png" alt="image-20200611144900114"></p>
<p>å¯è§†åŒ–é¢æ¿æˆ‘ä»¬å¹³æ—¶ä¸ä¼šä½¿ç”¨ï¼Œå¤§å®¶è‡ªå·±æµ‹è¯•ç©ç©å³å¯ï¼</p>
<h1 id="Dockeré•œåƒè®²è§£"><a href="#Dockeré•œåƒè®²è§£" class="headerlink" title="Dockeré•œåƒè®²è§£"></a>Dockeré•œåƒè®²è§£</h1><h2 id="é•œåƒæ˜¯ä»€ä¹ˆ"><a href="#é•œåƒæ˜¯ä»€ä¹ˆ" class="headerlink" title="é•œåƒæ˜¯ä»€ä¹ˆ"></a>é•œåƒæ˜¯ä»€ä¹ˆ</h2><p>é•œåƒæ˜¯ä¸€ç§è½»é‡çº§ã€å¯æ‰§è¡Œçš„ç‹¬ç«‹è½¯ä»¶ä¿ï¼Œç”¨æ¥æ‰“åŒ…è½¯ä»¶è¿è¡Œç¯å¢ƒå’ŒåŸºäºè¿è¡Œç¯å¢ƒå¼€å‘çš„è½¯ä»¶ï¼Œä»–åŒ…å«è¿è¡ŒæŸä¸ªè½¯ä»¶æ‰€éœ€çš„æ‰€æœ‰å†…å®¹ï¼ŒåŒ…æ‹¬ä»£ç ã€è¿è¡Œæ—¶åº“ã€ç¯å¢ƒå˜é‡å’Œé…ç½®æ–‡ä»¶ã€‚</p>
<p>æ‰€æœ‰åº”ç”¨ï¼Œç›´æ¥æ‰“åŒ…dockeré•œåƒï¼Œå°±å¯ä»¥ç›´æ¥è·‘èµ·æ¥ï¼</p>
<p><strong>å¦‚ä½•å¾—åˆ°é•œåƒ</strong></p>
<ul>
<li>ä»è¿œç¨‹ä»“åº“ä¸‹è½½</li>
<li>åˆ«äººæ‹·è´ç»™ä½ </li>
<li>è‡ªå·±åˆ¶ä½œä¸€ä¸ªé•œåƒ DockerFile</li>
</ul>
<h2 id="Dockeré•œåƒåŠ è½½åŸç†"><a href="#Dockeré•œåƒåŠ è½½åŸç†" class="headerlink" title="Dockeré•œåƒåŠ è½½åŸç†"></a>Dockeré•œåƒåŠ è½½åŸç†</h2><blockquote>
<p>UnionFs ï¼ˆè”åˆæ–‡ä»¶ç³»ç»Ÿï¼‰</p>
</blockquote>
<p>UnionFsï¼ˆè”åˆæ–‡ä»¶ç³»ç»Ÿï¼‰ï¼šUnionæ–‡ä»¶ç³»ç»Ÿï¼ˆUnionFsï¼‰æ˜¯ä¸€ç§åˆ†å±‚ã€è½»é‡çº§å¹¶ä¸”é«˜æ€§èƒ½çš„æ–‡ä»¶ç³»ç»Ÿï¼Œä»–æ”¯æŒå¯¹æ–‡ä»¶ç³»ç»Ÿçš„ä¿®æ”¹ä½œä¸ºä¸€æ¬¡æäº¤æ¥ä¸€å±‚å±‚çš„å åŠ ï¼ŒåŒæ—¶å¯ä»¥å°†ä¸åŒç›®å½•æŒ‚è½½åˆ°åŒä¸€ä¸ªè™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿä¸‹ï¼ˆ unite several directories into a single virtual filesystem)ã€‚Unionæ–‡ä»¶ç³»ç»Ÿæ˜¯ Dockeré•œåƒçš„åŸºç¡€ã€‚é•œåƒå¯ä»¥é€šè¿‡åˆ†å±‚æ¥è¿›è¡Œç»§æ‰¿ï¼ŒåŸºäºåŸºç¡€é•œåƒï¼ˆæ²¡æœ‰çˆ¶é•œåƒï¼‰ï¼Œå¯ä»¥åˆ¶ä½œå„ç§å…·ä½“çš„åº”ç”¨é•œåƒ</p>
<p>ç‰¹æ€§ï¼šä¸€æ¬¡åŒæ—¶åŠ è½½å¤šä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œä½†ä»å¤–é¢çœ‹èµ·æ¥ï¼Œåªèƒ½çœ‹åˆ°ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿï¼Œè”åˆåŠ è½½ä¼šæŠŠå„å±‚æ–‡ä»¶ç³»ç»Ÿå åŠ èµ·æ¥ï¼Œè¿™æ ·æœ€ç»ˆçš„æ–‡ä»¶ç³»ç»Ÿä¼šåŒ…å«æ‰€æœ‰åº•å±‚çš„æ–‡ä»¶å’Œç›®å½•ã€‚</p>
<blockquote>
<p>Dockeré•œåƒåŠ è½½åŸç†</p>
</blockquote>
<p>dockerçš„é•œåƒå®é™…ä¸Šç”±ä¸€å±‚ä¸€å±‚çš„æ–‡ä»¶ç³»ç»Ÿç»„æˆï¼Œè¿™ç§å±‚çº§çš„æ–‡ä»¶ç³»ç»ŸUnionFSã€‚</p>
<p>boots(boot file systemï¼‰ä¸»è¦åŒ…å« bootloaderå’Œ Kernel, bootloaderä¸»è¦æ˜¯å¼•å¯¼åŠ è½½ kernel, Linuxåˆšå¯åŠ¨æ—¶ä¼šåŠ è½½bootfsæ–‡ä»¶ç³»ç»Ÿï¼Œåœ¨ Dockeré•œåƒçš„æœ€åº•å±‚æ˜¯ bootsã€‚è¿™ä¸€å±‚ä¸æˆ‘ä»¬å…¸å‹çš„Linux/Unixç³»ç»Ÿæ˜¯ä¸€æ ·çš„ï¼ŒåŒ…æ‹¬bootloaderå’Œ Kernelã€‚å½“bootåŠ è½½å®Œæˆä¹‹åæ•´ä¸ªå†…æ ¸å°±éƒ½åœ¨å†…å­˜ä¸­äº†ï¼Œæ­¤æ—¶å†…å­˜çš„ä½¿ç”¨æƒå·²ç”± bootfsè½¬äº¤ç»™å†…æ ¸ï¼Œæ­¤æ—¶ç³»ç»Ÿä¹Ÿä¼šå¸è½½bootfsã€‚</p>
<p>rootfsï¼ˆroot file system),åœ¨ bootfsä¹‹ä¸Šã€‚åŒ…å«çš„å°±æ˜¯å…¸å‹ Linuxç³»ç»Ÿä¸­çš„/dev,/proc,/bin,/etcç­‰æ ‡å‡†ç›®å½•å’Œæ–‡ä»¶ã€‚ rootfså°±æ˜¯å„ç§ä¸åŒçš„æ“ä½œç³»ç»Ÿå‘è¡Œç‰ˆï¼Œæ¯”å¦‚ Ubuntu, Centosç­‰ç­‰ã€‚<br><img src="/2022/06/09/uncatalog/cl46zbgi6000y7or7g7cnd6w6/image-20200611162007055.png" alt="image-20200611162007055"></p>
<p>å¹³æ—¶æˆ‘ä»¬å®‰è£…è¿›è™šæ‹Ÿæœºçš„CentOSéƒ½æ˜¯å¥½å‡ ä¸ªGï¼Œä¸ºä»€ä¹ˆDockerè¿™é‡Œæ‰200Mï¼Ÿ</p>
<p><img src="/2022/06/09/uncatalog/cl46zbgi6000y7or7g7cnd6w6/image-20200611162057734.png" alt="image-20200611162057734"></p>
<p>å¯¹äºä¸ªç²¾ç®€çš„OS, rootfså¯ä»¥å¾ˆå°ï¼Œåªéœ€è¦åŒ…åˆæœ€åŸºæœ¬çš„å‘½ä»¤ã€å·¥å…·å’Œç¨‹åºåº“å°±å¯ä»¥äº†ï¼Œå› ä¸ºåº•å±‚ç›´æ¥ç”¨Hostçš„kernelï¼Œè‡ªå·±åªéœ€è¦æä¾›rootfså°±å¯ä»¥äº†ã€‚ç”±æ­¤å¯è§å¯¹äºä¸åŒçš„Linuxå‘è¡Œç‰ˆï¼Œ bootsåŸºæœ¬æ˜¯ä¸€è‡´çš„ï¼Œ rootfsä¼šæœ‰å·®åˆ¥ï¼Œå› æ­¤ä¸åŒçš„å‘è¡Œç‰ˆå¯ä»¥å…¬ç”¨bootfs.</p>
<p>è™šæ‹Ÿæœºæ˜¯åˆ†é’Ÿçº§åˆ«ï¼Œå®¹å™¨æ˜¯ç§’çº§ï¼</p>
<h2 id="åˆ†å±‚ç†è§£"><a href="#åˆ†å±‚ç†è§£" class="headerlink" title="åˆ†å±‚ç†è§£"></a>åˆ†å±‚ç†è§£</h2><blockquote>
<p>åˆ†å±‚çš„é•œåƒ</p>
</blockquote>
<p>æˆ‘ä»¬å¯ä»¥å»ä¸‹è½½ä¸€ä¸ªé•œåƒï¼Œæ³¨æ„è§‚å¯Ÿä¸‹è½½çš„æ—¥å¿—è¾“å‡ºï¼Œå¯ä»¥çœ‹åˆ°æ˜¯ä¸€å±‚å±‚çš„åœ¨ä¸‹è½½ï¼<img src="/2022/06/09/uncatalog/cl46zbgi6000y7or7g7cnd6w6/image-20200611163839741.png" alt="image-20200611163839741"></p>
<p><strong>æ€è€ƒï¼šä¸ºä»€ä¹ˆDockeré•œåƒè¦é‡‡ç”¨è¿™ç§åˆ†å±‚çš„ç»“æ„å‘¢ï¼Ÿ</strong></p>
<p>æœ€å¤§çš„å¥½å¤„ï¼Œæˆ‘è§‰å¾—è«è¿‡äºèµ„æºå…±äº«äº†ï¼æ¯”å¦‚æœ‰å¤šä¸ªé•œåƒéƒ½ä»ç›¸åŒçš„Baseé•œåƒæ„å»ºè€Œæ¥ï¼Œé‚£ä¹ˆå®¿ä¸»æœºåªéœ€åœ¨ç£ç›˜ä¸Šä¿ç•™ä¸€ä»½baseé•œåƒï¼ŒåŒæ—¶å†…å­˜ä¸­ä¹Ÿåªéœ€è¦åŠ è½½ä¸€ä»½baseé•œåƒï¼Œè¿™æ ·å°±å¯ä»¥ä¸ºæ‰€æœ‰çš„å®¹å™¨æœåŠ¡äº†ï¼Œè€Œä¸”é•œåƒçš„æ¯ä¸€å±‚éƒ½å¯ä»¥è¢«å…±äº«ã€‚</p>
<p>æŸ¥çœ‹é•œåƒåˆ†å±‚çš„æ–¹å¼å¯ä»¥é€šè¿‡docker image inspect å‘½ä»¤</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">âœ  / docker image inspect redis          </span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Id&quot;: &quot;sha256:f9b9909726890b00d2098081642edf32e5211b7ab53563929a47f250bcdc1d7c&quot;,</span><br><span class="line">        &quot;RepoTags&quot;: [</span><br><span class="line">            &quot;redis:latest&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;RepoDigests&quot;: [</span><br><span class="line">            &quot;redis@sha256:399a9b17b8522e24fbe2fd3b42474d4bb668d3994153c4b5d38c3dafd5903e32&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;Parent&quot;: &quot;&quot;,</span><br><span class="line">        &quot;Comment&quot;: &quot;&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2020-05-02T01:40:19.112130797Z&quot;,</span><br><span class="line">        &quot;Container&quot;: &quot;d30c0bcea88561bc5139821227d2199bb027eeba9083f90c701891b4affce3bc&quot;,</span><br><span class="line">        &quot;ContainerConfig&quot;: &#123;</span><br><span class="line">            &quot;Hostname&quot;: &quot;d30c0bcea885&quot;,</span><br><span class="line">            &quot;Domainname&quot;: &quot;&quot;,</span><br><span class="line">            &quot;User&quot;: &quot;&quot;,</span><br><span class="line">            &quot;AttachStdin&quot;: false,</span><br><span class="line">            &quot;AttachStdout&quot;: false,</span><br><span class="line">            &quot;AttachStderr&quot;: false,</span><br><span class="line">            &quot;ExposedPorts&quot;: &#123;</span><br><span class="line">                &quot;6379/tcp&quot;: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;Tty&quot;: false,</span><br><span class="line">            &quot;OpenStdin&quot;: false,</span><br><span class="line">            &quot;StdinOnce&quot;: false,</span><br><span class="line">            &quot;Env&quot;: [</span><br><span class="line">                &quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;,</span><br><span class="line">                &quot;GOSU_VERSION=1.12&quot;,</span><br><span class="line">                &quot;REDIS_VERSION=6.0.1&quot;,</span><br><span class="line">                &quot;REDIS_DOWNLOAD_URL=http://download.redis.io/releases/redis-6.0.1.tar.gz&quot;,</span><br><span class="line">                &quot;REDIS_DOWNLOAD_SHA=b8756e430479edc162ba9c44dc89ac394316cd482f2dc6b91bcd5fe12593f273&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Cmd&quot;: [</span><br><span class="line">                &quot;/bin/sh&quot;,</span><br><span class="line">                &quot;-c&quot;,</span><br><span class="line">                &quot;#(nop) &quot;,</span><br><span class="line">                &quot;CMD [\&quot;redis-server\&quot;]&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;ArgsEscaped&quot;: true,</span><br><span class="line">            &quot;Image&quot;: &quot;sha256:704c602fa36f41a6d2d08e49bd2319ccd6915418f545c838416318b3c29811e0&quot;,</span><br><span class="line">            &quot;Volumes&quot;: &#123;</span><br><span class="line">                &quot;/data&quot;: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;WorkingDir&quot;: &quot;/data&quot;,</span><br><span class="line">            &quot;Entrypoint&quot;: [</span><br><span class="line">                &quot;docker-entrypoint.sh&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;OnBuild&quot;: null,</span><br><span class="line">            &quot;Labels&quot;: &#123;&#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;DockerVersion&quot;: &quot;18.09.7&quot;,</span><br><span class="line">        &quot;Author&quot;: &quot;&quot;,</span><br><span class="line">        &quot;Config&quot;: &#123;</span><br><span class="line">            &quot;Hostname&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Domainname&quot;: &quot;&quot;,</span><br><span class="line">            &quot;User&quot;: &quot;&quot;,</span><br><span class="line">            &quot;AttachStdin&quot;: false,</span><br><span class="line">            &quot;AttachStdout&quot;: false,</span><br><span class="line">            &quot;AttachStderr&quot;: false,</span><br><span class="line">            &quot;ExposedPorts&quot;: &#123;</span><br><span class="line">                &quot;6379/tcp&quot;: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;Tty&quot;: false,</span><br><span class="line">            &quot;OpenStdin&quot;: false,</span><br><span class="line">            &quot;StdinOnce&quot;: false,</span><br><span class="line">            &quot;Env&quot;: [</span><br><span class="line">                &quot;PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;,</span><br><span class="line">                &quot;GOSU_VERSION=1.12&quot;,</span><br><span class="line">                &quot;REDIS_VERSION=6.0.1&quot;,</span><br><span class="line">                &quot;REDIS_DOWNLOAD_URL=http://download.redis.io/releases/redis-6.0.1.tar.gz&quot;,</span><br><span class="line">                &quot;REDIS_DOWNLOAD_SHA=b8756e430479edc162ba9c44dc89ac394316cd482f2dc6b91bcd5fe12593f273&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Cmd&quot;: [</span><br><span class="line">                &quot;redis-server&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;ArgsEscaped&quot;: true,</span><br><span class="line">            &quot;Image&quot;: &quot;sha256:704c602fa36f41a6d2d08e49bd2319ccd6915418f545c838416318b3c29811e0&quot;,</span><br><span class="line">            &quot;Volumes&quot;: &#123;</span><br><span class="line">                &quot;/data&quot;: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;WorkingDir&quot;: &quot;/data&quot;,</span><br><span class="line">            &quot;Entrypoint&quot;: [</span><br><span class="line">                &quot;docker-entrypoint.sh&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;OnBuild&quot;: null,</span><br><span class="line">            &quot;Labels&quot;: null</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Architecture&quot;: &quot;amd64&quot;,</span><br><span class="line">        &quot;Os&quot;: &quot;linux&quot;,</span><br><span class="line">        &quot;Size&quot;: 104101893,</span><br><span class="line">        &quot;VirtualSize&quot;: 104101893,</span><br><span class="line">        &quot;GraphDriver&quot;: &#123;</span><br><span class="line">            &quot;Data&quot;: &#123;</span><br><span class="line">                &quot;LowerDir&quot;: &quot;/var/lib/docker/overlay2/adea96bbe6518657dc2d4c6331a807eea70567144abda686588ef6c3bb0d778a/diff:/var/lib/docker/overlay2/66abd822d34dc6446e6bebe73721dfd1dc497c2c8063c43ffb8cf8140e2caeb6/diff:/var/lib/docker/overlay2/d19d24fb6a24801c5fa639c1d979d19f3f17196b3c6dde96d3b69cd2ad07ba8a/diff:/var/lib/docker/overlay2/a1e95aae5e09ca6df4f71b542c86c677b884f5280c1d3e3a1111b13644b221f9/diff:/var/lib/docker/overlay2/cd90f7a9cd0227c1db29ea992e889e4e6af057d9ab2835dd18a67a019c18bab4/diff&quot;,</span><br><span class="line">                &quot;MergedDir&quot;: &quot;/var/lib/docker/overlay2/afa1de233453b60686a3847854624ef191d7bc317fb01e015b4f06671139fb11/merged&quot;,</span><br><span class="line">                &quot;UpperDir&quot;: &quot;/var/lib/docker/overlay2/afa1de233453b60686a3847854624ef191d7bc317fb01e015b4f06671139fb11/diff&quot;,</span><br><span class="line">                &quot;WorkDir&quot;: &quot;/var/lib/docker/overlay2/afa1de233453b60686a3847854624ef191d7bc317fb01e015b4f06671139fb11/work&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;Name&quot;: &quot;overlay2&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;RootFS&quot;: &#123;</span><br><span class="line">            &quot;Type&quot;: &quot;layers&quot;,</span><br><span class="line">            &quot;Layers&quot;: [</span><br><span class="line">                &quot;sha256:c2adabaecedbda0af72b153c6499a0555f3a769d52370469d8f6bd6328af9b13&quot;,</span><br><span class="line">                &quot;sha256:744315296a49be711c312dfa1b3a80516116f78c437367ff0bc678da1123e990&quot;,</span><br><span class="line">                &quot;sha256:379ef5d5cb402a5538413d7285b21aa58a560882d15f1f553f7868dc4b66afa8&quot;,</span><br><span class="line">                &quot;sha256:d00fd460effb7b066760f97447c071492d471c5176d05b8af1751806a1f905f8&quot;,</span><br><span class="line">                &quot;sha256:4d0c196331523cfed7bf5bafd616ecb3855256838d850b6f3d5fba911f6c4123&quot;,</span><br><span class="line">                &quot;sha256:98b4a6242af2536383425ba2d6de033a510e049d9ca07ff501b95052da76e894&quot;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Metadata&quot;: &#123;</span><br><span class="line">            &quot;LastTagTime&quot;: &quot;0001-01-01T00:00:00Z&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure></div>

<p><strong>ç†è§£ï¼š</strong></p>
<p>æ‰€æœ‰çš„ Dockeré•œåƒéƒ½èµ·å§‹äºä¸€ä¸ªåŸºç¡€é•œåƒå±‚ï¼Œå½“è¿›è¡Œä¿®æ”¹æˆ–åŸ¹åŠ æ–°çš„å†…å®¹æ—¶ï¼Œå°±ä¼šåœ¨å½“å‰é•œåƒå±‚ä¹‹ä¸Šï¼Œåˆ›å»ºæ–°çš„é•œåƒå±‚ã€‚</p>
<p>ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œå‡å¦‚åŸºäº Ubuntu Linux16.04åˆ›å»ºä¸€ä¸ªæ–°çš„é•œåƒï¼Œè¿™å°±æ˜¯æ–°é•œåƒçš„ç¬¬ä¸€å±‚ï¼›å¦‚æœåœ¨è¯¥é•œåƒä¸­æ·»åŠ  PythonåŒ…ï¼Œå°±ä¼šåœ¨åŸºç¡€é•œåƒå±‚ä¹‹ä¸Šåˆ›å»ºç¬¬äºŒä¸ªé•œåƒå±‚ï¼›å¦‚æœç»§ç»­æ·»åŠ ä¸€ä¸ªå®‰å…¨è¡¥ä¸ï¼Œå°±ä¼šåˆ›å»ºç¬¬ä¸‰ä¸ªé•œåƒå±‚ã€‚</p>
<p>è¯¥é•œåƒå½“å‰å·²ç»åŒ…å«3ä¸ªé•œåƒå±‚ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼ˆè¿™åªæ˜¯ä¸€ä¸ªç”¨äºæ¼”ç¤ºçš„å¾ˆç®€å•çš„ä¾‹å­ï¼‰ã€‚</p>
<p><img src="/2022/06/09/uncatalog/cl46zbgi6000y7or7g7cnd6w6/image-20200611163818495.png" alt="image-20200611163818495"></p>
<p>åœ¨æ·»åŠ é¢å¤–çš„é•œåƒå±‚çš„åŒæ—¶ï¼Œé•œåƒå§‹ç»ˆä¿æŒæ˜¯å½“å‰æ‰€æœ‰é•œåƒçš„ç»„åˆï¼Œç†è§£è¿™ä¸€ç‚¹éå¸¸é‡è¦ã€‚ä¸‹å›¾ä¸­ä¸¾äº†ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œæ¯ä¸ªé•œåƒå±‚åŒ…å«3ä¸ªæ–‡ä»¶ï¼Œè€Œæ•´ä½“çš„å¤§é•œåƒåŒ…å«äº†æ¥è‡ªä¸¤ä¸ªé•œåƒå±‚çš„6ä¸ªæ–‡ä»¶ã€‚</p>
<p><img src="/2022/06/09/uncatalog/cl46zbgi6000y7or7g7cnd6w6/image-20200611164322267.png" alt="image-20200611164322267"></p>
<p>ä¸Šå›¾ä¸­çš„é•œåƒå±‚è·Ÿä¹‹å‰å›¾ä¸­çš„ç•¥æœ‰åŒºåˆ¥ï¼Œä¸»è¦ç›®çš„æ˜¯ä¾¿äºå±•ç¤ºæ–‡ä»¶ã€‚</p>
<p>ä¸‹å›¾ä¸­å±•ç¤ºäº†ä¸€ä¸ªç¨å¾®å¤æ‚çš„ä¸‰å±‚é•œåƒï¼Œåœ¨å¤–éƒ¨çœ‹æ¥æ•´ä¸ªé•œåƒåªæœ‰6ä¸ªæ–‡ä»¶ï¼Œè¿™æ˜¯å› ä¸ºæœ€ä¸Šå±‚ä¸­çš„æ–‡ä»¶7æ˜¯æ–‡ä»¶5çš„ä¸€ä¸ªæ›´æ–°ç‰ˆã€‚</p>
<p><img src="/2022/06/09/uncatalog/cl46zbgi6000y7or7g7cnd6w6/image-20200611164447964.png" alt="image-20200611164447964"></p>
<p>è¿™ç§æƒ…æ³ä¸‹ï¼Œä¸Šå±‚é•œåƒå±‚ä¸­çš„æ–‡ä»¶è¦†ç›–äº†åº•å±‚é•œåƒå±‚ä¸­çš„æ–‡ä»¶ã€‚è¿™æ ·å°±ä½¿å¾—æ–‡ä»¶çš„æ›´æ–°ç‰ˆæœ¬ä½œä¸ºä¸€ä¸ªæ–°é•œåƒå±‚æ·»åŠ åˆ°é•œåƒå½“ä¸­ã€‚</p>
<p>Dockeré€šè¿‡å­˜å‚¨å¼•æ“ï¼ˆæ–°ç‰ˆæœ¬é‡‡ç”¨å¿«ç…§æœºåˆ¶ï¼‰çš„æ–¹å¼æ¥å®ç°é•œåƒå±‚å †æ ˆï¼Œå¹¶ä¿è¯å¤šé•œåƒå±‚å¯¹å¤–å±•ç¤ºä¸ºç»Ÿä¸€çš„æ–‡ä»¶ç³»ç»Ÿã€‚</p>
<p>Linuxä¸Šå¯ç”¨çš„å­˜å‚¨å¼•æ’ƒæœ‰AUFSã€ Overlay2ã€ Device Mapperã€Btrfsä»¥åŠZFSã€‚é¡¾åæ€ä¹‰ï¼Œæ¯ç§å­˜å‚¨å¼•æ“éƒ½åŸºäº Linuxä¸­å¯¹åº”çš„æ–‡ä»¶ç³»ç»Ÿæˆ–è€…å—è®¾å¤‡æŠ€æœ¯ï¼Œäº•ä¸”æ¯ç§å­˜å‚¨å¼•æ“éƒ½æœ‰å…¶ç‹¬æœ‰çš„æ€§èƒ½ç‰¹ç‚¹ã€‚</p>
<p>Dockeråœ¨ Windowsä¸Šä»…æ”¯æŒ windowsfilter ä¸€ç§å­˜å‚¨å¼•æ“ï¼Œè¯¥å¼•æ“åŸºäºNTFSæ–‡ä»¶ç³»ç»Ÿä¹‹ä¸Šå®ç°äº†åˆ†å±‚å’ŒCoW [1]ã€‚</p>
<blockquote>
<p>ç‰¹ç‚¹</p>
</blockquote>
<p>Docker é•œåƒéƒ½æ˜¯åªè¯»çš„ï¼Œå½“å®¹å™¨å¯åŠ¨æ—¶ï¼Œä¸€ä¸ªæ–°çš„å¯å†™å±‚åŠ è½½åˆ°é•œåƒçš„é¡¶éƒ¨ï¼</p>
<p>è¿™ä¸€å±‚å°±æ˜¯æˆ‘ä»¬é€šå¸¸è¯´çš„å®¹å™¨å±‚ï¼Œå®¹å™¨ä¹‹ä¸‹çš„éƒ½å«é•œåƒå±‚ï¼<img src="/2022/06/09/uncatalog/cl46zbgi6000y7or7g7cnd6w6/image-20200611165355825.png" alt="image-20200611165355825"></p>
<p>å¦‚ä½•æäº¤ä¸€ä¸ªè‡ªå·±çš„é•œåƒï¼Ÿ</p>
<h2 id="commité•œåƒ"><a href="#commité•œåƒ" class="headerlink" title="commité•œåƒ"></a>commité•œåƒ</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">docker commit æäº¤å®¹å™¨æˆä¸ºä¸€ä¸ªæ–°çš„å‰¯æœ¬</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å‘½ä»¤å’ŒgitåŸç†ç±»ä¼¼</span></span><br><span class="line">docker commit -m=&quot;æè¿°ä¿¡æ¯&quot; -a=&quot;ä½œè€…&quot; å®¹å™¨id ç›®æ ‡é•œåƒå:[ç‰ˆæœ¬TAG]</span><br></pre></td></tr></table></figure></div>

<p>å®æˆ˜æµ‹è¯•</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">1ã€å¯åŠ¨ä¸€ä¸ªé»˜è®¤çš„tomcat</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">2ã€å‘ç°è¿™ä¸ªé»˜è®¤çš„tomcatæ˜¯æ²¡æœ‰webappsåº”ç”¨çš„ï¼Œé•œåƒçš„åŸå› ã€‚å®˜æ–¹çš„é•œåƒé»˜è®¤webappsä¸‹é¢æ˜¯æ²¡æœ‰æ–‡ä»¶çš„ï¼</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">3ã€æˆ‘è‡ªå·±å°†webapp.distä¸‹æ–‡ä»¶æ‹·è´è‡³webappsä¸‹</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">4ã€å°†æˆ‘ä»¬æ“ä½œè¿‡çš„å®¹å™¨é€šè¿‡commitæäº¤ä¸ºä¸€ä¸ªé•œåƒï¼æˆ‘ä»¬ä»¥åå°±å¯ä»¥ä½¿ç”¨æˆ‘ä»¬ä¿®æ”¹è¿‡çš„é•œåƒäº†ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬è‡ªå·±çš„ä¸€ä¸ªä¿®æ”¹çš„é•œåƒ</span></span><br></pre></td></tr></table></figure></div>

<p><img src="/2022/06/09/uncatalog/cl46zbgi6000y7or7g7cnd6w6/image-20200611172701729.png" alt="image-20200611172701729"></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">å¦‚æœä½ æƒ³è¦ä¿å­˜å½“å‰å®¹å™¨çš„çŠ¶æ€ï¼Œå°±å¯ä»¥é€šè¿‡commitæ¥æäº¤ï¼Œè·å¾—ä¸€ä¸ªé•œåƒï¼Œå°±å¥½æ¯”æˆ‘ä»¬æˆ‘ä»¬ä½¿ç”¨è™šæ‹Ÿæœºçš„å¿«ç…§ã€‚</span><br></pre></td></tr></table></figure></div>

<p>åˆ°äº†è¿™é‡Œå°±ç®—æ˜¯å…¥é—¨Dockeräº†ï¼</p>
]]></content>
      <tags>
        <tag>äº‘åŸç”ŸåŸºç¡€ç³»åˆ—</tag>
        <tag>Docker</tag>
      </tags>
  </entry>
  <entry>
    <title>äº‘åŸç”ŸåŸºç¡€ç³»åˆ—ä¹‹Docker(ä¸€)è¿›é˜¶</title>
    <url>/2022/06/09/uncatalog/cl46zffyz00127or72j1r80ti/</url>
    <content><![CDATA[<hr>
<span id="more"></span>



<hr>
<h1 id="å®¹å™¨æ•°æ®å·"><a href="#å®¹å™¨æ•°æ®å·" class="headerlink" title="å®¹å™¨æ•°æ®å·"></a>å®¹å™¨æ•°æ®å·</h1><h2 id="ä»€ä¹ˆæ˜¯å®¹å™¨æ•°æ®å·"><a href="#ä»€ä¹ˆæ˜¯å®¹å™¨æ•°æ®å·" class="headerlink" title="ä»€ä¹ˆæ˜¯å®¹å™¨æ•°æ®å·"></a>ä»€ä¹ˆæ˜¯å®¹å™¨æ•°æ®å·</h2><p><strong>dockerçš„ç†å¿µå›é¡¾</strong></p>
<p>å°†åº”ç”¨å’Œç¯å¢ƒæ‰“åŒ…æˆä¸€ä¸ªé•œåƒï¼</p>
<p>æ•°æ®ï¼Ÿå¦‚æœæ•°æ®éƒ½åœ¨å®¹å™¨ä¸­ï¼Œé‚£ä¹ˆæˆ‘ä»¬å®¹å™¨åˆ é™¤ï¼Œæ•°æ®å°±ä¼šä¸¢å¤±ï¼éœ€æ±‚ï¼šæ•°æ®å¯ä»¥æŒä¹…åŒ–</p>
<p>MySQLï¼Œå®¹å™¨åˆ é™¤äº†ï¼Œåˆ åº“è·‘è·¯ï¼éœ€æ±‚ï¼šMySQLæ•°æ®å¯ä»¥å­˜å‚¨åœ¨æœ¬åœ°ï¼</p>
<p>å®¹å™¨ä¹‹é—´å¯ä»¥æœ‰ä¸€ä¸ªæ•°æ®å…±äº«çš„æŠ€æœ¯ï¼Dockerå®¹å™¨ä¸­äº§ç”Ÿçš„æ•°æ®ï¼ŒåŒæ­¥åˆ°æœ¬åœ°ï¼</p>
<p>è¿™å°±æ˜¯å·æŠ€æœ¯ï¼ç›®å½•çš„æŒ‚è½½ï¼Œå°†æˆ‘ä»¬å®¹å™¨å†…çš„ç›®å½•ï¼ŒæŒ‚è½½åˆ°Linuxä¸Šé¢ï¼</p>
<p><img src="/2022/06/09/uncatalog/cl46zffyz00127or72j1r80ti/image-20200611220811766.png" alt="image-20200611220811766"></p>
<p><strong>æ€»ç»“ä¸€å¥è¯ï¼šå®¹å™¨çš„æŒä¹…åŒ–å’ŒåŒæ­¥æ“ä½œï¼å®¹å™¨é—´ä¹Ÿæ˜¯å¯ä»¥æ•°æ®å…±äº«çš„ï¼</strong></p>
<h2 id="ä½¿ç”¨æ•°æ®å·"><a href="#ä½¿ç”¨æ•°æ®å·" class="headerlink" title="ä½¿ç”¨æ•°æ®å·"></a>ä½¿ç”¨æ•°æ®å·</h2><blockquote>
<p>æ–¹å¼ä¸€ï¼šç›´æ¥ä½¿ç”¨å‘½ä»¤æ¥æŒ‚è½½</p>
</blockquote>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">docker run -it -v ä¸»æœºç›®å½•:å®¹å™¨ç›®å½•</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æµ‹è¯•</span></span><br><span class="line">[root@localhost home]# docker run -it -v /home/ceshi:/home  centos  /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¯åŠ¨èµ·æ¥çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡docker inspect å®¹å™¨id æ¥æŸ¥çœ‹æŒ‚è½½æƒ…å†µï¼šï¼ˆè§ä¸‹å›¾ï¼‰</span></span><br></pre></td></tr></table></figure></div>

<p><img src="/2022/06/09/uncatalog/cl46zffyz00127or72j1r80ti/image-20200611224010091.png" alt="image-20200611224010091"></p>
<p>æµ‹è¯•æ–‡ä»¶çš„åŒæ­¥</p>
<p><img src="/2022/06/09/uncatalog/cl46zffyz00127or72j1r80ti/image-20200611224046109.png" alt="image-20200611224046109"></p>
<p>åœ¨å®¹å™¨å†…æŒ‡å®šç›®å½•ä¸‹æ·»åŠ æˆ–ä¿®æ”¹ä¸€ä¸ªæ–‡ä»¶ï¼Œä¼šåŒæ­¥åˆ°ä¸»æœºæŒ‡å®šç›®å½•ä¸‹ï¼åä¹‹ï¼Œåœ¨ä¸»æœºç›®å½•ä¸‹åšç›¸å…³æ“ä½œï¼Œä¹Ÿä¼šåŒæ­¥åˆ°å®¹å™¨å¯¹åº”çš„ç›®å½•ä¸‹ï¼</p>
<p>å†æ¥æµ‹è¯•ï¼</p>
<p>1ã€åœæ­¢å®¹å™¨</p>
<p>2ã€å®¿ä¸»æœºä¿®æ”¹æ–‡ä»¶</p>
<p>3ã€å¯åŠ¨å®¹å™¨</p>
<p>4ã€å®¹å™¨å†…çš„æ•°æ®ä¾æ—§æ˜¯åŒæ­¥çš„ï¼</p>
<p><img src="/2022/06/09/uncatalog/cl46zffyz00127or72j1r80ti/image-20200611224137284.png" alt="image-20200611224137284"></p>
<p>å¥½å¤„ï¼šæˆ‘ä»¬ä»¥åä¿®æ”¹åªéœ€è¦åœ¨æœ¬åœ°ä¿®æ”¹å³å¯ï¼Œå®¹å™¨å†…ä¼šè‡ªåŠ¨åŒæ­¥ï¼</p>
<h2 id="å®æˆ˜ï¼šå®‰è£…MySQL"><a href="#å®æˆ˜ï¼šå®‰è£…MySQL" class="headerlink" title="å®æˆ˜ï¼šå®‰è£…MySQL"></a>å®æˆ˜ï¼šå®‰è£…MySQL</h2><p>æ€è€ƒï¼šMySQLçš„æ•°æ®æŒä¹…åŒ–çš„é—®é¢˜ï¼</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> è·å–é•œåƒ</span></span><br><span class="line">[root@localhost home]# docker pull mysql:5.7</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> è¿è¡Œå®¹å™¨ï¼Œéœ€è¦åšæ•°æ®æŒ‚è½½ï¼ <span class="comment"># å®‰è£…mysql,éœ€è¦é…ç½®å¯†ç ï¼Œè¿™æ˜¯è¦æ³¨æ„çš„ç‚¹ï¼</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å®˜æ–¹æµ‹è¯•ï¼šdocker run --name some-mysql -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¯åŠ¨æˆ‘ä»¬çš„MySQLå®¹å™¨</span></span><br><span class="line">-d	åå°è¿è¡Œ</span><br><span class="line">-p	ç«¯å£æ˜ å°„</span><br><span class="line">-v	å·æŒ‚è½½</span><br><span class="line">-e  ç¯å¢ƒé…ç½®</span><br><span class="line">--name  å®¹å™¨åå­—</span><br><span class="line">[root@localhost home]# docker run -d -p 3310:3306 -v /home/mysql/conf:/etc/mysql/conf.d -v /home/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 --name mysql01 mysql:5.7</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¯åŠ¨æˆåŠŸä¹‹åï¼Œæˆ‘ä»¬åœ¨æœ¬åœ°ä½¿ç”¨sqlyog è¿æ¥æµ‹è¯•ä¸€ä¸‹</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> sqlyog â€”â€” è¿æ¥åˆ°æœåŠ¡å™¨çš„3310 â€”â€” 3310å’Œå®¹å™¨å†…çš„3306æ˜ å°„ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±å¯ä»¥è¿æ¥ä¸Šäº†ï¼</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æœ¬åœ°æµ‹è¯•åˆ›å»ºä¸€ä¸ªæ•°æ®åº“ï¼ŒæŸ¥çœ‹ä¸€ä¸‹æˆ‘ä»¬çš„æ˜ å°„çš„è·¯å¾„æ˜¯å¦ok!</span></span><br></pre></td></tr></table></figure></div>

<p>å‡è®¾æˆ‘ä»¬å°†å®¹å™¨åˆ é™¤</p>
<p><img src="/2022/06/09/uncatalog/cl46zffyz00127or72j1r80ti/image-20200611230752177.png" alt="image-20200611230752177"></p>
<p>å‘ç°ï¼Œæˆ‘ä»¬æŒ‚è½½åˆ°æœ¬åœ°çš„æ•°æ®å·ä¾æ—§æ²¡æœ‰ä¸¢å¤±ï¼Œè¿™å°±å®ç°äº†å®¹å™¨æ•°æ®æŒä¹…åŒ–åŠŸèƒ½ï¼</p>
<h2 id="å…·åå’ŒåŒ¿åæŒ‚è½½"><a href="#å…·åå’ŒåŒ¿åæŒ‚è½½" class="headerlink" title="å…·åå’ŒåŒ¿åæŒ‚è½½"></a>å…·åå’ŒåŒ¿åæŒ‚è½½</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åŒ¿åæŒ‚è½½</span></span><br><span class="line">-v å®¹å™¨å†…è·¯å¾„</span><br><span class="line">docker run -d -P --name nginx01 -v /etc/nginx nginx</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹æ‰€æœ‰å·çš„æƒ…å†µ</span></span><br><span class="line">[root@localhost data]# docker volume ls</span><br><span class="line">DRIVER              VOLUME NAME</span><br><span class="line">local               2dd0379216c9ee4441ed56f8ce53461c19abe78b8cfd024ac5fbe07c3b8f09ba</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> è¿™é‡Œå‘ç°ï¼Œè¿™ç§å°±æ˜¯åŒ¿åæŒ‚è½½ï¼Œæˆ‘ä»¬åœ¨ -v ååªå†™äº†å®¹å™¨å†…çš„è·¯å¾„ï¼Œæ²¡æœ‰å†™å®¹å™¨å¤–çš„è·¯å¾„ï¼</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å…·åæŒ‚è½½</span></span><br><span class="line">[root@localhost home]# docker run -d -P --name nginx02 -v juming-nginx:/etc/nginx nginx</span><br><span class="line">5ba5708389bf71b2156fdbcedc50a62b16ac27adb2a3dfac42c52e9da5ace79f</span><br><span class="line">[root@localhost home]# docker volume ls</span><br><span class="line">DRIVER              VOLUME NAME</span><br><span class="line">local               juming-nginx</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> é€šè¿‡ -v å·åï¼šå®¹å™¨å†…è·¯å¾„</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹ä¸€ä¸‹è¿™ä¸ªå·  <span class="comment"># å…ˆæ‰¾åˆ°å·æ‰€åœ¨è·¯å¾„ docker volume inspect å·åï¼Œå¦‚ä¸‹å›¾ï¼š</span></span></span><br></pre></td></tr></table></figure></div>

<p><img src="/2022/06/09/uncatalog/cl46zffyz00127or72j1r80ti/image-20200611235522418.png" alt="image-20200611235522418"></p>
<p>æ‰€æœ‰çš„dockerå®¹å™¨å†…çš„å·ï¼Œæ²¡æœ‰æŒ‡å®šç›®å½•çš„æƒ…å†µä¸‹éƒ½æ˜¯åœ¨**/var/lib/docker/volumes/xxxx/_data**ä¸‹ï¼<br>æˆ‘ä»¬é€šè¿‡å…·åæŒ‚è½½å¯ä»¥æ–¹ä¾¿çš„æ‰¾åˆ°æˆ‘ä»¬çš„ä¸€ä¸ªå·ï¼Œå¤§å¤šæ•°æƒ…å†µä½¿ç”¨ <strong>å…·åæŒ‚è½½</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å¦‚ä½•ç¡®å®šæ˜¯å…·åæŒ‚è½½è¿˜æ˜¯åŒ¿åæŒ‚è½½ï¼Œè¿˜æ˜¯æŒ‡å®šè·¯å¾„æŒ‚è½½ï¼</span></span><br><span class="line">-v	å®¹å™¨å†…è·¯å¾„		       # åŒ¿åæŒ‚è½½</span><br><span class="line">-v	å·å:å®¹å™¨å†…è·¯å¾„	 	 # å…·åæŒ‚è½½</span><br><span class="line">-v	/å®¿ä¸»æœºè·¯å¾„:å®¹å™¨å†…è·¯å¾„   # æŒ‡å®šè·¯å¾„æŒ‚è½½ï¼</span><br></pre></td></tr></table></figure></div>

<p>æ‹“å±•ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> é€šè¿‡ -v å®¹å™¨å†…è·¯å¾„ï¼šro æˆ– rw   æ”¹å˜è¯»å†™æƒé™</span></span><br><span class="line">ro	 #readonly åªè¯»</span><br><span class="line">rw	 #readwrite å¯è¯»å¯å†™</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¸€æ—¦åˆ›å»ºå®¹å™¨æ—¶è®¾ç½®äº†å®¹å™¨æƒé™ï¼Œå®¹å™¨å¯¹æˆ‘ä»¬æŒ‚è½½å‡ºæ¥çš„å†…å®¹å°±æœ‰é™å®šäº†ï¼</span></span><br><span class="line">docker run -d -P --name nginx05 -v juming:/etc/nginx:ro nginx</span><br><span class="line">docker run -d -P --name nginx05 -v juming:/etc/nginx:rw nginx</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> é»˜è®¤æ˜¯ rw</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ro åªè¦çœ‹åˆ°roå°±è¯´æ˜è¿™ä¸ªè·¯å¾„åªèƒ½é€šè¿‡å®¿ä¸»æœºæ¥æ“ä½œï¼Œå®¹å™¨å†…éƒ¨æ˜¯æ— æ³•æ“ä½œï¼</span></span><br></pre></td></tr></table></figure></div>

<h2 id="åˆå§‹Dockerfile"><a href="#åˆå§‹Dockerfile" class="headerlink" title="åˆå§‹Dockerfile"></a>åˆå§‹Dockerfile</h2><p>Dockerfile å°±æ˜¯ç”¨æ¥æ„å»º dockeré•œåƒçš„æ„å»ºæ–‡ä»¶ï¼å‘½ä»¤è„šæœ¬ï¼ å…ˆä½“éªŒä¸€ä¸‹ï¼</p>
<p>é€šè¿‡è¿™ä¸ªè„šæœ¬å¯ä»¥ç”Ÿæˆé•œåƒï¼Œé•œåƒæ˜¯ä¸€å±‚ä¸€å±‚çš„ï¼Œè„šæœ¬æ˜¯ä¸€ä¸ªä¸ªçš„å‘½ä»¤ï¼Œæ¯ä¸ªå‘½ä»¤éƒ½æ˜¯æœ€ç»ˆé•œåƒçš„ä¸€å±‚ï¼</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åˆ›å»ºä¸€ä¸ªdockerfileæ–‡ä»¶ï¼Œåå­—å¯ä»¥éšæœºï¼Œå»ºè®® dockerfile</span></span><br><span class="line"></span><br><span class="line">[root@localhost docker-test-volume]# vim dockerfile</span><br><span class="line"><span class="meta">#</span><span class="bash"> æ–‡ä»¶ä¸­çš„å†…å®¹ï¼šæŒ‡ä»¤(å¤§å†™) å‚æ•°</span></span><br><span class="line">FROM centos</span><br><span class="line"></span><br><span class="line">VOLUME [&quot;volume01&quot;,&quot;volume02&quot;]</span><br><span class="line"></span><br><span class="line">CMD echo&quot;----end----&quot;</span><br><span class="line"></span><br><span class="line">CMD /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> è¿™é‡Œçš„æ¯ä¸ªå‘½ä»¤ï¼Œå°±æ˜¯é•œåƒçš„ä¸€å±‚ï¼</span></span><br></pre></td></tr></table></figure></div>

<p><img src="/2022/06/09/uncatalog/cl46zffyz00127or72j1r80ti/image-20200612003052844.png" alt="image-20200612003052844"></p>
<p>æ³¨æ„ï¼šæˆ‘ä»¬è¿™é‡Œçš„ dockerfile  æ˜¯æˆ‘ä»¬ç¼–å†™çš„æ–‡ä»¶åå“¦ï¼</p>
<p><img src="/2022/06/09/uncatalog/cl46zffyz00127or72j1r80ti/image-20200612003717223.png" alt="image-20200612003717223"></p>
<p>è¿™ä¸¤ä¸ªå·å’Œå¤–éƒ¨ä¸€å®šæœ‰ä¸¤ä¸ªåŒæ­¥çš„ç›®å½•ï¼</p>
<p><img src="/2022/06/09/uncatalog/cl46zffyz00127or72j1r80ti/image-20200612003946028.png" alt="image-20200612003946028"></p>
<p>æŸ¥çœ‹ä¸€ä¸‹å·æŒ‚è½½åœ¨ä¸»æœºä¸Šçš„è·¯å¾„</p>
<p><strong>docker inspect å®¹å™¨id</strong></p>
<p><img src="/2022/06/09/uncatalog/cl46zffyz00127or72j1r80ti/image-20200612004608027.png" alt="image-20200612004608027"></p>
<p>æµ‹è¯•ä¸€ä¸‹åˆšæ‰çš„æ–‡ä»¶æ˜¯å¦åŒæ­¥å‡ºå»äº†ï¼</p>
<p>è¿™ç§æ–¹å¼æˆ‘ä»¬æœªæ¥ä½¿ç”¨ååˆ†çš„å¤šï¼Œå› ä¸ºæˆ‘ä»¬é€šå¸¸ä¼šæ„å»ºè‡ªå·±çš„é•œåƒï¼</p>
<p>å‡è®¾æ„å»ºé•œåƒçš„æ—¶å€™æ²¡æœ‰æŒ‚åœ¨å·ï¼Œè¦æ‰‹åŠ¨é•œåƒæŒ‚è½½å³å¯ï¼š (å‚è€ƒä¸Šæ–‡<strong>å…·åå’ŒåŒ¿åæŒ‚è½½</strong>)</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">-v å·å:å®¹å™¨å†…è·¯å¾„ </span><br></pre></td></tr></table></figure></div>

<h2 id="æ•°æ®å·å®¹å™¨"><a href="#æ•°æ®å·å®¹å™¨" class="headerlink" title="æ•°æ®å·å®¹å™¨"></a>æ•°æ®å·å®¹å™¨</h2><p><strong>å¤šä¸ªmysqlåŒæ­¥æ•°æ®ï¼</strong></p>
<p><img src="/2022/06/09/uncatalog/cl46zffyz00127or72j1r80ti/image-20200612223759573.png" alt="image-20200612223759573"></p>
<p><img src="/2022/06/09/uncatalog/cl46zffyz00127or72j1r80ti/image-20200612224621379.png" alt="image-20200612224621379"></p>
<p><img src="/2022/06/09/uncatalog/cl46zffyz00127or72j1r80ti/image-20200612225358172.png" alt="image-20200612225358172"></p>
<p>åœ¨docker03ä¸‹åˆ›å»ºdocker03æ–‡ä»¶åï¼Œè¿›å…¥docker01å‘ç°ä¹Ÿä¾æ—§ä¼šåŒæ­¥è¿‡æ¥ï¼š</p>
<p><img src="/2022/06/09/uncatalog/cl46zffyz00127or72j1r80ti/image-20200612225641266.png" alt="image-20200612225641266"></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æµ‹è¯•1ï¼šåˆ é™¤docker01åï¼Œdocker02å’Œdocker03æ˜¯å¦è¿˜å¯ä»¥è®¿é—®åŸæ¥docker01ä¸‹åˆ›å»ºçš„çš„æ–‡ä»¶ï¼Ÿ</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æµ‹è¯•1çš„ç»“æœä¸ºï¼šä¾æ—§å¯ä»¥è®¿é—®ï¼ï¼ï¼</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æµ‹è¯•2ï¼šåˆ é™¤docker01åï¼Œdocker02å’Œdocker03ä¹‹é—´æ˜¯å¦å¯ä»¥ç›¸äº’åŒæ­¥æ–‡ä»¶ï¼Ÿ</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æµ‹è¯•2çš„ç»“æœä¸ºï¼šdocket02å’Œdocker03ä¹‹é—´ä¸€ä¹å¯ä»¥å®ŒæˆåŒæ­¥ï¼ï¼ï¼ è§ä¸‹å›¾ï¼š</span></span><br></pre></td></tr></table></figure></div>

<p><img src="/2022/06/09/uncatalog/cl46zffyz00127or72j1r80ti/image-20200612231431551.png" alt="image-20200612231431551"></p>
<p><img src="/2022/06/09/uncatalog/cl46zffyz00127or72j1r80ti/image-20200612231603498.png" alt="image-20200612231603498"></p>
<p><strong>å¤šä¸ªmysqlå®ç°æ•°æ®å…±äº«</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">âœ  ~ docker run -d -p 3306:3306 -v /home/mysql/conf:/etc/mysql/conf.d -v /home/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 --name mysql01 mysql:5.7</span><br><span class="line">âœ  ~ docker run -d -p 3307:3306 -e MYSQL_ROOT_PASSWORD=123456 --name mysql02 --volumes-from mysql01  mysql:5.7</span><br><span class="line"><span class="meta">#</span><span class="bash"> è¿™ä¸ªæ—¶å€™ï¼Œå¯ä»¥å®ç°ä¸¤ä¸ªå®¹å™¨æ•°æ®åŒæ­¥ï¼</span></span><br></pre></td></tr></table></figure></div>

<p><strong>ç»“è®ºï¼š</strong></p>
<p>å®¹å™¨ä¹‹é—´çš„é…ç½®ä¿¡æ¯çš„ä¼ é€’ï¼Œæ•°æ®å·å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸä¸€ç›´æŒç»­åˆ°æ²¡æœ‰å®¹å™¨ä½¿ç”¨ä¸ºæ­¢ã€‚</p>
<p>ä½†æ˜¯ä¸€æ—¦ä½ æŒä¹…åŒ–åˆ°äº†æœ¬åœ°ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæœ¬åœ°çš„æ•°æ®æ˜¯ä¸ä¼šåˆ é™¤çš„ï¼</p>
<hr>
<h1 id="DockerFile"><a href="#DockerFile" class="headerlink" title="DockerFile"></a>DockerFile</h1><h2 id="DockerFileä»‹ç»"><a href="#DockerFileä»‹ç»" class="headerlink" title="DockerFileä»‹ç»"></a>DockerFileä»‹ç»</h2><p><code>dockerfile</code>æ˜¯ç”¨æ¥æ„å»ºdockeré•œåƒçš„æ–‡ä»¶ï¼å‘½ä»¤å‚æ•°è„šæœ¬ï¼</p>
<p><strong>æ„å»ºæ­¥éª¤ï¼š</strong></p>
<p>1ã€ ç¼–å†™ä¸€ä¸ªdockerfileæ–‡ä»¶</p>
<p>2ã€ docker build æ„å»ºç§°ä¸ºä¸€ä¸ªé•œåƒ</p>
<p>3ã€ docker runè¿è¡Œé•œåƒ</p>
<p>4ã€ docker pushå‘å¸ƒé•œåƒï¼ˆDockerHub ã€é˜¿é‡Œäº‘ä»“åº“)</p>
<p>æŸ¥çœ‹å®˜æ–¹æ˜¯æ€ä¹ˆåšçš„ï¼</p>
<p><img src="/2022/06/09/uncatalog/cl46zffyz00127or72j1r80ti/image-20200612233951676.png" alt="image-20200612233951676"></p>
<p><img src="/2022/06/09/uncatalog/cl46zffyz00127or72j1r80ti/image-20200612234022746.png" alt="image-20200612234022746"></p>
<p>å¾ˆå¤šå®˜æ–¹é•œåƒéƒ½æ˜¯åŸºç¡€åŒ…ï¼Œå¾ˆå¤šåŠŸèƒ½æ²¡æœ‰ï¼Œæˆ‘ä»¬é€šå¸¸ä¼šè‡ªå·±æ­å»ºè‡ªå·±çš„é•œåƒï¼</p>
<p>å®˜æ–¹æ—¢ç„¶å¯ä»¥åˆ¶ä½œé•œåƒï¼Œé‚£æˆ‘ä»¬ä¹Ÿå¯ä»¥ï¼</p>
<h2 id="DockerFileæ„å»ºè¿‡ç¨‹"><a href="#DockerFileæ„å»ºè¿‡ç¨‹" class="headerlink" title="DockerFileæ„å»ºè¿‡ç¨‹"></a>DockerFileæ„å»ºè¿‡ç¨‹</h2><p><strong>åŸºç¡€çŸ¥è¯†ï¼š</strong></p>
<p>1ã€æ¯ä¸ªä¿ç•™å…³é”®å­—(æŒ‡ä»¤ï¼‰éƒ½æ˜¯å¿…é¡»æ˜¯å¤§å†™å­—æ¯</p>
<p>2ã€æ‰§è¡Œä»ä¸Šåˆ°ä¸‹é¡ºåº</p>
<p>3ã€# è¡¨ç¤ºæ³¨é‡Š</p>
<p>4ã€æ¯ä¸€ä¸ªæŒ‡ä»¤éƒ½ä¼šåˆ›å»ºæäº¤ä¸€ä¸ªæ–°çš„é•œåƒæ›¾ï¼Œå¹¶æäº¤ï¼</p>
<p><img src="/2022/06/09/uncatalog/cl46zffyz00127or72j1r80ti/image-20200612234419262.png" alt="image-20200612234419262"></p>
<p>Dockerfileæ˜¯é¢å‘å¼€å‘çš„ï¼Œæˆ‘ä»¬ä»¥åè¦å‘å¸ƒé¡¹ç›®ï¼Œåšé•œåƒï¼Œå°±éœ€è¦ç¼–å†™dockerfileæ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶ååˆ†ç®€å•ï¼</p>
<p>Dockeré•œåƒé€æ¸æˆä¼ä¸šäº¤ä»˜çš„æ ‡å‡†ï¼Œå¿…é¡»è¦æŒæ¡ï¼</p>
<p>DockerFileï¼šæ„å»ºæ–‡ä»¶ï¼Œå®šä¹‰äº†ä¸€åˆ‡çš„æ­¥éª¤ï¼Œæºä»£ç </p>
<p>DockerImagesï¼šé€šè¿‡DockerFileæ„å»ºç”Ÿæˆçš„é•œåƒï¼Œæœ€ç»ˆå‘å¸ƒå’Œè¿è¡Œäº§å“ã€‚</p>
<p>Dockerå®¹å™¨ï¼šå®¹å™¨å°±æ˜¯é•œåƒè¿è¡Œèµ·æ¥æä¾›æœåŠ¡ã€‚</p>
<h2 id="DockerFileçš„æŒ‡ä»¤"><a href="#DockerFileçš„æŒ‡ä»¤" class="headerlink" title="DockerFileçš„æŒ‡ä»¤"></a>DockerFileçš„æŒ‡ä»¤</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">FROM			# åŸºç¡€é•œåƒï¼Œä¸€åˆ‡ä»è¿™é‡Œå¼€å§‹æ„å»º</span><br><span class="line">MAINTAINER		# é•œåƒæ˜¯è°å†™çš„ï¼Œå§“å+é‚®ç®±</span><br><span class="line">RUN				# é•œåƒæ„å»ºçš„æ—¶å€™éœ€è¦è¿è¡Œçš„å‘½ä»¤</span><br><span class="line">ADD				# æ­¥éª¤ï¼štomcaté•œåƒï¼Œè¿™ä¸ªtomcatå‹ç¼©åŒ…ï¼ æ·»åŠ å†…å®¹</span><br><span class="line">WORKDIR			# é•œåƒçš„å·¥ä½œç›®å½•</span><br><span class="line">VOLUME			# æŒ‚è½½çš„ç›®å½•</span><br><span class="line">EXPOSE          # æš´éœ²ç«¯å£é…ç½®ï¼Œè·Ÿ -p æ˜¯ä¸€ä¸ªé“ç†</span><br><span class="line">CMD				# æŒ‡å®šè¿™ä¸ªå®¹å™¨å¯åŠ¨æ—¶è¦æ‰§è¡Œçš„å‘½ä»¤,åªæœ‰æœ€åä¸€ä¸ªå‘½ä»¤ä¼šç”Ÿæ•ˆï¼Œå¯æ‚²æ›¿ä»£</span><br><span class="line">ENTRYPOINT		# æŒ‡å®šè¿™ä¸ªå®¹å™¨å¯åŠ¨çš„æ—¶å€™è¦æ‰§è¡Œçš„å‘½ä»¤ï¼Œå¯ä»¥è¿½åŠ å‘½ä»¤</span><br><span class="line">ONBUILD			# å½“æ„å»ºä¸€ä¸ªè¢«ç»§æ‰¿DockerFile è¿™ä¸ªæ—¶å€™å°±ä¼šè¿è¡ŒONBUILDçš„æŒ‡ä»¤ã€‚è§¦å‘æŒ‡ä»¤</span><br><span class="line">COPY			# ç±»ä¼¼ADD,å°†æˆ‘ä»¬æ–‡ä»¶æ‹·è´åˆ°é•œåƒä¸­</span><br><span class="line">ENV				# æ„å»ºçš„æ—¶å€™è®¾ç½®ç¯å¢ƒå˜é‡ï¼Œè·Ÿ -e æ˜¯ä¸€ä¸ªæ„æ€</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> CMD å’Œ ENTRYPOINT çš„åŒºåˆ«è¯´æ˜ï¼šï¼ˆåé¢ä¹Ÿä¼šä»‹ç»ï¼‰</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> è‹¥CMD å’Œ ENTRYPOINT åè·Ÿçš„éƒ½æ˜¯ ls -a è¿™ä¸ªå‘½ä»¤ï¼Œå½“docker run ä¸€ä¸ªå®¹å™¨æ—¶ï¼Œæ·»åŠ äº† -l é€‰é¡¹ï¼Œåˆ™CMDé‡Œçš„ls -a å‘½ä»¤å°±ä¼šè¢«æ›¿æ¢æˆ-l;è€ŒENTRYPOINTä¸­çš„ ls -aä¼šè¿½åŠ -lå˜æˆ ls -a -l</span>  </span><br></pre></td></tr></table></figure></div>

<p><img src="/2022/06/09/uncatalog/cl46zffyz00127or72j1r80ti/image-20200613000838850.png" alt="image-20200613000838850"></p>
<h2 id="å®æˆ˜æµ‹è¯•"><a href="#å®æˆ˜æµ‹è¯•" class="headerlink" title="å®æˆ˜æµ‹è¯•"></a>å®æˆ˜æµ‹è¯•</h2><p>Docker Hubä¸­99%é•œåƒéƒ½æ˜¯ä»è¿™ä¸ªåŸºç¡€é•œåƒè¿‡æ¥çš„( <strong>FROM scratch</strong> )ï¼Œç„¶åé…ç½®éœ€è¦çš„è½¯ä»¶å’Œé…ç½®æ¥æ„å»ºã€‚</p>
<p><img src="/2022/06/09/uncatalog/cl46zffyz00127or72j1r80ti/image-20200613001130237.png" alt="image-20200613001130237"></p>
<blockquote>
<p>åˆ›å»ºä¸€ä¸ªè‡ªå·±çš„ centos</p>
</blockquote>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1ã€ç¼–å†™DockerFileæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</span></span><br><span class="line">[root@localhost dockerfile]# cat mydockerfile-centos</span><br><span class="line">FROM centos						</span><br><span class="line">MAINTAINER ztx&lt;123456@qq.com&gt; </span><br><span class="line"></span><br><span class="line">ENV MYPATH /usr/local</span><br><span class="line">WORKDIR $MYPATH</span><br><span class="line"></span><br><span class="line">RUN yum -y install vim</span><br><span class="line">RUN yum -y install net-tools</span><br><span class="line"></span><br><span class="line">EXPOSE 80</span><br><span class="line"></span><br><span class="line">CMD echo $MYPATH</span><br><span class="line">CMD echo &quot;----end----&quot;</span><br><span class="line">CMD /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2ã€é€šè¿‡è¿™ä¸ªæ–‡ä»¶æ„å»ºé•œåƒ</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å‘½ä»¤docker build -f dockerfileæ–‡ä»¶è·¯å¾„ -t é•œåƒå:[tag] .</span></span><br><span class="line">[root@localhost dockerfile]# docker build -f mydockerfile-centos -t mycentos:0.1 .</span><br><span class="line">....</span><br><span class="line">Successfully built c987078b06cb</span><br><span class="line">Successfully tagged mycentos:0.1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3ã€æµ‹è¯•è¿è¡Œ</span></span><br></pre></td></tr></table></figure></div>

<p><strong>å¯¹æ¯”ï¼š</strong></p>
<p><strong>ä¹‹å‰çš„åŸç”Ÿçš„centos</strong></p>
<p><img src="/2022/06/09/uncatalog/cl46zffyz00127or72j1r80ti/image-20200613004551789.png" alt="image-20200613004551789"></p>
<p><strong>æˆ‘ä»¬å¢åŠ ä¹‹åçš„é•œåƒ</strong></p>
<p><img src="/2022/06/09/uncatalog/cl46zffyz00127or72j1r80ti/image-20200613005056516.png" alt="image-20200613005056516"></p>
<p>æ³¨ï¼šnet-tools åŒ…å«ä¸€ç³»åˆ—ç¨‹åºï¼Œæ„æˆäº† Linux ç½‘ç»œçš„åŸºç¡€ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥åˆ—å‡ºæœ¬åœ°é•œåƒçš„å˜æ›´å†å²ï¼š</p>
<p><img src="/2022/06/09/uncatalog/cl46zffyz00127or72j1r80ti/image-20200613005625844.png" alt="image-20200613005625844"></p>
<p>æˆ‘ä»¬å¹³æ—¶æ‹¿åˆ°ä¸€ä¸ªé•œåƒï¼Œå¯ä»¥ç ”ç©¶ä¸€ä¸‹å®ƒæ˜¯æ€ä¹ˆåšçš„ï¼</p>
<blockquote>
<p>CMD å’Œ ENTRYPOINT çš„åŒºåˆ«</p>
</blockquote>
<p><strong>æµ‹è¯•CMD</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ç¼–å†™dockerfileæ–‡ä»¶</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> vim dockerfile-test-cmd</span></span><br><span class="line">FROM centos</span><br><span class="line">CMD [&quot;ls&quot;,&quot;-a&quot;]</span><br><span class="line"><span class="meta">#</span><span class="bash"> æ„å»ºé•œåƒ</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> docker build  -f dockerfile-test-cmd -t cmd-test:0.1 .</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> è¿è¡Œé•œåƒ</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> docker run cmd-test:0.1</span></span><br><span class="line">.</span><br><span class="line">..</span><br><span class="line">.dockerenv</span><br><span class="line">bin</span><br><span class="line">dev</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æƒ³è¿½åŠ ä¸€ä¸ªå‘½ä»¤  -l æˆä¸ºls -al</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> docker run cmd-test:0.1 -l</span></span><br><span class="line">docker: Error response from daemon: OCI runtime create failed: container_linux.go:349: starting container process caused &quot;exec: \&quot;-l\&quot;:</span><br><span class="line"> executable file not found in $PATH&quot;: unknown.</span><br><span class="line">ERRO[0000] error waiting for container: context canceled </span><br><span class="line"><span class="meta">#</span><span class="bash"> cmdçš„æƒ…å†µä¸‹ -l æ›¿æ¢äº†CMD[<span class="string">&quot;ls&quot;</span>,<span class="string">&quot;-l&quot;</span>]ã€‚ -l  ä¸æ˜¯å‘½ä»¤,æ‰€ä»¥æŠ¥é”™</span></span><br></pre></td></tr></table></figure></div>

<p><strong>æµ‹è¯•ENTRYPOINT</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ç¼–å†™dockerfileæ–‡ä»¶</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> vim dockerfile-test-entrypoint</span></span><br><span class="line">FROM centos</span><br><span class="line">ENTRYPOINT [&quot;ls&quot;,&quot;-a&quot;]</span><br><span class="line"><span class="meta">$</span><span class="bash"> docker run entrypoint-test:0.1</span></span><br><span class="line">.</span><br><span class="line">..</span><br><span class="line">.dockerenv</span><br><span class="line">bin</span><br><span class="line">dev</span><br><span class="line">etc</span><br><span class="line">home</span><br><span class="line">lib</span><br><span class="line">lib64</span><br><span class="line">lost+found ...</span><br><span class="line"><span class="meta">#</span><span class="bash"> æˆ‘ä»¬çš„å‘½ä»¤ï¼Œæ˜¯ç›´æ¥æ‹¼æ¥åœ¨æˆ‘ä»¬çš„ENTRYPOINTå‘½ä»¤åé¢çš„</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> docker run entrypoint-test:0.1 -l</span></span><br><span class="line">total 56</span><br><span class="line">drwxr-xr-x   1 root root 4096 May 16 06:32 .</span><br><span class="line">drwxr-xr-x   1 root root 4096 May 16 06:32 ..</span><br><span class="line">-rwxr-xr-x   1 root root    0 May 16 06:32 .dockerenv</span><br><span class="line">lrwxrwxrwx   1 root root    7 May 11  2019 bin -&gt; usr/bin</span><br><span class="line">drwxr-xr-x   5 root root  340 May 16 06:32 dev</span><br><span class="line">drwxr-xr-x   1 root root 4096 May 16 06:32 etc</span><br><span class="line">drwxr-xr-x   2 root root 4096 May 11  2019 home</span><br><span class="line">lrwxrwxrwx   1 root root    7 May 11  2019 lib -&gt; usr/lib</span><br><span class="line">lrwxrwxrwx   1 root root    9 May 11  2019 lib64 -&gt; usr/lib64 ....</span><br></pre></td></tr></table></figure></div>

<p>Dockerfileä¸­å¾ˆå¤šå‘½ä»¤éƒ½ååˆ†çš„ç›¸ä¼¼ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£å®ƒä»¬çš„åŒºåˆ«ï¼Œæˆ‘ä»¬æœ€å¥½çš„å­¦ä¹ å°±æ˜¯å¯¹æ¯”ä»–ä»¬ç„¶åæµ‹è¯•æ•ˆæœï¼</p>
<h2 id="å®æˆ˜ï¼šTomcaté•œåƒ"><a href="#å®æˆ˜ï¼šTomcaté•œåƒ" class="headerlink" title="å®æˆ˜ï¼šTomcaté•œåƒ"></a>å®æˆ˜ï¼šTomcaté•œåƒ</h2><p>1ã€å‡†å¤‡é•œåƒæ–‡ä»¶tomcatå‹ç¼©åŒ…ï¼Œjdkå‹ç¼©åŒ…ï¼</p>
<p><img src="/2022/06/09/uncatalog/cl46zffyz00127or72j1r80ti/image-20200613151500712.png" alt="image-20200613151500712"></p>
<p>2ã€ç¼–å†™Dockerfileæ–‡ä»¶ï¼Œå®˜æ–¹å‘½å: <strong>Dockerfile</strong> ï¼Œbuildä¼šè‡ªåŠ¨å¯»æ‰¾è¿™ä¸ªæ–‡ä»¶ï¼Œå°±ä¸è¦ -f æŒ‡å®šäº†ï¼</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">FROM centos</span><br><span class="line">MAINTAINER kuangshen&lt;123456@qq.com&gt;</span><br><span class="line"></span><br><span class="line">COPY readme.txt /usr/local/readme.txt</span><br><span class="line"></span><br><span class="line">ADD jdk-8u161-linux-x64.tar.gz    /usr/local/</span><br><span class="line">ADD apache-tomcat-8.0.53.tar.gz   /usr/local</span><br><span class="line"></span><br><span class="line">RUN yum -y install vim</span><br><span class="line">ENV MYPATH /usr/local</span><br><span class="line">WORKDIR $MYPATH</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ENV JAVA_HOME /usr/local/jdk1.8.0_161</span><br><span class="line">ENV CLASSPATH $JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar</span><br><span class="line">ENV CATALINA_HOME /usr/local/apache-tomcat-8.0.53</span><br><span class="line">ENV CATALINA_BASH /usr/local/apache-tomcat-8.0.53</span><br><span class="line">ENV PATH $PATH:$JAVA_HOME/bin:$CATALINA_HOME/lib:$CATALINA_HOME/bin</span><br><span class="line"></span><br><span class="line">EXPOSE 8080</span><br><span class="line"></span><br><span class="line">CMD /usr/local/apache-tomcat-8.0.53/bin/startup.sh &amp;&amp; tail -F /usr/local/apache-tomcat-8.0.53/bin/logs/catalina.out</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>3ã€æ„å»ºé•œåƒ</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> docker build -t diytomcat .     diytomcatæ˜¯å®šä¹‰çš„é•œåƒå</span></span><br></pre></td></tr></table></figure></div>

<p>4ã€å¯åŠ¨é•œåƒï¼Œåˆ›å»ºå®¹å™¨</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> docker run -d -p 9090:8080 --name kuangshentomcat02 -v /home/kuangshen/build/tomcat/<span class="built_in">test</span>:/usr/<span class="built_in">local</span>/apache-tomcat-8.0.53/webapps/<span class="built_in">test</span> -v /home/kuangshen/build/tomcat/tomcatlogs/:/usr/<span class="built_in">local</span>/apache-tomcat-8.0.53/logs diytomcat</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>5ã€è®¿é—®æµ‹è¯•</p>
<p><img src="/2022/06/09/uncatalog/cl46zffyz00127or72j1r80ti/image-20200613175551231.png" alt="image-20200613175551231"></p>
<p>6ã€å‘å¸ƒé¡¹ç›®ï¼ˆç”±äºåšäº†å·æŒ‚è½½ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥åœ¨æœ¬åœ°å‘å¸ƒé¡¹ç›®äº†ï¼‰</p>
<p>åœ¨/home/kuangshen/build/tomcat/testç›®å½•ä¸‹åˆ›å»ºWEB-INFç›®å½•ï¼Œåœ¨é‡Œé¢åˆ›å»ºweb.xmlæ–‡ä»¶ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="XML"><figure class="iseeu highlight /xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://java.sun.com/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://java.sun.com/xml/ns/javaee</span></span></span><br><span class="line"><span class="tag"><span class="string">                               http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd&quot;</span></span></span><br><span class="line"><span class="tag">           <span class="attr">version</span>=<span class="string">&quot;2.5&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<p>åœ¨å›åˆ°testç›®å½•ï¼Œæ·»åŠ ä¸€ä¸ªindex.jspé¡µé¢ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="HTML"><figure class="iseeu highlight /html"><table><tr><td class="code"><pre><span class="line">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;</span><br><span class="line">    pageEncoding=&quot;UTF-8&quot;%&gt;</span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>hello kuangshen<span class="tag">&lt;/<span class="name">title</span>&gt;<span class="name">vim</span></span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">Hello World!<span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">&lt;%</span><br><span class="line">System.out.println(&quot;---my test web logs---&quot;);</span><br><span class="line">%&gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></div>

<p>å‘ç°ï¼štesté¡¹ç›®éƒ¨ç½²æˆåŠŸï¼Œå¯ä»¥ç›´æ¥è®¿é—®ï¼</p>
<p><img src="/2022/06/09/uncatalog/cl46zffyz00127or72j1r80ti/image-20200613180033633.png" alt="image-20200613180033633"></p>
<p>æ³¨æ„ï¼šè¿™æ—¶è¿›å…¥/home/kuangshen/build/tomcat/tomcatlogs/ç›®å½•ä¸‹å°±å¯ä»¥çœ‹åˆ°æ—¥å¿—ä¿¡æ¯äº†ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">[root@localhost tomcatlogs]# cat catalina.out </span><br></pre></td></tr></table></figure></div>

<p><img src="/2022/06/09/uncatalog/cl46zffyz00127or72j1r80ti/image-20200613180355186.png" alt="image-20200613180355186"></p>
<p>ä¹‹å‰ä¸€ç›´è®¿é—®å¤±è´¥æ˜¯web.xmlé…ç½®æœ‰é—®é¢˜ï¼Œæœ€åä¹Ÿæ˜¯æŸ¥çœ‹è¯¥æ—¥å¿—æç¤ºï¼Œæ‰å¾—ä»¥è§£å†³ï¼ï¼ï¼</p>
<p>æˆ‘ä»¬ä»¥åå¼€å‘çš„æ­¥éª¤ï¼šéœ€è¦æŒæ¡Dockerfileçš„ç¼–å†™ï¼æˆ‘ä»¬ä¹‹åçš„ä¸€åˆ‡éƒ½æ˜¯ä½¿ç”¨dockeré•œåƒæ¥å‘å¸ƒè¿è¡Œï¼</p>
<h2 id="å‘å¸ƒè‡ªå·±çš„é•œåƒ"><a href="#å‘å¸ƒè‡ªå·±çš„é•œåƒ" class="headerlink" title="å‘å¸ƒè‡ªå·±çš„é•œåƒ"></a>å‘å¸ƒè‡ªå·±çš„é•œåƒ</h2><blockquote>
<p>Docker Hub</p>
</blockquote>
<p>1ã€åœ°å€ <a href="https://hub.docker.com/">https://hub.docker.com/</a></p>
<p>2ã€ç¡®å®šè¿™ä¸ªè´¦å·å¯ä»¥ç™»å½•</p>
<p>3ã€åœ¨æˆ‘ä»¬æœåŠ¡å™¨ä¸Šæäº¤è‡ªå·±çš„é•œåƒ</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">[root@localhost tomcat]# docker login --help</span><br><span class="line"></span><br><span class="line">Usage:	docker login [OPTIONS] [SERVER]</span><br><span class="line"></span><br><span class="line">Log in to a Docker registry.</span><br><span class="line">If no server is specified, the default is defined by the daemon.</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -p, --password string   Password</span><br><span class="line">      --password-stdin    Take the password from stdin</span><br><span class="line">  -u, --username string   Username</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ç™»å½•dockerhub</span></span><br><span class="line">[root@localhost tomcat]# docker login -u ztx115</span><br><span class="line">Password: </span><br><span class="line">WARNING! Your password will be stored unencrypted in /root/.docker/config.json.</span><br><span class="line">Configure a credential helper to remove this warning. See</span><br><span class="line">https://docs.docker.com/engine/reference/commandline/login/#credentials-store</span><br><span class="line"></span><br><span class="line">Login Succeeded</span><br></pre></td></tr></table></figure></div>

<p>4ã€ç™»å½•å®Œæ¯•åå°±å¯ä»¥æäº¤é•œåƒäº†ï¼Œå°±æ˜¯ä¸€æ­¥ docker push</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> pushè‡ªå·±çš„é•œåƒåˆ°æœåŠ¡å™¨ä¸Šï¼</span></span><br><span class="line">[root@localhost tomcat]# docker push diytomcat</span><br><span class="line">The push refers to repository [docker.io/library/diytomcat]</span><br><span class="line">c5593011cd68: Preparing </span><br><span class="line">d3ce40b8178e: Preparing </span><br><span class="line">02084c67dcc9: Preparing </span><br><span class="line">2b7c1c6c89c5: Preparing </span><br><span class="line">0683de282177: Preparing </span><br><span class="line">denied: requested access to the resource is denied  # æ‹’ç»</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> pushé•œåƒçš„é—®é¢˜ï¼Ÿ</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> è§£å†³ï¼šå¢åŠ ä¸€ä¸ªtag         docker tag  æŒ‡å®šé•œåƒçš„id   dockerhubçš„ç”¨æˆ·å/é•œåƒé‡å‘½å:[tag]</span></span><br><span class="line">[root@localhost tomcat]# docker tag bb64ab96b432 ztx115/tomcat:1.0</span><br></pre></td></tr></table></figure></div>

<p><img src="/2022/06/09/uncatalog/cl46zffyz00127or72j1r80ti/image-20200613211709842.png" alt="image-20200613211709842"></p>
<p><strong>æ³¨æ„ï¼šé•œåƒçš„é‡å‘½åå‰ä¸€å®šè¦åŠ å½“å‰çš„dockerhubçš„ç”¨æˆ·åï¼Œå¦åˆ™å°†ä¼špushå¤±è´¥ï¼ï¼ï¼ï¼</strong>ï¼ˆå¦‚ï¼šæŠŠztx115æ”¹æˆztx,  pushä¸€å®šå¤±è´¥ï¼ï¼‰</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> docekr pushä¸Šå»å³å¯ï¼  è‡ªå·±å¹³æ—¶å‘å¸ƒçš„é•œåƒå°½é‡å¸¦ä¸Šç‰ˆæœ¬å·</span></span><br><span class="line">[root@localhost tomcat]# docker push ztx115/tomcat:1.0</span><br><span class="line">The push refers to repository [docker.io/ztx115/tomcat]</span><br><span class="line">c5593011cd68: Pushed </span><br><span class="line">d3ce40b8178e: Pushed </span><br><span class="line">02084c67dcc9: Pushed </span><br><span class="line">2b7c1c6c89c5: Pushed </span><br><span class="line">0683de282177: Pushed </span><br><span class="line">1.0: digest: sha256:b6733deccf85ad66c6f4302215dd9ea63e1579817f15a099b5858785708ed408 size: 1372</span><br></pre></td></tr></table></figure></div>

<p><img src="/2022/06/09/uncatalog/cl46zffyz00127or72j1r80ti/image-20200613210147709.png" alt="image-20200613210147709"></p>
<p>å‘ç°ï¼Œæäº¤æ—¶ä¹Ÿæ˜¯æŒ‰ç…§é•œåƒçš„å±‚çº§æ¥è¿›è¡Œæäº¤çš„ï¼</p>
<blockquote>
<p>å‘å¸ƒåˆ°é˜¿é‡Œäº‘é•œåƒæœåŠ¡ä¸Šï¼ˆç‹‚ç¥è§†é¢‘æˆªå›¾ï¼‰</p>
</blockquote>
<p>1ã€ç™»å½•é˜¿é‡Œäº‘</p>
<p>2ã€æ‰¾åˆ°å®¹å™¨é•œåƒæœåŠ¡</p>
<p>3ã€åˆ›å»ºå‘½åç©ºé—´</p>
<p><img src="/2022/06/09/uncatalog/cl46zffyz00127or72j1r80ti/image-20200613212823736.png" alt="image-20200613212823736"></p>
<p>4ã€åˆ›å»ºå®¹å™¨é•œåƒä»“åº“</p>
<p><img src="/2022/06/09/uncatalog/cl46zffyz00127or72j1r80ti/image-20200613213014849.png" alt="image-20200613213014849"></p>
<p><img src="/2022/06/09/uncatalog/cl46zffyz00127or72j1r80ti/image-20200613213135466.png" alt="image-20200613213135466"></p>
<p><img src="/2022/06/09/uncatalog/cl46zffyz00127or72j1r80ti/image-20200613213222587.png" alt="image-20200613213222587"></p>
<p>5ã€æµè§ˆé˜¿é‡Œäº‘</p>
<p><img src="/2022/06/09/uncatalog/cl46zffyz00127or72j1r80ti/image-20200613214159792.png" alt="image-20200613214159792"></p>
<p>ä½¿ç”¨é˜¿é‡Œäº‘å®¹å™¨é•œåƒçš„å‚è€ƒå®˜æ–¹æŒ‡å—å³å¯ï¼ï¼ï¼ï¼ˆå³ä¸Šå›¾ï¼‰</p>
<h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p><img src="/2022/06/09/uncatalog/cl46zffyz00127or72j1r80ti/image-20200613214846464.png" alt="image-20200613214846464"></p>
<hr>
<h1 id="Dockerç½‘ç»œ"><a href="#Dockerç½‘ç»œ" class="headerlink" title="Dockerç½‘ç»œ"></a>Dockerç½‘ç»œ</h1><h2 id="ç†è§£Docker0"><a href="#ç†è§£Docker0" class="headerlink" title="ç†è§£Docker0"></a>ç†è§£Docker0</h2><p>æ¸…ç©ºæ‰€æœ‰ç¯å¢ƒ</p>
<blockquote>
<p>æµ‹è¯•</p>
</blockquote>
<p><img src="/2022/06/09/uncatalog/cl46zffyz00127or72j1r80ti/image-20200613224119526.png" alt="image-20200613224119526"></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> é—®é¢˜ï¼š dockeræ˜¯å¦‚ä½•å¤„ç†å®¹å™¨ç½‘ç»œè®¿é—®çš„ï¼Ÿ</span></span><br></pre></td></tr></table></figure></div>

<p><img src="/2022/06/09/uncatalog/cl46zffyz00127or72j1r80ti/image-20200613220806390.png" alt="image-20200613220806390"></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> [root@localhost /]<span class="comment"># docker run -d -P --name tomcat01 tomcat</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹å®¹å™¨çš„å†…éƒ¨ç½‘ç»œåœ°å€   ip addr,  å‘ç°å®¹å™¨å¯åŠ¨çš„æ—¶å€™ä¼šå¾—åˆ°ä¸€ä¸ª eth0@if43 ipåœ°å€ï¼Œdockeråˆ†é…çš„ï¼</span></span><br><span class="line">[root@localhost /]# docker exec -it tomcat01 ip addr</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">42: eth0@if43: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default </span><br><span class="line">    link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet 172.17.0.2/16 brd 172.17.255.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ€è€ƒï¼šlinuxèƒ½ä¸èƒ½pingé€šdockerå®¹å™¨å†…éƒ¨ï¼</span></span><br><span class="line">[root@localhost /]# ping 172.17.0.2</span><br><span class="line">PING 172.17.0.2 (172.17.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=1 ttl=64 time=0.476 ms</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=2 ttl=64 time=0.099 ms</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=3 ttl=64 time=0.105 ms</span><br><span class="line">...</span><br><span class="line"><span class="meta">#</span><span class="bash"> linux å¯ä»¥pingé€šdockerå®¹å™¨å†…éƒ¨</span></span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>åŸç†</p>
</blockquote>
<p>1ã€æˆ‘ä»¬æ¯å¯åŠ¨ä¸€ä¸ªdockerå®¹å™¨ï¼Œdockerå°±ä¼šç»™dockerå®¹å™¨åˆ†é…ä¸€ä¸ªipï¼Œæˆ‘ä»¬åªè¦è£…äº†dockerï¼Œå°±ä¼šæœ‰ä¸€ä¸ªdocker01ç½‘å¡ã€‚</p>
<p>æ¡¥æ¥æ¨¡å¼ï¼Œä½¿ç”¨çš„æŠ€æœ¯æ˜¯veth-pairæŠ€æœ¯ï¼</p>
<p>å†æ¬¡æµ‹è¯• ip addrï¼Œå‘ç°å¤šäº†ä¸€å¯¹ç½‘å¡ :</p>
<p><img src="/2022/06/09/uncatalog/cl46zffyz00127or72j1r80ti/image-20200613224311838.png" alt="image-20200613224311838"></p>
<p>2ã€å†å¯åŠ¨ä¸€ä¸ªå®¹å™¨æµ‹è¯•ï¼Œå‘ç°åˆå¤šäº†ä¸€å¯¹ç½‘å¡ï¼ï¼ï¼</p>
<p><img src="/2022/06/09/uncatalog/cl46zffyz00127or72j1r80ti/image-20200613224610781.png" alt="image-20200613224610781"></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æˆ‘ä»¬å‘ç°è¿™ä¸ªå®¹å™¨å¸¦æ¥ç½‘å¡ï¼Œéƒ½æ˜¯ä¸€å¯¹å¯¹çš„</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> veth-pair å°±æ˜¯ä¸€å¯¹çš„è™šæ‹Ÿè®¾å¤‡æ¥å£ï¼Œä»–ä»¬éƒ½æ˜¯æˆå¯¹å‡ºç°çš„ï¼Œä¸€æ®µè¿ç€åè®®ï¼Œä¸€æ®µå½¼æ­¤ç›¸è¿</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ­£å› ä¸ºæœ‰è¿™ä¸ªç‰¹æ€§ï¼Œveth-pair å……å½“ä¸€ä¸ªæ¡¥æ¢ï¼Œè¿æ¥å„ç§è™šæ‹Ÿç½‘ç»œè®¾å¤‡</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> OpenStackï¼ŒDockerå®¹å™¨ä¹‹é—´çš„è¿æ¥ï¼ŒOVSçš„è¿æ¥éƒ½æ˜¯ä½¿ç”¨veth-pairæŠ€æœ¯</span></span><br></pre></td></tr></table></figure></div>

<p>3ã€æˆ‘ä»¬æ¥æµ‹è¯•ä¸‹tomcat01å’Œtomcat02æ˜¯å¦å¯ä»¥pingé€šï¼</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">[root@localhost /]# docker exec -it tomcat02 ping 172.17.0.2</span><br><span class="line">PING 172.17.0.2 (172.17.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=1 ttl=64 time=0.556 ms</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=2 ttl=64 time=0.096 ms</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=3 ttl=64 time=0.111 ms</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ç»“è®ºï¼šå®¹å™¨ä¸å®¹å™¨ä¹‹é—´æ˜¯å¯ä»¥ç›¸äº’pingé€šçš„ï¼ï¼ï¼</span></span><br></pre></td></tr></table></figure></div>

<p><strong>ç»˜åˆ¶ä¸€ä¸ªç½‘ç»œæ¨¡å‹å›¾ï¼š</strong></p>
<p><img src="/2022/06/09/uncatalog/cl46zffyz00127or72j1r80ti/image-20200613231046553.png" alt="image-20200613231046553"></p>
<p><strong>ç»“è®ºï¼štomcat01 å’Œ tomcat02 æ˜¯å…¬ç”¨ä¸€ä¸ªè·¯ç”±å™¨ï¼Œå³ docker0 !</strong></p>
<p>æ‰€æœ‰çš„å®¹å™¨ä¸æŒ‡å®šç½‘ç»œçš„æƒ…å†µä¸‹ï¼Œéƒ½æ˜¯ç» docker0 è·¯ç”±çš„ï¼Œdocker ä¼šç»™æˆ‘ä»¬çš„å®¹å™¨åˆ†é…ä¸€ä¸ªé»˜è®¤çš„å¯ç”¨ip</p>
<blockquote>
<p>å°ç»“</p>
</blockquote>
<p>Dockerä½¿ç”¨çš„æ˜¯Linuxçš„æ¡¥æ¥æŠ€æœ¯ï¼Œå®¿ä¸»æœºæ˜¯ä¸€ä¸ªDockerå®¹å™¨çš„ç½‘æ¡¥ docker0</p>
<p><img src="/2022/06/09/uncatalog/cl46zffyz00127or72j1r80ti/image-20200613232031835.png" alt="image-20200613232031835"></p>
<p><strong>æ³¨æ„ï¼š</strong>Dockerä¸­æ‰€æœ‰ç½‘ç»œæ¥å£éƒ½æ˜¯è™šæ‹Ÿçš„ï¼Œè™šæ‹Ÿçš„è½¬å‘æ•ˆç‡é«˜ï¼ï¼ˆå†…ç½‘ä¼ é€’æ–‡ä»¶ï¼‰</p>
<p>åªè¦å®¹å™¨ä¸€åˆ é™¤ï¼Œå¯¹åº”çš„ä¸€å¯¹ç½‘æ¡¥å°±æ²¡æœ‰ï¼</p>
<h2 id="â€“link"><a href="#â€“link" class="headerlink" title="â€“link"></a>â€“link</h2><blockquote>
<p>æ€è€ƒä¸€ä¸ªåœºæ™¯ï¼šæˆ‘ä»¬ç¼–å†™äº†ä¸€ä¸ªå¾®æœåŠ¡ï¼Œdatabase url = ip ï¼Œé¡¹ç›®ä¸é‡å¯ï¼Œæ•°æ®åº“ipæ¢æ‰äº†ï¼Œæˆ‘ä»¬å¸Œæœ›å¯ä»¥å¤„ç†è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥é€šè¿‡åå­—æ¥è®¿é—®å®¹å™¨ï¼Ÿ</p>
</blockquote>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> tomcat02 æƒ³é€šè¿‡ç›´æ¥ping å®¹å™¨åï¼ˆå³<span class="string">&quot;tomcat01&quot;</span>ï¼‰æ¥pingé€šï¼Œè€Œä¸æ˜¯ipï¼Œå‘ç°å¤±è´¥äº†ï¼</span></span><br><span class="line">[root@localhost /]# docker exec -it tomcat02 ping tomcat01</span><br><span class="line">ping: tomcat01: Name or service not known</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> é€šè¿‡--link å°±å¯ä»¥è§£å†³è¿™ä¸ªç½‘ç»œè”é€šé—®é¢˜äº†ï¼ï¼ï¼      å‘ç°æ–°å»ºçš„tomcat03å¯ä»¥pingé€štomcat02</span></span><br><span class="line">[root@localhost /]# docker run -d -P --name tomcat03 --link tomcat02 tomcat</span><br><span class="line">87a0e5f5e6da34a7f043ff6210b57f92f40b24d0d4558462e7746b2e19902721</span><br><span class="line">[root@localhost /]# docker exec -it tomcat03 ping tomcat02</span><br><span class="line">PING tomcat02 (172.17.0.3) 56(84) bytes of data.</span><br><span class="line">64 bytes from tomcat02 (172.17.0.3): icmp_seq=1 ttl=64 time=0.132 ms</span><br><span class="line">64 bytes from tomcat02 (172.17.0.3): icmp_seq=2 ttl=64 time=0.116 ms</span><br><span class="line">64 bytes from tomcat02 (172.17.0.3): icmp_seq=3 ttl=64 time=0.116 ms</span><br><span class="line">64 bytes from tomcat02 (172.17.0.3): icmp_seq=4 ttl=64 time=0.116 ms</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> åå‘èƒ½pingé€šå—ï¼Ÿ       å‘ç°tomcat02ä¸èƒ½oingé€štomcat03</span></span><br><span class="line">[root@localhost /]# docker exec -it tomcat02 ping tomcat03</span><br><span class="line">ping: tomcat03: Name or service not known</span><br></pre></td></tr></table></figure></div>

<p>æ¢ç©¶ï¼šinspect  ï¼ï¼ï¼</p>
<p><img src="/2022/06/09/uncatalog/cl46zffyz00127or72j1r80ti/image-20200614002609300.png" alt="image-20200614002609300"></p>
<p><img src="/2022/06/09/uncatalog/cl46zffyz00127or72j1r80ti/image-20200614002832045.png" alt="image-20200614002832045"></p>
<p>å…¶å®è¿™ä¸ªtomcat03å°±æ˜¯åœ¨æœ¬åœ°é…ç½®äº†åˆ°tomcat02çš„æ˜ å°„ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹hosts é…ç½®ï¼Œåœ¨è¿™é‡Œå‘ç°åŸç†ï¼</span>  </span><br><span class="line">[root@localhost /]# docker exec -it tomcat03 cat /etc/hosts</span><br><span class="line">127.0.0.1	localhost</span><br><span class="line">::1	localhost ip6-localhost ip6-loopback</span><br><span class="line">fe00::0	ip6-localnet</span><br><span class="line">ff00::0	ip6-mcastprefix</span><br><span class="line">ff02::1	ip6-allnodes</span><br><span class="line">ff02::2	ip6-allrouters</span><br><span class="line">172.17.0.3	tomcat02 95303c12f6d9    # å°±åƒwindowsä¸­çš„ host æ–‡ä»¶ä¸€æ ·ï¼Œåšäº†åœ°å€ç»‘å®š</span><br><span class="line">172.17.0.4	87a0e5f5e6da</span><br></pre></td></tr></table></figure></div>

<p>æœ¬è´¨æ¢ç©¶ï¼šâ€“link  å°±æ˜¯æˆ‘ä»¬åœ¨hosts é…ç½®ä¸­å¢åŠ äº†ä¸€ä¸ª 172.17.0.3    tomcat02   95303c12f6d9 ï¼ˆä¸‰æ¡ä¿¡æ¯éƒ½æ˜¯tomcat02 çš„ï¼‰</p>
<p>æˆ‘ä»¬ç°åœ¨ç©Dockerå·²ç»ä¸å»ºè®®ä½¿ç”¨ â€“link äº†ï¼ï¼ï¼</p>
<p><strong>è‡ªå®šä¹‰ç½‘ç»œï¼Œä¸ä½¿ç”¨docker0ï¼</strong></p>
<p>docker0é—®é¢˜ï¼šä¸æ”¯æŒå®¹å™¨åè¿æ¥è®¿é—®ï¼</p>
<h2 id="è‡ªå®šä¹‰ç½‘ç»œ"><a href="#è‡ªå®šä¹‰ç½‘ç»œ" class="headerlink" title="è‡ªå®šä¹‰ç½‘ç»œ"></a>è‡ªå®šä¹‰ç½‘ç»œ</h2><blockquote>
<p>æŸ¥çœ‹æ‰€æœ‰çš„dockerç½‘ç»œ</p>
</blockquote>
<p>â€˜<img src="/2022/06/09/uncatalog/cl46zffyz00127or72j1r80ti/image-20200614004445923.png" alt="image-20200614004445923"></p>
<p><strong>ç½‘ç»œæ¨¡å¼</strong></p>
<p>bridge  ï¼šæ¡¥æ¥ ï¼ˆdockeré»˜è®¤ï¼Œè‡ªå·±åˆ›å»ºä¹Ÿä½¿ç”¨bridgeæ¨¡å¼ï¼ï¼‰</p>
<p>none ï¼šä¸é…ç½®ç½‘ç»œ</p>
<p>host  ï¼šå’Œå®¿ä¸»æœºå…±äº«ç½‘ç»œ</p>
<p>container  ï¼šå®¹å™¨ç½‘ç»œè¿é€šï¼Œå®¹å™¨ç›´æ¥äº’è”ï¼ï¼ˆç”¨çš„å°‘ï¼å±€é™å¾ˆå¤§ï¼ï¼‰</p>
<p><strong>æµ‹è¯•</strong></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æˆ‘ä»¬ä¹‹å‰ç›´æ¥å¯åŠ¨çš„å‘½ä»¤ (é»˜è®¤æ˜¯ä½¿ç”¨--net bridgeï¼Œå¯çœ)ï¼Œè¿™ä¸ªbridgeå°±æ˜¯æˆ‘ä»¬çš„docker0</span> </span><br><span class="line">docker run -d -P --name tomcat01 tomcat   </span><br><span class="line">docker run -d -P --name tomcat01 --net bridge tomcat</span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¸Šé¢ä¸¤å¥ç­‰ä»·</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> docker0ï¼ˆå³bridgeï¼‰é»˜è®¤ä¸æ”¯æŒåŸŸåè®¿é—® ï¼ --linkå¯ä»¥æ‰“é€šè¿æ¥ï¼Œå³æ”¯æŒåŸŸåè®¿é—®ï¼</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªç½‘ç»œï¼</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> --driver bridge    		ç½‘ç»œæ¨¡å¼å®šä¹‰ä¸º ï¼šæ¡¥æ¥</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> --subnet 192.168.0.0/16	å®šä¹‰å­ç½‘ ï¼ŒèŒƒå›´ä¸ºï¼š192.168.0.2 ~ 192.168.255.255</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> --gateway 192.168.0.1		å­ç½‘ç½‘å…³è®¾ä¸ºï¼š 192.168.0.1</span> </span><br><span class="line">[root@localhost /]# docker network create --driver bridge --subnet 192.168.0.0/16 --gateway 192.168.0.1 mynet</span><br><span class="line">7ee3adf259c8c3d86fce6fd2c2c9f85df94e6e57c2dce5449e69a5b024efc28c</span><br><span class="line">[root@localhost /]# docker network ls</span><br><span class="line">NETWORK ID          NAME                DRIVER              SCOPE</span><br><span class="line">461bf576946c        bridge              bridge              local</span><br><span class="line">c501704cf28e        host                host                local</span><br><span class="line">7ee3adf259c8        mynet               bridge              local  	#è‡ªå®šä¹‰çš„ç½‘ç»œ</span><br><span class="line">9354fbcc160f        none                null                local</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p><strong>è‡ªå·±çš„ç½‘ç»œå°±åˆ›å»ºå¥½äº†ï¼š</strong></p>
<p><img src="/2022/06/09/uncatalog/cl46zffyz00127or72j1r80ti/image-20200614011229854.png" alt="image-20200614011229854"></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">[root@localhost /]# docker run -d -P --name tomcat-net-01 --net mynet tomcat</span><br><span class="line">b168a37d31fcdc2ff172fd969e4de6de731adf53a2960eeae3dd9c24e14fac67</span><br><span class="line">[root@localhost /]# docker run -d -P --name tomcat-net-02 --net mynet tomcat</span><br><span class="line">c07d634e17152ca27e318c6fcf6c02e937e6d5e7a1631676a39166049a44c03c</span><br><span class="line">[root@localhost /]# docker network inspect mynet</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Name&quot;: &quot;mynet&quot;,</span><br><span class="line">        &quot;Id&quot;: &quot;7ee3adf259c8c3d86fce6fd2c2c9f85df94e6e57c2dce5449e69a5b024efc28c&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2020-06-14T01:03:53.767960765+08:00&quot;,</span><br><span class="line">        &quot;Scope&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;bridge&quot;,</span><br><span class="line">        &quot;EnableIPv6&quot;: false,</span><br><span class="line">        &quot;IPAM&quot;: &#123;</span><br><span class="line">            &quot;Driver&quot;: &quot;default&quot;,</span><br><span class="line">            &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">            &quot;Config&quot;: [</span><br><span class="line">                &#123;</span><br><span class="line">                    &quot;Subnet&quot;: &quot;192.168.0.0/16&quot;,</span><br><span class="line">                    &quot;Gateway&quot;: &quot;192.168.0.1&quot;</span><br><span class="line">                &#125;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Internal&quot;: false,</span><br><span class="line">        &quot;Attachable&quot;: false,</span><br><span class="line">        &quot;Ingress&quot;: false,</span><br><span class="line">        &quot;ConfigFrom&quot;: &#123;</span><br><span class="line">            &quot;Network&quot;: &quot;&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;ConfigOnly&quot;: false,</span><br><span class="line">        &quot;Containers&quot;: &#123;</span><br><span class="line">            &quot;b168a37d31fcdc2ff172fd969e4de6de731adf53a2960eeae3dd9c24e14fac67&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;tomcat-net-01&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;f0af1c33fc5d47031650d07d5bc769e0333da0989f73f4503140151d0e13f789&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:c0:a8:00:02&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;192.168.0.2/16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;c07d634e17152ca27e318c6fcf6c02e937e6d5e7a1631676a39166049a44c03c&quot;: &#123;</span><br><span class="line">                &quot;Name&quot;: &quot;tomcat-net-02&quot;,</span><br><span class="line">                &quot;EndpointID&quot;: &quot;ba114b9bd5f3b75983097aa82f71678653619733efc1835db857b3862e744fbc&quot;,</span><br><span class="line">                &quot;MacAddress&quot;: &quot;02:42:c0:a8:00:03&quot;,</span><br><span class="line">                &quot;IPv4Address&quot;: &quot;192.168.0.3/16&quot;,</span><br><span class="line">                &quot;IPv6Address&quot;: &quot;&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Options&quot;: &#123;&#125;,</span><br><span class="line">        &quot;Labels&quot;: &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å†æ¬¡æµ‹è¯• ping è¿æ¥</span></span><br><span class="line">[root@localhost /]# docker exec -it tomcat-net-01 ping 192.168.0.3</span><br><span class="line">PING 192.168.0.3 (192.168.0.3) 56(84) bytes of data.</span><br><span class="line">64 bytes from 192.168.0.3: icmp_seq=1 ttl=64 time=0.199 ms</span><br><span class="line">64 bytes from 192.168.0.3: icmp_seq=2 ttl=64 time=0.121 ms</span><br><span class="line">^C</span><br><span class="line">--- 192.168.0.3 ping statistics ---</span><br><span class="line">2 packets transmitted, 2 received, 0% packet loss, time 2ms</span><br><span class="line">rtt min/avg/max/mdev = 0.121/0.160/0.199/0.039 ms</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ç°åœ¨ä¸ä½¿ç”¨ --link,ä¹Ÿå¯ä»¥ping åå­—äº†ï¼ï¼ï¼ï¼ï¼ï¼</span></span><br><span class="line">[root@localhost /]# docker exec -it tomcat-net-01 ping tomcat-net-02</span><br><span class="line">PING tomcat-net-02 (192.168.0.3) 56(84) bytes of data.</span><br><span class="line">64 bytes from tomcat-net-02.mynet (192.168.0.3): icmp_seq=1 ttl=64 time=0.145 ms</span><br><span class="line">64 bytes from tomcat-net-02.mynet (192.168.0.3): icmp_seq=2 ttl=64 time=0.117 ms</span><br><span class="line">^C</span><br><span class="line">--- tomcat-net-02 ping statistics ---</span><br><span class="line">2 packets transmitted, 2 received, 0% packet loss, time 3ms</span><br><span class="line">rtt min/avg/max/mdev = 0.117/0.131/0.145/0.014 ms</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>æˆ‘ä»¬åœ¨ä½¿ç”¨è‡ªå®šä¹‰çš„ç½‘ç»œæ—¶ï¼Œdockeréƒ½å·²ç»å¸®æˆ‘ä»¬ç»´æŠ¤å¥½äº†å¯¹åº”å…³ç³»ï¼Œæ¨èæˆ‘ä»¬å¹³æ—¶è¿™æ ·ä½¿ç”¨ç½‘ç»œï¼ï¼ï¼</p>
<p>å¥½å¤„ï¼š</p>
<p>redisâ€”â€”ä¸åŒçš„é›†ç¾¤ä½¿ç”¨ä¸åŒçš„ç½‘ç»œï¼Œä¿è¯äº†é›†ç¾¤çš„å®‰å…¨å’Œå¥åº·</p>
<p>mysqlâ€”â€”ä¸åŒçš„é›†ç¾¤ä½¿ç”¨ä¸åŒçš„ç½‘ç»œï¼Œä¿è¯äº†é›†ç¾¤çš„å®‰å…¨å’Œå¥åº·</p>
<p><img src="/2022/06/09/uncatalog/cl46zffyz00127or72j1r80ti/image-20200614015209053.png" alt="image-20200614015209053"></p>
<h2 id="ç½‘ç»œè¿é€š"><a href="#ç½‘ç»œè¿é€š" class="headerlink" title="ç½‘ç»œè¿é€š"></a>ç½‘ç»œè¿é€š</h2><p><img src="/2022/06/09/uncatalog/cl46zffyz00127or72j1r80ti/image-20200614013625192.png" alt="image-20200614013625192"></p>
<p><img src="/2022/06/09/uncatalog/cl46zffyz00127or72j1r80ti/image-20200614013801842.png" alt="image-20200614013801842"></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æµ‹è¯•æ‰“é€š tomcat01 â€” mynet</span></span><br><span class="line">[root@localhost /]# docker network connect mynet tomcat01</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> è¿é€šä¹‹åå°±æ˜¯å°† tomcat01 æ”¾åˆ°äº† mynet ç½‘ç»œä¸‹ï¼ ï¼ˆè§ä¸‹å›¾ï¼‰</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> è¿™å°±äº§ç”Ÿäº† ä¸€ä¸ªå®¹å™¨æœ‰ä¸¤ä¸ªipåœ°å€ ! å‚è€ƒé˜¿é‡Œäº‘çš„å…¬æœ‰ipå’Œç§æœ‰ip</span></span><br><span class="line">[root@localhost /]# docker network inspect mynet</span><br></pre></td></tr></table></figure></div>

<p><img src="/2022/06/09/uncatalog/cl46zffyz00127or72j1r80ti/image-20200614014544797.png" alt="image-20200614014544797"></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> tomcat01 è¿é€šok</span></span><br><span class="line">[root@localhost /]# docker exec -it tomcat01 ping tomcat-net-01</span><br><span class="line">PING tomcat-net-01 (192.168.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from tomcat-net-01.mynet (192.168.0.2): icmp_seq=1 ttl=64 time=0.124 ms</span><br><span class="line">64 bytes from tomcat-net-01.mynet (192.168.0.2): icmp_seq=2 ttl=64 time=0.162 ms</span><br><span class="line">64 bytes from tomcat-net-01.mynet (192.168.0.2): icmp_seq=3 ttl=64 time=0.107 ms</span><br><span class="line">^C</span><br><span class="line">--- tomcat-net-01 ping statistics ---</span><br><span class="line">3 packets transmitted, 3 received, 0% packet loss, time 3ms</span><br><span class="line">rtt min/avg/max/mdev = 0.107/0.131/0.162/0.023 ms</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> tomcat02 æ˜¯ä¾æ—§æ‰“ä¸é€šçš„</span></span><br><span class="line">[root@localhost /]# docker exec -it tomcat02 ping tomcat-net-01</span><br><span class="line">ping: tomcat-net-01: Name or service not known</span><br></pre></td></tr></table></figure></div>

<p><strong>ç»“è®ºï¼š</strong>å‡è®¾è¦è·¨ç½‘ç»œæ“ä½œåˆ«äººï¼Œå°±éœ€è¦ä½¿ç”¨docker network connect  è¿é€šã€‚ã€‚ã€‚</p>
<h2 id="å®æˆ˜ï¼šéƒ¨ç½²Redisé›†ç¾¤"><a href="#å®æˆ˜ï¼šéƒ¨ç½²Redisé›†ç¾¤" class="headerlink" title="å®æˆ˜ï¼šéƒ¨ç½²Redisé›†ç¾¤"></a>å®æˆ˜ï¼šéƒ¨ç½²Redisé›†ç¾¤</h2><p><img src="/2022/06/09/uncatalog/cl46zffyz00127or72j1r80ti/image-20200614124559172.png" alt="image-20200614124559172"></p>
<p>å¯åŠ¨6ä¸ªrediså®¹å™¨ï¼Œä¸Šé¢ä¸‰ä¸ªæ˜¯ä¸»ï¼Œä¸‹é¢ä¸‰ä¸ªæ˜¯å¤‡ï¼</p>
<p>ä½¿ç”¨shellè„šæœ¬å¯åŠ¨ï¼</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åˆ›å»ºredisé›†ç¾¤ç½‘ç»œ</span></span><br><span class="line">docker network create redis --subnet 172.38.0.0/16</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> é€šè¿‡è„šæœ¬åˆ›å»ºå…­ä¸ªredisé…ç½®</span></span><br><span class="line">[root@localhost /]# for port in $(seq 1 6);\</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> <span class="keyword">do</span> \</span></span><br><span class="line"><span class="bash">&gt; mkdir -p /mydata/redis/node-<span class="variable">$&#123;port&#125;</span>/conf</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> touch /mydata/redis/node-<span class="variable">$&#123;port&#125;</span>/conf/redis.conf</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> cat &lt;&lt;<span class="string">EOF&gt;&gt;/mydata/redis/node-$&#123;port&#125;/conf/redis.conf</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> port 6379</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> <span class="built_in">bind</span> 0.0.0.0</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> cluster-enabled yes</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> cluster-config-file nodes.conf</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> cluster-node-timeout 5000</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> cluster-announce-ip 172.38.0.1<span class="variable">$&#123;port&#125;</span></span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> cluster-announce-port 6379</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> cluster-announce-bus-port 16379</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> appendonly yes</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> EOF</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> <span class="keyword">done</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹åˆ›å»ºçš„å…­ä¸ªredis</span></span><br><span class="line">[root@localhost /]# cd /mydata/</span><br><span class="line">[root@localhost mydata]# \ls</span><br><span class="line">redis</span><br><span class="line">[root@localhost mydata]# cd redis/</span><br><span class="line">[root@localhost redis]# ls</span><br><span class="line">node-1  node-2  node-3  node-4  node-5  node-6</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹redis-1çš„é…ç½®ä¿¡æ¯</span></span><br><span class="line">[root@localhost redis]# cd node-1</span><br><span class="line">[root@localhost node-1]# ls</span><br><span class="line">conf</span><br><span class="line">[root@localhost node-1]# cd conf/</span><br><span class="line">[root@localhost conf]# ls</span><br><span class="line">redis.conf</span><br><span class="line">[root@localhost conf]# cat redis.conf </span><br><span class="line">port 6379</span><br><span class="line">bind 0.0.0.0</span><br><span class="line">cluster-enabled yes</span><br><span class="line">cluster-config-file nodes.conf</span><br><span class="line">cluster-node-timeout 5000</span><br><span class="line">cluster-announce-ip 172.38.0.11</span><br><span class="line">cluster-announce-port 6379</span><br><span class="line">cluster-announce-bus-port 16379</span><br><span class="line">appendonly yes</span><br></pre></td></tr></table></figure></div>



<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">docker run -p 6371:6379 -p 16371:16379 --name redis-1 \</span><br><span class="line">-v /mydata/redis/node-1/data:/data \</span><br><span class="line">-v /mydata/redis/node-1/conf/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">-d --net redis --ip 172.38.0.11 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf</span><br><span class="line"></span><br><span class="line">docker run -p 6372:6379 -p 16372:16379 --name redis-2 \</span><br><span class="line">-v /mydata/redis/node-2/data:/data \</span><br><span class="line">-v /mydata/redis/node-2/conf/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">-d --net redis --ip 172.38.0.12 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf</span><br><span class="line"></span><br><span class="line">docker run -p 6373:6379 -p 16373:16379 --name redis-3 \</span><br><span class="line">-v /mydata/redis/node-3/data:/data \</span><br><span class="line">-v /mydata/redis/node-3/conf/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">-d --net redis --ip 172.38.0.13 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf</span><br><span class="line"></span><br><span class="line">docker run -p 6374:6379 -p 16374:16379 --name redis-4 \</span><br><span class="line">-v /mydata/redis/node-4/data:/data \</span><br><span class="line">-v /mydata/redis/node-4/conf/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">-d --net redis --ip 172.38.0.14 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf</span><br><span class="line"></span><br><span class="line">docker run -p 6375:6379 -p 16375:16379 --name redis-5 \</span><br><span class="line">-v /mydata/redis/node-5/data:/data \</span><br><span class="line">-v /mydata/redis/node-5/conf/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">-d --net redis --ip 172.38.0.15 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf</span><br><span class="line"></span><br><span class="line">docker run -p 6376:6379 -p 16376:16379 --name redis-6 \</span><br><span class="line">-v /mydata/redis/node-6/data:/data \</span><br><span class="line">-v /mydata/redis/node-6/conf/redis.conf:/etc/redis/redis.conf \</span><br><span class="line">-d --net redis --ip 172.38.0.16 redis:5.0.9-alpine3.11 redis-server /etc/redis/redis.conf</span><br></pre></td></tr></table></figure></div>

<p><img src="/2022/06/09/uncatalog/cl46zffyz00127or72j1r80ti/image-20200614133829277.png" alt="image-20200614133829277"></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">[root@localhost conf]# docker exec -it redis-1 /bin/sh</span><br><span class="line">/data # ls</span><br><span class="line">appendonly.aof  nodes.conf</span><br><span class="line">/data # redis-cli --cluster create 172.38.0.11:6379 172.38.0.12:6379 172.38.0.13:6379 172.38.0.14:6379 172.38.0.15:6379 172.38.0.16:6379 --cluster-replicas 1</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; Performing <span class="built_in">hash</span> slots allocation on 6 nodes...</span></span><br><span class="line">Master[0] -&gt; Slots 0 - 5460</span><br><span class="line">Master[1] -&gt; Slots 5461 - 10922</span><br><span class="line">Master[2] -&gt; Slots 10923 - 16383</span><br><span class="line">Adding replica 172.38.0.15:6379 to 172.38.0.11:6379</span><br><span class="line">Adding replica 172.38.0.16:6379 to 172.38.0.12:6379</span><br><span class="line">Adding replica 172.38.0.14:6379 to 172.38.0.13:6379</span><br><span class="line">M: c5551e2a30c220fc9de9df2e34692f20f3382b32 172.38.0.11:6379</span><br><span class="line">   slots:[0-5460] (5461 slots) master</span><br><span class="line">M: d12ebd8c9e12dbbe22e7b9b18f0f143bdc14e94b 172.38.0.12:6379</span><br><span class="line">   slots:[5461-10922] (5462 slots) master</span><br><span class="line">M: 825146ce6ab80fbb46ec43fcfec1c6e2dac55157 172.38.0.13:6379</span><br><span class="line">   slots:[10923-16383] (5461 slots) master</span><br><span class="line">S: 9f810c0e15ac99af68e114a0ee4e32c4c7067e2b 172.38.0.14:6379</span><br><span class="line">   replicates 825146ce6ab80fbb46ec43fcfec1c6e2dac55157</span><br><span class="line">S: e370225bf57d6ef6d54ad8e3d5d745a52b382d1a 172.38.0.15:6379</span><br><span class="line">   replicates c5551e2a30c220fc9de9df2e34692f20f3382b32</span><br><span class="line">S: 79428c1d018dd29cf191678658008cbe5100b714 172.38.0.16:6379</span><br><span class="line">   replicates d12ebd8c9e12dbbe22e7b9b18f0f143bdc14e94b</span><br><span class="line">Can I set the above configuration? (type &#x27;yes&#x27; to accept): yes</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; Nodes configuration updated</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; Assign a different config epoch to each node</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; Sending CLUSTER MEET messages to join the cluster</span></span><br><span class="line">Waiting for the cluster to join</span><br><span class="line">....</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; Performing Cluster Check (using node 172.38.0.11:6379)</span></span><br><span class="line">M: c5551e2a30c220fc9de9df2e34692f20f3382b32 172.38.0.11:6379</span><br><span class="line">   slots:[0-5460] (5461 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: 79428c1d018dd29cf191678658008cbe5100b714 172.38.0.16:6379</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates d12ebd8c9e12dbbe22e7b9b18f0f143bdc14e94b</span><br><span class="line">M: d12ebd8c9e12dbbe22e7b9b18f0f143bdc14e94b 172.38.0.12:6379</span><br><span class="line">   slots:[5461-10922] (5462 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">S: e370225bf57d6ef6d54ad8e3d5d745a52b382d1a 172.38.0.15:6379</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates c5551e2a30c220fc9de9df2e34692f20f3382b32</span><br><span class="line">S: 9f810c0e15ac99af68e114a0ee4e32c4c7067e2b 172.38.0.14:6379</span><br><span class="line">   slots: (0 slots) slave</span><br><span class="line">   replicates 825146ce6ab80fbb46ec43fcfec1c6e2dac55157</span><br><span class="line">M: 825146ce6ab80fbb46ec43fcfec1c6e2dac55157 172.38.0.13:6379</span><br><span class="line">   slots:[10923-16383] (5461 slots) master</span><br><span class="line">   1 additional replica(s)</span><br><span class="line">[OK] All nodes agree about slots configuration.</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; Check <span class="keyword">for</span> open slots...</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; Check slots coverage...</span></span><br><span class="line">[OK] All 16384 slots covered.</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>dockeræ­å»ºredisé›†ç¾¤å®Œæˆï¼</p>
<p><img src="/2022/06/09/uncatalog/cl46zffyz00127or72j1r80ti/image-20200614141549867.png" alt="image-20200614141549867"></p>
<p>æˆ‘ä»¬ä½¿ç”¨dockerä¹‹åï¼Œæ‰€æœ‰çš„æŠ€æœ¯éƒ½ä¼šæ…¢æ…¢å˜å¾—ç®€å•èµ·æ¥ï¼</p>
<hr>
<h1 id="Springbootå¾®æœåŠ¡æ‰“åŒ…Dockeré•œåƒ"><a href="#Springbootå¾®æœåŠ¡æ‰“åŒ…Dockeré•œåƒ" class="headerlink" title="Springbootå¾®æœåŠ¡æ‰“åŒ…Dockeré•œåƒ"></a>Springbootå¾®æœåŠ¡æ‰“åŒ…Dockeré•œåƒ</h1><p>1ã€æ„å»ºspringbooté¡¹ç›®ï¼Œæ‰“åŒ…åº”ç”¨</p>
<p><img src="/2022/06/09/uncatalog/cl46zffyz00127or72j1r80ti/image-20200614155721369.png" alt="image-20200614155721369"></p>
<p>2ã€ç¼–å†™Dockerfileï¼Œè¿åŒé¡¹ç›®çš„jaråŒ…ä¸€å¹¶ä¸Šä¼ æŒ‡å®šç›®å½•ä¸‹</p>
<p><img src="/2022/06/09/uncatalog/cl46zffyz00127or72j1r80ti/image-20200614153734161.png" alt="image-20200614153734161"></p>
<p><img src="/2022/06/09/uncatalog/cl46zffyz00127or72j1r80ti/image-20200614154114656.png" alt="image-20200614154114656"></p>
<p>3ã€æ„å»ºé•œåƒ</p>
<p><img src="/2022/06/09/uncatalog/cl46zffyz00127or72j1r80ti/image-20200614154355597.png" alt="image-20200614154355597"></p>
<p>4ã€åˆ›å»ºé¡¹ç›®å®¹å™¨ï¼Œå‘å¸ƒè¿è¡Œï¼ï¼ï¼</p>
<p><img src="/2022/06/09/uncatalog/cl46zffyz00127or72j1r80ti/image-20200614155034087.png" alt="image-20200614155034087"></p>
<p><img src="/2022/06/09/uncatalog/cl46zffyz00127or72j1r80ti/image-20200614155340519.png" alt="image-20200614155340519"></p>
<p>ä»¥åæˆ‘ä»¬ä½¿ç”¨äº†Dockerä¹‹åï¼Œç»™åˆ«äººäº¤ä»˜å°±æ˜¯ä¸€ä¸ªé•œåƒå³å¯ï¼</p>
]]></content>
      <tags>
        <tag>äº‘åŸç”ŸåŸºç¡€ç³»åˆ—</tag>
        <tag>Docker</tag>
      </tags>
  </entry>
  <entry>
    <title>äº‘åŸç”ŸåŸºç¡€ç³»åˆ—ä¹‹Kubernetes(äºŒ)é›†ç¾¤ç¯å¢ƒæ­å»º</title>
    <url>/2022/06/09/uncatalog/cl46zkqb400157or761km2b46/</url>
    <content><![CDATA[<hr>
<span id="more"></span>



<hr>
<h3 id="2-kubernetesé›†ç¾¤ç¯å¢ƒæ­å»º"><a href="#2-kubernetesé›†ç¾¤ç¯å¢ƒæ­å»º" class="headerlink" title="2. kubernetesé›†ç¾¤ç¯å¢ƒæ­å»º"></a>2. kubernetesé›†ç¾¤ç¯å¢ƒæ­å»º</h3><h4 id="2-1-å‰ç½®çŸ¥è¯†ç‚¹"><a href="#2-1-å‰ç½®çŸ¥è¯†ç‚¹" class="headerlink" title="2.1 å‰ç½®çŸ¥è¯†ç‚¹"></a>2.1 å‰ç½®çŸ¥è¯†ç‚¹</h4><p>ç›®å‰ç”Ÿäº§éƒ¨ç½²Kubernetes é›†ç¾¤ä¸»è¦æœ‰ä¸¤ç§æ–¹å¼ï¼š</p>
<p><strong>kubeadm</strong></p>
<p>Kubeadm æ˜¯ä¸€ä¸ªK8s éƒ¨ç½²å·¥å…·ï¼Œæä¾›kubeadm init å’Œkubeadm joinï¼Œç”¨äºå¿«é€Ÿéƒ¨ç½²Kubernetes é›†ç¾¤ã€‚</p>
<p>å®˜æ–¹åœ°å€ï¼š<a href="https://kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm/">https://kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm/</a></p>
<p><strong>äºŒè¿›åˆ¶åŒ…</strong></p>
<p>ä»github ä¸‹è½½å‘è¡Œç‰ˆçš„äºŒè¿›åˆ¶åŒ…ï¼Œæ‰‹åŠ¨éƒ¨ç½²æ¯ä¸ªç»„ä»¶ï¼Œç»„æˆKubernetes é›†ç¾¤ã€‚</p>
<p>Kubeadm é™ä½éƒ¨ç½²é—¨æ§›ï¼Œä½†å±è”½äº†å¾ˆå¤šç»†èŠ‚ï¼Œé‡åˆ°é—®é¢˜å¾ˆéš¾æ’æŸ¥ã€‚å¦‚æœæƒ³æ›´å®¹æ˜“å¯æ§ï¼Œæ¨èä½¿ç”¨äºŒè¿›åˆ¶åŒ…éƒ¨ç½²Kubernetes é›†ç¾¤ï¼Œè™½ç„¶æ‰‹åŠ¨éƒ¨ç½²éº»çƒ¦ç‚¹ï¼ŒæœŸé—´å¯ä»¥å­¦ä¹ å¾ˆå¤šå·¥ä½œåŸç†ï¼Œä¹Ÿåˆ©äºåæœŸç»´æŠ¤ã€‚</p>
<p><img src="/2022/06/09/uncatalog/cl46zkqb400157or761km2b46/image-20200404094800622.png" alt="image-20200404094800622"></p>
<h4 id="2-2-kubeadm-éƒ¨ç½²æ–¹å¼ä»‹ç»"><a href="#2-2-kubeadm-éƒ¨ç½²æ–¹å¼ä»‹ç»" class="headerlink" title="2.2 kubeadm éƒ¨ç½²æ–¹å¼ä»‹ç»"></a>2.2 kubeadm éƒ¨ç½²æ–¹å¼ä»‹ç»</h4><p>kubeadm æ˜¯å®˜æ–¹ç¤¾åŒºæ¨å‡ºçš„ä¸€ä¸ªç”¨äºå¿«é€Ÿéƒ¨ç½²kubernetes é›†ç¾¤çš„å·¥å…·ï¼Œè¿™ä¸ªå·¥å…·èƒ½é€šè¿‡ä¸¤æ¡æŒ‡ä»¤å®Œæˆä¸€ä¸ªkubernetes é›†ç¾¤çš„éƒ¨ç½²ï¼š</p>
<ul>
<li>åˆ›å»ºä¸€ä¸ªMaster èŠ‚ç‚¹kubeadm init</li>
<li>å°†Node èŠ‚ç‚¹åŠ å…¥åˆ°å½“å‰é›†ç¾¤ä¸­$ kubeadm join &lt;Master èŠ‚ç‚¹çš„IP å’Œç«¯å£&gt;</li>
</ul>
<h4 id="2-3-å®‰è£…è¦æ±‚"><a href="#2-3-å®‰è£…è¦æ±‚" class="headerlink" title="2.3 å®‰è£…è¦æ±‚"></a>2.3 å®‰è£…è¦æ±‚</h4><p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œéƒ¨ç½²Kubernetes é›†ç¾¤æœºå™¨éœ€è¦æ»¡è¶³ä»¥ä¸‹å‡ ä¸ªæ¡ä»¶ï¼š</p>
<ul>
<li>ä¸€å°æˆ–å¤šå°æœºå™¨ï¼Œæ“ä½œç³»ç»ŸCentOS7.x-86_x64</li>
<li>ç¡¬ä»¶é…ç½®ï¼š2GB æˆ–æ›´å¤šRAMï¼Œ2 ä¸ªCPU æˆ–æ›´å¤šCPUï¼Œç¡¬ç›˜30GB æˆ–æ›´å¤š</li>
<li>é›†ç¾¤ä¸­æ‰€æœ‰æœºå™¨ä¹‹é—´ç½‘ç»œäº’é€š</li>
<li>å¯ä»¥è®¿é—®å¤–ç½‘ï¼Œéœ€è¦æ‹‰å–é•œåƒ</li>
<li>ç¦æ­¢swap åˆ†åŒº</li>
</ul>
<h4 id="2-4-æœ€ç»ˆç›®æ ‡"><a href="#2-4-æœ€ç»ˆç›®æ ‡" class="headerlink" title="2.4 æœ€ç»ˆç›®æ ‡"></a>2.4 æœ€ç»ˆç›®æ ‡</h4><ul>
<li>åœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šå®‰è£…Docker å’Œkubeadm</li>
<li>éƒ¨ç½²Kubernetes Master</li>
<li>éƒ¨ç½²å®¹å™¨ç½‘ç»œæ’ä»¶</li>
<li>éƒ¨ç½²Kubernetes Nodeï¼Œå°†èŠ‚ç‚¹åŠ å…¥Kubernetes é›†ç¾¤ä¸­</li>
<li>éƒ¨ç½²Dashboard Web é¡µé¢ï¼Œå¯è§†åŒ–æŸ¥çœ‹Kubernetes èµ„æº</li>
</ul>
<h4 id="2-5-å‡†å¤‡ç¯å¢ƒ"><a href="#2-5-å‡†å¤‡ç¯å¢ƒ" class="headerlink" title="2.5 å‡†å¤‡ç¯å¢ƒ"></a>2.5 å‡†å¤‡ç¯å¢ƒ</h4><p><img src="/2022/06/09/uncatalog/cl46zkqb400157or761km2b46/image-20210609000002940.png" alt="image-20210609000002940"></p>
<table>
<thead>
<tr>
<th align="left">è§’è‰²</th>
<th align="left">IPåœ°å€</th>
<th align="left">ç»„ä»¶</th>
</tr>
</thead>
<tbody><tr>
<td align="left">master01</td>
<td align="left">192.168.5.3</td>
<td align="left">dockerï¼Œkubectlï¼Œkubeadmï¼Œkubelet</td>
</tr>
<tr>
<td align="left">node01</td>
<td align="left">192.168.5.4</td>
<td align="left">dockerï¼Œkubectlï¼Œkubeadmï¼Œkubelet</td>
</tr>
<tr>
<td align="left">node02</td>
<td align="left">192.168.5.5</td>
<td align="left">dockerï¼Œkubectlï¼Œkubeadmï¼Œkubelet</td>
</tr>
</tbody></table>
<h4 id="2-6-ç¯å¢ƒåˆå§‹åŒ–"><a href="#2-6-ç¯å¢ƒåˆå§‹åŒ–" class="headerlink" title="2.6 ç¯å¢ƒåˆå§‹åŒ–"></a>2.6 ç¯å¢ƒåˆå§‹åŒ–</h4><h5 id="2-6-1-æ£€æŸ¥æ“ä½œç³»ç»Ÿçš„ç‰ˆæœ¬"><a href="#2-6-1-æ£€æŸ¥æ“ä½œç³»ç»Ÿçš„ç‰ˆæœ¬" class="headerlink" title="2.6.1 æ£€æŸ¥æ“ä½œç³»ç»Ÿçš„ç‰ˆæœ¬"></a>2.6.1 æ£€æŸ¥æ“ä½œç³»ç»Ÿçš„ç‰ˆæœ¬</h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="POWERSHELL"><figure class="iseeu highlight /powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># æ­¤æ–¹å¼ä¸‹å®‰è£…kubernetesé›†ç¾¤è¦æ±‚Centosç‰ˆæœ¬è¦åœ¨7.5æˆ–ä¹‹ä¸Š</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">master</span> ~]<span class="comment"># cat /etc/redhat-release</span></span><br><span class="line">Centos Linux <span class="number">7.5</span>.<span class="number">1804</span> (Core)</span><br></pre></td></tr></table></figure></div>

<h5 id="2-6-2-ä¸»æœºåè§£æ"><a href="#2-6-2-ä¸»æœºåè§£æ" class="headerlink" title="2.6.2 ä¸»æœºåè§£æ"></a>2.6.2 ä¸»æœºåè§£æ</h5><p>ä¸ºäº†æ–¹ä¾¿é›†ç¾¤èŠ‚ç‚¹é—´çš„ç›´æ¥è°ƒç”¨ï¼Œåœ¨è¿™ä¸ªé…ç½®ä¸€ä¸‹ä¸»æœºåè§£æï¼Œä¼ä¸šä¸­æ¨èä½¿ç”¨å†…éƒ¨DNSæœåŠ¡å™¨</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="POWERSHELL"><figure class="iseeu highlight /powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä¸»æœºåæˆè§£æ ç¼–è¾‘ä¸‰å°æœåŠ¡å™¨çš„/etc/hostsæ–‡ä»¶ï¼Œæ·»åŠ ä¸‹é¢å†…å®¹</span></span><br><span class="line"><span class="number">192.168</span>.<span class="number">90.100</span> master</span><br><span class="line"><span class="number">192.168</span>.<span class="number">90.106</span> node1</span><br><span class="line"><span class="number">192.168</span>.<span class="number">90.107</span> node2</span><br></pre></td></tr></table></figure></div>

<h5 id="2-6-3-æ—¶é—´åŒæ­¥"><a href="#2-6-3-æ—¶é—´åŒæ­¥" class="headerlink" title="2.6.3 æ—¶é—´åŒæ­¥"></a>2.6.3 æ—¶é—´åŒæ­¥</h5><p>kubernetesè¦æ±‚é›†ç¾¤ä¸­çš„èŠ‚ç‚¹æ—¶é—´å¿…é¡»ç²¾ç¡®ä¸€ç›´ï¼Œè¿™é‡Œä½¿ç”¨chronydæœåŠ¡ä»ç½‘ç»œåŒæ­¥æ—¶é—´</p>
<p>ä¼ä¸šä¸­å»ºè®®é…ç½®å†…éƒ¨çš„ä¼šè§åŒæ­¥æœåŠ¡å™¨</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="POWERSHELL"><figure class="iseeu highlight /powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># å¯åŠ¨chronydæœåŠ¡</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">master</span> ~]<span class="comment"># systemctl start chronyd</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">master</span> ~]<span class="comment"># systemctl enable chronyd</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">master</span> ~]<span class="comment"># date</span></span><br></pre></td></tr></table></figure></div>

<h5 id="2-6-4-ç¦ç”¨iptableå’ŒfirewalldæœåŠ¡"><a href="#2-6-4-ç¦ç”¨iptableå’ŒfirewalldæœåŠ¡" class="headerlink" title="2.6.4  ç¦ç”¨iptableå’ŒfirewalldæœåŠ¡"></a>2.6.4  ç¦ç”¨iptableå’ŒfirewalldæœåŠ¡</h5><p>kuberneteså’Œdocker åœ¨è¿è¡Œçš„ä¸­ä¼šäº§ç”Ÿå¤§é‡çš„iptablesè§„åˆ™ï¼Œä¸ºäº†ä¸è®©ç³»ç»Ÿè§„åˆ™è·Ÿå®ƒä»¬æ··æ·†ï¼Œç›´æ¥å…³é—­ç³»ç»Ÿçš„è§„åˆ™</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="POWERSHELL"><figure class="iseeu highlight /powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1 å…³é—­firewalldæœåŠ¡</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">master</span> ~]<span class="comment"># systemctl stop firewalld</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">master</span> ~]<span class="comment"># systemctl disable firewalld</span></span><br><span class="line"><span class="comment"># 2 å…³é—­iptablesæœåŠ¡</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">master</span> ~]<span class="comment"># systemctl stop iptables</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">master</span> ~]<span class="comment"># systemctl disable iptables</span></span><br></pre></td></tr></table></figure></div>

<h5 id="2-6-5-ç¦ç”¨selinux"><a href="#2-6-5-ç¦ç”¨selinux" class="headerlink" title="2.6.5 ç¦ç”¨selinux"></a>2.6.5 ç¦ç”¨selinux</h5><p>selinuxæ˜¯linuxç³»ç»Ÿä¸‹çš„ä¸€ä¸ªå®‰å…¨æœåŠ¡ï¼Œå¦‚æœä¸å…³é—­å®ƒï¼Œåœ¨å®‰è£…é›†ç¾¤ä¸­ä¼šäº§ç”Ÿå„ç§å„æ ·çš„å¥‡è‘©é—®é¢˜</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="POWERSHELL"><figure class="iseeu highlight /powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç¼–è¾‘ /etc/selinux/config æ–‡ä»¶ï¼Œä¿®æ”¹SELINUXçš„å€¼ä¸ºdisable</span></span><br><span class="line"><span class="comment"># æ³¨æ„ä¿®æ”¹å®Œæ¯•ä¹‹åéœ€è¦é‡å¯linuxæœåŠ¡</span></span><br><span class="line">SELINUX=disabled</span><br></pre></td></tr></table></figure></div>

<h5 id="2-6-6-ç¦ç”¨swapåˆ†åŒº"><a href="#2-6-6-ç¦ç”¨swapåˆ†åŒº" class="headerlink" title="2.6.6 ç¦ç”¨swapåˆ†åŒº"></a>2.6.6 ç¦ç”¨swapåˆ†åŒº</h5><p>swapåˆ†åŒºæŒ‡çš„æ˜¯è™šæ‹Ÿå†…å­˜åˆ†åŒºï¼Œå®ƒçš„ä½œç”¨æ˜¯ç‰©ç†å†…å­˜ä½¿ç”¨å®Œï¼Œä¹‹åå°†ç£ç›˜ç©ºé—´è™šæ‹Ÿæˆå†…å­˜æ¥ä½¿ç”¨ï¼Œå¯ç”¨swapè®¾å¤‡ä¼šå¯¹ç³»ç»Ÿçš„æ€§èƒ½äº§ç”Ÿéå¸¸è´Ÿé¢çš„å½±å“ï¼Œå› æ­¤kubernetesè¦æ±‚æ¯ä¸ªèŠ‚ç‚¹éƒ½è¦ç¦ç”¨swapè®¾å¤‡ï¼Œä½†æ˜¯å¦‚æœå› ä¸ºæŸäº›åŸå› ç¡®å®ä¸èƒ½å…³é—­swapåˆ†åŒºï¼Œå°±éœ€è¦åœ¨é›†ç¾¤å®‰è£…è¿‡ç¨‹ä¸­é€šè¿‡æ˜ç¡®çš„å‚æ•°è¿›è¡Œé…ç½®è¯´æ˜</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="POWERSHELL"><figure class="iseeu highlight /powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç¼–è¾‘åˆ†åŒºé…ç½®æ–‡ä»¶/etc/fstabï¼Œæ³¨é‡Šæ‰swapåˆ†åŒºä¸€è¡Œ</span></span><br><span class="line"><span class="comment"># æ³¨æ„ä¿®æ”¹å®Œæ¯•ä¹‹åéœ€è¦é‡å¯linuxæœåŠ¡</span></span><br><span class="line">vim /etc/fstab</span><br><span class="line">æ³¨é‡Šæ‰ /dev/mapper/centos<span class="literal">-swap</span> swap</span><br><span class="line"><span class="comment"># /dev/mapper/centos-swap swap</span></span><br></pre></td></tr></table></figure></div>

<h5 id="2-6-7-ä¿®æ”¹linuxçš„å†…æ ¸å‚æ•°"><a href="#2-6-7-ä¿®æ”¹linuxçš„å†…æ ¸å‚æ•°" class="headerlink" title="2.6.7 ä¿®æ”¹linuxçš„å†…æ ¸å‚æ•°"></a>2.6.7 ä¿®æ”¹linuxçš„å†…æ ¸å‚æ•°</h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="POWERSHELL"><figure class="iseeu highlight /powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ä¿®æ”¹linuxçš„å†…æ ¸é‡‡çº³æ•°ï¼Œæ·»åŠ ç½‘æ¡¥è¿‡æ»¤å’Œåœ°å€è½¬å‘åŠŸèƒ½</span></span><br><span class="line"><span class="comment"># ç¼–è¾‘/etc/sysctl.d/kubernetes.confæ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹é…ç½®ï¼š</span></span><br><span class="line">net.bridge.bridge<span class="literal">-nf</span><span class="literal">-call</span><span class="literal">-ip6tables</span> = <span class="number">1</span></span><br><span class="line">net.bridge.bridge<span class="literal">-nf</span><span class="literal">-call</span><span class="literal">-iptables</span> = <span class="number">1</span></span><br><span class="line">net.ipv4.ip_forward = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># é‡æ–°åŠ è½½é…ç½®</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">master</span> ~]<span class="comment"># sysctl -p</span></span><br><span class="line"><span class="comment"># åŠ è½½ç½‘æ¡¥è¿‡æ»¤æ¨¡å—</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">master</span> ~]<span class="comment"># modprobe br_netfilter</span></span><br><span class="line"><span class="comment"># æŸ¥çœ‹ç½‘æ¡¥è¿‡æ»¤æ¨¡å—æ˜¯å¦åŠ è½½æˆåŠŸ</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">master</span> ~]<span class="comment"># lsmod | grep br_netfilter</span></span><br></pre></td></tr></table></figure></div>

<h5 id="2-6-8-é…ç½®ipvsåŠŸèƒ½"><a href="#2-6-8-é…ç½®ipvsåŠŸèƒ½" class="headerlink" title="2.6.8 é…ç½®ipvsåŠŸèƒ½"></a>2.6.8 é…ç½®ipvsåŠŸèƒ½</h5><p>åœ¨Kubernetesä¸­Serviceæœ‰ä¸¤ç§å¸¦æ¥æ¨¡å‹ï¼Œä¸€ç§æ˜¯åŸºäºiptablesçš„ï¼Œä¸€ç§æ˜¯åŸºäºipvsçš„ä¸¤è€…æ¯”è¾ƒçš„è¯ï¼Œipvsçš„æ€§èƒ½æ˜æ˜¾è¦é«˜ä¸€äº›ï¼Œä½†æ˜¯å¦‚æœè¦ä½¿ç”¨å®ƒï¼Œéœ€è¦æ‰‹åŠ¨è½½å…¥ipvsæ¨¡å—</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="POWERSHELL"><figure class="iseeu highlight /powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1.å®‰è£…ipsetå’Œipvsadm</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">master</span> ~]<span class="comment"># yum install ipset ipvsadm -y</span></span><br><span class="line"><span class="comment"># 2.æ·»åŠ éœ€è¦åŠ è½½çš„æ¨¡å—å†™å…¥è„šæœ¬æ–‡ä»¶</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">master</span> ~]<span class="comment"># cat &lt;&lt;EOF&gt; /etc/sysconfig/modules/ipvs.modules</span></span><br><span class="line"><span class="comment">#!/bin/bash</span></span><br><span class="line">modprobe -- ip_vs</span><br><span class="line">modprobe -- ip_vs_rr</span><br><span class="line">modprobe -- ip_vs_wrr</span><br><span class="line">modprobe -- ip_vs_sh</span><br><span class="line">modprobe -- nf_conntrack_ipv4</span><br><span class="line">EOF</span><br><span class="line"><span class="comment"># 3.ä¸ºè„šæœ¬æ·»åŠ æ‰§è¡Œæƒé™</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">master</span> ~]<span class="comment"># chmod +x /etc/sysconfig/modules/ipvs.modules</span></span><br><span class="line"><span class="comment"># 4.æ‰§è¡Œè„šæœ¬æ–‡ä»¶</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">master</span> ~]<span class="comment"># /bin/bash /etc/sysconfig/modules/ipvs.modules</span></span><br><span class="line"><span class="comment"># 5.æŸ¥çœ‹å¯¹åº”çš„æ¨¡å—æ˜¯å¦åŠ è½½æˆåŠŸ</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">master</span> ~]<span class="comment"># lsmod | grep -e ip_vs -e nf_conntrack_ipv4</span></span><br></pre></td></tr></table></figure></div>

<h5 id="2-6-9-å®‰è£…docker"><a href="#2-6-9-å®‰è£…docker" class="headerlink" title="2.6.9 å®‰è£…docker"></a>2.6.9 å®‰è£…docker</h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="POWERSHELL"><figure class="iseeu highlight /powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1ã€åˆ‡æ¢é•œåƒæº</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">master</span> ~]<span class="comment"># wget https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo -O /etc/yum.repos.d/docker-ce.repo</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2ã€æŸ¥çœ‹å½“å‰é•œåƒæºä¸­æ”¯æŒçš„dockerç‰ˆæœ¬</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">master</span> ~]<span class="comment"># yum list docker-ce --showduplicates</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 3ã€å®‰è£…ç‰¹å®šç‰ˆæœ¬çš„docker-ce</span></span><br><span class="line"><span class="comment"># å¿…é¡»åˆ¶å®š--setopt=obsoletes=0ï¼Œå¦åˆ™yumä¼šè‡ªåŠ¨å®‰è£…æ›´é«˜ç‰ˆæœ¬</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">master</span> ~]<span class="comment"># yum install --setopt=obsoletes=0 docker-ce-18.06.3.ce-3.el7 -y</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4ã€æ·»åŠ ä¸€ä¸ªé…ç½®æ–‡ä»¶</span></span><br><span class="line"><span class="comment">#Docker åœ¨é»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨Vgroup Driverä¸ºcgroupfsï¼Œè€ŒKubernetesæ¨èä½¿ç”¨systemdæ¥æ›¿ä»£cgroupfs</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">master</span> ~]<span class="comment"># mkdir /etc/docker</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">master</span> ~]<span class="comment"># cat &lt;&lt;EOF&gt; /etc/docker/daemon.json</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">&quot;exec-opts&quot;</span>: [<span class="string">&quot;native.cgroupdriver=systemd&quot;</span>],</span><br><span class="line">	<span class="string">&quot;registry-mirrors&quot;</span>: [<span class="string">&quot;https://kn0t2bca.mirror.aliyuncs.com&quot;</span>]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"><span class="comment"># 5ã€å¯åŠ¨dokcer</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">master</span> ~]<span class="comment"># systemctl restart docker</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">master</span> ~]<span class="comment"># systemctl enable docker</span></span><br></pre></td></tr></table></figure></div>

<h5 id="2-6-10-å®‰è£…Kubernetesç»„ä»¶"><a href="#2-6-10-å®‰è£…Kubernetesç»„ä»¶" class="headerlink" title="2.6.10 å®‰è£…Kubernetesç»„ä»¶"></a>2.6.10 å®‰è£…Kubernetesç»„ä»¶</h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="POWERSHELL"><figure class="iseeu highlight /powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1ã€ç”±äºkubernetesçš„é•œåƒåœ¨å›½å¤–ï¼Œé€Ÿåº¦æ¯”è¾ƒæ…¢ï¼Œè¿™é‡Œåˆ‡æ¢æˆå›½å†…çš„é•œåƒæº</span></span><br><span class="line"><span class="comment"># 2ã€ç¼–è¾‘/etc/yum.repos.d/kubernetes.repo,æ·»åŠ ä¸‹é¢çš„é…ç½®</span></span><br><span class="line">[<span class="type">kubernetes</span>]</span><br><span class="line">name=Kubernetes</span><br><span class="line">baseurl=http://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes<span class="literal">-el7</span><span class="literal">-x86_64</span></span><br><span class="line">enabled=<span class="number">1</span></span><br><span class="line">gpgchech=<span class="number">0</span></span><br><span class="line">repo_gpgcheck=<span class="number">0</span></span><br><span class="line">gpgkey=http://mirrors.aliyun.com/kubernetes/yum/doc/yum<span class="literal">-key</span>.gpg</span><br><span class="line">			http://mirrors.aliyun.com/kubernetes/yum/doc/rpm<span class="literal">-package</span><span class="literal">-key</span>.gpg</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3ã€å®‰è£…kubeadmã€kubeletå’Œkubectl</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">master</span> ~]<span class="comment"># yum install --setopt=obsoletes=0 kubeadm-1.17.4-0 kubelet-1.17.4-0 kubectl-1.17.4-0 -y</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 4ã€é…ç½®kubeletçš„cgroup</span></span><br><span class="line"><span class="comment">#ç¼–è¾‘/etc/sysconfig/kubelet, æ·»åŠ ä¸‹é¢çš„é…ç½®</span></span><br><span class="line">KUBELET_CGROUP_ARGS=<span class="string">&quot;--cgroup-driver=systemd&quot;</span></span><br><span class="line">KUBE_PROXY_MODE=<span class="string">&quot;ipvs&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 5ã€è®¾ç½®kubeletå¼€æœºè‡ªå¯</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">master</span> ~]<span class="comment"># systemctl enable kubelet</span></span><br></pre></td></tr></table></figure></div>

<h5 id="2-6-11-å‡†å¤‡é›†ç¾¤é•œåƒ"><a href="#2-6-11-å‡†å¤‡é›†ç¾¤é•œåƒ" class="headerlink" title="2.6.11 å‡†å¤‡é›†ç¾¤é•œåƒ"></a>2.6.11 å‡†å¤‡é›†ç¾¤é•œåƒ</h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="POWERSHELL"><figure class="iseeu highlight /powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åœ¨å®‰è£…kubernetesé›†ç¾¤ä¹‹å‰ï¼Œå¿…é¡»è¦æå‰å‡†å¤‡å¥½é›†ç¾¤éœ€è¦çš„é•œåƒï¼Œæ‰€éœ€é•œåƒå¯ä»¥é€šè¿‡ä¸‹é¢å‘½ä»¤æŸ¥çœ‹</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">master</span> ~]<span class="comment"># kubeadm config images list</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸‹è½½é•œåƒ</span></span><br><span class="line"><span class="comment"># æ­¤é•œåƒkubernetesçš„ä»“åº“ä¸­ï¼Œç”±äºç½‘ç»œåŸå› ï¼Œæ— æ³•è¿æ¥ï¼Œä¸‹é¢æä¾›äº†ä¸€ç§æ›¿æ¢æ–¹æ¡ˆ</span></span><br><span class="line">images=(</span><br><span class="line">	kube<span class="literal">-apiserver</span>:v1.<span class="number">17.4</span></span><br><span class="line">	kube<span class="literal">-controller</span><span class="literal">-manager</span>:v1.<span class="number">17.4</span></span><br><span class="line">	kube<span class="literal">-scheduler</span>:v1.<span class="number">17.4</span></span><br><span class="line">	kube<span class="literal">-proxy</span>:v1.<span class="number">17.4</span></span><br><span class="line">	pause:<span class="number">3.1</span></span><br><span class="line">	etcd:<span class="number">3.4</span>.<span class="number">3</span><span class="literal">-0</span></span><br><span class="line">	coredns:<span class="number">1.6</span>.<span class="number">5</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> imageName <span class="keyword">in</span> <span class="variable">$</span>&#123;images[<span class="selector-tag">@</span>]&#125;;<span class="keyword">do</span></span><br><span class="line">	docker pull registry.cn<span class="literal">-hangzhou</span>.aliyuncs.com/google_containers/<span class="variable">$imageName</span></span><br><span class="line">	docker tag registry.cn<span class="literal">-hangzhou</span>.aliyuncs.com/google_containers/<span class="variable">$imageName</span> k8s.gcr.io/<span class="variable">$imageName</span></span><br><span class="line">	docker rmi registry.cn<span class="literal">-hangzhou</span>.aliyuncs.com/google_containers/<span class="variable">$imageName</span> </span><br><span class="line">done</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<h5 id="2-6-11-é›†ç¾¤åˆå§‹åŒ–"><a href="#2-6-11-é›†ç¾¤åˆå§‹åŒ–" class="headerlink" title="2.6.11 é›†ç¾¤åˆå§‹åŒ–"></a>2.6.11 é›†ç¾¤åˆå§‹åŒ–</h5><blockquote>
<p>ä¸‹é¢çš„æ“ä½œåªéœ€è¦åœ¨masterèŠ‚ç‚¹ä¸Šæ‰§è¡Œå³å¯</p>
</blockquote>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="POWERSHELL"><figure class="iseeu highlight /powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># åˆ›å»ºé›†ç¾¤</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">master</span> ~]<span class="comment"># kubeadm init \</span></span><br><span class="line">	-<span class="literal">-apiserver</span><span class="literal">-advertise</span><span class="literal">-address</span>=<span class="number">192.168</span>.<span class="number">90.100</span> \</span><br><span class="line">	-<span class="literal">-image</span><span class="literal">-repository</span> registry.aliyuncs.com/google_containers \</span><br><span class="line">	-<span class="literal">-kubernetes</span><span class="literal">-version</span>=v1.<span class="number">17.4</span> \</span><br><span class="line">	-<span class="literal">-service</span><span class="literal">-cidr</span>=<span class="number">10.96</span>.<span class="number">0.0</span>/<span class="number">12</span> \</span><br><span class="line">	-<span class="literal">-pod</span><span class="literal">-network</span><span class="literal">-cidr</span>=<span class="number">10.244</span>.<span class="number">0.0</span>/<span class="number">16</span></span><br><span class="line"><span class="comment"># åˆ›å»ºå¿…è¦æ–‡ä»¶</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">master</span> ~]<span class="comment"># mkdir -p $HOME/.kube</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">master</span> ~]<span class="comment"># sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">master</span> ~]<span class="comment"># sudo chown $(id -u):$(id -g) $HOME/.kube/config</span></span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>ä¸‹é¢çš„æ“ä½œåªéœ€è¦åœ¨nodeèŠ‚ç‚¹ä¸Šæ‰§è¡Œå³å¯</p>
</blockquote>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="POWERSHELL"><figure class="iseeu highlight /powershell"><table><tr><td class="code"><pre><span class="line">kubeadm join <span class="number">192.168</span>.<span class="number">0.100</span>:<span class="number">6443</span> -<span class="literal">-token</span> awk15p.t6bamck54w69u4s8 \</span><br><span class="line">    -<span class="literal">-discovery</span><span class="literal">-token</span><span class="literal">-ca</span><span class="literal">-cert</span><span class="literal">-hash</span> sha256:a94fa09562466d32d29523ab6cff122186f1127599fa4dcd5fa0152694f17117 </span><br></pre></td></tr></table></figure></div>

<p>åœ¨masterä¸ŠæŸ¥çœ‹èŠ‚ç‚¹ä¿¡æ¯</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="POWERSHELL"><figure class="iseeu highlight /powershell"><table><tr><td class="code"><pre><span class="line">[<span class="type">root</span>@<span class="type">master</span> ~]<span class="comment"># kubectl get nodes</span></span><br><span class="line">NAME    STATUS   ROLES     AGE   VERSION</span><br><span class="line">master  NotReady  master   <span class="number">6</span>m    v1.<span class="number">17.4</span></span><br><span class="line">node1   NotReady   &lt;none&gt;  <span class="number">22</span>s   v1.<span class="number">17.4</span></span><br><span class="line">node2   NotReady   &lt;none&gt;  <span class="number">19</span>s   v1.<span class="number">17.4</span></span><br></pre></td></tr></table></figure></div>

<h5 id="2-6-13-å®‰è£…ç½‘ç»œæ’ä»¶ï¼Œåªåœ¨masterèŠ‚ç‚¹æ“ä½œå³å¯"><a href="#2-6-13-å®‰è£…ç½‘ç»œæ’ä»¶ï¼Œåªåœ¨masterèŠ‚ç‚¹æ“ä½œå³å¯" class="headerlink" title="2.6.13 å®‰è£…ç½‘ç»œæ’ä»¶ï¼Œåªåœ¨masterèŠ‚ç‚¹æ“ä½œå³å¯"></a>2.6.13 å®‰è£…ç½‘ç»œæ’ä»¶ï¼Œåªåœ¨masterèŠ‚ç‚¹æ“ä½œå³å¯</h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="POWERSHELL"><figure class="iseeu highlight /powershell"><table><tr><td class="code"><pre><span class="line"><span class="built_in">wget</span> https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube<span class="literal">-flannel</span>.yml</span><br></pre></td></tr></table></figure></div>

<p>ç”±äºå¤–ç½‘ä¸å¥½è®¿é—®ï¼Œå¦‚æœå‡ºç°æ— æ³•è®¿é—®çš„æƒ…å†µï¼Œå¯ä»¥ç›´æ¥ç”¨ä¸‹é¢çš„ è®°å¾—æ–‡ä»¶åæ˜¯kube-flannel.ymlï¼Œä½ç½®ï¼š/root/kube-flannel.ymlå†…å®¹ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="POWERSHELL"><figure class="iseeu highlight /powershell"><table><tr><td class="code"><pre><span class="line">https://github.com/flannel<span class="literal">-io</span>/flannel/tree/master/Documentation/kube<span class="literal">-flannel</span>.yml</span><br></pre></td></tr></table></figure></div>
<p>ä¹Ÿå¯æ‰‹åŠ¨æ‹‰å–æŒ‡å®šç‰ˆæœ¬<br>docker pull quay.io/coreos/flannel:v0.14.0              #æ‹‰å–flannelç½‘ç»œï¼Œä¸‰å°ä¸»æœº<br>docker images                  #æŸ¥çœ‹ä»“åº“æ˜¯å¦æ‹‰å»ä¸‹æ¥</p>
<p><code>ä¸ªäººç¬”è®°</code><br>è‹¥æ˜¯é›†ç¾¤çŠ¶æ€ä¸€ç›´æ˜¯ notready,ç”¨ä¸‹é¢è¯­å¥æŸ¥çœ‹åŸå› ï¼Œ<br>journalctl -f -u kubelet.service<br>è‹¥åŸå› æ˜¯ï¼š cni.go:237] Unable to update cni config: no networks found in /etc/cni/net.d<br>mkdir -p /etc/cni/net.d                    #åˆ›å»ºç›®å½•ç»™flannelåšé…ç½®æ–‡ä»¶<br>vim /etc/cni/net.d/10-flannel.conf         #ç¼–å†™é…ç½®æ–‡ä»¶</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="POWERSHELL"><figure class="iseeu highlight /powershell"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"> <span class="string">&quot;name&quot;</span>:<span class="string">&quot;cbr0&quot;</span>,</span><br><span class="line"> <span class="string">&quot;cniVersion&quot;</span>:<span class="string">&quot;0.3.1&quot;</span>,</span><br><span class="line"> <span class="string">&quot;type&quot;</span>:<span class="string">&quot;flannel&quot;</span>,</span><br><span class="line"> <span class="string">&quot;deledate&quot;</span>:&#123;</span><br><span class="line">    <span class="string">&quot;hairpinMode&quot;</span>:true,</span><br><span class="line">    <span class="string">&quot;isDefaultGateway&quot;</span>:true</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>


<h5 id="2-6-14-ä½¿ç”¨kubeadm-reseté‡ç½®é›†ç¾¤"><a href="#2-6-14-ä½¿ç”¨kubeadm-reseté‡ç½®é›†ç¾¤" class="headerlink" title="2.6.14 ä½¿ç”¨kubeadm reseté‡ç½®é›†ç¾¤"></a>2.6.14 ä½¿ç”¨kubeadm reseté‡ç½®é›†ç¾¤</h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="PLAIN"><figure class="iseeu highlight /plain"><table><tr><td class="code"><pre><span class="line">#åœ¨masterèŠ‚ç‚¹ä¹‹å¤–çš„èŠ‚ç‚¹è¿›è¡Œæ“ä½œ</span><br><span class="line">kubeadm reset</span><br><span class="line">systemctl stop kubelet</span><br><span class="line">systemctl stop docker</span><br><span class="line">rm -rf &#x2F;var&#x2F;lib&#x2F;cni&#x2F;</span><br><span class="line">rm -rf &#x2F;var&#x2F;lib&#x2F;kubelet&#x2F;*</span><br><span class="line">rm -rf &#x2F;etc&#x2F;cni&#x2F;</span><br><span class="line">ifconfig cni0 down</span><br><span class="line">ifconfig flannel.1 down</span><br><span class="line">ifconfig docker0 down</span><br><span class="line">ip link delete cni0</span><br><span class="line">ip link delete flannel.1</span><br><span class="line">##é‡å¯kubelet</span><br><span class="line">systemctl restart kubelet</span><br><span class="line">##é‡å¯docker</span><br><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure></div>

<h5 id="2-6-15-é‡å¯kubeletå’Œdocker"><a href="#2-6-15-é‡å¯kubeletå’Œdocker" class="headerlink" title="2.6.15 é‡å¯kubeletå’Œdocker"></a>2.6.15 é‡å¯kubeletå’Œdocker</h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="POWERSHELL"><figure class="iseeu highlight /powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># é‡å¯kubelet</span></span><br><span class="line">systemctl restart kubelet</span><br><span class="line"><span class="comment"># é‡å¯docker</span></span><br><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure></div>

<p>ä½¿ç”¨é…ç½®æ–‡ä»¶å¯åŠ¨fannel</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="POWERSHELL"><figure class="iseeu highlight /powershell"><table><tr><td class="code"><pre><span class="line">kubectl apply <span class="operator">-f</span> kube<span class="literal">-flannel</span>.yml</span><br></pre></td></tr></table></figure></div>

<p>ç­‰å¾…å®ƒå®‰è£…å®Œæ¯• å‘ç°å·²ç»æ˜¯ é›†ç¾¤çš„çŠ¶æ€å·²ç»æ˜¯Ready</p>
<p><img src="/2022/06/09/uncatalog/cl46zkqb400157or761km2b46/2232696-20210621233106024-1676033717.png" alt="img"></p>
<h5 id="2-6-16-kubeadmä¸­çš„å‘½ä»¤"><a href="#2-6-16-kubeadmä¸­çš„å‘½ä»¤" class="headerlink" title="2.6.16 kubeadmä¸­çš„å‘½ä»¤"></a>2.6.16 kubeadmä¸­çš„å‘½ä»¤</h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="POWERSHELL"><figure class="iseeu highlight /powershell"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ç”Ÿæˆ æ–°çš„token</span></span><br><span class="line">[<span class="type">root</span>@<span class="type">master</span> ~]<span class="comment"># kubeadm token create --print-join-command</span></span><br></pre></td></tr></table></figure></div>

<h4 id="2-7-é›†ç¾¤æµ‹è¯•"><a href="#2-7-é›†ç¾¤æµ‹è¯•" class="headerlink" title="2.7 é›†ç¾¤æµ‹è¯•"></a>2.7 é›†ç¾¤æµ‹è¯•</h4><h5 id="2-7-1-åˆ›å»ºä¸€ä¸ªnginxæœåŠ¡"><a href="#2-7-1-åˆ›å»ºä¸€ä¸ªnginxæœåŠ¡" class="headerlink" title="2.7.1 åˆ›å»ºä¸€ä¸ªnginxæœåŠ¡"></a>2.7.1 åˆ›å»ºä¸€ä¸ªnginxæœåŠ¡</h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="POWERSHELL"><figure class="iseeu highlight /powershell"><table><tr><td class="code"><pre><span class="line">kubectl create deployment nginx  -<span class="literal">-image</span>=nginx:<span class="number">1.14</span><span class="literal">-alpine</span></span><br></pre></td></tr></table></figure></div>

<h5 id="2-7-2-æš´éœ²ç«¯å£"><a href="#2-7-2-æš´éœ²ç«¯å£" class="headerlink" title="2.7.2 æš´éœ²ç«¯å£"></a>2.7.2 æš´éœ²ç«¯å£</h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="POWERSHELL"><figure class="iseeu highlight /powershell"><table><tr><td class="code"><pre><span class="line">kubectl expose deploy nginx  -<span class="literal">-port</span>=<span class="number">80</span> -<span class="literal">-target</span><span class="literal">-port</span>=<span class="number">80</span>  -<span class="literal">-type</span>=NodePort</span><br></pre></td></tr></table></figure></div>

<h5 id="2-7-3-æŸ¥çœ‹æœåŠ¡"><a href="#2-7-3-æŸ¥çœ‹æœåŠ¡" class="headerlink" title="2.7.3 æŸ¥çœ‹æœåŠ¡"></a>2.7.3 æŸ¥çœ‹æœåŠ¡</h5><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="POWERSHELL"><figure class="iseeu highlight /powershell"><table><tr><td class="code"><pre><span class="line">kubectl get pod,svc</span><br></pre></td></tr></table></figure></div>

<h5 id="2-7-4-æŸ¥çœ‹pod"><a href="#2-7-4-æŸ¥çœ‹pod" class="headerlink" title="2.7.4 æŸ¥çœ‹pod"></a>2.7.4 æŸ¥çœ‹pod</h5><p><img src="/2022/06/09/uncatalog/cl46zkqb400157or761km2b46/2232696-20210621233130477-111035427.png" alt="img"></p>
<p>æµè§ˆå™¨æµ‹è¯•ç»“æœï¼š</p>
<p><img src="/2022/06/09/uncatalog/cl46zkqb400157or761km2b46/2232696-20210621233157075-1117518703.png" alt="img"></p>
]]></content>
      <tags>
        <tag>äº‘åŸç”ŸåŸºç¡€ç³»åˆ—</tag>
        <tag>Kubernetes</tag>
      </tags>
  </entry>
  <entry>
    <title>äº‘åŸç”ŸåŸºç¡€ç³»åˆ—ä¹‹Kubernetes(ä¸€)Kubernetesä»‹ç»</title>
    <url>/2022/06/09/uncatalog/cl46zoo76000028r79whb5rff/</url>
    <content><![CDATA[<hr>
<span id="more"></span>
<hr>
<h3 id="1-Kubernetesä»‹ç»"><a href="#1-Kubernetesä»‹ç»" class="headerlink" title="1. Kubernetesä»‹ç»"></a>1. Kubernetesä»‹ç»</h3><h4 id="1-1-åº”ç”¨éƒ¨ç½²æ–¹å¼æ¼”å˜"><a href="#1-1-åº”ç”¨éƒ¨ç½²æ–¹å¼æ¼”å˜" class="headerlink" title="1.1 åº”ç”¨éƒ¨ç½²æ–¹å¼æ¼”å˜"></a>1.1 åº”ç”¨éƒ¨ç½²æ–¹å¼æ¼”å˜</h4><p>åœ¨éƒ¨ç½²åº”ç”¨ç¨‹åºçš„æ–¹å¼ä¸Šï¼Œä¸»è¦ç»å†äº†ä¸‰ä¸ªæ—¶ä»£ï¼š</p>
<ul>
<li><p><strong>ä¼ ç»Ÿéƒ¨ç½²</strong>ï¼šäº’è”ç½‘æ—©æœŸï¼Œä¼šç›´æ¥å°†åº”ç”¨ç¨‹åºéƒ¨ç½²åœ¨ç‰©ç†æœºä¸Š</p>
<blockquote>
<p>ä¼˜ç‚¹ï¼šç®€å•ï¼Œä¸éœ€è¦å…¶å®ƒæŠ€æœ¯çš„å‚ä¸</p>
<p>ç¼ºç‚¹ï¼šä¸èƒ½ä¸ºåº”ç”¨ç¨‹åºå®šä¹‰èµ„æºä½¿ç”¨è¾¹ç•Œï¼Œå¾ˆéš¾åˆç†åœ°åˆ†é…è®¡ç®—èµ„æºï¼Œè€Œä¸”ç¨‹åºä¹‹é—´å®¹æ˜“äº§ç”Ÿå½±å“</p>
</blockquote>
</li>
<li><p><strong>è™šæ‹ŸåŒ–éƒ¨ç½²</strong>ï¼šå¯ä»¥åœ¨ä¸€å°ç‰©ç†æœºä¸Šè¿è¡Œå¤šä¸ªè™šæ‹Ÿæœºï¼Œæ¯ä¸ªè™šæ‹Ÿæœºéƒ½æ˜¯ç‹¬ç«‹çš„ä¸€ä¸ªç¯å¢ƒ</p>
<blockquote>
<p>ä¼˜ç‚¹ï¼šç¨‹åºç¯å¢ƒä¸ä¼šç›¸äº’äº§ç”Ÿå½±å“ï¼Œæä¾›äº†ä¸€å®šç¨‹åº¦çš„å®‰å…¨æ€§</p>
<p>ç¼ºç‚¹ï¼šå¢åŠ äº†æ“ä½œç³»ç»Ÿï¼Œæµªè´¹äº†éƒ¨åˆ†èµ„æº</p>
</blockquote>
</li>
<li><p><strong>å®¹å™¨åŒ–éƒ¨ç½²</strong>ï¼šä¸è™šæ‹ŸåŒ–ç±»ä¼¼ï¼Œä½†æ˜¯å…±äº«äº†æ“ä½œç³»ç»Ÿ</p>
<blockquote>
<p>ä¼˜ç‚¹ï¼š</p>
<p>å¯ä»¥ä¿è¯æ¯ä¸ªå®¹å™¨æ‹¥æœ‰è‡ªå·±çš„æ–‡ä»¶ç³»ç»Ÿã€CPUã€å†…å­˜ã€è¿›ç¨‹ç©ºé—´ç­‰</p>
<p>è¿è¡Œåº”ç”¨ç¨‹åºæ‰€éœ€è¦çš„èµ„æºéƒ½è¢«å®¹å™¨åŒ…è£…ï¼Œå¹¶å’Œåº•å±‚åŸºç¡€æ¶æ„è§£è€¦</p>
<p>å®¹å™¨åŒ–çš„åº”ç”¨ç¨‹åºå¯ä»¥è·¨äº‘æœåŠ¡å•†ã€è·¨Linuxæ“ä½œç³»ç»Ÿå‘è¡Œç‰ˆè¿›è¡Œéƒ¨ç½²</p>
</blockquote>
</li>
</ul>
<p><img src="/2022/06/09/uncatalog/cl46zoo76000028r79whb5rff/image-20200505183738289.png" alt="image-20200505183738289"></p>
<p>å®¹å™¨åŒ–éƒ¨ç½²æ–¹å¼ç»™å¸¦æ¥å¾ˆå¤šçš„ä¾¿åˆ©ï¼Œä½†æ˜¯ä¹Ÿä¼šå‡ºç°ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚è¯´ï¼š</p>
<ul>
<li>ä¸€ä¸ªå®¹å™¨æ•…éšœåœæœºäº†ï¼Œæ€ä¹ˆæ ·è®©å¦å¤–ä¸€ä¸ªå®¹å™¨ç«‹åˆ»å¯åŠ¨å»æ›¿è¡¥åœæœºçš„å®¹å™¨</li>
<li>å½“å¹¶å‘è®¿é—®é‡å˜å¤§çš„æ—¶å€™ï¼Œæ€ä¹ˆæ ·åšåˆ°æ¨ªå‘æ‰©å±•å®¹å™¨æ•°é‡</li>
</ul>
<p>è¿™äº›å®¹å™¨ç®¡ç†çš„é—®é¢˜ç»Ÿç§°ä¸º<strong>å®¹å™¨ç¼–æ’</strong>é—®é¢˜ï¼Œä¸ºäº†è§£å†³è¿™äº›å®¹å™¨ç¼–æ’é—®é¢˜ï¼Œå°±äº§ç”Ÿäº†ä¸€äº›å®¹å™¨ç¼–æ’çš„è½¯ä»¶ï¼š</p>
<ul>
<li><strong>Swarm</strong>ï¼šDockerè‡ªå·±çš„å®¹å™¨ç¼–æ’å·¥å…·</li>
<li><strong>Mesos</strong>ï¼šApacheçš„ä¸€ä¸ªèµ„æºç»Ÿä¸€ç®¡æ§çš„å·¥å…·ï¼Œéœ€è¦å’ŒMarathonç»“åˆä½¿ç”¨</li>
<li><strong>Kubernetes</strong>ï¼šGoogleå¼€æºçš„çš„å®¹å™¨ç¼–æ’å·¥å…·</li>
</ul>
<p><img src="/2022/06/09/uncatalog/cl46zoo76000028r79whb5rff/image-20200524150339551.png" alt="image-20200524150339551"></p>
<h4 id="1-2-kubernetesç®€ä»‹"><a href="#1-2-kubernetesç®€ä»‹" class="headerlink" title="1.2 kubernetesç®€ä»‹"></a>1.2 kubernetesç®€ä»‹</h4><p><img src="/2022/06/09/uncatalog/cl46zoo76000028r79whb5rff/image-20200406232838722.png" alt="image-20200406232838722"></p>
<p>kubernetesï¼Œæ˜¯ä¸€ä¸ªå…¨æ–°çš„åŸºäºå®¹å™¨æŠ€æœ¯çš„åˆ†å¸ƒå¼æ¶æ„é¢†å…ˆæ–¹æ¡ˆï¼Œæ˜¯è°·æ­Œä¸¥æ ¼ä¿å¯†åå‡ å¹´çš„ç§˜å¯†æ­¦å™¨â€”-Borgç³»ç»Ÿçš„ä¸€ä¸ªå¼€æºç‰ˆæœ¬ï¼Œäº2014å¹´9æœˆå‘å¸ƒç¬¬ä¸€ä¸ªç‰ˆæœ¬ï¼Œ2015å¹´7æœˆå‘å¸ƒç¬¬ä¸€ä¸ªæ­£å¼ç‰ˆæœ¬ã€‚</p>
<p>kubernetesçš„æœ¬è´¨æ˜¯<strong>ä¸€ç»„æœåŠ¡å™¨é›†ç¾¤</strong>ï¼Œå®ƒå¯ä»¥åœ¨é›†ç¾¤çš„æ¯ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œç‰¹å®šçš„ç¨‹åºï¼Œæ¥å¯¹èŠ‚ç‚¹ä¸­çš„å®¹å™¨è¿›è¡Œç®¡ç†ã€‚ç›®çš„æ˜¯å®ç°èµ„æºç®¡ç†çš„è‡ªåŠ¨åŒ–ï¼Œä¸»è¦æä¾›äº†å¦‚ä¸‹çš„ä¸»è¦åŠŸèƒ½ï¼š</p>
<ul>
<li><strong>è‡ªæˆ‘ä¿®å¤</strong>ï¼šä¸€æ—¦æŸä¸€ä¸ªå®¹å™¨å´©æºƒï¼Œèƒ½å¤Ÿåœ¨1ç§’ä¸­å·¦å³è¿…é€Ÿå¯åŠ¨æ–°çš„å®¹å™¨</li>
<li><strong>å¼¹æ€§ä¼¸ç¼©</strong>ï¼šå¯ä»¥æ ¹æ®éœ€è¦ï¼Œè‡ªåŠ¨å¯¹é›†ç¾¤ä¸­æ­£åœ¨è¿è¡Œçš„å®¹å™¨æ•°é‡è¿›è¡Œè°ƒæ•´</li>
<li><strong>æœåŠ¡å‘ç°</strong>ï¼šæœåŠ¡å¯ä»¥é€šè¿‡è‡ªåŠ¨å‘ç°çš„å½¢å¼æ‰¾åˆ°å®ƒæ‰€ä¾èµ–çš„æœåŠ¡</li>
<li><strong>è´Ÿè½½å‡è¡¡</strong>ï¼šå¦‚æœä¸€ä¸ªæœåŠ¡èµ·åŠ¨äº†å¤šä¸ªå®¹å™¨ï¼Œèƒ½å¤Ÿè‡ªåŠ¨å®ç°è¯·æ±‚çš„è´Ÿè½½å‡è¡¡</li>
<li><strong>ç‰ˆæœ¬å›é€€</strong>ï¼šå¦‚æœå‘ç°æ–°å‘å¸ƒçš„ç¨‹åºç‰ˆæœ¬æœ‰é—®é¢˜ï¼Œå¯ä»¥ç«‹å³å›é€€åˆ°åŸæ¥çš„ç‰ˆæœ¬</li>
<li><strong>å­˜å‚¨ç¼–æ’</strong>ï¼šå¯ä»¥æ ¹æ®å®¹å™¨è‡ªèº«çš„éœ€æ±‚è‡ªåŠ¨åˆ›å»ºå­˜å‚¨å·</li>
</ul>
<h4 id="1-3-kubernetesç»„ä»¶"><a href="#1-3-kubernetesç»„ä»¶" class="headerlink" title="1.3 kubernetesç»„ä»¶"></a>1.3 kubernetesç»„ä»¶</h4><p>ä¸€ä¸ªkubernetesé›†ç¾¤ä¸»è¦æ˜¯ç”±**æ§åˆ¶èŠ‚ç‚¹(master)<strong>ã€</strong>å·¥ä½œèŠ‚ç‚¹(node)**æ„æˆï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¸Šéƒ½ä¼šå®‰è£…ä¸åŒçš„ç»„ä»¶ã€‚</p>
<p><strong>masterï¼šé›†ç¾¤çš„æ§åˆ¶å¹³é¢ï¼Œè´Ÿè´£é›†ç¾¤çš„å†³ç­– ( ç®¡ç† )</strong></p>
<blockquote>
<p><strong>ApiServer</strong> : èµ„æºæ“ä½œçš„å”¯ä¸€å…¥å£ï¼Œæ¥æ”¶ç”¨æˆ·è¾“å…¥çš„å‘½ä»¤ï¼Œæä¾›è®¤è¯ã€æˆæƒã€APIæ³¨å†Œå’Œå‘ç°ç­‰æœºåˆ¶</p>
<p><strong>Scheduler</strong> : è´Ÿè´£é›†ç¾¤èµ„æºè°ƒåº¦ï¼ŒæŒ‰ç…§é¢„å®šçš„è°ƒåº¦ç­–ç•¥å°†Podè°ƒåº¦åˆ°ç›¸åº”çš„nodeèŠ‚ç‚¹ä¸Š</p>
<p><strong>ControllerManager</strong> : è´Ÿè´£ç»´æŠ¤é›†ç¾¤çš„çŠ¶æ€ï¼Œæ¯”å¦‚ç¨‹åºéƒ¨ç½²å®‰æ’ã€æ•…éšœæ£€æµ‹ã€è‡ªåŠ¨æ‰©å±•ã€æ»šåŠ¨æ›´æ–°ç­‰</p>
<p><strong>Etcd</strong> ï¼šè´Ÿè´£å­˜å‚¨é›†ç¾¤ä¸­å„ç§èµ„æºå¯¹è±¡çš„ä¿¡æ¯</p>
</blockquote>
<p><strong>nodeï¼šé›†ç¾¤çš„æ•°æ®å¹³é¢ï¼Œè´Ÿè´£ä¸ºå®¹å™¨æä¾›è¿è¡Œç¯å¢ƒ ( å¹²æ´» )</strong></p>
<blockquote>
<p><strong>Kubelet</strong> : è´Ÿè´£ç»´æŠ¤å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸï¼Œå³é€šè¿‡æ§åˆ¶dockerï¼Œæ¥åˆ›å»ºã€æ›´æ–°ã€é”€æ¯å®¹å™¨</p>
<p><strong>KubeProxy</strong> : è´Ÿè´£æä¾›é›†ç¾¤å†…éƒ¨çš„æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡</p>
<p><strong>Docker</strong> : è´Ÿè´£èŠ‚ç‚¹ä¸Šå®¹å™¨çš„å„ç§æ“ä½œ</p>
</blockquote>
<p><img src="/2022/06/09/uncatalog/cl46zoo76000028r79whb5rff/image-20200406184656917.png" alt="image-20200406184656917"></p>
<p>ä¸‹é¢ï¼Œä»¥éƒ¨ç½²ä¸€ä¸ªnginxæœåŠ¡æ¥è¯´æ˜kubernetesç³»ç»Ÿå„ä¸ªç»„ä»¶è°ƒç”¨å…³ç³»ï¼š</p>
<ol>
<li><p>é¦–å…ˆè¦æ˜ç¡®ï¼Œä¸€æ—¦kubernetesç¯å¢ƒå¯åŠ¨ä¹‹åï¼Œmasterå’Œnodeéƒ½ä¼šå°†è‡ªèº«çš„ä¿¡æ¯å­˜å‚¨åˆ°etcdæ•°æ®åº“ä¸­</p>
</li>
<li><p>ä¸€ä¸ªnginxæœåŠ¡çš„å®‰è£…è¯·æ±‚ä¼šé¦–å…ˆè¢«å‘é€åˆ°masterèŠ‚ç‚¹çš„apiServerç»„ä»¶</p>
</li>
<li><p>apiServerç»„ä»¶ä¼šè°ƒç”¨schedulerç»„ä»¶æ¥å†³å®šåˆ°åº•åº”è¯¥æŠŠè¿™ä¸ªæœåŠ¡å®‰è£…åˆ°å“ªä¸ªnodeèŠ‚ç‚¹ä¸Š</p>
<p>åœ¨æ­¤æ—¶ï¼Œå®ƒä¼šä»etcdä¸­è¯»å–å„ä¸ªnodeèŠ‚ç‚¹çš„ä¿¡æ¯ï¼Œç„¶åæŒ‰ç…§ä¸€å®šçš„ç®—æ³•è¿›è¡Œé€‰æ‹©ï¼Œå¹¶å°†ç»“æœå‘ŠçŸ¥apiServer</p>
</li>
<li><p>apiServerè°ƒç”¨controller-managerå»è°ƒåº¦NodeèŠ‚ç‚¹å®‰è£…nginxæœåŠ¡</p>
</li>
<li><p>kubeletæ¥æ”¶åˆ°æŒ‡ä»¤åï¼Œä¼šé€šçŸ¥dockerï¼Œç„¶åç”±dockeræ¥å¯åŠ¨ä¸€ä¸ªnginxçš„pod</p>
<p>podæ˜¯kubernetesçš„æœ€å°æ“ä½œå•å…ƒï¼Œå®¹å™¨å¿…é¡»è·‘åœ¨podä¸­è‡³æ­¤ï¼Œ</p>
</li>
<li><p>ä¸€ä¸ªnginxæœåŠ¡å°±è¿è¡Œäº†ï¼Œå¦‚æœéœ€è¦è®¿é—®nginxï¼Œå°±éœ€è¦é€šè¿‡kube-proxyæ¥å¯¹podäº§ç”Ÿè®¿é—®çš„ä»£ç†</p>
</li>
</ol>
<p>è¿™æ ·ï¼Œå¤–ç•Œç”¨æˆ·å°±å¯ä»¥è®¿é—®é›†ç¾¤ä¸­çš„nginxæœåŠ¡äº†</p>
<h4 id="1-4-kubernetesæ¦‚å¿µ"><a href="#1-4-kubernetesæ¦‚å¿µ" class="headerlink" title="1.4 kubernetesæ¦‚å¿µ"></a>1.4 kubernetesæ¦‚å¿µ</h4><p><strong>Master</strong>ï¼šé›†ç¾¤æ§åˆ¶èŠ‚ç‚¹ï¼Œæ¯ä¸ªé›†ç¾¤éœ€è¦è‡³å°‘ä¸€ä¸ªmasterèŠ‚ç‚¹è´Ÿè´£é›†ç¾¤çš„ç®¡æ§</p>
<p><strong>Node</strong>ï¼šå·¥ä½œè´Ÿè½½èŠ‚ç‚¹ï¼Œç”±masteråˆ†é…å®¹å™¨åˆ°è¿™äº›nodeå·¥ä½œèŠ‚ç‚¹ä¸Šï¼Œç„¶ånodeèŠ‚ç‚¹ä¸Šçš„dockerè´Ÿè´£å®¹å™¨çš„è¿è¡Œ</p>
<p><strong>Pod</strong>ï¼škubernetesçš„æœ€å°æ§åˆ¶å•å…ƒï¼Œå®¹å™¨éƒ½æ˜¯è¿è¡Œåœ¨podä¸­çš„ï¼Œä¸€ä¸ªpodä¸­å¯ä»¥æœ‰1ä¸ªæˆ–è€…å¤šä¸ªå®¹å™¨</p>
<p><strong>Controller</strong>ï¼šæ§åˆ¶å™¨ï¼Œé€šè¿‡å®ƒæ¥å®ç°å¯¹podçš„ç®¡ç†ï¼Œæ¯”å¦‚å¯åŠ¨podã€åœæ­¢podã€ä¼¸ç¼©podçš„æ•°é‡ç­‰ç­‰</p>
<p><strong>Service</strong>ï¼špodå¯¹å¤–æœåŠ¡çš„ç»Ÿä¸€å…¥å£ï¼Œä¸‹é¢å¯ä»¥ç»´æŠ¤è€…åŒä¸€ç±»çš„å¤šä¸ªpod</p>
<p><strong>Label</strong>ï¼šæ ‡ç­¾ï¼Œç”¨äºå¯¹podè¿›è¡Œåˆ†ç±»ï¼ŒåŒä¸€ç±»podä¼šæ‹¥æœ‰ç›¸åŒçš„æ ‡ç­¾</p>
<p><strong>NameSpace</strong>ï¼šå‘½åç©ºé—´ï¼Œç”¨æ¥éš”ç¦»podçš„è¿è¡Œç¯å¢ƒ</p>
]]></content>
      <tags>
        <tag>äº‘åŸç”ŸåŸºç¡€ç³»åˆ—</tag>
        <tag>Kubernetes</tag>
      </tags>
  </entry>
  <entry>
    <title>äº‘åŸç”ŸåŸºç¡€ç³»åˆ—ä¹‹docker(ä¸‰)dockeråŸºç¡€æŠ€æœ¯:linux namespace</title>
    <url>/2022/06/10/uncatalog/cl483pse2000038r7fnpqhzig/</url>
    <content><![CDATA[<hr>
<span id="more"></span>


<hr>
<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><blockquote>
<p>æ—¶ä¸‹æœ€çƒ­çš„æŠ€æœ¯è«è¿‡äºDockeräº†ï¼Œå¾ˆå¤šäººéƒ½è§‰å¾—Dockeræ˜¯ä¸ªæ–°æŠ€æœ¯ï¼Œå…¶å®ä¸ç„¶ï¼ŒDockeré™¤äº†å…¶ç¼–ç¨‹è¯­è¨€ç”¨goæ¯”è¾ƒæ–°å¤–ï¼Œå…¶å®å®ƒè¿˜çœŸä¸æ˜¯ä¸ªæ–°ä¸œè¥¿ï¼Œä¹Ÿå°±æ˜¯ä¸ªæ–°ç“¶è£…æ—§é…’çš„ä¸œè¥¿ï¼Œæ‰€è°“çš„The New â€œOld Stuffâ€ã€‚Dockerå’ŒDockerè¡ç”Ÿçš„ä¸œè¥¿ç”¨åˆ°äº†å¾ˆå¤šå¾ˆé…·çš„æŠ€æœ¯ï¼Œæˆ‘ä¼šç”¨å‡ ç¯‡ æ–‡ç« æ¥æŠŠè¿™äº›æŠ€æœ¯ç»™å¤§å®¶åšä¸ªä»‹ç»ï¼Œå¸Œæœ›é€šè¿‡è¿™äº›æ–‡ç« å¤§å®¶å¯ä»¥è‡ªå·±æ‰“é€ ä¸€ä¸ªå±±å¯¨ç‰ˆçš„dockerã€‚<br>å½“ç„¶ï¼Œæ–‡ç« çš„é£æ ¼ä¸€å®šä¼šå°Šé‡æ—¶ä¸‹çš„â€œæµè¡Œâ€â€”â€”æˆ‘ä»¬å†ä¹Ÿæ²¡æœ‰æ•´å—æ•´å—çš„æ—¶é—´å»çœ‹ä¹¦å»ä¸“ç ”ï¼Œè€Œæˆ‘ä»¬åªæœ‰çœ‹å¾®åšå¾®ä¿¡é‚£æ ·çš„ç¢ç‰‡æ—¶é—´ï¼ˆé‚£æ€•æˆ‘ä»¬æœ‰æ•´å—çš„æ—¶é—´ï¼Œä¹Ÿè¢«é‚£äº›åœ¨æ‰‹æœºä¸Šçš„APPç¢ç‰‡åŒ–äº†ï¼‰ã€‚æ‰€ä»¥ï¼Œè¿™äº›æ–‡ç« çš„é£æ ¼å¿…ç„¶åšæŒâ€œé©¬æ¡¶é£æ ¼â€ï¼ˆå¸Œæœ›ç®€å•åˆ°å ç”¨ä½ æ‹‰ä¸€æ³¡å±å°±æ—¶é—´ï¼Œè€Œä¸”ä½ è¿˜ä¸ç”¨åŠ¨è„‘å­ï¼Œå¹¶èƒ½å­¦åˆ°äº›ä¸œè¥¿ï¼‰<br>åºŸè¯å°‘è¯´ï¼Œæˆ‘ä»¬å¼€å§‹ã€‚å…ˆä»Linux Namespaceå¼€å§‹ã€‚</p>
</blockquote>
<h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>Linux Namespaceæ˜¯Linuxæä¾›çš„ä¸€ç§å†…æ ¸çº§åˆ«ç¯å¢ƒéš”ç¦»çš„æ–¹æ³•ã€‚ä¸çŸ¥é“ä½ æ˜¯å¦è¿˜è®°å¾—å¾ˆæ—©ä»¥å‰çš„Unixæœ‰ä¸€ä¸ªå«chrootçš„ç³»ç»Ÿè°ƒç”¨ï¼ˆé€šè¿‡ä¿®æ”¹æ ¹ç›®å½•æŠŠç”¨æˆ·jailåˆ°ä¸€ä¸ªç‰¹å®šç›®å½•ä¸‹ï¼‰ï¼Œchrootæä¾›äº†ä¸€ç§ç®€å•çš„éš”ç¦»æ¨¡å¼ï¼šchrootå†…éƒ¨çš„æ–‡ä»¶ç³»ç»Ÿæ— æ³•è®¿é—®å¤–éƒ¨çš„å†…å®¹ã€‚Linux Namespaceåœ¨æ­¤åŸºç¡€ä¸Šï¼Œæä¾›äº†å¯¹UTSã€IPCã€mountã€PIDã€networkã€Userç­‰çš„éš”ç¦»æœºåˆ¶ã€‚<br>ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“ï¼ŒLinuxä¸‹çš„è¶…çº§çˆ¶äº²è¿›ç¨‹çš„PIDæ˜¯1ï¼Œæ‰€ä»¥ï¼ŒåŒchrootä¸€æ ·ï¼Œå¦‚æœæˆ‘ä»¬å¯ä»¥æŠŠç”¨æˆ·çš„è¿›ç¨‹ç©ºé—´jailåˆ°æŸä¸ªè¿›ç¨‹åˆ†æ”¯ä¸‹ï¼Œå¹¶åƒchrooté‚£æ ·è®©å…¶ä¸‹é¢çš„è¿›ç¨‹ çœ‹åˆ°çš„é‚£ä¸ªè¶…çº§çˆ¶è¿›ç¨‹çš„PIDä¸º1ï¼Œäºæ˜¯å°±å¯ä»¥è¾¾åˆ°èµ„æºéš”ç¦»çš„æ•ˆæœäº†ï¼ˆä¸åŒçš„PID namespaceä¸­çš„è¿›ç¨‹æ— æ³•çœ‹åˆ°å½¼æ­¤ï¼‰<br><strong>Linux Namespace æœ‰å¦‚ä¸‹ç§ç±»</strong> ï¼Œå®˜æ–¹æ–‡æ¡£åœ¨è¿™é‡Œ<a href="https://lwn.net/Articles/531114/" title="Front-end web development">Namespace in Operation</a></p>
<table>
<thead>
<tr>
<th align="left">åˆ†ç±»</th>
<th align="left">ç³»ç»Ÿè°ƒç”¨å‚æ•°</th>
<th align="left">ç›¸å…³å†…æ ¸ç‰ˆæœ¬</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Mount namespaces</td>
<td align="left">CLONE_NEWNS</td>
<td align="left">Linux 2.4.19</td>
</tr>
<tr>
<td align="left">UTS namespaces</td>
<td align="left">CLONE_NEWUTS</td>
<td align="left">Linux 2.4.19</td>
</tr>
<tr>
<td align="left">IPC namespaces</td>
<td align="left">CLONE_NEWIPC</td>
<td align="left">Linux 2.4.19</td>
</tr>
<tr>
<td align="left">PID namespaces</td>
<td align="left">CLONE_NEWPID</td>
<td align="left">Linux 2.6.24</td>
</tr>
<tr>
<td align="left">Network namespaces</td>
<td align="left">CLONE_NEWNET</td>
<td align="left">å§‹äºLinux 2.6.24 å®Œæˆäº Linux 2.6.29</td>
</tr>
<tr>
<td align="left">User namespaces</td>
<td align="left">CLONE_NEWUSER</td>
<td align="left">å§‹äº Linux 2.6.23 å®Œæˆäº Linux 3.8)</td>
</tr>
</tbody></table>
<p>ä¸»è¦æ˜¯ä¸‰ä¸ªç³»ç»Ÿè°ƒç”¨</p>
<ul>
<li><code>clone()</code> å®ç°çº¿ç¨‹çš„ç³»ç»Ÿè°ƒç”¨ï¼Œç”¨æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„è¿›ç¨‹ï¼Œå¹¶å¯ä»¥é€šè¿‡è®¾è®¡ä¸Šè¿°å‚æ•°è¾¾åˆ°éš”ç¦»ã€‚</li>
<li><code>unshare()</code> ä½¿æŸè¿›ç¨‹è„±ç¦»æŸä¸ªnamespace</li>
<li><code>setns()</code> æŠŠæŸè¿›ç¨‹åŠ å…¥åˆ°æŸä¸ªnamespace</li>
<li><code>unshare()</code> å’Œ <code>setns()</code> éƒ½æ¯”è¾ƒç®€å•ï¼Œå¤§å®¶å¯ä»¥è‡ªå·±manï¼Œæˆ‘è¿™é‡Œä¸è¯´äº†ã€‚</li>
</ul>
<p>ä¸‹é¢è¿˜æ˜¯è®©æˆ‘ä»¬æ¥çœ‹ä¸€äº›ç¤ºä¾‹ï¼ˆä»¥ä¸‹çš„æµ‹è¯•ç¨‹åºæœ€å¥½åœ¨Linux å†…æ ¸ä¸º3.8ä»¥ä¸Šçš„ç‰ˆæœ¬ä¸­è¿è¡Œï¼Œæˆ‘ç”¨çš„æ˜¯ubuntu 14.04ï¼‰ã€‚</p>
<h4 id="clone-ç³»ç»Ÿè°ƒç”¨"><a href="#clone-ç³»ç»Ÿè°ƒç”¨" class="headerlink" title="clone()ç³»ç»Ÿè°ƒç”¨"></a>clone()ç³»ç»Ÿè°ƒç”¨</h4><p>é¦–å…ˆï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä¸€ä¸ªæœ€ç®€å•çš„clone()ç³»ç»Ÿè°ƒç”¨çš„ç¤ºä¾‹ï¼Œï¼ˆåé¢ï¼Œæˆ‘ä»¬çš„ç¨‹åºéƒ½ä¼šåŸºäºè¿™ä¸ªç¨‹åºåšä¿®æ”¹ï¼‰ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="C"><figure class="iseeu highlight /c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _GNU_SOURCE</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/wait.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sched.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;signal.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* å®šä¹‰ä¸€ä¸ªç»™ clone ç”¨çš„æ ˆï¼Œæ ˆå¤§å°1M */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> STACK_SIZE (1024 * 1024)</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">char</span> container_stack[STACK_SIZE];</span><br><span class="line"></span><br><span class="line"><span class="keyword">char</span>* <span class="keyword">const</span> container_args[] = &#123;</span><br><span class="line">    <span class="string">&quot;/bin/bash&quot;</span>,</span><br><span class="line">    <span class="literal">NULL</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">container_main</span><span class="params">(<span class="keyword">void</span>* arg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Container - inside the container!\n&quot;</span>);</span><br><span class="line">    <span class="comment">/* ç›´æ¥æ‰§è¡Œä¸€ä¸ªshellï¼Œä»¥ä¾¿æˆ‘ä»¬è§‚å¯Ÿè¿™ä¸ªè¿›ç¨‹ç©ºé—´é‡Œçš„èµ„æºæ˜¯å¦è¢«éš”ç¦»äº† */</span></span><br><span class="line">    execv(container_args[<span class="number">0</span>], container_args); </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Something&#x27;s wrong!\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Parent - start a container!\n&quot;</span>);</span><br><span class="line">    <span class="comment">/* è°ƒç”¨cloneå‡½æ•°ï¼Œå…¶ä¸­ä¼ å‡ºä¸€ä¸ªå‡½æ•°ï¼Œè¿˜æœ‰ä¸€ä¸ªæ ˆç©ºé—´çš„ï¼ˆä¸ºä»€ä¹ˆä¼ å°¾æŒ‡é’ˆï¼Œå› ä¸ºæ ˆæ˜¯åç€çš„ï¼‰ */</span></span><br><span class="line">    <span class="keyword">int</span> container_pid = clone(container_main, container_stack+STACK_SIZE, SIGCHLD, <span class="literal">NULL</span>);</span><br><span class="line">    <span class="comment">/* ç­‰å¾…å­è¿›ç¨‹ç»“æŸ */</span></span><br><span class="line">    waitpid(container_pid, <span class="literal">NULL</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Parent - container stopped!\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>ä»ä¸Šé¢çš„ç¨‹åºï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¿™å’ŒpthreadåŸºæœ¬ä¸Šæ˜¯ä¸€æ ·çš„ç©æ³•ã€‚ä½†æ˜¯ï¼Œå¯¹äºä¸Šé¢çš„ç¨‹åºï¼Œçˆ¶å­è¿›ç¨‹çš„è¿›ç¨‹ç©ºé—´æ˜¯æ²¡æœ‰ä»€ä¹ˆå·®åˆ«çš„ï¼Œçˆ¶è¿›ç¨‹èƒ½è®¿é—®åˆ°çš„å­è¿›ç¨‹ä¹Ÿèƒ½ã€‚</p>
<p>ä¸‹é¢ï¼Œ è®©æˆ‘ä»¬æ¥çœ‹å‡ ä¸ªä¾‹å­çœ‹çœ‹ï¼ŒLinuxçš„Namespaceæ˜¯ä»€ä¹ˆæ ·çš„ã€‚</p>
<h4 id="UTS-Namespace"><a href="#UTS-Namespace" class="headerlink" title="UTS Namespace"></a>UTS Namespace</h4><p>ä¸‹é¢çš„ä»£ç ï¼Œæˆ‘ç•¥å»äº†ä¸Šé¢é‚£äº›å¤´æ–‡ä»¶å’Œæ•°æ®ç»“æ„çš„å®šä¹‰ï¼Œåªæœ‰æœ€é‡è¦çš„éƒ¨åˆ†ã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="C"><figure class="iseeu highlight /c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">container_main</span><span class="params">(<span class="keyword">void</span>* arg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Container - inside the container!\n&quot;</span>);</span><br><span class="line">    sethostname(<span class="string">&quot;container&quot;</span>,<span class="number">10</span>); <span class="comment">/* è®¾ç½®hostname */</span></span><br><span class="line">    execv(container_args[<span class="number">0</span>], container_args);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Something&#x27;s wrong!\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Parent - start a container!\n&quot;</span>);</span><br><span class="line">    <span class="keyword">int</span> container_pid = clone(container_main, container_stack+STACK_SIZE, </span><br><span class="line">            CLONE_NEWUTS | SIGCHLD, <span class="literal">NULL</span>); <span class="comment">/*å¯ç”¨CLONE_NEWUTS Namespaceéš”ç¦» */</span></span><br><span class="line">    waitpid(container_pid, <span class="literal">NULL</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Parent - container stopped!\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<blockquote>
<p>è¿è¡Œä¸Šé¢çš„ç¨‹åºä½ ä¼šå‘ç°ï¼ˆéœ€è¦rootæƒé™ï¼‰ï¼Œå­è¿›ç¨‹çš„hostnameå˜æˆäº† containerã€‚</p>
</blockquote>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">hchen@ubuntu:~$ sudo ./uts</span><br><span class="line">Parent - start a container!</span><br><span class="line">Container - inside the container!</span><br><span class="line">root@container:~# hostname</span><br><span class="line">container</span><br><span class="line">root@container:~# uname -n</span><br><span class="line">container</span><br></pre></td></tr></table></figure></div>
<h4 id="IPC-Namespace"><a href="#IPC-Namespace" class="headerlink" title="IPC Namespace"></a>IPC Namespace</h4><p>IPCå…¨ç§° Inter-Process Communicationï¼Œæ˜¯Unix/Linuxä¸‹è¿›ç¨‹é—´é€šä¿¡çš„ä¸€ç§æ–¹å¼ï¼ŒIPCæœ‰å…±äº«å†…å­˜ã€ä¿¡å·é‡ã€æ¶ˆæ¯é˜Ÿåˆ—ç­‰æ–¹æ³•ã€‚æ‰€ä»¥ï¼Œä¸ºäº†éš”ç¦»ï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦æŠŠIPCç»™éš”ç¦»å¼€æ¥ï¼Œè¿™æ ·ï¼Œåªæœ‰åœ¨åŒä¸€ä¸ªNamespaceä¸‹çš„è¿›ç¨‹æ‰èƒ½ç›¸äº’é€šä¿¡ã€‚å¦‚æœä½ ç†Ÿæ‚‰IPCçš„åŸç†çš„è¯ï¼Œä½ ä¼šçŸ¥é“ï¼ŒIPCéœ€è¦æœ‰ä¸€ä¸ªå…¨å±€çš„IDï¼Œå³ç„¶æ˜¯å…¨å±€çš„ï¼Œé‚£ä¹ˆå°±æ„å‘³ç€æˆ‘ä»¬çš„Namespaceéœ€è¦å¯¹è¿™ä¸ªIDéš”ç¦»ï¼Œä¸èƒ½è®©åˆ«çš„Namespaceçš„è¿›ç¨‹çœ‹åˆ°ã€‚</p>
<p>è¦å¯åŠ¨IPCéš”ç¦»ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨è°ƒç”¨cloneæ—¶åŠ ä¸ŠCLONE_NEWIPCå‚æ•°å°±å¯ä»¥äº†ã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="C"><figure class="iseeu highlight /c"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> container_pid = clone(container_main, container_stack+STACK_SIZE, </span><br><span class="line">            CLONE_NEWUTS | CLONE_NEWIPC | SIGCHLD, <span class="literal">NULL</span>);</span><br></pre></td></tr></table></figure></div>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ªIPCçš„Queueï¼ˆå¦‚ä¸‹æ‰€ç¤ºï¼Œå…¨å±€çš„Queue IDæ˜¯0ï¼‰</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">hchen@ubuntu:~$ ipcmk -Q </span><br><span class="line">Message queue id: 0</span><br><span class="line"></span><br><span class="line">hchen@ubuntu:~$ ipcs -q</span><br><span class="line">------ Message Queues --------</span><br><span class="line">key        msqid      owner      perms      used-bytes   messages    </span><br><span class="line">0xd0d56eb2 0          hchen      644        0            0</span><br></pre></td></tr></table></figure></div>
<p>å¦‚æœæˆ‘ä»¬è¿è¡Œæ²¡æœ‰CLONE_NEWIPCçš„ç¨‹åºï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°ï¼Œåœ¨å­è¿›ç¨‹ä¸­è¿˜æ˜¯èƒ½çœ‹åˆ°è¿™ä¸ªå…¨å¯çš„IPC Queueã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">hchen@ubuntu:~$ sudo ./uts </span><br><span class="line">Parent - start a container!</span><br><span class="line">Container - inside the container!</span><br><span class="line"></span><br><span class="line">root@container:~# ipcs -q</span><br><span class="line"></span><br><span class="line">------ Message Queues --------</span><br><span class="line">key        msqid      owner      perms      used-bytes   messages    </span><br><span class="line">0xd0d56eb2 0          hchen      644        0            0</span><br></pre></td></tr></table></figure></div>
<p>ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬è¿è¡ŒåŠ ä¸Šäº†CLONE_NEWIPCçš„ç¨‹åºï¼Œæˆ‘ä»¬å°±ä¼šä¸‹é¢çš„ç»“æœï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">root@ubuntu:~$ sudo./ipc</span><br><span class="line">Parent - start a container!</span><br><span class="line">Container - inside the container!</span><br><span class="line"></span><br><span class="line">root@container:~/linux_namespace# ipcs -q</span><br><span class="line"></span><br><span class="line">------ Message Queues --------</span><br><span class="line">key        msqid      owner      perms      used-bytes   messages</span><br></pre></td></tr></table></figure></div>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°IPCå·²ç»è¢«éš”ç¦»äº†ã€‚</p>
<h4 id="PID-Namespace"><a href="#PID-Namespace" class="headerlink" title="PID Namespace"></a>PID Namespace</h4><p>æˆ‘ä»¬ç»§ç»­ä¿®æ”¹ä¸Šé¢çš„ç¨‹åºï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="C"><figure class="iseeu highlight /c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">container_main</span><span class="params">(<span class="keyword">void</span>* arg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">/* æŸ¥çœ‹å­è¿›ç¨‹çš„PIDï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å…¶è¾“å‡ºå­è¿›ç¨‹çš„ pid ä¸º 1 */</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Container [%5d] - inside the container!\n&quot;</span>, getpid());</span><br><span class="line">    sethostname(<span class="string">&quot;container&quot;</span>,<span class="number">10</span>);</span><br><span class="line">    execv(container_args[<span class="number">0</span>], container_args);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Something&#x27;s wrong!\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Parent [%5d] - start a container!\n&quot;</span>, getpid());</span><br><span class="line">    <span class="comment">/*å¯ç”¨PID namespace - CLONE_NEWPID*/</span></span><br><span class="line">    <span class="keyword">int</span> container_pid = clone(container_main, container_stack+STACK_SIZE, </span><br><span class="line">            CLONE_NEWUTS | CLONE_NEWPID | SIGCHLD, <span class="literal">NULL</span>); </span><br><span class="line">    waitpid(container_pid, <span class="literal">NULL</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Parent - container stopped!\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼ˆæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå­è¿›ç¨‹çš„pidæ˜¯1äº†ï¼‰ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">hchen@ubuntu:~$ sudo ./pid</span><br><span class="line">Parent [ 3474] - start a container!</span><br><span class="line">Container [ 1] - inside the container!</span><br><span class="line">root@container:~# echo $$</span><br><span class="line">1</span><br></pre></td></tr></table></figure></div>
<p>ä½ å¯èƒ½ä¼šé—®ï¼ŒPIDä¸º1æœ‰ä¸ªæ¯›ç”¨å•Šï¼Ÿæˆ‘ä»¬çŸ¥é“ï¼Œåœ¨ä¼ ç»Ÿçš„UNIXç³»ç»Ÿä¸­ï¼ŒPIDä¸º1çš„è¿›ç¨‹æ˜¯initï¼Œåœ°ä½éå¸¸ç‰¹æ®Šã€‚ä»–ä½œä¸ºæ‰€æœ‰è¿›ç¨‹çš„çˆ¶è¿›ç¨‹ï¼Œæœ‰å¾ˆå¤šç‰¹æƒï¼ˆæ¯”å¦‚ï¼šå±è”½ä¿¡å·ç­‰ï¼‰ï¼Œå¦å¤–ï¼Œå…¶è¿˜ä¼šä¸ºæ£€æŸ¥æ‰€æœ‰è¿›ç¨‹çš„çŠ¶æ€ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œå¦‚æœæŸä¸ªå­è¿›ç¨‹è„±ç¦»äº†çˆ¶è¿›ç¨‹ï¼ˆçˆ¶è¿›ç¨‹æ²¡æœ‰waitå®ƒï¼‰ï¼Œé‚£ä¹ˆinitå°±ä¼šè´Ÿè´£å›æ”¶èµ„æºå¹¶ç»“æŸè¿™ä¸ªå­è¿›ç¨‹ã€‚æ‰€ä»¥ï¼Œè¦åšåˆ°è¿›ç¨‹ç©ºé—´çš„éš”ç¦»ï¼Œé¦–å…ˆè¦åˆ›å»ºå‡ºPIDä¸º1çš„è¿›ç¨‹ï¼Œæœ€å¥½å°±åƒchrooté‚£æ ·ï¼ŒæŠŠå­è¿›ç¨‹çš„PIDåœ¨å®¹å™¨å†…å˜æˆ1ã€‚</p>
<p><strong>ä½†æ˜¯ï¼Œæˆ‘ä»¬ä¼šå‘ç°ï¼Œåœ¨å­è¿›ç¨‹çš„shellé‡Œè¾“å…¥ps,topç­‰å‘½ä»¤ï¼Œæˆ‘ä»¬è¿˜æ˜¯å¯ä»¥çœ‹å¾—åˆ°æ‰€æœ‰è¿›ç¨‹</strong>ã€‚è¯´æ˜å¹¶æ²¡æœ‰å®Œå…¨éš”ç¦»ã€‚è¿™æ˜¯å› ä¸ºï¼Œåƒps, topè¿™äº›å‘½ä»¤ä¼šå»è¯»/procæ–‡ä»¶ç³»ç»Ÿï¼Œæ‰€ä»¥ï¼Œå› ä¸º/procæ–‡ä»¶ç³»ç»Ÿåœ¨çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹éƒ½æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥è¿™äº›å‘½ä»¤æ˜¾ç¤ºçš„ä¸œè¥¿éƒ½æ˜¯ä¸€æ ·çš„ã€‚</p>
<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å¯¹æ–‡ä»¶ç³»ç»Ÿè¿›è¡Œéš”ç¦»ã€‚</p>
<h4 id="Mount-Namespace"><a href="#Mount-Namespace" class="headerlink" title="Mount Namespace"></a>Mount Namespace</h4><p>ä¸‹é¢çš„ä¾‹ç¨‹ä¸­ï¼Œæˆ‘ä»¬åœ¨å¯ç”¨äº†mount namespaceå¹¶åœ¨å­è¿›ç¨‹ä¸­é‡æ–°mountäº†/procæ–‡ä»¶ç³»ç»Ÿã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="C"><figure class="iseeu highlight /c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">container_main</span><span class="params">(<span class="keyword">void</span>* arg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Container [%5d] - inside the container!\n&quot;</span>, getpid());</span><br><span class="line">    sethostname(<span class="string">&quot;container&quot;</span>,<span class="number">10</span>);</span><br><span class="line">    <span class="comment">/* é‡æ–°mount procæ–‡ä»¶ç³»ç»Ÿåˆ° /procä¸‹ */</span></span><br><span class="line">    system(<span class="string">&quot;mount -t proc proc /proc&quot;</span>);</span><br><span class="line">    execv(container_args[<span class="number">0</span>], container_args);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Something&#x27;s wrong!\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Parent [%5d] - start a container!\n&quot;</span>, getpid());</span><br><span class="line">    <span class="comment">/* å¯ç”¨Mount Namespace - å¢åŠ CLONE_NEWNSå‚æ•° */</span></span><br><span class="line">    <span class="keyword">int</span> container_pid = clone(container_main, container_stack+STACK_SIZE, </span><br><span class="line">            CLONE_NEWUTS | CLONE_NEWPID | CLONE_NEWNS | SIGCHLD, <span class="literal">NULL</span>);</span><br><span class="line">    waitpid(container_pid, <span class="literal">NULL</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Parent - container stopped!\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>è¿è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">hchen@ubuntu:~$ sudo ./pid.mnt</span><br><span class="line">Parent [ 3502] - start a container!</span><br><span class="line">Container [    1] - inside the container!</span><br><span class="line">root@container:~# ps -elf </span><br><span class="line">F S UID        PID  PPID  C PRI  NI ADDR SZ WCHAN  STIME TTY          TIME CMD</span><br><span class="line">4 S root         1     0  0  80   0 -  6917 wait   19:55 pts/2    00:00:00 /bin/bash</span><br><span class="line">0 R root        14     1  0  80   0 -  5671 -      19:56 pts/2    00:00:00 ps -elf</span><br></pre></td></tr></table></figure></div>
<p>ä¸Šé¢ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°åªæœ‰ä¸¤ä¸ªè¿›ç¨‹ ï¼Œè€Œä¸”pid=1çš„è¿›ç¨‹æ˜¯æˆ‘ä»¬çš„/bin/bashã€‚æˆ‘ä»¬è¿˜å¯ä»¥çœ‹åˆ°/procç›®å½•ä¸‹ä¹Ÿå¹²å‡€äº†å¾ˆå¤šï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">root@container:~# ls /proc</span><br><span class="line">1          dma          key-users   net            sysvipc</span><br><span class="line">16         driver       kmsg        pagetypeinfo   timer_list</span><br><span class="line">acpi       execdomains  kpagecount  partitions     timer_stats</span><br><span class="line">asound     fb           kpageflags  sched_debug    tty</span><br><span class="line">buddyinfo  filesystems  loadavg     schedstat      uptime</span><br><span class="line">bus        fs           locks       scsi           version</span><br><span class="line">cgroups    interrupts   mdstat      self           version_signature</span><br><span class="line">cmdline    iomem        meminfo     slabinfo       vmallocinfo</span><br><span class="line">consoles   ioports      misc        softirqs       vmstat</span><br><span class="line">cpuinfo    irq          modules     stat           zoneinfo</span><br><span class="line">crypto     kallsyms     mounts      swaps</span><br><span class="line">devices    kcore        mpt         sys</span><br><span class="line">diskstats  keys         mtrr        sysrq-trigger</span><br></pre></td></tr></table></figure></div>
<p>ä¸‹å›¾ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹åˆ°åœ¨å­è¿›ç¨‹ä¸­çš„topå‘½ä»¤åªçœ‹å¾—åˆ°ä¸¤ä¸ªè¿›ç¨‹äº†ã€‚<br><img src="/2022/06/10/uncatalog/cl483pse2000038r7fnpqhzig/1.jpg" alt="1"><br>è¿™é‡Œï¼Œå¤šè¯´ä¸€ä¸‹ã€‚åœ¨é€šè¿‡CLONE_NEWNSåˆ›å»ºmount namespaceåï¼Œçˆ¶è¿›ç¨‹ä¼šæŠŠè‡ªå·±çš„æ–‡ä»¶ç»“æ„å¤åˆ¶ç»™å­è¿›ç¨‹ä¸­ã€‚è€Œå­è¿›ç¨‹ä¸­æ–°çš„namespaceä¸­çš„æ‰€æœ‰mountæ“ä½œéƒ½åªå½±å“è‡ªèº«çš„æ–‡ä»¶ç³»ç»Ÿï¼Œè€Œä¸å¯¹å¤–ç•Œäº§ç”Ÿä»»ä½•å½±å“ã€‚è¿™æ ·å¯ä»¥åšåˆ°æ¯”è¾ƒä¸¥æ ¼åœ°éš”ç¦»ã€‚</p>
<p>ä½ å¯èƒ½ä¼šé—®ï¼Œæˆ‘ä»¬æ˜¯ä¸æ˜¯è¿˜æœ‰åˆ«çš„ä¸€äº›æ–‡ä»¶ç³»ç»Ÿä¹Ÿéœ€è¦è¿™æ ·mount? æ˜¯çš„ã€‚</p>
<h5 id="Dockerçš„-Mount-Namespace"><a href="#Dockerçš„-Mount-Namespace" class="headerlink" title="Dockerçš„ Mount Namespace"></a>Dockerçš„ Mount Namespace</h5><p>ä¸‹é¢æˆ‘å°†å‘æ¼”ç¤ºä¸€ä¸ªâ€œå±±å¯¨é•œåƒâ€ï¼Œå…¶æ¨¡ä»¿äº†Dockerçš„Mount Namespaceã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªrootfsï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬éœ€è¦æŠŠæˆ‘ä»¬è¦åšçš„é•œåƒä¸­çš„é‚£äº›å‘½ä»¤ä»€ä¹ˆçš„copyåˆ°ä¸€ä¸ªrootfsçš„ç›®å½•ä¸‹ï¼Œæˆ‘ä»¬æ¨¡ä»¿Linuxæ„å»ºå¦‚ä¸‹çš„ç›®å½•ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">hchen@ubuntu:~/rootfs$ ls</span><br><span class="line">bin  dev  etc  home  lib  lib64  mnt  opt  proc  root  run  sbin  sys  tmp  usr  var</span><br></pre></td></tr></table></figure></div>
<p>ç„¶åï¼Œæˆ‘ä»¬æŠŠä¸€äº›æˆ‘ä»¬éœ€è¦çš„å‘½ä»¤copyåˆ° rootfs/binç›®å½•ä¸­ï¼ˆshå‘½ä»¤å¿…éœ€è¦copyè¿›å»ï¼Œä¸ç„¶æˆ‘ä»¬æ— æ³• chroot ï¼‰</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">hchen@ubuntu:~/rootfs$ ls ./bin ./usr/bin</span><br><span class="line"> </span><br><span class="line">./bin:</span><br><span class="line">bash   chown  gzip      less  mount       netstat  rm     tabs  tee      top       tty</span><br><span class="line">cat    cp     hostname  ln    mountpoint  ping     sed    tac   test     touch     umount</span><br><span class="line">chgrp  echo   ip        ls    mv          ps       sh     tail  timeout  tr        uname</span><br><span class="line">chmod  grep   kill      more  nc          pwd      sleep  tar   toe      truncate  which</span><br><span class="line"></span><br><span class="line">./usr/bin:</span><br><span class="line">awk  env  groups  head  id  mesg  sort  strace  tail  top  uniq  vi  wc  xargs</span><br></pre></td></tr></table></figure></div>
<p>æ³¨ï¼šä½ å¯ä»¥ä½¿ç”¨lddå‘½ä»¤æŠŠè¿™äº›å‘½ä»¤ç›¸å…³çš„é‚£äº›soæ–‡ä»¶copyåˆ°å¯¹åº”çš„ç›®å½•ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">hchen@ubuntu:~/rootfs/bin$ ldd bash</span><br><span class="line">  linux-vdso.so.1 =&gt;  (0x00007fffd33fc000)</span><br><span class="line">  libtinfo.so.5 =&gt; /lib/x86_64-linux-gnu/libtinfo.so.5 (0x00007f4bd42c2000)</span><br><span class="line">  libdl.so.2 =&gt; /lib/x86_64-linux-gnu/libdl.so.2 (0x00007f4bd40be000)</span><br><span class="line">  libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007f4bd3cf8000)</span><br><span class="line">  /lib64/ld-linux-x86-64.so.2 (0x00007f4bd4504000)</span><br></pre></td></tr></table></figure></div>

<p>ä¸‹é¢æ˜¯æˆ‘çš„rootfsä¸­çš„ä¸€äº›soæ–‡ä»¶ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">hchen@ubuntu:~/rootfs$ ls ./lib64 ./lib/x86_64-linux-gnu/</span><br><span class="line"></span><br><span class="line">./lib64:</span><br><span class="line">ld-linux-x86-64.so.2</span><br><span class="line"></span><br><span class="line">./lib/x86_64-linux-gnu/:</span><br><span class="line">libacl.so.1      libmemusage.so         libnss_files-2.19.so    libpython3.4m.so.1</span><br><span class="line">libacl.so.1.1.0  libmount.so.1          libnss_files.so.2       libpython3.4m.so.1.0</span><br><span class="line">libattr.so.1     libmount.so.1.1.0      libnss_hesiod-2.19.so   libresolv-2.19.so</span><br><span class="line">libblkid.so.1    libm.so.6              libnss_hesiod.so.2      libresolv.so.2</span><br><span class="line">libc-2.19.so     libncurses.so.5        libnss_nis-2.19.so      libselinux.so.1</span><br><span class="line">libcap.a         libncurses.so.5.9      libnss_nisplus-2.19.so  libtinfo.so.5</span><br><span class="line">libcap.so        libncursesw.so.5       libnss_nisplus.so.2     libtinfo.so.5.9</span><br><span class="line">libcap.so.2      libncursesw.so.5.9     libnss_nis.so.2         libutil-2.19.so</span><br><span class="line">libcap.so.2.24   libnsl-2.19.so         libpcre.so.3            libutil.so.1</span><br><span class="line">libc.so.6        libnsl.so.1            libprocps.so.3          libuuid.so.1</span><br><span class="line">libdl-2.19.so    libnss_compat-2.19.so  libpthread-2.19.so      libz.so.1</span><br><span class="line">libdl.so.2       libnss_compat.so.2     libpthread.so.0</span><br><span class="line">libgpm.so.2      libnss_dns-2.19.so     libpython2.7.so.1</span><br><span class="line">libm-2.19.so     libnss_dns.so.2        libpython2.7.so.1.0</span><br></pre></td></tr></table></figure></div>
<p>åŒ…æ‹¬è¿™äº›å‘½ä»¤ä¾èµ–çš„ä¸€äº›é…ç½®æ–‡ä»¶ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">hchen@ubuntu:~/rootfs$ ls ./etc</span><br><span class="line">bash.bashrc  group  hostname  hosts  ld.so.cache  nsswitch.conf  passwd  profile  </span><br><span class="line">resolv.conf  shadow</span><br></pre></td></tr></table></figure></div>
<p>ä½ ç°åœ¨ä¼šè¯´ï¼Œæˆ‘é ï¼Œæœ‰äº›é…ç½®æˆ‘å¸Œæœ›æ˜¯åœ¨å®¹å™¨èµ·åŠ¨æ—¶ç»™ä»–è®¾ç½®çš„ï¼Œè€Œä¸æ˜¯hard codeåœ¨é•œåƒä¸­çš„ã€‚æ¯”å¦‚ï¼š/etc/hostsï¼Œ/etc/hostnameï¼Œè¿˜æœ‰DNSçš„/etc/resolv.confæ–‡ä»¶ã€‚å¥½çš„ã€‚é‚£æˆ‘ä»¬åœ¨rootfså¤–é¢ï¼Œæˆ‘ä»¬å†åˆ›å»ºä¸€ä¸ªconfç›®å½•ï¼ŒæŠŠè¿™äº›æ–‡ä»¶æ”¾åˆ°è¿™ä¸ªç›®å½•ä¸­ã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">hchen@ubuntu:~$ ls ./conf</span><br><span class="line">hostname     hosts     resolv.conf</span><br></pre></td></tr></table></figure></div>
<p>è¿™æ ·ï¼Œæˆ‘ä»¬çš„çˆ¶è¿›ç¨‹å°±å¯ä»¥åŠ¨æ€åœ°è®¾ç½®å®¹å™¨éœ€è¦çš„è¿™äº›æ–‡ä»¶çš„é…ç½®ï¼Œ ç„¶åå†æŠŠä»–ä»¬mountè¿›å®¹å™¨ï¼Œè¿™æ ·ï¼Œå®¹å™¨çš„é•œåƒä¸­çš„é…ç½®å°±æ¯”è¾ƒçµæ´»äº†ã€‚</p>
<p>å¥½äº†ï¼Œç»ˆäºåˆ°äº†æˆ‘ä»¬çš„ç¨‹åºã€‚</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _GNU_SOURCE</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys types.h=&quot;&quot;&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys wait.h=&quot;&quot;&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys mount.h=&quot;&quot;&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sched.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;signal.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> STACK_SIZE (1024 * 1024)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">char</span> container_stack[STACK_SIZE];</span><br><span class="line"><span class="keyword">char</span>* <span class="keyword">const</span> container_args[] = &#123;</span><br><span class="line">    <span class="string">&quot;/bin/bash&quot;</span>,</span><br><span class="line">    <span class="string">&quot;-l&quot;</span>,</span><br><span class="line">    <span class="literal">NULL</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">container_main</span><span class="params">(<span class="keyword">void</span>* arg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Container [%5d] - inside the container!\n&quot;</span>, getpid());</span><br><span class="line"></span><br><span class="line">    <span class="comment">//set hostname</span></span><br><span class="line">    sethostname(<span class="string">&quot;container&quot;</span>,<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//remount &quot;/proc&quot; to make sure the &quot;top&quot; and &quot;ps&quot; show container&#x27;s information</span></span><br><span class="line">    <span class="keyword">if</span> (mount(<span class="string">&quot;proc&quot;</span>, <span class="string">&quot;rootfs/proc&quot;</span>, <span class="string">&quot;proc&quot;</span>, <span class="number">0</span>, <span class="literal">NULL</span>) !=<span class="number">0</span> ) &#123;</span><br><span class="line">        perror(<span class="string">&quot;proc&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (mount(<span class="string">&quot;sysfs&quot;</span>, <span class="string">&quot;rootfs/sys&quot;</span>, <span class="string">&quot;sysfs&quot;</span>, <span class="number">0</span>, <span class="literal">NULL</span>)!=<span class="number">0</span>) &#123;</span><br><span class="line">        perror(<span class="string">&quot;sys&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (mount(<span class="string">&quot;none&quot;</span>, <span class="string">&quot;rootfs/tmp&quot;</span>, <span class="string">&quot;tmpfs&quot;</span>, <span class="number">0</span>, <span class="literal">NULL</span>)!=<span class="number">0</span>) &#123;</span><br><span class="line">        perror(<span class="string">&quot;tmp&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (mount(<span class="string">&quot;udev&quot;</span>, <span class="string">&quot;rootfs/dev&quot;</span>, <span class="string">&quot;devtmpfs&quot;</span>, <span class="number">0</span>, <span class="literal">NULL</span>)!=<span class="number">0</span>) &#123;</span><br><span class="line">        perror(<span class="string">&quot;dev&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (mount(<span class="string">&quot;devpts&quot;</span>, <span class="string">&quot;rootfs/dev/pts&quot;</span>, <span class="string">&quot;devpts&quot;</span>, <span class="number">0</span>, <span class="literal">NULL</span>)!=<span class="number">0</span>) &#123;</span><br><span class="line">        perror(<span class="string">&quot;dev/pts&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (mount(<span class="string">&quot;shm&quot;</span>, <span class="string">&quot;rootfs/dev/shm&quot;</span>, <span class="string">&quot;tmpfs&quot;</span>, <span class="number">0</span>, <span class="literal">NULL</span>)!=<span class="number">0</span>) &#123;</span><br><span class="line">        perror(<span class="string">&quot;dev/shm&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (mount(<span class="string">&quot;tmpfs&quot;</span>, <span class="string">&quot;rootfs/run&quot;</span>, <span class="string">&quot;tmpfs&quot;</span>, <span class="number">0</span>, <span class="literal">NULL</span>)!=<span class="number">0</span>) &#123;</span><br><span class="line">        perror(<span class="string">&quot;run&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/* </span></span><br><span class="line"><span class="comment">     * æ¨¡ä»¿Dockerçš„ä»å¤–å‘å®¹å™¨é‡Œmountç›¸å…³çš„é…ç½®æ–‡ä»¶ </span></span><br><span class="line"><span class="comment">     * ä½ å¯ä»¥æŸ¥çœ‹ï¼š/var/lib/docker/containers/&lt;container_id&gt;/ç›®å½•ï¼Œ</span></span><br><span class="line"><span class="comment">     * ä½ ä¼šçœ‹åˆ°dockerçš„è¿™äº›æ–‡ä»¶çš„ã€‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">if</span> (mount(<span class="string">&quot;conf/hosts&quot;</span>, <span class="string">&quot;rootfs/etc/hosts&quot;</span>, <span class="string">&quot;none&quot;</span>, MS_BIND, <span class="literal">NULL</span>)!=<span class="number">0</span> ||</span><br><span class="line">          mount(<span class="string">&quot;conf/hostname&quot;</span>, <span class="string">&quot;rootfs/etc/hostname&quot;</span>, <span class="string">&quot;none&quot;</span>, MS_BIND, <span class="literal">NULL</span>)!=<span class="number">0</span> ||</span><br><span class="line">          mount(<span class="string">&quot;conf/resolv.conf&quot;</span>, <span class="string">&quot;rootfs/etc/resolv.conf&quot;</span>, <span class="string">&quot;none&quot;</span>, MS_BIND, <span class="literal">NULL</span>)!=<span class="number">0</span> ) &#123;</span><br><span class="line">        perror(<span class="string">&quot;conf&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/* æ¨¡ä»¿docker runå‘½ä»¤ä¸­çš„ -v, --volume=[] å‚æ•°å¹²çš„äº‹ */</span></span><br><span class="line">    <span class="keyword">if</span> (mount(<span class="string">&quot;/tmp/t1&quot;</span>, <span class="string">&quot;rootfs/mnt&quot;</span>, <span class="string">&quot;none&quot;</span>, MS_BIND, <span class="literal">NULL</span>)!=<span class="number">0</span>) &#123;</span><br><span class="line">        perror(<span class="string">&quot;mnt&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* chroot éš”ç¦»ç›®å½• */</span></span><br><span class="line">    <span class="keyword">if</span> ( chdir(<span class="string">&quot;./rootfs&quot;</span>) != <span class="number">0</span> || chroot(<span class="string">&quot;./&quot;</span>) != <span class="number">0</span> )&#123;</span><br><span class="line">        perror(<span class="string">&quot;chdir/chroot&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    execv(container_args[<span class="number">0</span>], container_args);</span><br><span class="line">    perror(<span class="string">&quot;exec&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Something&#x27;s wrong!\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Parent [%5d] - start a container!\n&quot;</span>, getpid());</span><br><span class="line">    <span class="keyword">int</span> container_pid = clone(container_main, container_stack+STACK_SIZE, </span><br><span class="line">            CLONE_NEWUTS | CLONE_NEWIPC | CLONE_NEWPID | CLONE_NEWNS | SIGCHLD, <span class="literal">NULL</span>);</span><br><span class="line">    waitpid(container_pid, <span class="literal">NULL</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Parent - container stopped!\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/container_id&gt;&lt;/unistd.h&gt;&lt;/signal.h&gt;&lt;/sched.h&gt;&lt;/stdio.h&gt;&lt;/sys&gt;&lt;/sys&gt;&lt;/sys&gt;</span><br></pre></td></tr></table></figure>

<p>sudoè¿è¡Œä¸Šé¢çš„ç¨‹åºï¼Œä½ ä¼šçœ‹åˆ°ä¸‹é¢çš„æŒ‚è½½ä¿¡æ¯ä»¥åŠä¸€ä¸ªæ‰€è°“çš„â€œé•œåƒâ€ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">hchen@ubuntu:~$ sudo ./mount </span><br><span class="line">Parent [ 4517] - start a container!</span><br><span class="line">Container [    1] - inside the container!</span><br><span class="line">root@container:/# mount</span><br><span class="line">proc on /proc type proc (rw,relatime)</span><br><span class="line">sysfs on /sys type sysfs (rw,relatime)</span><br><span class="line">none on /tmp type tmpfs (rw,relatime)</span><br><span class="line">udev on /dev type devtmpfs (rw,relatime,size=493976k,nr_inodes=123494,mode=755)</span><br><span class="line">devpts on /dev/pts type devpts (rw,relatime,mode=600,ptmxmode=000)</span><br><span class="line">tmpfs on /run type tmpfs (rw,relatime)</span><br><span class="line">/dev/disk/by-uuid/18086e3b-d805-4515-9e91-7efb2fe5c0e2 on /etc/hosts type ext4 (rw,relatime,errors=remount-ro,data=ordered)</span><br><span class="line">/dev/disk/by-uuid/18086e3b-d805-4515-9e91-7efb2fe5c0e2 on /etc/hostname type ext4 (rw,relatime,errors=remount-ro,data=ordered)</span><br><span class="line">/dev/disk/by-uuid/18086e3b-d805-4515-9e91-7efb2fe5c0e2 on /etc/resolv.conf type ext4 (rw,relatime,errors=remount-ro,data=ordered)</span><br><span class="line"></span><br><span class="line">root@container:/# ls /bin /usr/bin</span><br><span class="line">/bin:</span><br><span class="line">bash   chmod  echo  hostname  less  more  mv   ping  rm   sleep  tail  test    top   truncate  uname</span><br><span class="line">cat    chown  grep  ip        ln    mount  nc   ps    sed  tabs   tar   timeout  touch  tty     which</span><br><span class="line">chgrp  cp     gzip  kill      ls    mountpoint  netstat  pwd   sh   tac    tee   toe    tr   umount</span><br><span class="line"></span><br><span class="line">/usr/bin:</span><br><span class="line">awk  env  groups  head  id  mesg  sort  strace  tail  top  uniq  vi  wc  xargs</span><br></pre></td></tr></table></figure></div>
<p>å…³äºå¦‚ä½•åšä¸€ä¸ªchrootçš„ç›®å½•ï¼Œè¿™é‡Œæœ‰ä¸ªå·¥å…·å«<a href="https://wiki.ubuntu.com/DebootstrapChroot" title="Front-end web development">DebootstrapChroot</a>ä½ å¯ä»¥é¡ºç€é“¾æ¥å»çœ‹çœ‹ï¼ˆè‹±æ–‡çš„å“¦ï¼‰</p>
<h4 id="User-Namespace"><a href="#User-Namespace" class="headerlink" title="User Namespace"></a>User Namespace</h4><p>User Namespaceä¸»è¦æ˜¯ç”¨äº†CLONE_NEWUSERçš„å‚æ•°ã€‚ä½¿ç”¨äº†è¿™ä¸ªå‚æ•°åï¼Œå†…éƒ¨çœ‹åˆ°çš„UIDå’ŒGIDå·²ç»ä¸å¤–éƒ¨ä¸åŒäº†ï¼Œé»˜è®¤æ˜¾ç¤ºä¸º65534ã€‚é‚£æ˜¯å› ä¸ºå®¹å™¨æ‰¾ä¸åˆ°å…¶çœŸæ­£çš„UIDæ‰€ä»¥ï¼Œè®¾ç½®ä¸Šäº†æœ€å¤§çš„UIDï¼ˆå…¶è®¾ç½®å®šä¹‰åœ¨/proc/sys/kernel/overflowuidï¼‰ã€‚</p>
<p>è¦æŠŠå®¹å™¨ä¸­çš„uidå’ŒçœŸå®ç³»ç»Ÿçš„uidç»™æ˜ å°„åœ¨ä¸€èµ·ï¼Œéœ€è¦ä¿®æ”¹ /proc/<pid>/uid_map å’Œ /proc/<pid>/gid_map è¿™ä¸¤ä¸ªæ–‡ä»¶ã€‚è¿™ä¸¤ä¸ªæ–‡ä»¶çš„æ ¼å¼ä¸ºï¼š</pid></pid></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="TEXT"><figure class="iseeu highlight /text"><table><tr><td class="code"><pre><span class="line">ID-inside-ns ID-outside-ns length</span><br></pre></td></tr></table></figure></div>
<p>å…¶ä¸­ï¼š</p>
<ul>
<li>ç¬¬ä¸€ä¸ªå­—æ®µID-inside-nsè¡¨ç¤ºåœ¨å®¹å™¨æ˜¾ç¤ºçš„UIDæˆ–GIDï¼Œ</li>
<li>ç¬¬äºŒä¸ªå­—æ®µID-outside-nsè¡¨ç¤ºå®¹å™¨å¤–æ˜ å°„çš„çœŸå®çš„UIDæˆ–GIDã€‚</li>
<li>ç¬¬ä¸‰ä¸ªå­—æ®µè¡¨ç¤ºæ˜ å°„çš„èŒƒå›´ï¼Œä¸€èˆ¬å¡«1ï¼Œè¡¨ç¤ºä¸€ä¸€å¯¹åº”</li>
</ul>
<p>æ¯”å¦‚ï¼ŒæŠŠçœŸå®çš„uid=1000æ˜ å°„æˆå®¹å™¨å†…çš„uid=0</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> cat /proc/2465/uid_map</span></span><br><span class="line">         0       1000          1</span><br></pre></td></tr></table></figure></div>
<p>å†æ¯”å¦‚ä¸‹é¢çš„ç¤ºä¾‹ï¼šè¡¨ç¤ºæŠŠnamespaceå†…éƒ¨ä»0å¼€å§‹çš„uidæ˜ å°„åˆ°å¤–éƒ¨ä»0å¼€å§‹çš„uidï¼Œå…¶æœ€å¤§èŒƒå›´æ˜¯æ— ç¬¦å·32ä½æ•´å½¢</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> cat /proc/$$/uid_map</span></span><br><span class="line">         0          0          4294967295</span><br></pre></td></tr></table></figure></div>

<p>å¦å¤–ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼š</p>
<ul>
<li>å†™è¿™ä¸¤ä¸ªæ–‡ä»¶çš„è¿›ç¨‹éœ€è¦è¿™ä¸ªnamespaceä¸­çš„CAP_SETUID (CAP_SETGID)æƒé™ï¼ˆå¯å‚çœ‹<a href="https://man7.org/linux/man-pages/man7/capabilities.7.html" title="Front-end web development">Capabilities</a>ï¼‰</li>
<li>å†™å…¥çš„è¿›ç¨‹å¿…é¡»æ˜¯æ­¤user namespaceçš„çˆ¶æˆ–å­çš„user namespaceè¿›ç¨‹ã€‚</li>
<li>å¦å¤–éœ€è¦æ»¡å¦‚ä¸‹æ¡ä»¶ä¹‹ä¸€ï¼š1ï¼‰çˆ¶è¿›ç¨‹å°†effective uid/gidæ˜ å°„åˆ°å­è¿›ç¨‹çš„user namespaceä¸­ï¼Œ2ï¼‰çˆ¶è¿›ç¨‹å¦‚æœæœ‰CAP_SETUID/CAP_SETGIDæƒé™ï¼Œé‚£ä¹ˆå®ƒå°†å¯ä»¥æ˜ å°„åˆ°çˆ¶è¿›ç¨‹ä¸­çš„ä»»ä¸€uid/gidã€‚</li>
</ul>
<p>è¿™äº›è§„åˆ™çœ‹ç€éƒ½çƒ¦ï¼Œæˆ‘ä»¬æ¥çœ‹ç¨‹åºå§ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="C"><figure class="iseeu highlight /c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _GNU_SOURCE</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/wait.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/mount.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/capability.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sched.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;signal.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> STACK_SIZE (1024 * 1024)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">char</span> container_stack[STACK_SIZE];</span><br><span class="line"><span class="keyword">char</span>* <span class="keyword">const</span> container_args[] = &#123;</span><br><span class="line">    <span class="string">&quot;/bin/bash&quot;</span>,</span><br><span class="line">    <span class="literal">NULL</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> pipefd[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">set_map</span><span class="params">(<span class="keyword">char</span>* file, <span class="keyword">int</span> inside_id, <span class="keyword">int</span> outside_id, <span class="keyword">int</span> len)</span> </span>&#123;</span><br><span class="line">    FILE* mapfd = fopen(file, <span class="string">&quot;w&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (<span class="literal">NULL</span> == mapfd) &#123;</span><br><span class="line">        perror(<span class="string">&quot;open file error&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">fprintf</span>(mapfd, <span class="string">&quot;%d %d %d&quot;</span>, inside_id, outside_id, len);</span><br><span class="line">    fclose(mapfd);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">set_uid_map</span><span class="params">(<span class="keyword">pid_t</span> pid, <span class="keyword">int</span> inside_id, <span class="keyword">int</span> outside_id, <span class="keyword">int</span> len)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span> file[<span class="number">256</span>];</span><br><span class="line">    <span class="built_in">sprintf</span>(file, <span class="string">&quot;/proc/%d/uid_map&quot;</span>, pid);</span><br><span class="line">    set_map(file, inside_id, outside_id, len);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">set_gid_map</span><span class="params">(<span class="keyword">pid_t</span> pid, <span class="keyword">int</span> inside_id, <span class="keyword">int</span> outside_id, <span class="keyword">int</span> len)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span> file[<span class="number">256</span>];</span><br><span class="line">    <span class="built_in">sprintf</span>(file, <span class="string">&quot;/proc/%d/gid_map&quot;</span>, pid);</span><br><span class="line">    set_map(file, inside_id, outside_id, len);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">container_main</span><span class="params">(<span class="keyword">void</span>* arg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Container [%5d] - inside the container!\n&quot;</span>, getpid());</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Container: eUID = %ld;  eGID = %ld, UID=%ld, GID=%ld\n&quot;</span>,</span><br><span class="line">            (<span class="keyword">long</span>) geteuid(), (<span class="keyword">long</span>) getegid(), (<span class="keyword">long</span>) getuid(), (<span class="keyword">long</span>) getgid());</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* ç­‰å¾…çˆ¶è¿›ç¨‹é€šçŸ¥åå†å¾€ä¸‹æ‰§è¡Œï¼ˆè¿›ç¨‹é—´çš„åŒæ­¥ï¼‰ */</span></span><br><span class="line">    <span class="keyword">char</span> ch;</span><br><span class="line">    close(pipefd[<span class="number">1</span>]);</span><br><span class="line">    read(pipefd[<span class="number">0</span>], &amp;ch, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Container [%5d] - setup hostname!\n&quot;</span>, getpid());</span><br><span class="line">    <span class="comment">//set hostname</span></span><br><span class="line">    sethostname(<span class="string">&quot;container&quot;</span>,<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//remount &quot;/proc&quot; to make sure the &quot;top&quot; and &quot;ps&quot; show container&#x27;s information</span></span><br><span class="line">    mount(<span class="string">&quot;proc&quot;</span>, <span class="string">&quot;/proc&quot;</span>, <span class="string">&quot;proc&quot;</span>, <span class="number">0</span>, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    execv(container_args[<span class="number">0</span>], container_args);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Something&#x27;s wrong!\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> gid=getgid(), uid=getuid();</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Parent: eUID = %ld;  eGID = %ld, UID=%ld, GID=%ld\n&quot;</span>,</span><br><span class="line">            (<span class="keyword">long</span>) geteuid(), (<span class="keyword">long</span>) getegid(), (<span class="keyword">long</span>) getuid(), (<span class="keyword">long</span>) getgid());</span><br><span class="line"></span><br><span class="line">    pipe(pipefd);</span><br><span class="line"> </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Parent [%5d] - start a container!\n&quot;</span>, getpid());</span><br><span class="line"></span><br><span class="line">    <span class="keyword">int</span> container_pid = clone(container_main, container_stack+STACK_SIZE, </span><br><span class="line">            CLONE_NEWUTS | CLONE_NEWPID | CLONE_NEWNS | CLONE_NEWUSER | SIGCHLD, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Parent [%5d] - Container [%5d]!\n&quot;</span>, getpid(), container_pid);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//To map the uid/gid, </span></span><br><span class="line">    <span class="comment">//   we need edit the /proc/PID/uid_map (or /proc/PID/gid_map) in parent</span></span><br><span class="line">    <span class="comment">//The file format is</span></span><br><span class="line">    <span class="comment">//   ID-inside-ns   ID-outside-ns   length</span></span><br><span class="line">    <span class="comment">//if no mapping, </span></span><br><span class="line">    <span class="comment">//   the uid will be taken from /proc/sys/kernel/overflowuid</span></span><br><span class="line">    <span class="comment">//   the gid will be taken from /proc/sys/kernel/overflowgid</span></span><br><span class="line">    set_uid_map(container_pid, <span class="number">0</span>, uid, <span class="number">1</span>);</span><br><span class="line">    set_gid_map(container_pid, <span class="number">0</span>, gid, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Parent [%5d] - user/group mapping done!\n&quot;</span>, getpid());</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* é€šçŸ¥å­è¿›ç¨‹ */</span></span><br><span class="line">    close(pipefd[<span class="number">1</span>]);</span><br><span class="line"></span><br><span class="line">    waitpid(container_pid, <span class="literal">NULL</span>, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Parent - container stopped!\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>ä¸Šé¢çš„ç¨‹åºï¼Œæˆ‘ä»¬ç”¨äº†ä¸€ä¸ªpipeæ¥å¯¹çˆ¶å­è¿›ç¨‹è¿›è¡ŒåŒæ­¥ï¼Œä¸ºä»€ä¹ˆè¦è¿™æ ·åšï¼Ÿå› ä¸ºå­è¿›ç¨‹ä¸­æœ‰ä¸€ä¸ªexecvçš„ç³»ç»Ÿè°ƒç”¨ï¼Œè¿™ä¸ªç³»ç»Ÿè°ƒç”¨ä¼šæŠŠå½“å‰å­è¿›ç¨‹çš„è¿›ç¨‹ç©ºé—´ç»™å…¨éƒ¨è¦†ç›–æ‰ï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨execvä¹‹å‰å°±åšå¥½user namespaceçš„uid/gidçš„æ˜ å°„ï¼Œè¿™æ ·ï¼Œexecvè¿è¡Œçš„/bin/bashå°±ä¼šå› ä¸ºæˆ‘ä»¬è®¾ç½®äº†uidä¸º0çš„inside-uidè€Œå˜æˆ#å·çš„æç¤ºç¬¦ã€‚</p>
<p>æ•´ä¸ªç¨‹åºçš„è¿è¡Œæ•ˆæœå¦‚ä¸‹ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">hchen@ubuntu:~$ id</span><br><span class="line">uid=1000(hchen) gid=1000(hchen) groups=1000(hchen)</span><br><span class="line"></span><br><span class="line">hchen@ubuntu:~$ ./user #&lt;--ä»¥hchenç”¨æˆ·è¿è¡Œ</span><br><span class="line">Parent: eUID = 1000;  eGID = 1000, UID=1000, GID=1000 </span><br><span class="line">Parent [ 3262] - start a container!</span><br><span class="line">Parent [ 3262] - Container [ 3263]!</span><br><span class="line">Parent [ 3262] - user/group mapping done!</span><br><span class="line">Container [    1] - inside the container!</span><br><span class="line">Container: eUID = 0;  eGID = 0, UID=0, GID=0 #&lt;---Containeré‡Œçš„UID/GIDéƒ½ä¸º0äº†</span><br><span class="line">Container [    1] - setup hostname!</span><br><span class="line"></span><br><span class="line">root@container:~# id #&lt;----æˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®¹å™¨é‡Œçš„ç”¨æˆ·å’Œå‘½ä»¤è¡Œæç¤ºç¬¦æ˜¯rootç”¨æˆ·äº†</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root),65534(nogroup)</span><br></pre></td></tr></table></figure></div>
<p>è™½ç„¶å®¹å™¨é‡Œæ˜¯rootï¼Œä½†å…¶å®è¿™ä¸ªå®¹å™¨çš„/bin/bashè¿›ç¨‹æ˜¯ä»¥ä¸€ä¸ªæ™®é€šç”¨æˆ·hchenæ¥è¿è¡Œçš„ã€‚è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬å®¹å™¨çš„å®‰å…¨æ€§ä¼šå¾—åˆ°æé«˜ã€‚</p>
<p>æˆ‘ä»¬æ³¨æ„åˆ°ï¼ŒUser Namespaceæ˜¯ä»¥æ™®é€šç”¨æˆ·è¿è¡Œï¼Œä½†æ˜¯åˆ«çš„Namespaceéœ€è¦rootæƒé™ï¼Œé‚£ä¹ˆï¼Œå¦‚æœæˆ‘è¦åŒæ—¶ä½¿ç”¨å¤šä¸ªNamespaceï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬å…ˆç”¨ä¸€èˆ¬ç”¨æˆ·åˆ›å»ºUser Namespaceï¼Œç„¶åæŠŠè¿™ä¸ªä¸€èˆ¬ç”¨æˆ·æ˜ å°„æˆrootï¼Œåœ¨å®¹å™¨å†…ç”¨rootæ¥åˆ›å»ºå…¶å®ƒçš„Namesapceã€‚</p>
<h4 id="Network-Namespace"><a href="#Network-Namespace" class="headerlink" title="Network Namespace"></a>Network Namespace</h4><p>Networkçš„Namespaceæ¯”è¾ƒå•°å—¦ã€‚åœ¨Linuxä¸‹ï¼Œæˆ‘ä»¬ä¸€èˆ¬ç”¨ipå‘½ä»¤åˆ›å»ºNetwork Namespaceï¼ˆDockerçš„æºç ä¸­ï¼Œå®ƒæ²¡æœ‰ç”¨ipå‘½ä»¤ï¼Œè€Œæ˜¯è‡ªå·±å®ç°äº†ipå‘½ä»¤å†…çš„ä¸€äº›åŠŸèƒ½â€”â€”æ˜¯ç”¨äº†Raw Socketå‘äº›â€œå¥‡æ€ªâ€çš„æ•°æ®ï¼Œå‘µå‘µï¼‰ã€‚è¿™é‡Œï¼Œæˆ‘è¿˜æ˜¯ç”¨ipå‘½ä»¤è®²è§£ä¸€ä¸‹ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆçœ‹ä¸ªå›¾ï¼Œä¸‹é¢è¿™ä¸ªå›¾åŸºæœ¬ä¸Šå°±æ˜¯Dockeråœ¨å®¿ä¸»æœºä¸Šçš„ç½‘ç»œç¤ºæ„å›¾ï¼ˆå…¶ä¸­çš„ç‰©ç†ç½‘å¡å¹¶ä¸å‡†ç¡®ï¼Œå› ä¸ºdockerå¯èƒ½ä¼šè¿è¡Œåœ¨ä¸€ä¸ªVMä¸­ï¼Œæ‰€ä»¥ï¼Œè¿™é‡Œæ‰€è°“çš„â€œç‰©ç†ç½‘å¡â€å…¶å®ä¹Ÿå°±æ˜¯ä¸€ä¸ªæœ‰å¯ä»¥è·¯ç”±çš„IPçš„ç½‘å¡<br><img src="/2022/06/10/uncatalog/cl483pse2000038r7fnpqhzig/2.jpg" alt="2.jpg"><br>ä¸Šå›¾ä¸­ï¼ŒDockerä½¿ç”¨äº†ä¸€ä¸ªç§æœ‰ç½‘æ®µï¼Œ172.40.1.0ï¼Œdockerè¿˜å¯èƒ½ä¼šä½¿ç”¨10.0.0.0å’Œ192.168.0.0è¿™ä¸¤ä¸ªç§æœ‰ç½‘æ®µï¼Œå…³é”®çœ‹ä½ çš„è·¯ç”±è¡¨ä¸­æ˜¯å¦é…ç½®äº†ï¼Œå¦‚æœæ²¡æœ‰é…ç½®ï¼Œå°±ä¼šä½¿ç”¨ï¼Œå¦‚æœä½ çš„è·¯ç”±è¡¨é…ç½®äº†æ‰€æœ‰ç§æœ‰ç½‘æ®µï¼Œé‚£ä¹ˆdockerå¯åŠ¨æ—¶å°±ä¼šå‡ºé”™äº†ã€‚</p>
<p>å½“ä½ å¯åŠ¨ä¸€ä¸ªDockerå®¹å™¨åï¼Œä½ å¯ä»¥ä½¿ç”¨ip link showæˆ–ip addr showæ¥æŸ¥çœ‹å½“å‰å®¿ä¸»æœºçš„ç½‘ç»œæƒ…å†µï¼ˆæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ‰ä¸€ä¸ªdocker0ï¼Œè¿˜æœ‰ä¸€ä¸ªveth22a38e6çš„è™šæ‹Ÿç½‘å¡â€”â€”ç»™å®¹å™¨ç”¨çš„ï¼‰ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">hchen@ubuntu:~$ ip link show</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state ... </span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc ...</span><br><span class="line">    link/ether 00:0c:29:b7:67:7d brd ff:ff:ff:ff:ff:ff</span><br><span class="line">3: docker0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 ...</span><br><span class="line">    link/ether 56:84:7a:fe:97:99 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">5: veth22a38e6: &lt;BROADCAST,UP,LOWER_UP&gt; mtu 1500 qdisc ...</span><br><span class="line">    link/ether 8e:30:2a:ac:8c:d1 brd ff:ff:ff:ff:ff:ff</span><br></pre></td></tr></table></figure></div>
<p>é‚£ä¹ˆï¼Œè¦åšæˆè¿™ä¸ªæ ·å­åº”è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿæˆ‘ä»¬æ¥çœ‹ä¸€ç»„å‘½ä»¤ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># é¦–å…ˆï¼Œæˆ‘ä»¬å…ˆå¢åŠ ä¸€ä¸ªç½‘æ¡¥lxcbr0ï¼Œæ¨¡ä»¿docker0</span></span></span><br><span class="line">brctl addbr lxcbr0</span><br><span class="line">brctl stp lxcbr0 off</span><br><span class="line">ifconfig lxcbr0 192.168.10.1/24 up #ä¸ºç½‘æ¡¥è®¾ç½®IPåœ°å€</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¦åˆ›å»ºä¸€ä¸ªnetwork namespace - ns1</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¢åŠ ä¸€ä¸ªnamesapce å‘½ä»¤ä¸º ns1 ï¼ˆä½¿ç”¨ip netns addå‘½ä»¤ï¼‰</span></span><br><span class="line">ip netns add ns1 </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ¿€æ´»namespaceä¸­çš„loopbackï¼Œå³127.0.0.1ï¼ˆä½¿ç”¨ip netns <span class="built_in">exec</span> ns1æ¥æ“ä½œns1ä¸­çš„å‘½ä»¤ï¼‰</span></span><br><span class="line">ip netns exec ns1   ip link set dev lo up </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># ç„¶åï¼Œæˆ‘ä»¬éœ€è¦å¢åŠ ä¸€å¯¹è™šæ‹Ÿç½‘å¡</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¢åŠ ä¸€ä¸ªpairè™šæ‹Ÿç½‘å¡ï¼Œæ³¨æ„å…¶ä¸­çš„vethç±»å‹ï¼Œå…¶ä¸­ä¸€ä¸ªç½‘å¡è¦æŒ‰è¿›å®¹å™¨ä¸­</span></span><br><span class="line">ip link add veth-ns1 type veth peer name lxcbr0.1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŠŠ veth-ns1 æŒ‰åˆ°namespace ns1ä¸­ï¼Œè¿™æ ·å®¹å™¨ä¸­å°±ä¼šæœ‰ä¸€ä¸ªæ–°çš„ç½‘å¡äº†</span></span><br><span class="line">ip link set veth-ns1 netns ns1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŠŠå®¹å™¨é‡Œçš„ veth-ns1æ”¹åä¸º eth0 ï¼ˆå®¹å™¨å¤–ä¼šå†²çªï¼Œå®¹å™¨å†…å°±ä¸ä¼šäº†ï¼‰</span></span><br><span class="line">ip netns exec ns1  ip link set dev veth-ns1 name eth0 </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¸ºå®¹å™¨ä¸­çš„ç½‘å¡åˆ†é…ä¸€ä¸ªIPåœ°å€ï¼Œå¹¶æ¿€æ´»å®ƒ</span></span><br><span class="line">ip netns exec ns1 ifconfig eth0 192.168.10.11/24 up</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¸Šé¢æˆ‘ä»¬æŠŠveth-ns1è¿™ä¸ªç½‘å¡æŒ‰åˆ°äº†å®¹å™¨ä¸­ï¼Œç„¶åæˆ‘ä»¬è¦æŠŠlxcbr0.1æ·»åŠ ä¸Šç½‘æ¡¥ä¸Š</span></span><br><span class="line">brctl addif lxcbr0 lxcbr0.1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¸ºå®¹å™¨å¢åŠ ä¸€ä¸ªè·¯ç”±è§„åˆ™ï¼Œè®©å®¹å™¨å¯ä»¥è®¿é—®å¤–é¢çš„ç½‘ç»œ</span></span><br><span class="line">ip netns exec ns1     ip route add default via 192.168.10.1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> åœ¨/etc/netnsä¸‹åˆ›å»ºnetwork namespceåç§°ä¸ºns1çš„ç›®å½•ï¼Œ</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ç„¶åä¸ºè¿™ä¸ªnamespaceè®¾ç½®resolv.confï¼Œè¿™æ ·ï¼Œå®¹å™¨å†…å°±å¯ä»¥è®¿é—®åŸŸåäº†</span></span><br><span class="line">mkdir -p /etc/netns/ns1</span><br><span class="line">echo &quot;nameserver 8.8.8.8&quot; &gt; /etc/netns/ns1/resolv.conf</span><br></pre></td></tr></table></figure></div>
<p>ä¸Šé¢åŸºæœ¬ä¸Šå°±æ˜¯dockerç½‘ç»œçš„åŸç†äº†ï¼Œåªä¸è¿‡</p>
<ul>
<li>Dockerçš„resolv.confæ²¡æœ‰ç”¨è¿™æ ·çš„æ–¹å¼ï¼Œè€Œæ˜¯ç”¨äº†ä¸Šé¢è®²çš„çš„Mount Namesapceçš„é‚£ç§æ–¹å¼ </li>
<li>å¦å¤–ï¼Œdockeræ˜¯ç”¨è¿›ç¨‹çš„PIDæ¥åšNetwork Namespaceçš„åç§°çš„ã€‚</li>
</ul>
<p>äº†è§£äº†è¿™äº›åï¼Œä½ ç”šè‡³å¯ä»¥ä¸ºæ­£åœ¨è¿è¡Œçš„dockerå®¹å™¨å¢åŠ ä¸€ä¸ªæ–°çš„ç½‘å¡ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">ip link add peerA type veth peer name peerB </span><br><span class="line">brctl addif docker0 peerA </span><br><span class="line">ip link set peerA up </span><br><span class="line">ip link set peerB netns $&#123;container-pid&#125; </span><br><span class="line">ip netns exec $&#123;container-pid&#125; ip link set dev peerB name eth1 </span><br><span class="line">ip netns exec $&#123;container-pid&#125; ip link set eth1 up ; </span><br><span class="line">ip netns exec $&#123;container-pid&#125; ip addr add $&#123;ROUTEABLE_IP&#125; dev eth1 ;</span><br></pre></td></tr></table></figure></div>
<p>ä¸Šé¢çš„ç¤ºä¾‹æ˜¯æˆ‘ä»¬ä¸ºæ­£åœ¨è¿è¡Œçš„dockerå®¹å™¨ï¼Œå¢åŠ ä¸€ä¸ªeth1çš„ç½‘å¡ï¼Œå¹¶ç»™äº†ä¸€ä¸ªé™æ€çš„å¯è¢«å¤–éƒ¨è®¿é—®åˆ°çš„IPåœ°å€ã€‚</p>
<p>è¿™ä¸ªéœ€è¦æŠŠå¤–éƒ¨çš„â€œç‰©ç†ç½‘å¡â€é…ç½®æˆæ··æ‚æ¨¡å¼ï¼Œè¿™æ ·è¿™ä¸ªeth1ç½‘å¡å°±ä¼šå‘å¤–é€šè¿‡ARPåè®®å‘é€è‡ªå·±çš„Macåœ°å€ï¼Œç„¶åå¤–éƒ¨çš„äº¤æ¢æœºå°±ä¼šæŠŠåˆ°è¿™ä¸ªIPåœ°å€çš„åŒ…è½¬åˆ°â€œç‰©ç†ç½‘å¡â€ä¸Šï¼Œå› ä¸ºæ˜¯æ··æ‚æ¨¡å¼ï¼Œæ‰€ä»¥eth1å°±èƒ½æ”¶åˆ°ç›¸å…³çš„æ•°æ®ï¼Œä¸€çœ‹ï¼Œæ˜¯è‡ªå·±çš„ï¼Œé‚£ä¹ˆå°±æ”¶åˆ°ã€‚è¿™æ ·ï¼ŒDockerå®¹å™¨çš„ç½‘ç»œå°±å’Œå¤–éƒ¨é€šäº†ã€‚</p>
<p>å½“ç„¶ï¼Œæ— è®ºæ˜¯Dockerçš„NATæ–¹å¼ï¼Œè¿˜æ˜¯æ··æ‚æ¨¡å¼éƒ½ä¼šæœ‰æ€§èƒ½ä¸Šçš„é—®é¢˜ï¼ŒNATä¸ç”¨è¯´äº†ï¼Œå­˜åœ¨ä¸€ä¸ªè½¬å‘çš„å¼€é”€ï¼Œæ··æ‚æ¨¡å¼å‘¢ï¼Œç½‘å¡ä¸Šæ”¶åˆ°çš„è´Ÿè½½éƒ½ä¼šå®Œå…¨äº¤ç»™æ‰€æœ‰çš„è™šæ‹Ÿç½‘å¡ä¸Šï¼Œäºæ˜¯å°±ç®—ä¸€ä¸ªç½‘å¡ä¸Šæ²¡æœ‰æ•°æ®ï¼Œä½†ä¹Ÿä¼šè¢«å…¶å®ƒç½‘å¡ä¸Šçš„æ•°æ®æ‰€å½±å“ã€‚</p>
<p>è¿™ä¸¤ç§æ–¹å¼éƒ½ä¸å¤Ÿå®Œç¾ï¼Œæˆ‘ä»¬çŸ¥é“ï¼ŒçœŸæ­£è§£å†³è¿™ç§ç½‘ç»œé—®é¢˜éœ€è¦ä½¿ç”¨VLANæŠ€æœ¯ï¼Œäºæ˜¯Googleçš„åŒå­¦ä»¬ä¸ºLinuxå†…æ ¸å®ç°äº†ä¸€ä¸ªIPVLANçš„é©±åŠ¨ï¼Œè¿™åŸºæœ¬ä¸Šå°±æ˜¯ä¸ºDockeré‡èº«å®šåˆ¶çš„ã€‚</p>
<h3 id="Namespaceæ–‡ä»¶"><a href="#Namespaceæ–‡ä»¶" class="headerlink" title="Namespaceæ–‡ä»¶"></a>Namespaceæ–‡ä»¶</h3><p>ä¸Šé¢å°±æ˜¯ç›®å‰Linux Namespaceçš„ç©æ³•ã€‚ ç°åœ¨ï¼Œæˆ‘æ¥çœ‹ä¸€ä¸‹å…¶å®ƒçš„ç›¸å…³ä¸œè¥¿ã€‚</p>
<p>è®©æˆ‘ä»¬è¿è¡Œä¸€ä¸‹ä¸Šç¯‡ä¸­çš„é‚£ä¸ªpid.mntçš„ç¨‹åºï¼ˆä¹Ÿå°±æ˜¯PID Namespaceä¸­é‚£ä¸ªmount procçš„ç¨‹åºï¼‰ï¼Œç„¶åä¸è¦é€€å‡ºã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo ./pid.mnt</span> </span><br><span class="line">[sudo] password for hchen: </span><br><span class="line">Parent [ 4599] - start a container!</span><br><span class="line">Container [    1] - inside the container!</span><br></pre></td></tr></table></figure></div>
<p>æˆ‘ä»¬åˆ°å¦ä¸€ä¸ªshellä¸­æŸ¥çœ‹ä¸€ä¸‹çˆ¶å­è¿›ç¨‹çš„PIDï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">hchen@ubuntu:~$ pstree -p 4599</span><br><span class="line">pid.mnt(4599)â”€â”€â”€bash(4600)</span><br></pre></td></tr></table></figure></div>
<p>æˆ‘ä»¬å¯ä»¥åˆ°procä¸‹ï¼ˆ/proc//nsï¼‰æŸ¥çœ‹è¿›ç¨‹çš„å„ä¸ªnamespaceçš„idï¼ˆå†…æ ¸ç‰ˆæœ¬éœ€è¦3.8ä»¥ä¸Šï¼‰ã€‚</p>
<p>ä¸‹é¢æ˜¯çˆ¶è¿›ç¨‹çš„ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">hchen@ubuntu:~$ sudo ls -l /proc/4599/ns</span><br><span class="line">total 0</span><br><span class="line">lrwxrwxrwx 1 root root 0  4æœˆ  7 22:01 ipc -&gt; ipc:[4026531839]</span><br><span class="line">lrwxrwxrwx 1 root root 0  4æœˆ  7 22:01 mnt -&gt; mnt:[4026531840]</span><br><span class="line">lrwxrwxrwx 1 root root 0  4æœˆ  7 22:01 net -&gt; net:[4026531956]</span><br><span class="line">lrwxrwxrwx 1 root root 0  4æœˆ  7 22:01 pid -&gt; pid:[4026531836]</span><br><span class="line">lrwxrwxrwx 1 root root 0  4æœˆ  7 22:01 user -&gt; user:[4026531837]</span><br><span class="line">lrwxrwxrwx 1 root root 0  4æœˆ  7 22:01 uts -&gt; uts:[4026531838]</span><br></pre></td></tr></table></figure></div>
<p>ä¸‹é¢æ˜¯å­è¿›ç¨‹çš„ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">hchen@ubuntu:~$ sudo ls -l /proc/4600/ns</span><br><span class="line">total 0</span><br><span class="line">lrwxrwxrwx 1 root root 0  4æœˆ  7 22:01 ipc -&gt; ipc:[4026531839]</span><br><span class="line">lrwxrwxrwx 1 root root 0  4æœˆ  7 22:01 mnt -&gt; mnt:[4026532520]</span><br><span class="line">lrwxrwxrwx 1 root root 0  4æœˆ  7 22:01 net -&gt; net:[4026531956]</span><br><span class="line">lrwxrwxrwx 1 root root 0  4æœˆ  7 22:01 pid -&gt; pid:[4026532522]</span><br><span class="line">lrwxrwxrwx 1 root root 0  4æœˆ  7 22:01 user -&gt; user:[4026531837]</span><br><span class="line">lrwxrwxrwx 1 root root 0  4æœˆ  7 22:01 uts -&gt; uts:[4026532521]</span><br></pre></td></tr></table></figure></div>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå…¶ä¸­çš„ipcï¼Œnetï¼Œuseræ˜¯åŒä¸€ä¸ªIDï¼Œè€Œmnt,pid,utséƒ½æ˜¯ä¸ä¸€æ ·çš„ã€‚å¦‚æœä¸¤ä¸ªè¿›ç¨‹æŒ‡å‘çš„namespaceç¼–å·ç›¸åŒï¼Œå°±è¯´æ˜ä»–ä»¬åœ¨åŒä¸€ä¸ªnamespaceä¸‹ï¼Œå¦åˆ™åˆ™åœ¨ä¸åŒnamespaceé‡Œé¢ã€‚</p>
<p>è¿™äº›æ–‡ä»¶è¿˜æœ‰å¦ä¸€ä¸ªä½œç”¨ï¼Œé‚£å°±æ˜¯ï¼Œä¸€æ—¦è¿™äº›æ–‡ä»¶è¢«æ‰“å¼€ï¼Œåªè¦å…¶fdè¢«å ç”¨ç€ï¼Œé‚£ä¹ˆå°±ç®—PIDæ‰€å±çš„æ‰€æœ‰è¿›ç¨‹éƒ½å·²ç»ç»“æŸï¼Œåˆ›å»ºçš„namespaceä¹Ÿä¼šä¸€ç›´å­˜åœ¨ã€‚æ¯”å¦‚ï¼šæˆ‘ä»¬å¯ä»¥é€šè¿‡ï¼šmount bind /proc/4600/ns/uts ~/uts æ¥holdè¿™ä¸ªnamespaceã€‚</p>
<p>å¦å¤–ï¼Œæˆ‘ä»¬åœ¨ä¸Šç¯‡ä¸­è®²è¿‡ä¸€ä¸ªsetnsçš„ç³»ç»Ÿè°ƒç”¨ï¼Œå…¶å‡½æ•°å£°æ˜å¦‚ä¸‹ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">int setns(int fd, int nstype);</span><br></pre></td></tr></table></figure></div>
<p>å…¶ä¸­ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯ä¸€ä¸ªfdï¼Œä¹Ÿå°±æ˜¯ä¸€ä¸ªopen()ç³»ç»Ÿè°ƒç”¨æ‰“å¼€äº†ä¸Šè¿°æ–‡ä»¶åè¿”å›çš„fdï¼Œæ¯”å¦‚ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="C"><figure class="iseeu highlight /c"><table><tr><td class="code"><pre><span class="line">fd = open(<span class="string">&quot;/proc/4600/ns/nts&quot;</span>, O_RDONLY);  <span class="comment">// è·å–namespaceæ–‡ä»¶æè¿°ç¬¦</span></span><br><span class="line">setns(fd, <span class="number">0</span>); <span class="comment">// åŠ å…¥æ–°çš„namespac</span></span><br></pre></td></tr></table></figure></div>
]]></content>
      <tags>
        <tag>äº‘åŸç”ŸåŸºç¡€ç³»åˆ—</tag>
      </tags>
  </entry>
  <entry>
    <title>äº‘åŸç”ŸåŸºç¡€ç³»åˆ—ä¹‹docker(ä¸‰)dockeråŸºç¡€æŠ€æœ¯:linux cgroup</title>
    <url>/2022/06/10/uncatalog/cl4884cmp000060r7fhji6teg/</url>
    <content><![CDATA[<hr>
<span id="more"></span>
<hr>
<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><blockquote>
<p>Namespaceè§£å†³çš„é—®é¢˜ä¸»è¦æ˜¯ç¯å¢ƒéš”ç¦»çš„é—®é¢˜ï¼Œè¿™åªæ˜¯è™šæ‹ŸåŒ–ä¸­æœ€æœ€åŸºç¡€çš„ä¸€æ­¥ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è§£å†³å¯¹è®¡ç®—æœºèµ„æºä½¿ç”¨ä¸Šçš„éš”ç¦»ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè™½ç„¶ä½ é€šè¿‡NamespaceæŠŠæˆ‘Jailåˆ°ä¸€ä¸ªç‰¹å®šçš„ç¯å¢ƒä¸­å»äº†ï¼Œä½†æ˜¯æˆ‘åœ¨å…¶ä¸­çš„è¿›ç¨‹ä½¿ç”¨ç”¨CPUã€å†…å­˜ã€ç£ç›˜ç­‰è¿™äº›è®¡ç®—èµ„æºå…¶å®è¿˜æ˜¯å¯ä»¥éšå¿ƒæ‰€æ¬²çš„ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¸Œæœ›å¯¹è¿›ç¨‹è¿›è¡Œèµ„æºåˆ©ç”¨ä¸Šçš„é™åˆ¶æˆ–æ§åˆ¶ã€‚è¿™å°±æ˜¯Linux CGroupå‡ºæ¥äº†çš„åŸå› ã€‚</p>
</blockquote>
<p>Linux CGroupå…¨ç§°Linux Control Groupï¼Œ æ˜¯Linuxå†…æ ¸çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œç”¨æ¥é™åˆ¶ï¼Œæ§åˆ¶ä¸åˆ†ç¦»ä¸€ä¸ªè¿›ç¨‹ç»„ç¾¤çš„èµ„æºï¼ˆå¦‚CPUã€å†…å­˜ã€ç£ç›˜è¾“å…¥è¾“å‡ºç­‰ï¼‰ã€‚è¿™ä¸ªé¡¹ç›®æœ€æ—©æ˜¯ç”±Googleçš„å·¥ç¨‹å¸ˆåœ¨2006å¹´å‘èµ·ï¼ˆä¸»è¦æ˜¯Paul Menageå’ŒRohit Sethï¼‰ï¼Œæœ€æ—©çš„åç§°ä¸ºè¿›ç¨‹å®¹å™¨ï¼ˆprocess containersï¼‰ã€‚åœ¨2007å¹´æ—¶ï¼Œå› ä¸ºåœ¨Linuxå†…æ ¸ä¸­ï¼Œå®¹å™¨ï¼ˆcontainerï¼‰è¿™ä¸ªåè¯å¤ªè¿‡å¹¿æ³›ï¼Œä¸ºé¿å…æ··ä¹±ï¼Œè¢«é‡å‘½åä¸ºcgroupï¼Œå¹¶ä¸”è¢«åˆå¹¶åˆ°2.6.24ç‰ˆçš„å†…æ ¸ä¸­å»ã€‚ç„¶åï¼Œå…¶å®ƒå¼€å§‹äº†ä»–çš„å‘å±•ã€‚<br>Linux CGroupCgroup å¯è®©æ‚¨ä¸ºç³»ç»Ÿä¸­æ‰€è¿è¡Œä»»åŠ¡ï¼ˆè¿›ç¨‹ï¼‰çš„ç”¨æˆ·å®šä¹‰ç»„ç¾¤åˆ†é…èµ„æºâ€”æ¯”å¦‚CPUæ—¶é—´ã€ç³»ç»Ÿå†…å­˜ã€ç½‘ç»œå¸¦å®½æˆ–è€…è¿™äº›èµ„æºçš„ç»„åˆã€‚æ‚¨å¯ä»¥ç›‘æ§æ‚¨é…ç½®çš„cgroupï¼Œæ‹’ç»cgroup è®¿é—®æŸäº›èµ„æºï¼Œç”šè‡³åœ¨è¿è¡Œçš„ç³»ç»Ÿä¸­åŠ¨æ€é…ç½®æ‚¨çš„cgroupã€‚<br>ä¸»è¦æä¾›äº†å¦‚ä¸‹åŠŸèƒ½ï¼š</p>
<ul>
<li><em>Resource limitation</em>: é™åˆ¶èµ„æºä½¿ç”¨ï¼Œæ¯”å¦‚å†…å­˜ä½¿ç”¨ä¸Šé™ä»¥åŠæ–‡ä»¶ç³»ç»Ÿçš„ç¼“å­˜é™åˆ¶ã€‚</li>
<li><em>Prioritization</em>: ä¼˜å…ˆçº§æ§åˆ¶ï¼Œæ¯”å¦‚ï¼šCPUåˆ©ç”¨å’Œç£ç›˜IOååã€‚</li>
<li><em>Accounting</em>: ä¸€äº›å®¡è®¡æˆ–ä¸€äº›ç»Ÿè®¡ï¼Œä¸»è¦ç›®çš„æ˜¯ä¸ºäº†è®¡è´¹ã€‚</li>
<li><em>Control</em>: æŒ‚èµ·è¿›ç¨‹ï¼Œæ¢å¤æ‰§è¡Œè¿›ç¨‹ã€‚<br>ä½¿ç”¨cgroupï¼Œç³»ç»Ÿç®¡ç†å‘˜å¯æ›´å…·ä½“åœ°æ§åˆ¶å¯¹ç³»ç»Ÿèµ„æºçš„åˆ†é…ã€ä¼˜å…ˆé¡ºåºã€æ‹’ç»ã€ç®¡ç†å’Œç›‘æ§ã€‚å¯æ›´å¥½åœ°æ ¹æ®ä»»åŠ¡å’Œç”¨æˆ·åˆ†é…ç¡¬ä»¶èµ„æºï¼Œæé«˜æ€»ä½“æ•ˆç‡ã€‚</li>
</ul>
<p>åœ¨å®è·µä¸­ï¼Œç³»ç»Ÿç®¡ç†å‘˜ä¸€èˆ¬ä¼šåˆ©ç”¨CGroupåšä¸‹é¢è¿™äº›äº‹ï¼ˆæœ‰ç‚¹åƒä¸ºæŸä¸ªè™šæ‹Ÿæœºåˆ†é…èµ„æºä¼¼çš„ï¼‰ï¼š</p>
<ul>
<li>éš”ç¦»ä¸€ä¸ªè¿›ç¨‹é›†åˆï¼ˆæ¯”å¦‚ï¼šnginxçš„æ‰€æœ‰è¿›ç¨‹ï¼‰ï¼Œå¹¶é™åˆ¶ä»–ä»¬æ‰€æ¶ˆè´¹çš„èµ„æºï¼Œæ¯”å¦‚ç»‘å®šCPUçš„æ ¸ã€‚</li>
<li>ä¸ºè¿™ç»„è¿›ç¨‹ åˆ†é…å…¶è¶³å¤Ÿä½¿ç”¨çš„å†…å­˜</li>
<li>ä¸ºè¿™ç»„è¿›ç¨‹åˆ†é…ç›¸åº”çš„ç½‘ç»œå¸¦å®½å’Œç£ç›˜å­˜å‚¨é™åˆ¶</li>
<li>é™åˆ¶è®¿é—®æŸäº›è®¾å¤‡ï¼ˆé€šè¿‡è®¾ç½®è®¾å¤‡çš„ç™½åå•ï¼‰ </li>
</ul>
<p>é‚£ä¹ˆCGroupæ˜¯æ€ä¹ˆå¹²çš„å‘¢ï¼Ÿæˆ‘ä»¬å…ˆæ¥ç‚¹æ„Ÿæ€§è®¤è¯†å§ã€‚</p>
<p>é¦–å…ˆï¼ŒLinuxæŠŠCGroupè¿™ä¸ªäº‹å®ç°æˆäº†ä¸€ä¸ªfile systemï¼Œä½ å¯ä»¥mountã€‚åœ¨æˆ‘çš„Ubuntu 14.04ä¸‹ï¼Œä½ è¾“å…¥ä»¥ä¸‹å‘½ä»¤ä½ å°±å¯ä»¥çœ‹åˆ°cgroupå·²ä¸ºä½ mountå¥½äº†ã€‚<br> <div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">hchen@ubuntu:~$ mount -t cgroup</span><br><span class="line">cgroup on /sys/fs/cgroup/cpuset type cgroup (rw,relatime,cpuset)</span><br><span class="line">cgroup on /sys/fs/cgroup/cpu type cgroup (rw,relatime,cpu)</span><br><span class="line">cgroup on /sys/fs/cgroup/cpuacct type cgroup (rw,relatime,cpuacct)</span><br><span class="line">cgroup on /sys/fs/cgroup/memory type cgroup (rw,relatime,memory)</span><br><span class="line">cgroup on /sys/fs/cgroup/devices type cgroup (rw,relatime,devices)</span><br><span class="line">cgroup on /sys/fs/cgroup/freezer type cgroup (rw,relatime,freezer)</span><br><span class="line">cgroup on /sys/fs/cgroup/blkio type cgroup (rw,relatime,blkio)</span><br><span class="line">cgroup on /sys/fs/cgroup/net_prio type cgroup (rw,net_prio)</span><br><span class="line">cgroup on /sys/fs/cgroup/net_cls type cgroup (rw,net_cls)</span><br><span class="line">cgroup on /sys/fs/cgroup/perf_event type cgroup (rw,relatime,perf_event)</span><br><span class="line">cgroup on /sys/fs/cgroup/hugetlb type cgroup (rw,relatime,hugetlb)</span><br></pre></td></tr></table></figure></div><br>æˆ–è€…ä½¿ç”¨lssubsyså‘½ä»¤ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> lssubsys  -m</span></span><br><span class="line">cpuset /sys/fs/cgroup/cpuset</span><br><span class="line">cpu /sys/fs/cgroup/cpu</span><br><span class="line">cpuacct /sys/fs/cgroup/cpuacct</span><br><span class="line">memory /sys/fs/cgroup/memory</span><br><span class="line">devices /sys/fs/cgroup/devices</span><br><span class="line">freezer /sys/fs/cgroup/freezer</span><br><span class="line">blkio /sys/fs/cgroup/blkio</span><br><span class="line">net_cls /sys/fs/cgroup/net_cls</span><br><span class="line">net_prio /sys/fs/cgroup/net_prio</span><br><span class="line">perf_event /sys/fs/cgroup/perf_event</span><br><span class="line">hugetlb /sys/fs/cgroup/hugetlb</span><br></pre></td></tr></table></figure></div>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨/sys/fsä¸‹æœ‰ä¸€ä¸ªcgroupçš„ç›®å½•ï¼Œè¿™ä¸ªç›®å½•ä¸‹è¿˜æœ‰å¾ˆå¤šå­ç›®å½•ï¼Œæ¯”å¦‚ï¼š cpuï¼Œcpusetï¼Œmemoryï¼Œblkioâ€¦â€¦è¿™äº›ï¼Œè¿™äº›éƒ½æ˜¯cgroupçš„å­ç³»ç»Ÿã€‚åˆ†åˆ«ç”¨äºå¹²ä¸åŒçš„äº‹çš„ã€‚</p>
<p>å¦‚æœä½ æ²¡æœ‰çœ‹åˆ°ä¸Šè¿°çš„ç›®å½•ï¼Œä½ å¯ä»¥è‡ªå·±mountï¼Œä¸‹é¢ç»™äº†ä¸€ä¸ªç¤ºä¾‹ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">mkdir cgroup</span><br><span class="line">mount -t tmpfs cgroup_root ./cgroup</span><br><span class="line">mkdir cgroup/cpuset</span><br><span class="line">mount -t cgroup -ocpuset cpuset ./cgroup/cpuset/</span><br><span class="line">mkdir cgroup/cpu</span><br><span class="line">mount -t cgroup -ocpu cpu ./cgroup/cpu/</span><br><span class="line">mkdir cgroup/memory</span><br><span class="line">mount -t cgroup -omemory memory ./cgroup/memory/</span><br></pre></td></tr></table></figure></div>
<p>ä¸€æ—¦mountæˆåŠŸï¼Œä½ å°±ä¼šçœ‹åˆ°è¿™äº›ç›®å½•ä¸‹å°±æœ‰å¥½æ–‡ä»¶äº†ï¼Œæ¯”å¦‚ï¼Œå¦‚ä¸‹æ‰€ç¤ºçš„cpuå’Œcpusetçš„å­ç³»ç»Ÿï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">hchen@ubuntu:~$ ls /sys/fs/cgroup/cpu /sys/fs/cgroup/cpuset/ </span><br><span class="line">/sys/fs/cgroup/cpu:</span><br><span class="line">cgroup.clone_children  cgroup.sane_behavior  cpu.shares         release_agent</span><br><span class="line">cgroup.event_control   cpu.cfs_period_us     cpu.stat           tasks</span><br><span class="line">cgroup.procs           cpu.cfs_quota_us      notify_on_release  user</span><br><span class="line"></span><br><span class="line">/sys/fs/cgroup/cpuset/:</span><br><span class="line">cgroup.clone_children  cpuset.mem_hardwall             cpuset.sched_load_balance</span><br><span class="line">cgroup.event_control   cpuset.memory_migrate           cpuset.sched_relax_domain_level</span><br><span class="line">cgroup.procs           cpuset.memory_pressure          notify_on_release</span><br><span class="line">cgroup.sane_behavior   cpuset.memory_pressure_enabled  release_agent</span><br><span class="line">cpuset.cpu_exclusive   cpuset.memory_spread_page       tasks</span><br><span class="line">cpuset.cpus            cpuset.memory_spread_slab       user</span><br><span class="line">cpuset.mem_exclusive   cpuset.mems</span><br></pre></td></tr></table></figure></div>
<p>ä½ å¯ä»¥åˆ°/sys/fs/cgroupçš„å„ä¸ªå­ç›®å½•ä¸‹å»makeä¸ªdirï¼Œä½ ä¼šå‘ç°ï¼Œä¸€æ—¦ä½ åˆ›å»ºäº†ä¸€ä¸ªå­ç›®å½•ï¼Œè¿™ä¸ªå­ç›®å½•é‡Œåˆæœ‰å¾ˆå¤šæ–‡ä»¶äº†ã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">hchen@ubuntu:/sys/fs/cgroup/cpu$ sudo mkdir haoel</span><br><span class="line">[sudo] password for hchen: </span><br><span class="line">hchen@ubuntu:/sys/fs/cgroup/cpu$ ls ./haoel</span><br><span class="line">cgroup.clone_children  cgroup.procs       cpu.cfs_quota_us  cpu.stat           tasks</span><br><span class="line">cgroup.event_control   cpu.cfs_period_us  cpu.shares        notify_on_release</span><br></pre></td></tr></table></figure></div>
<p>å¥½äº†ï¼Œæˆ‘ä»¬æ¥çœ‹å‡ ä¸ªç¤ºä¾‹ã€‚</p>
<h3 id="CPU-é™åˆ¶"><a href="#CPU-é™åˆ¶" class="headerlink" title="CPU é™åˆ¶"></a>CPU é™åˆ¶</h3><p>å‡è®¾ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªéå¸¸åƒCPUçš„ç¨‹åºï¼Œå«deadloopï¼Œå…¶æºç å¦‚ä¸‹ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="C"><figure class="iseeu highlight /c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span>(;;) i++;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>ç”¨sudoæ‰§è¡Œèµ·æ¥åï¼Œæ¯«æ— ç–‘é—®ï¼ŒCPUè¢«å¹²åˆ°äº†100%ï¼ˆä¸‹é¢æ˜¯topå‘½ä»¤çš„è¾“å‡ºï¼‰</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"> PID USER      PR  NI    VIRT    RES    SHR S %CPU %MEM     TIME+ COMMAND     </span><br><span class="line">3529 root      20   0    4196    736    656 R 99.6  0.1   0:23.13 deadloop   </span><br></pre></td></tr></table></figure></div>
<p>ç„¶åï¼Œæˆ‘ä»¬è¿™å‰ä¸æ˜¯åœ¨/sys/fs/cgroup/cpuä¸‹åˆ›å»ºäº†ä¸€ä¸ªhaoelçš„groupã€‚æˆ‘ä»¬å…ˆè®¾ç½®ä¸€ä¸‹è¿™ä¸ªgroupçš„cpuåˆ©ç”¨çš„é™åˆ¶ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">hchen@ubuntu:~# cat /sys/fs/cgroup/cpu/haoel/cpu.cfs_quota_us </span><br><span class="line">-1</span><br><span class="line">root@ubuntu:~# echo 20000 &gt; /sys/fs/cgroup/cpu/haoel/cpu.cfs_quota_us</span><br></pre></td></tr></table></figure></div>
<p>æˆ‘ä»¬çœ‹åˆ°ï¼Œè¿™ä¸ªè¿›ç¨‹çš„PIDæ˜¯3529ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªè¿›ç¨‹åŠ åˆ°è¿™ä¸ªcgroupä¸­ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">echo 3529 &gt;&gt; /sys/fs/cgroup/cpu/haoel/tasks</span><br></pre></td></tr></table></figure></div>
<p>ç„¶åï¼Œå°±ä¼šåœ¨topä¸­çœ‹åˆ°CPUçš„åˆ©ç”¨ç«‹é©¬ä¸‹é™æˆ20%äº†ã€‚ï¼ˆå‰é¢æˆ‘ä»¬è®¾ç½®çš„20000å°±æ˜¯20%çš„æ„æ€ï¼‰</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"> PID USER      PR  NI    VIRT    RES    SHR S %CPU %MEM     TIME+ COMMAND     </span><br><span class="line">3529 root      20   0    4196    736    656 R 19.9  0.1   8:06.11 deadloop    </span><br></pre></td></tr></table></figure></div>
<p>ä¸‹é¢çš„ä»£ç æ˜¯ä¸€ä¸ªçº¿ç¨‹çš„ç¤ºä¾‹ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="C"><figure class="iseeu highlight /c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _GNU_SOURCE         <span class="comment">/* See feature_test_macros(7) */</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;pthread.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/stat.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/syscall.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> NUM_THREADS = <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> *<span class="title">thread_main</span><span class="params">(<span class="keyword">void</span> *threadid)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">/* æŠŠè‡ªå·±åŠ å…¥cgroupä¸­ï¼ˆsyscall(SYS_gettid)ä¸ºå¾—åˆ°çº¿ç¨‹çš„ç³»ç»Ÿtidï¼‰ */</span></span><br><span class="line">    <span class="keyword">char</span> cmd[<span class="number">128</span>];</span><br><span class="line">    <span class="built_in">sprintf</span>(cmd, <span class="string">&quot;echo %ld &gt;&gt; /sys/fs/cgroup/cpu/haoel/tasks&quot;</span>, syscall(SYS_gettid));</span><br><span class="line">    system(cmd); </span><br><span class="line">    <span class="built_in">sprintf</span>(cmd, <span class="string">&quot;echo %ld &gt;&gt; /sys/fs/cgroup/cpuset/haoel/tasks&quot;</span>, syscall(SYS_gettid));</span><br><span class="line">    system(cmd);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">long</span> tid;</span><br><span class="line">    tid = (<span class="keyword">long</span>)threadid;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Hello World! It&#x27;s me, thread #%ld, pid #%ld!\n&quot;</span>, tid, syscall(SYS_gettid));</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">int</span> a=<span class="number">0</span>; </span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>) &#123;</span><br><span class="line">        a++;</span><br><span class="line">    &#125;</span><br><span class="line">    pthread_exit(<span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span> <span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> num_threads;</span><br><span class="line">    <span class="keyword">if</span> (argc &gt; <span class="number">1</span>)&#123;</span><br><span class="line">        num_threads = atoi(argv[<span class="number">1</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (num_threads&lt;=<span class="number">0</span> || num_threads&gt;=<span class="number">100</span>)&#123;</span><br><span class="line">        num_threads = NUM_THREADS;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* è®¾ç½®CPUåˆ©ç”¨ç‡ä¸º50% */</span></span><br><span class="line">    mkdir(<span class="string">&quot;/sys/fs/cgroup/cpu/haoel&quot;</span>, <span class="number">755</span>);</span><br><span class="line">    system(<span class="string">&quot;echo 50000 &gt; /sys/fs/cgroup/cpu/haoel/cpu.cfs_quota_us&quot;</span>);</span><br><span class="line"></span><br><span class="line">    mkdir(<span class="string">&quot;/sys/fs/cgroup/cpuset/haoel&quot;</span>, <span class="number">755</span>);</span><br><span class="line">    <span class="comment">/* é™åˆ¶CPUåªèƒ½ä½¿ç”¨#2æ ¸å’Œ#3æ ¸ */</span></span><br><span class="line">    system(<span class="string">&quot;echo \&quot;2,3\&quot; &gt; /sys/fs/cgroup/cpuset/haoel/cpuset.cpus&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">pthread_t</span>* threads = (<span class="keyword">pthread_t</span>*) <span class="built_in">malloc</span> (<span class="keyword">sizeof</span>(<span class="keyword">pthread_t</span>)*num_threads);</span><br><span class="line">    <span class="keyword">int</span> rc;</span><br><span class="line">    <span class="keyword">long</span> t;</span><br><span class="line">    <span class="keyword">for</span>(t=<span class="number">0</span>; t&lt;num_threads; t++)&#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;In main: creating thread %ld\n&quot;</span>, t);</span><br><span class="line">        rc = pthread_create(&amp;threads[t], <span class="literal">NULL</span>, thread_main, (<span class="keyword">void</span> *)t);</span><br><span class="line">        <span class="keyword">if</span> (rc)&#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;ERROR; return code from pthread_create() is %d\n&quot;</span>, rc);</span><br><span class="line">            <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Last thing that main() should do */</span></span><br><span class="line">    pthread_exit(<span class="literal">NULL</span>);</span><br><span class="line">    <span class="built_in">free</span>(threads);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="å†…å­˜ä½¿ç”¨é™åˆ¶"><a href="#å†…å­˜ä½¿ç”¨é™åˆ¶" class="headerlink" title="å†…å­˜ä½¿ç”¨é™åˆ¶"></a>å†…å­˜ä½¿ç”¨é™åˆ¶</h3><p>æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸ªé™åˆ¶å†…å­˜çš„ä¾‹å­ï¼ˆä¸‹é¢çš„ä»£ç æ˜¯ä¸ªæ­»å¾ªç¯ï¼Œå…¶å®ƒä¸æ–­çš„åˆ†é…å†…å­˜ï¼Œæ¯æ¬¡512ä¸ªå­—èŠ‚ï¼Œæ¯æ¬¡ä¼‘æ¯ä¸€ç§’ï¼‰ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="C"><figure class="iseeu highlight /c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> size = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">int</span> chunk_size = <span class="number">512</span>;</span><br><span class="line">    <span class="keyword">void</span> *p = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ((p = <span class="built_in">malloc</span>(p, chunk_size)) == <span class="literal">NULL</span>) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;out of memory!!\n&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">memset</span>(p, <span class="number">1</span>, chunk_size);</span><br><span class="line">        size += chunk_size;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;[%d] - memory is allocated [%8d] bytes \n&quot;</span>, getpid(), size);</span><br><span class="line">        sleep(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>ç„¶åï¼Œåœ¨æˆ‘ä»¬å¦å¤–ä¸€è¾¹ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åˆ›å»ºmemory cgroup</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> mkdir /sys/fs/cgroup/memory/haoel</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">echo</span> 64k &gt; /sys/fs/cgroup/memory/haoel/memory.limit_in_bytes</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŠŠä¸Šé¢çš„è¿›ç¨‹çš„pidåŠ å…¥è¿™ä¸ªcgroup</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">echo</span> [pid] &gt; /sys/fs/cgroup/memory/haoel/tasks</span> </span><br></pre></td></tr></table></figure></div>
<p>ä½ ä¼šçœ‹åˆ°ï¼Œä¸€ä¼šä¸Šé¢çš„è¿›ç¨‹å°±ä¼šå› ä¸ºå†…å­˜é—®é¢˜è¢«killæ‰äº†ã€‚</p>
<h3 id="ç£ç›˜I-Oé™åˆ¶"><a href="#ç£ç›˜I-Oé™åˆ¶" class="headerlink" title="ç£ç›˜I/Oé™åˆ¶"></a>ç£ç›˜I/Oé™åˆ¶</h3><p>æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸‹æˆ‘ä»¬çš„ç¡¬ç›˜IOï¼Œæˆ‘ä»¬çš„æ¨¡æ‹Ÿå‘½ä»¤å¦‚ä¸‹ï¼šï¼ˆä»/dev/sda1ä¸Šè¯»å…¥æ•°æ®ï¼Œè¾“å‡ºåˆ°/dev/nullä¸Šï¼‰</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">sudo dd if=/dev/sda1 of=/dev/null</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
<p>æˆ‘ä»¬é€šè¿‡iotopå‘½ä»¤æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç›¸å…³çš„IOé€Ÿåº¦æ˜¯55MB/sï¼ˆè™šæ‹Ÿæœºå†…ï¼‰:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"> TID  PRIO  USER     DISK READ  DISK WRITE  SWAPIN     IO&gt;    COMMAND          </span><br><span class="line">8128 be/4 root       55.74 M/s    0.00 B/s  0.00 % 85.65 % dd if=/de~=/dev/null...</span><br></pre></td></tr></table></figure></div>
<p>ç„¶åï¼Œæˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ªblkioï¼ˆå—è®¾å¤‡IOï¼‰çš„cgroup</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">mkdir /sys/fs/cgroup/blkio/haoel</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
<p>å¹¶æŠŠè¯»IOé™åˆ¶åˆ°1MB/sï¼Œå¹¶æŠŠå‰é¢é‚£ä¸ªddå‘½ä»¤çš„pidæ”¾è¿›å»ï¼ˆæ³¨ï¼š8:0 æ˜¯è®¾å¤‡å·ï¼Œä½ å¯ä»¥é€šè¿‡ls -l /dev/sda1è·å¾—ï¼‰ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">root@ubuntu:~# echo &#x27;8:0 1048576&#x27;  &gt; /sys/fs/cgroup/blkio/haoel/blkio.throttle.read_bps_device </span><br><span class="line">root@ubuntu:~# echo 8128 &gt; /sys/fs/cgroup/blkio/haoel/tasks</span><br></pre></td></tr></table></figure></div>
<p>å†ç”¨iotopå‘½ä»¤ï¼Œä½ é©¬ä¸Šå°±èƒ½çœ‹åˆ°è¯»é€Ÿåº¦è¢«é™åˆ¶åˆ°äº†1MB/så·¦å³ã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"> TID  PRIO  USER     DISK READ  DISK WRITE  SWAPIN     IO&gt;    COMMAND          </span><br><span class="line">8128 be/4 root      973.20 K/s    0.00 B/s  0.00 % 94.41 % dd if=/de~=/dev/null...</span><br></pre></td></tr></table></figure></div>

<h3 id="CGroupçš„å­ç³»ç»Ÿ"><a href="#CGroupçš„å­ç³»ç»Ÿ" class="headerlink" title="CGroupçš„å­ç³»ç»Ÿ"></a>CGroupçš„å­ç³»ç»Ÿ</h3><p>å¥½äº†ï¼Œæœ‰äº†ä»¥ä¸Šçš„æ„Ÿæ€§è®¤è¯†æˆ‘ä»¬æ¥ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹control groupæœ‰å“ªäº›å­ç³»ç»Ÿï¼š</p>
<ul>
<li>blkio â€” è¿™ä¸ªå­ç³»ç»Ÿä¸ºå—è®¾å¤‡è®¾å®šè¾“å…¥/è¾“å‡ºé™åˆ¶ï¼Œæ¯”å¦‚ç‰©ç†è®¾å¤‡ï¼ˆç£ç›˜ï¼Œå›ºæ€ç¡¬ç›˜ï¼ŒUSB ç­‰ç­‰ï¼‰ã€‚</li>
<li>cpu â€” è¿™ä¸ªå­ç³»ç»Ÿä½¿ç”¨è°ƒåº¦ç¨‹åºæä¾›å¯¹ CPU çš„ cgroup ä»»åŠ¡è®¿é—®ã€‚</li>
<li>cpuacct â€” è¿™ä¸ªå­ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆ cgroup ä¸­ä»»åŠ¡æ‰€ä½¿ç”¨çš„ CPU æŠ¥å‘Šã€‚</li>
<li>cpuset â€” è¿™ä¸ªå­ç³»ç»Ÿä¸º cgroup ä¸­çš„ä»»åŠ¡åˆ†é…ç‹¬ç«‹ CPUï¼ˆåœ¨å¤šæ ¸ç³»ç»Ÿï¼‰å’Œå†…å­˜èŠ‚ç‚¹ã€‚</li>
<li>devices â€” è¿™ä¸ªå­ç³»ç»Ÿå¯å…è®¸æˆ–è€…æ‹’ç» cgroup ä¸­çš„ä»»åŠ¡è®¿é—®è®¾å¤‡ã€‚</li>
<li>freezer â€” è¿™ä¸ªå­ç³»ç»ŸæŒ‚èµ·æˆ–è€…æ¢å¤ cgroup ä¸­çš„ä»»åŠ¡ã€‚</li>
<li>memory â€” è¿™ä¸ªå­ç³»ç»Ÿè®¾å®š cgroup ä¸­ä»»åŠ¡ä½¿ç”¨çš„å†…å­˜é™åˆ¶ï¼Œå¹¶è‡ªåŠ¨ç”Ÿæˆå†…å­˜èµ„æºä½¿ç”¨æŠ¥å‘Šã€‚</li>
<li>net_cls â€” è¿™ä¸ªå­ç³»ç»Ÿä½¿ç”¨ç­‰çº§è¯†åˆ«ç¬¦ï¼ˆclassidï¼‰æ ‡è®°ç½‘ç»œæ•°æ®åŒ…ï¼Œå¯å…è®¸ Linux æµé‡æ§åˆ¶ç¨‹åºï¼ˆtcï¼‰è¯†åˆ«ä»å…·ä½“ cgroup ä¸­ç”Ÿæˆçš„æ•°æ®åŒ…ã€‚</li>
<li>net_prio â€” è¿™ä¸ªå­ç³»ç»Ÿç”¨æ¥è®¾è®¡ç½‘ç»œæµé‡çš„ä¼˜å…ˆçº§</li>
<li>hugetlb â€” è¿™ä¸ªå­ç³»ç»Ÿä¸»è¦é’ˆå¯¹äºHugeTLBç³»ç»Ÿè¿›è¡Œé™åˆ¶ï¼Œè¿™æ˜¯ä¸€ä¸ªå¤§é¡µæ–‡ä»¶ç³»ç»Ÿã€‚</li>
</ul>
<p>æ³¨æ„ï¼Œä½ å¯èƒ½åœ¨Ubuntu 14.04ä¸‹çœ‹ä¸åˆ°net_clså’Œnet_prioè¿™ä¸¤ä¸ªcgroupï¼Œä½ éœ€è¦æ‰‹åŠ¨mountä¸€ä¸‹ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo modprobe cls_cgroup</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo mkdir /sys/fs/cgroup/net_cls</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo mount -t cgroup -o net_cls none /sys/fs/cgroup/net_cls</span></span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo modprobe netprio_cgroup</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo mkdir /sys/fs/cgroup/net_prio</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo mount -t cgroup -o net_prio none /sys/fs/cgroup/net_prio</span></span><br></pre></td></tr></table></figure></div>
<p>å…³äºå„ä¸ªå­ç³»ç»Ÿçš„å‚æ•°ç»†èŠ‚ï¼Œä»¥åŠæ›´å¤šçš„Linux CGroupçš„æ–‡æ¡£ï¼Œä½ å¯ä»¥çœ‹çœ‹ä¸‹é¢çš„æ–‡æ¡£ï¼š</p>
<ul>
<li><a href="https://www.kernel.org/doc/Documentation/cgroup-v1/">Linux Kernelçš„å®˜æ–¹æ–‡æ¡£</a></li>
<li><a href="https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/6/html-single/resource_management_guide/index#ch-Subsystems_and_Tunable_Parameters">Redhatçš„å®˜æ–¹æ–‡æ¡£</a></li>
</ul>
<h3 id="CGroupçš„æœ¯è¯­"><a href="#CGroupçš„æœ¯è¯­" class="headerlink" title="CGroupçš„æœ¯è¯­"></a>CGroupçš„æœ¯è¯­</h3><p>CGroupæœ‰ä¸‹è¿°æœ¯è¯­ï¼š</p>
<ul>
<li>ä»»åŠ¡ï¼ˆTasksï¼‰ï¼šå°±æ˜¯ç³»ç»Ÿçš„ä¸€ä¸ªè¿›ç¨‹ã€‚</li>
<li>æ§åˆ¶ç»„ï¼ˆControl Groupï¼‰ï¼šä¸€ç»„æŒ‰ç…§æŸç§æ ‡å‡†åˆ’åˆ†çš„è¿›ç¨‹ï¼Œæ¯”å¦‚å®˜æ–¹æ–‡æ¡£ä¸­çš„Professorå’ŒStudentï¼Œæˆ–æ˜¯WWWå’ŒSystemä¹‹ç±»çš„ï¼Œå…¶è¡¨ç¤ºäº†æŸè¿›ç¨‹ç»„ã€‚Cgroupsä¸­çš„èµ„æºæ§åˆ¶éƒ½æ˜¯ä»¥æ§åˆ¶ç»„ä¸ºå•ä½å®ç°ã€‚ä¸€ä¸ªè¿›ç¨‹å¯ä»¥åŠ å…¥åˆ°æŸä¸ªæ§åˆ¶ç»„ã€‚è€Œèµ„æºçš„é™åˆ¶æ˜¯å®šä¹‰åœ¨è¿™ä¸ªç»„ä¸Šï¼Œå°±åƒä¸Šé¢ç¤ºä¾‹ä¸­æˆ‘ç”¨çš„haoelä¸€æ ·ã€‚ç®€å•ç‚¹è¯´ï¼Œcgroupçš„å‘ˆç°å°±æ˜¯ä¸€ä¸ªç›®å½•å¸¦ä¸€ç³»åˆ—çš„å¯é…ç½®æ–‡ä»¶ã€‚</li>
<li>å±‚çº§ï¼ˆHierarchyï¼‰ï¼šæ§åˆ¶ç»„å¯ä»¥ç»„ç»‡æˆhierarchicalçš„å½¢å¼ï¼Œæ—¢ä¸€é¢—æ§åˆ¶ç»„çš„æ ‘ï¼ˆç›®å½•ç»“æ„ï¼‰ã€‚æ§åˆ¶ç»„æ ‘ä¸Šçš„å­èŠ‚ç‚¹ç»§æ‰¿çˆ¶ç»“ç‚¹çš„å±æ€§ã€‚ç®€å•ç‚¹è¯´ï¼Œhierarchyå°±æ˜¯åœ¨ä¸€ä¸ªæˆ–å¤šä¸ªå­ç³»ç»Ÿä¸Šçš„cgroupsç›®å½•æ ‘ã€‚</li>
<li>å­ç³»ç»Ÿï¼ˆSubsystemï¼‰ï¼šä¸€ä¸ªå­ç³»ç»Ÿå°±æ˜¯ä¸€ä¸ªèµ„æºæ§åˆ¶å™¨ï¼Œæ¯”å¦‚CPUå­ç³»ç»Ÿå°±æ˜¯æ§åˆ¶CPUæ—¶é—´åˆ†é…çš„ä¸€ä¸ªæ§åˆ¶å™¨ã€‚å­ç³»ç»Ÿå¿…é¡»é™„åŠ åˆ°ä¸€ä¸ªå±‚çº§ä¸Šæ‰èƒ½èµ·ä½œç”¨ï¼Œä¸€ä¸ªå­ç³»ç»Ÿé™„åŠ åˆ°æŸä¸ªå±‚çº§ä»¥åï¼Œè¿™ä¸ªå±‚çº§ä¸Šçš„æ‰€æœ‰æ§åˆ¶æ—ç¾¤éƒ½å—åˆ°è¿™ä¸ªå­ç³»ç»Ÿçš„æ§åˆ¶ã€‚Cgroupçš„å­ç³»ç»Ÿå¯ä»¥æœ‰å¾ˆå¤šï¼Œä¹Ÿåœ¨ä¸æ–­å¢åŠ ä¸­ã€‚</li>
</ul>
<h3 id="ä¸‹ä¸€ä»£çš„CGroup"><a href="#ä¸‹ä¸€ä»£çš„CGroup" class="headerlink" title="ä¸‹ä¸€ä»£çš„CGroup"></a>ä¸‹ä¸€ä»£çš„CGroup</h3><p>ä¸Šé¢ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒCGroupçš„ä¸€äº›å¸¸ç”¨æ–¹æ³•å’Œç›¸å…³çš„æœ¯è¯­ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œè¿™æ ·çš„è®¾è®¡åœ¨ä¸€èˆ¬æƒ…å†µä¸‹è¿˜æ˜¯æ²¡ä»€ä¹ˆé—®é¢˜çš„ï¼Œé™¤äº†æ“ä½œä¸Šçš„ç”¨æˆ·ä½“éªŒä¸æ˜¯å¾ˆå¥½ï¼Œä½†åŸºæœ¬æ»¡è¶³æˆ‘ä»¬çš„ä¸€èˆ¬éœ€æ±‚äº†ã€‚</p>
<p>ä¸è¿‡ï¼Œå¯¹æ­¤ï¼Œæœ‰ä¸ªå«Tejun Heoçš„åŒå­¦éå¸¸ä¸çˆ½ï¼Œä»–åœ¨Linuxç¤¾åŒºé‡Œå¯¹cgroupåäº†ä¸€æŠŠæ§½ï¼Œè¿˜å¼•å‘äº†å†…æ ¸ç»„çš„å„ç§è®¨è®ºã€‚</p>
<p>å¯¹äºTejun HeoåŒå­¦æ¥è¯´ï¼Œcgroupè®¾è®¡çš„ç›¸å½“ç³Ÿç³•ã€‚ä»–ç»™å‡ºäº†äº›ä¾‹å­ï¼Œå¤§æ„å°±æ˜¯è¯´ï¼Œå¦‚æœæœ‰å¤šç§å±‚çº§å…³ç³»ï¼Œä¹Ÿå°±æ˜¯è¯´æœ‰å¤šç§å¯¹è¿›ç¨‹çš„åˆ†ç±»æ–¹å¼ï¼Œæ¯”å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥æŒ‰ç”¨æˆ·æ¥åˆ†ï¼Œåˆ†æˆProfessorå’ŒStudentï¼ŒåŒæ—¶ï¼Œä¹Ÿæœ‰æŒ‰åº”ç”¨ç±»ä¼¼æ¥åˆ†çš„ï¼Œæ¯”å¦‚WWWå’ŒNFSç­‰ã€‚é‚£ä¹ˆï¼Œå½“ä¸€ä¸ªè¿›ç¨‹å³æ˜¯Professorçš„ï¼Œä¹Ÿæ˜¯WWWçš„ï¼Œé‚£ä¹ˆå°±ä¼šå‡ºç°å¤šå±‚çº§æ­£äº¤çš„æƒ…å†µï¼Œä»è€Œå‡ºç°å¯¹è¿›ç¨‹ä¸Šç®¡ç†çš„æ··ä¹±ã€‚å¦å¤–ï¼Œä¸€ä¸ªcaseæ˜¯ï¼Œå¦‚æœæœ‰ä¸€ä¸ªå±‚çº§Aç»‘å®šcpuï¼Œè€Œå±‚çº§Bç»‘å®šmemoryï¼Œè¿˜æœ‰ä¸€ä¸ªå±‚çº§Cç»‘å®šcputsetï¼Œè€Œæœ‰ä¸€äº›è¿›ç¨‹æœ‰çš„éœ€è¦ABï¼Œæœ‰çš„éœ€è¦ACï¼Œæœ‰çš„éœ€è¦ABCï¼Œç®¡ç†èµ·æ¥å°±ç›¸å½“ä¸æ˜“ã€‚</p>
<p>å±‚çº§æ“ä½œèµ·æ¥æ¯”è¾ƒéº»çƒ¦ï¼Œè€Œä¸”å¦‚æœå±‚çº§å˜å¤šï¼Œæ›´ä¸æ˜“äºæ“ä½œå’Œç®¡ç†ï¼Œè™½ç„¶é‚£ç§æ–¹å¼å¾ˆå¥½å®ç°ï¼Œä½†æ˜¯åœ¨ä½¿ç”¨ä¸Šæœ‰å¾ˆå¤šçš„å¤æ‚åº¦ã€‚ä½ å¯ä»¥æƒ³åƒä¸€ä¸ªå›¾ä¹¦é¦†çš„å›¾ä¹¦åˆ†ç±»é—®é¢˜ï¼Œä½ å¯ä»¥æœ‰å„ç§ä¸åŒçš„åˆ†ç±»ï¼Œåˆ†ç±»å’Œå›¾ä¹¦å°±æ˜¯ä¸€ç§å¤šå¯¹å¤šçš„å…³ç³»ã€‚</p>
<p>æ‰€ä»¥ï¼Œåœ¨Kernel 3.16åï¼Œå¼•å…¥äº†unified hierarchyçš„æ–°çš„è®¾è®¡ï¼Œè¿™ä¸ªä¸œè¥¿å¼•å…¥äº†ä¸€ä¸ªå«__DEVEL__sane_behaviorçš„ç‰¹æ€§ï¼ˆè¿™ä¸ªåå­—å¾ˆæ˜æ˜¾æ„å‘³ç›®å‰è¿˜åœ¨å¼€å‘è¯•éªŒé˜¶æ®µï¼‰ï¼Œå®ƒå¯ä»¥æŠŠæ‰€æœ‰å­ç³»ç»Ÿéƒ½æŒ‚è½½åˆ°æ ¹å±‚çº§ä¸‹ï¼Œåªæœ‰å¶å­èŠ‚ç‚¹å¯ä»¥å­˜åœ¨tasksï¼Œéå¶å­èŠ‚ç‚¹åªè¿›è¡Œèµ„æºæ§åˆ¶ã€‚</p>
<p>æˆ‘ä»¬mountä¸€ä¸‹çœ‹çœ‹ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo mount -t cgroup -o __DEVEL__sane_behavior cgroup ./cgroup</span></span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> ls ./cgroup</span></span><br><span class="line">cgroup.controllers  cgroup.procs  cgroup.sane_behavior  cgroup.subtree_control </span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> cat ./cgroup/cgroup.controllers</span></span><br><span class="line">cpuset cpu cpuacct memory devices freezer net_cls blkio perf_event net_prio hugetlb</span><br></pre></td></tr></table></figure></div>
<p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æœ‰å››ä¸ªæ–‡ä»¶ï¼Œç„¶åï¼Œä½ åœ¨è¿™é‡Œmkdirä¸€ä¸ªå­ç›®å½•ï¼Œé‡Œé¢ä¹Ÿä¼šæœ‰è¿™å››ä¸ªæ–‡ä»¶ã€‚ä¸Šçº§çš„cgroup.subtree_controlæ§åˆ¶ä¸‹çº§çš„cgroup.controllersã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼šå‡è®¾æˆ‘ä»¬æœ‰ä»¥ä¸‹çš„ç›®å½•ç»“æ„ï¼Œbä»£è¡¨blkioï¼Œmä»£ç memoryï¼Œå…¶ä¸­ï¼ŒAæ˜¯rootï¼ŒåŒ…æ‹¬æ‰€æœ‰çš„å­ç³»ç»Ÿï¼ˆï¼‰ã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> A(b,m) - B(b,m) - C (b)</span></span><br><span class="line"><span class="meta">#</span><span class="bash">               \ - D (b) - E</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¸‹é¢çš„å‘½ä»¤ä¸­ï¼Œ +è¡¨ç¤º<span class="built_in">enable</span>ï¼Œ -è¡¨ç¤º<span class="built_in">disable</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> åœ¨Bä¸Šçš„<span class="built_in">enable</span> blkio</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">echo</span> +blkio &gt; A/cgroup.subtree_control</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> åœ¨Cå’ŒDä¸Š<span class="built_in">enable</span> blkio</span> </span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">echo</span> +blkio &gt; A/B/cgroup.subtree_control</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> åœ¨Bä¸Š<span class="built_in">enable</span> memory</span>  </span><br><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">echo</span> +memory &gt; A/cgroup.subtree_control</span></span><br></pre></td></tr></table></figure></div>
<p>åœ¨ä¸Šè¿°çš„ç»“æ„ä¸­ï¼Œ</p>
<ul>
<li>cgroupåªæœ‰ä¸Šçº¿æ§åˆ¶ä¸‹çº§ï¼Œæ— æ³•ä¼ é€’åˆ°ä¸‹ä¸‹çº§ã€‚æ‰€ä»¥ï¼ŒCå’ŒDä¸­æ²¡æœ‰memoryçš„é™åˆ¶ï¼ŒEä¸­æ²¡æœ‰blkioå’Œmemoryçš„é™åˆ¶ã€‚è€Œæœ¬å±‚çš„cgroup.controllersæ–‡ä»¶æ˜¯ä¸ªåªè¯»çš„ï¼Œå…¶ä¸­çš„å†…å®¹å°±çœ‹ä¸Šçº§çš„subtree_controlé‡Œæœ‰ä»€ä¹ˆäº†ã€‚</li>
<li>ä»»ä½•è¢«é…ç½®è¿‡subtree_controlçš„ç›®å½•éƒ½ä¸èƒ½ç»‘å®šè¿›ç¨‹ï¼Œæ ¹ç»“ç‚¹é™¤å¤–ã€‚æ‰€ä»¥ï¼ŒA,C,D,Eå¯ä»¥ç»‘ä¸Šè¿›ç¨‹ï¼Œä½†æ˜¯Bä¸è¡Œã€‚<br>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¿™ç§æ–¹å¼å¹²å‡€çš„åŒºåˆ†å¼€äº†ä¸¤ä¸ªäº‹ï¼Œä¸€ä¸ªæ˜¯è¿›ç¨‹çš„åˆ†ç»„ï¼Œä¸€ä¸ªæ˜¯å¯¹åˆ†ç»„çš„èµ„æºæ§åˆ¶ï¼ˆä»¥å‰è¿™ä¸¤ä¸ªäº‹å®Œå…¨æ··åœ¨ä¸€èµ·ï¼‰ï¼Œåœ¨ç›®å½•ç»§æ‰¿ä¸Šå¢åŠ äº†äº›é™åˆ¶ï¼Œè¿™æ ·å¯ä»¥é¿å…ä¸€äº›æ¨¡æ£±ä¸¤å¯çš„æƒ…å†µã€‚</li>
</ul>
<p>å½“ç„¶ï¼Œè¿™ä¸ªäº‹è¿˜åœ¨æ¼”åŒ–ä¸­ï¼Œcgroupçš„è¿™äº›é—®é¢˜è¿™ä¸ªäº‹ç›®å‰ç”±cgroupçš„åæ§½äººTejun Heoå’Œåä¸ºçš„Li ZefanåŒå­¦è´Ÿè´£è§£å†³ä¸­ã€‚æ€»ä¹‹ï¼Œè¿™æ˜¯ä¸€ä¸ªç³»ç»Ÿç®¡ç†ä¸Šçš„é—®é¢˜ï¼Œè€Œä¸”æ”¹å˜ä¼šå½±å“å¾ˆå¤šä¸œè¥¿ï¼Œä½†ä¸€æ—¦æ–¹æ¡ˆç¡®å®šï¼Œè€çš„cgroupæ–¹å¼å°†ä¸€å»ä¸å¤è¿”ã€‚</p>
]]></content>
      <tags>
        <tag>äº‘åŸç”ŸåŸºç¡€ç³»åˆ—</tag>
        <tag>Docker</tag>
      </tags>
  </entry>
  <entry>
    <title>Kubernetesç½‘ç»œç³»åˆ—ä¹‹(ä¸€)ç½‘ç»œæ˜¯æ€ä¹ˆè¿é€šçš„</title>
    <url>/2022/06/10/uncatalog/cl48bverj000054r77iq83ab9/</url>
    <content><![CDATA[<hr>
<span id="more"></span>



<hr>
<p>ä½ æ˜¯ä¸€å°ç”µè„‘ï¼Œä½ çš„åå­—å« A<br>å¾ˆä¹…å¾ˆä¹…ä¹‹å‰ï¼Œä½ ä¸ä¸ä»»ä½•å…¶ä»–ç”µè„‘ç›¸è¿æ¥ï¼Œå­¤è‹¦ä¼¶ä»ƒã€‚</p>
<p><img src="/2022/06/10/uncatalog/cl48bverj000054r77iq83ab9/1.png" alt="1.png"></p>
<p>ç›´åˆ°æœ‰ä¸€å¤©ï¼Œä½ å¸Œæœ›ä¸å¦ä¸€å°ç”µè„‘ B å»ºç«‹é€šä¿¡ï¼Œäºæ˜¯ä½ ä»¬å„å¼€äº†ä¸€ä¸ªç½‘å£ï¼Œç”¨ä¸€æ ¹ç½‘çº¿è¿æ¥äº†èµ·æ¥ã€‚</p>
<p><img src="/2022/06/10/uncatalog/cl48bverj000054r77iq83ab9/2.png" alt="2.png"></p>
<p>ç”¨ä¸€æ ¹ç½‘çº¿è¿æ¥èµ·æ¥æ€ä¹ˆå°±èƒ½â€é€šä¿¡â€äº†å‘¢ï¼Ÿæˆ‘å¯ä»¥ç»™ä½ è®² IOã€è®²ä¸­æ–­ã€è®²ç¼“å†²åŒºï¼Œä½†è¿™ä¸æ˜¯ç ”ç©¶ç½‘ç»œæ—¶è¯¥å…³å¿ƒçš„é—®é¢˜ã€‚</p>
<p>å¦‚æœä½ çº ç»“ï¼Œè¦ä¹ˆå»ç ”ç©¶ä¸€ä¸‹æ“ä½œç³»ç»Ÿæ˜¯å¦‚ä½•å¤„ç†ç½‘ç»œ IO çš„ï¼Œè¦ä¹ˆå»ç ”ç©¶ä¸€ä¸‹åŒ…æ˜¯å¦‚ä½•è¢«ç½‘å¡è½¬æ¢æˆç”µä¿¡å·å‘é€å‡ºå»çš„ï¼Œè¦ä¹ˆå°±ä»…ä»…æŠŠå®ƒå½“åšç”µè„‘é‡Œæœ‰ä¸ªå°äººåœ¨å¼€æªå§~</p>
<p><img src="/2022/06/10/uncatalog/cl48bverj000054r77iq83ab9/3.gif" alt="3.gif"></p>
<p>åæ­£ï¼Œä½ ä»¬å°±æ˜¯è¿èµ·æ¥äº†ï¼Œå¹¶ä¸”å¯ä»¥é€šä¿¡ã€‚</p>
 <center>ç¬¬ä¸€å±‚</center>


<p>æœ‰ä¸€å¤©ï¼Œä¸€ä¸ªæ–°ä¼™ä¼´ C åŠ å…¥äº†ï¼Œä½†èªæ˜çš„ä½ ä»¬å¾ˆå¿«å‘ç°ï¼Œå¯ä»¥æ¯ä¸ªäººå¼€ä¸¤ä¸ªç½‘å£ï¼Œç”¨ä¸€å…±ä¸‰æ ¹ç½‘çº¿ï¼Œå½¼æ­¤ç›¸è¿ã€‚<br><img src="/2022/06/10/uncatalog/cl48bverj000054r77iq83ab9/4.png" alt="4.png"></p>
<p>éšç€è¶Šæ¥è¶Šå¤šçš„äººåŠ å…¥ï¼Œä½ å‘ç°èº«ä¸Šå¼€çš„ç½‘å£å®åœ¨å¤ªå¤šäº†ï¼Œè€Œä¸”ç½‘çº¿å¯†å¯†éº»éº»ï¼Œæ··ä¹±ä¸å ªã€‚ï¼ˆè€Œå®é™…ä¸Šä¸€å°ç”µè„‘æ ¹æœ¬å¼€ä¸äº†è¿™ä¹ˆå¤šç½‘å£ï¼Œæ‰€ä»¥è¿™ç§è¿çº¿åªåœ¨ç†è®ºä¸Šå¯è¡Œï¼Œæ‰€ä»¥è¿ä¸ä¸Šçš„æˆ‘å°±ç”¨çº¢è‰²è™šçº¿è¡¨ç¤ºäº†ï¼Œå°±æ˜¯è¿™ä¹ˆä¸¥è°¨å“ˆå“ˆ~ï¼‰</p>
<p><img src="/2022/06/10/uncatalog/cl48bverj000054r77iq83ab9/5.png" alt="5.png"></p>
<p>äºæ˜¯ä½ ä»¬å‘æ˜äº†ä¸€ä¸ªä¸­é—´è®¾å¤‡ï¼Œä½ ä»¬å°†ç½‘çº¿éƒ½æ’åˆ°è¿™ä¸ªè®¾å¤‡ä¸Šï¼Œç”±è¿™ä¸ªè®¾å¤‡åšè½¬å‘ï¼Œå°±å¯ä»¥å½¼æ­¤ä¹‹é—´é€šä¿¡äº†ï¼Œæœ¬è´¨ä¸Šå’ŒåŸæ¥ä¸€æ ·ï¼Œåªä¸è¿‡ç½‘å£çš„æ•°é‡å’Œç½‘çº¿çš„æ•°é‡å‡å°‘äº†ï¼Œä¸å†é‚£ä¹ˆæ··ä¹±ã€‚</p>
<p><img src="/2022/06/10/uncatalog/cl48bverj000054r77iq83ab9/6.png" alt="6.png"></p>
<p>ä½ ç»™å®ƒå–åå«é›†çº¿å™¨ï¼Œå®ƒä»…ä»…æ˜¯æ— è„‘å°†ç”µä¿¡å·è½¬å‘åˆ°æ‰€æœ‰å‡ºå£ï¼ˆå¹¿æ’­ï¼‰ï¼Œä¸åšä»»ä½•å¤„ç†ï¼Œä½ è§‰å¾—å®ƒæ˜¯æ²¡æœ‰æ™ºå•†çš„ï¼Œå› æ­¤æŠŠäººå®¶å®šæ€§åœ¨äº†ç‰©ç†å±‚ã€‚</p>
<p><img src="/2022/06/10/uncatalog/cl48bverj000054r77iq83ab9/7.gif" alt="7.gif"></p>
<p>ç”±äºè½¬å‘åˆ°äº†æ‰€æœ‰å‡ºå£ï¼Œé‚£ BCDE å››å°æœºå™¨æ€ä¹ˆçŸ¥é“æ•°æ®åŒ…æ˜¯ä¸æ˜¯å‘ç»™è‡ªå·±çš„å‘¢ï¼Ÿ</p>
<p>é¦–å…ˆï¼Œä½ è¦ç»™æ‰€æœ‰çš„è¿æ¥åˆ°é›†çº¿å™¨çš„è®¾å¤‡ï¼Œéƒ½èµ·ä¸ªåå­—ã€‚åŸæ¥ä½ ä»¬å« ABCDï¼Œä½†ç°åœ¨éœ€è¦ä¸€ä¸ªæ›´ä¸“ä¸šçš„ï¼Œå…¨å±€å”¯ä¸€çš„åå­—ä½œä¸ºæ ‡è¯†ï¼Œä½ æŠŠè¿™ä¸ªæ›´é«˜ç«¯çš„åå­—ç§°ä¸º MAC åœ°å€ã€‚</p>
<p>ä½ çš„ MAC åœ°å€æ˜¯ aa-aa-aa-aa-aa-aaï¼Œä½ çš„ä¼™ä¼´ b çš„ MAC åœ°å€æ˜¯ bb-bb-bb-bb-bb-bbï¼Œä»¥æ­¤ç±»æ¨ï¼Œä¸é‡å¤å°±å¥½ã€‚</p>
<p>è¿™æ ·ï¼ŒA åœ¨å‘é€æ•°æ®åŒ…ç»™ B æ—¶ï¼Œåªè¦åœ¨å¤´éƒ¨æ‹¼æ¥ä¸€ä¸ªè¿™æ ·ç»“æ„çš„æ•°æ®ï¼Œå°±å¯ä»¥äº†ã€‚</p>
<p><img src="/2022/06/10/uncatalog/cl48bverj000054r77iq83ab9/8.png" alt="8.png"></p>
<p>B åœ¨æ”¶åˆ°æ•°æ®åŒ…åï¼Œæ ¹æ®å¤´éƒ¨çš„ç›®æ ‡ MAC åœ°å€ä¿¡æ¯ï¼Œåˆ¤æ–­è¿™ä¸ªæ•°æ®åŒ…çš„ç¡®æ˜¯å‘ç»™è‡ªå·±çš„ï¼Œäºæ˜¯ä¾¿æ”¶ä¸‹ã€‚</p>
<p>å…¶ä»–çš„ CDE æ”¶åˆ°æ•°æ®åŒ…åï¼Œæ ¹æ®å¤´éƒ¨çš„ç›®æ ‡ MAC åœ°å€ä¿¡æ¯ï¼Œåˆ¤æ–­è¿™ä¸ªæ•°æ®åŒ…å¹¶ä¸æ˜¯å‘ç»™è‡ªå·±çš„ï¼Œäºæ˜¯ä¾¿ä¸¢å¼ƒã€‚</p>
<p><img src="/2022/06/10/uncatalog/cl48bverj000054r77iq83ab9/9.gif" alt="9.gif"></p>
<p>è™½ç„¶é›†çº¿å™¨ä½¿æ•´ä¸ªå¸ƒå±€å¹²å‡€ä¸å°‘ï¼Œä½†åŸæ¥æˆ‘åªè¦å‘ç»™ç”µè„‘ B çš„æ¶ˆæ¯ï¼Œç°åœ¨å´è¦å‘ç»™è¿æ¥åˆ°é›†çº¿å™¨ä¸­çš„æ‰€æœ‰ç”µè„‘ï¼Œè¿™æ ·æ—¢ä¸å®‰å…¨ï¼Œåˆä¸èŠ‚çœç½‘ç»œèµ„æºã€‚</p>
<center>ç¬¬äºŒå±‚</center>



<p>å¦‚æœæŠŠè¿™ä¸ªé›†çº¿å™¨å¼„å¾—æ›´æ™ºèƒ½ä¸€äº›ï¼Œåªå‘ç»™ç›®æ ‡ MAC åœ°å€æŒ‡å‘çš„é‚£å°ç”µè„‘ï¼Œå°±å¥½äº†ã€‚</p>
<p><img src="/2022/06/10/uncatalog/cl48bverj000054r77iq83ab9/10.gif" alt="10.gif"></p>
<p>è™½ç„¶åªæ¯”é›†çº¿å™¨å¤šäº†è¿™ä¸€ç‚¹ç‚¹åŒºåˆ«ï¼Œä½†çœ‹èµ·æ¥ä¼¼ä¹æœ‰æ™ºèƒ½äº†ï¼Œä½ æŠŠè¿™ä¸œè¥¿å«åšäº¤æ¢æœºã€‚ä¹Ÿæ­£å› ä¸ºè¿™ä¸€ç‚¹ç‚¹æ™ºèƒ½ï¼Œä½ æŠŠå®ƒæ”¾åœ¨äº†å¦ä¸€ä¸ªå±‚çº§ï¼Œæ•°æ®é“¾è·¯å±‚ã€‚</p>
<p><img src="/2022/06/10/uncatalog/cl48bverj000054r77iq83ab9/11.png" alt="11.png"></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œä½ æ˜¯è¿™æ ·è®¾è®¡çš„ã€‚</p>
<p>äº¤æ¢æœºå†…éƒ¨ç»´æŠ¤ä¸€å¼  MAC åœ°å€è¡¨ï¼Œè®°å½•ç€æ¯ä¸€ä¸ª MAC åœ°å€çš„è®¾å¤‡ï¼Œè¿æ¥åœ¨å…¶å“ªä¸€ä¸ªç«¯å£ä¸Šã€‚</p>
<table>
<thead>
<tr>
<th align="left">MAC åœ°å€</th>
<th align="left">ç«¯å£</th>
</tr>
</thead>
<tbody><tr>
<td align="left">bb-bb-bb-bb-bb-bb</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">cc-cc-cc-cc-cc-cc</td>
<td align="left">3</td>
</tr>
<tr>
<td align="left">aa-aa-aa-aa-aa-aa</td>
<td align="left">4</td>
</tr>
<tr>
<td align="left">dd-dd-dd-dd-dd-dd</td>
<td align="left">5</td>
</tr>
<tr>
<td align="left">å‡å¦‚ä½ ä»ç„¶è¦å‘ç»™ B ä¸€ä¸ªæ•°æ®åŒ…ï¼Œæ„é€ äº†å¦‚ä¸‹çš„æ•°æ®ç»“æ„ä»ç½‘å£å‡ºå»ã€‚</td>
<td align="left"></td>
</tr>
</tbody></table>
<p><img src="/2022/06/10/uncatalog/cl48bverj000054r77iq83ab9/12.png" alt="12.png"></p>
<p>åˆ°è¾¾äº¤æ¢æœºæ—¶ï¼Œäº¤æ¢æœºå†…éƒ¨é€šè¿‡è‡ªå·±ç»´æŠ¤çš„ MAC åœ°å€è¡¨ï¼Œå‘ç°ç›®æ ‡æœºå™¨ B çš„ MAC åœ°å€ bb-bb-bb-bb-bb-bb æ˜ å°„åˆ°äº†ç«¯å£ 1 ä¸Šï¼Œäºæ˜¯æŠŠæ•°æ®ä» 1 å·ç«¯å£å‘ç»™äº† Bï¼Œå®Œäº‹~</p>
<p>ä½ ç»™è¿™ä¸ªé€šè¿‡è¿™æ ·ä¼ è¾“æ–¹å¼è€Œç»„æˆçš„å°èŒƒå›´çš„ç½‘ç»œï¼Œå«åšä»¥å¤ªç½‘ã€‚</p>
<p>å½“ç„¶æœ€å¼€å§‹çš„æ—¶å€™ï¼ŒMAC åœ°å€è¡¨æ˜¯ç©ºçš„ï¼Œæ˜¯æ€ä¹ˆé€æ­¥å»ºç«‹èµ·æ¥çš„å‘¢ï¼Ÿ</p>
<p>å‡å¦‚åœ¨ MAC åœ°å€è¡¨ä¸ºç©ºæ˜¯ï¼Œä½ ç»™ B å‘é€äº†å¦‚ä¸‹æ•°æ®</p>
<p><img src="/2022/06/10/uncatalog/cl48bverj000054r77iq83ab9/13.png" alt="13.png"></p>
<p>ç”±äºè¿™ä¸ªåŒ…ä»ç«¯å£ 4 è¿›å…¥çš„äº¤æ¢æœºï¼Œæ‰€ä»¥æ­¤æ—¶äº¤æ¢æœºå°±å¯ä»¥åœ¨ MACåœ°å€è¡¨è®°å½•ç¬¬ä¸€æ¡æ•°æ®ï¼š</p>
<p>MACï¼šaa-aa-aa-aa-aa-aa-aa<br>ç«¯å£ï¼š4</p>
<p>äº¤æ¢æœºçœ‹ç›®æ ‡ MAC åœ°å€ï¼ˆbb-bb-bb-bb-bb-bbï¼‰åœ¨åœ°å€è¡¨ä¸­å¹¶æ²¡æœ‰æ˜ å°„å…³ç³»ï¼Œäºæ˜¯å°†æ­¤åŒ…å‘ç»™äº†æ‰€æœ‰ç«¯å£ï¼Œä¹Ÿå³å‘ç»™äº†æ‰€æœ‰æœºå™¨ã€‚</p>
<p>ä¹‹åï¼Œåªæœ‰æœºå™¨ B æ”¶åˆ°äº†ç¡®å®æ˜¯å‘ç»™è‡ªå·±çš„åŒ…ï¼Œäºæ˜¯åšå‡ºäº†å“åº”ï¼Œå“åº”æ•°æ®ä»ç«¯å£ 1 è¿›å…¥äº¤æ¢æœºï¼Œäºæ˜¯äº¤æ¢æœºæ­¤æ—¶åœ¨åœ°å€è¡¨ä¸­æ›´æ–°äº†ç¬¬äºŒæ¡æ•°æ®ï¼š</p>
<p>MACï¼šbb-bb-bb-bb-bb-bb<br>ç«¯å£ï¼š1</p>
<p>è¿‡ç¨‹å¦‚ä¸‹</p>
<p><img src="/2022/06/10/uncatalog/cl48bverj000054r77iq83ab9/14.gif" alt="14.gif"></p>
<p>ç»è¿‡è¯¥ç½‘ç»œä¸­çš„æœºå™¨ä¸æ–­åœ°é€šä¿¡ï¼Œäº¤æ¢æœºæœ€ç»ˆå°† MAC åœ°å€è¡¨å»ºç«‹å®Œæ¯•~</p>
<p>éšç€æœºå™¨æ•°é‡è¶Šå¤šï¼Œäº¤æ¢æœºçš„ç«¯å£ä¹Ÿä¸å¤Ÿäº†ï¼Œä½†èªæ˜çš„ä½ å‘ç°ï¼Œåªè¦å°†å¤šä¸ªäº¤æ¢æœºè¿æ¥èµ·æ¥ï¼Œè¿™ä¸ªé—®é¢˜å°±è½»è€Œæ˜“ä¸¾æå®š~</p>
<p><img src="/2022/06/10/uncatalog/cl48bverj000054r77iq83ab9/15.png" alt="15.png"></p>
<p>ä½ å®Œå…¨ä¸éœ€è¦è®¾è®¡é¢å¤–çš„ä¸œè¥¿ï¼Œåªéœ€è¦æŒ‰ç…§ä¹‹å‰çš„è®¾è®¡å’Œè§„çŸ©æ¥ï¼ŒæŒ‰ç…§ä¸Šè¿°çš„æ¥çº¿æ–¹å¼å³å¯å®Œæˆæ‰€æœ‰ç”µè„‘çš„äº’è”ï¼Œæ‰€ä»¥äº¤æ¢æœºè®¾è®¡çš„è¿™ç§è§„åˆ™ï¼ŒçœŸçš„å¾ˆå·§å¦™ã€‚ä½ æƒ³æƒ³çœ‹ä¸ºä»€ä¹ˆï¼ˆæ¯”å¦‚ A è¦å‘æ•°æ®ç»™ Fï¼‰ã€‚</p>
<p>ä½†æ˜¯ä½ è¦æ³¨æ„ï¼Œä¸Šé¢é‚£æ ¹çº¢è‰²çš„çº¿ï¼Œæœ€ç»ˆåœ¨ MAC åœ°å€è¡¨ä¸­å¯ä¸æ˜¯ä¸€æ¡è®°å½•å‘€ï¼Œè€Œæ˜¯è¦æŠŠ EFGH è¿™å››å°æœºå™¨ä¸è¯¥ç«¯å£ï¼ˆç«¯å£6ï¼‰çš„æ˜ å°„å…¨éƒ¨è®°å½•åœ¨è¡¨ä¸­ã€‚</p>
<p>æœ€ç»ˆï¼Œä¸¤ä¸ªäº¤æ¢æœºå°†åˆ†åˆ«è®°å½• A ~ H æ‰€æœ‰æœºå™¨çš„æ˜ å°„è®°å½•ã€‚</p>
<p>å·¦è¾¹çš„äº¤æ¢æœº</p>
<table>
<thead>
<tr>
<th align="left">MAC åœ°å€</th>
<th align="left">ç«¯å£</th>
</tr>
</thead>
<tbody><tr>
<td align="left">bb-bb-bb-bb-bb-bb</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">cc-cc-cc-cc-cc-cc</td>
<td align="left">3</td>
</tr>
<tr>
<td align="left">aa-aa-aa-aa-aa-aa</td>
<td align="left">4</td>
</tr>
<tr>
<td align="left">dd-dd-dd-dd-dd-dd</td>
<td align="left">5</td>
</tr>
<tr>
<td align="left">ee-ee-ee-ee-ee-ee</td>
<td align="left">6</td>
</tr>
<tr>
<td align="left">ff-ff-ff-ff-ff-ff</td>
<td align="left">6</td>
</tr>
<tr>
<td align="left">gg-gg-gg-gg-gg-gg</td>
<td align="left">6</td>
</tr>
<tr>
<td align="left">hh-hh-hh-hh-hh-hh</td>
<td align="left">6</td>
</tr>
</tbody></table>
<p>å³è¾¹çš„äº¤æ¢æœº</p>
<table>
<thead>
<tr>
<th align="left">MAC åœ°å€</th>
<th align="left">ç«¯å£</th>
</tr>
</thead>
<tbody><tr>
<td align="left">bb-bb-bb-bb-bb-bb</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">cc-cc-cc-cc-cc-cc</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">aa-aa-aa-aa-aa-aa</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">dd-dd-dd-dd-dd-dd</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">ee-ee-ee-ee-ee-ee</td>
<td align="left">2</td>
</tr>
<tr>
<td align="left">ff-ff-ff-ff-ff-ff</td>
<td align="left">3</td>
</tr>
<tr>
<td align="left">gg-gg-gg-gg-gg-gg</td>
<td align="left">4</td>
</tr>
<tr>
<td align="left">hh-hh-hh-hh-hh-hh</td>
<td align="left">6</td>
</tr>
</tbody></table>
<p>è¿™åœ¨åªæœ‰ 8 å°ç”µè„‘çš„æ—¶å€™è¿˜å¥½ï¼Œç”šè‡³åœ¨åªæœ‰å‡ ç™¾å°ç”µè„‘çš„æ—¶å€™ï¼Œéƒ½è¿˜å¥½ï¼Œæ‰€ä»¥è¿™ç§äº¤æ¢æœºçš„è®¾è®¡æ–¹å¼ï¼Œå·²ç»è¶³è¶³æ”¯æ’‘ä¸€é˜µå­äº†ã€‚</p>
<p>ä½†å¾ˆé—æ†¾ï¼Œäººæ˜¯è´ªå©ªçš„åŠ¨ç‰©ï¼Œå¾ˆå¿«ï¼Œç”µè„‘çš„æ•°é‡å°±å‘å±•åˆ°å‡ åƒã€å‡ ä¸‡ã€å‡ åä¸‡ã€‚</p>
<center>ç¬¬ä¸‰å±‚</center>

<p>äº¤æ¢æœºå·²ç»æ— æ³•è®°å½•å¦‚æ­¤åºå¤§çš„æ˜ å°„å…³ç³»äº†ã€‚</p>
<p>æ­¤æ—¶ä½ åŠ¨äº†æ­ªè„‘ç­‹ï¼Œä½ å‘ç°äº†é—®é¢˜çš„æ ¹æœ¬åœ¨äºï¼Œè¿å‡ºå»çš„é‚£æ ¹çº¢è‰²çš„ç½‘çº¿ï¼Œåé¢ä¸çŸ¥é“æœ‰å¤šå°‘ä¸ªè®¾å¤‡ä¸æ–­åœ°è¿æ¥è¿›æ¥ï¼Œä»è€Œä½¿å¾—åœ°å€è¡¨è¶Šæ¥è¶Šå¤§ã€‚</p>
<p>é‚£æˆ‘å¯ä¸å¯ä»¥è®©é‚£æ ¹çº¢è‰²çš„ç½‘çº¿ï¼Œæ¥å…¥ä¸€ä¸ªæ–°çš„è®¾å¤‡ï¼Œè¿™ä¸ªè®¾å¤‡å°±è·Ÿç”µè„‘ä¸€æ ·æœ‰è‡ªå·±ç‹¬ç«‹çš„ MAC åœ°å€ï¼Œè€Œä¸”åŒæ—¶è¿˜èƒ½å¸®æˆ‘æŠŠæ•°æ®åŒ…åšä¸€æ¬¡è½¬å‘å‘¢ï¼Ÿ</p>
<p>è¿™ä¸ªè®¾å¤‡å°±æ˜¯è·¯ç”±å™¨ï¼Œå®ƒçš„åŠŸèƒ½å°±æ˜¯ï¼Œä½œä¸ºä¸€å°ç‹¬ç«‹çš„æ‹¥æœ‰ MAC åœ°å€çš„è®¾å¤‡ï¼Œå¹¶ä¸”å¯ä»¥å¸®æˆ‘æŠŠæ•°æ®åŒ…åšä¸€æ¬¡è½¬å‘ï¼Œä½ æŠŠå®ƒå®šåœ¨äº†ç½‘ç»œå±‚ã€‚</p>
<p><img src="/2022/06/10/uncatalog/cl48bverj000054r77iq83ab9/16.png" alt="16.png"></p>
<p>æ³¨æ„ï¼Œè·¯ç”±å™¨çš„æ¯ä¸€ä¸ªç«¯å£ï¼Œéƒ½æœ‰ç‹¬ç«‹çš„ MAC åœ°å€</p>
<p>å¥½äº†ï¼Œç°åœ¨äº¤æ¢æœºçš„ MAC åœ°å€è¡¨ä¸­ï¼Œåªéœ€è¦å¤šå‡ºä¸€æ¡ MAC åœ°å€ ABAB ä¸å…¶ç«¯å£çš„æ˜ å°„å…³ç³»ï¼Œå°±å¯ä»¥æˆåŠŸæŠŠæ•°æ®åŒ…è½¬äº¤ç»™è·¯ç”±å™¨äº†ï¼Œè¿™æ¡æå®šã€‚</p>
<p>é‚£å¦‚ä½•åšåˆ°ï¼ŒæŠŠå‘é€ç»™ C å’Œ Dï¼Œç”šè‡³æ˜¯æŠŠå‘é€ç»™ DEFGHâ€¦. çš„æ•°æ®åŒ…ï¼Œç»Ÿç»Ÿå…ˆå‘é€ç»™è·¯ç”±å™¨å‘¢ï¼Ÿ</p>
<p>ä¸éš¾æƒ³åˆ°è¿™æ ·ä¸€ä¸ªç‚¹å­ï¼Œå‡å¦‚ç”µè„‘ C å’Œ D çš„ MAC åœ°å€æ‹¥æœ‰å…±åŒçš„å‰ç¼€ï¼Œæ¯”å¦‚åˆ†åˆ«æ˜¯</p>
<p>C çš„ MAC åœ°å€ï¼šFFFF-FFFF-CCCC<br>D çš„ MAC åœ°å€ï¼šFFFF-FFFF-DDDD<br>é‚£æˆ‘ä»¬å°±å¯ä»¥è¯´ï¼Œå°†ç›®æ ‡ MAC åœ°å€ä¸º FFFF-FFFF-ï¼Ÿå¼€å¤´çš„ï¼Œç»Ÿç»Ÿå…ˆå‘é€ç»™è·¯ç”±å™¨ã€‚</p>
<p>è¿™æ ·æ˜¯å¦å¯è¡Œå‘¢ï¼Ÿç­”æ¡ˆæ˜¯å¦å®šçš„ã€‚</p>
<p>æˆ‘ä»¬å…ˆä»ç°å®ä¸­ MAC åœ°å€çš„ç»“æ„å…¥æ‰‹ï¼ŒMACåœ°å€ä¹Ÿå«ç‰©ç†åœ°å€ã€ç¡¬ä»¶åœ°å€ï¼Œé•¿åº¦ä¸º 48 ä½ï¼Œä¸€èˆ¬è¿™æ ·æ¥è¡¨ç¤º</p>
<p>00-16-EA-AE-3C-40</p>
<p>å®ƒæ˜¯ç”±ç½‘ç»œè®¾å¤‡åˆ¶é€ å•†ç”Ÿäº§æ—¶çƒ§å½•åœ¨ç½‘å¡çš„EPROMï¼ˆä¸€ç§é—ªå­˜èŠ¯ç‰‡ï¼Œé€šå¸¸å¯ä»¥é€šè¿‡ç¨‹åºæ“¦å†™ï¼‰ã€‚å…¶ä¸­å‰ 24 ä½ï¼ˆ00-16-EAï¼‰ä»£è¡¨ç½‘ç»œç¡¬ä»¶åˆ¶é€ å•†çš„ç¼–å·ï¼Œå 24 ä½ï¼ˆAE-3C-40ï¼‰æ˜¯è¯¥å‚å®¶è‡ªå·±åˆ†é…çš„ï¼Œä¸€èˆ¬è¡¨ç¤ºç³»åˆ—å·ã€‚åªè¦ä¸æ›´æ”¹è‡ªå·±çš„ MAC åœ°å€ï¼ŒMAC åœ°å€åœ¨ä¸–ç•Œæ˜¯å”¯ä¸€çš„ã€‚å½¢è±¡åœ°è¯´ï¼ŒMACåœ°å€å°±å¦‚åŒèº«ä»½è¯ä¸Šçš„èº«ä»½è¯å·ç ï¼Œå…·æœ‰å”¯ä¸€æ€§ã€‚</p>
<p>é‚£å¦‚æœä½ å¸Œæœ›å‘ä¸Šé¢é‚£æ ·è¡¨ç¤ºå°†ç›®æ ‡ MAC åœ°å€ä¸º FFFF-FFFF-ï¼Ÿå¼€å¤´çš„ï¼Œç»Ÿä¸€ä»è·¯ç”±å™¨å‡ºå»å‘ç»™æŸä¸€ç¾¤è®¾å¤‡ï¼ˆåé¢ä¼šæåˆ°è¿™å…¶å®æ˜¯å­ç½‘çš„æ¦‚å¿µï¼‰ï¼Œé‚£ä½ å°±éœ€è¦è¦æ±‚æŸä¸€å­ç½‘ä¸‹ç»Ÿç»Ÿä¹°ä¸€ä¸ªå‚å•†åˆ¶é€ çš„è®¾å¤‡ï¼Œè¦ä¹ˆä½ å°±éœ€è¦è¦æ±‚å‚å•†åœ¨ç”Ÿäº§ç½‘ç»œè®¾å¤‡çƒ§å½• MAC åœ°å€æ—¶ï¼Œæå‰æŒ‰ç…§ä½ è§„åˆ’å¥½çš„å­ç½‘ç»“æ„æ¥å®š MAC åœ°å€ï¼Œå¹¶ä¸”æ—¥åè¿™ä¸ªç½‘ç»œçš„ç»“æ„éƒ½ä¸èƒ½è½»æ˜“æ”¹å˜ã€‚</p>
<p>è¿™æ˜¾ç„¶æ˜¯ä¸ç°å®çš„ã€‚</p>
<p>äºæ˜¯ä½ å‘æ˜äº†ä¸€ä¸ªæ–°çš„åœ°å€ï¼Œç»™æ¯ä¸€å°æœºå™¨ä¸€ä¸ª 32 ä½çš„ç¼–å·ï¼Œå¦‚ï¼š</p>
<p>11000000101010000000000000000001</p>
<p>ä½ è§‰å¾—æœ‰äº›ä¸æ¸…æ™°ï¼Œäºæ˜¯æŠŠå®ƒåˆ†æˆå››ä¸ªéƒ¨åˆ†ï¼Œä¸­é—´ç”¨ç‚¹ç›¸è¿ã€‚</p>
<p>11000000.10101000.00000000.00000001</p>
<p>ä½ è¿˜è§‰å¾—ä¸æ¸…æ™°ï¼Œäºæ˜¯æŠŠå®ƒè½¬æ¢æˆ 10 è¿›åˆ¶ã€‚</p>
<p>192.168.0.1</p>
<p>æœ€åä½ ç»™äº†è¿™ä¸ªåœ°å€ä¸€ä¸ªå“äº®çš„åå­—ï¼ŒIP åœ°å€ã€‚ç°åœ¨æ¯ä¸€å°ç”µè„‘ï¼ŒåŒæ—¶æœ‰è‡ªå·±çš„ MAC åœ°å€ï¼Œåˆæœ‰è‡ªå·±çš„ IP åœ°å€ï¼Œåªä¸è¿‡ IP åœ°å€æ˜¯è½¯ä»¶å±‚é¢ä¸Šçš„ï¼Œå¯ä»¥éšæ—¶ä¿®æ”¹ï¼ŒMAC åœ°å€ä¸€èˆ¬æ˜¯æ— æ³•ä¿®æ”¹çš„ã€‚</p>
<p>è¿™æ ·ä¸€ä¸ªå¯ä»¥éšæ—¶ä¿®æ”¹çš„ IP åœ°å€ï¼Œå°±å¯ä»¥æ ¹æ®ä½ è§„åˆ’çš„ç½‘ç»œæ‹“æ‰‘ç»“æ„ï¼Œæ¥è°ƒæ•´äº†ã€‚</p>
<p><img src="/2022/06/10/uncatalog/cl48bverj000054r77iq83ab9/17.png" alt="17.png"></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå‡å¦‚æˆ‘æƒ³è¦å‘é€æ•°æ®åŒ…ç»™ ABCD å…¶ä¸­ä¸€å°è®¾å¤‡ï¼Œä¸è®ºå“ªä¸€å°ï¼Œæˆ‘éƒ½å¯ä»¥è¿™æ ·æè¿°ï¼Œâ€å°† IP åœ°å€ä¸º 192.168.0 å¼€å¤´çš„å…¨éƒ¨å‘é€ç»™åˆ°è·¯ç”±å™¨ï¼Œä¹‹åå†æ€ä¹ˆè½¬å‘ï¼Œäº¤ç»™å®ƒï¼â€ï¼Œå·§å¦™å§ã€‚</p>
<p>é‚£äº¤ç»™è·¯ç”±å™¨ä¹‹åï¼Œè·¯ç”±å™¨åˆæ˜¯æ€ä¹ˆæŠŠæ•°æ®åŒ…å‡†ç¡®è½¬å‘ç»™æŒ‡å®šè®¾å¤‡çš„å‘¢ï¼Ÿ</p>
<p>åˆ«æ€¥æˆ‘ä»¬æ…¢æ…¢æ¥ã€‚</p>
<p>æˆ‘ä»¬å…ˆç»™ä¸Šé¢çš„ç»„ç½‘æ–¹å¼ä¸­çš„æ¯ä¸€å°è®¾å¤‡ï¼ŒåŠ ä¸Šè‡ªå·±çš„ IP åœ°å€</p>
<p><img src="/2022/06/10/uncatalog/cl48bverj000054r77iq83ab9/18.png" alt="18.png"></p>
<p>ç°åœ¨ä¸¤ä¸ªè®¾å¤‡ä¹‹é—´ä¼ è¾“ï¼Œé™¤äº†åŠ ä¸Šæ•°æ®é“¾è·¯å±‚çš„å¤´éƒ¨ä¹‹å¤–ï¼Œè¿˜è¦å†å¢åŠ ä¸€ä¸ªç½‘ç»œå±‚çš„å¤´éƒ¨ã€‚</p>
<p>å‡å¦‚ A ç»™ B å‘é€æ•°æ®ï¼Œç”±äºå®ƒä»¬ç›´æ¥è¿ç€äº¤æ¢æœºï¼Œæ‰€ä»¥ A ç›´æ¥å‘å‡ºå¦‚ä¸‹æ•°æ®åŒ…å³å¯ï¼Œå…¶å®ç½‘ç»œå±‚æ²¡æœ‰ä½“ç°å‡ºä½œç”¨ã€‚</p>
<p><img src="/2022/06/10/uncatalog/cl48bverj000054r77iq83ab9/19.png" alt="19.png"></p>
<p>ä½†å‡å¦‚ A ç»™ C å‘é€æ•°æ®ï¼ŒA å°±éœ€è¦å…ˆè½¬äº¤ç»™è·¯ç”±å™¨ï¼Œç„¶åå†ç”±è·¯ç”±å™¨è½¬äº¤ç»™ Cã€‚ç”±äºæœ€åº•å±‚çš„ä¼ è¾“ä»ç„¶éœ€è¦ä¾èµ–ä»¥å¤ªç½‘ï¼Œæ‰€ä»¥æ•°æ®åŒ…æ˜¯åˆ†æˆä¸¤æ®µçš„ã€‚</p>
<p>A ~ è·¯ç”±å™¨è¿™æ®µçš„åŒ…å¦‚ä¸‹ï¼š</p>
<p><img src="/2022/06/10/uncatalog/cl48bverj000054r77iq83ab9/20.png" alt="20.png"></p>
<p>è·¯ç”±å™¨åˆ° C è¿™æ®µçš„åŒ…å¦‚ä¸‹ï¼š</p>
<p><img src="/2022/06/10/uncatalog/cl48bverj000054r77iq83ab9/21.png" alt="21.png"></p>
<p>å¥½äº†ï¼Œä¸Šé¢è¯´çš„ä¸¤ç§æƒ…å†µï¼ˆA-&gt;Bï¼ŒA-&gt;Cï¼‰ï¼Œç›¸ä¿¡ç»†å¿ƒçš„è¯»è€…åº”è¯¥ä¼šæœ‰ä¸å°‘ç–‘é—®ï¼Œä¸‹é¢æˆ‘ä»¬ä¸€ä¸ªä¸ªæ¥å±•å¼€ã€‚</p>
<p>A ç»™ C å‘æ•°æ®åŒ…ï¼Œæ€ä¹ˆçŸ¥é“æ˜¯å¦è¦é€šè¿‡è·¯ç”±å™¨è½¬å‘å‘¢ï¼Ÿ</p>
<p>ç­”æ¡ˆï¼šå­ç½‘</p>
<p>å¦‚æœæº IP ä¸ç›®çš„ IP å¤„äºä¸€ä¸ªå­ç½‘ï¼Œç›´æ¥å°†åŒ…é€šè¿‡äº¤æ¢æœºå‘å‡ºå»ã€‚</p>
<p>å¦‚æœæº IP ä¸ç›®çš„ IP ä¸å¤„äºä¸€ä¸ªå­ç½‘ï¼Œå°±äº¤ç»™è·¯ç”±å™¨å»å¤„ç†ã€‚</p>
<p>å¥½ï¼Œé‚£ç°åœ¨åªéœ€è¦è§£å†³ï¼Œä»€ä¹ˆå«å¤„äºä¸€ä¸ªå­ç½‘å°±å¥½äº†ã€‚</p>
<ul>
<li><p>192.168.0.1 å’Œ 192.168.0.2 å¤„äºåŒä¸€ä¸ªå­ç½‘</p>
</li>
<li><p>192.168.0.1 å’Œ 192.168.1.1 å¤„äºä¸åŒå­ç½‘</p>
</li>
</ul>
<p>è¿™ä¸¤ä¸ªæ˜¯æˆ‘ä»¬äººä¸ºè§„å®šçš„ï¼Œå³æˆ‘ä»¬æƒ³è¡¨ç¤ºï¼Œå¯¹äº 192.168.0.1 æ¥è¯´ï¼š</p>
<p>192.168.0.xxx å¼€å¤´çš„ï¼Œå°±ç®—æ˜¯åœ¨ä¸€ä¸ªå­ç½‘ï¼Œå¦åˆ™å°±æ˜¯åœ¨ä¸åŒçš„å­ç½‘ã€‚</p>
<p>é‚£å¯¹äºè®¡ç®—æœºæ¥è¯´ï¼Œæ€ä¹ˆè¡¨è¾¾è¿™ä¸ªæ„æ€å‘¢ï¼Ÿäºæ˜¯äººä»¬å‘æ˜äº†å­ç½‘æ©ç çš„æ¦‚å¿µ</p>
<p>å‡å¦‚æŸå°æœºå™¨çš„å­ç½‘æ©ç å®šä¸º 255.255.255.0</p>
<p>è¿™è¡¨ç¤ºï¼Œå°†æº IP ä¸ç›®çš„ IP åˆ†åˆ«åŒè¿™ä¸ªå­ç½‘æ©ç è¿›è¡Œä¸è¿ç®—ï¼Œç›¸ç­‰åˆ™æ˜¯åœ¨ä¸€ä¸ªå­ç½‘ï¼Œä¸ç›¸ç­‰å°±æ˜¯åœ¨ä¸åŒå­ç½‘ï¼Œå°±è¿™ä¹ˆç®€å•ã€‚</p>
<p>æ¯”å¦‚</p>
<ul>
<li><p>Aç”µè„‘ï¼š192.168.0.1 &amp; 255.255.255.0 = 192.168.0.0</p>
</li>
<li><p>Bç”µè„‘ï¼š192.168.0.2 &amp; 255.255.255.0 = 192.168.0.0</p>
</li>
<li><p>Cç”µè„‘ï¼š192.168.1.1 &amp; 255.255.255.0 = 192.168.1.0</p>
</li>
<li><p>Dç”µè„‘ï¼š192.168.1.2 &amp; 255.255.255.0 = 192.168.1.0</p>
</li>
</ul>
<p>é‚£ä¹ˆ A ä¸ B åœ¨åŒä¸€ä¸ªå­ç½‘ï¼ŒC ä¸ D åœ¨åŒä¸€ä¸ªå­ç½‘ï¼Œä½†æ˜¯ A ä¸ C å°±ä¸åœ¨åŒä¸€ä¸ªå­ç½‘ï¼Œä¸ D ä¹Ÿä¸åœ¨åŒä¸€ä¸ªå­ç½‘ï¼Œä»¥æ­¤ç±»æ¨ã€‚</p>
<p><img src="/2022/06/10/uncatalog/cl48bverj000054r77iq83ab9/22.png" alt="22.png"></p>
<p>æ‰€ä»¥å¦‚æœ A ç»™ C å‘æ¶ˆæ¯ï¼ŒA å’Œ C çš„ IP åœ°å€åˆ†åˆ« &amp; A æœºå™¨é…ç½®çš„å­ç½‘æ©ç ï¼Œå‘ç°ä¸ç›¸ç­‰ï¼Œåˆ™ A è®¤ä¸º C å’Œè‡ªå·±ä¸åœ¨åŒä¸€ä¸ªå­ç½‘ï¼Œäºæ˜¯æŠŠåŒ…å‘ç»™è·¯ç”±å™¨ï¼Œå°±ä¸ç®¡äº†ï¼Œä¹‹åæ€ä¹ˆè½¬å‘ï¼ŒA ä¸å…³å¿ƒã€‚</p>
<blockquote>
<p>A å¦‚ä½•çŸ¥é“ï¼Œå“ªä¸ªè®¾å¤‡æ˜¯è·¯ç”±å™¨ï¼Ÿ</p>
</blockquote>
<p>ç­”æ¡ˆï¼šåœ¨ A ä¸Šè¦è®¾ç½®é»˜è®¤ç½‘å…³</p>
<p>ä¸Šä¸€æ­¥ A é€šè¿‡æ˜¯å¦ä¸ C åœ¨åŒä¸€ä¸ªå­ç½‘å†…ï¼Œåˆ¤æ–­å‡ºè‡ªå·±åº”è¯¥æŠŠåŒ…å‘ç»™è·¯ç”±å™¨ï¼Œé‚£è·¯ç”±å™¨çš„ IP æ˜¯å¤šå°‘å‘¢ï¼Ÿ</p>
<p>å…¶å®è¯´å‘ç»™è·¯ç”±å™¨ä¸å‡†ç¡®ï¼Œåº”è¯¥è¯´ A ä¼šæŠŠåŒ…å‘ç»™é»˜è®¤ç½‘å…³ã€‚</p>
<p>å¯¹ A æ¥è¯´ï¼ŒA åªèƒ½ç›´æ¥æŠŠåŒ…å‘ç»™åŒå¤„äºä¸€ä¸ªå­ç½‘ä¸‹çš„æŸä¸ª IP ä¸Šï¼Œæ‰€ä»¥å‘ç»™è·¯ç”±å™¨è¿˜æ˜¯å‘ç»™æŸä¸ªç”µè„‘ï¼Œå¯¹ A æ¥è¯´ä¹Ÿä¸å…³å¿ƒï¼Œåªè¦è¿™ä¸ªè®¾å¤‡æœ‰ä¸ª IP åœ°å€å°±è¡Œã€‚</p>
<p>æ‰€ä»¥é»˜è®¤ç½‘å…³ï¼Œå°±æ˜¯ A åœ¨è‡ªå·±ç”µè„‘é‡Œé…ç½®çš„ä¸€ä¸ª IP åœ°å€ï¼Œä»¥ä¾¿åœ¨å‘ç»™ä¸åŒå­ç½‘çš„æœºå™¨æ—¶ï¼Œå‘ç»™è¿™ä¸ª IP åœ°å€ã€‚</p>
<p><img src="/2022/06/10/uncatalog/cl48bverj000054r77iq83ab9/23.png" alt="23.png"></p>
<p>ä»…æ­¤è€Œå·²ï¼</p>
<blockquote>
<p>è·¯ç”±å™¨å¦‚ä½•çŸ¥é“Cåœ¨å“ªé‡Œï¼Ÿ</p>
</blockquote>
<p>ç­”æ¡ˆï¼šè·¯ç”±è¡¨</p>
<p>ç°åœ¨ A è¦ç»™ C å‘æ•°æ®åŒ…ï¼Œå·²ç»å¯ä»¥æˆåŠŸå‘åˆ°è·¯ç”±å™¨è¿™é‡Œäº†ï¼Œæœ€åä¸€ä¸ªé—®é¢˜å°±æ˜¯ï¼Œè·¯ç”±å™¨æ€ä¹ˆçŸ¥é“ï¼Œæ”¶åˆ°çš„è¿™ä¸ªæ•°æ®åŒ…ï¼Œè¯¥ä»è‡ªå·±çš„å“ªä¸ªç«¯å£å‡ºå»ï¼Œæ‰èƒ½ç›´æ¥ï¼ˆæˆ–é—´æ¥ï¼‰åœ°æœ€ç»ˆåˆ°è¾¾ç›®çš„åœ° C å‘¢ã€‚</p>
<p>è·¯ç”±å™¨æ”¶åˆ°çš„æ•°æ®åŒ…æœ‰ç›®çš„ IP ä¹Ÿå°±æ˜¯ C çš„ IP åœ°å€ï¼Œéœ€è¦è½¬åŒ–æˆä»è‡ªå·±çš„å“ªä¸ªç«¯å£å‡ºå»ï¼Œå¾ˆå®¹æ˜“æƒ³åˆ°ï¼Œåº”è¯¥æœ‰ä¸ªè¡¨ï¼Œå°±åƒ MAC åœ°å€è¡¨ä¸€æ ·ã€‚</p>
<p>è¿™ä¸ªè¡¨å°±å«è·¯ç”±è¡¨ã€‚</p>
<p>è‡³äºè¿™ä¸ªè·¯ç”±è¡¨æ˜¯æ€ä¹ˆå‡ºæ¥çš„ï¼Œæœ‰å¾ˆå¤šè·¯ç”±ç®—æ³•ï¼Œæœ¬æ–‡ä¸å±•å¼€ï¼Œå› ä¸ºæˆ‘ä¹Ÿä¸ä¼šå“ˆå“ˆ~</p>
<p>ä¸åŒäº MAC åœ°å€è¡¨çš„æ˜¯ï¼Œè·¯ç”±è¡¨å¹¶ä¸æ˜¯ä¸€å¯¹ä¸€è¿™ç§æ˜ç¡®å…³ç³»ï¼Œæˆ‘ä»¬ä¸‹é¢çœ‹ä¸€ä¸ªè·¯ç”±è¡¨çš„ç»“æ„ã€‚</p>
<table>
<thead>
<tr>
<th align="left">ç›®çš„åœ°å€</th>
<th align="left">å­ç½‘æ©ç </th>
<th align="left">ä¸‹ä¸€è·³</th>
<th align="left">ç«¯å£</th>
</tr>
</thead>
<tbody><tr>
<td align="left">192.168.0.0</td>
<td align="left">255.255.255.0</td>
<td align="left"></td>
<td align="left">0</td>
</tr>
<tr>
<td align="left">192.168.0.254</td>
<td align="left">255.255.255.255</td>
<td align="left"></td>
<td align="left">0</td>
</tr>
<tr>
<td align="left">192.168.1.0</td>
<td align="left">255.255.255.0</td>
<td align="left"></td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">192.168.1.254</td>
<td align="left">255.255.255.255</td>
<td align="left"></td>
<td align="left">1</td>
</tr>
</tbody></table>
<p>æˆ‘ä»¬å­¦ä¹ ä¸€ç§æ–°çš„è¡¨ç¤ºæ–¹æ³•ï¼Œç”±äºå­ç½‘æ©ç å…¶å®å°±è¡¨ç¤ºå‰å¤šå°‘ä½è¡¨ç¤ºå­ç½‘çš„ç½‘æ®µï¼Œæ‰€ä»¥å¦‚ 192.168.0.0ï¼ˆ255.255.255.0ï¼‰ ä¹Ÿå¯ä»¥ç®€å†™ä¸º 192.168.0.0/24</p>
<table>
<thead>
<tr>
<th align="left">ç›®çš„åœ°å€</th>
<th align="left">ä¸‹ä¸€è·³</th>
<th align="left">ç«¯å£</th>
</tr>
</thead>
<tbody><tr>
<td align="left">192.168.0.0/24</td>
<td align="left"></td>
<td align="left">0</td>
</tr>
<tr>
<td align="left">192.168.0.254/32</td>
<td align="left"></td>
<td align="left">0</td>
</tr>
<tr>
<td align="left">192.168.1.0/24</td>
<td align="left"></td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">192.168.1.254/32</td>
<td align="left"></td>
<td align="left">1</td>
</tr>
</tbody></table>
<p>è¿™å°±å¾ˆå¥½ç†è§£äº†ï¼Œè·¯ç”±è¡¨å°±è¡¨ç¤ºï¼Œ192.168.0.xxx è¿™ä¸ªå­ç½‘ä¸‹çš„ï¼Œéƒ½è½¬å‘åˆ° 0 å·ç«¯å£ï¼Œ192.168.1.xxx è¿™ä¸ªå­ç½‘ä¸‹çš„ï¼Œéƒ½è½¬å‘åˆ° 1 å·ç«¯å£ã€‚ä¸‹ä¸€è·³åˆ—è¿˜æ²¡æœ‰å€¼ï¼Œæˆ‘ä»¬å…ˆä¸ç®¡</p>
<p>é…åˆç€ç»“æ„å›¾æ¥çœ‹ï¼ˆè¿™é‡ŒæŠŠå­ç½‘æ©ç å’Œé»˜è®¤ç½‘å…³éƒ½è¡¥é½äº†ï¼‰å›¾ä¸­ &amp; ç¬”è¯¯ï¼Œç»“æœåº”è¯¥æ˜¯ .0</p>
<p><img src="/2022/06/10/uncatalog/cl48bverj000054r77iq83ab9/24.gif" alt="24.gif"></p>
<blockquote>
<p>åˆšæ‰è¯´çš„éƒ½æ˜¯ IP å±‚ï¼Œä½†å‘é€æ•°æ®åŒ…çš„æ•°æ®é“¾è·¯å±‚éœ€è¦çŸ¥é“ MAC åœ°å€ï¼Œå¯æ˜¯æˆ‘åªçŸ¥é“ IP åœ°å€è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p>
</blockquote>
<p>ç­”æ¡ˆï¼šarp</p>
<p>å‡å¦‚ä½ ï¼ˆAï¼‰æ­¤æ—¶ä¸çŸ¥é“ä½ åŒä¼´ B çš„ MAC åœ°å€ï¼ˆç°å®ä¸­å°±æ˜¯ä¸çŸ¥é“çš„ï¼Œåˆšåˆšæˆ‘ä»¬åªæ˜¯å‡è®¾å·²çŸ¥ï¼‰ï¼Œä½ åªçŸ¥é“å®ƒçš„ IP åœ°å€ï¼Œä½ è¯¥æ€ä¹ˆæŠŠæ•°æ®åŒ…å‡†ç¡®ä¼ ç»™ B å‘¢ï¼Ÿ</p>
<p>ç­”æ¡ˆå¾ˆç®€å•ï¼Œåœ¨ç½‘ç»œå±‚ï¼Œæˆ‘éœ€è¦æŠŠ IP åœ°å€å¯¹åº”çš„ MAC åœ°å€æ‰¾åˆ°ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡æŸç§æ–¹å¼ï¼Œæ‰¾åˆ° 192.168.0.2 å¯¹åº”çš„ MAC åœ°å€ BBBBã€‚</p>
<p>è¿™ç§æ–¹å¼å°±æ˜¯ arp åè®®ï¼ŒåŒæ—¶ç”µè„‘ A å’Œ B é‡Œé¢ä¹Ÿä¼šæœ‰ä¸€å¼  arp ç¼“å­˜è¡¨ï¼Œè¡¨ä¸­è®°å½•ç€ IP ä¸ MAC åœ°å€çš„å¯¹åº”å…³ç³»ã€‚</p>
<table>
<thead>
<tr>
<th align="left">IP åœ°å€</th>
<th align="left">MAC åœ°å€</th>
</tr>
</thead>
<tbody><tr>
<td align="left">192.168.0.2</td>
<td align="left">BBBB</td>
</tr>
</tbody></table>
<p>ä¸€å¼€å§‹çš„æ—¶å€™è¿™ä¸ªè¡¨æ˜¯ç©ºçš„ï¼Œç”µè„‘ A ä¸ºäº†çŸ¥é“ç”µè„‘ Bï¼ˆ192.168.0.2ï¼‰çš„ MAC åœ°å€ï¼Œå°†ä¼šå¹¿æ’­ä¸€æ¡ arp è¯·æ±‚ï¼ŒB æ”¶åˆ°è¯·æ±‚åï¼Œå¸¦ä¸Šè‡ªå·±çš„ MAC åœ°å€ç»™ A ä¸€ä¸ªå“åº”ã€‚æ­¤æ—¶ A ä¾¿æ›´æ–°äº†è‡ªå·±çš„ arp è¡¨ã€‚</p>
<p>è¿™æ ·é€šè¿‡å¤§å®¶ä¸æ–­å¹¿æ’­ arp è¯·æ±‚ï¼Œæœ€ç»ˆæ‰€æœ‰ç”µè„‘é‡Œé¢éƒ½å°† arp ç¼“å­˜è¡¨æ›´æ–°å®Œæ•´ã€‚</p>
<center>æ€»ç»“ä¸€ä¸‹</center>


<p>å¥½äº†ï¼Œæ€»ç»“ä¸€ä¸‹ï¼Œåˆ°ç›®å‰ä¸ºæ­¢å°±å‡ æ¡è§„åˆ™</p>
<p>ä»å„ä¸ªèŠ‚ç‚¹çš„è§†è§’æ¥çœ‹</p>
<p>ç”µè„‘è§†è§’ï¼š</p>
<ul>
<li><p>é¦–å…ˆæˆ‘è¦çŸ¥é“æˆ‘çš„ IP ä»¥åŠå¯¹æ–¹çš„ IP</p>
</li>
<li><p>é€šè¿‡å­ç½‘æ©ç åˆ¤æ–­æˆ‘ä»¬æ˜¯å¦åœ¨åŒä¸€ä¸ªå­ç½‘</p>
</li>
<li><p>åœ¨åŒä¸€ä¸ªå­ç½‘å°±é€šè¿‡ arp è·å–å¯¹æ–¹ mac åœ°å€ç›´æ¥æ‰”å‡ºå»</p>
</li>
<li><p>ä¸åœ¨åŒä¸€ä¸ªå­ç½‘å°±é€šè¿‡ arp è·å–é»˜è®¤ç½‘å…³çš„ mac åœ°å€ç›´æ¥æ‰”å‡ºå»</p>
</li>
</ul>
<p>äº¤æ¢æœºè§†è§’ï¼š</p>
<ul>
<li><p>æˆ‘æ”¶åˆ°çš„æ•°æ®åŒ…å¿…é¡»æœ‰ç›®æ ‡ MAC åœ°å€</p>
</li>
<li><p>é€šè¿‡ MAC åœ°å€è¡¨æŸ¥æ˜ å°„å…³ç³»</p>
</li>
<li><p>æŸ¥åˆ°äº†å°±æŒ‰ç…§æ˜ å°„å…³ç³»ä»æˆ‘çš„æŒ‡å®šç«¯å£å‘å‡ºå»</p>
</li>
<li><p>æŸ¥ä¸åˆ°å°±æ‰€æœ‰ç«¯å£éƒ½å‘å‡ºå»</p>
</li>
</ul>
<p>è·¯ç”±å™¨è§†è§’ï¼š</p>
<ul>
<li><p>æˆ‘æ”¶åˆ°çš„æ•°æ®åŒ…å¿…é¡»æœ‰ç›®æ ‡ IP åœ°å€</p>
</li>
<li><p>é€šè¿‡è·¯ç”±è¡¨æŸ¥æ˜ å°„å…³ç³»</p>
</li>
<li><p>æŸ¥åˆ°äº†å°±æŒ‰ç…§æ˜ å°„å…³ç³»ä»æˆ‘çš„æŒ‡å®šç«¯å£å‘å‡ºå»ï¼ˆä¸åœ¨ä»»ä½•ä¸€ä¸ªå­ç½‘èŒƒå›´ï¼Œèµ°å…¶è·¯ç”±å™¨çš„é»˜è®¤ç½‘å…³ä¹Ÿæ˜¯æŸ¥åˆ°äº†ï¼‰</p>
</li>
<li><p>æŸ¥ä¸åˆ°åˆ™è¿”å›ä¸€ä¸ªè·¯ç”±ä¸å¯è¾¾çš„æ•°æ®åŒ…</p>
</li>
</ul>
<p>å¦‚æœä½ å—…è§‰è¶³å¤Ÿæ•é”ï¼Œä½ åº”è¯¥å¯ä»¥æ„Ÿå—åˆ°ä¸‹é¢è¿™å¥è¯ï¼š</p>
<p>ç½‘ç»œå±‚ï¼ˆIPåè®®ï¼‰æœ¬èº«æ²¡æœ‰ä¼ è¾“åŒ…çš„åŠŸèƒ½ï¼ŒåŒ…çš„å®é™…ä¼ è¾“æ˜¯å§”æ‰˜ç»™æ•°æ®é“¾è·¯å±‚ï¼ˆä»¥å¤ªç½‘ä¸­çš„äº¤æ¢æœºï¼‰æ¥å®ç°çš„ã€‚</p>
<p>æ¶‰åŠåˆ°çš„ä¸‰å¼ è¡¨åˆ†åˆ«æ˜¯</p>
<ul>
<li><p>äº¤æ¢æœºä¸­æœ‰ MAC åœ°å€è¡¨ç”¨äºæ˜ å°„ MAC åœ°å€å’Œå®ƒçš„ç«¯å£</p>
</li>
<li><p>è·¯ç”±å™¨ä¸­æœ‰è·¯ç”±è¡¨ç”¨äºæ˜ å°„ IP åœ°å€(æ®µ)å’Œå®ƒçš„ç«¯å£</p>
</li>
<li><p>ç”µè„‘å’Œè·¯ç”±å™¨ä¸­éƒ½æœ‰ arp ç¼“å­˜è¡¨ç”¨äºç¼“å­˜ IP å’Œ MAC åœ°å€çš„æ˜ å°„å…³ç³»</p>
</li>
</ul>
<p>è¿™ä¸‰å¼ è¡¨æ˜¯æ€ä¹ˆæ¥çš„</p>
<ul>
<li><p>MAC åœ°å€è¡¨æ˜¯é€šè¿‡ä»¥å¤ªç½‘å†…å„èŠ‚ç‚¹ä¹‹é—´ä¸æ–­é€šè¿‡äº¤æ¢æœºé€šä¿¡ï¼Œä¸æ–­å®Œå–„èµ·æ¥çš„ã€‚</p>
</li>
<li><p>è·¯ç”±è¡¨æ˜¯å„ç§è·¯ç”±ç®—æ³• + äººå·¥é…ç½®é€æ­¥å®Œå–„èµ·æ¥çš„ã€‚</p>
</li>
<li><p>arp ç¼“å­˜è¡¨æ˜¯ä¸æ–­é€šè¿‡ arp åè®®çš„è¯·æ±‚é€æ­¥å®Œå–„èµ·æ¥çš„ã€‚</p>
</li>
</ul>
<p>çŸ¥é“äº†ä»¥ä¸Šè¿™äº›ï¼Œç›®å‰ç½‘ç»œä¸Šä¸¤ä¸ªèŠ‚ç‚¹æ˜¯å¦‚ä½•å‘é€æ•°æ®åŒ…çš„è¿™ä¸ªè¿‡ç¨‹ï¼Œå°±å®Œå…¨å¯ä»¥è§£é‡Šé€šäº†ï¼</p>
<p>é‚£æ¥ä¸‹æ¥æˆ‘ä»¬å°±æ”¾ä¸Šæœ¬ç«  æœ€åä¸€ä¸ª ç½‘ç»œæ‹“æ‰‘å›¾å§ï¼Œè¯·åšå¥½ æˆ˜æ–— å‡†å¤‡ï¼</p>
<p><img src="/2022/06/10/uncatalog/cl48bverj000054r77iq83ab9/25.png" alt="25.png"></p>
<p>è¿™æ—¶è·¯ç”±å™¨ 1 è¿æ¥äº†è·¯ç”±å™¨ 2ï¼Œæ‰€ä»¥å…¶è·¯ç”±è¡¨æœ‰äº†ä¸‹ä¸€æ¡åœ°å€è¿™ä¸€ä¸ªæ¦‚å¿µï¼Œæ‰€ä»¥å®ƒçš„è·¯ç”±è¡¨å°±å˜æˆäº†è¿™ä¸ªæ ·å­ã€‚å¦‚æœåŒ¹é…åˆ°äº†æœ‰ä¸‹ä¸€è·³åœ°å€çš„ä¸€é¡¹ï¼Œåˆ™éœ€è¦å†æ¬¡åŒ¹é…ï¼Œæ‰¾åˆ°å…¶ç«¯å£ï¼Œå¹¶æ‰¾åˆ°ä¸‹ä¸€è·³ IP çš„ MAC åœ°å€ã€‚</p>
<p>ä¹Ÿå°±æ˜¯è¯´æ‰¾æ¥æ‰¾å»ï¼Œæœ€ç»ˆå¿…é¡»èƒ½æ˜ å°„åˆ°ä¸€ä¸ªç«¯å£å·ï¼Œç„¶åä»è¿™ä¸ªç«¯å£å·æŠŠæ•°æ®åŒ…å‘å‡ºå»ã€‚</p>
<table>
<thead>
<tr>
<th align="left">ç›®çš„åœ°å€</th>
<th align="left">ä¸‹ä¸€è·³</th>
<th align="left">ç«¯å£</th>
</tr>
</thead>
<tbody><tr>
<td align="left">192.168.0.0/24</td>
<td align="left"></td>
<td align="left">0</td>
</tr>
<tr>
<td align="left">192.168.0.254/32</td>
<td align="left"></td>
<td align="left">0</td>
</tr>
<tr>
<td align="left">192.168.1.0/24</td>
<td align="left"></td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">192.168.1.254/32</td>
<td align="left"></td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">192.168.2.0/24</td>
<td align="left">192.168.100.5</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">192.168.100.0/24</td>
<td align="left"></td>
<td align="left">2</td>
</tr>
<tr>
<td align="left">192.168.100.4/32</td>
<td align="left"></td>
<td align="left">2</td>
</tr>
</tbody></table>
<p>è¿™æ—¶å¦‚æœ A ç»™ F å‘é€ä¸€ä¸ªæ•°æ®åŒ…ï¼Œèƒ½ä¸èƒ½é€šå‘¢ï¼Ÿå¦‚æœé€šçš„è¯æ•´ä¸ªè¿‡ç¨‹æ˜¯æ€æ ·çš„å‘¢ï¼Ÿ</p>
<p><img src="/2022/06/10/uncatalog/cl48bverj000054r77iq83ab9/26.png" alt="26.png"></p>
<p>æ€è€ƒä¸€åˆ†é’Ÿâ€¦</p>
<p>è¯¦ç»†è¿‡ç¨‹åŠ¨ç”»æè¿°ï¼š</p>
<p><img src="/2022/06/10/uncatalog/cl48bverj000054r77iq83ab9/27.gif" alt="27.gif"></p>
<p>è¯¦ç»†è¿‡ç¨‹æ–‡å­—æè¿°ï¼š</p>
<ol>
<li><p>é¦–å…ˆ Aï¼ˆ192.168.0.1ï¼‰é€šè¿‡å­ç½‘æ©ç ï¼ˆ255.255.255.0ï¼‰è®¡ç®—å‡ºè‡ªå·±ä¸ Fï¼ˆ192.168.2.2ï¼‰å¹¶ä¸åœ¨åŒä¸€ä¸ªå­ç½‘å†…ï¼Œäºæ˜¯å†³å®šå‘é€ç»™é»˜è®¤ç½‘å…³ï¼ˆ192.168.0.254ï¼‰</p>
</li>
<li><p>A é€šè¿‡ ARP æ‰¾åˆ° é»˜è®¤ç½‘å…³ 192.168.0.254 çš„ MAC åœ°å€ã€‚</p>
</li>
<li><p>A å°†æº MAC åœ°å€ï¼ˆAAAAï¼‰ä¸ç½‘å…³ MAC åœ°å€ï¼ˆABABï¼‰å°è£…åœ¨æ•°æ®é“¾è·¯å±‚å¤´éƒ¨ï¼Œåˆå°†æº IP åœ°å€ï¼ˆ192.168.0.1ï¼‰å’Œç›®çš„ IP åœ°å€ï¼ˆ192.168.2.2ï¼‰ï¼ˆæ³¨æ„è¿™é‡Œåƒä¸‡ä¸è¦ä»¥ä¸ºå¡«å†™çš„æ˜¯é»˜è®¤ç½‘å…³çš„ IP åœ°å€ï¼Œä»å§‹è‡³ç»ˆè¿™ä¸ªæ•°æ®åŒ…çš„ä¸¤ä¸ª IP åœ°å€éƒ½æ˜¯ä¸å˜çš„ï¼Œåªæœ‰ MAC åœ°å€åœ¨ä¸æ–­å˜åŒ–ï¼‰å°è£…åœ¨ç½‘ç»œå±‚å¤´éƒ¨ï¼Œç„¶åå‘åŒ…<br><img src="/2022/06/10/uncatalog/cl48bverj000054r77iq83ab9/28.png" alt="28.png"></p>
</li>
<li><p>äº¤æ¢æœº 1 æ”¶åˆ°æ•°æ®åŒ…åï¼Œå‘ç°ç›®æ ‡ MAC åœ°å€æ˜¯ ABABï¼Œè½¬å‘ç»™è·¯ç”±å™¨1</p>
</li>
<li><p>æ•°æ®åŒ…æ¥åˆ°äº†è·¯ç”±å™¨ 1ï¼Œå‘ç°å…¶ç›®æ ‡ IP åœ°å€æ˜¯ 192.168.2.2ï¼ŒæŸ¥çœ‹å…¶è·¯ç”±è¡¨ï¼Œå‘ç°äº†ä¸‹ä¸€è·³çš„åœ°å€æ˜¯ 192.168.100.5</p>
</li>
<li><p>æ‰€ä»¥æ­¤æ—¶è·¯ç”±å™¨ 1 éœ€è¦åšä¸¤ä»¶äº‹ï¼Œç¬¬ä¸€ä»¶æ˜¯å†æ¬¡åŒ¹é…è·¯ç”±è¡¨ï¼Œå‘ç°åŒ¹é…åˆ°äº†ç«¯å£ä¸º 2ï¼Œäºæ˜¯å°†å…¶å°è£…åˆ°æ•°æ®é“¾è·¯å±‚ï¼Œæœ€åæŠŠåŒ…ä» 2 å·å£å‘å‡ºå»ã€‚</p>
</li>
<li><p>æ­¤æ—¶è·¯ç”±å™¨ 2 æ”¶åˆ°äº†æ•°æ®åŒ…ï¼Œçœ‹åˆ°å…¶ç›®çš„åœ°å€æ˜¯ 192.168.2.2ï¼ŒæŸ¥è¯¢å…¶è·¯ç”±è¡¨ï¼ŒåŒ¹é…åˆ°ç«¯å£å·ä¸º 1ï¼Œå‡†å¤‡ä» 1 å·å£æŠŠæ•°æ®åŒ…é€å‡ºå»ã€‚</p>
</li>
<li><p>ä½†æ­¤æ—¶è·¯ç”±å™¨ 2 éœ€è¦çŸ¥é“ 192.168.2.2 çš„ MAC åœ°å€äº†ï¼Œäºæ˜¯æŸ¥çœ‹å…¶ arp ç¼“å­˜ï¼Œæ‰¾åˆ°å…¶ MAC åœ°å€ä¸º FFFFï¼Œå°†å…¶å°è£…åœ¨æ•°æ®é“¾è·¯å±‚å¤´éƒ¨ï¼Œå¹¶ä» 1 å·ç«¯å£æŠŠåŒ…å‘å‡ºå»ã€‚</p>
</li>
<li><p>äº¤æ¢æœº 3 æ”¶åˆ°äº†æ•°æ®åŒ…ï¼Œå‘ç°ç›®çš„ MAC åœ°å€ä¸º FFFFï¼ŒæŸ¥è¯¢å…¶ MAC åœ°å€è¡¨ï¼Œå‘ç°åº”è¯¥ä»å…¶ 6 å·ç«¯å£å‡ºå»ï¼Œäºæ˜¯ä» 6 å·ç«¯å£æŠŠæ•°æ®åŒ…å‘å‡ºå»ã€‚</p>
</li>
<li><p>F æœ€ç»ˆæ”¶åˆ°äº†æ•°æ®åŒ…ï¼å¹¶ä¸”å‘ç°ç›®çš„ MAC åœ°å€å°±æ˜¯è‡ªå·±ï¼Œäºæ˜¯æ”¶ä¸‹äº†è¿™ä¸ªåŒ…<br>æ›´è¯¦ç»†ä¸”ç²¾å‡†çš„è¿‡ç¨‹ï¼š<br>è¯»åˆ°è¿™ç›¸ä¿¡å¤§å®¶å·²ç»å¾ˆç´¯äº†ï¼Œç†è§£ä¸Šè¿°è¿‡ç¨‹åŸºæœ¬ä¸Šç½‘ç»œå±‚ä»¥ä¸‹çš„éƒ¨åˆ†ä¸»æµç¨‹å°±åŸºæœ¬ç–é€šäº†ï¼Œå¦‚æœä½ æƒ³è¦æœ¬è¿‡ç¨‹æ›´ä¸ºä¸“ä¸šçš„è¿‡ç¨‹æè¿°ï¼Œå¯ä»¥åœ¨å…¬ä¼—å·â€ä½å¹¶å‘ç¼–ç¨‹â€åå°å›å¤â€ç½‘ç»œâ€ï¼Œè·å¾—æˆ‘æ¨¡æ‹Ÿè¿™ä¸ªè¿‡ç¨‹çš„ Cisco Packet Tracer æºæ–‡ä»¶ã€‚</p>
</li>
</ol>
<p><img src="/2022/06/10/uncatalog/cl48bverj000054r77iq83ab9/29.png" alt="29.png"></p>
<p>æ¯ä¸€æ­¥åŒ…çš„ä¼ è¾“éƒ½ä¼šæœ‰å„å±‚çš„åŸå§‹æ•°æ®ï¼Œä»¥åŠä¸“ä¸šçš„è¿‡ç¨‹æè¿°</p>
<p><img src="/2022/06/10/uncatalog/cl48bverj000054r77iq83ab9/30.png" alt="30.png"></p>
<p>åŒæ—¶åœ¨æ­¤åŸºç¡€ä¹‹ä¸Šä½ ä¹Ÿå¯ä»¥è®¾è®¡è‡ªå·±çš„ç½‘ç»œæ‹“æ‰‘ç»“æ„ï¼Œè¿›è¡Œå„ç§å®éªŒï¼Œæ¥åŠ æ·±ç½‘ç»œä¼ è¾“è¿‡ç¨‹çš„ç†è§£ã€‚</p>
<p>åè®°</p>
<p>è‡³æ­¤ï¼Œç»è¿‡ç‰©ç†å±‚ã€æ•°æ®é“¾è·¯å±‚ã€ç½‘ç»œå±‚è¿™å‰ä¸‰å±‚çš„åè®®ï¼Œä»¥åŠæ ¹æ®è¿™äº›åè®®è®¾è®¡çš„å„ç§ç½‘ç»œè®¾å¤‡ï¼ˆç½‘çº¿ã€é›†çº¿å™¨ã€äº¤æ¢æœºã€è·¯ç”±å™¨ï¼‰ï¼Œç†è®ºä¸Šåªè¦æ‹¥æœ‰å¯¹æ–¹çš„ IP åœ°å€ï¼Œå°±å·²ç»å°†åœ°çƒä¸Šä»»æ„ä½ç½®çš„ä¸¤ä¸ªèŠ‚ç‚¹è¿é€šäº†ã€‚</p>
<p><img src="/2022/06/10/uncatalog/cl48bverj000054r77iq83ab9/31.png" alt="31.png"></p>
<p>æœ¬æ–‡ç»è¿‡äº†å¾ˆå¤šæ¬¡çš„ä¿®æ”¹ï¼Œåˆ å‡äº†ä¸å°‘å½±å“ä¸»æµç¨‹çš„å†…å®¹ï¼Œå°±æ˜¯ä¸ºäº†è®©è¯»è€…èƒ½æŠ“ä½ç½‘ç»œä¼ è¾“å‰ä¸‰å±‚çš„çœŸæ­£æ ¸å¿ƒæ€æƒ³ã€‚åŒæ—¶ç½‘ç»œç›¸å…³çš„çŸ¥è¯†ä¹Ÿæ˜¯å¤šä¸”æ‚ï¼Œæˆ‘ä¹Ÿè¿˜æœ‰å¾ˆå¤šæä¸æ¸…æ¥šçš„åœ°æ–¹ï¼Œéå¸¸æ¬¢è¿å¤§å®¶ä¸æˆ‘äº¤æµï¼Œå…±åŒè¿›æ­¥ã€‚</p>
<p>è¯»åˆ°è¿™é‡Œéƒ½æ˜¯çœŸçˆ±äº†ï¼Œå½“ç„¶è¦èµ ä¸€ä¸ªæŠ•ç¥¨ã€‚</p>
]]></content>
      <tags>
        <tag>äº‘åŸç”ŸåŸºç¡€ç³»åˆ—</tag>
        <tag>Kubernetes</tag>
        <tag>Kubernetesç½‘ç»œ</tag>
      </tags>
  </entry>
  <entry>
    <title>kubernetesè¯»ä¹¦ç¬”è®°</title>
    <url>/2022/06/10/uncatalog/cl48eey5y0000owr728gk66p6/</url>
    <content><![CDATA[<hr>
<span id="more"></span>

<hr>
<h3 id="What-is-Kubernetes"><a href="#What-is-Kubernetes" class="headerlink" title="What is Kubernetes?"></a>What is Kubernetes?</h3><p><a href="https://kubernetes.io/docs/concepts/overview/what-is-kubernetes/">å®˜æ–¹è§£é‡Š</a>ï¼š </p>
<blockquote>
<p>Kubernetes is a portable, extensible, open source platform for managing containerized workloads and services, that facilitates both declarative configuration and automation. It has a large, rapidly growing ecosystem. Kubernetes services, support, and tools are widely available.<br>ç¿»è¯‘æˆå¤§ç™½è¯å°±æ˜¯ï¼šâ€œK8S è´Ÿè´£è‡ªåŠ¨åŒ–è¿ç»´ç®¡ç†å¤šä¸ª Docker ç¨‹åºçš„é›†ç¾¤â€ã€‚</p>
</blockquote>
<h3 id="Why-is-Kubernetes"><a href="#Why-is-Kubernetes" class="headerlink" title="Why is Kubernetes?"></a>Why is Kubernetes?</h3><p>è¯•æƒ³ä¸‹ä¼ ç»Ÿçš„åç«¯éƒ¨ç½²åŠæ³•ï¼šæŠŠç¨‹åºåŒ…ï¼ˆåŒ…æ‹¬å¯æ‰§è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶ã€é…ç½®æ–‡ä»¶ç­‰ï¼‰æ”¾åˆ°æœåŠ¡å™¨ä¸Šï¼Œæ¥ç€è¿è¡Œå¯åŠ¨è„šæœ¬æŠŠç¨‹åºè·‘èµ·æ¥ï¼ŒåŒæ—¶å¯åŠ¨å®ˆæŠ¤è„šæœ¬å®šæœŸæ£€æŸ¥ç¨‹åºè¿è¡ŒçŠ¶æ€ã€å¿…è¦çš„è¯é‡æ–°æ‹‰èµ·ç¨‹åºã€‚<br>æœ‰é—®é¢˜å—ï¼Ÿæ˜¾ç„¶æœ‰ï¼æœ€å¤§çš„ä¸€ä¸ªé—®é¢˜åœ¨äºï¼š<strong>å¦‚æœæœåŠ¡çš„è¯·æ±‚é‡ä¸Šæ¥ï¼Œå·²éƒ¨ç½²çš„æœåŠ¡å“åº”ä¸è¿‡æ¥æ€ä¹ˆåŠï¼Ÿ</strong>ä¼ ç»Ÿçš„åšæ³•å¾€å¾€æ˜¯ï¼Œå¦‚æœè¯·æ±‚é‡ã€å†…å­˜ã€CPU è¶…è¿‡é˜ˆå€¼åšäº†å‘Šè­¦ï¼Œè¿ç»´é©¬ä¸Šå†åŠ å‡ å°æœåŠ¡å™¨ï¼Œéƒ¨ç½²å¥½æœåŠ¡ä¹‹åï¼Œæ¥å…¥è´Ÿè½½å‡è¡¡æ¥åˆ†æ‹…å·²æœ‰æœåŠ¡çš„å‹åŠ›ã€‚<br>é—®é¢˜å‡ºç°äº†ï¼šä»ç›‘æ§å‘Šè­¦åˆ°éƒ¨ç½²æœåŠ¡ï¼Œä¸­é—´éœ€è¦äººåŠ›ä»‹å…¥ï¼é‚£ä¹ˆï¼Œæœ‰æ²¡æœ‰åŠæ³•è‡ªåŠ¨å®ŒæˆæœåŠ¡çš„éƒ¨ç½²ã€æ›´æ–°ã€å¸è½½å’Œæ‰©å®¹ã€ç¼©å®¹å‘¢ï¼Ÿè¿™ï¼Œå°±æ˜¯ K8S è¦åšçš„äº‹æƒ…ï¼šè‡ªåŠ¨åŒ–è¿ç»´ç®¡ç† Dockerï¼ˆå®¹å™¨åŒ–ï¼‰ç¨‹åºã€‚  </p>
<p>è½¯ä»¶å¼€å‘70å¹´å†å²ï¼Œè½¯ä»¶å·¥ç¨‹å‘å±•äº†è¿‘50å¹´ï¼Œäº’è”ç½‘ä»å‡ºç°åˆ°ç°åœ¨çš„è“¬å‹ƒå‘å±•äºŒåå¤šå¹´ã€‚è½¯ä»¶å¼€å‘çš„æ¨¡å‹ä»æœ€æ—©çš„ç€‘å¸ƒæ¨¡å‹ï¼Œåˆ°æ•æ·å¼€å‘ï¼Œå†åˆ°ç°åœ¨çš„DevOpsç†å¿µã€‚è½¯ä»¶çš„å½¢æ€ä»ç‰©ç†æ‰çº¿ï¼Œåˆ°æ‰“å­”ç¼–ç¨‹ï¼Œå†åˆ°å¤§æœºï¼Œåˆ°å¾®æœºï¼Œåˆ°ç½‘ç»œæ—¶ä»£çš„C/Sã€B/Sã€å†åˆ°ç§»åŠ¨äº’è”ç½‘æ—¶ä»£Appã€‚æ¶æ„çš„æ¼”å˜ç»è¿‡å‡ åå¹´çš„è¿›åŒ–ï¼Œåœ¨ç¡¬ä»¶ã€ç½‘ç»œã€ä¿¡æ¯çš„è®¤çŸ¥ã€ç”¨æˆ·æ•°ç­‰éƒ½è¾¾åˆ°æ¡ä»¶åï¼Œå†æ‰å‘å±•å‡ºäº†å¾®æœåŠ¡ï¼Œç„¶åè¿›è€Œæ‰å‡ºç°äº†Kubernetesçš„æ¡†æ¶ã€‚</p>
<p>ç»å¤§éƒ¨åˆ†çš„äººè®¤ä¸ºKubernetesåªæ˜¯ä¸€ä¸ªåŸºç¡€å¹³å°ã€‚ä½†å®é™…å¤§éƒ¨åˆ†äººéƒ½æƒ³ä¸æ˜ç™½ï¼Œä¸ºä»€ä¹ˆä¸ºå‡ºç°Kubernetesè¿™æ ·çš„å¹³å°ã€‚ç‰©ç†æœºä¸èƒ½è·‘å¾®æœåŠ¡å—ï¼Œè™šæ‹Ÿæœºä¸èƒ½è·‘å¾®æœåŠ¡å—ï¼Ÿä½ æƒ³ä¸æ˜ç™½è¿™ä¸ªé—®é¢˜ï¼Œä½ å°±æ²¡æ³•å…¥é—¨Kubernetesï¼Œé—æ†¾çš„æ˜¯ï¼Œè¿™ä¸€ç‚¹ä¹Ÿæ˜¯ç»å¤§å¤šæ•°Kubernetesæ‰€æ²¡æœ‰å…³æ³¨åˆ°çš„ã€‚</p>
<p>Kubernetesçš„å‡ºç°æ˜¯å¤§å‹äº’è”ç½‘å…¬å¸ï¼ˆGoogleï¼‰åœ¨éå¸¸åºå¤§çš„å¾®æœåŠ¡ä½“ç³»ä¸‹ï¼Œä¸ºäº†é™ä½ç»´æŠ¤æˆæœ¬ï¼Œä¸ºäº†æé«˜ç»´æŠ¤æ•ˆç‡ï¼Œæé«˜äº¤ä»˜æ•ˆç‡ï¼Œæ›´é‡è¦æ˜¯ä¸ºäº†æœåŠ¡è‡ªæ²»ä¸æ–­æ€è€ƒå’Œå®è·µæ‰å¼€å‘å‡ºæ¥çš„ã€‚ITè¡Œä¸šçš„æŠ€æœ¯é©æ–°ï¼Œæ€»æ˜¯ä¼šæœ‰å…ˆé©±è€…ä¸ºæˆ‘ä»¬è‰°è¾›çš„èººå¹³é“è·¯ï¼Œç„¶åæˆ‘ä»¬å†ç«™åœ¨å·¨äººçš„è‚©è†€ä¸Šå€Ÿå¾—æ›´é«˜çš„è§†é‡ï¼Œä½†æ˜¯ç°åœ¨å¾ˆå¤šäººéƒ½è¢«çœ¼å‰çš„æ ‘å¶ç»™é®æŒ¡äº†ï¼Œæ¯”å¦‚ç›®å‰äº’è”ç½‘æµ®èºçš„å°±ä¸šç¯å¢ƒã€‚</p>
<h3 id="æ­£é¢˜ï¼šKubernetesè¯»ä¹¦ç¬”è®°"><a href="#æ­£é¢˜ï¼šKubernetesè¯»ä¹¦ç¬”è®°" class="headerlink" title="æ­£é¢˜ï¼šKubernetesè¯»ä¹¦ç¬”è®°"></a>æ­£é¢˜ï¼šKubernetesè¯»ä¹¦ç¬”è®°</h3><h3 id="1ï¼Œã€ŠKubernetesæƒå¨æŒ‡å—ï¼šä»Dockeråˆ°Kuberneteså®è·µå…¨æ¥è§¦ï¼ˆç¬¬5ç‰ˆï¼‰ã€‹"><a href="#1ï¼Œã€ŠKubernetesæƒå¨æŒ‡å—ï¼šä»Dockeråˆ°Kuberneteså®è·µå…¨æ¥è§¦ï¼ˆç¬¬5ç‰ˆï¼‰ã€‹" class="headerlink" title="1ï¼Œã€ŠKubernetesæƒå¨æŒ‡å—ï¼šä»Dockeråˆ°Kuberneteså®è·µå…¨æ¥è§¦ï¼ˆç¬¬5ç‰ˆï¼‰ã€‹"></a>1ï¼Œã€ŠKubernetesæƒå¨æŒ‡å—ï¼šä»Dockeråˆ°Kuberneteså®è·µå…¨æ¥è§¦ï¼ˆç¬¬5ç‰ˆï¼‰ã€‹</h3><p><img src="/2022/06/10/uncatalog/cl48eey5y0000owr728gk66p6/1.jpg" alt="1.jpg"><br>è¿™æœ¬ä¹¦æˆ–è€…è¯´Kubernetes,å¯¹äºå½“æ—¶çš„æˆ‘æ¥è¯´ï¼Œéå¸¸çš„æœ‰é­”åŠ›ï¼Œç°åœ¨å›æƒ³èµ·æ¥ï¼Œä¹Ÿèƒ½ä¸ç¦ç¬‘å‡ºå£°æ¥ã€‚<br><img src="/2022/06/10/uncatalog/cl48eey5y0000owr728gk66p6/2.png" alt="2.png"><br>éå¸¸é€‚åˆå°ç™½å…¥é—¨ï¼Œä½†æ˜¯ä¹Ÿä»…é™äºå…¥é—¨ï¼Œä¸å…¶è¯´æ˜¯æƒå¨æŒ‡å—ï¼Œä¸å¦‚è¯´æ˜¯å…¥é—¨æŒ‡å—ã€‚<br>é‡Œé¢çš„å†…å®¹ï¼Œå‡ ä¹æ¶µç›–äº†Kubernetesè¿ç»´ç›¸å…³çš„çš„æ–¹æ–¹é¢é¢ï¼Œå¹¿åº¦æœ‰ä½™ï¼Œè€Œæ·±åº¦ä¸è¶³ã€‚</p>
<p>æˆ–è®¸æ˜¯å› ä¸ºä¹¦åèµ·çš„è°ƒå¤ªé«˜ï¼Œäº¦æˆ–æ˜¯Kubernetesæ¶‰åŠçš„çŸ¥è¯†ç‚¹è¿‡äºåºæ‚ï¼Œå¯¼è‡´å†…å®¹çš„ç¿”å®å±‚åº¦ä»¥åŠå‰ç½®çŸ¥è¯†å¯¹äºå°ç™½çš„å‹å¥½ç¨‹åº¦ï¼Œå¹¶ä¸èƒ½ååˆ†åŒ¹é…<strong>æƒå¨</strong>äºŒå­—ã€‚<br>è™½ç„¶å¦‚æ­¤ï¼Œä½†æ˜¯æˆ‘è¿˜æ˜¯éå¸¸æ¨èé€‰æ‹©è¿™æœ¬ä¹¦ä½œä¸ºå…¥é—¨æ•™æã€‚<br>ä½†æ˜¯ï¼Œå¦‚æœæƒ³ä»…å‡­è¿™æœ¬ä¹¦å°±å…¥é—¨Kubernetesçš„è¯ï¼Œä½ è‡³å°‘è¿˜éœ€è¦ä»¥ä¸‹å‰ç½®çŸ¥è¯†ï¼š</p>
<ul>
<li>å¾®æœåŠ¡æ¶æ„ï¼ŒåŠå¾®æœåŠ¡èƒ½è§£å†³çš„é—®é¢˜</li>
<li>å¯¹åº”å¾®æœåŠ¡çš„è¯­è¨€ç”Ÿæ€ï¼Œå¦‚JAVAã€GOã€Pythonç­‰</li>
<li>åŸºç¡€çš„è½¯ä»¶é…ç½®ç®¡ç†ï¼Œå¦‚ä»£ç ç®¡ç†ã€CI/CDã€ç‰ˆæœ¬ç®¡ç†</li>
<li>åŸºç¡€çš„ç”Ÿäº§ç»´æŠ¤ç®¡ç†ï¼Œå¦‚å˜æ›´ç®¡ç†ã€æµç¨‹ç®¡ç†ã€ç›‘æ§ã€æˆæœ¬ç®¡ç†ç­‰</li>
<li>å…¶å®ƒè¿ç»´çŸ¥è¯†ï¼Œå¦‚åŸºç¡€ç½‘ç»œã€ä¸­é—´ä»¶ã€è¿ç»´å·¥å…·ç­‰</li>
</ul>
<center> çœ‹å±±æ˜¯å±±ï¼Œçœ‹æ°´æ˜¯æ°´ </center>
å¦‚æœæ²¡æœ‰è¶³å¤Ÿä¸Šè¿°å‰ç½®çŸ¥è¯†ï¼Œè¯»ç¬¬ä¸€éï¼Œå¯¹æ‰€æœ‰Kubernetesæ¶‰åŠåˆ°æ¦‚å¿µçš„ç†è§£ï¼Œåªä¼šåœç•™åœ¨è¡¨é¢ã€‚åŒæ—¶ï¼Œæœ‰å¿ƒçš„è¯»è€…è¿˜ä¼šé…åˆBç«™ä¸Šç›¸å…³çš„Xå¤©å…¥é—¨k8sçš„æ•™ç¨‹é£Ÿç”¨ï¼Œå­¦å®Œä¹‹åä¼šæœ‰ä¸€ç§ï¼ŒåŸæ¥Kuberneteså°±æ˜¯è¿™å•Šï¼Œå·²è¢«æˆ‘æ‹¿ä¸‹çš„é”™è§‰ã€‚
<center> çœ‹å±±ä¸æ˜¯å±±ï¼Œçœ‹æ°´ä¸æ˜¯æ°´ </center>
è¯»ç¬¬äºŒéï¼Œä½ ä¼šå‘ç°ï¼Œå·²ç»ä¸ä»…ä»…æ˜¯æ¸©æ•…è€ŒçŸ¥æ–°äº†ï¼ŒåŸæ¥ä½ å‘ç°äº†å¾ˆå¤šç¬¬ä¸€éæ²¡æœ‰å…³æ³¨åˆ°çš„çŸ¥è¯†ç‚¹ï¼Œå½“æ—¶æ ¹æœ¬æ²¡æœ‰æ·±å…¥çš„æ€è€ƒï¼Œäºæ˜¯ï¼Œç¬¬äºŒéè¯»å®Œä¹‹åï¼Œä½ ä¼šæœ‰ç§Kubernetesåˆ°åº•æ˜¯ä¸ªå•¥çš„å›°æƒ‘ï¼Œè¿™ç§å›°æƒ‘ç”šè‡³ä¼šè®©ä½ å¯¹è‡ªå·±äº§ç”Ÿæ€€ç–‘ã€‚
<center> çœ‹å±±è¿˜æ˜¯å±±ï¼Œçœ‹æ°´è¿˜æ˜¯æ°´ </center>
å¦‚æœï¼Œç¬¬äºŒéçš„å›°æƒ‘èƒ½æ¿€å‘ä½ çš„æ±‚çŸ¥æ¬²ï¼Œå¸¦ç€é—®é¢˜å»ç”±ç‚¹åˆ°é¢çš„å»å®Œæˆå„ä¸ªæ”¯çº¿ä»»åŠ¡ï¼Œé‚£ä¹ˆï¼Œå†å›æ¥è¯»ç¬¬ä¸‰éï¼Œä½ ä¼šå‘ç°:

<blockquote>
<p>Kubernetesæ˜¯ä»€ä¹ˆï¼Ÿå®ƒä¸æ˜¯ç®€å•çš„master/workerï¼Œcontroller/apiserver/etcd/schedulerç­‰ç­‰ä¸€äº›äºŒè¿›åˆ¶åŠé…ç½®æ–‡ä»¶ã€‚<br>ä¹Ÿä¸ä»…ä»…æ˜¯pod/deployment/service/daemonsetç­‰ç­‰ä¸€äº›éƒ¨ç½²å•å…ƒï¼Œä¹Ÿæ›´ä¸æ˜¯ä¸€ä¸ªç®€å•çš„PAASå¹³å°ã€‚<br>å®ƒæ˜¯ä¸€ä¸ªä½“ç³»ï¼ŒåŒ…å«äº†è½¯ä»¶å·¥ç¨‹ç®¡ç†ã€è½¯ä»¶å¼€å‘æ¨¡å‹å’Œç†å¿µã€é¡¹ç›®ç®¡ç†ã€æ¶æ„è®¾è®¡ã€è¿ç»´ç®¡ç†ã€äº¤ä»˜ç®¡ç†ç­‰ç­‰ï¼Œé™¤æ­¤ä¹‹å¤–æ‰æ˜¯ä¸€ä¸ªç±»PAASå¹³å°ã€‚</p>
</blockquote>
<p>åŸæ¥ï¼ŒKubernetesç¡®å®å°±åƒå®ƒçš„ç®€ä»‹é‚£æ ·ï¼Œç›´æ¥ï¼Œç¥å¥‡ï¼Œè€Œåˆä»¤äººå…´å¥‹ã€‚</p>
<p>å¯¹äºè¿ç»´è€Œè¨€ï¼Œè¿™æœ¬ä¹¦æ¶‰åŠåˆ°çš„å†…å®¹ï¼Œå…¥é—¨å·²ç»å¤Ÿäº†ï¼Œç„¶è€Œåœ¨å®é™…çš„ç»´æŠ¤è¿‡ç¨‹ä¸­åªèƒ½ç®—ä¸€ä¸ªæ“ä½œå·¥ï¼Œå¿…é¡»å‚ç…§æ‰‹å†Œæˆ–è€…ç”±é«˜çº§å·¥ç¨‹å¸ˆæŒ‡å¯¼æ‰èƒ½å¹²æ´»ã€‚<br>é™¤æ­¤ä¹‹å¤–ï¼Œå¯¹äºå¼€å‘è€Œè¨€ï¼Œè¿˜è¿œè¿œä¸å¤Ÿï¼Œç”šè‡³è¿å…¥é—¨éƒ½ç®—ä¸ä¸Šã€‚<br>æ­£æ˜¯ç”±äºä»¥ä¸Šè¿™äº›åŸå› ï¼Œå¾ˆå¤šå…¬å¸å¹¶æ²¡æœ‰è¶³å¤Ÿçš„æŠ€æœ¯å’Œäººå‘˜å‚¨å¤‡ï¼Œæ‰€ä»¥ï¼Œå¯¹ä¸ŠKubernetesæ˜¾å¾—å°¤ä¸ºè°¨æ…ï¼Œç”šè‡³æœ‰äº›è°ˆKè‰²å˜ã€‚</p>
<h3 id="2ï¼Œã€ŠKubernetesç½‘ç»œæƒå¨æŒ‡å—ï¼šåŸºç¡€ã€åŸç†ä¸å®è·µã€‹"><a href="#2ï¼Œã€ŠKubernetesç½‘ç»œæƒå¨æŒ‡å—ï¼šåŸºç¡€ã€åŸç†ä¸å®è·µã€‹" class="headerlink" title="2ï¼Œã€ŠKubernetesç½‘ç»œæƒå¨æŒ‡å—ï¼šåŸºç¡€ã€åŸç†ä¸å®è·µã€‹"></a>2ï¼Œã€ŠKubernetesç½‘ç»œæƒå¨æŒ‡å—ï¼šåŸºç¡€ã€åŸç†ä¸å®è·µã€‹</h3><p><img src="/2022/06/10/uncatalog/cl48eey5y0000owr728gk66p6/3.png" alt="3.png"><br>é˜…è¯»ä¸Šä¸€æœ¬ä¹¦çš„æ—¶å€™ï¼Œç½‘ç»œéƒ¨åˆ†çš„å†…å®¹å‡ ä¹æ˜¯ä¸€ç¬”å¸¦è¿‡ï¼Œå¯¹äºç½‘ç»œæ–¹é¢æ¯”è¾ƒè–„å¼±çš„å¼€å‘è€…æ¥è¯´ï¼Œç†è§£èµ·æ¥æ¯”è¾ƒå›°éš¾ï¼Œæ‰€ä»¥å°±ç”±ç‚¹åˆ°é¢çš„å±•å¼€ï¼Œæ‰¾åˆ°äº†è¿™æœ¬ä¹¦ï¼Œæ¶è¡¥ç½‘ç»œç›¸å…³çš„å†…å®¹ã€‚<br>è¿™æœ¬ä¹¦ä¹Ÿå¸¦æœ‰<strong>æƒå¨</strong>äºŒå­—ï¼Œå¦‚æœè¯´ä¸Šä¸€æœ¬ä¹¦<strong>æƒå¨</strong>æˆè‰²ä¸è¶³çš„è¯ï¼Œé‚£è¿™æœ¬ä¹¦å°±å®Œå…¨æ˜¯æœ‰è¾±<strong>æƒå¨</strong>äºŒå­—äº†ã€‚<br>äº‘è®¡ç®—çš„ä¸–ç•Œé‡Œï¼Œè®¡ç®—æœ€åŸºç¡€ï¼Œå­˜å‚¨æœ€é‡è¦ï¼Œç½‘ç»œæœ€å¤æ‚ã€‚å¯¹äºè¿™ä¹ˆå¤æ‚çš„ä¸€ä¸ªé¢†åŸŸï¼Œè¾“å‡ºä¸€æœ¬é”™è¯¯ç™¾å‡ºã€å¤§é¢ç§¯æŠ„è¢­åšå®¢çš„ä¹¦ç±ï¼Œå®åœ¨æ˜¯å¯¹è¯»è€…çš„ä¸è´Ÿè´£ã€‚<br>å¦‚æœä½ æœ‰Kubernetesç½‘ç»œæ–¹é¢çš„ç–‘æƒ‘ï¼Œå»ºè®®ä½ æœ‰ä¸€å®šçš„ç”„åˆ«èƒ½åŠ›ä¹‹åï¼Œå†æ¥è¯»è¿™æœ¬ä¹¦ï¼Œåªæœ‰è¿™æ ·ï¼Œæ‰èƒ½å»ç³Ÿå–ç²¾ã€‚</p>
<h3 id="3ï¼Œã€Šæ·±å…¥å‰–æKubernetesã€‹"><a href="#3ï¼Œã€Šæ·±å…¥å‰–æKubernetesã€‹" class="headerlink" title="3ï¼Œã€Šæ·±å…¥å‰–æKubernetesã€‹"></a>3ï¼Œã€Šæ·±å…¥å‰–æKubernetesã€‹</h3><p><img src="/2022/06/10/uncatalog/cl48eey5y0000owr728gk66p6/5.jpg" alt="5.jpg"><br>è¿™æœ¬ä¹¦æˆ‘æ²¡æœ‰è¯»è¿‡ï¼Œä½†æ˜¯è¿™æœ¬ä¹¦çš„å†…å®¹å–è‡ªåŒä¸€ä½œè€…çš„æå®¢æ—¶é—´çš„ã€Šæ·±å…¥å‰–æKubernetesã€‹è¯¾ç¨‹ï¼Œè¿™ä¸ªè¯¾ç¨‹æˆ‘æ˜¯è¯»è¿‡çš„ï¼Œä½œè€…æ˜¯å¼ ç£Šï¼Œ2021å¹´CNCFåŸºé‡‘ä¼šTOCåå•ä¸­å›½å†…å”¯ä¸€çš„å…¥é€‰è€…ã€‚CNCFåŸºé‡‘ä¼šTOCåå•ï¼ŒåŸºæœ¬ä¸Šå°±å·²ç»å†³å®šäº†è¿™æœ¬ä¹¦çš„å«é‡‘é‡ï¼Œ<br>å”¯ä¸€çš„ä¸è¶³ï¼Œå¯èƒ½æ˜¯é‡ç†è®ºè€Œç¼ºå°‘å®è·µï¼Œå¯¹äºè¿˜æ²¡æœ‰å…¥é—¨çš„è¯»è€…æ¥è¯´ï¼Œéå¸¸çš„ä¸å‹å¥½ï¼Œæ›´é€‚åˆæœ‰ä¸€å®šç†è®ºå’Œå¼€å‘åŸºç¡€çš„è¯»è€…ã€‚</p>
<h3 id="4ï¼Œã€ŠKubernetesç”Ÿäº§åŒ–å®è·µä¹‹è·¯ã€‹"><a href="#4ï¼Œã€ŠKubernetesç”Ÿäº§åŒ–å®è·µä¹‹è·¯ã€‹" class="headerlink" title="4ï¼Œã€ŠKubernetesç”Ÿäº§åŒ–å®è·µä¹‹è·¯ã€‹"></a>4ï¼Œã€ŠKubernetesç”Ÿäº§åŒ–å®è·µä¹‹è·¯ã€‹</h3><p><img src="/2022/06/10/uncatalog/cl48eey5y0000owr728gk66p6/6.jpg" alt="6.jpeg"></p>
<p>æœªå®Œï¼Œå¾…ç»­â€¦</p>
]]></content>
      <tags>
        <tag>è¯»ä¹¦ç¬”è®°</tag>
        <tag>äº‘åŸç”ŸåŸºç¡€ç³»åˆ—</tag>
        <tag>Kubernetes</tag>
      </tags>
  </entry>
  <entry>
    <title>Kubernetesç½‘ç»œç³»åˆ—ä¹‹(äºŒ)ç½‘ç»œåŸºæœ¬æ¦‚å¿µ</title>
    <url>/2022/06/11/uncatalog/cl49mkqxy0002lwr76770ae47/</url>
    <content><![CDATA[<hr>
<span id="more"></span>



<hr>
<h3 id="ç”µè„‘ä¸»æœº-Host"><a href="#ç”µè„‘ä¸»æœº-Host" class="headerlink" title="ç”µè„‘ä¸»æœº(Host)"></a>ç”µè„‘ä¸»æœº(Host)</h3><p>ä¸€å°ç”µè„‘å¾ˆç®€å•ï¼Œä¸€ä¸ªå£³å­é‡Œé¢å †äº†å¾ˆå¤šç©æ„ã€‚ä½†æ˜¯ä½ ä¹°äº†ç”µè„‘ï¼Œå¦‚æœæ²¡æœ‰ç½‘ç»œï¼Œä½ è§‰å¾—è¿™ä¸ªç”µè„‘èƒ½åšä»€ä¹ˆï¼Ÿææ€•åªèƒ½æ‹¿Uç›˜æ‹·ç‚¹ä¸œè¥¿ã€‚å¦‚æœåƒå®éªŒå®¤è¿™ç§ç”µè„‘ï¼Œè¿USBå£éƒ½æ²¡(feng)æœ‰(diao)çš„ï¼Œä½ åªèƒ½å‘µå‘µã€‚æ‰€ä»¥ä½ ä¹°ç”µè„‘è‚¯å®šè¿˜éœ€è¦å¸¦ä¸Šå…¶ä»–çš„ä¸œè¥¿ï¼Œç½‘å¡ï¼Œç½‘çº¿ã€‚</p>
<ol>
<li>ä¸»æœºï¼Œä¹Ÿå°±æ˜¯Host</li>
</ol>
<p><img src="/2022/06/11/uncatalog/cl49mkqxy0002lwr76770ae47/1.jpg" alt="1.jpg"></p>
<p>2.ç½‘å¡ï¼ˆä¸€èˆ¬ä¸»æ¿è‡ªå¸¦äº†ï¼‰</p>
<p><img src="/2022/06/11/uncatalog/cl49mkqxy0002lwr76770ae47/2.jpg" alt="2.jpg"></p>
<p>3.ç½‘çº¿ ï¼ˆåˆ«è·Ÿæˆ‘è¯´ä½ ç”¨wifiçš„ï¼Œææ­»ä½ ï¼Œä¸å‡†æŠ¬æ ï¼‰</p>
<p><img src="/2022/06/11/uncatalog/cl49mkqxy0002lwr76770ae47/3.jpg" alt="3.jpg"></p>
<p>å¥½äº†ï¼Œä¸‰å¤§ç¥å™¨åŸºæœ¬é½äº†ï¼Œæ¥ä¸Šç½‘ç»œï¼Œè¿™æ‰æ˜¯ç”µè„‘ã€‚</p>
<h3 id="æ¨¡å‹"><a href="#æ¨¡å‹" class="headerlink" title="æ¨¡å‹"></a>æ¨¡å‹</h3><p>æ¥ä¸Šäº†ç½‘ç»œçš„ç”µè„‘ï¼Œå°±å¯ä»¥ä»ç½‘ç»œä¸Šæ”¶å‘æŠ¥æ–‡äº†ï¼Œå¯ä»¥ä¸ç½‘ç»œä¸­çš„å…¶ä»–ç”µè„‘ä¸»æœºï¼ˆHostï¼‰é€šä¿¡ã€‚</p>
<p>å®ƒå°±åƒä¸‹é¢è¿™ä¸ªæ ·å­ï¼šï¼ˆè¿™ä¸ªæ¨¡å‹å›¾æ¯”è¾ƒé‡è¦ï¼Œåé¢æˆ‘éƒ½ä¼šæŒ‰ç…§è¿™ä¸ªæ¨¡å‹æ‰©å±•è®²è§£ï¼‰</p>
<p><img src="/2022/06/11/uncatalog/cl49mkqxy0002lwr76770ae47/4.png" alt="4.png"><br>æ„æ€æ˜¯ï¼šä¸»æœºHostä¸Šé¢è¿è¡Œäº†ç¨‹åºï¼Œè¿™ä¸ªç¨‹åºä»ç½‘å¡æ¥æ”¶/å‘é€æŠ¥æ–‡ã€‚ä½ å°±æƒ³è±¡ä¸€ä¸ªäººåœ¨ä¸€ä¸ªå››å››æ–¹æ–¹çš„ç©ºæˆ¿å­é‡Œé¢ï¼Œå…¶ä¸­çš„ä¸€é¢å¢™ä¸Šæœ‰ä¸ªé—¨ï¼Œé—¨å£é‚£ä¸ªå¿«é€’æ”¶å‘å‘˜ä¼šæŠŠåŒ…è£¹ä»å¤–é¢è¿è¿›æ¥ã€‚</p>
<p>ï¼ˆæˆ‘æ˜¯è¿™ä¹ˆæƒ³çš„ -_-#ï¼Œæ±‚å‹¿é„™è§†ï¼‰å¤§æ¦‚æ˜¯è¿™ä¸ªæ ·å­ï¼š</p>
<p><img src="/2022/06/11/uncatalog/cl49mkqxy0002lwr76770ae47/5.png" alt="5.png"></p>
<p>ä¸­é—´é‚£ä¸ªäººå°±æ˜¯ä½ äº†ï¼Œä½ åœ¨æ·˜Xä¹°äº†ä¸œè¥¿ï¼Œåœ¨å®¶é‡Œç­‰å¿«é€’ï¼Œéªšå¹´ã€‚</p>
<h3 id="ç”»ç½‘ç»œå›¾"><a href="#ç”»ç½‘ç»œå›¾" class="headerlink" title="ç”»ç½‘ç»œå›¾"></a>ç”»ç½‘ç»œå›¾</h3><p>å¥½äº†ï¼Œåœ¨æœ‰ä»¥ä¸Šçš„æ¨¡å‹åï¼Œé‚£ä¹ˆä¸¤å°ä¸»æœºé€šä¿¡ï¼Œå°±åº”è¯¥åƒä¸‹é¢è¿™æ ·äº†ï¼š</p>
<p><img src="/2022/06/11/uncatalog/cl49mkqxy0002lwr76770ae47/6.png" alt="6.png"></p>
<p>æ³¨æ„è¿™æ ¹ç½‘çº¿ä¹Ÿæ˜¯éå¸¸é‡è¦çš„ï¼Œè¿™ä¸ªå°±æ˜¯å®¿èˆä¸¤ä¸ªäººç½‘çº¿ç›´è¿æ‰“é­”å…½å•Šã€‚</p>
<p>ç„¶åæœ‰ä¸€å¤©ï¼Œä½ çªç„¶å‘ç°ï¼Œå“‡é ï¼Œæ‰€æœ‰çš„äººéƒ½æœ‰ç”µè„‘äº†ï¼Œå¤§å®¶éƒ½æƒ³äº’ç›¸è¿èµ·æ¥ï¼Œçœ‹èµ·æ¥åƒè¿™æ ·ï¼š<br><img src="/2022/06/11/uncatalog/cl49mkqxy0002lwr76770ae47/7.png" alt="7.png"></p>
<p>æ˜¯çš„ï¼Œçœ‹èµ·æ¥åƒè¿™æ ·ï¼Œå®é™…æ˜¯åšä¸åˆ°çš„ï¼Œå› ä¸ºæˆ‘ä»¬æ‰¾ä¸åˆ°é•¿è¿™ä¹ˆå¥‡æ€ªçš„ç½‘çº¿å•Šï¼</p>
<p>æ€ä¹ˆåŠï¼Ÿæ€ä¹ˆæŠŠå¤§å®¶çš„ç½‘çº¿éƒ½æ¥ä¸€èµ·å‘¢ï¼Ÿ æ˜¯å‰ªå¼€ï¼Œä¸€è‚¡ä¸€è‚¡çš„çº¿æ‹†å¼€æ‹§ä¸€èµ·ä¹ˆï¼ˆè·Ÿç”µçº¿ä¸€æ ·ï¼‰</p>
<p><img src="/2022/06/11/uncatalog/cl49mkqxy0002lwr76770ae47/8.jpg" alt="8.jpg"></p>
<p>è¿™ä¸ªè™½ç„¶å¯è¡Œï¼Œä½†æ˜¯æ¯”è¾ƒéº»çƒ¦ï¼Œç®€å•çš„æ–¹å¼å°±æ˜¯ä¹°ä¸ªé›†çº¿å™¨Hubï¼Œå¤§å®¶çš„ç½‘çº¿éƒ½æ’åœ¨åŒä¸€ä¸ªHubä¸Šå°±è¡Œäº†ã€‚ä¹Ÿå¯ä»¥ä¹°ä¸ªè·¯ç”±å™¨ï¼ˆç›¸å½“äºé«˜çº§Hubï¼‰ã€‚ä¸è¿‡Hubæ¯”è¾ƒä¾¿å®œå•¦ï¼Œç›¸å½“äºæ¥çº¿æ¿ï¼ŒæŠ€æœ¯å«é‡ä¸é«˜ã€‚</p>
<p><img src="/2022/06/11/uncatalog/cl49mkqxy0002lwr76770ae47/9.jpg" alt="9.jpg"></p>
<p>æ’ä¸Šï¼Œæå®šæ‰€æœ‰çš„ä¸»æœºäº’è”ã€‚æ³¨æ„è¿™é‡Œçš„æ‰€æœ‰ï¼Œæ˜¯æŒ‡ä½ ä»¬å®¿èˆä»¥åŠéš”å£å®¿èˆï¼Œä¸æ˜¯æ•´ä¸ªå­¦æ ¡ã€‚<br><img src="/2022/06/11/uncatalog/cl49mkqxy0002lwr76770ae47/10.png" alt="10.png"></p>
<h3 id="æ–°çš„æŒ‘æˆ˜"><a href="#æ–°çš„æŒ‘æˆ˜" class="headerlink" title="æ–°çš„æŒ‘æˆ˜"></a>æ–°çš„æŒ‘æˆ˜</h3><p>å½“å¾ˆå¤šç”µè„‘ä¸»æœºHostè¿åœ¨ä¸€èµ·çš„æ—¶å€™ï¼Œæ–°çš„é—®é¢˜å‡ºæ¥äº†ã€‚ä¸»æœºHost1ï¼Œæƒ³è¦ä¸ä¸»æœºHost3é€šä¿¡çš„æ—¶å€™ï¼Œæ€ä¹ˆä¿è¯æŠ¥æ–‡ï¼ˆåŒ…è£¹ï¼‰æ˜¯ç»™Host3ï¼Œè€Œä¸æ˜¯ç»™Host2çš„å‘¢ï¼Ÿå› ä¸ºå¤§å®¶éƒ½è¿ï¼ˆä½ï¼‰åœ¨ä¸€èµ·ã€‚</p>
<p>è¿™ä¸ªå¾ˆç®€å•å˜›ï¼Œç»™æ¯å°ç”µè„‘ä¸»æœºè®¾ç½®ä¸€ä¸ªåœ°å€ï¼Œç±»ä¼¼é—¨ç‰Œå·ï¼Œå¿«é€’åŒ…è£¹æŒ‰ç…§åœ°å€é€è´§å°±åˆ°äº†æ”¶è´§æ–¹äº†ã€‚è¿™ä¸ªä¸»æœºHoståœ°å€ï¼Œè¯´äººè¯å°±æ˜¯å«åšï¼šIPåœ°å€ã€‚ å¿«é€’å‘˜é€åŒ…è£¹æ—¶æŸ¥çœ‹é—¨ç‰Œå·ï¼Œå°±å¥½æ¯”è·¯ç”±ã€‚</p>
<p>è¯è¯´è¿™ä¸ªä½åœ¨ä½ å®¶é—¨å£çš„è¿™ä¸ªå¿«é€’æ”¶å‘å‘˜ä¹Ÿæœ‰ä¸ªåå­—ï¼Œå«åšLinuxç½‘ç»œåè®®æ ˆã€‚</p>
<p>ç”±äºè¿åœ¨ä¸€èµ·çš„ç”µè„‘è¶Šæ¥è¶Šå¤šï¼Œæ•´ä¸ªå­¦æ ¡çš„æˆç™¾ä¸Šåƒå°çš„ç”µè„‘ï¼Œé€å¿«é€’æ—¶æŸ¥æ‰¾åœ°å€è¶Šæ¥è¶Šå›°éš¾ï¼Œäºæ˜¯å°±æœ‰äº†è·¯ç”±å’‹èµ°çš„é—®é¢˜ã€‚è¿™ä¸ªæˆ‘ä»¬ä¸‹èŠ‚å†è®² :-)</p>
]]></content>
      <tags>
        <tag>äº‘åŸç”ŸåŸºç¡€ç³»åˆ—</tag>
        <tag>Kubernetesç½‘ç»œ</tag>
      </tags>
  </entry>
  <entry>
    <title>Kubernetesç½‘ç»œç³»åˆ—ä¹‹(ä¸‰)IPå’Œæ©ç </title>
    <url>/2022/06/11/uncatalog/cl49muw310005lwr7dukkfz6m/</url>
    <content><![CDATA[<hr>
<span id="more"></span>



<hr>
<h3 id="ä¸»æœºçš„é—¨ç‰Œå·ï¼ˆIPåœ°å€ï¼‰"><a href="#ä¸»æœºçš„é—¨ç‰Œå·ï¼ˆIPåœ°å€ï¼‰" class="headerlink" title="ä¸»æœºçš„é—¨ç‰Œå·ï¼ˆIPåœ°å€ï¼‰"></a>ä¸»æœºçš„é—¨ç‰Œå·ï¼ˆIPåœ°å€ï¼‰</h3><p>å½“æ¥å…¥åˆ°ç½‘ç»œé‡Œé¢çš„ä¸»æœºæ•°é‡è¶Šæ¥è¶Šå¤šï¼Œæ¯å°ä¸»æœºéƒ½éœ€è¦çš„é—¨ç‰Œå·ï¼ˆIPåœ°å€ï¼‰æ•°é‡å°±è¶Šæ¥è¶Šå¤šï¼Œè¿™å°±ä¼šæ¶‰åŠåˆ°IPåœ°å€çš„ç®¡ç†é—®é¢˜ã€‚ä¸€å¼€å§‹å¤§å®¶è§‰å¾—é—¨ç‰Œå·ä¸ç”¨å¤ªå¤šï¼Œ32ä½å°±å·®ä¸å¤šå¤Ÿç”¨äº†ï¼ˆäº‹å®è¯æ˜å®Œå…¨ä¸å¤Ÿï¼‰ã€‚</p>
<p>æ‰€ä»¥IPåœ°å€å¤§æ¦‚é•¿è¿™æ ·ï¼š</p>
<p>192.168.1.1 ï¼ˆå¯¹æˆ˜å±€åŸŸç½‘1-01å·ä¸»æœºï¼‰ï¼Œ192.168.1.2 ï¼ˆå¯¹æˆ˜å±€åŸŸç½‘1-02å·ä¸»æœºï¼‰ã€‚</p>
<p>è¿™ç§å°çš„ç½‘ç»œå‘¢ï¼Œä¸ç”¨æå¤ªå¤§ï¼Œå¤§å®¶çº¦å®šå‰é¢ä¸‰ä¸ªåœ°å€éƒ½ä¸€æ ·ï¼Œä»…æœ€åä¸€ä¸ªæ•°å­—ä¸ä¸€æ ·å°±è¡Œäº†ã€‚å¯ä»¥çœ‹å‡ºè¿™ä¸ªå±€åŸŸç½‘æœ€å¤šå¯ä»¥æ¥å…¥255å¤ªä¸»æœºï¼Œå†å¤šå°±æ²¡æœ‰IPï¼ˆé—¨ç‰Œï¼‰åœ°å€åˆ†é…äº†ã€‚å³å‰ä¸‰ä½åœ°å€ä¸å˜æ—¶ï¼ˆ1å¹¢-1æ¥¼-01ç­çº§ï¼Œç±»ä¼¼è¿™ä¸ªä¸èƒ½å˜ï¼‰ï¼Œæœ€å¤šå…è®¸255å°ä¸»æœºè¿æ¥ã€‚</p>
<p>å¦‚æœå…¶ä»–ç”µè„‘è¿˜æƒ³æ¥å…¥ç½‘ç»œå‘¢ï¼Ÿé‚£ä¹ˆä½¿ç”¨ï¼š</p>
<p>192.168.2.1 ï¼ˆå¯¹æˆ˜å±€åŸŸç½‘2-01å·ä¸»æœºï¼‰ï¼Œ192.168.2.2 ï¼ˆå¯¹æˆ˜å±€åŸŸç½‘2-02å·ä¸»æœºï¼‰ã€‚</p>
<p>å¯ä»¥çœ‹å‡ºæ¥ 1å¹¢-1æ¥¼-02ç­çº§ ä¹Ÿæœ‰255å°ä¸»æœºå¯ä»¥è¿åœ¨ä¸€èµ·ã€‚</p>
<h3 id="æ©ç Mask"><a href="#æ©ç Mask" class="headerlink" title="æ©ç Mask"></a>æ©ç Mask</h3><p>ä¸ºäº†æ›´å¥½çš„è¡¨è¾¾ä¸€ä¸ªå±€åŸŸç½‘æœ‰å¤šå°‘å°æœºå™¨ï¼Œ æˆ‘ä»¬ä¸¾ä¸ªä¾‹å­ï¼šç”¨å¸®æ´¾å¤§å°æ¥æè¿°å¸®æ´¾ä¸­æœ‰å¤šå°‘ä¸ªæˆå‘˜ã€‚</p>
<p>ç°åœ¨æœ‰ä¸ªå¸®æ´¾ï¼šåä¸œå¸®.æ­å·åˆ†èˆµ.æ»¨æ±Ÿå¤§é˜Ÿ.å”ç–™ç˜©å¼„ ï¼Œ æ©ï¼Œä¸€çœ‹è¿™ä¸ªåå­—å°±çŸ¥é“å¾ˆå°çš„å–½å–½å›¢ä½“ï¼Œæˆå‘˜æ²¡å‡ ä¸ªã€‚</p>
<p>å†çœ‹ä¸Šä¸€çº§å¸®æ´¾ï¼šåå—å¸®.æ·±åœ³åˆ†èˆµ ã€‚ å“‡ï¼Œæ„Ÿè§‰æ˜¯ä¸ªå¤§å¸®æ´¾ï¼Œæˆå‘˜å¾ˆå¤šçš„æ ·å­ã€‚</p>
<p>æ‰€ä»¥ä¸€ä¸ªå›¢ä½“çš„å¤§å°ï¼Œç›´æ¥çœ‹åå·çš„é•¿çŸ­å°±çŸ¥é“ã€‚åå·è¶ŠçŸ­ï¼Œå¸®æ´¾è¶Šå¤§ã€‚</p>
<p>è¿™ä¸ªåå·å°±æ˜¯ç›¸å½“äºæ©ç çš„ä½œç”¨äº†ï¼Œæ©ç è¶Šå°ï¼Œè¿™ä¸ªå±€åŸŸç½‘å°±è¶Šå¤§ã€‚</p>
<p>ä¸‹å›¾å¯ä»¥çœ‹å‡ºIPåœ°å€çš„åˆ†é…ï¼Œæ ¹æ®å‰é¢å¤šå°‘ä½åœ°å€ä¸åŠ¨ï¼Œå¯ä»¥å¤§æ¦‚æœ‰è¿™ç§åˆ†ç±»æ–¹æ³•ï¼š</p>
<p><img src="/2022/06/11/uncatalog/cl49muw310005lwr7dukkfz6m/1.jpg" alt="1.jpg"></p>
<p>Aç±»åœ°å€ï¼ŒBç±»åœ°å€ï¼ŒCç±»åœ°å€ã€‚å…¶å®å°±æ˜¯å‰é¢æœ‰å‡ ä½åœ°å€ä¸åŠ¨çš„æ„æ€ã€‚â€œå‰é¢å‡ ä½åœ°å€ä¸åŠ¨â€è¿™ä¸ªåå­—å¤ªé•¿äº†ä¸å¥½è®°ï¼Œå–ä¸ªå¥½å¬çš„åå§ï¼Œæ©ç ï¼ˆMaskï¼‰ï¼Œç«‹é©¬é«˜å¤§ä¸Šäº†ã€‚</p>
<p>å†çœ‹ä¸Šå›¾ä¸­çš„Cç±»åœ°å€ï¼Œæ©ç æ˜¯å¤šå°‘å•Šï¼Ÿæ•°ä¸€æ•°æ˜¯3*8=24ä½ã€‚æ‰€ä»¥ 255.255.255.0 ä¹Ÿå°±æ˜¯ 3ä¸ª8bitæ˜¯å…¨1=24ä½çš„æ©ç ã€‚æ©ç ä½¿ç”¨ /æ•°å­— è¡¨ç¤ºï¼Œä¾‹å¦‚ /24ã€‚</p>
<p>Cç±»åœ°å€çš„å¸®æ´¾åå·ç®—æ˜¯æ¯”è¾ƒé•¿çš„ï¼Œæ˜¯24ä½çš„åå·ï¼Œå†…éƒ¨æˆå‘˜æœ‰é™ï¼Œæ‰255äººã€‚é‚£è‚¯å®šæ˜¯æ²¡æœ‰äººå®¶16ä¸ºçš„åå·ï¼ˆæ©ç ï¼‰çš„åŠ¿åŠ›èŒƒå›´å¤§å•¦ã€‚</p>
<h3 id="ç½‘ç»œNetwork"><a href="#ç½‘ç»œNetwork" class="headerlink" title="ç½‘ç»œNetwork"></a>ç½‘ç»œNetwork</h3><p>ç»è¿‡ä¸Šé¢çš„è§£é‡Šï¼Œé‚£ä¹ˆ01ç­çº§çš„ç½‘ç»œå°±æ˜¯ï¼š192.168.1.0/24ã€‚ è€Œ02ç­çº§çš„ç½‘ç»œå°±æ˜¯ï¼š192.168.2.0/24ã€‚æ˜æ˜¾çš„æ˜¯ä¸¤ä¸ªå¸®æ´¾ã€‚</p>
<p>å…¶å®ï¼šIPåœ°å€ â€œä¸â€ä¸Š æ©ç ï¼Œå°±æ˜¯è‡ªå·±æ‰€åœ¨çš„ç½‘ç»œäº†ã€‚ä¾‹å¦‚ï¼š</p>
<p>192.168.1.2 &amp; 255.255.255.0 = 192.168.1.0/24 æ„æ€æ˜¯ä¿ç•™å‰24ä½ï¼Œåé¢çš„éƒ½æŠ¹é›¶ã€‚</p>
<p>è€Œæ©ç å¤§å®¶ä¸€èˆ¬éƒ½è®¾ç½®ä¸º8ï¼Œ16ï¼Œ24ï¼Œå› ä¸ºæ¯”è¾ƒå¥½è®°ï¼Œä½ è¦æ˜¯è®¾ç½®ä¸€ä¸ªæ©ç 17ï¼Œåé¢æŠ¹é›¶ï¼Œä½ ä¸€ä¸‹å­éƒ½ç®—ä¸å‡ºæ¥æ•°å­—æ˜¯å¤šå°‘ã€‚</p>
<p>è¿˜æœ‰ä¸€ä¸ªé‡è¦çš„æç¤ºï¼šä¸€æ—¦ä½ çŸ¥é“äº†æ©ç çš„å¤§å°ï¼Œä½ è‡ªå·±çš„å±€åŸŸç½‘çš„å¤§å°å°±çŸ¥é“äº†ã€‚ä¾‹å¦‚æ©ç 24ï¼Œé‚£ä¹ˆä½ æ‰€åœ¨çš„ç½‘ç»œæœ€å¤šèƒ½è¿æ¥255å°ä¸»æœºã€‚å†å¤šä¸»æœºåªèƒ½æ¥åˆ°å…¶ä»–ç­çº§çš„ç½‘ç»œé‡Œã€‚</p>
<h3 id="ç½‘ç»œäº’è¿"><a href="#ç½‘ç»œäº’è¿" class="headerlink" title="ç½‘ç»œäº’è¿"></a>ç½‘ç»œäº’è¿</h3><p>ç»ˆäºæœ‰ä¸€å¤©ï¼Œä¸¤å¤§ç­çº§ä¸ç”˜äºå†…æˆ˜ï¼Œå¸Œæœ›ç­çº§ä¹‹é—´äº’ç›¸åˆ‡ç£‹ä¸‹ï¼é‚£å¾—æƒ³åŠæ³•æŠŠä¸¤ä¸ªç½‘ç»œç»™è¿èµ·æ¥å•Šã€‚äºæ˜¯æ‰¾ä¸€å°åœŸè±ªä¸»æœºHostï¼Œè¿™ä¸ªHostæœ‰ä¸¤å—ç½‘å¡ï¼Œä¸€å—é€šè¿‡ç½‘çº¿æ¥å…¥ç½‘ç»œ01ï¼Œå¦ä¸€å—é€šè¿‡ç½‘çº¿æ¥å…¥ç½‘ç»œ02ï¼Œè¿™æ ·è¿™å°ä¸»æœºå°±æœ‰ä¸¤ä¸ªIPåœ°å€å•¦ï¼Œä¸€ä¸ªæ˜¯192.168.1.1ï¼Œè¿˜æœ‰ä¸€ä¸ªæ˜¯192.168.2.1ï¼Œæå®šã€‚</p>
<p><img src="/2022/06/11/uncatalog/cl49muw310005lwr7dukkfz6m/2.png" alt="2.png"></p>
<p>äºæ˜¯è¿™å°ç‰¹æ®Šçš„ä¸»æœºHost-Sï¼Œå®ƒä¸€èˆ¬ä¸èƒ½åœæœºï¼Œä¸ç„¶éš”å£å¯å®¤å°±æœ‰äººæ€’å¼ï¼Œæ¸æ¸çš„è¿™å°æœºå­å°±å½“åšä¸“ç”¨æœºä¸€ç›´å¼€ç€äº†ã€‚ è‡³äºè¿™å°æœºå™¨çš„é…ç½®å˜›ï¼Œç½‘å¡ç‰›é€¼ä¸€ç‚¹å–½ï¼Œæ“ä½œç³»ç»Ÿä¹ˆç®€å•ç‚¹ï¼Œèƒ½æ”¶å‘æŠ¥æ–‡å•¥çš„å°±è¡Œäº†ï¼Œæç€æç€è¿™å°ä¸»æœºå°±æœ‰äº†è‡ªå·±ç‰¹åˆ«çš„åå­—ï¼šè·¯ç”±å™¨ã€‚</p>
<p>è·¯ç”±å™¨ä¹Ÿæ˜¯ä¸€å°ç”µè„‘ï¼ŒåŠŸèƒ½æ¯”è¾ƒå•ä¸€çš„ç”µè„‘ï¼ˆä¸è¿‡ç°åœ¨çš„è·¯ç”±å™¨åŠŸèƒ½ä¹Ÿè¶Šæ¥è¶Šç‰›é€¼äº†ï¼Œæ‘†æ˜å°±æ˜¯ä¸€å°æ¯”è¾ƒç‰›é€¼çš„ç”µè„‘äº†ï¼‰ã€‚</p>
<p>è·¯ç”±å™¨è´Ÿè´£è¿æ¥ä¸¤ä¸ªä¸åŒçš„ç½‘ç»œã€‚</p>
<p><img src="/2022/06/11/uncatalog/cl49muw310005lwr7dukkfz6m/3.jpg" alt="3.jpg"></p>
<h3 id="ç½‘å…³"><a href="#ç½‘å…³" class="headerlink" title="ç½‘å…³"></a>ç½‘å…³</h3><p>ç°åœ¨æ‰€æœ‰01ç½‘ç»œçš„ä¸»æœºHoståªè¦å‘é€æŠ¥æ–‡åˆ°02ç½‘ç»œçš„ä¸»æœºHostä¸Šå»ï¼ŒæŠ¥æ–‡å°±å¿…é¡»é€šè¿‡è¿™ä¸ªè·¯ç”±å™¨ä¸»æœºï¼Œæˆ‘ä»¬å°±æŠŠè¿™ä¸ªè·¯ç”±å™¨çš„åœ°å€ï¼Œå«åšç½‘å…³ã€‚æ‰€æœ‰01ç½‘ç»œé‡Œé¢çš„ä¸»æœºï¼Œéƒ½æŠŠç½‘å…³åœ°å€è®¾ç½®ä¸ºè¿™å°è·¯ç”±å™¨åœ°å€ã€‚</p>
<p>æ‰€ä»¥ç½‘å…³æœ‰ä¸¤å±‚å«ä¹‰ï¼š</p>
<p>1.å¯¹å½“å‰ä¸»æœºæ¥è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„åœ°å€ï¼Œç‰¹å®šçš„æŠ¥æ–‡éƒ½å‘åˆ°è¿™ä¸ªåœ°å€ï¼Œç”±å®ƒå¸®å¿™ä¸­è½¬ä¸€ä¸‹ã€‚</p>
<p>2.æœ¬èº«æ¥è¯´ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªç‰¹æ®Šçš„è®¾å¤‡ï¼Œä¾‹å¦‚è·¯ç”±å™¨ã€‚</p>
<p>ç½‘ç»œæ¨¡å‹åŸºæœ¬å‡ºæ¥äº†ï¼Œä¸‹ä¸€èŠ‚ç»§ç»­è®²è·¯ç”± :-)</p>
]]></content>
      <tags>
        <tag>äº‘åŸç”ŸåŸºç¡€ç³»åˆ—</tag>
        <tag>Kubernetesç½‘ç»œ</tag>
      </tags>
  </entry>
  <entry>
    <title>Kubernetesç½‘ç»œç³»åˆ—ä¹‹(å››)routerè·¯å’‹èµ°å•Š</title>
    <url>/2022/06/11/uncatalog/cl49n9zab0008lwr79y835duy/</url>
    <content><![CDATA[<hr>
<span id="more"></span>



<hr>
<blockquote>
<p>å¥½äº†ï¼Œåˆ°è¿™é‡Œè‡³å°‘ä½ åº”è¯¥èƒ½çœ‹æ‡‚è·¯ç”±è¡¨ä¿¡æ¯äº†ã€‚ç»™ä½ ä¸€ä¸ªç›®çš„IPï¼Œä½ ä¹Ÿåº”è¯¥çŸ¥é“å®ƒä¼šä½¿ç”¨å“ªä¸€æ¡è·¯ç”±äº†ã€‚ è·¯æ€ä¹ˆèµ°å°±çœ‹éªšå¹´ä½ äº†~</p>
</blockquote>
<h3 id="è·¯ç”±"><a href="#è·¯ç”±" class="headerlink" title="è·¯ç”±"></a>è·¯ç”±</h3><p>å…¶å®å…³äºç½‘ç»œå¤§å®¶é‡åˆ°æœ€å¤šçš„é—®é¢˜å°±æ˜¯ï¼šå§ æ§½ï¼Œä¸ºä»€ä¹ˆä¸é€šå•Šï¼</p>
<p>æ¯”è¿™ä¸ªè¿æ°”å¥½ä¸€ç‚¹çš„ï¼šå§ æ§½ï¼Œè¿‡å»é€šï¼Œå›æ¥ä¸é€šå•Šï¼</p>
<p>ä¸æ…Œï¼Œçœ‹å®Œè¿™ä¸€ç« èŠ‚ï¼Œè¿™ç§é—®é¢˜ä¸‹æ¬¡ç¢°åˆ°åŸºæœ¬è‡ªå·±å°±èƒ½æå®šã€‚é¦–å…ˆæˆ‘ä»¬å¸Œæœ›ä¸¤å°æœºå­èƒ½é€šï¼Œé‚£ä½ å¾—çŸ¥é“é€šæ˜¯æ€ä¹ˆé€šçš„ï¼Œä¹Ÿå°±æ˜¯é€šçš„æ—¶å€™ï¼Œè·¯æ˜¯æ€ä¹ˆèµ°çš„ã€‚</p>
<p>å¤§å¤šæ•°æƒ…å†µä½ ï¼ˆè¿™é‡Œçš„ä½ æ˜¯æŒ‡ä½ çš„æŠ¥æ–‡ï¼‰èµ°è¿‡å»çš„è·¯ï¼Œè·Ÿèµ°å›æ¥çš„è·¯æ˜¯ä¸€æ ·çš„ã€‚</p>
<p>å°‘æ•°æƒ…å†µä¸‹ï¼Œä½ èµ°å¤§è·¯è¿‡å»ï¼Œç„¶åç»•å°è·¯å›æ¥ã€‚è¿™ä¸ªéƒ½ä¸å½±å“æ‰¾è·¯çš„åŸç†ã€‚</p>
<p>ä¸¾ä¸ªæ —å­ï¼šå½“ä½ åœ¨æ­å·ï¼Œæƒ³å»é»‘é¾™æ±Ÿï¼Œåº”è¯¥å¾€åŒ—èµ°ã€‚ä¸€èˆ¬æƒ…å†µä½ ä¸ä¼šä»æ·±åœ³ç»•ä¸€æŠŠã€‚ä¸‡ä¸€çº¿è·¯ä¸­æ–­ï¼Œä½ ä»è¥¿å®‰ç»•ä¸€ä¸‹ä¹Ÿè¡Œã€‚</p>
<p>æ•´ä½“è€Œè¨€ï¼šå…·ä½“æŠ¥æ–‡æ€ä¹ˆèµ°ï¼Œå°±æ˜¯è·¯ç”±çš„é—®é¢˜äº†ã€‚</p>
<h3 id="è·¯ç”±è¡¨"><a href="#è·¯ç”±è¡¨" class="headerlink" title="è·¯ç”±è¡¨"></a>è·¯ç”±è¡¨</h3><p>å¦‚æœæœ‰ä½ æƒ³è¦æ‡‚ç½‘ç»œï¼Œè¿™å¼ è¡¨æ˜¯ä¸€å®šè¦çœ‹æ‡‚çš„ã€‚</p>
<p>æ‰¾å°Linuxä¸»æœºï¼Œè¾“å…¥#route -n</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">Kernel IP routing table</span><br><span class="line">Destination     Gateway    Genmask      Flags  Metric  Ref  Use Iface</span><br><span class="line">0.0.0.0      10.120.174.1  0.0.0.0       UG     0   0   0  eth0</span><br><span class="line">10.120.174.0    0.0.0.0    255.255.254.0    U     0   0   0  eth0</span><br><span class="line">172.17.0.0     0.0.0.0    255.255.0.0     U     0   0   0  docker0</span><br></pre></td></tr></table></figure></div>

<p>æ³¨æ„ï¼Œè¿™é‡Œçš„-nå‚æ•°ä¸æ˜¯å¿…é¡»çš„ï¼Œä½†æ˜¯å»ºè®®å¸¦ä¸Šï¼Œå…¶ä»–å¾ˆå¤šç½‘ç»œç›¸å…³çš„å‘½ä»¤ï¼Œä¹Ÿéƒ½å»ºè®®å¸¦-nå‚æ•°ã€‚</p>
<p>ï¼ˆåŸå› ï¼šrouteå‘½ä»¤ï¼Œé»˜è®¤ä¼šæŠŠIPåœ°å€ç¿»è¯‘ä¸ºhostnameï¼Œä½†æ˜¯IP-&gt;Hostnameè¿™ä¸ªåŠ¨ä½œï¼Œå°±ä¼šå»æŸ¥DNSï¼Œæœ‰æ—¶å€™DNSé…ç½®çš„ä¸å¥½ï¼Œä¾‹å¦‚æŸ¥ä¸é€šï¼Œé‚£ä¹ˆrouteå‘½ä»¤å°±ä¼šæ„Ÿè§‰å¡ä½äº†ä¸€æ ·ã€‚ï¼‰</p>
<p>è¿™ä¸ªè¡¨çš„ç¬¬ä¸€è¡Œï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">Destination        Gateway         Genmask    Flags    Metric    Ref     Use    Iface</span><br></pre></td></tr></table></figure></div>

<p>çº¢è‰²éƒ¨åˆ†æ˜¯åŸºç¡€ï¼Œå«ä¹‰åˆ†åˆ«ä¸ºï¼š</p>
<table>
<thead>
<tr>
<th align="left">Destination</th>
<th align="left">Gateway</th>
<th align="left">Genmask</th>
<th align="left">Iface</th>
</tr>
</thead>
<tbody><tr>
<td align="left">ç›®çš„IP</td>
<td align="left">ç½‘å…³</td>
<td align="left">æ©ç </td>
<td align="left">ç½‘å¡</td>
</tr>
<tr>
<td align="left">ç›®çš„åœ°</td>
<td align="left">ä¸­è½¬ç«™</td>
<td align="left">ç›®çš„åœ°èŒƒå›´</td>
<td align="left">å“ªä¸ªé—¨å‡ºå‘</td>
</tr>
</tbody></table>
<p>å…ˆçœ‹ä¸­é—´ä¸€æ¡è·¯ç”±è®°å½•</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">ç›®çš„åœ°     ä¸­è½¬ç«™     ç›®çš„åœ°èŒƒå›´ï¼Œ   å“ªä¸ªé—¨å‡ºå‘</span><br><span class="line">10.120.174.0    0.0.0.0         255.255.254.0     eth0</span><br></pre></td></tr></table></figure></div>
<p>é¦–å…ˆï¼Œç›®çš„åœ°å€æ˜¯ 10.120.174.0ï¼ŒèŒƒå›´æ˜¯ 255.255.254.0</p>
<p>æ ¹æ®ä¸ŠèŠ‚çš„æ©ç åŸç†ï¼Œæˆ‘ä»¬çŸ¥é“æ©ç æ˜¯23ä½çš„ï¼Œä¹Ÿå°±æ˜¯åªæœ‰å‰é¢23ä¸åŠ¨ï¼Œåªæœ‰æœ€å9ä½å¯ä»¥åŠ¨ã€‚</p>
<p>ä¸¤è€…ä¸€ç»“åˆï¼ˆä¸ï¼‰ï¼Œå°±çŸ¥é“äº†ç½‘ç»œç›®çš„èŒƒå›´ï¼š<br><img src="/2022/06/11/uncatalog/cl49n9zab0008lwr79y835duy/1.png" alt="image"></p>
<p>ï¼ˆå›¾ï¼šç›®çš„åœ°å€ï¼‰</p>
<p><img src="/2022/06/11/uncatalog/cl49n9zab0008lwr79y835duy/2.png" alt="image"></p>
<p>ï¼ˆå›¾ï¼šç›®çš„åœ°èŒƒå›´ï¼‰</p>
<p>ä¸¤è€…ç»“åˆçš„èŒƒå›´ä¸ºï¼š10.120.174.0ï¼ˆå¯å˜éƒ¨åˆ†å…¨ä¸º0ï¼‰~ 10.120.175.255ï¼ˆå¯å˜éƒ¨åˆ†å…¨ä¸º1ï¼‰ï¼Œæ€»å…±512ä¸ªç›®çš„åœ°å€ï¼ˆIPï¼‰ã€‚</p>
<p>ä¹Ÿå°±æ˜¯æ‰€æœ‰è¿™äº›ç›®çš„IPåœ°å€åœ¨è¿™ä¸ªèŒƒå›´å†…çš„ï¼Œåœ¨é€‰æ‹©è·¯ç”±æ—¶ï¼Œéƒ½åŒ¹é…è¿™æ¡è·¯ç”±è®°å½•ã€‚</p>
<p>é‚£è¿™æ¡è®°å½•æ˜¯è¿™ä¹ˆè¯´çš„ï¼šå½“åŒ¹é…åˆ°è¿™æ¡è®°å½•æ—¶ï¼Œä¸­è½¬ç«™ä¸éœ€è¦ï¼ˆgatewayä¸º0ï¼‰ï¼Œåªç®¡æŠŠæŠ¥æ–‡å¾€eth0è¿™ä¸ªé—¨æ‰”å‡ºå»å°±è¡Œäº†ï¼ˆIfaceä¸ºeth0ï¼‰ã€‚</p>
<p>è¿™æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿå°±æ˜¯è¿™ä¸ªIPèŒƒå›´çš„å¤§å®¶éƒ½åœ¨ä¸€ä¸ªå°çš„å±€åŸŸç½‘ç»œé‡Œé¢ï¼Œä½ å–Šä¸€å£°ï¼Œå¤§å®¶éƒ½èƒ½çŸ¥é“ï¼Œä¸éœ€è¦ä¸­è½¬ã€‚</p>
<p><img src="/2022/06/11/uncatalog/cl49n9zab0008lwr79y835duy/3.png" alt="image"></p>
<p>å†çœ‹æœ€åä¸€æ¡è·¯ç”±è®°å½•</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">ç›®çš„åœ°     ä¸­è½¬ç«™     ç›®çš„åœ°èŒƒå›´ï¼Œ   å“ªä¸ªé—¨å‡ºå‘</span><br><span class="line">172.17.0.0   0.0.0.0    255.255.0.0    docker0</span><br></pre></td></tr></table></figure></div>
<p>è¿™æ¡è®°å½•è·Ÿä¸Šé¢ä¸€æ¡åŸºæœ¬ä¸€æ ·å«ä¹‰ï¼Œç›®çš„åœ°å€ &amp; ç›®çš„åœ°èŒƒå›´ï¼Œç»“åˆåå¾—å‡ºï¼š</p>
<p>ç›®æ ‡åœ°å€ä¸º 172.17.0.0~172.17.255.255çš„æŠ¥æ–‡åªç®¡å¾€ç½‘å¡docker0ä¸Šé¢æ‰”å°±æ˜¯äº†ã€‚</p>
<p><img src="/2022/06/11/uncatalog/cl49n9zab0008lwr79y835duy/4.png" alt="image"></p>
<p>æœ€åçœ‹ç¬¬ä¸€æ¡è·¯ç”±è®°å½•</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">ç›®çš„åœ°     ä¸­è½¬ç«™     ç›®çš„åœ°èŒƒå›´ï¼Œ   å“ªä¸ªé—¨å‡ºå‘</span><br><span class="line">0.0.0.0         10.120.174.1    0.0.0.0           eth0</span><br></pre></td></tr></table></figure></div>
<p>è¿™é‡Œç›®çš„åœ°å€ä¸º0ï¼Œè¡¨ç¤ºdefaulté»˜è®¤è·¯ç”±ï¼Œæ„æ€æ˜¯ï¼šå½“ä½ çš„ç›®çš„åœ°å€å®åœ¨æ˜¯æ‰¾ä¸åˆ°å…¶ä»–èƒ½å¤ŸåŒ¹é…çš„è·¯ç”±è®°å½•æ—¶ï¼Œå°±ç”¨è¿™ä¸€æ¡å§ã€‚</p>
<p>è€Œè¿™ä¸€æ¡é»˜è®¤çš„è§„åˆ™çš„æ„æ€æ˜¯ï¼šå¾€eth0ç½‘å¡ä¸¢ï¼Œå…ˆé€åˆ°ä¸­è½¬ç«™ 10.120.174.1ã€‚ åé¢çš„äº‹æƒ…ä½ ä¸ç”¨ç®¡äº†ï¼ˆæ„æ€æ˜¯è®©ä¸­è½¬ç«™å»è§£å†³åé¢çš„è·¯ç”±ï¼‰</p>
<p>æ¯”å¦‚æˆ‘æƒ³è¦ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">ping 10.184.43.7</span><br></pre></td></tr></table></figure></div>

<p>çš„æ—¶ä¾¯ï¼Œè¿™ä¸ªç›®çš„IPï¼Œæ˜æ˜¾å³ä¸ç¬¦åˆä¸­é—´é‚£æ¡è®°å½•çš„èŒƒå›´ï¼Œä¹Ÿä¸ç¬¦åˆæœ€åä¸€æ¡è®°å½•çš„èŒƒå›´ã€‚æ€ä¹ˆåªèƒ½ä½¿ç”¨è¿™ä¸€æ¡é»˜è®¤è®°å½•äº†ã€‚</p>
<p>å†æ¥ç»†çœ‹è¿™æ¡é»˜è®¤è·¯ç”±è®°å½•ï¼š</p>
<p>è¿™æ¡è®°å½•è¯´ï¼šå½“åŒ¹é…åˆ°è¿™æ¡è®°å½•æ—¶ï¼Œä¸­è½¬ç«™è¦è®¾ç½®ä¸º10.120.174.1ï¼Œå¹¶ä¸”æŠ¥æ–‡è¦å¾€eth0è¿™ä¸ªé—¨æ‰”å‡ºå»ï¼ˆIfaceä¸ºeth0ï¼‰ã€‚</p>
<p>è¿™é‡Œéšå«çš„è¡¨ç¤ºäº†ï¼Œä¸­è½¬ç«™ä½ å¿…é¡»èƒ½åˆ°è¾¾ï¼Œå¦åˆ™ç½‘ç»œä¼šä¸é€šã€‚</p>
<p><em><strong>æŠ¥æ–‡å¦‚ä½•å¯¼åˆ°ä¸­è½¬ç«™</strong></em></p>
<p>å¥½äº†ï¼Œé‚£æˆ‘ä»¬æ¥çœ‹çœ‹æŠ¥æ–‡æ˜¯æ€ä¹ˆä¸ä¸­è½¬ç«™é€šçš„ã€‚ è¿™é‡Œä¸­è½¬ç«™IPä¸º10.120.174.1ï¼Œè¦æƒ³æŠŠæŠ¥æ–‡é€åˆ°è¿™é‡Œå»ï¼Œæˆ‘ä»¬åº”è¯¥æ€ä¹ˆèµ°ï¼Ÿ</p>
<p>å’¦ï¼Œåˆæ˜¯è·¯æ€ä¹ˆèµ°çš„é—®é¢˜ï¼Œè¿™ä¸æ˜¯ä¸Šé¢åˆšå­¦çš„å˜›ã€‚</p>
<p>æ¥ï¼Œè·Ÿæˆ‘ä¸€èµ·åŒ¹é…ï¼Œç¬¬ä¸‰æ¡è¡Œä¸è¡Œï¼Ÿä¸è¡Œã€‚</p>
<p>ç¬¬äºŒæ¡è¡Œä¸è¡Œï¼Œè¡Œï¼</p>
<p>åˆšå¥½æ˜¯ç¬¬äºŒæ¡è·¯ç”±è®°å½•çš„èŒƒå›´ï¼ˆ10.120.174.0~10.120.175.255ï¼‰ï¼Œé‚£å°±ç”¨ç¬¬äºŒæ¡è·¯ç”±æŒ‡å®šçš„æ–¹å¼å‘é€ï¼ˆæŠ¥æ–‡ä»eth0æ‰”å‡ºå»å°±è¡Œäº†ï¼‰ã€‚</p>
<p>å¾ˆæ˜æ˜¾çš„æ˜¯åœ¨é€’å½’æŸ¥æ‰¾è·¯ç”±è¡¨ã€‚åŒæ—¶ï¼Œè¿™ä¹Ÿè¯´æ˜ä¸­è½¬ç«™å°±åœ¨åŒä¸€ä¸ªå±€åŸŸç½‘å†…å˜›ã€‚</p>
<p>å³æŠ¥æ–‡é€åˆ°ç½‘å…³ï¼Œä¹Ÿæ˜¯è¦æŸ¥æ‰¾è·¯ç”±è¡¨çš„ã€‚</p>
<h4 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h4><p>é€šè¿‡æŠŠæ‰€æœ‰çš„è·¯ç”±è¡¨éƒ½åŒ¹é…ä¸€éï¼Œä½ ä¼šå‘ç°ï¼Œä»»æ„çš„ç›®çš„IPï¼Œéƒ½èƒ½åŒ¹é…åˆ°è·¯ç”±è¡¨ä¸­çš„ä¸€æ¡ï¼ˆå› ä¸ºä½ æœ‰ä¸€ä¸ªdefaultè§„åˆ™ï¼‰ã€‚</p>
<p>åŒ¹é…çš„è¿‡ç¨‹ä½ å°±å½“åšæ˜¯â€œäººå·¥â€ä¸€ä¸ªä¸€ä¸ªçš„æŸ¥ã€‚å¦‚æœä½ è¿è·¯æ€ä¹ˆèµ°éƒ½æ²¡æœ‰è®¾ç½®å¥½ï¼Œç½‘ç»œåˆæ€ä¹ˆèƒ½é€šå‘¢ï¼Ÿ</p>
<h3 id="æœ¬æœºIPåœ°å€å¯¹è·¯ç”±çš„å½±å“"><a href="#æœ¬æœºIPåœ°å€å¯¹è·¯ç”±çš„å½±å“" class="headerlink" title="æœ¬æœºIPåœ°å€å¯¹è·¯ç”±çš„å½±å“"></a>æœ¬æœºIPåœ°å€å¯¹è·¯ç”±çš„å½±å“</h3><p>å…ˆçœ‹ä¸€ä¸‹æœ¬æœºçš„IPä¿¡æ¯ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ifconfig</span></span><br><span class="line">docker0   Link encap:Ethernet  HWaddr 02:42:e6:07:93:34  </span><br><span class="line">inet addr:172.17.0.1  Bcast:0.0.0.0  Mask:255.255.0.0</span><br><span class="line">eth0     Link encap:Ethernet  HWaddr 28:6e:d4:88:f8:64  </span><br><span class="line">inet addr:10.120.175.166  Bcast:10.120.175.255  Mask:255.255.254.0</span><br><span class="line">lo      Link encap:Local Loopback  </span><br><span class="line">inet addr:127.0.0.1  Mask:255.0.0.0</span><br></pre></td></tr></table></figure></div>


<p>ä½ ä¼šå‘ç°ï¼Œæ¯ä¸ªç½‘å¡å¦‚æœæœ‰IPï¼Œå°±ä¼šåœ¨è·¯ç”±è¡¨é‡Œé¢å¢åŠ ä¸€æ¡è·¯ç”±è®°å½•ã€‚æ¯”å¦‚ä½ æŠŠä¸€ä¸ªç½‘å¡downæ‰ï¼Œå†çœ‹routeè¡¨ï¼Œå°±ä¼šå‘ç°å°‘äº†ä¸€æ¡è·¯ç”±è®°å½•ã€‚å†æ¬¡upè¿™ä¸ªç½‘å¡çš„æ—¶å€™ï¼Œè·¯ç”±è®°å½•åˆå›æ¥äº†ã€‚</p>
<p>å¹¶ä¸”ï¼Œè¿™æ¡è·¯ç”±çš„Destinationï¼ˆç›®çš„åœ°èŒƒå›´ï¼‰å’Œä½ è®¾ç½®çš„è¿™ä¸ªIPçš„æ©ç æ˜¯ä¸€è‡´çš„ã€‚ä¾‹å¦‚è¿™é‡Œï¼Œæˆ‘æœ¬æœºipä¸º10.120.175.166ï¼Œæ©ç ä¸º255.255.254.0ã€‚æ‰€ä»¥è·¯ç”±å°±æ˜¯IP&amp;æ©ç =10.120.174.0ã€‚</p>
<p>ä¸ºä»€ä¹ˆï¼Ÿè¿™ä¸ªä¸æ˜¯å¾ˆæ˜æ˜¾ä¹ˆï¼Œä½ æ–°åŠ äº†ä¸€ä¸ªç½‘å¡ï¼Œæ’ä¸Šäº†ç½‘çº¿ï¼Œè¿˜æ‹¿åˆ°äº†æ–°IPï¼Œè¯´æ˜ä½ è¿™ä¸ªç½‘å¡æ¥å…¥äº†ä¸€ä¸ªæ–°çš„å±€åŸŸç½‘å•Šï¼Œä½ å½“ç„¶å¤šäº†ä¸€æ¡æ–°çš„è·¯å¯ä»¥èµ°äº†ã€‚</p>
<h3 id="åŒ…å«é—®é¢˜"><a href="#åŒ…å«é—®é¢˜" class="headerlink" title="åŒ…å«é—®é¢˜"></a>åŒ…å«é—®é¢˜</h3><p>å½“ä¸¤æ¡è·¯ç”±è®°å½•äº’ç›¸åŒ…å«æ—¶æ€ä¹ˆåŠï¼Ÿ</p>
<p>æ¯”å¦‚ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">172.0.0.0       0.0.0.0         255.0.0.0      U     0      0        0 eth0</span><br><span class="line">172.17.0.0      0.0.0.0         255.255.0.0     U     0      0        0 docker0</span><br></pre></td></tr></table></figure></div>

<p>è¿™ä¸ªæ—¶å€™ï¼Œå¦‚æœæƒ³è¦</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">ping 172.17.0.2</span><br></pre></td></tr></table></figure></div>

<p>æ˜¯ç”¨å“ªæ¡è·¯ç”±è®°å½•å‘¢ï¼Ÿ</p>
<p>é¦–å…ˆï¼Œå¦‚æœä½ ä¹‹å‰çš„è¯¾æœ‰è®¤çœŸå­¦ä¹ ï¼Œé‚£ä¹ˆä½ ä¼šçŸ¥é“ï¼Œè¿™é‡Œä¸åŒçš„æ©ç ï¼Œå°±ä»£è¡¨äº†ä¸åŒçš„ç½‘ç»œã€‚è¿™æ—¶è„‘æµ·ä¸­åº”è¯¥ä¼šå±•ç°ä¸¤æ¡ä¸åŒçš„è·¯ã€‚é€‰å“ªæ¡è·¯ï¼Œå½“ç„¶æ˜¯é€‰æ‹©æœ€åŒ¹é…çš„é‚£ä¸€æ¡äº† :-)</p>
<p>ï¼ˆä¾‹å¦‚defaultè®°å½•ï¼Œå…¶å®ä»»æ„ç›®çš„IPéƒ½èƒ½åŒ¹é…ï¼Œä½†å®ƒä¸æ˜¯æœ€ç²¾å‡†åŒ¹é…çš„ï¼‰</p>
<p>å…¶æ¬¡ï¼Œå¦‚æœå‡ºç°è¿™ç§æƒ…å†µï¼Œè¯´æ˜ä½ çš„ç½‘ç»œè§„æ ¼æœ‰å¾…æ”¹è¿›ï¼Œè™½ç„¶è¿™ä¸ä¼šå‡ºé—®é¢˜ï¼Œä½†æ˜¯ç”±äºä¼šå½±å“äººçš„ç†è§£ï¼Œæ‰€ä»¥å»ºè®®ä¸è¦è¿™æ ·å­è®¾ç½®ã€‚</p>
<p>é™¤éä½ éå¸¸æ˜ç¡®åœ°æ•…æ„è¿™ä¹ˆè§„åˆ’ï¼Œä¾‹å¦‚flannelçš„ç½‘ç»œè®¾ç½®ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">root@k8s-node1:~# route -n</span><br><span class="line">Destination   Gateway    Genmask     Flags Metric Ref  Use   Iface</span><br><span class="line">10.1.0.0    0.0.0.0   255.255.0.0    U    0    0   0   flannel0  // è·¨èŠ‚ç‚¹å®¹å™¨çš„åŒ…</span><br><span class="line">10.1.15.0    0.0.0.0   255.255.255.0   U    0    0   0   docker0   // æœ¬èŠ‚ç‚¹å®¹å™¨çš„åŒ…</span><br></pre></td></tr></table></figure></div>


<p>ä¸ºäº†å°†æ‰€æœ‰çš„å®¹å™¨ï¼ˆå®¹å™¨ä¹Ÿå¯ä»¥çœ‹ä½œä¸€ä¸ªç‹¬ç«‹çš„ä¸»æœºï¼Œåé¢ç« èŠ‚ä¼šä»‹ç»ï¼‰è¿åœ¨ä¸€èµ·ï¼Œé¦–å…ˆæŠŠæ‰€æœ‰ä¸»æœºä¸Šé¢çš„å®¹å™¨ä½œä¸ºå¤§çš„ç½‘ç»œä¸€éƒ¨åˆ†ï¼Œç„¶åæ¯å°äº’ç›¸ç‹¬ç«‹çš„ä¸»æœºé‡Œé¢çš„å®¹å™¨åˆå•ç‹¬åˆ’åˆ†å°çš„ç½‘ç»œã€‚ä¸”ä»»æ„ä¸¤ä¸ªå•ç‹¬çš„å°å­ç½‘ä¸é‡å¤ã€‚</p>
<p>æ³¨æ„ç«™åœ¨æœ¬æœºçš„è§’åº¦çœ‹æ¥ï¼Œè¿™æ˜¯ä¸¤ä¸ªç‹¬ç«‹ç½‘ç»œï¼Œåªæ˜¯åœ¨ç®¡ç†å‘˜è§†è§’çœ‹å¤§å®¶åœ¨ä¸€ä¸ªå¤§çš„ç½‘ç»œå†…ã€‚</p>
<p><img src="/2022/06/11/uncatalog/cl49n9zab0008lwr79y835duy/5.png" alt="image"></p>
<p>ä¸»æœºå¯¹å¾…æŠ¥æ–‡ï¼Œæ˜¯ä½œå®Œå…¨ç‹¬ç«‹çš„åˆ¤æ–­ï¼šæ˜¯æœ¬æœºçš„ or ä¸æ˜¯æœ¬æœºçš„ã€‚</p>
<p>æ‰€ä»¥å‘ç»™å®¹å™¨çš„æŠ¥æ–‡ï¼Œéƒ½ç¬¦åˆï¼šä¸æ˜¯æœ¬æœºçš„ã€‚ é‚£ä¹ˆå°±è¦å¼€å§‹åŒ¹é…è·¯ç”±è¡¨å•¦ã€‚åŒ¹é…è¿‡ç¨‹è§ä¸Šé¢çš„è¯¾ç¨‹ã€‚</p>
<p>å¥½äº†ï¼Œåˆ°è¿™é‡Œè‡³å°‘ä½ åº”è¯¥èƒ½çœ‹æ‡‚è·¯ç”±è¡¨ä¿¡æ¯äº†ã€‚ç»™ä½ ä¸€ä¸ªç›®çš„IPï¼Œä½ ä¹Ÿåº”è¯¥çŸ¥é“å®ƒä¼šä½¿ç”¨å“ªä¸€æ¡è·¯ç”±äº†ã€‚</p>
<p>è·¯æ€ä¹ˆèµ°å°±çœ‹éªšå¹´ä½ äº†~</p>
]]></content>
      <tags>
        <tag>äº‘åŸç”ŸåŸºç¡€ç³»åˆ—</tag>
        <tag>Kubernetesç½‘ç»œ</tag>
      </tags>
  </entry>
  <entry>
    <title>Kubernetesç½‘ç»œç³»åˆ—ä¹‹(äº”)PingæŠ¥æ–‡</title>
    <url>/2022/06/11/uncatalog/cl49np026000blwr7c4y2ebgu/</url>
    <content><![CDATA[<hr>
<span id="more"></span>



<hr>
<blockquote>
<p>è¿™ä¸€ç« èŠ‚ä½ çš„è§’è‰²æ˜¯å›½ç‹ï¼Œä½ è¦æ´¾ä¸€ä¸ªå°å…µå»å¯¹æ–¹æ‰“æ¢ä¸€ä¸‹ã€‚æ˜¯ç«™åœ¨ä½ çš„è§’åº¦çœ‹è¿™ä¸ªå°å…µã€‚å“¦ï¼Œå¯¹äº†ï¼Œè¿™ä¸ªå°å…µçš„åå­—å«â€œå–‚â€</p>
</blockquote>
<h3 id="Pingå‘½ä»¤ä»‹ç»"><a href="#Pingå‘½ä»¤ä»‹ç»" class="headerlink" title="Pingå‘½ä»¤ä»‹ç»"></a>Pingå‘½ä»¤ä»‹ç»</h3><p>pingå°±æ˜¯ç”¨æ¥æ£€æµ‹ä¸€ä¸‹ç½‘ç»œèƒ½ä¸èƒ½è·Ÿå¯¹æ–¹äº’é€šï¼Œç±»ä¼¼ï¼šâ€œå¤§å“¥ï¼Œåœ¨ä¹ˆï¼Ÿâ€ï¼Œâ€œå“¥åœ¨ã€‚â€ï¼Œäºæ˜¯ä½ å°±å®‰å¿ƒäº†ã€‚ä¸ºå•¥ä½ å°±å®‰å¿ƒäº†å‘¢ï¼Œå› ä¸ºä½ å®³æ€•å­¤å•ï¼ˆæ±—ï¼Œå…¶å®å› ä¸ºç½‘ç»œä¸é€šä½ å•¥ä¹Ÿç©ä¸äº†ï¼‰ã€‚</p>
<p>ä¸Šä¸€èŠ‚ä½ éƒ½å­¦ä¼šäº†è·¯æ€ä¹ˆèµ°ï¼Œå’±èµ°ä¸€ä¸ªå‘—ï¼Ÿèµ°ä¸€ä¸ªå°±æ˜¯æ´¾ä¸ªå°å…µå¸®ä½ èµ°ä¸€è¶Ÿï¼Œè¿™ä¸ªå°å…µåå­—å«â€œå–‚â€ã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">ping 10.184.43.7</span><br></pre></td></tr></table></figure></div>


<p>è¿™ä¸ªæ—¶å€™ï¼Œå°±ä»æœ¬æœºå‘å‡ºä¸€ä¸ªæŠ¥æ–‡â€œå–‚â€ï¼Œä»å“ªä¸ªç½‘å¡å‘å‡ºï¼Œèµ°åˆ°å“ªä¸ªä¸­è½¬ç«™ï¼Œéƒ½åœ¨è·¯æ€ä¹ˆèµ°ç« èŠ‚è¯´è¿‡ã€‚</p>
<p>å°å…µæ´¾å‡ºåï¼Œæœ‰å¥½å‡ ç§å‘½è¿ç­‰ç€ä»–ï¼š</p>
<ol>
<li><p>æ²¡æœ‰è·¯åˆ°è¾¾å¯¹æ–¹ï¼Œå°å…µå¤±è´¥è€Œå½’ã€‚ç›¸å¯¹æ¥è¯´ï¼Œè¿™ç§å°å…µè¿˜æ˜¯å¾ˆå¹¸ç¦äº†ã€‚</p>
</li>
<li><p>æ‚²å‚¬ä¸€ç‚¹ï¼Œä»–åŠè·¯æ‰¾ä¸ç€å¯¹æ–¹ï¼Œè¿·è·¯ï¼ˆå¤±ï¼‰äº†ã€‚</p>
</li>
<li><p>æœ€æƒ¨çš„æƒ…å†µï¼Œè·¯ä¸Šè®¾ç½®äº†æœºå…³ï¼Œä»–åœ¨åŠè·¯è¢«æ€äº†ã€‚</p>
</li>
<li><p>å¥½ä¸€ç‚¹çš„ï¼Œä»–åˆ°è¾¾äº†å¯¹æ–¹ï¼Œä½†æ˜¯å¯¹æ–¹æ´¾å‡ºçš„ä½¿è€…å´æ²¡èƒ½åˆ°ä½ è¿™ã€‚</p>
</li>
<li><p>å®Œç¾ï¼Œä»–æˆåŠŸåˆ°è¾¾å¯¹æ–¹ï¼Œå¯¹æ–¹çš„å›è®¿ä½¿è€…ä¹Ÿå›æ¥åˆ°ä½ è¿™é‡Œäº†ã€‚</p>
</li>
</ol>
<p><img src="/2022/06/11/uncatalog/cl49np026000blwr7c4y2ebgu/1.png" alt="image"></p>
<p>å…¶ä¸­ç¬¬äºŒç§æƒ…å†µï¼Œå…¶å®å°±æ˜¯å¯¹æ–¹çš„â€œå–‚â€ä½¿è€…å‡ºç°äº†3æˆ–è€…4çš„æƒ…å†µã€‚æ‰€ä»¥è¿™é‡Œå¤§æ¦‚å°±ä¸‰ç§æƒ…å†µï¼š</p>
<ol>
<li><p>æˆåŠŸ</p>
</li>
<li><p>æ²¡ååº”</p>
</li>
<li><p>å¾ˆæ˜ç¡®çš„ä¸é€š</p>
</li>
</ol>
<p>1.æˆåŠŸ<br>pingæŠ¥æ–‡æ˜¯ICMPåè®®ä¸­çš„ä¸€ç§ ï¼ˆå°±å¥½æ¯”TCPåè®®ä¸­çš„synï¼ŒsynæŠ¥æ–‡åªæ˜¯TCPåè®®ä¸­çš„ä¸€ç§ï¼‰ã€‚</p>
<p>è€ŒICMPåè®®æ˜¯ä¸TCPåŒçº§çš„ï¼Œä¹Ÿå°±æ˜¯åœ¨IPåè®®ä¹‹ä¸Šçš„ã€‚</p>
<p>ICMP / TCP / UDP è¿™ä¸‰ä¸ªå°ä¼™ä¼´ï¼Œä½ éƒ½ç†Ÿäº†ä»¥åï¼Œä¸€èˆ¬ç½‘ç»œé—®é¢˜éƒ½ä¸æ˜¯é—®é¢˜ã€‚</p>
<p><img src="/2022/06/11/uncatalog/cl49np026000blwr7c4y2ebgu/2.png" alt="image"></p>
<p>Macå±‚ -&gt; IPå±‚ -&gt; ä¸‰å…„ å¼Ÿ</p>
<ol start="2">
<li>æ²¡ååº”<br>å½“ä½ pingå¯¹æ–¹çš„æ—¶å€™ï¼Œä¸€ç›´ä¹ˆæœ‰ååº”ï¼Œå¡ä½äº†ä¸€æ ·ï¼š<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">ping 10.184.149.249</span><br><span class="line"></span><br><span class="line">PING 10.184.149.249 (10.184.149.249) 56(84) bytes of data.</span><br><span class="line"></span><br><span class="line">^C</span><br><span class="line"></span><br><span class="line">--- 10.184.149.249  ping statistics ---</span><br></pre></td></tr></table></figure></div></li>
</ol>
<p>107 packets transmitted, 0 received, 100% packet loss, time 106545ms</p>
<p>ç›´åˆ°æŒ‰äº† Ctrl + C æ‰å‘Šè¯‰ä½ pingä¸é€šï¼ˆæˆ–è€…ç›´æ¥æŠ¥ Time Outï¼‰ï¼Œç°è±¡å°±æ˜¯åŒ…å…¨éƒ¨éƒ½ä¸¢äº†ã€‚</p>
<p>å¤§æ¦‚æ„æ€å°±æ˜¯ï¼šä½ è¿™ä¸ªå›½ç‹ï¼Œæ´¾å‡ºå°å…µåï¼Œä¸€ç›´é¸Ÿæ— éŸ³è®¯ï¼Œä½ æœ›çœ¼æ¬²ç©¿å•Šã€‚ã€‚ç‰¹åˆ«ä»¤ä½ éš¾è¿‡çš„æ˜¯ï¼Œä½ éƒ½æ´¾å‡ºä¸€å †å°å…µäº†å•Š T_T~</p>
<p>è¿™ç§æƒ…å†µå°±æ˜¯å¤§å®¶ç»å¸¸é‡åˆ°çš„ä¸ºpingä¸é€šçš„é—®é¢˜ï¼Œç‰¹åˆ«æ˜¯äº‘è®¡ç®—å¹³å°é‡Œé¢ã€‚åŸºæœ¬é—®é¢˜ä½ å¤§æ¦‚ä¹ŸçŒœåˆ°äº†ï¼Œè¦ä¹ˆä½ çš„å°å…µæ²¡èƒ½åˆ°å¯¹æ–¹ï¼Œè¦ä¹ˆå°±æ˜¯å¯¹æ–¹æ˜¯å›è®¿ä½¿è€…æ²¡èƒ½å›åˆ°ä½ è¿™é‡Œã€‚é‚£ä»€ä¹ˆæƒ…å†µä¼šå¯¼è‡´ä½ çš„å°å…µä¸çŸ¥é“è·‘å“ªé‡Œå»äº†å‘¢ï¼Ÿè¿™ç§é—®é¢˜ï¼Œä»æœ¬æœºè§†è§’æ˜¯å¾ˆéš¾å‘ç°ä¸ºä»€ä¹ˆä¸é€šçš„ï¼Œä¹Ÿå¾ˆéš¾çŸ¥é“ä½ çš„å°å…µåˆ°åº•è·‘åˆ°å“ªé‡Œè¢« å¹²æ‰äº†ï¼Œæ¯•ç«Ÿæœ¬æœºå’Œç›®çš„ä¹‹é—´å¯èƒ½æœ‰å¾ˆå¤šçš„ä¸­è½¬ç«™ã€‚</p>
<p>æ€ä¹ˆå®šä½å‘¢ï¼Ÿå…¶å®ä¹Ÿå¾ˆç®€å•ï¼Œé‚£å°±æ˜¯å¼€å¯ä¸Šå¸æ¨¡å¼ï¼Œä»å…¨å±€è§’åº¦å»çœ‹çœ‹å°å…µåˆ°å“ªé‡Œäº†ã€‚ç›´æ¥æ´¾ä¸Šå¸ï¼ˆè¿™é‡Œå°±æ˜¯ä½ è‡ªå·±äº†ï¼‰å»å¯¹æ–¹ç›®çš„åœ°ç›¯ç€ï¼ˆæŠ“åŒ…ï¼‰ï¼Œçœ‹çœ‹â€œå–‚â€æŠ¥æ–‡æœ‰æ²¡æœ‰è¿‡æ¥ã€‚</p>
<p>æœ‰ä¸¤ç§æƒ…å†µï¼Œåˆ†åˆ«è®¨è®ºï¼š</p>
<ol>
<li><p>ç›®çš„åœ°æ²¡æœ‰æ”¶åˆ°â€œå–‚â€æŠ¥æ–‡</p>
</li>
<li><p>ç›®çš„åœ°æ”¶åˆ°äº†â€œå–‚â€æŠ¥æ–‡</p>
</li>
</ol>
<p>2.1 æ²¡æœ‰æ”¶åˆ°â€œå–‚â€æŠ¥æ–‡<br>å¦‚æœç›®çš„åœ°æ²¡æœ‰æ”¶åˆ°ICMPæŠ¥æ–‡ï¼Œä½†æ˜¯æœ‰æ”¶åˆ°ARPè¯·æ±‚ï¼ˆâ€œå–‚â€ä½¿è€…çš„æ¢è·¯å“¨å…µï¼ŒARPç« èŠ‚ä¼šä»‹ç»ï¼‰ï¼Œé‚£è¯´æ˜ç½‘ç»œè¿æ¥æ˜¯å¥½çš„ï¼Œåªæ˜¯ICMPä¸é€šï¼Œå…«æˆå°±æ˜¯ç½‘ç»œå®‰å…¨ç»„æŠŠICMPæŠ¥æ–‡ç»™banäº†ã€‚</p>
<p>å¦‚æœç›®çš„åœ°å¾ˆå®‰é™ï¼Œä»€ä¹ˆéƒ½æ²¡æœ‰æ”¶åˆ°ã€‚é‚£ä¹ˆå’±ä»¬åªèƒ½æŠŠä¸Šå¸å†å¾€å‰ç§»ä¸€ç§»äº†ï¼Œæ”¾åˆ°ä¸­é€”çš„ä¸­è½¬ç«™çœ‹çœ‹å’±ä»¬çš„è¿™ä¸ªâ€œå–‚â€ä½¿è€…æœ‰æ²¡æœ‰åˆ°è¾¾ä¸­è½¬ç«™ã€‚æ‰¾å‡ºæœ€åèƒ½åˆ°è¾¾çš„ä¸­è½¬ç«™ï¼Œç„¶åå†ä»è¿™ä¸€ç«™å¼€å§‹é‡æ–°pingç›®çš„åœ°ã€‚</p>
<p>2.2 æœ‰æ”¶åˆ°â€œå–‚â€æŠ¥æ–‡<br>å¦‚æœæ”¶åˆ°äº†ICMPæŠ¥æ–‡ï¼Œé‚£ä¹ˆè¯´æ˜æ¥çš„è·¯æ˜¯é€šçš„ï¼Œåªæ˜¯å›å»å—é˜»ã€‚é‚£ä½ å°±åè¿‡æ¥ä»ç›®çš„åœ°å¼€å§‹pingä¸€ä¸‹å¯¹æ–¹å˜›ï¼Œè¿™ä¸ªä¸å°±æ˜¯å›åˆ°äº†ä¸Šé¢æåˆ°çš„å®šä½æ–¹æ³•äº†ä¹ˆã€‚</p>
<p>æœ‰äººä¼šé—®ï¼Œæœ‰æ²¡æœ‰å¯èƒ½A-&gt;ping-&gt;Bçš„æ—¶å€™ï¼ŒBèƒ½æ”¶åˆ°æŠ¥æ–‡ï¼Œä½†æ˜¯å“åº”å›ä¸æ¥ã€‚åè¿‡æ¥ä»B-&gt;ping-&gt;Aï¼Œå°±æ˜¯é€šçš„ã€‚æˆ–è€…B-&gt;ping-&gt;Açš„æ—¶å€™ï¼ŒåŒæ ·æ˜¯æŠ¥æ–‡ä¹Ÿèƒ½åˆ°Aï¼Œä½†æ˜¯å“åº”å›ä¸åˆ°Bã€‚</p>
<p>å½“ç„¶æœ‰è¿™ç§æƒ…å†µäº†ï¼Œè€Œä¸”ç»å¸¸é‡åˆ°ï¼ŒAå¯ä»¥pingé€šBï¼ŒBå´pingä¸é€šAã€‚è¿™ç§æƒ…å†µä¸€èˆ¬éƒ½æ˜¯ç½‘ç»œå®‰å…¨ç»„çš„è®¾ç½®å¯¼è‡´çš„ã€‚ï¼ˆç‰¹åˆ«åœ¨äº‘è®¡ç®—å¹³å°ä¸­ï¼‰å®‰å…¨ç»„å¤§éƒ½æ¶‰åŠiptablesçš„è§„åˆ™ã€‚æ‰€ä»¥è¿™é‡Œå°±å¾—åˆ†æiptableè¡¨å¯¹æŠ¥æ–‡çš„ä¸¢åŒ…ç»Ÿè®¡ï¼ŒæŠŠå¯¼è‡´é˜»å¡çš„é‚£æ¡å®‰å…¨ç»„è§„åˆ™æ”¾é€šå°±å¯ä»¥äº†ã€‚iptablesä»‹ç»è§åç»­å¯¹åº”ç« èŠ‚ã€‚</p>
<ol start="3">
<li>ç›®æ ‡ä¸å¯è¾¾<br>pingç›®æ ‡çš„æ—¶å€™ï¼Œç›´æ¥ç»“æœå°±æ˜¯ä¸å¯è¾¾ã€‚<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ping 172.17.10.1</span></span><br><span class="line"></span><br><span class="line">PING 172.17.10.1 (172.17.10.1) 56(84) bytes of data.</span><br><span class="line"></span><br><span class="line">From 10.120.175.166 icmp_seq=1 Destination Host Unreachable</span><br><span class="line"></span><br><span class="line">From 10.120.175.166 icmp_seq=2 Destination Host Unreachable</span><br></pre></td></tr></table></figure></div></li>
</ol>
<p>è¿™ä¸ªä¹Ÿå®¹æ˜“é‡åˆ°ï¼Œä½†å…¶å®éå¸¸å®¹æ˜“è§£å†³ã€‚è¿™ä¸ªé”™è¯¯åŸå› å°±æ˜¯è·¯ç”±ä¸é€šï¼Œè¦ä¹ˆæ˜¯æœ¬æœºè·¯ç”±ä¸é€šï¼Œè¦ä¹ˆå°±æ˜¯ä¸­è½¬ç«™çš„è·¯ç”±ä¸é€šã€‚</p>
<p>å¤§æ¦‚æ„æ€å°±æ˜¯ï¼šä½ è¿™ä¸ªå›½ç‹ï¼Œæ´¾å‡ºå°å…µåï¼Œè™½ç„¶æœŸå¾…çš„å¯¹æ–¹ä½¿è€…æ²¡å‡ºç°ã€‚å¥½æ­¹ä½ çš„å°å…µå›æ¥äº†ï¼Œç„¶åè·Ÿä½ ä¸€æŠŠçœ¼æ³ªä¸€æŠŠé¼»æ¶•å“­è¯‰ï¼šå·²ç»èµ°äº†å¾ˆå¤šçš„è·¯ï¼Œæˆ˜èƒœäº†å¤šå°‘çš„è‰°éš¾é™©é˜»ï¼Œä½†æ˜¯æ²¡èƒ½å®Œæˆå‡ºä½¿ä»»åŠ¡æœ‰å¤šä¹ˆçš„æƒ­æ„§ã€‚ç„¶åæ±‚ä½ è¿™ä¸ªè¡¨é¢ä¸Šæ˜¯å›½ç‹ï¼Œå®é™…ä¸Šåªæ˜¯ç¨‹åºçŒ¿çš„å®¶ä¼™å»å®šä½ä¸€ä¸‹ã€‚</p>
<p>å¥½æ­¹ï¼Œä½ å¤§æ¦‚çŸ¥é“åœ¨å“ªä¸ªä½ç½®å¼€å§‹ä¸é€šï¼š</p>
<p>å¦‚æœæ˜¯æœ¬æœºç›´æ¥è·¯ç”±ä¸é€šï¼Œé‚£æ¶ˆæ¯å°±æ˜¯ï¼šâ€Destination Host Unreachable,â€</p>
<p>å¦‚æœæ˜¯ä¸­è½¬ç«™è·¯ç”±ä¸é€šï¼Œé‚£æ¶ˆæ¯æ˜¯ï¼šâ€Reply From &lt; IP address &gt;: Destination Host Unreachable,â€</p>
<p>ä½ ç›´æ¥åˆ°ä¸­è½¬ç«™å»pingç›®çš„åœ°ï¼Œä¸­è½¬ç«™å°±æ˜¯ä¸Šé¢çš„<IP address>ï¼Œç„¶åçœ‹çœ‹ä¸ºä»€ä¹ˆè·¯ç”±ä¸é€šã€‚è¯¥ä¸­è½¬ç«™åé¢å¯èƒ½è¿˜æœ‰å¾ˆå¤šçš„ä¸­è½¬ç«™ï¼Œä½ è¿™ä¸ªä¸Šå¸è¦è¾›è‹¦ä¸€ä¸‹ï¼ŒæŠŠä¸€è·¯ä¸Šä¸é€šçš„ä¸­è½¬ç«™éƒ½æ‰¾å‡ºæ¥ï¼ŒåŠ ä¸Šåˆç†çš„è·¯ç”±ã€‚</IP></p>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>pingä¸é€šï¼Ÿå…ˆçœ‹è·¯ç”±ï¼è·¯ç”±è‚¯å®šæ²¡é—®é¢˜ï¼Œé‚£å°±æ˜¯å®‰å…¨ç»„ææ€ªå–½ï¼</p>
<p>æ€ä¹ˆå®šä½ï¼Ÿå¼€å¯ä¸Šå¸æ¨¡å¼ï¼Œåˆ°å¤„æŠ“åŒ…åˆ¤æ–­â€œå–‚â€åˆ°å“ªé‡Œäº†~</p>
]]></content>
      <tags>
        <tag>äº‘åŸç”ŸåŸºç¡€ç³»åˆ—</tag>
        <tag>Kubernetesç½‘ç»œ</tag>
      </tags>
  </entry>
  <entry>
    <title>Kubernetesç½‘ç»œç³»åˆ—ä¹‹(å…­)ARPä½ åœ¨å“ª</title>
    <url>/2022/06/11/uncatalog/cl49nvljx000elwr7fha73lvv/</url>
    <content><![CDATA[<hr>
<span id="more"></span>



<hr>
<blockquote>
<p>è¿™ä¸€ç« èŠ‚ä½ çš„è§’è‰²å°±æ˜¯pingæŠ¥æ–‡è¿™ä¸ªâ€œä½¿è€…â€ï¼Œä½ è¦å»å¾€ç›®çš„åœ°ï¼Œç„¶åå›åˆ°æœ¬æœºã€‚ç„¶è€Œç›®çš„åœ°è·¯æ¼«æ¼«ï¼Œä¸çŸ¥é“è¦ç»è¿‡å¤šå°‘ä¸ªå°åœ°ç›˜(å±€åŸŸç½‘)ï¼Œæ²¡ä¸¤æŠŠåˆ·å­ä¹Ÿä¸å¥½è¡Œèµ°æ±Ÿæ¹–ã€‚æ‰€ä»¥ä½ ä½œä¸ºä½¿è€…ï¼Œæ¯åˆ°è¾¾ä¸€ä¸ªæ–°çš„åœ°ç›˜ï¼Œå°±æŠŠARPè¿™æŠŠåˆ·å­æ‹¿å‡ºæ¥å¼ä¸€å¼ã€‚è¿™ä¸€èŠ‚å°±æ˜¯è®²çš„è¿™æŠŠåˆ·å­çš„å¨åŠ›ã€‚</p>
</blockquote>
<h3 id="ARPå‘½ä»¤ä»‹ç»"><a href="#ARPå‘½ä»¤ä»‹ç»" class="headerlink" title="ARPå‘½ä»¤ä»‹ç»"></a>ARPå‘½ä»¤ä»‹ç»</h3><p>é¦–å…ˆï¼ŒARPä½œä¸ºé«˜æ”»å‡»ç¥å™¨ï¼Œæ˜¯ç‰‡æ”»å‡»çš„ï¼Œä¸€å®šèŒƒå›´å†…å…¨æ€ï¼Œè€Œä¸æ˜¯å•ç‚¹æŒ‡å‘çš„æŠ€èƒ½ã€‚å…¶æ”»å‡»èŒƒå›´å°±æ˜¯å­ç½‘çš„å¤§å°ï¼ŒåŒä¸€ä¸ªå­ç½‘å†…çš„æ‰€æœ‰ä¸»æœºéƒ½ä¼šæ”¶åˆ°ARPç¥å™¨çš„ä¼¤å®³ã€‚æ­£å› ä¸ºARPæŠ¥æ–‡æ˜¯å¹¿æ’­çš„ï¼Œæ‰€ä»¥å®ƒæ˜¯pingä½¿è€…éšèº«æºå¸¦ã€å¼€å±±é—®è·¯çš„ä¸äºŒä¹‹åˆ·ã€‚</p>
<p>å…¶æ¬¡ï¼ŒARPç¥å™¨åŸºæœ¬é ä¸€æ‹›èµ°éå¤©ä¸‹ï¼Œå‘åŠ¨æ”»å‡»å‰å¼ä¸€å¥ï¼šâ€œè°æ˜¯å°æ˜ï¼Œè¯·å±ä¸€å£°â€ï¼Œç„¶åå£°æ³¢ä¼ éå½“å‰å­ç½‘å„ä¸ªè§’è½ã€‚å…¶ä¸­çœŸå®çš„å°æ˜ä¹–ä¹–å›ç­”ï¼šâ€œæˆ‘åœ¨è¿™â€ã€‚</p>
<p><img src="/2022/06/11/uncatalog/cl49nvljx000elwr7fha73lvv/1.png" alt="image"></p>
<h3 id="PingæŠ¥æ–‡ä¸ARPç»“åˆ"><a href="#PingæŠ¥æ–‡ä¸ARPç»“åˆ" class="headerlink" title="PingæŠ¥æ–‡ä¸ARPç»“åˆ"></a>PingæŠ¥æ–‡ä¸ARPç»“åˆ</h3><p>å½“PingæŠ¥æ–‡æ‹¥æœ‰äº†ARPè¿™ä¸ªæ¢è·¯ç¥å™¨åï¼Œæƒ³è¦åˆ°è¾¾æœ€ç»ˆçš„ç›®çš„åœ°å°±ç›¸å½“çš„easyäº†ã€‚å½“ä»–å¤„äºä¸€ä¸ªç«™ç‚¹ï¼Œé¢å¯¹ä¸€ä¸ªæ–°çš„åœ°ç›˜çš„æ—¶å€™ï¼Œå…ˆå¼ä¸€å£°ARPå¤§æ‹›ï¼Œå°±çŸ¥é“ä¸€ä¸‹ç«™å‡ºå£åœ¨å“ªé‡Œäº†ã€‚ç„¶åç›´æ¥è·³åˆ°ä¸‹ä¸€ç«™ï¼Œæ¥ç€å†å¼ä¸€å£°ARPæ‰¾å‡ºä¸‹ä¸€ç«™ä½ç½®ï¼Œç»§ç»­è·³åˆ°ä¸‹ä¸€ç«™ã€‚è¿™æ ·é‡å¤Næ¬¡å°±åˆ°è¾¾äº†æœ€ç»ˆç›®çš„åœ°ã€‚</p>
<p><img src="/2022/06/11/uncatalog/cl49nvljx000elwr7fha73lvv/2.png" alt="image"></p>
<p>åŸºäºä¸Šé¢çš„é€»è¾‘å¯ä»¥çœ‹åˆ°ï¼Œåœ¨å®šä½ç½‘ç»œä¸é€šçš„æ—¶å€™ï¼Œä½¿ç”¨ä¸Šä¸€èŠ‚çš„æ–¹æ³•è¿˜æ‰¾ä¸å‡ºåŸå› çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥çœ‹çœ‹arpæŠ¥æ–‡æœ‰æ²¡æœ‰åˆ°ã€‚ä½†æ˜¯è¯·è®°ä½ï¼Œarpæ˜¯ä¸€æ®µå­ç½‘ä¸€æ®µå­ç½‘å®šä½çš„ã€‚</p>
<p>psï¼šä¸€èˆ¬ç½‘ç»œå®‰å…¨ç»„æ˜¯ä¸ä¼šç¦æ­¢arpåè®®çš„ï¼Œå› ä¸ºå®ƒæœ¬èº«æ˜¯ä¸ºäº†æŸ¥è¯¢macåœ°å€ï¼Œè€Œmacåœ°å€æ˜¯äºŒå±‚çš„ï¼Œæ˜¯ç½‘ç»œé€šä¿¡çš„åŸºç¡€ã€‚</p>
<h3 id="ARPæŠ¥æ–‡"><a href="#ARPæŠ¥æ–‡" class="headerlink" title="ARPæŠ¥æ–‡"></a>ARPæŠ¥æ–‡</h3><p>æŠ“ä¸ªarpæŠ¥æ–‡ä¸¾ä¾‹ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">tcpdump -i eth1 -n arp</span></span><br><span class="line"></span><br><span class="line">arp who-has 10.175.10.210 tell 10.175.10.78</span><br><span class="line"></span><br><span class="line">arp reply 10.175.10.210 is-at fa:16:3e:bf:1e:e2</span><br></pre></td></tr></table></figure></div>

<p>è¿™é‡ŒåŸºæœ¬å¯ä»¥çœ‹å‡ºæ¥ï¼ŒARPè¦åšçš„äº‹æƒ…å°±æ˜¯æŠŠIPç¿»è¯‘ä¸ºMACåœ°å€ã€‚å®é™…ä¸Šåœ¨ä»¥å¤ªç½‘ä¸­ï¼ŒåŒä¸€ä¸ªå±€åŸŸç½‘ä¸­çš„ä¸¤å°ä¸»æœºè¦è¿›è¡Œé€šä¿¡ï¼Œå¿…é¡»è¦çŸ¥é“ç›®æ ‡ä¸»æœºçš„MACåœ°å€ã€‚è€ŒTCP/IPåè®®ä¸­ï¼Œç½‘ç»œä¼ è¾“åªå…³å¿ƒIPåœ°å€ã€‚æ‰€ä»¥éœ€è¦æœ‰ä¸€ç§æ–¹æ³•å°†IPåœ°å€â€œç¿»è¯‘â€ä¸ºMACåœ°å€ã€‚è¿™ä¹Ÿå°±æ˜¯ARPè¦åšçš„äº‹æƒ…äº†ã€‚</p>
<h3 id="ARPè¡¨"><a href="#ARPè¡¨" class="headerlink" title="ARPè¡¨"></a>ARPè¡¨</h3><p>æ—¢ç„¶å·²ç»çŸ¥é“äº†IPä¸MACçš„å¯¹åº”å…³ç³»ï¼Œä¸ºäº†é¿å…æ¯æ¬¡æ‰¾è·¯éƒ½å¾—â€œç¿»è¯‘â€ä¸€æ¬¡ï¼Œé‚£å°±æŠŠå®ƒè®°ä¸‹æ¥ã€‚ä»¥åè¦ç”¨çš„æ—¶å€™ç›´æ¥æŸ¥æœ¬åœ°çš„å¯¹åº”è¡¨å°±è¡Œäº†ã€‚åŒæ—¶ä¸ºäº†ä¿è¯æœ‰æ•ˆæ€§ï¼Œç¼“å­˜çš„è®°å½•ä¼šåœ¨ä¸€å®šæ—¶é—´åå¤±æ•ˆã€‚è¿™å°±æ˜¯ARPè¡¨ã€‚</p>
<p>å½“ç„¶ï¼Œä¹Ÿå¯ä»¥è®¾ç½®é™æ€ARPè¡¨ã€‚åªæ˜¯ä¸€èˆ¬æˆ‘ä»¬æ‡’å¾—è¿™ä¹ˆåšã€‚</p>
<p>é€šè¿‡ä»¥ä¸‹å‘½ä»¤å¯ä»¥æŸ¥è¯¢å½“å‰ç¼“å­˜çš„arpè¡¨ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">arp -a</span></span><br></pre></td></tr></table></figure></div>

<p>psï¼šå®šä½é—®é¢˜ä¸€èˆ¬ä¸ä¼šç”¨åˆ°arpè¡¨ï¼Œåªéœ€è¦åœ¨ç›®çš„ç«¯æŠ“åŒ…çœ‹çœ‹arpæŠ¥æ–‡æœ‰æ²¡æœ‰åˆ°è¾¾å³å¯ã€‚</p>
]]></content>
      <tags>
        <tag>äº‘åŸç”ŸåŸºç¡€ç³»åˆ—</tag>
        <tag>Kubernetesç½‘ç»œ</tag>
      </tags>
  </entry>
  <entry>
    <title>Kubernetesç½‘ç»œç³»åˆ—ä¹‹(ä¸ƒ)Tcpdumpå¤§æ€å™¨æŠ“åŒ…</title>
    <url>/2022/06/11/uncatalog/cl49qvoa2000hlwr7bjyn3m3x/</url>
    <content><![CDATA[<hr>
<span id="more"></span>



<hr>
<blockquote>
<p>å‰é¢ç« èŠ‚çš„ç½‘ç»œåè®®æ ˆç›¸å…³çš„ä¿¡æ¯å»ºè®®å¤§å®¶å¤šå­¦ä¹ ä¸€éï¼Œå› ä¸ºè¿™äº›éƒ½æ˜¯æœ€åŸºç¡€çš„ä¸œè¥¿ï¼Œæƒ³ç©å¥½äº‘ç½‘ç»œå¿…å¤‡åŸºæœ¬åŠŸã€‚ã€‚</p>
</blockquote>
<h3 id="ä¸Šå¸è§†è§’"><a href="#ä¸Šå¸è§†è§’" class="headerlink" title="ä¸Šå¸è§†è§’"></a>ä¸Šå¸è§†è§’</h3><p>ä¹‹å‰æåˆ°è¿‡å®šä½é—®é¢˜å¯ä»¥å¼€å¯ä¸Šå¸è§†è§’ï¼Œé‚£ä¹ˆå¦‚ä½•å¼€å¯å°±è¦ä¾é tcpdumpè¿™ä¸ªå·¥å…·äº†ã€‚è¿™ä¸ªå·¥å…·å¯ä»¥å®æ—¶çœ‹åˆ°ä¸€å°ä¸»æœºçš„ç½‘å¡ä¸Šé¢çš„æ”¶åˆ°æˆ–è€…å‘é€å‡ºå»çš„æŠ¥æ–‡ä¿¡æ¯ã€‚ç®€å•çš„è¯´å°±æ˜¯æŠ“åŒ…ã€‚</p>
<p>æˆ‘ä»¬å¯¹ç½‘å¡è¿›è¡ŒæŠ“åŒ…çš„æ—¶å€™ï¼Œä¼šä½¿å¾—ç½‘å¡è¿›å…¥â€œæ··æ‚æ¨¡å¼â€ï¼Œæ‰€è°“æ··æ‚æ¨¡å¼å°±æ˜¯è®©ç½‘å¡æ¥æ”¶æ‰€æœ‰åˆ°è¾¾ç½‘å¡çš„æŠ¥æ–‡ï¼Œå› ä¸ºé»˜è®¤æƒ…å†µä¸‹ï¼Œä¸æ˜¯ç»™è‡ªå·±çš„æŠ¥æ–‡ç½‘å¡æ˜¯ä¸è¦çš„ï¼Œè¦ä¹ˆä¸¢å¼ƒè¦ä¹ˆè½¬å‘ï¼Œåæ­£ä¸è¯»å–å†…å®¹ï¼Œè€Œè¿›å…¥æ··æ‚æ¨¡å¼åï¼Œå°±å¯ä»¥çœ‹ä¸€çœ¼æŠ¥æ–‡å†…å®¹äº†ã€‚</p>
<p><img src="/2022/06/11/uncatalog/cl49qvoa2000hlwr7bjyn3m3x/1.png" alt="image"></p>
<p>ä½¿ç”¨tcpdumpå‘½ä»¤å¯ä»¥ä½¿ç½‘å¡è‡ªåŠ¨è¿›å…¥æ··æ‚æ¨¡å¼ï¼Œè¿™ä¸€ç‚¹å¯ä»¥ä»dmesgç³»ç»Ÿæ—¥å¿—ä¸­çœ‹åˆ°ï¼š</p>
<p>[311135.760098] device eth0 entered promiscuous mode<br>[311142.852087] device eth0 left promiscuous mode</p>
<p>äºŒã€tcpdumpå‘½ä»¤</p>
<p>ç”±äºtcpdumpæ˜¯æŠŠç»è¿‡ç½‘å¡çš„æŠ¥æ–‡å…¨éƒ¨éƒ½æŠ“å‡ºæ¥ï¼Œæ‰€ä»¥æ•°é‡æ˜¯éå¸¸å¤§çš„ï¼Œå„ç§ä¹±ä¸ƒå…«ç³Ÿçš„æŠ¥æ–‡éƒ½æœ‰ï¼Œæ˜¯æ²¡åŠæ³•å®šä½é—®é¢˜çš„ï¼Œæ‰€ä»¥tcpdumpä¸€å®šè¦é…åˆè¿‡æ»¤æ¡ä»¶ä½¿ç”¨ã€‚è¿™é‡Œåªè®²å¹³æ—¶ç”¨å¾—åˆ°çš„å‡ ä¸ªå…³é”®å‚æ•°ï¼Œå†è¯¦ç»†çš„è‡ªå·±è°·æ­Œç™¾åº¦ï¼Œåæ­£æˆ‘ä¸€èˆ¬æƒ…å†µä¸‹ç”¨ç”¨æ˜¯å¤Ÿäº†çš„ã€‚</p>
<ol>
<li>-n å‚æ•°</li>
</ol>
<p>è¿™ä¸ªæˆ‘ä¸€èˆ¬éƒ½ä¼šåŠ ä¸Šï¼Œä»¥å‰çš„æ–‡ç« ä¸­æè¿‡ï¼Œ-nè¡¨ç¤ºä¸è¦åšDNSç¿»è¯‘ï¼Œç›´æ¥æ˜¾ç¤ºIPï¼Œä¸è¦æ˜¾ç¤ºä¸ºhost nameã€‚ï¼ˆå½±å“æ€§èƒ½ï¼Œæœ‰æ—¶å€™æŒ‰ä¸ªctr+céƒ½åœä¸ä¸‹æ¥ï¼‰</p>
<p>ç”¨æ³•ï¼štcpdump -n</p>
<ol start="2">
<li>-i å‚æ•°</li>
</ol>
<p>-i å‚æ•°ç”¨äºæŒ‡å®šéœ€è¦æŠ“åŒ…çš„ç½‘å¡ï¼Œä¸€èˆ¬éƒ½ä¼šå¸¦ä¸Šã€‚</p>
<p>ç”¨æ³•ï¼š tcpdump -n -i eth0</p>
<ol start="3">
<li>æŒ‡å®šåè®®</li>
</ol>
<p>æŒ‡å®šåè®®æŠ“åŒ…æ¯”è¾ƒç®€å•ï¼Œç›´æ¥è¦æ±‚tcpdumpåªæŠ“å–æŒ‡å®šåè®®çš„æŠ¥æ–‡ã€‚å¯ä»¥æŒ‡å®šçš„åè®®ä¸€èˆ¬æœ‰ï¼šarp / icmp / tcp</p>
<p>ç”¨æ³•ï¼štcpdump -n -i eth0 arp</p>
<ol start="4">
<li>host å…³é”®å­—</li>
</ol>
<p>hostå…³é”®å­—ç”¨æ¥æŒ‡å®šåªæŠ“å–å¯¹åº”IPçš„æŠ¥æ–‡ï¼Œè¡¨ç¤ºæºåœ°å€ï¼Œæˆ–è€…ç›®çš„åœ°å€ã€‚è¯­æ³•ä¸º host+ç©ºæ ¼+IPåœ°å€ã€‚</p>
<p>ï¼ˆpsï¼šå¯ä»¥ç”¨srcæˆ–è€…dstä»£æ›¿hostå…³é”®å­—ï¼ŒåªæŠ“å•è¾¹çš„æŠ¥æ–‡ï¼‰</p>
<p>ç”¨æ³•ï¼štcpdump -n -i eth0 host 10.120.175.167</p>
<ol start="5">
<li>port å…³é”®å­—</li>
</ol>
<p>portå…³é”®å­—ç”¨æ¥æŒ‡å®šåªæŠ“å–å¯¹åº”Portç«¯å£çš„æŠ¥æ–‡ï¼Œè¡¨ç¤ºæºç«¯å£ï¼Œæˆ–è€…ç›®çš„ç«¯å£ã€‚è¯­æ³•ä¸º port+ç©ºæ ¼+ç«¯å£å·</p>
<p>ç”¨æ³•ï¼štcpdump -n -i eth0 port 53</p>
<ol start="6">
<li>æ¡ä»¶ç»„åˆ and / or</li>
</ol>
<p>å¦‚æœåªæŒ‡å®šä¸€ä¸ªæ¡ä»¶è¿›è¡ŒæŠ“åŒ…ï¼Œæœ‰æ—¶å€™æŠ“åˆ°çš„æŠ¥æ–‡æ•°é‡è¿˜æ˜¯å¤ªå¤šï¼Œé‚£å°±éœ€è¦è¿›è¡Œå¤šä¸ªæ¡ä»¶ç»„åˆã€‚æ¡ä»¶ä¹‹é—´é€šè¿‡andè¿æ¥ã€‚</p>
<p>ç”¨æ³•ï¼štcpdump -n -i docker0 tcp and host 172.17.0.1 and port 3306</p>
<ol start="7">
<li>-w å†™å…¥æ–‡ä»¶</li>
</ol>
<p>-w è¡¨ç¤ºå°†æŠ“åˆ°çš„æŠ¥æ–‡ä¿¡æ¯å†™å…¥åˆ°æŒ‡å®šçš„pcapæ–‡ä»¶ã€‚ç„¶åæŠŠpcapæ–‡ä»¶æ‹·è´åˆ°è‡ªå·±ç”µè„‘ä¸Šé¢ç”¨Wiresharkè½¯ä»¶æ‰“å¼€åˆ†æè¯¦æƒ…ã€‚è¿™é‡Œä¸å¾—ä¸è¯´ä¸€ä¸‹ï¼ŒWiresharkä¹Ÿæ˜¯ä¸€ä¸ªç¥å™¨ã€‚</p>
<p>ç”¨æ³•ï¼štcpdump -n -i docker0 tcp and host 172.17.0.1 and port 3306 -w mypkg.pcap</p>
<ol start="8">
<li>å…¶ä»–æ¡ä»¶</li>
</ol>
<p>éªšå¹´ï¼Œä¸Šé¢è¿™å‡ ä¸ªè®°ä½äº†ï¼Œè¡Œèµ°æ±Ÿæ¹–åº”è¯¥ä¸æˆé—®é¢˜äº†ã€‚å…¶ä»–é«˜æ·±çš„è¯­æ³•ï¼Œéœ€è¦çš„æ—¶å€™å†google/baiduä¹Ÿä¸è¿Ÿã€‚</p>
]]></content>
      <tags>
        <tag>äº‘åŸç”ŸåŸºç¡€ç³»åˆ—</tag>
        <tag>Kubernetesç½‘ç»œ</tag>
      </tags>
  </entry>
  <entry>
    <title>Kubernetesç½‘ç»œç³»åˆ—ä¹‹(å…«)iptables-filterè¿‡æ»¤åŠŸèƒ½</title>
    <url>/2022/06/11/uncatalog/cl49qytpu000klwr7el00gnwf/</url>
    <content><![CDATA[<hr>
<span id="more"></span>



<hr>
<blockquote>
<p>å‰é¢çš„å„ç§åè®®å·²ç»å¯ä»¥æŠŠåŸºæœ¬å¯ç”¨çš„ç‰©ç†ç½‘ç»œä¸–ç•Œç»™å½¢æˆäº†ï¼Œåœ¨æ­£å¸¸æƒ…å†µä¸‹ï¼Œå®ƒå¯ä»¥ç©çš„å¾ˆæºœã€‚æ¯”å¦‚ç»„ä¸ªå±€åŸŸç½‘åŠå…¬ï¼Œæˆ–è€…æ‰“ä¸ªè”æœºé­”å…½äº‰éœ¸ï¼Œéƒ½æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ã€‚</p>
</blockquote>
<h3 id="èƒŒæ™¯ä»‹ç»"><a href="#èƒŒæ™¯ä»‹ç»" class="headerlink" title="èƒŒæ™¯ä»‹ç»"></a>èƒŒæ™¯ä»‹ç»</h3><p>å‰é¢çš„å„ç§åè®®å·²ç»å¯ä»¥æŠŠåŸºæœ¬å¯ç”¨çš„ç‰©ç†ç½‘ç»œä¸–ç•Œç»™å½¢æˆäº†ï¼Œåœ¨æ­£å¸¸æƒ…å†µä¸‹ï¼Œå®ƒå¯ä»¥ç©çš„å¾ˆæºœã€‚æ¯”å¦‚ç»„ä¸ªå±€åŸŸç½‘åŠå…¬ï¼Œæˆ–è€…æ‰“ä¸ªè”æœºé­”å…½äº‰éœ¸ï¼Œéƒ½æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ã€‚</p>
<p>å¯æ˜¯ï¼Œç½‘ç»œä¸–ç•Œä¸­æ€»æ˜¯ä¼šæœ‰é‚ª æ¶çš„â€œäººâ€å‡ºç°ï¼Œå®ƒå°±ä¸æŒ‰ç…§å¤§å®¶çº¦å®šå¥½çš„è§„åˆ™æ¥å‘é€æŠ¥æ–‡ã€‚æ¯”å¦‚æ‰«ææ•´ä¸ªç½‘ç»œä¸­çš„å¼€æ”¾ç«¯å£ï¼Œæ‰’å–å„ç§å¯èƒ½çš„ç½‘é¡µ/ç½‘ç»œä¿¡æ¯ï¼Œå‘é€å¤§é‡æŠ¥æ–‡è¿›è¡Œå†²å‡»ã€‚ä»…ä»…ä¾é å•çº¯è€Œç¾å¥½çš„åè®®ä¸–ç•Œæ— æ³•é˜»æ­¢è¿™ç§ä¸æŒ‰çº¦å®šè€Œæ¥çš„è¡Œä¸ºã€‚</p>
<p>è¿˜è®°å¾—æˆ‘ä»¬æœ€å¼€å§‹çš„ç½‘ç»œæ¦‚å¿µä¹ˆï¼Ÿ</p>
<p><img src="/2022/06/11/uncatalog/cl49qytpu000klwr7el00gnwf/1.png" alt="image"></p>
<p>ç†æƒ³å•çº¯è€Œç¾å¥½ï¼Œå¯æ˜¯â€œé‚ª æ¶â€çš„æŠ¥æ–‡å¦‚å…¥æ— äººä¹‹å¢ƒã€‚æ— å¥ˆè¯šå®çš„äººä¸ºäº†å¯¹ä»˜æ¶åŠ¿åŠ›ä¹Ÿå¾—æ­¦è£…è‡ªå·±ï¼Œåœ¨å¤§é—¨çš„å…¥å£è£…èµ·äº†å¤§é‡çš„æœºå…³ï¼Œç”¨æ¥æŠµæŠ—é‚£äº›éæ³•çš„åæŠ¥æ–‡ã€‚</p>
<p><img src="/2022/06/11/uncatalog/cl49qytpu000klwr7el00gnwf/2.png" alt="image"></p>
<p>çœ‹ä¸Šå»è¿™æ˜¯ä¸€ç§ä¸é”™çš„æ–¹å¼ï¼Œå®ˆä½å¤§é—¨æ€»èƒ½é˜²ä½æ— ç†çš„çª¥æ¢ã€‚è¿™é‡Œè¿™ä¸ªâ€œå¤æ‚çš„æœºå…³é˜µâ€æœ‰ä¸ªä¸é”™çš„åå­—ï¼Œå«åšiptablesï¼Œè¿™ä¹Ÿå°±æ˜¯å®ƒç”±æ¥çš„åŸå› ï¼Œæ©ï¼Œå¦‚æœä¸æ˜¯å› ä¸ºæ—¶é—´å…³ç³»ï¼Œæˆ‘è¿˜èƒ½ç»§ç»­æ°ä¸‹å»ã€‚ã€‚ã€‚ :-)</p>
<h3 id="iptablesè¡¨"><a href="#iptablesè¡¨" class="headerlink" title="iptablesè¡¨"></a>iptablesè¡¨</h3><p>æ—¢ç„¶è¦è®¾è®¡ä¸€å¥—å…«å¦é˜µï¼Œé‚£å¿…é¡»çœ‹ä¸Šå»ååˆ†ç‰›é€¼æ‰è¡Œã€‚å…ˆç«‹å‡ é“å±éšœå†è¯´ï¼Œæ¯ä¸€ä¸ªæŠ¥æ–‡è¦æƒ³è¿›æ¥å¿…é¡»è¦ç»è¿‡è¿™äº›å±éšœçš„ä¸¥æ ¼ç­›é€‰ï¼Œæ‰èƒ½æˆä¸ºçœŸæ­£çš„ç¥é€‰ä¹‹æŠ¥æ–‡ã€‚ç±»ä¼¼è¿™æ ·ï¼š</p>
<p><img src="/2022/06/11/uncatalog/cl49qytpu000klwr7el00gnwf/3.png" alt="image"></p>
<p>è¿™æ ·çš„å±éšœå¼è®¾è®¡ï¼Œå°±æœ‰äº†åŸå‹ã€‚</p>
<p>ç„¶ååœ¨æ¯ä¸€é“å±éšœä¸Šé¢å†è®¾è®¡å¾ˆå¤šçš„è§„åˆ™é“¾ï¼ŒæŠ¥æ–‡å¿…é¡»ç»è¿‡è¿™äº›è§„åˆ™é“¾çš„å±‚å±‚æ£€æŸ¥ï¼Œæœ‰å¤šä¸¥æ ¼å‘¢ï¼Ÿè‡³å°‘è¦æ¯”G20è¿›åœ°é“ç«™è¿˜ä¸¥å§ã€‚ç„¶åæ¯ä¸€æ¡è§„åˆ™é“¾åˆç”±å¤šä¸ªè§„åˆ™ä¸²èµ·æ¥ã€‚</p>
<p><img src="/2022/06/11/uncatalog/cl49qytpu000klwr7el00gnwf/4.png" alt="image"></p>
<p>èƒ½ç»è¿‡è¿™æ ·å­çš„äº”è¡Œå…«å¦é˜µçš„æŠ¥æ–‡ï¼Œé‚£ä¹ˆå’±å°±å‹‰å¼ºè®¤ä¸ºæ˜¯è‰¯æ°‘äº†ï¼Œå¯ä»¥è¢«ä¸»æœºä¸Šçš„ç¨‹åºæ¥å—ã€‚</p>
<p>ï¼ˆå½“ç„¶äº†ï¼Œæƒ³è¦å‡ºå»çš„æŠ¥æ–‡ä¹Ÿä¸€æ ·è¦ç»è¿‡ä¸¥æ ¼æ§åˆ¶ï¼Œä¸‡ä¸€åäººå·²ç»è·‘åˆ°äº†å†…éƒ¨ï¼Œæ˜¯å§ï¼‰</p>
<h3 id="è¡¨å’Œè§„åˆ™é“¾"><a href="#è¡¨å’Œè§„åˆ™é“¾" class="headerlink" title="è¡¨å’Œè§„åˆ™é“¾"></a>è¡¨å’Œè§„åˆ™é“¾</h3><p>iptablesä¸€å…±æœ‰å››å¼ è¡¨(å±éšœ)ï¼Œä½†æ˜¯ä¸€èˆ¬åªä¼šç”¨åˆ°ä¸¤ä¸ªï¼Œå°±æ˜¯ï¼šè¿‡æ»¤è¡¨-filterï¼Œæ”¹åœ°å€è¡¨-natã€‚è¿™ä¸¤ä¸ªè®°ä½å°±è¡Œäº†ã€‚</p>
<p>iptablesä¸€å…±æœ‰äº”æ¡åŸºæœ¬çš„è§„åˆ™é“¾ï¼š æ¥æ”¶é¢„å¤„ç†-preroutingï¼Œæ¥æ”¶-inputï¼Œè½¬å‘-forwardï¼Œå‘é€-outputï¼Œå‡ºå£åå¤„ç†-postroutingã€‚è®°ä½åå­—å°±è¡Œã€‚</p>
<p>è¿™äº›è¡¨å’Œè¿™äº›é“¾çš„ç»„åˆï¼Œå¹¶ä¸æ˜¯æ¯å¼ è¡¨é‡Œé¢éƒ½æœ‰5æ¡é“¾çš„ã€‚æœ‰äº›è§„åˆ™é“¾åªå­˜åœ¨ç‰¹å®šçš„è¡¨ä¸­ã€‚</p>
<p>ç”±äºè®¾è®¡è€…å¯èƒ½æ¯”è¾ƒå–œæ¬¢çˆ±é©¬ä»•çš„å…³ç³»ï¼Œä»–è®¾è®¡çš„ç»„åˆæ–¹å¼å°±æ˜¯ä¸€ä¸ªå¤§å†™çš„å­—æ¯Hã€‚æ‰€ä»¥å€’ä¹Ÿæ¯”è¾ƒå¥½è®°ï¼Œå‡ºå»&amp;è¿›æ¥ä¸€å…±4ä¸ªè§’ï¼Œä¸­é—´ä¸€ä¸ªè½¬å‘å°æ¨ªæ ã€‚å¦‚ä¸‹ã€‚</p>
<p><img src="/2022/06/11/uncatalog/cl49qytpu000klwr7el00gnwf/5.png" alt="image"></p>
<p>å…³äºåœ¨ç»è¿‡â€œæ¥æ”¶é¢„å¤„ç†-preroutingâ€ç¯èŠ‚åï¼Œæ˜¯è¿›å…¥forwardï¼Œè¿˜æ˜¯è¿›å…¥inputï¼Œè¿™ä¸ªé—®é¢˜ã€‚ä¸Šä¸€ç« èŠ‚å…¶å®æåˆ°è¿‡ã€‚ä¸–ç•Œä¸Šæœ‰ä¸¤ç§æŠ¥æ–‡ï¼Œå‘ç»™æˆ‘çš„ï¼Œå’Œä¸æ˜¯å‘ç»™æˆ‘çš„ã€‚ï¼ˆåˆ¤æ–­æ˜¯ä¸æ˜¯è‡ªå·±çš„æŠ¥æ–‡ï¼Œå°±çœ‹ç›®çš„åœ°å€æ˜¯ä¸æ˜¯æœ¬æœºçš„å°±è¡Œï¼‰ã€‚å¦‚æœä¸æ˜¯ç»™æˆ‘çš„ï¼Œé‚£å°±å¸®å¿™è½¬å‘ï¼Œèµ°forwardã€‚æ˜¯ç»™è‡ªå·±çš„ï¼Œé‚£å°±èµ°inputã€‚</p>
<h3 id="è§„åˆ™é“¾"><a href="#è§„åˆ™é“¾" class="headerlink" title="è§„åˆ™é“¾"></a>è§„åˆ™é“¾</h3><p>ç”¨æˆ·å¯ä»¥åœ¨ä¸€å¼ è¡¨ä¸­ä»»æ„å¢åŠ è§„åˆ™é“¾ï¼Œè§„åˆ™é“¾ä¸Šé¢çš„æŸä¸ªè§„åˆ™å¦‚æœå‘½ä¸­ï¼Œé‚£ä¹ˆå¯ä»¥è¦æ±‚å‘½ä¸­çš„æŠ¥æ–‡è¿›å…¥åˆ°å¦å¤–çš„è§„åˆ™é“¾ä¸­ç»§ç»­å¤„ç†ã€‚åŸºæœ¬é•¿è¿™ä¸ªæ ·å­ï¼š</p>
<p><img src="/2022/06/11/uncatalog/cl49qytpu000klwr7el00gnwf/6.png" alt="image"></p>
<p>åŸºæœ¬å¥—è·¯å¦‚ä¸‹ï¼šæ¡ä»¶ + å‘½ä¸­ + åŠ¨ä½œï¼Œ åŠ¨ä½œä¹Ÿå°±æ˜¯é‚£ä¹ˆå‡ ä¸ªï¼š</p>
<p>ï¼ˆæ³¨æ„ï¼šä¸€æ—¦æ‰§è¡Œå®Œè§„åˆ™çš„åŠ¨ä½œï¼Œå°±ç»“æŸæ•´ä¸ªè§„åˆ™é“¾çš„åŒ¹é…ï¼Œä¸ç»§ç»­å¾€ä¸‹åŒ¹é…å…¶ä»–è§„åˆ™äº†ã€‚ï¼‰</p>
<ol>
<li><p>Acceptï¼šæ¥å—æŠ¥æ–‡</p>
</li>
<li><p>Dropï¼šä¸¢å¼ƒæŠ¥æ–‡</p>
</li>
<li><p>SNATï¼šæŠŠæŠ¥æ–‡çš„æºåœ°å€æ”¹æ‰ ï¼ˆéœ€è¦æŒ‡å®šæ”¹ä¸ºä»€ä¹ˆIPï¼‰</p>
</li>
<li><p>DNATï¼šæŠŠæŠ¥æ–‡çš„ç›®çš„åœ°å€æ”¹æ‰</p>
</li>
<li><p>Masqueradeï¼šé«˜çº§ç‰ˆçš„SNATï¼ŒæŠŠæŠ¥æ–‡çš„æºåœ°å€æ”¹æ‰ï¼Œæ”¹ä¸ºå‘é€ç½‘å¡çš„IPåœ°å€ï¼ˆè‡ªåŠ¨è¯†åˆ«æ”¹æˆä»€ä¹ˆIPï¼‰</p>
</li>
<li><p>Redirectï¼šé«˜çº§ç‰ˆçš„DNATï¼ŒæŠŠæŠ¥æ–‡çš„ç›®çš„åœ°å€æ”¹ä¸ºæ¥æ”¶ç½‘å¡çš„IPåœ°å€ã€‚åŒæ—¶å¯ä»¥ä¿®æ”¹ç›®çš„ç«¯å£ï¼ˆå…¶å®å°±æ˜¯é‡å®šå‘ç»™æœ¬æœºçš„æŸä¸ªç«¯å£ï¼‰</p>
</li>
<li><p>å…¶ä»–åå­—ï¼šé‚£å°±ä»£è¡¨è·³è½¬åˆ°å¦å¤–ä¸€æ¡è§„åˆ™é“¾ç»§ç»­åŒ¹é…ã€‚ã€‚ã€‚ï¼ˆè¿™é‡Œçš„åå­—å°±ç­‰äºæŒ‡å®šçš„ç›®æ ‡è§„åˆ™é“¾çš„åå­—ï¼‰</p>
</li>
</ol>
<p>å…¶ä»–é«˜çº§åŠ¨ä½œï¼Ÿ éªšå¹´ï¼Œå…¶ä»–åŠ¨ä½œè§£é”é ä½ è‡ªå·±å•¦ ï¼š-ï¼‰</p>
<h3 id="iptableså‘½ä»¤"><a href="#iptableså‘½ä»¤" class="headerlink" title="iptableså‘½ä»¤"></a>iptableså‘½ä»¤</h3><p>é¢ï¼Œè¯´äº†è¿™ä¹ˆä¹…ï¼Œè²Œä¼¼è¿˜æ²¡æåˆ°iptableså‘½ä»¤æ€ä¹ˆç”¨ã€‚ä¸€èˆ¬æƒ…å†µæœ‰ä¸¤ç§æ–¹å¼æŸ¥çœ‹å½“å‰çš„iptablesè§„åˆ™ï¼š</p>
<ol>
<li><h1 id="iptables-nL-ï¼ˆæˆ–è€…-iptables-t-nat-nLï¼‰"><a href="#iptables-nL-ï¼ˆæˆ–è€…-iptables-t-nat-nLï¼‰" class="headerlink" title="iptables -nL ï¼ˆæˆ–è€… # iptables -t nat -nLï¼‰"></a>iptables -nL ï¼ˆæˆ–è€… # iptables -t nat -nLï¼‰</h1></li>
</ol>
<p>åˆ—å‡ºå½“å‰è¡¨çš„æ‰€æœ‰è§„åˆ™é“¾ã€‚</p>
<p>å…¶å®ä¸€ä¸ª-Lå‚æ•°å°±è¡Œï¼Œä½†æ˜¯è®°å¾—æˆ‘è¯´è¿‡ï¼Œç½‘ç»œç›¸å…³çš„å‘½ä»¤æœ€å¥½éƒ½åŠ ä¸€ä¸ªâ€œ-nâ€ä¹ˆï¼Ÿæ˜¯çš„ï¼Œ-nè®©å®ƒä¸ç”¨åšDNSç¿»è¯‘ï¼Œä¹Ÿå°±æ˜¯ä¸è¦æŠŠIPåœ°å€ç¿»è¯‘ä¸ºä¸»æœºåã€‚</p>
<p>-Lå‚æ•°ï¼š</p>
<p>åˆ—å‡ºå½“å‰è¡¨çš„æ‰€æœ‰è§„åˆ™é“¾ã€‚æ³¨æ„æ˜¯å¤§å†™çš„Lã€‚</p>
<p>-nå‚æ•°ï¼š</p>
<p>ä¸è¦æŠŠIPç¿»è¯‘ä¸ºä¸»æœºå</p>
<p>-tå‚æ•°ï¼š</p>
<p>æŒ‡å®šè¦æŸ¥çœ‹çš„è¡¨åã€‚ä¸æŒ‡å®šçš„è¯ï¼Œé»˜è®¤æŸ¥è¯¢filterè¡¨ã€‚</p>
<p>-vå‚æ•°ï¼š</p>
<p>å¦‚æœè¦å®šä½æŸ¥è¯¢è§„åˆ™å‘½ä¸­çš„æ¬¡æ•°ï¼Œå¯ä»¥åŠ ä¸ª-vå‚æ•°ï¼Œè¿™æ ·å­è¾“å…¥ï¼š</p>
<h1 id="iptables-nvL-ï¼ˆæˆ–è€…-iptables-t-nat-nvLï¼‰"><a href="#iptables-nvL-ï¼ˆæˆ–è€…-iptables-t-nat-nvLï¼‰" class="headerlink" title="iptables -nvL ï¼ˆæˆ–è€… # iptables -t nat -nvLï¼‰"></a>iptables -nvL ï¼ˆæˆ–è€… # iptables -t nat -nvLï¼‰</h1><p>ä¸€èˆ¬æŸ¥çœ‹å‘½ä¸­æ¬¡æ•°éƒ½è¦å…ˆæ¸…ç©ºè®¡æ•°ï¼Œç„¶åå†æŸ¥çœ‹ï¼Œæ‰€ä»¥æ¸…ç©ºè§„åˆ™å‘½ä¸­è®¡æ•°ä¹Ÿè¦å­¦ä¸€ä¸‹</p>
<p>-Zå‚æ•°ï¼š</p>
<p>å¯ä»¥ä½¿ç”¨-Zå‚æ•°æ¸…ç©ºå‘½ä¸­ç»Ÿè®¡æ¬¡æ•°ã€‚æ³¨æ„æ˜¯å¤§å†™çš„Zã€‚</p>
<h1 id="iptables-Z-ï¼ˆæˆ–è€…-iptables-t-nat-Zï¼‰"><a href="#iptables-Z-ï¼ˆæˆ–è€…-iptables-t-nat-Zï¼‰" class="headerlink" title="iptables -Z ï¼ˆæˆ–è€… # iptables -t nat -Zï¼‰"></a>iptables -Z ï¼ˆæˆ–è€… # iptables -t nat -Zï¼‰</h1><ol start="2">
<li><h1 id="iptables-S-ï¼ˆæˆ–è€…-iptables-t-nat-Sï¼‰"><a href="#iptables-S-ï¼ˆæˆ–è€…-iptables-t-nat-Sï¼‰" class="headerlink" title="iptables -S ï¼ˆæˆ–è€… # iptables -t nat -Sï¼‰"></a>iptables -S ï¼ˆæˆ–è€… # iptables -t nat -Sï¼‰</h1></li>
</ol>
<p>ä½¿ç”¨ç¼–è¾‘æ¨¡å¼æŸ¥è¯¢å½“å‰è¡¨ä¸­çš„è§„åˆ™ã€‚æ©ï¼Œä¹Ÿå°±æ˜¯çœ‹çœ‹å½“å‰è¡¨é‡Œé¢çš„è¿™äº›è§„åˆ™æ˜¯æ€ä¹ˆæ’ å…¥çš„ã€‚</p>
<p>åˆ—å‡ºæ¥çš„æ¯ä¸€è¡Œéƒ½æ˜¯ä¿®æ”¹iptablesçš„ä¸€æ¡è®°å½•ï¼Œè¿™ä¸ªåœ¨è¦ä¿®æ”¹iptablesè§„åˆ™çš„æ—¶å€™ç‰¹åˆ«æœ‰ç”¨ã€‚</p>
<p>å…·ä½“æ€ä¹ˆçœ‹æ˜¾ç¤ºçš„ç»“æœï¼Œä¸‹ä¸€èŠ‚çš„iptables natå†ç»†è¯´~</p>
]]></content>
      <tags>
        <tag>äº‘åŸç”ŸåŸºç¡€ç³»åˆ—</tag>
        <tag>Kubernetesç½‘ç»œ</tag>
      </tags>
  </entry>
  <entry>
    <title>Kubernetesç½‘ç»œç³»åˆ—ä¹‹(ä¹)ç½‘ç»œéª—å­</title>
    <url>/2022/06/11/uncatalog/cl49r424d000nlwr732iq6tli/</url>
    <content><![CDATA[<hr>
<span id="more"></span>



<hr>
<blockquote>
<p>å› ä¸ºæ¥ä¸‹æ¥çš„ç½‘ç»œä¸–ç•Œå˜å¾—ç•¥æ˜¾å¤æ‚ï¼Œä¸ºäº†è®©å¤§å®¶çœ‹æ‡‚å…¶ä¸­çš„é—¨é—¨é“é“ï¼Œä¸ºå¸ˆè¦æ•™å¤§å®¶ä¸€ç‚¹è¯†åˆ«å¸¸è§éª—å±€å°ä¼ä¿©ã€‚</p>
</blockquote>
<h3 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h3><p>å› ä¸ºæ¥ä¸‹æ¥çš„ç½‘ç»œä¸–ç•Œå˜å¾—ç•¥æ˜¾å¤æ‚ï¼Œä¸ºäº†è®©å¤§å®¶çœ‹æ‡‚å…¶ä¸­çš„é—¨é—¨é“é“ï¼Œä¸ºå¸ˆè¦æ•™å¤§å®¶ä¸€ç‚¹è¯†åˆ«å¸¸è§éª—å±€å°ä¼ä¿©ã€‚</p>
<h3 id="åŒç°§éª—å±€"><a href="#åŒç°§éª—å±€" class="headerlink" title="åŒç°§éª—å±€"></a>åŒç°§éª—å±€</h3><p>ä¸€èˆ¬å¤§å®¶èƒ½å¤Ÿè¾¾æˆå…±è¯†çš„æ˜¯ï¼šä½†å‡¡æ¯”è¾ƒç»å…¸çš„éª—å±€ï¼Œéƒ½æ˜¯ä»¥åŒç°§éª—å±€ä¸ºå¤šã€‚è¿™ç§éª—å±€ç‰¹åˆ«å®¹æ˜“è®©å—å®³è€…æ™•å¤´è½¬å‘ï¼Œè½»æ˜“åœ°ä¸Šäº†å¥—ã€‚å¤§æ¦‚ä½¿ç”¨å¦‚ä¸‹è¿™ç§å¥—è·¯ï¼š</p>
<p><img src="/2022/06/11/uncatalog/cl49r424d000nlwr732iq6tli/1.png" alt="image"></p>
<p>é¦–å…ˆä½ é‡åˆ°äº†ä¸€ä¸ªçœ‹ç€æŒºå’Œè”¼çš„æ™®é€šäººï¼ˆè¿™ä¸ªäººå¯èƒ½æ˜¯åˆšè®¤è¯†çš„ï¼Œä¹Ÿå¯èƒ½æ˜¯è®¤è¯†å¾ˆä¹…ä½†ä¹Ÿä»…é™å¹³æ—¶ä¸šåŠ¡éœ€è¦ï¼Œå¹¶ä¸æ˜¯é‚£ä¹ˆçŸ¥æ ¹çŸ¥åº•ï¼Œæ­¤äººç®€ç§°å°ä¼™ä¼´ï¼‰ã€‚ç„¶åæœ‰ä¸€å¤©ä½ ä»¬ä¸€èµ·åŠç‚¹äº‹æƒ…ï¼Œè·¯ä¸Šé‡åˆ°äº†å¦å¤–ä¸€ä¸ªäººï¼ˆæ­¤äººç®€ç§°ç¬¬ä¸‰è€…ï¼‰ï¼š</p>
<p><img src="/2022/06/11/uncatalog/cl49r424d000nlwr732iq6tli/2.png" alt="image"></p>
<p>æ•…äº‹æœ‰å¯èƒ½æ˜¯è¿™ä¸ªç¬¬ä¸‰è€…ä¸»åŠ¨æ¥æ­è®ªï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸€å¼€å§‹çš„å°ä¼™ä¼´æ•…æ„å¸¦é¢†ï¼Œä½†ä¸ç®¡æ€æ ·ï¼Œä½ å·²ç»æŠŠä½ è‡ªå·±å’Œä¸€å¼€å§‹çš„å°ä¼™ä¼´å½“åšæ˜¯ä¸€ä¸ªå›¢ä½“çš„äº†ã€‚</p>
<p>è¿™æ—¶å€™å¦‚æœç¬¬ä¸‰è€…æå‡ºéœ€æ±‚ï¼Œå¹¶ä¸”å°ä¼™ä¼´æ¥å—äº†è¿™ä¸ªéœ€æ±‚ï¼Œä½†æ˜¯èƒ½åŠ›åˆæ°å¥½è¿˜å·®ä¸€ç‚¹ç‚¹ã€‚è¿™æ—¶ä½ å°±ä¼šå¾ˆè‹±å‹‡çš„ç«™å‡ºæ¥å¸®åŠ©ä½ çš„å°ä¼™ä¼´äº†ã€‚å› ä¸ºä½ å¾ˆåšä¿¡å°ä¼™ä¼´è·Ÿä½ æ˜¯ä¸€ä¼™çš„ï¼Œä¼šå¿«é€Ÿè¿˜ä½ è¿™ä¸€ä»½æ¬ æ¬¾ã€‚æ®Šä¸çŸ¥ï¼Œäººå®¶ä¸¤ä¸ªæ‰æ˜¯çœŸæ­£ä¸€ä¼™çš„ã€‚</p>
<h3 id="ç½‘ç»œéª—å­"><a href="#ç½‘ç»œéª—å­" class="headerlink" title="ç½‘ç»œéª—å­"></a>ç½‘ç»œéª—å­</h3><p>äº‘ç½‘ç»œä¸–ç•Œï¼Œæœ‰å¾ˆå¤šè¿™æ ·çš„éª—å±€ï¼Œæˆ‘ä»¬ç¨‹åºæ‰€å‘å‡ºçš„æŠ¥æ–‡ï¼Œå°±æ˜¯è¿™äº›åŒç°§éª—å±€çš„ç›®æ ‡ã€‚å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬æ‰¾ä¸€ä¸ªç»å…¸ç½‘ç»œéª—å±€æ‰’å¼€æ¥çœ‹ä¸€çœ‹ï¼š</p>
<p><img src="/2022/06/11/uncatalog/cl49r424d000nlwr732iq6tli/3.png" alt="image"></p>
<p>åœ¨äº‘ä¸Šï¼Œä½ è¦å‘é€æŠ¥æ–‡åˆ°ç›®æ ‡ç¨‹åºã€‚é¦–å…ˆåœ¨æŠ¥æ–‡å‡ºé—¨å‰ï¼Œä½ å’¨è¯¢äº†ä¸€ä¸‹è€æœ‹å‹ï¼ˆéª—å­Aï¼‰ï¼Œä»–å‘Šè¯‰ä½ ï¼šå“¦ï¼Œä½ çš„ç›®çš„åœ°åœ¨xxxï¼Œä½ å¾ˆç›¸ä¿¡å®ƒï¼Œæ‰€ä»¥ä½ å°±æŠŠæŠ¥æ–‡å¾€xxxå‘å‡ºå»äº†ã€‚å¯æ˜¯æŠ¥æ–‡åˆšå‡ºé—¨ï¼Œå°±é‡åˆ°äº†éª—å­Bã€‚å“‡é ï¼Œåˆšå‡ºé—¨å°±é‡åˆ°éª—å­Bï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆå·§å‘¢ï¼Ÿé‚£æ˜¯å› ä¸ºä»–ä¸€ç›´åœ¨è¿™é‡Œç­‰ä½ å•Šã€‚ä½ å¿˜è®°å•¦ï¼Œä»–è·Ÿéª—å­Aæ˜¯ä¸€ä¼™çš„ï¼Œæ˜¯éª—å­Aæ•…æ„è®©ä½ æŠŠæŠ¥æ–‡å¾€ä»–è¿™é‡Œå‘çš„ã€‚æ‰€ä»¥ä½ çš„æŠ¥æ–‡å°±è¢«éª—å­Béšä¾¿å®°å‰²å•¦ï¼Œå‘å¾€å®ƒæ‰€æ“æ§çš„ä»»æ„åœ°æ–¹ã€‚</p>
<pre><code>è¿™ä¸ªéª—å±€ä¸­æœ‰ä¸€ä¸ªé‡ç‚¹å¯ä»¥å†å›é¡¾ä¸€ä¸‹ï¼Œä¸ç®¡ç¬¬ä¸€ä¸ªéª—å­è·Ÿä½ è¯´äº†ç›®çš„åœ°æ˜¯ä»€ä¹ˆï¼Œä½ çš„æŠ¥æ–‡éƒ½ä¼šè·‘åˆ°ç¬¬äºŒä¸ªéª—å­é‚£é‡Œã€‚æ¯”å¦‚ï¼š
</code></pre>
<p>â€œå“¦ï¼Œä½ çš„ç›®çš„åœ°åœ¨xxxâ€ã€‚ä½ çš„æŠ¥æ–‡è·‘åˆ°äº†ç¬¬äºŒä¸ªéª—å­é‚£é‡Œã€‚</p>
<p>â€œä½ è¿™ä¸ªç›®çš„åœ°è·Ÿå…¶ä»–äººä¸ä¸€æ ·ï¼Œæ˜¯åœ¨yyyâ€ã€‚ä½ çš„æŠ¥æ–‡è¿˜æ˜¯è·‘åˆ°äº†ç¬¬äºŒä¸ªéª—å­é‚£é‡Œã€‚</p>
<p>â€œè¿™ä¸ªå‘¢ï¼Œæ˜¯åœ¨zzzâ€ã€‚è¿˜æ˜¯åˆ°ç¬¬äºŒä¸ªéª—å­é‚£é‡Œã€‚</p>
<p>å”¯ä¸€çš„åŒºåˆ«å°±æ˜¯ç¬¬äºŒä¸ªéª—å­ï¼ŒçŸ¥é“ä½ æ˜¯å› ä¸ºä»€ä¹ˆåŸå› å—éª—çš„ã€‚</p>
<p>çœ‹åˆ°è¿™é‡Œï¼Œä½ ä¼¼ä¹å¯ä»¥æ˜ç™½ï¼Œåœ¨äº‘ä¸Šï¼Œç½‘ç»œæ§åˆ¶åšå¾—å¥½ï¼ŒåŒç°§å¿…é¡»æ¼”å¾—å¥½ã€‚</p>
<h3 id="éª—å­èº«ä»½"><a href="#éª—å­èº«ä»½" class="headerlink" title="éª—å­èº«ä»½"></a>éª—å­èº«ä»½</h3><p>é‚£å¥½å¥‡çš„äººä¼šé—®ï¼Œä¸¤ä¸ªéª—å­å…·ä½“åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå…¸å‹åŒç°§ç»„åˆ DNS + Load Balancer</p>
<p><img src="/2022/06/11/uncatalog/cl49r424d000nlwr732iq6tli/4.png" alt="image"></p>
<p>äº‘ä¸Šé¢å¯¹æ–¹ç¨‹åºå¯èƒ½æœ‰å¤šä¸ªå®ä¾‹ï¼Œå¹¶ä¸”å®ä¾‹æ•°é‡å¯èƒ½è¿˜éšæ—¶é—´å˜åŒ–ï¼ˆæ¯”å¦‚é…æœ‰è‡ªåŠ¨æ‰©å®¹ç­–ç•¥ï¼‰ï¼Œæ‰€ä»¥è®¿é—®ä¸å¯èƒ½ä½¿ç”¨ä¼ ç»ŸIPçš„æ–¹å¼ã€‚æ‰€ä»¥äº‘æä¾›è€…ä¸€èˆ¬éƒ½è¯´ï¼šè¯·ä½¿ç”¨å¯¹æ–¹åå­—è®¿é—®ï¼Œç”¨å¯¹æ–¹åå­—å°±å¯ä»¥é€šã€‚</p>
<pre><code>æ³¨æ„äº†ï¼Œä¸€æ—¦è¯´åˆ°ä½¿ç”¨åå­—å°±å¯ä»¥äº’é€šï¼Œé‚£å°±è‚¯å®šè¦è¿›å…¥PaaSè®¾å®šå¥½çš„åŒç°§éª—å±€å•¦ã€‚æ›´æœ‰ç”šè€…ï¼Œç›´æ¥è·³è¿‡ç¬¬ä¸€ä¸ªéª—å±€ï¼Œç›´æ¥è¿›å…¥ç¬¬äºŒä¸ªéª—å±€ï¼ˆä½†æ˜¯æ€»çš„æ¥è¯´ï¼Œæ²¡æœ‰åŒç°§æ•ˆæœå¥½ï¼Œå¯¹å—å®³äººä¹Ÿä¸å¤Ÿäººæ€§åŒ–ï¼‰ã€‚
</code></pre>
<p>äº”ã€ä¸¾ä¾‹</p>
<p>Kubernetesé‡Œé¢çš„kube-proxyï¼Œå°±å¾ˆå¥½çš„åˆ©ç”¨äº†è¿™ä¸ªéª—å±€ï¼š</p>
<p><img src="/2022/06/11/uncatalog/cl49r424d000nlwr732iq6tli/5.png" alt="image"></p>
<p>æ‰€ä»¥åœ¨Kuberneteså¹³å°ä¸Šï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨Service Nameäº’ç›¸é€šä¿¡ã€‚å½“ä½ æ‹¿ç€ä¸€ä¸ªâ€œåå­—â€æ¢å›æ¥çš„ clusterIPï¼Œå…¶å®æ˜¯ä¸€ä¸ªæ ¹æœ¬ä¸å­˜åœ¨çš„IPï¼Œå®ƒçš„å”¯ä¸€ä½œç”¨æ˜¯å¼•é¢†ä½ å‰å¾€éª—å­Bå¤„ï¼ˆä¹Ÿå°±æ˜¯kube-proxyï¼‰ï¼Œæ‰€ä»¥clusterIPä¸€èˆ¬é€‰å†·é—¨çš„IPï¼Œä¸‡ä¸€è·ŸçœŸå®å­˜åœ¨çš„IPå†²çªäº†éª—å±€å°±å¾ˆå°´å°¬äº†ã€‚</p>
<p>è¯´åˆ°åº•ï¼Œäº‘ç½‘ç»œï¼Œæ»¡æ»¡çš„éƒ½æ˜¯å¥—è·¯å•Šã€‚</p>
]]></content>
      <tags>
        <tag>äº‘åŸç”ŸåŸºç¡€ç³»åˆ—</tag>
        <tag>Kubernetesç½‘ç»œ</tag>
      </tags>
  </entry>
  <entry>
    <title>Kubernetesç½‘ç»œç³»åˆ—ä¹‹(å)iptables-natç©¿è¶ŠåŠŸèƒ½</title>
    <url>/2022/06/11/uncatalog/cl49r8bkh000qlwr7dta2fv8f/</url>
    <content><![CDATA[<hr>
<span id="more"></span>



<hr>
<blockquote>
<p>çŸ¥é“â€œç½‘ç»œéª—å­â€æ˜¯ä¸€ç§å¥—è·¯ï¼Œé‚£ä¹ˆå®ƒå…·ä½“æ€ä¹ˆå®ç°è¿™ä¸ªå¥—è·¯çš„å‘¢ï¼Œæˆ‘ä»¬ç»†ç»†åˆ†æNATçš„å®ç°<br>æˆ‘ä»¬ä»æœ€ç®€å•çš„å¼€å§‹ï¼š</p>
</blockquote>
<ol>
<li>å¯åŠ¨ä¸€ä¸ªDockerå®¹å™¨ï¼Œå¸¦ä¸Šç«¯å£æ˜ å°„çš„-pé€‰é¡¹ã€‚ï¼ˆæ³¨ï¼š-pé€‰é¡¹ä¼šå¼€å¯ä¸€ä¸ªç«¯å£NATè§„åˆ™ï¼‰ã€‚<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">docker pull mysql</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">docker run -d -e MYSQL_ROOT_PASSWORD=root -p 3306:3306 mysql</span></span><br></pre></td></tr></table></figure></div></li>
</ol>
<p>åœ¨è¿™ä¸ªmysqlçš„æ•°æ®åº“å®¹å™¨å°±å¯åŠ¨å¥½ä¹‹åï¼Œå®ƒåœ¨ä¸»æœºä¸Šæ˜¯ç±»ä¼¼è¿™ä¸ªæ ·å­çš„ï¼š</p>
<p><img src="/2022/06/11/uncatalog/cl49r8bkh000qlwr7dta2fv8f/1.png" alt="image"></p>
<p>è¿™é‡Œï¼Œä½ å¯ä»¥æŠŠæœ¬æœºä¹Ÿçœ‹ä½œæ˜¯â€œå…¶ä»–Hostâ€ã€‚ï¼ˆå¤§æ¦‚æ„æ€å¯ä»¥è®¤ä¸ºï¼šå’±ä»¬ä¸»æœºçº§åˆ«çš„ï¼Œè·Ÿå®¹å™¨ä¸æ˜¯ä¸€ä¸ªå±‚æ¬¡çš„ï¼Œéœ€è¦åˆ†å¼€è€ƒè™‘ï¼‰ï¼Œè¿™é‡Œå¯ä»¥çœ‹åˆ°å®¹å™¨ä¸å¤–éƒ¨ä¸–ç•Œçš„äº¤äº’ä¸»è¦éœ€è¦æ˜¯ï¼šå¤–é¢è¦èƒ½é€šé‡Œé¢ï¼Œé‡Œé¢è¦èƒ½é€šå¤–é¢ã€‚</p>
<ol start="2">
<li>ç„¶åå’±ä»¬çœ‹çœ‹è¿™ä¸ªæœ€ç®€å•çš„ä¸€ä¸ªå®¹å™¨çš„NATå…·ä½“çš„è§„åˆ™æ˜¯æ€ä¹ˆè®¾ç½®çš„ï¼š</li>
</ol>
<p><img src="/2022/06/11/uncatalog/cl49r8bkh000qlwr7dta2fv8f/2.png" alt="image"><br>åˆ†æä¸Šå›¾ï¼š</p>
<p>æ­¥éª¤1ï¼šä¸ºäº†å®ç°å…¥å£ä¸å‡ºå£çš„æµé‡æ§åˆ¶ï¼Œæ‰“å¼€å…·ä½“çš„iptablesçœ‹çœ‹</p>
<p>æ­¥éª¤ 2 &amp; 3ï¼šDNAT=æ›¿æ¢ç›®çš„IPï¼Œä¸»æœºæ”¶åˆ°æŠ¥æ–‡ï¼ˆä¹Ÿå°±æ˜¯ä»å¤–éƒ¨æ”¶åˆ°æŠ¥æ–‡ï¼‰æ—¶ï¼ŒæŠŠç›®çš„IPæ¢æˆå¯¹åº”çš„å®¹å™¨çš„ï¼Œç„¶åè½¬å‘ç»™å¯¹åº”çš„å®¹å™¨é‡Œé¢å»ã€‚ï¼ˆå…¥å£æµé‡æ§åˆ¶ï¼‰</p>
<p>æ­¥éª¤4 &amp; 5ï¼š MASQUERADE=æ›¿æ¢æºåœ°å€ï¼Œä¸»æœºå¾€å¤–å‘æŠ¥æ–‡æ—¶ï¼ŒæŠŠåŸå§‹æ˜¯å®¹å™¨çš„æºIPï¼Œæ¢æˆæºåœ°å€ä¸ºä¸»æœºçš„ã€‚</p>
<ol start="3">
<li>æ•´ä¸ªæ•ˆæœå°±æ˜¯â€œå…¶ä»–Hostâ€çœ‹åˆ°çš„æŠ¥æ–‡å°±æ˜¯æ¥è‡ªäºå¦å¤–ä¸€å°ä¸»æœºï¼Œæ„Ÿè§‰è‡ªå·±åªæ˜¯ä¸å¦å¤–ä¸€å°ä¸»æœºåœ¨é€šä¿¡ï¼š</li>
</ol>
<p><img src="/2022/06/11/uncatalog/cl49r8bkh000qlwr7dta2fv8f/3.png" alt="image"></p>
<p>è€ŒæŠ¥æ–‡ä¸€æ—¦åˆ°è¾¾å¯¹æ–¹ä¸»æœºï¼Œå¯¹æ–¹çš„ä¸»æœºå°±å’”å’”å’”ä¸€é¡¿å¤„ç†ï¼Œç„¶åå°±è½¬äº¤ç»™ä¸»æœºä¸Šå¯¹åº”çš„å®¹å™¨äº†ã€‚</p>
<p>è€Œæˆ‘ä»¬ä¸€èˆ¬è¯´çš„å®¹å™¨é€šä¿¡éƒ½æ˜¯è¿™ç§ï¼Œåªè¦æŠ¥æ–‡åˆ°è¾¾å¯¹æ–¹ä¸»æœºï¼Œæ€»èƒ½è¿›å…¥å¯¹åº”çš„å®¹å™¨ã€‚å› ä¸ºå¯¹æ–¹ä¸»æœºåœ¨ä¸»æœºä¸Šä¸ºå®¹å™¨å¼€äº†ä¸€ä¸ªå£å­ï¼ŒæŠ¥æ–‡ä¸€æ—¦åˆ°è¾¾è¿™ä¸ªå£å­ï¼Œå°±è¿›å…¥åˆ°äº†å®¹å™¨ã€‚è¿™ä¸ªå£å­å°±æ˜¯ç«¯å£ï¼Œä¸€æ—¦æŠ¥æ–‡æ˜¯è¿™ä¸ªç«¯å£çš„ï¼Œç»Ÿç»Ÿè½¬äº¤ç»™å¯¹åº”çš„å®¹å™¨ã€‚</p>
<p>çœ‹ä¸Šé¢çš„ä¾‹å­ï¼Œåœ¨ä¸»æœºä¸Šå¼€çš„å£å­çš„ç«¯å£å°±æ˜¯3306ã€‚ä»»ä½•è¾¾åˆ°ä¸»æœºçš„æŠ¥æ–‡ï¼Œåªè¦ç›®çš„ç«¯å£æ˜¯3306ï¼Œç›´æ¥è½¬äº¤ç»™mysqlå®¹å™¨ã€‚</p>
<ol start="4">
<li>ä¸»æœºä¸Šé¢ä¸ºå®¹å™¨å¼€å£å­å¤§æ¦‚é•¿è¿™ä¸ªæ ·å­ï¼š</li>
</ol>
<p><img src="/2022/06/11/uncatalog/cl49r8bkh000qlwr7dta2fv8f/4.png" alt="image"></p>
<p>å› ä¸ºä¸»æœºçš„ç«¯å£æ•°å¾ˆå¤šï¼Œæ‰€ä»¥å¯ä»¥ä½¿å¾—ä¸€ä¸ªä¸»æœºå¯ä»¥æœ‰å¾ˆå¤šçš„å®¹å™¨éƒ½å¯ä»¥å¯¹å¤–æš´éœ²åœ°å€ã€‚</p>
<p>å®¹å™¨å¯¹å¤–æš´éœ²çš„åœ°å€å°±æ˜¯ï¼šä¸»æœºIP+ä¸»æœºPort</p>
<p>è¿™ä¸ªåœ°å€ï¼ŒKuberneteså–äº†ä¸€ä¸ªå¥½å¬çš„åå­—ï¼šNodePortæ¨¡å¼ã€‚</p>
<ol start="5">
<li>æ¥ç€æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸ªå¤æ‚çš„iptablesçš„NATç©¿è¶Š</li>
</ol>
<p>æˆ‘ä»¬åœ¨Kubernetesçš„NodeèŠ‚ç‚¹ä¸Šé¢æŸ¥è¯¢natè¡¨ä¿¡æ¯ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">iptables -t nat -nL</span><br></pre></td></tr></table></figure></div>

<p>ä¼šåˆ—å‡ºå¾ˆå¤§ä¸€ç‰‡ï¼Œå¯†å¯†éº»éº»çš„ï¼Œè¿™é‡Œè‚¯å®šè´´ä¸ä¸‹ï¼Œè¿™é‡Œæˆ‘ä»¬å°±åˆ†æ®µåˆ†æå®ƒçš„å®ç°ã€‚</p>
<p>aï¼‰ å’±ä»¬ä¸çœ‹NodePortè§„åˆ™ï¼Œå› ä¸ºä¸Šé¢å·²ç»è§£é‡Šè¿‡äº†</p>
<p>ç›´æ¥æ‰¾åˆ°ä¸‹é¢è¿™ç§æ ·å­çš„è§„åˆ™ï¼š</p>
<p><img src="/2022/06/11/uncatalog/cl49r8bkh000qlwr7dta2fv8f/5.png" alt="image"></p>
<p>è¿™é‡Œå¯ä»¥çœ‹åˆ°è¿™äº›è§„åˆ™å¾ˆæ˜ç¡®ï¼šä»»æ„æºipï¼Œç‰¹å®šçš„ç›®çš„IPï¼Œç›´æ¥å‘½ä¸­è§„åˆ™ã€‚</p>
<p>æ­¥éª¤1ï¼šè¿™é‡Œçš„ç›®çš„IPæ˜¯ä¸€ä¸ªå‡çš„IPï¼Œå®é™…ä¸å­˜åœ¨çš„ã€‚â€œç½‘ç»œéª—å­â€ç« èŠ‚ä»‹ç»è¿‡ï¼Œè¿™ä¸ªå‡çš„IPæ˜¯DNSæ¬ºéª—ä½ çš„ï¼Œæ˜¯ä½ é€šè¿‡â€œåå­—â€æ¢å›æ¥çš„ã€‚é‚£ä¹ˆè§„åˆ™çš„æ„æ€å°±æ˜¯ä¸€æ—¦æœ‰äººè®¿é—®è¿™ä¸ªå‡IPï¼Œå°±å‘½ä¸­iptablesè§„åˆ™ï¼ˆè¢«æ•è·ï¼‰ã€‚æ¯ä¸€æ¡è§„åˆ™ä»£è¡¨æ•è·ä¸€ç§å‡IPçš„è®¿é—®ã€‚</p>
<p>æ­¥éª¤ 2ï¼šé‚£ä¹ˆæˆ‘ä»¬éšä¾¿æ‰¾ä¸€æ¡è§„åˆ™æ¥åˆ†æï¼Œä¾‹å¦‚åå­—å›¾ä¸­ 2è¿™æ¡è§„åˆ™ã€‚</p>
<p>å½“æŠ¥æ–‡åŒ¹é…åˆ°è¿™ä¸€æ¡è§„åˆ™åï¼Œå°±è·³è½¬åˆ°å¯¹åº”åå­—çš„è§„åˆ™é“¾é‡Œé¢å»ã€‚</p>
<p>æˆ‘ä»¬æŠŠå¯¹åº”çš„è§„åˆ™é“¾æ‰¾å‡ºæ¥çœ‹çœ‹ï¼š<br><img src="/2022/06/11/uncatalog/cl49r8bkh000qlwr7dta2fv8f/6.png" alt="image"></p>
<p>æ­¥éª¤3ï¼šå¯ä»¥çœ‹åˆ°è¿™ä¸ªè§„åˆ™é“¾å°±ä¸€æ¡è§„åˆ™ï¼šä»»æ„æºIPï¼Œä»»æ„ç›®çš„IPï¼Œå‘½ä¸­å¹¶è·³è½¬åˆ°ä¸‹ä¸€æ¡è§„åˆ™é“¾ã€‚ï¼ˆä»»æ„è¿›å…¥è¿™æ¡é“¾çš„æŠ¥æ–‡ï¼Œç›´æ¥è¿›å…¥ä¸‹ä¸€è·³è§„åˆ™é“¾ï¼‰</p>
<p>é‚£ä¹ˆæˆ‘ä»¬å†çœ‹çœ‹ä¸‹ä¸€æ¡è§„åˆ™é“¾ï¼š</p>
<p><img src="/2022/06/11/uncatalog/cl49r8bkh000qlwr7dta2fv8f/7.png" alt="image"></p>
<p>æ­¥éª¤4ï¼šè¿™é‡Œçœ‹åˆ°äº†ï¼Œè§„åˆ™æ˜¯è¿™æ ·å­çš„ï¼šç›´æ¥æŠŠæŠ¥æ–‡çš„ç›®çš„åœ°å€æ”¹ä¸ºçœŸå®å®¹å™¨çš„IPã€‚ç„¶åè§„åˆ™ç»“æŸã€‚è¿™æ ·å­æŠ¥æ–‡å°±ä¼šç›´æ¥å‘ç»™å¯¹åº”çš„å®¹å™¨äº†ã€‚</p>
<p>æ€»ç»“ä¸Šé¢çš„æµç¨‹ï¼šä¸€æ—¦å‘ç°æœ‰å‘ç»™ç‰¹å®šçš„å‡IPçš„æŠ¥æ–‡ï¼Œç›´æ¥æŠŠç›®çš„IPæ¢æ‰ï¼Œæ¢æˆè¿™ä¸ªå‡IPå¯¹åº”çš„å®¹å™¨çš„çœŸå®IPã€‚ å¹¶ä¸”è¿™ä¸ªè¿‡ç¨‹æ˜¯å¼ºåˆ¶çš„ï¼Œä¹Ÿå°±æ˜¯å½“å‰ä¸»æœºä¸Šæ‰€æœ‰çš„æŠ¥æ–‡éƒ½å¾—ç»è¿‡è¿™ä¸ªiptablesçš„æ£€æŸ¥ï¼ˆå³ä¸€æ—¦è®¿é—®è‚¯å®šä¼šè¢«æ•è·ï¼‰ã€‚</p>
<p>ï¼ˆè¿™ä¸ªå°±æ˜¯ç½‘ç»œéª—å­è¡Œéª—çš„å…·ä½“ä¼ä¿©äº†ï¼‰</p>
]]></content>
      <tags>
        <tag>äº‘åŸç”ŸåŸºç¡€ç³»åˆ—</tag>
        <tag>Kubernetesç½‘ç»œ</tag>
      </tags>
  </entry>
  <entry>
    <title>Kubernetesç½‘ç»œç³»åˆ—ä¹‹(åä¸€)ä»€ä¹ˆæ˜¯VLANå’ŒVXLAN</title>
    <url>/2022/06/11/uncatalog/cl49s0k3u000tlwr77i2gctw9/</url>
    <content><![CDATA[<hr>
<span id="more"></span>



<hr>
<blockquote>
<p>ä¸€ã€èƒŒæ™¯æ•²é»‘æ¿ï¼š VLANæ˜¯ä½ ç†è§£äº‘ç½‘ç»œçš„é—¨æ§›çŸ³ï¼Œè¦æƒ³é€šå¾€äº‘ç½‘ç»œçš„ä¸–ç•Œï¼Œè¿™ä¸€æ‰‡å¤§é—¨ä¸€å®šå¾—ç†è§£é€å½»ã€‚äºŒã€ä¸ºä»€ä¹ˆéœ€è¦VLANåœ¨å‰é¢çš„è¯¾ç¨‹é‡Œé¢ï¼Œæˆ‘ä»¬çŸ¥é“äº†å±€åŸŸç½‘çš„æ¦‚å¿µã€‚ä¸€ä¸ªå±€åŸŸç½‘é‡Œé¢æœ‰Nå°ç”µè„‘äº’ç›¸é€šä¿¡ï¼ŒARPå¹¿æ’­é€šçŸ¥åˆ°å„å®¶å„æˆ·ã€‚æŠŠä½ æƒ³è±¡ä¸ºæ‘é‡Œçš„ä¸€æˆ·äººå®¶ï¼Œå¹³æ—¶é€å¿«é€’æ”¶å¿«é€’ï¼Œå¶å°”æ‘é‡Œå¹¿æ’­æ‰¾äººï¼Œæ´¾ä¸ªäººåˆ°ä½ å®¶è¯¢é—®è¯¢é—®æƒ…å†µï¼Œæ•´ä½“çœ‹ä¼¼æŒºå’Œè°çš„ã€‚ ä½†æ˜¯è¿™é‡Œæ³¨æ„äº†å“¦ï¼Œå¹¿æ’­æ‰¾äººï¼Œé‚£å¯ä¸€å®šæ˜¯å…¨æ‘æ¯å®¶æ¯æˆ·éƒ½æ´¾äººé€šçŸ¥åˆ°çš„â€¦</p>
</blockquote>
<h3 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h3><p>æ•²é»‘æ¿ï¼š VLANæ˜¯ä½ ç†è§£äº‘ç½‘ç»œçš„é—¨æ§›çŸ³ï¼Œè¦æƒ³é€šå¾€äº‘ç½‘ç»œçš„ä¸–ç•Œï¼Œè¿™ä¸€æ‰‡å¤§é—¨ä¸€å®šå¾—ç†è§£é€å½»ã€‚</p>
<h3 id="ä¸ºä»€ä¹ˆéœ€è¦VLAN"><a href="#ä¸ºä»€ä¹ˆéœ€è¦VLAN" class="headerlink" title="ä¸ºä»€ä¹ˆéœ€è¦VLAN"></a>ä¸ºä»€ä¹ˆéœ€è¦VLAN</h3><p>åœ¨å‰é¢çš„è¯¾ç¨‹é‡Œé¢ï¼Œæˆ‘ä»¬çŸ¥é“äº†å±€åŸŸç½‘çš„æ¦‚å¿µã€‚ä¸€ä¸ªå±€åŸŸç½‘é‡Œé¢æœ‰Nå°ç”µè„‘äº’ç›¸é€šä¿¡ï¼ŒARPå¹¿æ’­é€šçŸ¥åˆ°å„å®¶å„æˆ·ã€‚æŠŠä½ æƒ³è±¡ä¸ºæ‘é‡Œçš„ä¸€æˆ·äººå®¶ï¼Œå¹³æ—¶é€å¿«é€’æ”¶å¿«é€’ï¼Œå¶å°”æ‘é‡Œå¹¿æ’­æ‰¾äººï¼Œæ´¾ä¸ªäººåˆ°ä½ å®¶è¯¢é—®è¯¢é—®æƒ…å†µï¼Œæ•´ä½“çœ‹ä¼¼æŒºå’Œè°çš„ã€‚ ä½†æ˜¯è¿™é‡Œæ³¨æ„äº†å“¦ï¼Œå¹¿æ’­æ‰¾äººï¼Œé‚£å¯ä¸€å®šæ˜¯å…¨æ‘æ¯å®¶æ¯æˆ·éƒ½æ´¾äººé€šçŸ¥åˆ°çš„ã€‚</p>
<p><img src="/2022/06/11/uncatalog/cl49s0k3u000tlwr77i2gctw9/1.png" alt="image"></p>
<p>ç„¶è€Œå½“æ‘å­å¤§äº†ï¼Œé—®é¢˜å°±å‡ºæ¥äº†ï¼š å°±æ˜¯è¿™ä¸ªå„è·¯çš„å¹¿æ’­é€šçŸ¥çš„å¤§ä½¿å•Šï¼Œä¸åœçš„å¾€ä½ å®¶é—¨å£èµ¶å•Šï¼Œä¸€ä¸ªåˆä¸€ä¸ªï¼Œæ— å°½çš„éªšæ‰°ç€ä½ å®¶ï¼Œå·²ç»å›°æ‰°åˆ°ä½ æ­£å¸¸çš„ä½œæ¯äº†ã€‚</p>
<p><img src="/2022/06/11/uncatalog/cl49s0k3u000tlwr77i2gctw9/2.png" alt="image"></p>
<p>é‚£ä½ å¯èƒ½å¥½å¥‡ï¼Œä¸€ä¸ªæ‘é‡Œé¢ï¼Œè¿™ä¸ªå¹¿æ’­å¤§ä½¿èƒ½æœ‰è¿™ä¹ˆå¤šå—ï¼Ÿ å—¯ï¼Œå¤§æ¦‚ä½ é—¨å£å°±è¿™ä¹ˆå¤šå§ï¼ˆå¤¸å¼ æ‰‹æ³•ï¼‰</p>
<p><img src="/2022/06/11/uncatalog/cl49s0k3u000tlwr77i2gctw9/3.jpg" alt="image"></p>
<p>æ‰€ä»¥è¿™ä¸ªæ‘å­ä¹Ÿå¾—åˆ†åˆ†ç»„äº†ï¼šä¸ŠåŠæ‘ï¼Œä¸‹åŠæ‘ã€‚ä¸ŠåŠæ‘çš„äº‹æƒ…ï¼Œå¹¿æ’­å¤§ä½¿ï¼Œä½ åˆ«æ¥ä¸‹åŠæ‘å’¨è¯¢äº†ï¼Œä¸ŠåŠæ‘è·‘å®Œäº†å°±å™¢äº†ã€‚</p>
<p>å› æ­¤ï¼Œä¸€ä¸ªå±€åŸŸç½‘é‡Œé¢çš„ç”µè„‘çš„åˆ†ç»„éœ€æ±‚å°±å¼€å§‹äº†ã€‚ä¸€ä¸ªç‰©ç†ä¸–ç•Œçš„äººï¼Œå®é™…ä¸Šåˆåˆ†æˆäº†å„ä¸ªé—¨æ´¾ï¼Œé—¨æ´¾ä¹‹é—´å„ä¸ç›¸å¹²ã€‚è¿™ç§æŠ½è±¡å†³å®šäº†ä½ è™½ç„¶å’Œé‚»å±…å¾ˆè¿‘ï¼Œç„¶è€Œä½ ä»¬äº’ç›¸ä¸è®¤è¯†ï¼Œä¹Ÿä¸é€šä¿¡ã€‚</p>
<p>VLANå°±æ˜¯ç”¨æ¥ç»™æ‘é‡Œäººåˆ†ç»„ç”¨çš„ï¼Œæ¯ä¸ªäººè´´ä¸ªæ ‡ç­¾ã€‚ä»£è¡¨äº†ä½ æ˜¯å“ªä¸ªé—¨æ´¾ã€‚</p>
<h3 id="å¦‚ä½•ç†è§£VLAN"><a href="#å¦‚ä½•ç†è§£VLAN" class="headerlink" title="å¦‚ä½•ç†è§£VLAN"></a>å¦‚ä½•ç†è§£VLAN</h3><p>ç«™åœ¨ç½‘ç»œæŠ¥æ–‡çš„è§’åº¦ï¼Œæˆ‘ä»¬é‡æ–°æ¢³ç†ä¸€ä¸‹è¿™ä¸ªé‡Œé¢åˆ†ç»„çš„é“é“ã€‚</p>
<p>æœ€å¼€å§‹ï¼Œä¸€ä¸ªç½‘çº¿ä¸Šé¢è·‘ç€å¾ˆå¤šè¿è¾“è½¦(IPæŠ¥æ–‡)ï¼Œåˆ°è¾¾ç›®çš„åœ°åï¼ŒæŠŠIPå¤´å»æ‰ï¼Œå‰©ä¸‹è´§ç‰©äº¤ç»™å¯¹æ–¹ï¼Œå°±åƒè¿™æ ·ï¼š</p>
<p>åœ¨å¯¹é€šçŸ¥å¤§ä½¿åˆ†ç»„ä¹‹åï¼Œè¿™äº›æŠ¥æ–‡å¯å°±å¸¦äº†æ ‡è®°äº†ï¼Œä¸€çœ¼å°±çœ‹å‡ºæ¥ï¼Œè¿™æ˜¯ä¸åŒé—¨æ´¾çš„æŠ¥æ–‡ã€‚å°±åƒè¿™æ ·ï¼š</p>
<p><img src="/2022/06/11/uncatalog/cl49s0k3u000tlwr77i2gctw9/4.png" alt="image"></p>
<p>è¿™æ ·ä¸€æ¥ï¼Œæ¯ä¸€å°æœºå™¨ï¼Œåªä¼šæ”¶åˆ°è‡ªå·±é—¨æ´¾çš„æŠ¥æ–‡ï¼Œä¸ä¼šå—åˆ°å¦ä¸€ä¸ªé—¨æ´¾çš„éªšæ‰°ã€‚ä¸€ä¸ªå±€åŸŸç½‘å°±è¿™æ ·æ ¹æ®æŠ¥æ–‡çš„æ ‡è®°ï¼Œåˆ†è£‚ä¸ºå¤šä¸ªä¸åŒçš„é—¨æ´¾ã€‚æ‰¾å…¶ä¸­ä¸€ä¸ªé—¨æ´¾å•ç‹¬çœ‹ï¼Œå®ƒåˆåƒæ˜¯æ˜¯ä¸€ä¸ªæ›´å°çš„å±€åŸŸç½‘ï¼Œå› ä¸ºå®ƒä»¬åªä¸åŒä¸€é—¨æ´¾çš„äººé€šä¿¡ã€‚æ‰€ä»¥å•ç‹¬çš„ä¸€ä¸ªé—¨æ´¾åˆå«åšâ€œè™šæ‹Ÿçš„â€å±€åŸŸç½‘ã€‚è‹±æ–‡Virtual LANï¼ˆä¹Ÿå°±æ˜¯VLANï¼‰ã€‚</p>
<p>ä¸‹å›¾æ˜¾ç¤ºä¸€ä¸ªå±€åŸŸç½‘ï¼Œåˆ†è£‚ä¸ºä¸¤ä¸ªè™šæ‹Ÿçš„å±€åŸŸç½‘ã€‚</p>
<p><img src="/2022/06/11/uncatalog/cl49s0k3u000tlwr77i2gctw9/17.png" alt="image"></p>
<p>é‚£ä¹ˆæ€ä¹ˆæ¥ç»™æŠ¥æ–‡æ‰“æ ‡ç­¾åŒºåˆ†ç±»åˆ«å‘¢ï¼Ÿ ææŠ¥æ–‡åè®®çš„å‰è¾ˆï¼ŒææŒ‡ä¸€ç®—ã€‚ç®—äº†ï¼Œå°±ç»™æŠ¥æ–‡å¤´é‡Œé¢åŠ ä¸ªå­—æ®µå§ï¼Œç”¨æ¥å†™é—¨æ´¾å·ã€‚<br><img src="/2022/06/11/uncatalog/cl49s0k3u000tlwr77i2gctw9/5.png" alt="image"></p>
<p>æ³¨æ„è¿™é‡ŒVIDç•™äº†12bitä½ï¼Œä¹Ÿå°±æ˜¯æœ€å¤§4095ä¸ªé—¨æ´¾ã€‚ æåè®®çš„äººè§‰å¾—ï¼Œä¸€ä¸ªå±€åŸŸç½‘é‡Œé¢çš„ç”µè„‘å˜›ï¼Œæé‚£ä¹ˆå¤šé—¨æ´¾å¹²å˜›ï¼Œåˆ†ç»„æ•°é‡ç»å¯¹å¤Ÿäº†å•Šã€‚å‘µå‘µ~éƒ½æ˜¯å‘ï¼Œè·ŸIPV4ä¸€æ ·ä¸€æ ·çš„ã€‚</p>
<p>å¸¦äº†VLANå¤´çš„æŠ¥æ–‡ï¼Œæˆ‘ä»¬å«VLANæ ‡ç­¾ã€‚å®ƒæ˜¯ä¸€ä¸ªé•¿å¾—ä¸å¤ªä¸€æ ·çš„æŠ¥æ–‡ã€‚</p>
<h3 id="äº¤æ¢æœºçš„VLANå£"><a href="#äº¤æ¢æœºçš„VLANå£" class="headerlink" title="äº¤æ¢æœºçš„VLANå£"></a>äº¤æ¢æœºçš„VLANå£</h3><p>åœ¨ä¸€ä¸ªå±€åŸŸç½‘é‡Œé¢ï¼Œåˆ†ç»„è¿™ä»¶äº‹ï¼Œä½ å¯ä»¥ä»»æ€§çš„éšæœºé€‰ç”µè„‘åˆ†ä¸€ä¸ªç»„ï¼Œæ›´å¤šçš„æ˜¯æŒ‰ç…§ä½ç½®å’Œå±æ€§åˆ†ç»„ã€‚ä¸€èˆ¬ä¸ºäº†æ–¹ä¾¿ç®¡ç†ï¼Œéƒ½å°†ä¸€ä¸ªâ€œè™šæ‹Ÿå±€åŸŸç½‘â€çš„ç”µè„‘æ”¾åœ¨ä¸€èµ·ã€‚æŠŠå®ƒä»¬æ¥å…¥ä¸€ä¸ªäº¤æ¢æœºçš„ä¸€ä¸ªç½‘å£ä¸Šé¢ï¼Œè¿™ä¸ªç½‘å£å¯¹åº”çš„ä¸‹å±ç”µè„‘ï¼Œå±äºåŒä¸€ä¸ªâ€œè™šæ‹Ÿå±€åŸŸç½‘â€ã€‚</p>
<p><img src="/2022/06/11/uncatalog/cl49s0k3u000tlwr77i2gctw9/6.png" alt="image"></p>
<p>åœ¨å›¾ä¸Šå¯ä»¥çœ‹åˆ°ï¼Œä¸€ä¸ªäº¤æ¢æœºç«¯å£å¯ä»¥è®¾ç½®VLANå±æ€§ï¼Œä»£è¡¨å…è®¸çš„æŠ¥æ–‡ç±»å‹(é—¨æ´¾)ã€‚ é‚£è¿™é‡Œæœ‰ä¸€ä¸ªæ·±å±‚æ¬¡çš„æ¦‚å¿µï¼šä¸€ä¸ªç«¯å£ï¼ŒæŠ¥æ–‡æœ‰è¿›ï¼Œæœ‰å‡ºçš„ã€‚åˆ†åˆ«æ€ä¹ˆå¤„ç†çš„å‘¢ï¼Ÿ</p>
<p><img src="/2022/06/11/uncatalog/cl49s0k3u000tlwr77i2gctw9/7.png" alt="image"></p>
<p>è¿™ç§æ‰“ä¸Šæ ‡ç­¾ï¼Œå’Œå»é™¤æ ‡ç­¾çš„åŠŸèƒ½ï¼Œæ˜¯ä¸€ä¸ªå¸¦VLANåŠŸèƒ½çš„å¸¸è§æƒ…å†µã€‚ä¹Ÿå°±æ˜¯tagï¼Œuntagçš„å®é™…å«ä¹‰ã€‚å› ä¸ºä¹Ÿæœ‰ç«¯å£æ˜¯éœ€è¦åœ¨æ”¶åˆ°æŠ¥æ–‡çš„æ—¶å€™untagçš„ï¼Œæ‰€ä»¥è¿™ä¸ªæ‰“æ ‡ç­¾çš„æ´»éœ€è¦æ³¨æ„ï¼Œé—¨æ´¾ç†æ¸…æ¥šã€‚</p>
<h3 id="Trunkåˆæ˜¯ä»€ä¹ˆé¬¼ï¼Ÿ"><a href="#Trunkåˆæ˜¯ä»€ä¹ˆé¬¼ï¼Ÿ" class="headerlink" title="Trunkåˆæ˜¯ä»€ä¹ˆé¬¼ï¼Ÿ"></a>Trunkåˆæ˜¯ä»€ä¹ˆé¬¼ï¼Ÿ</h3><p>ä¸€èˆ¬æƒ…å†µï¼Œä¸€ä¸ªäº¤æ¢æœºç«¯å£ï¼Œéƒ½æ˜¯è®¾ç½®ä¸ºåªå…è®¸ä¸€ç§VLANæŠ¥æ–‡é€šè¿‡ï¼Œè¿™æ ·æ¯”è¾ƒå¥½ç†è§£ã€‚ä½†æ˜¯æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½®ä¸€ä¸ªç«¯å£ï¼Œå…è®¸Nç§VLANæŠ¥æ–‡ï¼Œéƒ½å¯ä»¥é€šè¿‡ã€‚</p>
<p>æ¯”å¦‚ï¼š</p>
<p>åœ¨ä¸€ä¸ªå¤§çš„å±€åŸŸç½‘é‡Œé¢ï¼ˆæ¯”å¦‚å­¦æ ¡ï¼‰ï¼Œæˆ‘ä»¬éœ€è¦å°†ä¸¤ä¸ªä½ç½®çš„ï¼ˆæ¯”ä¾‹ä¸¤å¹¢æ¥¼ï¼‰çš„VLANç”µè„‘é€šè¿èµ·æ¥ï¼Œå­—æ¯æ´¾ä¸€ä¸ªç»„ï¼Œæ•°å­—æ´¾ä¸€ä¸ªç»„ã€‚ç±»ä¼¼å›¾ç¤ºè¿™æ ·ï¼š</p>
<p><img src="/2022/06/11/uncatalog/cl49s0k3u000tlwr77i2gctw9/8.png" alt="image"></p>
<p>è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœæŒ‰ç…§ä¸€ä¸ªç«¯å£è®¾ç½®ä¸€ä¸ªVLANçš„åŸåˆ™ï¼Œåªéœ€è¦åœ¨ä¸¤ä¸ªäº¤æ¢æœºä¹‹é—´ï¼Œæ¥é¢å¤–2æ ¹çº¿å°±è¡Œäº†ã€‚åƒè¿™æ ·ï¼š</p>
<p><img src="/2022/06/11/uncatalog/cl49s0k3u000tlwr77i2gctw9/9.png" alt="image"></p>
<p>ç”±äºå¸¦äº†VLANæ ‡ç­¾çš„æŠ¥æ–‡ï¼Œåªèƒ½é€šè¿‡å¯¹äºçš„VLANç«¯å£ï¼Œæ‰€ä»¥ä¸¤ä¸ªâ€œè™šæ‹Ÿå±€åŸŸç½‘â€äº’ç›¸ä¸å¹²æ‰°ã€‚ä½†æ˜¯å¦‚æœé—¨æ´¾å˜å¤šäº†å‘¢ï¼Ÿï¼Ÿ</p>
<p>éš¾é“æ¯å¢åŠ ä¸€ä¸ªé—¨æ´¾ï¼Œä¸¤ä¸ªäº¤æ¢æœºä¹‹é—´å°±å¾—åŠ ä¸€æ ¹ç½‘çº¿ï¼Ÿï¼Ÿ</p>
<p>æ‰€ä»¥èªæ˜çš„æˆ‘ä»¬å°±æƒ³å‡ºæ¥ï¼Œä¸€ä¸ªç«¯å£å…è®¸Nç§VLANæ ‡ç­¾ä¸å°±è¡Œäº†ã€‚æ„æ€æ˜¯å„é—¨æ´¾å‡å¯é€šè¿‡~</p>
<p><img src="/2022/06/11/uncatalog/cl49s0k3u000tlwr77i2gctw9/10.png" alt="image"></p>
<p>è¿™ä¸ªå°±æ˜¯Trunkç«¯å£äº†ã€‚</p>
<p><img src="/2022/06/11/uncatalog/cl49s0k3u000tlwr77i2gctw9/11.png" alt="image"></p>
<h3 id="VLANçš„ä¸è¶³ï¼Œå¤§å“¥VXLANæ¥å¸®å¿™"><a href="#VLANçš„ä¸è¶³ï¼Œå¤§å“¥VXLANæ¥å¸®å¿™" class="headerlink" title="VLANçš„ä¸è¶³ï¼Œå¤§å“¥VXLANæ¥å¸®å¿™"></a>VLANçš„ä¸è¶³ï¼Œå¤§å“¥VXLANæ¥å¸®å¿™</h3><p>ä¹‹å‰æè¿‡ï¼Œç¬¬ä¸€ä¸ªæƒ³å‡ºé—¨æ´¾çš„VLANåè®®è®¾è®¡è€…ï¼Œè§‰å¾—12bitçš„æ ‡è®°ï¼Œä¹Ÿå°±æ˜¯4åƒå¤šç§é—¨æ´¾å°±å¤Ÿäº†ã€‚å®é™…æƒ…å†µæ˜¯ï¼Œè¿™ç©æ„å¾ˆå¥½ç”¨å•Šï¼Œç‰¹åˆ«æ˜¯è¿™ç§â€œè™šæ‹Ÿçš„å±€åŸŸç½‘â€æ¦‚å¿µï¼Œå¯ä»¥æ¨¡æ‹Ÿå‡ºå¾ˆå¤šâ€œè™šæ‹Ÿçš„ç½‘ç»œâ€å‡ºæ¥ç»™ç”¨æˆ·ä½¿ç”¨ï¼Œç‰¹åˆ«é€‚åˆäº‘è®¡ç®—è¿™ç§ä¸€ä¸ªç”¨æˆ·éœ€è¦è‡ªå·±ç‹¬ç«‹çš„ç½‘ç»œè¿™ç§åœºæ™¯ï¼Œæ‰€ä»¥ä½¿ç”¨çš„è¶Šæ¥ä¹Ÿå¤šï¼Œéœ€æ±‚é‡è¶…å¤§ã€‚</p>
<p>è¡¨é¢ä¸Šä¸€æ ¹ç‰©ç†ç½‘çº¿ï¼Œå¯ä»¥è™šæ‹Ÿå‡ºNæ ¹â€œè™šæ‹Ÿç½‘çº¿â€çš„æ•ˆæœã€‚</p>
<p><img src="/2022/06/11/uncatalog/cl49s0k3u000tlwr77i2gctw9/12.png" alt="image"></p>
<p>æ‰€ä»¥ç»“æœå°±æ˜¯ï¼šVLANè¿™ç§åˆ†å‡ºæ¥é—¨æ´¾çš„æ•°é‡å®Œå…¨ä¸å¤Ÿç”¨å•Šï¼ å› ä¸ºéœ€æ±‚é‡å¯èƒ½æ¯”ä¸‹é¢çš„è¿˜è¦å¤šï¼š</p>
<p><img src="/2022/06/11/uncatalog/cl49s0k3u000tlwr77i2gctw9/13.png" alt="image"></p>
<p>æ‰€ä»¥ï¼Œä¸€ç§æ–°çš„åŒºåˆ†æŠ¥æ–‡é—¨æ´¾çš„æ–¹æ³•éœ€è¦å‡ºæ¥ã€‚æ‰€ä»¥äººä»¬å°±æƒ³æ–¹æ³•ï¼Œæœ€ç»ˆæœ‰ä¸¤ä¸ªæ–¹æ³•å‡ºæ¥ï¼šä¸€ç§å°±æ˜¯ VXLANï¼ŒXå°±æ˜¯æ‰©å±•çš„æ„æ€ï¼› è¿˜æœ‰ä¸€ç§æ˜¯GREç½‘ç»œã€‚</p>
<p>è¿™ä¸¤ç§åˆ†é—¨æ´¾çš„æ–¹æ³•æœ‰ä¸€ä¸ªå…±åŒç‚¹ï¼Œå°±æ˜¯åœ¨å°è´§è½¦è¿è¾“çš„è´§ç‰©ä¸Šæ‰“æ ‡ç­¾ã€‚è€Œä¸å†æ˜¯å¯¹è´§è½¦åˆ†ç±»ï¼ˆå› ä¸ºIPæŠ¥æ–‡å¤´å·²ç»æ²¡æœ‰å¤šä½™å­—æ®µå¯ç”¨æ¥å‘æŒ¥ä½œç”¨äº†ï¼‰ã€‚</p>
<ol>
<li>VXLANåˆ†é—¨æ´¾æ–¹æ³•ï¼š</li>
</ol>
<p><img src="/2022/06/11/uncatalog/cl49s0k3u000tlwr77i2gctw9/14.png" alt="image"></p>
<ol start="2">
<li>GREåˆ†é—¨æ´¾æ–¹æ³•ï¼š</li>
</ol>
<p><img src="/2022/06/11/uncatalog/cl49s0k3u000tlwr77i2gctw9/15.png" alt="image"></p>
<h3 id="ç»“æŸ"><a href="#ç»“æŸ" class="headerlink" title="ç»“æŸ"></a>ç»“æŸ</h3><p>å› ä¸ºVLANæŠ€æœ¯çš„å‡ºç°ï¼Œä½¿å¾—åŒä¸€æ ¹ç‰©ç†çº¿è·¯ä¸Šï¼ŒåŒæ—¶ä¼ é€’2ç§å®Œå…¨ç›¸äº’éš”ç¦»çš„ä¿¡æ¯ã€‚æ•ˆæœçœ‹ä¸Šå»ä¼¼ä¹æ˜¯2æ¡ç‹¬ç«‹çš„çº¿è·¯åˆ†åˆ«åœ¨ä¼ é€’ä¿¡æ¯ã€‚</p>
<p>æ‰€ä»¥å†è¿›ä¸€æ­¥æƒ³è±¡ä¸‹ï¼šæŠ½è±¡çš„äº‘è®¡ç®—é‡Œé¢çš„è™šæ‹Ÿæœºï¼Œå…¶å®å°±æ˜¯è¿™ç§æƒ…å†µï¼Œä¸¤å°è™šæ‹Ÿæœºå¯èƒ½æŒ¨å¾ˆè¿‘ï¼ˆè¿è¡Œåœ¨åŒä¸€å°ç‰©ç†æœºä¸Šï¼‰ï¼Œç„¶è€Œå®ƒä»¬ä¹‹é—´æ˜¯å®Œå…¨æ²¡å…³ç³»çš„ï¼Œå› ä¸ºæ˜¯åˆ†åˆ«è¢«ä¸¤ä¸ªä¸åŒçš„äººè´­ä¹°çš„ã€‚</p>
<p><img src="/2022/06/11/uncatalog/cl49s0k3u000tlwr77i2gctw9/16.png" alt="image"></p>
<p>äº‘ç½‘ç»œçš„é›å½¢å°±è¿™æ ·é•¿å‡ºæ¥äº†ã€‚æ•²é»‘æ¿~</p>
<p>é™„å½•ï¼š</p>
<p>è¦æ˜¯æƒ³è¦æ·±å…¥æè¿™ä¸ªVLANæŠ€æœ¯ï¼Œå¯ä»¥çœ‹çœ‹è¿™ç¯‡æ–‡ç« <a href="https://network.51cto.com/article/450885.html">å°ç™½éƒ½èƒ½çœ‹æ˜ç™½çš„VLANåŸç†è§£é‡Š</a>ã€‚ä»…äº†è§£æ¦‚å¿µï¼Œçœ‹æœ¬æ–‡å°±å¤Ÿäº†ã€‚</p>
]]></content>
      <tags>
        <tag>äº‘åŸç”ŸåŸºç¡€ç³»åˆ—</tag>
        <tag>Kubernetesç½‘ç»œ</tag>
      </tags>
  </entry>
  <entry>
    <title>Kubernetesç½‘ç»œç³»åˆ—ä¹‹(åäºŒ)GRE</title>
    <url>/2022/06/11/uncatalog/cl49ss3al000wlwr78qw42gtt/</url>
    <content><![CDATA[<hr>
<span id="more"></span>



<hr>
<blockquote>
<p>ä¸Šä¸€è¯¾æˆ‘ä»¬ä»‹ç»äº†vlanæŠ¥æ–‡ï¼ŒçŸ¥é“å®ƒæ˜¯å®ç°ç½‘ç»œâ€œåˆ†ç»„â€çš„å…ƒè€ï¼Œä¹Ÿå°±æ˜¯å®ç°äº‘ç½‘ç»œï¼ˆè™šæ‹Ÿçš„å‡è±¡ï¼‰çš„åŸºçŸ³ã€‚ä»Šå¤©æˆ‘æ¥çœ‹çœ‹ç½‘ç»œä¸­çš„å¦ä¸€ä½å…ƒè€ï¼Œèµ°ç§é¼»ç¥–GRE</p>
</blockquote>
<h3 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h3><p>ä¸Šä¸€è¯¾æˆ‘ä»¬ä»‹ç»äº†vlanæŠ¥æ–‡ï¼ŒçŸ¥é“å®ƒæ˜¯å®ç°ç½‘ç»œâ€œåˆ†ç»„â€çš„å…ƒè€ï¼Œä¹Ÿå°±æ˜¯å®ç°äº‘ç½‘ç»œï¼ˆè™šæ‹Ÿçš„å‡è±¡ï¼‰çš„åŸºçŸ³ã€‚ä»Šå¤©æˆ‘æ¥çœ‹çœ‹ç½‘ç»œä¸­çš„å¦ä¸€ä½å…ƒè€ï¼Œèµ°ç§é¼»ç¥–GREã€‚</p>
<h3 id="ä»€ä¹ˆæ˜¯èµ°ç§"><a href="#ä»€ä¹ˆæ˜¯èµ°ç§" class="headerlink" title="ä»€ä¹ˆæ˜¯èµ°ç§"></a>ä»€ä¹ˆæ˜¯èµ°ç§</h3><p>æ™®é€šçš„èµ°ç§ï¼Œæˆ‘ä»¬ä¸æ‰£ç»†èŠ‚çš„çœ‹ï¼Œèµ°ç§å°±æ˜¯è¿‡æµ·å…³çš„æ—¶å€™ï¼Œè¡¨é¢çœ‹æŒºæ­£å¸¸ï¼Œå®é™…é‡Œé¢è—ç€å…¶ä½ æƒ³è¦æºå¸¦çš„ä¸œè¥¿ã€‚</p>
<p>ä¾‹å­å¾ˆå¤šï¼Œæ¯”å¦‚ï¼š</p>
<p><img src="/2022/06/11/uncatalog/cl49ss3al000wlwr78qw42gtt/1.jpg" alt="image"></p>
<p>é‚£ç½‘ç»œèµ°ç§åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ ç®€å•çš„è¯´ï¼Œå°±æ˜¯åœ¨ä¸€ä¸ªå…¬å¼€çš„åè®®ä¸Šï¼Œä¼ è¾“ä¸€äº›â€œç§æœ‰çš„æ•°æ®â€ï¼Œä»è€Œå®Œæˆå¤¹å¸¦ç§è´§ã€‚</p>
<p>è¿˜æ˜¯çœ‹å›¾å±•ç¤ºä¸€ä¸‹å¤§è‡´æµç¨‹ï¼š</p>
<p><img src="/2022/06/11/uncatalog/cl49ss3al000wlwr78qw42gtt/2.png" alt="image"></p>
<p>å½“æŠ¥æ–‡çš„å‘è´§æ–¹å’Œæ”¶è´§æ–¹å•†é‡å¥½â€œè§„åˆ™â€ä¹‹åï¼Œä¸­é—´æ‰€æœ‰äººéƒ½ä¸çŸ¥é“ä»–ä»¬åœ¨ä¼ è¾“ä»€ä¹ˆå†…å®¹äº†~å› ä¸ºä¸­é—´æ£€æŸ¥éƒ½æ˜¯æ­£å¸¸çš„ã€‚</p>
<p>ä¸Šå›¾æˆ‘ä»¬ä¸¾ä¸ªå…·ä½“çš„ä¾‹å­ï¼š</p>
<p><img src="/2022/06/11/uncatalog/cl49ss3al000wlwr78qw42gtt/3.png" alt="image"></p>
<p>IPæŠ¥æ–‡çœ‹åˆ°è‡ªå·±åœ¨ä¼ è¾“TCPï¼Œæ­£å¸¸ï¼Œæ”¾è¿‡ã€‚</p>
<p>TCPçœ‹åˆ°è‡ªå·±åœ¨ä¼ è¾“HTTPï¼Œæ­£å¸¸ï¼Œæ”¾è¿‡ã€‚</p>
<p>HTTPæ£€æŸ¥æ­£å¸¸ï¼Œæ”¾è¿‡ã€‚</p>
<p>è°èƒ½çŸ¥é“ï¼Œæˆ‘åªæ˜¯é€šè¿‡HTTPèµ°ç§ç‚¹â€œå¹²è´§â€ï¼Ÿ</p>
<p>è¿™é‡Œä»£è¡¨ç€ï¼šåªè¦åœ¨ç½‘ç»œä¸Šï¼Œæœ‰ä¸€ç§åè®®æ˜¯é€šçš„ï¼Œä½ å°±æ— æ³•é˜»æ­¢é€šè¿‡è¿™ä¸ªå…¬å¼€çš„åè®®ä¼ è¾“ç‰¹å®šçš„å†…å®¹ã€‚</p>
<p>è¿™å°±æ˜¯ç½‘ç»œèµ°ç§äº†ã€‚</p>
<h3 id="GREæ˜¯æ€ä¹ˆèµ°ç§çš„"><a href="#GREæ˜¯æ€ä¹ˆèµ°ç§çš„" class="headerlink" title="GREæ˜¯æ€ä¹ˆèµ°ç§çš„"></a>GREæ˜¯æ€ä¹ˆèµ°ç§çš„</h3><p>å…ˆçœ‹çœ‹GREæŠ¥æ–‡çš„æ ¼å¼ï¼Œç„¶åçœ‹çœ‹ä¸Šä¸€ç« èŠ‚èµ°ç§çš„ä»‹ç»ï¼Œå°±ä¼šæ˜ç™½ã€‚</p>
<p><img src="/2022/06/11/uncatalog/cl49ss3al000wlwr78qw42gtt/3.jpg" alt="image"></p>
<p>æˆ‘æŠŠæˆ‘è¦ä¼ è¾“çš„å†…å®¹ï¼ˆç»¿è‰²éƒ¨åˆ†ï¼‰ï¼Œæ”¾åœ¨ä¸€ä¸ªå…¬å¼€çš„IPæŠ¥æ–‡é‡Œé¢ï¼ˆé»„è‰²éƒ¨åˆ†ï¼‰ã€‚</p>
<p>è¿™é‡Œå°±å¥½åƒï¼Œé»„è‰²éƒ¨åˆ†èµ°æ­£å¸¸é€šé“ï¼Œå¦‚é»„è‰²åœ°å€å…ˆä»ç¾å›½å‘è´§åˆ°ä¸­å›½ï¼Œæ­£å¸¸é€šè¿‡ã€‚</p>
<p>åœ¨æˆåŠŸåˆ°è¾¾ä¸­å›½ä¹‹åï¼Œé‚£å°±æ˜¯æœ¬ç«¯å†…éƒ¨æå®šäº†ã€‚æ‹¿å‡ºç»¿è‰²éƒ¨åˆ†ï¼Œè¿˜æœ‰ä¸€å±‚åœ°å€å‘¢ï¼Œç„¶åå›½å†…çœŸæ­£å‘å¾€æƒ³è¦çš„å®¢æˆ·ã€‚è‡³æ­¤GREèµ°ç§è¿‡ç¨‹å®Œæˆã€‚</p>
<h3 id="ä¸ºä»€ä¹ˆå«GREéš§é“"><a href="#ä¸ºä»€ä¹ˆå«GREéš§é“" class="headerlink" title="ä¸ºä»€ä¹ˆå«GREéš§é“"></a>ä¸ºä»€ä¹ˆå«GREéš§é“</h3><p>èµ°ç§çš„æ–¹å¼æœ‰å¾ˆå¤šï¼Œé•¿æœŸèµ°ç§çš„è¯ï¼Œéš§é“æ˜¯ä¸€ç§æ¯”è¾ƒå¥½çš„ç†è§£æ˜¯æ–¹å¼ã€‚</p>
<p>çœ‹æˆ‘æ‰¾çš„å›¾ä½ å°±æ˜ç™½äº†ï¼š</p>
<p><img src="/2022/06/11/uncatalog/cl49ss3al000wlwr78qw42gtt/5.jpg" alt="image"></p>
<p><img src="/2022/06/11/uncatalog/cl49ss3al000wlwr78qw42gtt/6.jpg" alt="image"></p>
<p><img src="/2022/06/11/uncatalog/cl49ss3al000wlwr78qw42gtt/7.jpg" alt="image"></p>
<p>å½“ä½ æŠŠè´§ç‰©æºæºä¸æ–­çš„ä»èµ°ç§é€šé“ä¼ è¾“çš„æ—¶å€™ï¼Œå®ƒå°±åƒä¸€ä¸ªéš§é“ä¸€æ ·ï¼Œä¸åœçš„æµåŠ¨èµ·æ¥ã€‚è¿™ä¸ªå°±æ˜¯GREéš§é“åè®®äº†ã€‚</p>
<h3 id="GREéš§é“å’Œäº‘ç½‘ç»œ"><a href="#GREéš§é“å’Œäº‘ç½‘ç»œ" class="headerlink" title="GREéš§é“å’Œäº‘ç½‘ç»œ"></a>GREéš§é“å’Œäº‘ç½‘ç»œ</h3><p><img src="/2022/06/11/uncatalog/cl49ss3al000wlwr78qw42gtt/8.png" alt="image"></p>
<p>è¿™ç§èµ°ç§æ–¹å¼ï¼Œç”¨åœ¨äº‘ç½‘ç»œé‡Œé¢ï¼Œå…¶å®å°±æ˜¯å¼ ä¸‰çš„è´§ï¼Œé€šè¿‡æ­£å¸¸é€šé“å…ˆä»ç¾å›½å‘å¾€ä¸­å›½ï¼Œå½“åˆ°è¾¾ä¸­å›½ä¹‹åï¼Œå†å†…éƒ¨åˆ†å‘ï¼Œä»è€Œå®Œæˆâ€œèµ°ç§éš§é“â€ã€‚</p>
<p>è¿™æ ·å¼ ä¸‰èµ°å¼ ä¸‰çš„èµ°ç§éš§é“ï¼Œæå››èµ°æå››çš„èµ°ç§é€šé“ï¼Œåœ¨æ„ŸçŸ¥ä¸Šï¼Œä¸¤ä¸ªäººæ˜¯äº’ç›¸ä¸ç›¸å¹²çš„ï¼Œä»è€Œå½¢æˆè™šæ‹Ÿç½‘ç»œé€šä¿¡ã€‚ï¼ˆåœ¨åŒä¸€ä¸ªçº¿è·¯ä¸Šï¼Œä½ èµ°ä½ çš„ï¼Œæˆ‘èµ°æˆ‘çš„ï¼Œäº’ç›¸ä¸æ„ŸçŸ¥ï¼Œå¯ä»¥å‚è§ä¸Šä¸€èŠ‚çš„vlané—¨æ´¾ä»‹ç»ï¼Œäº‘ç½‘ç»œåŸºçŸ³ç« èŠ‚ï¼‰ã€‚</p>
<p>VPNéš§é“ï¼Œå…¶å®ç”¨çš„å°±æ˜¯ä¸Šå›¾è¿™æ ·çš„æ¨¡å¼ï¼ŒæŠŠä¸€ç«¯çš„å±€åŸŸç½‘ï¼Œå’Œè¿œå¤„å¦ä¸€ç«¯çš„å±€åŸŸç½‘ï¼Œéšå«çš„â€œæ¡¥æ¥â€èµ·æ¥ã€‚</p>
<p><img src="/2022/06/11/uncatalog/cl49ss3al000wlwr78qw42gtt/9.png" alt="image"><br>å·¦è¾¹çš„äººï¼Œè®¤ä¸ºå’Œå³è¾¹çš„äººåœ¨åŒä¸€ä¸ªå±€åŸŸç½‘é‡Œé¢ã€‚ä¸­é—´çš„ç½‘ç»œåªæ˜¯èµ°ç§çš„é€šé“çš„â€œè½½ä½“â€è€Œå·²ï¼Œçœ‹ä¸åˆ°ï¼Œä¹Ÿä¸ç”¨å…³å¿ƒã€‚ï¼ˆpsï¼Œå› ä¸ºæœ‰æ‰¿è½½éš§é“çš„è¿™ç§è½½ä½“èƒ½åŠ›ï¼Œä¹Ÿå°±æ˜¯å¯ä»¥åœ¨ä¸€ç§åè®®ä¸Šï¼Œè·‘å¦ä¸€ä¸ªç½‘ç»œåè®®ã€‚æ‰€ä»¥è¿™ç§éš§é“ç½‘ç»œï¼Œæœ‰æ—¶å€™ä¹Ÿå¯ä»¥å« OverLay ç½‘ç»œï¼‰ã€‚</p>
<p>è¿™æ ·éš§é“å°±æœ‰èƒ½æŠŠå¤šä¸ªä¸åŒåœ°æ–¹çš„å±€åŸŸç½‘â€œè¿æ¥â€åœ¨ä¸€èµ·èƒ½åŠ›ï¼Œä»è€Œå½¢æˆäº†äº‘ç½‘ç»œçš„æ¨¡å‹ã€‚</p>
<p>æŠŠä¸¤å¤´çš„å±€åŸŸç½‘â€œé€æ˜â€çš„æ¥åœ¨ä¸€èµ·ï¼Œè¿™ä¸ªå°±æ˜¯éš§é“çš„é­…åŠ›äº†ã€‚å¯ä»¥çœ‹åˆ°kubernetesé‡Œé¢çš„flannelç½‘ç»œï¼Œç”¨çš„å°±æ˜¯è¿™ç§éš§é“åŸç†ã€‚</p>
<p><img src="/2022/06/11/uncatalog/cl49ss3al000wlwr78qw42gtt/10.png" alt="image"></p>
<p>ä½ çœ‹å®ƒå¯ä»¥æŠŠæ¯ä¸ªèŠ‚ç‚¹ä¸Šé¢çš„å±€åŸŸç½‘ï¼Œå…¨éƒ¨æ¥åœ¨ä¸€èµ·ï¼Œè®©ä¸åŒèŠ‚ç‚¹é‡Œé¢çš„å®¹å™¨ä»¥ä¸ºè‡ªå·±åœ¨ä¸€ä¸ªå¤§çš„ç›¸åŒçš„å±€åŸŸç½‘é‡Œé¢</p>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>ä½ çœ‹ï¼Œä»vlanã€greçš„å‡ºç°ï¼Œä¸€å¼€å§‹åªæ˜¯ä¸ºäº†è§£å†³æŠ¥æ–‡åˆ†é—¨åˆ«ç±»ã€äº’ä¸å¹²æ‰°ï¼Œåˆ°ä»–ä»¬é€æ¸åœ¨äº‘ç½‘ç»œé‡Œé¢å¤§å±•èº«æ‰‹æˆä¸ºäº‘ç½‘ç»œçš„åŸºçŸ³ã€‚è¿™é‡Œé¢å…¶å®æ ¸å¿ƒçš„æ€è·¯å°±æ˜¯ï¼šæ‰€æœ‰çš„äº‘ç½‘ç»œï¼Œå…¶å®éƒ½æ˜¯éšœçœ¼æ³•ã€‚ä¹Ÿå°±æ˜¯ä½ æƒ³è®©å®ƒï¼ˆè™šæ‹Ÿæœº/å®¹å™¨ï¼‰çœ‹åˆ°å®ƒä»¥ä¸ºçš„æ ·å­ã€‚å³å®ƒè‡ªå·±æ˜¯ä¸èƒ½å‘ç°è‡ªå·±åœ¨çœŸå®ç½‘ç»œé‡Œé¢è¿˜æ˜¯è™šæ‹Ÿç½‘ç»œé‡Œé¢çš„ã€‚è¿™ä¸ªè·Ÿä¸€ä¸ªappç¨‹åºï¼Œè‡ªå·±æ˜¯ä¸çŸ¥é“è‡ªå·±è·‘åœ¨è™šæ‹Ÿæœºé‡Œé¢ï¼Œè¿˜æ˜¯è·‘åœ¨ç‰©ç†æœºé‡Œé¢æ˜¯ä¸€æ ·çš„ã€‚</p>
<p>è¿™ç§å¯¹äºçœŸå®ä¸–ç•Œçš„æ¨¡æ‹Ÿï¼Œä½¿å¾—ç›®æ ‡çœ‹åˆ°çš„å‡è±¡è·ŸçœŸçš„ä¸€æ ·ï¼Œä¸ä»…ä»…æ˜¯äº‘ç½‘ç»œï¼Œæ›´æ˜¯äº‘çš„æœ¬è´¨ã€‚</p>
]]></content>
      <tags>
        <tag>äº‘åŸç”ŸåŸºç¡€ç³»åˆ—</tag>
        <tag>Kubernetesç½‘ç»œ</tag>
      </tags>
  </entry>
  <entry>
    <title>Kubernetesç½‘ç»œç³»åˆ—ä¹‹(åä¸‰)ipå‘½ä»¤</title>
    <url>/2022/06/11/uncatalog/cl49t00i2000zlwr72uaw2411/</url>
    <content><![CDATA[<hr>
<span id="more"></span>



<hr>
<blockquote>
<p>ipå‘½ä»¤ä½œä¸ºLinuxç½‘ç»œæ§åˆ¶çš„é­”æ³•æ£’ï¼Œä½¿å¾—ä½ å¯ä»¥è‡ªå¦‚çš„æŒæ§ç½‘ç»œä¿¡æ¯ã€‚ç‰¹åˆ«æ˜¯netnså­å‘½ä»¤ï¼Œå…è®¸ä½ åœ¨ç°å®ä¸–ç•ŒæŒ¥åŠ¨æ¡£æ†ï¼Œå°±å¯ä»¥æ“æ§é‚£ä¸ªè™šæ‹Ÿå‡ºæ¥çš„â€œç½‘ç»œä¸–ç•Œâ€é‡Œé¢çš„å„ç§å‚æ•°ã€‚æ˜¯æœªæ¥é¨æ¸¸äº‘ç½‘ç»œçš„å¿…å¤‡å‘½ä»¤è¡Œå·¥å…·ã€‚</p>
</blockquote>
<h3 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h3><p>å…¶å®åˆ°ç›®å‰ä¸ºæ­¢ï¼Œç‰©ç†ä¸–ç•Œçš„ç½‘ç»œåŸºæœ¬è®²çš„å·®ä¸å¤šäº†ã€‚ä½†æ˜¯ä¸ºäº†æ›´å¥½çš„ç©è½¬è™šæ‹Ÿç½‘ç»œï¼Œæœ‰å¿…è¦åŠ å¼ºä¸€ä¸‹åœ¨ç°å®ä¸–ç•Œä¸­çš„å‘½ä»¤è¡Œèƒ½åŠ›ã€‚å°±åƒä½ è¦è¿›å…¥é­”æ³•ä¸–ç•Œä¹‹å‰ï¼Œå…ˆæŠŠè‡ªèº«èƒ½åŠ›æ‰“é€ çš„æ£’æ£’å“’ä¸€æ ·ï¼Œè¿™æ ·ä½ åœ¨é­”æ³•ä¸–ç•Œé‡Œé¢æ‰ä¸ä¼šè¿·å¤±ã€‚</p>
<h3 id="ipå‘½ä»¤ä»‹ç»"><a href="#ipå‘½ä»¤ä»‹ç»" class="headerlink" title="ipå‘½ä»¤ä»‹ç»"></a>ipå‘½ä»¤ä»‹ç»</h3><p>å¤§å®¶çŸ¥é“ï¼Œè¦çœ‹æœ¬æœºç½‘å¡çš„IPåœ°å€ï¼Œä¸€èˆ¬ä½¿ç”¨ifconfigå‘½ä»¤ã€‚è¦çœ‹æœ¬æœºçš„è·¯ç”±è¡¨ç”¨routeå‘½ä»¤ï¼Œå¯¹å§ã€‚ä½†æ˜¯éšç€ç½‘ç»œåŠŸèƒ½è¶Šæ¥è¶Šä¸°å¯Œï¼Œç”šè‡³è™šæ‹Ÿç½‘ç»œçš„å‡ºç°ï¼Œè¿™äº›åˆ†æ•£çš„Linuxå‘½ä»¤æœ‰äº›è·Ÿä¸ä¸ŠèŠ‚å¥äº†ã€‚æ‰€ä»¥åé¢åˆæ–°æå‡ºäº†ä¸€ä¸ªipå‘½ä»¤ï¼Œè¿™ä¸ªipå‘½ä»¤åŠŸèƒ½åŒ…å«äº†åŸºç¡€çš„å„ç±»ç½‘ç»œæ§åˆ¶èƒ½åŠ›ï¼ŒåŒæ—¶æ—¨åœ¨æ›¿ä»£æ—©æœŸçš„é‚£ä¸ªifconfigï¼Œrouteç­‰å‘½ä»¤ã€‚</p>
<p><img src="/2022/06/11/uncatalog/cl49t00i2000zlwr72uaw2411/1.png" alt="image"></p>
<p>ä½¿ç”¨ipå‘½ä»¤ï¼Œåªéœ€ä¸€ä¸ªå‘½ä»¤ï¼Œä½ å°±èƒ½å¾ˆè½»æ¾åœ°æ‰§è¡Œä¸€äº›ç½‘ç»œç®¡ç†ä»»åŠ¡ã€‚ä½†æ˜¯åŠŸèƒ½å…¶å®å¤ªå¼ºå¤§ï¼Œä½ ä¹Ÿä¸ä¼šéƒ½ç”¨ï¼Œæˆ‘è¿™é‡Œå°±è¯´å‡ ä¸ªæˆ‘è®¤ä¸ºå€¼å¾—å­¦ä¼šç”¨çš„å‡ ä¸ªã€‚</p>
<ul>
<li><p>ç®¡ç†ipåœ°å€ï¼š    ip addr</p>
</li>
<li><p>ç®¡ç†è·¯ç”±è¡¨ï¼š    ip route</p>
</li>
<li><p>ç®¡ç†ç½‘å¡ï¼š       ip link</p>
</li>
<li><p>ç®¡ç†ç½‘ç»œç©ºé—´ï¼šip netns</p>
</li>
</ul>
<p>è¿™å‡ ä¸ªå­¦ä¸€å­¦ï¼Œæ•²ä¸€æ•²çœ‹çœ‹ã€‚</p>
<h3 id="ipå‘½ä»¤ä¸¾ä¾‹"><a href="#ipå‘½ä»¤ä¸¾ä¾‹" class="headerlink" title="ipå‘½ä»¤ä¸¾ä¾‹"></a>ipå‘½ä»¤ä¸¾ä¾‹</h3><p>æ¯”å¦‚çœ‹ ip addr æ€ä¹ˆç”¨å¯ä»¥æ•²ï¼š</p>
<p>ip addr help</p>
<p><img src="/2022/06/11/uncatalog/cl49t00i2000zlwr72uaw2411/2.png" alt="image"></p>
<p>ç„¶åæ ¹æ®æç¤ºï¼Œæ•²å…¥å¯¹åº”çš„å‘½ä»¤ï¼Œæ¯”å¦‚æˆ‘ä»¬çœ‹çœ‹å„ä¸ªç½‘å¡çš„IPåœ°å€ï¼š</p>
<p><img src="/2022/06/11/uncatalog/cl49t00i2000zlwr72uaw2411/3.png" alt="image"></p>
<p>è¿™ä¸€èŠ‚çš„ipå‘½ä»¤ï¼Œä¸»è¦æ˜¯è®©å¤§å®¶äº†è§£è¿™ä¸ªå‘½ä»¤åœ¨æœªæ¥çš„è™šæ‹Ÿç½‘ç»œé‡Œé¢ï¼Œéå¸¸æœ‰ç”¨ã€‚ç‰¹åˆ«æ˜¯ addrï¼Œlinkï¼Œrouteï¼Œnetns è¿™4ä¸ªå­å‘½ä»¤ï¼Œå…·ä½“æ€ä¹ˆç”¨éœ€è¦å¤§å®¶è‡ªå·±å°è¯•ä¸€ä¸‹ã€‚ä¸ç”¨èƒŒä¸‹æ¥ï¼Œç”¨çš„æ—¶å€™ï¼ŒçŸ¥é“æœ‰è¿™ä¸ªå·¥å…·ï¼Œç„¶åå¤šæ•²helpå°±è¡Œã€‚</p>
<h3 id="ip-netns-å‘½ä»¤"><a href="#ip-netns-å‘½ä»¤" class="headerlink" title="ip netns å‘½ä»¤"></a>ip netns å‘½ä»¤</h3><p>æœ¬ç« èŠ‚çš„å¦ä¸€ä¸ªé‡ç‚¹å°±æ˜¯ä»‹ç» ip netns å‘½ä»¤ï¼Œæ¯•ç«Ÿå…¶ä»–addrï¼Œrouteè¿™ç§è¿˜æœ‰æ—©æœŸçš„ifconfigç­‰ä»£æ›¿ä»£æ›¿ï¼Œè€Œip netnsæ˜¯ä½ ç«™åœ¨ç‰©ç†ä¸–ç•Œä¸­ï¼ŒæŒ‡æŒ¥è™šæ‹Ÿä¸–ç•Œçš„â€œé­”æ³•æ£’â€ã€‚ä½ å¯ä»¥åœ¨å½“å‰æœºå™¨ä¸­ï¼Œä¸¢ä¸ªâ€œå‘½ä»¤â€ç»™é‚£ä¸ªè™šæ‹Ÿç©ºé—´ï¼Œè®©è¿™ä¸ªâ€œå‘½ä»¤â€åœ¨è™šæ‹Ÿç©ºé—´é‡Œé¢æ‰§è¡Œèµ·æ¥ã€‚</p>
]]></content>
      <tags>
        <tag>äº‘åŸç”ŸåŸºç¡€ç³»åˆ—</tag>
        <tag>Kubernetesç½‘ç»œ</tag>
      </tags>
  </entry>
  <entry>
    <title>kubernetesç½‘ç»œç³»åˆ—ä¹‹(åå››)ç½‘ç»œå‘½åç©ºé—´Network Namespace</title>
    <url>/2022/06/11/uncatalog/cl49v1eys0012lwr741221o3z/</url>
    <content><![CDATA[<hr>
<span id="more"></span>



<hr>
<blockquote>
<p>é€šè¿‡æœ¬è¯¾ï¼Œæˆ‘ä»¬é¦–å…ˆäº†è§£ç½‘ç»œå‘½åç©ºé—´ï¼ˆnetwork namespaceï¼‰çš„æ¦‚å¿µï¼Œç„¶åé€šè¿‡è™šæ‹Ÿç½‘çº¿è¿é€šè¿™ä¸ªè™šæ‹Ÿç©ºé—´å’Œä¸»æœºç©ºé—´ã€‚æœ€ååˆ†åˆ«â€œç«™åœ¨â€è¿™2ä¸ªä¸åŒä¸–ç•Œä¸­ï¼Œè§‚å¯Ÿè¿™2ä¸ªç©ºé—´ï¼Œå¹¶ä»¥æ­¤åˆ¤æ–­æŠ¥æ–‡çš„æ”¶å‘æ–¹å‘</p>
</blockquote>
<h3 id="ç½‘ç»œå‘½åç©ºé—´"><a href="#ç½‘ç»œå‘½åç©ºé—´" class="headerlink" title="ç½‘ç»œå‘½åç©ºé—´"></a>ç½‘ç»œå‘½åç©ºé—´</h3><p>å¥½äº†ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹ä¸‹æ™®é€šçš„Hostä¸»æœºé•¿ä»€ä¹ˆæ ·ï¼š</p>
<p><img src="/2022/06/11/uncatalog/cl49v1eys0012lwr741221o3z/1.jpg" alt="image"></p>
<p>å¤§æ¦‚å¦‚ä¸Šå›¾è¿™æ ·ï¼Œä½ åœ¨å®¶é‡Œæ”¶å‘ç€å„ç±»åŒ…ï¼ˆbaoï¼‰è£¹ï¼ˆwenï¼‰ã€‚</p>
<p>æœ‰ä¸€å¤©ä½ ç”¨ç¥å¥‡çš„æ–¹å¼ï¼Œåˆ›é€ äº†ä¸€ä¸ªâ€œè™šæ‹Ÿç©ºé—´â€ï¼ˆä»€ä¹ˆï¼Ÿä½ æƒ³çŸ¥é“æ€ä¹ˆåˆ›å»ºçš„ï¼Ÿå¥½å§ï¼Œè¿™ä¸ªå’±ä»¬ä¸‹ä¸€ç« èŠ‚å†è®²ï¼Œè¿™é‡Œä½ éœ€è¦å…ˆç†è§£æ¦‚å¿µï¼‰ï¼Œè¿™ä¸ªç©ºé—´æ˜¯ç‹¬ç«‹çš„ï¼Œé‡Œé¢å…³äºç½‘ç»œç›¸å…³çš„ä¸œè¥¿ä¸€åº”ä¿±å…¨ï¼Œä½ æœ‰çš„å®ƒéƒ½æœ‰ã€‚ï¼ˆå³å®ƒæ‹¥æœ‰å®Œæ•´çš„Linuxç½‘ç»œåè®®æ ˆï¼‰</p>
<p><img src="/2022/06/11/uncatalog/cl49v1eys0012lwr741221o3z/2.jpg" alt="image"></p>
<p>è¿™ä¸ªæ—¶å€™ï¼Œä½ éœ€è¦æ‰¾åˆ°ä¸€ä¸ªâ€œé€šé“â€ï¼Œä½¿å¾—æˆ‘ä»¬å¯ä»¥ä¸è¿™ä¸ªç‹¬ç«‹ç©ºé—´è¿›è¡Œäº¤äº’ã€‚</p>
<p>æ–¹æ³•å‘¢ï¼Œå°±æ˜¯åˆ›å»ºä¸€æ ¹â€œç½‘çº¿â€æŠŠ2ä¸ªä¸–é—´ç»™è¿èµ·æ¥ã€‚â€œç½‘çº¿â€åŠ å¼•å·æ˜¯å› ä¸ºè¿™ä¸ªç½‘çº¿ä¹Ÿæ˜¯è™šæ‹Ÿå‡ºæ¥çš„ï¼Œç›®å‰ä¸»è¦æœ‰TUN/TAPç‰Œå’ŒVethç‰Œä¸¤ç§ã€‚ï¼ˆé¡ºä¾¿æä¸€ä¸‹ï¼Œç›®å‰å¸‚é¢ä¸Šçœ‹åˆ°çš„è™šæ‹Ÿæœºéƒ½ç”¨Tap/Tunè¿™ä¸ªç‰Œå­çš„ç½‘çº¿ï¼Œè€Œå®¹å™¨éƒ½ç”¨Vethè¿™ä¸ªç‰Œå­çš„ç½‘çº¿ï¼‰ã€‚</p>
<p>å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬æ‰‹é‡Œæœ‰ä¸€æ ¹è™šæ‹Ÿç½‘çº¿ï¼ˆå…³äº2ç§ç½‘çº¿çš„ä»‹ç»ï¼Œä¼šå•ç‹¬å†™ï¼Œè¿™é‡Œå†æ¬¡å…ˆç•¥è¿‡ç½‘çº¿æœ¬èº«çš„ä»‹ç»ï¼‰ï¼Œäºæ˜¯æˆ‘ä»¬é€šè¿‡å®ƒï¼Œå°±å¯ä»¥å°†2ä¸ªç‹¬ç«‹çš„ä¸–ç•Œè¿æ¥èµ·æ¥ã€‚å¦‚ä¸‹å›¾</p>
<p><img src="/2022/06/11/uncatalog/cl49v1eys0012lwr741221o3z/3.jpg" alt="image"></p>
<p>æ³¨æ„äº†ï¼Œåœ¨é€šè¿‡ç½‘çº¿è¿é€š2ä¸ªä¸–ç•Œåï¼Œä½ ï¼ˆä½œä¸ºHostä¸»æœºï¼‰è¦å¾ˆå…¬å¹³çš„çœ‹å¾…è¿™ä¸ªâ€œè™šæ‹Ÿä¸–é—´â€ï¼Œä¸€å®šè¦æŠŠå®ƒå½“åšä¸€ä¸ªçœŸå®å­˜åœ¨çš„å®ä½“ã€‚</p>
<p>ä¸ºäº†æ›´å¥½ç†è§£ï¼šç°åœ¨å‡è®¾ä½ è¹²åˆ°ä¸‹å›¾â€œæˆ‘â€çš„ä½ç½®ä¸Šï¼Œç„¶åç«™åœ¨Hostâ€œæˆ‘â€çš„è§†è§’çœ‹ã€‚å¾€å·¦çœ‹ï¼Œæœ‰ä¸€ä¸ªç½‘å¡ï¼›å¾€å³çœ‹ä¹Ÿæœ‰ä¸€ä¸ªç½‘å¡ã€‚</p>
<p><img src="/2022/06/11/uncatalog/cl49v1eys0012lwr741221o3z/4.jpg" alt="image"></p>
<p>æ‰€ä»¥ä½ çœ‹åˆ°çš„ä¸–ç•Œï¼Œå¯ä»¥è·Ÿä¸‹é¢è¿™ä¸ªæ˜¯ä¸€æ ·çš„ã€‚</p>
<p>å³é€šè¿‡ä¸€æ ¹ç½‘çº¿ï¼Œé€šå¾€äº†å…¶ä»–èŠ‚ç‚¹ã€‚</p>
<p><img src="/2022/06/11/uncatalog/cl49v1eys0012lwr741221o3z/5.jpg" alt="image"></p>
<h3 id="æŠ¥æ–‡çš„æ–¹å‘"><a href="#æŠ¥æ–‡çš„æ–¹å‘" class="headerlink" title="æŠ¥æ–‡çš„æ–¹å‘"></a>æŠ¥æ–‡çš„æ–¹å‘</h3><p>ä¸ºä»€ä¹ˆæˆ‘ä»¬ä¸€å®šè¦è®¤çœŸçš„å¯¹å¾…è¿™ä¸ªâ€œè™šæ‹Ÿä¸–é—´â€ï¼Œå¹¶æŠŠå®ƒçœ‹åšä¸€ä¸ªå®é™…å­˜åœ¨çš„å®ä½“å‘¢ã€‚å› ä¸ºè¿™ä¸ªæ¶‰åŠæŠ¥æ–‡æ–¹å‘çš„é—®é¢˜ã€‚ï¼ˆä»æˆ‘è‡ªå·±çš„ç»éªŒæ¥çœ‹ï¼Œå¾ˆå¤šæ—¶å€™ï¼Œå®¹æ˜“ææ··æŠ¥æ–‡æ–¹å‘ã€‚ï¼‰</p>
<h4 id="2-1-Hostä¸»æœºè§†è§’"><a href="#2-1-Hostä¸»æœºè§†è§’" class="headerlink" title="2.1      Hostä¸»æœºè§†è§’"></a>2.1      Hostä¸»æœºè§†è§’</h4><p>å¥½äº†ï¼Œé¦–å…ˆè®©æˆ‘ä»¬å…ˆç«™ä½ä¸»æœºHostè§’åº¦çœ‹ä¸–ç•Œï¼Œå®ƒé•¿æˆè¿™ä¸ªæ ·å­ï¼š</p>
<p><img src="/2022/06/11/uncatalog/cl49v1eys0012lwr741221o3z/6.jpg" alt="image"></p>
<p>ä»â€œè™šæ‹Ÿç©ºé—´â€å‘å‡ºçš„æŠ¥æ–‡ï¼Œç»è¿‡ç½‘å¡2åˆ°æˆ‘è¿™é‡Œï¼Œå¯¹æˆ‘æ¥è¯´ï¼Œæ˜¯æ”¶åˆ°äº†æ–°æŠ¥æ–‡ã€‚ è·Ÿé€šè¿‡ç½‘å¡1æ”¶åˆ°çš„æŠ¥æ–‡ï¼Œæ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ã€‚</p>
<p>å³ï¼šç»è¿‡å®‰å…¨iptablesè§„åˆ™ï¼Œä¹Ÿæ˜¯â€œå…¥â€æ–¹å‘çš„ã€‚</p>
<h4 id="2-2-ç½‘ç»œç©ºé—´è§†è§’"><a href="#2-2-ç½‘ç»œç©ºé—´è§†è§’" class="headerlink" title="2.2      ç½‘ç»œç©ºé—´è§†è§’"></a>2.2      ç½‘ç»œç©ºé—´è§†è§’</h4><p>å¥½äº†ï¼Œç°åœ¨è®©æˆ‘ä»¬è¿›å…¥åˆ°è¿™ä¸ªâ€œè™šæ‹Ÿç©ºé—´â€ï¼Œç«™åœ¨é‡Œé¢çœ‹ä¸–ç•Œï¼Œå®ƒåº”è¯¥é•¿æˆä»€ä¹ˆæ ·ï¼Ÿ</p>
<p>å—¯ï¼Œåº”è¯¥å’Œæœ¬æ–‡çš„ç¬¬ä¸€å¼ å›¾ç‰‡ä¸€æ ·ï¼Œå› ä¸ºå®ƒæ˜¯ç‹¬ç«‹çš„å®ä¾‹ã€‚</p>
<p><img src="/2022/06/11/uncatalog/cl49v1eys0012lwr741221o3z/7.jpg" alt="image"></p>
<p>å½“ç„¶ï¼Œä»â€œä¸Šå¸â€è§’åº¦æ¥çœ‹ï¼Œæ•´ä½“å¤§æ¦‚å¦‚ä¸‹å›¾ï¼š</p>
<p><img src="/2022/06/11/uncatalog/cl49v1eys0012lwr741221o3z/8.jpg" alt="image"></p>
<p>è®°ä½äº†ï¼š</p>
<p>ç«™åœ¨â€œè™šæ‹Ÿç©ºé—´â€è§’åº¦çœ‹ï¼Œä¸»æœºHostå‘ç»™æˆ‘çš„æŠ¥æ–‡ï¼Œå¯¹æˆ‘æ¥è¯´æ˜¯å…¥æ–¹å‘ï¼ˆæ˜¯æ–°æ”¶åˆ°çš„æŠ¥æ–‡ï¼‰ã€‚è€Œæˆ‘å‘ç»™ä¸»æœºçš„æŠ¥æ–‡ï¼Œå¯¹æˆ‘æ¥è¯´ï¼Œæ˜¯å‡ºæ–¹å‘ï¼ˆæ˜¯å‘å‡ºå»çš„æŠ¥æ–‡ï¼‰ã€‚</p>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>ä»Šå¤©æˆ‘ä»¬é¦–å…ˆäº†è§£ç½‘ç»œå‘½åç©ºé—´ï¼ˆnetwork namespaceï¼‰çš„æ¦‚å¿µã€‚ç„¶åçŸ¥é“é€šè¿‡è™šæ‹Ÿç½‘çº¿ï¼Œä½¿ä¹‹ä¸ä¸»æœºHostä¸–ç•Œè¿é€šã€‚æœ€åï¼Œæˆ‘ä»¬åˆ†åˆ«â€œç«™åœ¨â€è¿™2ä¸ªä¸åŒä¸–ç•Œä¸­ï¼Œè§‚å¯Ÿè¿™ä¸ªç©ºé—´ã€‚</p>
<p>ï¼ˆ1ï¼‰åœ¨ä¸»æœºHostä¸Šï¼Œæˆ‘ä»¬å‘ç°è‡ªå·±å¤šäº†ä¸€ä¸ªç½‘å¡ï¼Œè¿™ä¸ªæ–°ç½‘å¡è¿æ¥åˆ°å¦ä¸€ä¸ªç‹¬ç«‹èŠ‚ç‚¹ï¼ˆæŠŠæ–°åˆ›å»ºçš„è™šæ‹Ÿç©ºé—´çœ‹åšå®ä½“ï¼‰ã€‚</p>
<p>ï¼ˆ2ï¼‰è€Œåœ¨è™šæ‹Ÿç©ºé—´é‡Œé¢ï¼Œæˆ‘ä»¬å°±å¥½æ¯”å¾…åœ¨ä¸€ä¸ªæ–°çš„ä¸»æœºé‡Œé¢ä¸€æ ·ã€‚</p>
<p>psï¼Œè¿™ä¸ªâ€œä½ç½®â€å¾ˆé‡è¦ï¼Œå› ä¸ºè¿™ä¸ªä¼šå½±å“æˆ‘ä»¬åˆ¤æ–­æŠ¥æ–‡çš„â€œæ¥æ”¶â€è¿˜æ˜¯â€œå‘é€â€çš„æ–¹å‘ã€‚</p>
]]></content>
      <tags>
        <tag>äº‘åŸç”ŸåŸºç¡€ç³»åˆ—</tag>
        <tag>Docker</tag>
        <tag>Kubernetesç½‘ç»œ</tag>
      </tags>
  </entry>
  <entry>
    <title>Kubernetesç½‘ç»œç³»åˆ—ä¹‹(åäº”)Vethç½‘çº¿</title>
    <url>/2022/06/11/uncatalog/cl49vyb870015lwr7gd0l1mz1/</url>
    <content><![CDATA[<hr>
<span id="more"></span>



<hr>
<blockquote>
<p>å­¦ä¹ Veth-pairçš„æ¦‚å¿µå’Œä½œç”¨ï¼Œå¹¶å®æˆ˜ä½¿ç”¨Veth + Network Namespaceæ–°å»ºäº†ä¸€ä¸ªå¯ä»¥ç‹¬ç«‹ä½¿ç”¨çš„ç½‘ç»œå‘½ä»¤ç©ºé—´ï¼Œä»è€Œè¯¦ç»†äº†è§£äº†ä¸€ä¸ªå®Œæ•´çš„ç½‘ç»œç©ºé—´æ˜¯å¦‚ä½•æ­å»ºçš„è¿‡ç¨‹ã€‚</p>
</blockquote>
<h3 id="ä»€ä¹ˆæ˜¯Veth-Pair"><a href="#ä»€ä¹ˆæ˜¯Veth-Pair" class="headerlink" title="ä»€ä¹ˆæ˜¯Veth-Pair"></a>ä»€ä¹ˆæ˜¯Veth-Pair</h3><p>Vethæ˜¯Linuxä¸­ä¸€ç§è™šæ‹Ÿå‡ºæ¥çš„ç½‘ç»œè®¾å¤‡ï¼Œvethè®¾å¤‡æ€»æ˜¯æˆå¯¹å‡ºç°ï¼Œæ‰€ä»¥ä¸€èˆ¬ä¹Ÿå«veth-pairã€‚å…¶ä½œç”¨æ˜¯åè½¬æ•°æ®æµæ–¹å‘ã€‚</p>
<p><img src="/2022/06/11/uncatalog/cl49vyb870015lwr7gd0l1mz1/1.png" alt="image"></p>
<p>ä¾‹å¦‚ï¼šå¦‚æœv-aå’Œv-bæ˜¯ä¸€å¯¹vethè®¾å¤‡ï¼Œv-aæ”¶åˆ°çš„æ•°æ®ä¼šä»v-bå‘å‡ºã€‚ç›¸åï¼Œv-bæ”¶åˆ°çš„æ•°æ®ä¼šä»v-aå‘å‡ºã€‚å…¶å®è¯´ç™½äº†ï¼ŒVethå°±æ˜¯ä¸€æ ¹â€œç½‘çº¿â€ï¼Œä½ ä»ä¸€å¤´å‘æ•°æ®ï¼Œå½“ç„¶å°±ä»å¦ä¸€å¤´æ”¶åˆ°æ•°æ®äº†ã€‚ç½‘çº¿çš„ä½œç”¨ä¸å°±æ˜¯è¿™ä¸ªä¹ˆï¼Œvethä¹Ÿä¸€æ ·ï¼ŒæŠŠæ•°æ®é€šè¿‡ä¸€å¤´â€œå¤åˆ¶â€åˆ°å¦ä¸€å¤´ã€‚</p>
<p><img src="/2022/06/11/uncatalog/cl49vyb870015lwr7gd0l1mz1/2.jpg" alt="image"></p>
<p>ç”±äºvethçš„â€œç½‘çº¿â€ç‰¹æ€§ï¼Œå®ƒå¸¸å¸¸å……å½“ç€ä¸€ä¸ªæ¡¥æ¢ï¼Œè¿æ¥ç€å„ç§è™šæ‹Ÿç½‘ç»œè®¾å¤‡ã€‚å¸¸è§ç”¨é€”æ˜¯è¿æ¥ä¸¤ä¸ªnetwok namespaceï¼Œæˆ–è€…è¿æ¥Linux-Bridgeã€OVS ä¹‹ç±»çš„ã€‚</p>
<p><img src="/2022/06/11/uncatalog/cl49vyb870015lwr7gd0l1mz1/3.jpg" alt="image"></p>
<p>Psï¼švethçš„2å¤´éƒ½ç›´æ¥è¿ç€ç½‘ç»œåè®®æ ˆï¼Œæ‰€ä»¥ä½ åˆ›å»ºä¸€ä¸ªvethå¯¹ï¼Œä¸»æœºä¸Šå°±ä¼šå¤š2ä¸ªç½‘å¡ã€‚</p>
<h3 id="å®æˆ˜æ¼”ç»ƒ"><a href="#å®æˆ˜æ¼”ç»ƒ" class="headerlink" title="å®æˆ˜æ¼”ç»ƒ"></a>å®æˆ˜æ¼”ç»ƒ</h3><p>ç°åœ¨ç”¨æˆ‘ä»¬ä¹‹å‰å­¦è¿‡çš„ ip netns å‘½ä»¤æ¥æ“ä½œ ä¸€ä¸‹æˆ‘ä»¬åˆ›å»ºçš„ç½‘ç»œç©ºé—´ã€‚</p>
<p>æ“ä½œnsç›¸å…³çš„è¾“å…¥æ ¼å¼ä¸ºï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">ip netns exec [å“ªä¸ªå‘½åç©ºé—´] [å…·ä½“è¦æ‰§è¡Œçš„å‘½ä»¤]</span><br></pre></td></tr></table></figure></div>

<h4 id="é¦–å…ˆåˆ›é€ æ–°ç©ºé—´ï¼š"><a href="#é¦–å…ˆåˆ›é€ æ–°ç©ºé—´ï¼š" class="headerlink" title="é¦–å…ˆåˆ›é€ æ–°ç©ºé—´ï¼š"></a>é¦–å…ˆåˆ›é€ æ–°ç©ºé—´ï¼š</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">ip netns add tsj</span><br></pre></td></tr></table></figure></div>

<p>è¿™æ ·å°±åˆ›é€ äº†ä¸€ä¸ªæ–°çš„â€œç½‘ç»œç©ºé—´â€ï¼Œå¯ä»¥é€šè¿‡</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">ip netns list</span><br></pre></td></tr></table></figure></div>

<p>å‘½ä»¤æŸ¥çœ‹ï¼Œç¡®å®æœ‰äº†ä¸€ä¸ªæ–°çš„nsç©ºé—´äº†ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">tsj</span><br></pre></td></tr></table></figure></div>

<p><img src="/2022/06/11/uncatalog/cl49vyb870015lwr7gd0l1mz1/4.jpg" alt="image"></p>
<p>ä½†æ˜¯è¿™ä¸ªæ—¶å€™ï¼Œå’±ä»¬è¿˜ç¼ºå°‘ä¸è¿™ä¸ªç©ºé—´è¿›è¡Œäº¤äº’çš„é€šé“ï¼Œå…‰æœ‰ç©ºé—´ï¼Œæ²¡æœ‰å…¥å£ã€‚</p>
<h4 id="ç„¶ååˆ›é€ ç½‘çº¿ï¼š"><a href="#ç„¶ååˆ›é€ ç½‘çº¿ï¼š" class="headerlink" title="ç„¶ååˆ›é€ ç½‘çº¿ï¼š"></a>ç„¶ååˆ›é€ ç½‘çº¿ï¼š</h4><p>æ¥ç€è®©æˆ‘ä»¬æ¥åˆ›é€ ä¸€æ ¹Vethç‰Œç½‘çº¿ï¼š</p>
<p>å‘½ä»¤æ ¼å¼æ˜¯ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">ip link add [ç½‘çº¿ä¸€å¤´åå­—] type veth peer name [ç½‘çº¿å¦ä¸€å¤´åå­—]</span><br></pre></td></tr></table></figure></div>

<p>æ‰€ä»¥å¦‚ä¸‹ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">ip link add tsj-0 type veth peer name tsj-1</span><br></pre></td></tr></table></figure></div>

<p><img src="/2022/06/11/uncatalog/cl49vyb870015lwr7gd0l1mz1/5.jpg" alt="image"></p>
<h4 id="ç½‘çº¿ç”Ÿæ•ˆï¼š"><a href="#ç½‘çº¿ç”Ÿæ•ˆï¼š" class="headerlink" title="ç½‘çº¿ç”Ÿæ•ˆï¼š"></a>ç½‘çº¿ç”Ÿæ•ˆï¼š</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">ifconfig tsj-0 up</span><br><span class="line"></span><br><span class="line">ifconfig tsj-1 up</span><br></pre></td></tr></table></figure></div>

<p>ï¼ˆæˆ–è€…ï¼š<code>ip link set tsj-0 up</code>ï¼Œçœ‹è¿‡ä»¥å‰çš„ipå‘½ä»¤è¯¾ç¨‹çš„ï¼Œå°±çŸ¥é“è¿™2ç§å‘½ä»¤æ•ˆæœæ˜¯ä¸€æ ·çš„ï¼‰</p>
<p>è¿™ä¸ªæ—¶å€™å¯ä»¥é€šè¿‡ifconfigçœ‹åˆ°è¿™2ä¸ªç½‘å¡äº†ã€‚</p>
<p><img src="/2022/06/11/uncatalog/cl49vyb870015lwr7gd0l1mz1/6.jpg" alt="image"></p>
<h4 id="ç½‘çº¿ä¸€å¤´ä¼¸å…¥åˆ°æ–°å»ºçš„ç©ºé—´"><a href="#ç½‘çº¿ä¸€å¤´ä¼¸å…¥åˆ°æ–°å»ºçš„ç©ºé—´" class="headerlink" title="ç½‘çº¿ä¸€å¤´ä¼¸å…¥åˆ°æ–°å»ºçš„ç©ºé—´"></a>ç½‘çº¿ä¸€å¤´ä¼¸å…¥åˆ°æ–°å»ºçš„ç©ºé—´</h4><p>ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">ip link set tsj-1 netns tsj</span><br></pre></td></tr></table></figure></div>

<p>å°†<code>tsj-1</code>çš„ç½‘çº¿å¤´å­ï¼Œæ”¾å…¥<code>tsj</code>è¿™ä¸ªè™šæ‹Ÿç©ºé—´ä¸­ã€‚</p>
<p>æ³¨æ„ï¼Œç½‘çº¿è¿˜æœ‰ä¸€å¤´<code>tsj-0</code>ä»ç„¶åœ¨Hostä¸»æœºç©ºé—´ä¸­çš„ã€‚</p>
<p><img src="/2022/06/11/uncatalog/cl49vyb870015lwr7gd0l1mz1/7.jpg" alt="image"></p>
<h4 id="æŠŠç½‘å¡å‘½åä¸º-eth0"><a href="#æŠŠç½‘å¡å‘½åä¸º-eth0" class="headerlink" title="æŠŠç½‘å¡å‘½åä¸º eth0"></a>æŠŠç½‘å¡å‘½åä¸º <code>eth0</code></h4><p>é‡å‘½åç½‘å¡ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">ip netns exec tsj ip link set tsj-1 name eth0</span><br></pre></td></tr></table></figure></div>

<p>ç„¶åæŠŠè¿™ä¸ªç½‘çº¿å¤´å­ç”Ÿæ•ˆä¸€ä¸‹ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">ip netns exec tsj ip link set eth0 up</span><br><span class="line"></span><br><span class="line">ip netns exec tsj ip link set lo up #ï¼ˆé¡ºä¾¿æŠŠlocalç½‘å¡ä¹Ÿç”Ÿæ•ˆäº†ï¼‰</span><br></pre></td></tr></table></figure></div>

<p>æŸ¥è¯¢ç»“æœï¼Œå¯ä»¥çœ‹åˆ°æ–°å»ºçš„è™šæ‹Ÿç½‘ç»œç©ºé—´é‡Œé¢ï¼Œæœ‰ä¸€ç§æ¯”è¾ƒç†Ÿæ‚‰çš„æ„Ÿè§‰ã€‚</p>
<p><img src="/2022/06/11/uncatalog/cl49vyb870015lwr7gd0l1mz1/8.jpg" alt="image"></p>
<p><img src="/2022/06/11/uncatalog/cl49vyb870015lwr7gd0l1mz1/9.jpg" alt="image"></p>
<h4 id="ç»™ç½‘å¡è®¾ç½®IPåœ°å€"><a href="#ç»™ç½‘å¡è®¾ç½®IPåœ°å€" class="headerlink" title="ç»™ç½‘å¡è®¾ç½®IPåœ°å€"></a>ç»™ç½‘å¡è®¾ç½®IPåœ°å€</h4><p>tsjç©ºé—´é‡Œé¢çš„IPè®¾ç½®ä¸ºï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">ip netns exec tsj ip addr add 10.254.1.1/24 dev eth0</span><br></pre></td></tr></table></figure></div>

<p>Hostä¸»æœºä¸Šé¢çš„IPè®¾ç½®ä¸ºï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">ip addr add 10.254.1.2/24 dev tsj-0</span><br></pre></td></tr></table></figure></div>

<p>OKï¼Œå½“å‰å¤§å®¶IPéƒ½é…ç½®å¥½äº†ã€‚ç°åœ¨æˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹è¿é€šæ€§ã€‚ä»ç½‘ç»œç©ºé—´ï¼Œping ä¸»æœºç©ºé—´ã€‚</p>
<h4 id="éªŒè¯è¿é€šæ€§"><a href="#éªŒè¯è¿é€šæ€§" class="headerlink" title="éªŒè¯è¿é€šæ€§"></a>éªŒè¯è¿é€šæ€§</h4><p>Hostä¸»æœºè¿™è¾¹å…ˆç›‘å¬ï¼ˆæ–°å¼€ä¸€ä¸ªçª—å£ï¼‰ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">tcpdump -i tsj-0 -n icmp</span><br></pre></td></tr></table></figure></div>

<p>æ–°å»ºç©ºé—´é‡Œé¢ï¼Œå‘èµ·pingï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">ip netns exec tsj ping 10.254.1.2</span><br></pre></td></tr></table></figure></div>

<p><img src="/2022/06/11/uncatalog/cl49vyb870015lwr7gd0l1mz1/10.jpg" alt="image"></p>
<p>å¯ä»¥çœ‹åˆ°ä¸¤è¾¹çš„æ•ˆæœï¼Œæ–°å»ºç©ºé—´é‡Œé¢ï¼šï¼ˆå‘å‡ºpingæŠ¥æ–‡ï¼‰</p>
<p><img src="/2022/06/11/uncatalog/cl49vyb870015lwr7gd0l1mz1/11.png" alt="image"></p>
<p>ä¸»æœºç©ºé—´é‡Œé¢ï¼šï¼ˆå¯¹Hostä¸»æœºæ¥è¯´ï¼Œæ˜¯æ”¶åˆ°æ–°æŠ¥æ–‡ï¼‰</p>
<p><img src="/2022/06/11/uncatalog/cl49vyb870015lwr7gd0l1mz1/12.png" alt="image"></p>
<p>å¥½å•¦ï¼Œåˆ°è¿™é‡Œï¼Œå®Œæ•´çš„ç½‘ç»œç©ºé—´åŸºæœ¬é•¿æˆäº†ã€‚</p>
<p>é­”æ³•å¸ˆåŒå¿—ï¼Œæ­å–œå­¦æˆç½‘ç»œè™šæ‹ŸåŒ–ç¬¬ä¸€æ­¥ã€‚</p>
<p>ï¼ˆpsï¼šDockeråˆ›å»ºå®¹å™¨ç½‘ç»œï¼Œè¿‡ç¨‹åŸç†è·Ÿä¸Šé¢æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯æŠŠcliæ”¹ä¸ºä½¿ç”¨ç³»ç»Ÿè°ƒç”¨ï¼Œå¹¶ä¸”åšäº†è‡ªåŠ¨åŒ–ï¼‰</p>
<h3 id="é«˜é˜¶"><a href="#é«˜é˜¶" class="headerlink" title="é«˜é˜¶"></a>é«˜é˜¶</h3><h4 id="åœ¨æ–°ç©ºé—´ä¸­å¯åŠ¨è½¯ä»¶"><a href="#åœ¨æ–°ç©ºé—´ä¸­å¯åŠ¨è½¯ä»¶" class="headerlink" title="åœ¨æ–°ç©ºé—´ä¸­å¯åŠ¨è½¯ä»¶"></a>åœ¨æ–°ç©ºé—´ä¸­å¯åŠ¨è½¯ä»¶</h4><p>è¿™é‡Œæˆ‘ä»¬åœ¨æ–°åˆ›å»ºçš„tsjç©ºé—´ä¸­ï¼Œå¯åŠ¨ä¸€ä¸ªncæœåŠ¡å™¨ã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">ip netns exec tsj nc -lp 1234</span><br></pre></td></tr></table></figure></div>

<p>ä¸Šé¢è¡¨ç¤ºå¯åŠ¨ä¸€ä¸ªncçš„webæœåŠ¡å™¨ï¼Œç›‘å¬åœ¨1234ç«¯å£ã€‚</p>
<p>è¿™ä¸ªæ—¶å€™ï¼Œå’±ä»¬ç»™å®ƒå‘è¯·æ±‚ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">curl -v 10.254.1.1:1234</span><br></pre></td></tr></table></figure></div>

<p>å¯ä»¥æ­£å¸¸çš„è®¿é—®</p>
<p><img src="/2022/06/11/uncatalog/cl49vyb870015lwr7gd0l1mz1/13.png" alt="image"></p>
<h4 id="æŸ¥æ‰¾Vethå¯¹çš„å¦ä¸€ç«¯"><a href="#æŸ¥æ‰¾Vethå¯¹çš„å¦ä¸€ç«¯" class="headerlink" title="æŸ¥æ‰¾Vethå¯¹çš„å¦ä¸€ç«¯"></a>æŸ¥æ‰¾Vethå¯¹çš„å¦ä¸€ç«¯</h4><p>å¦‚æœnséå¸¸å¤šï¼Œvethä¹Ÿéå¸¸å¤šï¼ˆæ¯”å¦‚åœ¨OpenStackçš„ç½‘ç»œèŠ‚ç‚¹ä¸Šï¼‰ï¼Œæ€ä¹ˆæŸ¥æ‰¾Vethç½‘çº¿çš„å¦ä¸€å¤´åœ¨å“ªé‡Œå‘¢ï¼Ÿ</p>
<p>æ¯”å¦‚ï¼Œå’±ä»¬è¿™ä¸ªtsjæ–°ä¸–ç•Œé‡Œé¢ç½‘å¡åeth0ï¼Œå’±ä»¬å¦‚ä½•çŸ¥é“ä¸»æœºä¸Šæ˜¯tsj-0å°±æ˜¯å®ƒçš„å¯¹ç«¯å‘¢ï¼Ÿ</p>
<p>ç­”ï¼šå¯ä»¥ä½¿ç”¨ ethtool â€“S æ–¹æ³•ã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">ip netns exec tsj ethtool -S eth0</span><br><span class="line"></span><br><span class="line">NIC statistics:</span><br><span class="line"></span><br><span class="line">     peer_ifindex: 149</span><br></pre></td></tr></table></figure></div>

<p>å¯ä»¥çœ‹åˆ°å¯¹ç«¯çš„indexçš„149ã€‚è¿™ä¸ªæ—¶å€™ä¸»æœºä¸Šé¢æ•²ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">ip link list</span><br></pre></td></tr></table></figure></div>

<p>å¯çœ‹åˆ°idnexä¸º 149 çš„ç½‘å¡å…·ä½“æ˜¯å“ªä¸ªã€‚</p>
<p><img src="/2022/06/11/uncatalog/cl49vyb870015lwr7gd0l1mz1/14.jpg" alt="image"></p>
<h4 id="åˆ é™¤Vethå’ŒNS"><a href="#åˆ é™¤Vethå’ŒNS" class="headerlink" title="åˆ é™¤Vethå’ŒNS"></a>åˆ é™¤Vethå’ŒNS</h4><p>åˆ›å»ºäº†æ–°çš„ä¸–ç•Œåï¼Œæ€ä¹ˆæŠŠå®ƒæŠ¹å»å‘¢ï¼Ÿ</p>
<p>åˆ é™¤ç½‘çº¿ï¼šï¼ˆpsï¼šç½‘çº¿2å¤´ä¼šåŒæ—¶åˆ é™¤ï¼‰</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">ip link delete tsj-0</span><br></pre></td></tr></table></figure></div>

<p>åˆ é™¤nsï¼šï¼ˆpsï¼šç›´æ¥åˆ é™¤nsï¼Œä¼šè¿å¸¦vethä¸€èµ·åˆ é™¤ï¼‰</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">ip netns delete tsj</span><br></pre></td></tr></table></figure></div>

<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>å’±ä»¬å­¦ä¹ äº†Vethç½‘çº¿çš„æ¦‚å¿µå’Œä½œç”¨ï¼Œå¹¶å®æˆ˜ä½¿ç”¨Veth + Network Namespaceæ–°å»ºäº†ä¸€ä¸ªå¯ä»¥ç‹¬ç«‹ä½¿ç”¨çš„ç½‘ç»œå‘½ä»¤ç©ºé—´ï¼Œä»è€Œè¯¦ç»†äº†è§£äº†ä¸€ä¸ªå®Œæ•´çš„ç½‘ç»œç©ºé—´æ˜¯å¦‚ä½•æ­å»ºçš„è¿‡ç¨‹ã€‚</p>
]]></content>
      <tags>
        <tag>äº‘åŸç”ŸåŸºç¡€ç³»åˆ—</tag>
        <tag>Kubernetesç½‘ç»œ</tag>
      </tags>
  </entry>
  <entry>
    <title>Kubernetesç½‘ç»œç³»åˆ—ä¹‹(åå…­)TUN/TAPç½‘çº¿</title>
    <url>/2022/06/11/uncatalog/cl49wfzo90018lwr70q7u4yf0/</url>
    <content><![CDATA[<hr>
<span id="more"></span>



<hr>
<blockquote>
<p>ä»‹ç»TUN/TAPè®¾å¤‡çš„æ¦‚å¿µå’Œå¸¸è§ä½œç”¨ï¼ˆå³æ‰“é€šVMå’ŒHosté—´çš„ç½‘ç»œï¼‰ï¼Œä»¥åŠå’ŒVeth-pairç½‘çº¿çš„åŒºåˆ«ã€‚è¿™ä¸€èŠ‚å†…éƒ¨æ¯”è¾ƒç®€å•ï¼Œå› ä¸ºä¸»è¦å†…å®¹å·²ç»åœ¨Vethç½‘çº¿é‡Œé¢è®²äº†</p>
</blockquote>
<h3 id="ä»€ä¹ˆæ˜¯TUN-TAPr"><a href="#ä»€ä¹ˆæ˜¯TUN-TAPr" class="headerlink" title="ä»€ä¹ˆæ˜¯TUN/TAPr"></a>ä»€ä¹ˆæ˜¯TUN/TAPr</h3><p>TUN/TAPæ˜¯Linuxä¸­ä¸€ç§è™šæ‹Ÿå‡ºæ¥çš„ç½‘ç»œè®¾å¤‡ï¼Œç®€å•è¯´ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ç§â€œç½‘çº¿â€ï¼Œåªæ˜¯è¿™ç§ç½‘çº¿å’ŒVethç‰Œç½‘çº¿æœ‰ç‚¹ä¸åŒã€‚Vethç½‘çº¿çš„2å¤´æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯æ°´æ™¶å¤´ã€‚TUN/TAPç½‘çº¿çš„2å¤´é•¿å¾—ä¸ä¸€æ ·ï¼Œä¸€å¤´æ˜¯æ°´æ™¶å¤´ï¼Œå¦ä¸€å¤´æ˜¯USBçš„ã€‚</p>
<p><img src="/2022/06/11/uncatalog/cl49wfzo90018lwr70q7u4yf0/1.jpg" alt="image"></p>
<p>ç¨æ­£å¼ä¸€ç‚¹çš„æè¿°ï¼Œå®ƒæ˜¯ä¸€ç§ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ç©ºé—´ä¼ è¾“æŠ¥æ–‡ç”¨çš„ç½‘çº¿ã€‚ä¸€å¤´æ˜¯æ™®é€šçš„ç½‘å¡ï¼Œè·Ÿeth0ä¸€æ ·ï¼ŒHostä¸»æœºå¯ä»¥ç”¨ï¼›å¦ä¸€å¤´åˆ™æ˜¯ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œç»™ç”¨æˆ·ç©ºé—´çš„ç¨‹åºç”¨çš„ã€‚</p>
<p><img src="/2022/06/11/uncatalog/cl49wfzo90018lwr70q7u4yf0/2.jpg" alt="image"></p>
<p>å¤§å®¶éƒ½çŸ¥é“ä¸€ä¸ªVMæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªqemuè¿›ç¨‹ï¼Œæ‰€ä»¥å…¶å®TUN/TAPç½‘çº¿å¤§å¤šéƒ½æ˜¯ç»™VMç”¨çš„ã€‚å³ä¸Šå›¾çš„å³è¾¹å…¶å®å°±æ˜¯VMå•¦ï¼Œå®ƒé‡Œé¢çœ‹åˆ°çš„eth0å°±æ˜¯è™šæ‹Ÿå‡ºæ¥çš„ã€‚</p>
<p>äºæ˜¯ä½ è·ŸVethç½‘çº¿ä¸€æ ·çš„å»ç†è§£å°±è¡Œäº†ï¼Œé‚£ä¹ˆHostä¸»æœºç½‘ç»œæ¨¡å‹ä¹Ÿç±»ä¼¼ï¼š</p>
<p><img src="/2022/06/11/uncatalog/cl49wfzo90018lwr70q7u4yf0/3.jpg" alt="image"></p>
<p>å¦‚æœè¦æ·»åŠ TUNTAPç½‘å¡ï¼Œè¿˜æ˜¯ä½¿ç”¨å’±ä»¬çš„ipå‘½ä»¤ã€‚</p>
<p><img src="/2022/06/11/uncatalog/cl49wfzo90018lwr70q7u4yf0/4.png" alt="image"></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">ip tuntap add tap0 mode tap</span><br></pre></td></tr></table></figure></div>

<p>è¿™æ ·å°±å¯ä»¥ç”¨çš„appç¨‹åºï¼Œå»openæ–‡ä»¶å¥æŸ„â€œ/dev/net/tunâ€äº†ï¼Œå‘é€&amp;æ¥æ”¶æŠ¥æ–‡äº†ã€‚</p>
<p>é‚£å½“ä½ éœ€è¦å°†ä½ åˆ›å»ºçš„è¿™äº›VMè¿æ¥èµ·æ¥ç»„æˆå±€åŸŸç½‘ï¼Œæˆ–è€…ä¸å¤–ç•Œï¼ˆä¸»æœºå¤–éƒ¨ï¼‰é€šä¿¡æ—¶ï¼Œå°±éœ€è¦ç”¨ä¸ŠLinux Bridgeäº†ã€‚</p>
<p><img src="/2022/06/11/uncatalog/cl49wfzo90018lwr70q7u4yf0/5.jpg" alt="image"></p>
<p>Dockerå®¹å™¨ä¹Ÿæ˜¯è¿™æ ·ï¼Œå¦‚æœå¸Œæœ›å°†å¾ˆå¤šå®¹å™¨æŒ‰ç»„ç®¡ç†ï¼Œæˆ–è€…å®¹å™¨è¿é€šå¤–ç½‘ï¼Œä¹Ÿä¼šéœ€è¦ä½¿ç”¨Linux Bridgeï¼ˆä¸Šå›¾çš„ br0ï¼‰ã€‚è¿™ä¸ªå’±ä»¬ä¸‹èŠ‚è¯¾è®²</p>
]]></content>
      <tags>
        <tag>äº‘åŸç”ŸåŸºç¡€ç³»åˆ—</tag>
        <tag>Kubernetesç½‘ç»œ</tag>
      </tags>
  </entry>
  <entry>
    <title>Kubernetesç½‘ç»œç³»åˆ—ä¹‹(åä¸ƒ)Bridgeç½‘æ¡¥</title>
    <url>/2022/06/11/uncatalog/cl49wklgu001blwr7a55t1phs/</url>
    <content><![CDATA[<hr>
<span id="more"></span>



<hr>
<blockquote>
<p>å·²ç»è¿›å…¥åˆ°è™šæ‹ŸåŒ–çš„ä¸–ç•Œå•¦ã€‚Bridgeæ˜¯ç½‘ç»œè™šæ‹ŸåŒ–ä¸­éå¸¸é‡è¦çš„ä¸€ç§è®¾å¤‡ï¼Œå¿«æ¥ä¸€èµ·å­¦ä¹ Linux-Bridgeçš„ä½œç”¨å§ã€‚</p>
</blockquote>
<h3 id="ä»€ä¹ˆæ˜¯Linux-Bridge"><a href="#ä»€ä¹ˆæ˜¯Linux-Bridge" class="headerlink" title="ä»€ä¹ˆæ˜¯Linux-Bridge"></a>ä»€ä¹ˆæ˜¯Linux-Bridge</h3><p>å’±ä»¬ç›´æ¥è¯´äººè¯ï¼šè·Ÿtap/tunã€veth-pairæ˜¯æ¨¡æ‹Ÿç½‘çº¿çš„ç±»ä¼¼ï¼ŒBridgeä¹Ÿæ˜¯ç…§ç€ç‰©ç†è®¾å¤‡çš„æ ·å­ï¼Œåœ¨Linuxç³»ç»Ÿé‡Œé¢è™šæ‹Ÿå‡ºæ¥çš„ä¸€ç§ç½‘ç»œè®¾å¤‡ã€‚</p>
<p>å› ä¸ºå®ƒä¹Ÿæ˜¯ç½‘ç»œè®¾å¤‡ï¼Œæ‰€ä»¥å¯ä»¥é…ç½® IPã€MAC ç­‰ã€‚ç„¶åå®ƒæ¨¡æ‹Ÿçš„ç‰©ç†è®¾å¤‡å«Hubï¼ˆé›†çº¿å™¨ï¼‰ã€‚</p>
<p>1.1      ç‰©ç†é›†çº¿å™¨Hub<br>å¾ˆå¤šå°ä¼™å¯èƒ½æ²¡æœ‰è§è¿‡ï¼Œå’±ä»¬ç›´æ¥ä¸Šå›¾ï¼š</p>
<p><img src="/2022/06/11/uncatalog/cl49wklgu001blwr7a55t1phs/1.jpg" alt="image"></p>
<p>ä¸Šé¢è¿™ä¸ªä¸œè¥¿æ²¡è§è¿‡ï¼Œå¯ä»¥å‚è€ƒä¸‹é¢è¿™ä¸ªï¼ŒåŸç†æ˜¯ä¸€æ ·ä¸€æ ·çš„ã€‚</p>
<p><img src="/2022/06/11/uncatalog/cl49wklgu001blwr7a55t1phs/2.jpg" alt="image"></p>
<p>Hubçš„æ•ˆæœç±»ä¼¼äºæŠŠæ‰€æœ‰ç½‘çº¿éƒ½ç„Šåœ¨ä¸€èµ·çš„æ„Ÿè§‰ï¼š</p>
<p><img src="/2022/06/11/uncatalog/cl49wklgu001blwr7a55t1phs/3.jpg" alt="image"></p>
<p>ä¹Ÿå°±æ˜¯ä¸ç®¡ä¿¡å·ä»å“ªä¸ªå£å­è¿›æ¥ï¼Œå…¶ä»–å£å­éƒ½èƒ½æ”¶åˆ°ã€‚â€œå¤§å–‡å­â€ï¼Œâ€œå¹¿æ’­æ¡¶â€ï¼Œå¯ä»¥è¿™ä¹ˆç†è§£Hubã€‚</p>
<pre><code>æˆ‘ä»¬ä»¥å‰å¯å®¤é‡Œé¢æ‰“å°ç»„æ¸¸æˆï¼Œå°±æ˜¯å¤§å®¶æŠŠç½‘çº¿å¾€é›†çº¿å™¨ä¸€æ’ï¼Œç„¶åå°±æ˜¯ä¸€ä¸ªminiå°å±€åŸŸç½‘äº†ã€‚
</code></pre>
<p>1.2      è™šæ‹Ÿé›†çº¿å™¨Bridge<br>æ‰€ä»¥å‘¢ï¼ŒLinuxé‡Œé¢è™šæ‹Ÿå‡ºæ¥çš„è¿™ä¸ªBridgeä¹Ÿæ˜¯è¿™ä¸ªæ•ˆæœã€‚ç”¨æˆ·å¯ä»¥æŠŠå¾ˆå¤šç½‘å¡ï¼Œæ’åˆ°è¿™ä¸ªBridgeä¸Šé¢ï¼Œç„¶åäº’ç›¸ä¹‹é—´å°±èƒ½è¿é€šäº†ï¼Œäºæ˜¯å¾€Bridgeå‘æŠ¥æ–‡ï¼Œæ‰€æœ‰æ’åœ¨ä¸Šé¢çš„ç½‘å¡å…¨éƒ½æ”¶åˆ°è¿™ä¸ªæŠ¥æ–‡ã€‚ï¼ˆç›®çš„æ¯”è¾ƒå•çº¯ï¼Œå°±æ˜¯æŠŠå¤§å®¶è¿åœ¨ä¸€èµ·ï¼‰</p>
<p>ä¸€èˆ¬ç”¨æ¥æŠŠ tap/tunã€veth-pairç½‘çº¿è¿åˆ°Bridgeä¸Šé¢ï¼Œè¿™æ ·å¯ä»¥æŠŠä¸€ç»„å®¹å™¨ï¼Œæˆ–è€…ä¸€ç»„è™šæœºè¿åœ¨ä¸€èµ·ã€‚æ¯”å¦‚è‘—åçš„Dockerå°±æ˜¯ç”¨BridgeæŠŠHosté‡Œé¢çš„å®¹å™¨éƒ½è¿åœ¨ä¸€èµ·ï¼Œä½¿å¾—è¿™äº›å®¹å™¨å¯ä»¥äº’ç›¸è®¿é—®ã€‚ä¹Ÿå¯ä»¥æŠŠHostä¸Šé¢çš„ç‰©ç†ç½‘å¡ä¹ŸåŠ å…¥åˆ°Bridgeï¼Œè¿™æ ·ä¸»æœºçš„VMå°±å¯ä»¥å’Œå¤–ç•Œé€šä¿¡äº†ã€‚</p>
<p>2      å®¹å™¨ä½¿ç”¨Bridge<br><img src="/2022/06/11/uncatalog/cl49wklgu001blwr7a55t1phs/4.jpg" alt="image"></p>
<p>æŒ‰ç…§Dockerå®¹å™¨ä¸¾ä¾‹ï¼Œè¿™é‡Œä¼šæŠŠå¤šä¸ªå®¹å™¨çš„vethç½‘çº¿çš„ä¸€å¤´ï¼Œæ’å…¥åˆ°Bridgeï¼Œä½¿å¾—æ‰€æœ‰å®¹å™¨ç›¸å½“äºç„Šåœ¨ä¸€èµ·ã€‚åŒæ—¶åœ¨ä¸»æœºä¸Šï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°çš„ç½‘å¡ä¼šå¤š1ä¸ªå«docker0çš„ç½‘å¡ï¼ˆdocker0å°±æ˜¯Bridgeç½‘æ¡¥ï¼‰ï¼š</p>
<p><img src="/2022/06/11/uncatalog/cl49wklgu001blwr7a55t1phs/5.jpg" alt="image"></p>
<p>Psï¼šè¿™é‡Œæœ‰ä¸ªæœ‰æ„æ€çš„åœ°æ–¹æ˜¯ï¼Œæ²¡æœ‰æŠŠä¸»æœºä¸ŠåŸæœ‰çš„é‚£ä¸ªeth0ä¹ŸåŠ å…¥åˆ°Bridgeã€‚è€Œè™šæœºä½¿ç”¨Bridgeï¼Œä¸€èˆ¬ä¼šæŠŠåŸæ¥Hostä¸Šé¢çš„ç½‘å¡åŠ å…¥åˆ°Bridgeã€‚ï¼ˆå®¹å™¨ä¸åŠ å…¥ï¼Œä¸€æ˜¯å› ä¸ºå¤§é‡å®¹å™¨çš„IPï¼Œå¯èƒ½ä¼šå’ŒHostæ‰€åœ¨ç½‘ç»œä¸Šï¼Œå®ƒé‚£äº›å…„å¼ŸVMä»¬çš„IPå†²çªã€‚äºŒè¿˜æœ‰å®¹å™¨ç½‘ç»œæ¨¡å¼å¯ä»¥å¤šç§æ¨¡å¼é€‰æ‹©ï¼Œä¿ç•™çµæ´»æ€§ã€‚ï¼‰ã€‚</p>
<pre><code>è‡³äºå®¹å™¨æ€ä¹ˆé€šè¿‡Bridgeå’Œå¤–é¢çš„ä¸–ç•Œè¿›è¡Œé€šä¿¡ï¼Œè¿™ä¸ªå’±ä»¬åœ¨åç»­çš„ã€ŠDockerç½‘ç»œå®æˆ˜ã€‹é‡Œé¢è¯¦è§£ã€‚
</code></pre>
<p>3      è™šæœºä½¿ç”¨Bridge<br><img src="/2022/06/11/uncatalog/cl49wklgu001blwr7a55t1phs/6.jpg" alt="image"></p>
<p>è™šæœºè¿™é‡Œä¸ä¸€æ ·çš„æ˜¯ï¼Œä¸€èˆ¬ä¼šæŠŠHostè‡ªå·±åŸæ¥çš„eth0ç½‘å¡ï¼Œä¹Ÿä¸€å—åŠ å…¥åˆ°Bridgeï¼ˆå¦‚æœè™šæœºæƒ³è¦è”ç½‘çš„è¯ï¼‰ã€‚ç›¸å½“äºä¸Šé¢4ä¸ªâ€œäººâ€éƒ½æ˜¯å…„å¼Ÿäº†ï¼Œå¤§å®¶åœ¨ä¸€ä¸ªå±€åŸŸç½‘ã€‚</p>
<p>é€šè¿‡Bridgeï¼Œå¯ä»¥æŠŠæ‰€æœ‰çš„è™šæ‹Ÿæœºç½‘ç»œè¿åœ¨ä¸€èµ·ã€‚</p>
<p><img src="/2022/06/11/uncatalog/cl49wklgu001blwr7a55t1phs/7.jpg" alt="image"></p>
<p>ä¸Šé¢è¿™äº›VMä»¥ä¸ºè‡ªå·±çš„ä¸–ç•Œï¼š</p>
<p><img src="/2022/06/11/uncatalog/cl49wklgu001blwr7a55t1phs/8.jpg" alt="image"></p>
<p>åé¢ä½ å¯ä»¥å›åˆ°åŸæ¥ç‰©ç†ç½‘ç»œçš„è§†è§’å»ç†è§£æ›´é«˜çº§çš„æ€ä¹ˆç»™VMåˆ†ç»„é—®é¢˜ï¼ˆä¸æ˜ç™½çš„å¯ä»¥å›é¡¾æ—©æœŸè¯¾ç¨‹ï¼‰ã€‚è¦ç»™VMåˆ†å¸®æ´¾ï¼Œæˆ–è€…è¯´ç»™è¿™äº›VMä»¬åˆ†ä¸åŒçš„å­ç½‘ï¼Œå°±éœ€è¦èƒ½ç»™è¿™äº›VMæ‰“VLANçš„tagçš„åŠŸèƒ½ï¼Œè¿™ä¸ªåŠŸèƒ½Bridgeï¼ˆé›†çº¿å™¨ï¼‰å°±æä¸å®šäº†ï¼Œéœ€è¦å¼•å…¥æ›´é«˜çº§çš„â€œè·¯ç”±å™¨â€ã€‚</p>
<p>Psï¼šç‰©ç†ä¸–ç•Œä¹Ÿå·®ä¸å¤šï¼Œé›†çº¿å™¨çš„ä»·æ ¼å¾ˆä¾¿å®œï¼Œå’Œè·¯ç”±å™¨çš„ä»·æ ¼ä¸æ˜¯ä¸€ä¸ªæ¡£æ¬¡çš„ã€‚è·¯ç”±å™¨å¯ä»¥è®¾ç½®æ¯ä¸ªç«¯å£çš„VLANæ ‡è®°ç­‰é«˜çº§åŠŸèƒ½ã€‚ä¹Ÿå°±æ˜¯å’±ä»¬ä¸‹ä¸€æœŸçš„OVSï¼ˆOpen vSwitchï¼‰è¯¾ç¨‹äº†ã€‚</p>
<p>4      æ€ä¹ˆæŸ¥çœ‹Bridgeä¿¡æ¯<br>ä¸€èˆ¬æˆ‘éƒ½ç”¨ brctl è¿™ä¸ªå‘½ä»¤è¡Œï¼ˆipå‘½ä»¤ä¹Ÿå¯ä»¥ç”¨ï¼Œä½†æ˜¯æˆ‘æ„Ÿè§‰brctlæ›´ç›´æ¥ï¼‰ï¼Œæ¯”è¾ƒæ–¹ä¾¿ï¼š</p>
<p><img src="/2022/06/11/uncatalog/cl49wklgu001blwr7a55t1phs/9.jpg" alt="image"></p>
<p>4.1      æŸ¥è¯¢Bridgeä¿¡æ¯<br>ç”¨çš„æœ€å¤šçš„å°±æ˜¯ï¼ŒæŸ¥è¯¢ä¸€ä¸ªBridgeä¸Šé¢æ’äº†å“ªäº›ç½‘å¡ï¼šä¹Ÿå°±æ˜¯showè¿™ä¸ªå­å‘½ä»¤</p>
<p><img src="/2022/06/11/uncatalog/cl49wklgu001blwr7a55t1phs/10.png" alt="image"></p>
<p>ä¸Šé¢è¿™ä¸ªå¯ä»¥çœ‹åˆ°ï¼Œæœ‰å››ä¸ªvethç½‘å¡æ’åœ¨åå­—ä¸ºdocker0çš„Bridgeç½‘æ¡¥ä¸Šé¢ï¼ˆå…¶å®å°±æ˜¯æœ‰4ä¸ªå®¹å™¨è¿åœ¨ä¸€èµ·ï¼‰ã€‚</p>
<p>4.2      ç½‘å¡æ’å…¥Bridge<br>ç”¨çš„ç¬¬äºŒå¤šçš„å°±æ˜¯ æŠŠä¸€ä¸ªç½‘å¡æ’å…¥ä¸€ä¸ªBridgeé‡Œé¢ã€‚å³ï¼šaddif å­å‘½ä»¤</p>
<p>æˆ‘ä»¬å¯ä»¥è¯•ä¸€ä¸‹ï¼Œå…ˆåˆ›å»ºä¸€æ ¹â€œç½‘çº¿â€</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">ip link add tsj-0 type veth peer name tsj-1</span><br></pre></td></tr></table></figure></div>


<p>ç„¶ååˆ›å»ºä¸€ä¸ªBridge</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">brctl addbr tsj-br</span><br></pre></td></tr></table></figure></div>

<p>ç„¶åæŠŠç½‘çº¿ä¸€å¤´æ’å…¥è¿™ä¸ªBridgeã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">brctl addif tsj-br tsj-0</span><br></pre></td></tr></table></figure></div>

<p>æŸ¥è¯¢ç»“æœï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">brctl show tsj-br</span><br></pre></td></tr></table></figure></div>

<p><img src="/2022/06/11/uncatalog/cl49wklgu001blwr7a55t1phs/11.png" alt="image"></p>
<p>é¢ï¼Œå…¶å®â€œå®¹å™¨ä¸–ç•Œâ€ä¹Ÿæ˜¯è¿™ä¹ˆåˆ›å»ºå‡ºæ¥çš„</p>
]]></content>
      <tags>
        <tag>äº‘åŸç”ŸåŸºç¡€ç³»åˆ—</tag>
        <tag>Kubernetesç½‘ç»œ</tag>
      </tags>
  </entry>
  <entry>
    <title>Kubernetesç½‘ç»œç³»åˆ—ä¹‹(åå…«)Dockerç½‘ç»œå®ç°</title>
    <url>/2022/06/11/uncatalog/cl49wrxfs001elwr7evfs8y08/</url>
    <content><![CDATA[<hr>
<span id="more"></span>



<hr>
<blockquote>
<p>æˆ‘ä»¬æ¥è¯¦ç»†è§‚å¯Ÿ&amp;ç†è§£Dockerå®¹å™¨æ˜¯å¦‚ä½•å®ç°å®ƒçš„ç½‘ç»œçš„ï¼Œä»¥åŠè§£æä¸€ä¸ªå®¹å™¨æ˜¯å¦‚ä½•ä¸æœ¬æœºã€æœ¬æœºä¸­çš„å®¹å™¨ã€å…¶ä»–Hostã€å…¶ä»–Hostä¸­çš„å®¹å™¨ ç­‰åœºæ™¯ä¸‹åˆ†åˆ«æ˜¯å¦‚ä½•è¿›è¡Œé€šä¿¡çš„è¯¦ç»†åŸç†<br>æœ¬æœºå®¹å™¨ç½‘ç»œå¤§æ¦‚ç”Ÿæˆè¿‡ç¨‹ï¼šé¦–å…ˆæ¯ä¸ªå®¹å™¨å¯¹åº”åˆ›å»ºä¸€ä¸ªnetwork namespaceï¼›ç„¶åå°†æ‰€æœ‰çš„å®¹å™¨çš„network namespaceè¿æ¥åˆ°Bridgeç½‘æ¡¥ï¼ˆdocker0ï¼‰ä¸Šï¼Œä½¿å¾—å®¹å™¨é—´äº’ç›¸å¤„äºä¸€ä¸ªå±€åŸŸç½‘å†…ï¼Œæ–¹ä¾¿è¿é€š</p>
</blockquote>
<h3 id="Dockerçš„ç½‘ç»œå‘½åç©ºé—´"><a href="#Dockerçš„ç½‘ç»œå‘½åç©ºé—´" class="headerlink" title="Dockerçš„ç½‘ç»œå‘½åç©ºé—´"></a>Dockerçš„ç½‘ç»œå‘½åç©ºé—´</h3><p>dockerä½¿ç”¨namespaceå®ç°å®¹å™¨ç½‘ç»œï¼Œä½†æ˜¯æˆ‘ä»¬ä½¿ç”¨ip netnså‘½ä»¤å´æ— æ³•åœ¨ä¸»æœºä¸Šçœ‹åˆ°ä»»ä½•network namespaceï¼Œè¿™æ˜¯å› ä¸ºé»˜è®¤dockeræŠŠåˆ›å»ºçš„ç½‘ç»œå‘½åç©ºé—´é“¾æ¥æ–‡ä»¶éšè—èµ·æ¥äº†ã€‚</p>
<p>æœ‰2ç§è¿›å…¥è¿™ä¸ªâ€œç©ºé—´â€çš„å‘½ä»¤ï¼Œæˆ‘ä»¬ä»¥å‰çš„è¯¾éƒ½è®²è¿‡ã€‚</p>
<p>1.1      é€šè¿‡<code>ip netns exec</code><br>å¯åŠ¨ä¸€ä¸ªå®¹å™¨</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">docker run -tid ubuntu:18.04</span><br></pre></td></tr></table></figure></div>

<p>è¿™ä¸ªæ—¶å€™ï¼ŒæŸ¥è¯¢ network namespaceï¼Œå´å‘ç°æ˜¯ç©ºçš„ã€‚</p>
<p>å› ä¸º ip netns æ˜¯å»æ£€æŸ¥ /var/run/netns ç›®å½•çš„ã€‚è€ŒDockerè¿™ä¸ªè½¯ä»¶ï¼Œæ•…æ„æŠŠå®¹å™¨å¯¹åº”çš„nsä¿¡æ¯è®°å½•åˆ°äº† /var/run/docker/netns ç›®å½•ã€‚æ‰€ä»¥ip netnsæŸ¥å‡ºæ¥å°±æ˜¯ç©ºçš„ï¼Œæˆ‘ä»¬æƒ³åŠæ³•æŠŠnsä¿¡æ¯ç¿»å‡ºæ¥å°±è¡Œã€‚</p>
<p>ï¼ˆ1ï¼‰æ¢å¤å…³è”-æ–¹å¼1</p>
<p>æ‰€ä»¥æˆ‘ä»¬ï¼ŒæŠŠè¿™2ä¸ªç›®å½•å…³è”ä¸€ä¸‹ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">ln -s /var/run/docker/netns  /var/run/netns</span><br></pre></td></tr></table></figure></div>

<p>æ¥ä¸‹æ¥å†æ•²ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">ip netns</span><br></pre></td></tr></table></figure></div>

<p>å°±å¯ä»¥çœ‹åˆ°å®¹å™¨çš„ network namespace äº†ã€‚</p>
<p>ä¸è¿‡å¯ä»¥å‘ç°åˆ—å‡ºæ¥çš„nsçš„IDï¼Œå’Œå¯¹åº”å®¹å™¨çš„IDï¼Œä¸æ˜¯åŒä¸€ä¸ªã€‚ å®ƒä¸¤æœ‰ä¸€ä¸ªæ˜ å°„å€¼ï¼Œå¯ä»¥é€šè¿‡ docker inspect çš„ç»“æœæŸ¥åˆ°å¯¹åº”å…³ç³»ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">docker inspect 070044b2738f</span><br></pre></td></tr></table></figure></div>

<p><img src="/2022/06/11/uncatalog/cl49wrxfs001elwr7evfs8y08/1.png" alt="image"></p>
<p>ï¼ˆ2ï¼‰æ¢å¤å…³è”-æ–¹å¼2</p>
<p>æ‰¾åˆ°å®¹å™¨ä¸»pidï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">pid=$(docker inspect -f &#x27;&#123;&#123;.State.Pid&#125;&#125;&#x27; $&#123;container_id&#125;)</span><br></pre></td></tr></table></figure></div>

<p>åˆ›å»ºå¯¹åº”çš„nsè®°å½•ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">mkdir -p /var/run/netns/</span><br><span class="line"></span><br><span class="line">ln -sfT /proc/$pid/ns/net /var/run/netns/$container_id</span><br></pre></td></tr></table></figure></div>

<p><img src="/2022/06/11/uncatalog/cl49wrxfs001elwr7evfs8y08/2.jpg" alt="image"></p>
<p>1.2      é€šè¿‡ nsenter<br>æ‰¾åˆ°å®¹å™¨é‡Œappçš„ä¸»pidã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">docker inspect ecf8689d3297</span><br></pre></td></tr></table></figure></div>

<p><img src="/2022/06/11/uncatalog/cl49wrxfs001elwr7evfs8y08/3.jpg" alt="image"></p>
<p>è·‘åˆ°è¿™ä¸ªpidå¯¹åº”çš„ä¸–ç•Œï¼ˆnamespaceï¼‰é‡Œå»ã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">nsenter -n -t 25977</span><br></pre></td></tr></table></figure></div>

<p>è¿™ä¸ªæ—¶å€™ï¼Œå°±æ˜¯åœ¨å®¹å™¨é‡Œé¢çš„ç½‘ç»œç©ºé—´è§’åº¦æ•²å‘½ä»¤å•¦ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<p>ï¼ˆ1ï¼‰æŸ¥è¯¢ç½‘å¡ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">ifconfig</span><br></pre></td></tr></table></figure></div>

<p><img src="/2022/06/11/uncatalog/cl49wrxfs001elwr7evfs8y08/4.jpg" alt="image"></p>
<p>ï¼ˆ2ï¼‰æŠ“åŒ…ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">tcpdump -i eth0 -n</span><br></pre></td></tr></table></figure></div>

<p><img src="/2022/06/11/uncatalog/cl49wrxfs001elwr7evfs8y08/5.png" alt="image"></p>
<p>2      Docker ä½¿ç”¨çš„Linux Bridge<br>å…³äºDockerä¸ºä»€ä¹ˆè¦åŠ ä¸ªBridgeæ¥è¿é€šæ‰€æœ‰çš„å®¹å™¨ï¼Ÿå…¶å®ä¸åŠ Bridgeï¼Œç½‘ç»œä¹Ÿèƒ½é€šã€‚åªæ˜¯è¯´æœ‰äº†Bridgeï¼Œå°±æœ‰äº†è¦†ç›–æ›´å¤šå¤æ‚åœºæ™¯çš„èƒ½åŠ›ã€‚</p>
<p>è¿™é‡Œç›´æ¥å¼•ç”¨Dockerè‡ªå·±çš„æè¿°ï¼šé€šè¿‡Bridgeï¼Œå¯ä»¥ä½¿å¾—è¿åˆ°è¿™ä¸ªBridgeçš„å®¹å™¨äº’ç›¸é€šä¿¡ï¼›åŒæ—¶å’Œæ²¡æœ‰è¿åˆ°è¿™ä¸ªBridgeçš„å®¹å™¨ä¿æŒç½‘ç»œéš”ç¦»ã€‚ï¼ˆå¤§æ„å°±æ˜¯ï¼šå®¹å™¨å¯ä»¥æŒ‰ç½‘ç»œåˆ†ç»„ï¼‰</p>
<p><img src="/2022/06/11/uncatalog/cl49wrxfs001elwr7evfs8y08/6.jpg" alt="image"></p>
<p>3      æˆ‘æ€ä¹ˆå’Œæœ¬æœºHostä¸»æœºé€šä¿¡<br>å‡è®¾æˆ‘å°±æ˜¯é‚£ä¸ªDockerå®¹å™¨ï¼Œé‚£ä¹ˆæˆ‘æ˜¯å¦‚ä½•ä¸ä¸»æœºHosté€šä¿¡çš„å‘¢ã€‚</p>
<p>3.1      æœ¬æœºHostæ€ä¹ˆè®¿é—®æˆ‘<br>ä¸»æœºHostè®¿é—®è‡ªå·±èŠ‚ç‚¹ä¸Šçš„å®¹å™¨ï¼Œç­”æ¡ˆæ˜¯ï¼šç›´æ¥è®¿é—®å°±è¡Œäº†ã€‚</p>
<p>å’±ä»¬å…ˆæ¥çœ‹Hostä¸»æœºçš„è·¯ç”±è¡¨ï¼š</p>
<p><img src="/2022/06/11/uncatalog/cl49wrxfs001elwr7evfs8y08/7.png" alt="image"></p>
<p>å› ä¸ºæ ¹æ®è·¯ç”±ä¿¡æ¯ï¼š</p>
<p>æ‰€æœ‰å‘å¾€Dockerå®¹å™¨çš„åœ°å€ï¼ˆå³ç›®æ ‡ä¸º 172.17.* ï¼‰çš„æŠ¥æ–‡ï¼Œâ€”&gt; ç»Ÿç»Ÿèµ°ç»™ â€”&gt; docker0 ç½‘å¡ã€‚è€Œæ ¹æ®ä¸Šé¢Bridgeç« èŠ‚å¯ä»¥çŸ¥é“ï¼Œè¿™ä¸ªdocker0å°±æ˜¯Bridgeç½‘æ¡¥ï¼Œå®ƒæ˜¯è¿ç€æ‰€æœ‰å®¹å™¨çš„Vethç½‘çº¿çš„ã€‚æ‰€ä»¥è¿™ä¸ªæŠ¥æ–‡ä¼šå‘é€åˆ°æ‰€æœ‰å®¹å™¨é‡Œé¢ï¼Œé‚£ä¹ˆç›®æ ‡å®¹å™¨å°±ä¼šåº”ç­”ä½ ã€‚</p>
<p><img src="/2022/06/11/uncatalog/cl49wrxfs001elwr7evfs8y08/8.jpg" alt="image"></p>
<p>3.2      æˆ‘æ€ä¹ˆè®¿é—®æ‰€åœ¨çš„Hostä¸»æœº<br>å®¹å™¨è®¿é—®è‡ªå·±çš„Hostä¸»æœºï¼Œç­”æ¡ˆä¹Ÿæ˜¯ç›´æ¥è®¿é—®ã€‚</p>
<p>Dockerå®¹å™¨é‡Œé¢ï¼Œç½‘ç»œå¾ˆç®€å•ï¼Œå°±ä¸€ä¸ªeth0ã€‚æ‰€ä»¥ä½ å¾€å¤–å‘æŠ¥æ–‡ï¼Œéƒ½æ˜¯ç»è¿‡eth0ç½‘å¡ã€‚è€Œè¿™ä¸ªç½‘å¡æ˜¯ä¸€ä¸ªvethç½‘çº¿çš„ä¸€å¤´ï¼Œæ‰€ä»¥è¿™ä¸ªæŠ¥æ–‡å°±ä¼šåˆ°è¾¾Bridgeç½‘æ¡¥ï¼ˆå³docker0ï¼‰ã€‚è€Œè¿™ä¸ªç½‘æ¡¥å°±æ˜¯Hostä¸»æœºçš„ä¸€ä¸ªç½‘å¡ï¼Œæ‰€ä»¥å°±åˆ°è¾¾äº†ç›®çš„åœ°ã€‚</p>
<p><img src="/2022/06/11/uncatalog/cl49wrxfs001elwr7evfs8y08/9.jpg" alt="image"></p>
<p>ç»¼ä¸Šï¼ŒDockerå®¹å™¨å’ŒHostä¸»æœºï¼Œæ˜¯å¯ä»¥è‡ªç”±é€šä¿¡çš„ã€‚</p>
<p>3.3      æœ¬æœºå…¶ä»–å®¹å™¨æ€ä¹ˆè®¿é—®æˆ‘<br>è¿™ä¸ªé—®é¢˜ï¼Œç›´æ¥å»Bridgeç« èŠ‚çœ‹ä¸€ä¸‹å°±è¡Œäº†ã€‚å¤§å®¶éƒ½é€šè¿‡docker0è¿™ä¸ªBridgeç„Šåœ¨ä¸€èµ·ï¼Œæ‰€ä»¥ç›´æ¥äº’è®¿å°±è¡Œäº†ã€‚</p>
<p>4      æˆ‘æ€ä¹ˆå’Œåˆ«çš„Hostä¸»æœºé€šä¿¡<br>åˆ«çš„Hostä¸»æœºï¼Œå°±æ˜¯â€œçˆ¸çˆ¸ï¼ˆæ‰€åœ¨èŠ‚ç‚¹ï¼‰çš„å…„å¼Ÿâ€ã€‚</p>
<p>4.1      åˆ«çš„Hostæ€ä¹ˆè®¿é—®æˆ‘<br>è·¨èŠ‚ç‚¹è®¿é—®å®¹å™¨æ—¶ï¼Œç”±äºä¸çŸ¥é“ç›®æ ‡å®¹å™¨æ˜¯ä½åœ¨å“ªå°Hostä¸»æœºä¸Šï¼ˆè¦è®¿é—®é‚£ä¸ªå®¹å™¨ï¼Œå¿…é¡»ç»è¿‡å®ƒæ‰€åœ¨çš„Hostï¼‰ï¼Œæ‰€ä»¥ä¸ºäº†è®¿é—®ä¸€ä¸ªç›®æ ‡å®¹å™¨ä¸“é—¨è®¾ç½®ä¸€æ¡è·¯ç”±è§„åˆ™ï¼ˆå½“æˆ‘è®¿é—®xxxå®¹å™¨æ—¶ï¼Œè¯·ç»è¿‡yyyè™šæ‹Ÿæœºï¼Œè¿™ç§è§„åˆ™ï¼‰ï¼Œå¹¶ä¸æ–¹ä¾¿ã€‚æ‰€ä»¥ä¸€èˆ¬ç›´æ¥ç”¨ç«¯å£æ˜ å°„æ¥è®¿é—®ã€‚</p>
<p>å³ï¼šç›®æ ‡å®¹å™¨æ‰€åœ¨çš„Hostä¸»æœºIP + æŒ‡å®šç«¯å£ã€‚ç„¶åå½“æŠ¥æ–‡åˆ°è¾¾æŒ‡å®šç›®æ ‡çš„Hostä¸»æœºæ—¶ï¼Œé€šè¿‡æŒ‡å®šç«¯å£Natè¿›å…¥å®¹å™¨ã€‚</p>
<p><img src="/2022/06/11/uncatalog/cl49wrxfs001elwr7evfs8y08/10.jpg" alt="image"></p>
<p>ä¸¾ä¾‹ï¼š</p>
<p>ï¼ˆ1ï¼‰       åœ¨192.168.1.9è¿™å°æœºå™¨ä¸Šå¯åŠ¨ä¸€ä¸ªNginxå®¹å™¨ï¼šæ³¨æ„è¿™é‡Œ-på‚æ•°å‘Šè¯‰Hostï¼Œè¯·å°†ä¸»æœºä¸Šé¢çš„80ç«¯å£ï¼Œä½œä¸ºè¿›å…¥æˆ‘çš„NATå…¥å£ã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">docker run -rm  -p 80:80 nginx</span><br></pre></td></tr></table></figure></div>

<p>ï¼ˆ2ï¼‰       ç„¶åå’±ä»¬å†å¦å¤–æ‰¾ä¸€å°æœºå™¨ï¼ˆä¸åˆšæ‰192.168.1.9 è¿™ä¸€å°èƒ½è¿é€šï¼‰ã€‚</p>
<p>è·¨èŠ‚ç‚¹è®¿é—®åˆšæ‰é‚£ä¸ªå®¹å™¨ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">curl -vvv 192.168.1.9:80</span><br></pre></td></tr></table></figure></div>

<p><img src="/2022/06/11/uncatalog/cl49wrxfs001elwr7evfs8y08/11.png" alt="image"></p>
<p>è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œä¸»æœºè·¨èŠ‚ç‚¹è®¿é—®å®¹å™¨æ—¶ï¼Œå¿…é¡»é€šè¿‡æŒ‡å®šç«¯å£NATè¿›å…¥åˆ°ç›®æ ‡å®¹å™¨ã€‚</p>
<p><img src="/2022/06/11/uncatalog/cl49wrxfs001elwr7evfs8y08/12.jpg" alt="image"></p>
<p>ç›´æ¥è®¿é—®IPæ˜¯ä¸é€šçš„ï¼ˆæ²¡æœ‰è·¯ç”±ä¿¡æ¯ï¼‰</p>
<p>4.2      æˆ‘æ€ä¹ˆè®¿é—®åˆ«çš„Host<br>è¿™ä¸ªç­”æ¡ˆæ¯”è¾ƒç®€å•ï¼šåªè¦æˆ‘æ‰€åœ¨çš„Hostèƒ½é€šçš„åœ°æ–¹ï¼Œæˆ‘å°±ä¹Ÿèƒ½ä¸å®ƒè¿é€šã€‚<br><img src="/2022/06/11/uncatalog/cl49wrxfs001elwr7evfs8y08/13.jpg" alt="image"></p>
<p>ä½ çœ‹ä¸»æœºä¸Šæœ‰ä¸€æ¡ï¼šæºåœ°å€NATè§„åˆ™ã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">iptables -t nat â€“nL</span><br></pre></td></tr></table></figure></div>

<p>æ„æ€æ˜¯å®¹å™¨é‡Œé¢å‘å‡ºçš„æŠ¥æ–‡ï¼ŒæŠŠæºåœ°å€æ”¹æˆä¸»æœºçš„ï¼Œç„¶åå¾€å¤–å‘ã€‚æ„æ€æ˜¯è·Ÿä¸»æœºä¸€æ ·å¾€å¤–å‘æŠ¥æ–‡å°±å®Œäº†ï¼ˆä¸ç†è§£çš„å‚è§ä»¥å‰çš„NATè¯¾ç¨‹ï¼‰ã€‚</p>
<p><img src="/2022/06/11/uncatalog/cl49wrxfs001elwr7evfs8y08/14.png" alt="image"></p>
<p>4.3      åˆ«çš„Hostä¸Šçš„å®¹å™¨æ€ä¹ˆè®¿é—®æˆ‘<br>ä¹Ÿå°±è·¨èŠ‚ç‚¹çš„2ä¸ªå®¹å™¨æ€ä¹ˆäº’ç›¸é€šä¿¡ã€‚ä¸€èˆ¬æ˜¯2ç§æ–¹å¼ï¼š</p>
<p>4.3.1        NATç«¯å£æ˜ å°„ã€‚<br>å³é€šè¿‡æŒ‡å®šç›®æ ‡ç«¯å£ï¼Œç©¿åˆ°å®¹å™¨ä¸­ã€‚</p>
<p>æ ¹æ®4.2ç« èŠ‚å¯çŸ¥ï¼šå®¹å™¨-ã€‹ç›®æ ‡  == å®¹å™¨æ‰€åœ¨HostèŠ‚ç‚¹ â€“ã€‹ç›®æ ‡ã€‚</p>
<p>æ ¹æ®4.1ç« èŠ‚å¯çŸ¥ï¼šè®¿é—®ç›®æ ‡å®¹å™¨ == æŒ‡å®šIP+Port</p>
<p>æ‰€ä»¥å®¹å™¨é‡Œé¢ç›´æ¥ç”¨ï¼šæŒ‡å®šIP+Portè®¿é—®ç›®æ ‡å®¹å™¨å°±è¡Œäº†ã€‚</p>
<p>ä¸¾ä¾‹ï¼š</p>
<p>ï¼ˆ1ï¼‰       åœ¨192.168.1.9è¿™å°æœºå™¨ä¸Šå¯åŠ¨ä¸€ä¸ªNginxå®¹å™¨ï¼šæ³¨æ„è¿™é‡Œ-på‚æ•°å‘Šè¯‰Hostï¼Œè¯·å°†ä¸»æœºä¸Šé¢çš„80ç«¯å£ï¼Œä½œä¸ºè¿›å…¥æˆ‘çš„NATå…¥å£ã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">docker run -rm  -p 80:80 nginx</span><br></pre></td></tr></table></figure></div>

<p>ï¼ˆ2ï¼‰       ç„¶åå’±ä»¬å†å¦å¤–æ‰¾ä¸€å°æœºå™¨ï¼ˆä¸åˆšæ‰192.168.1.9 è¿™ä¸€å°èƒ½è¿é€šï¼‰ã€‚</p>
<p>è¿›å…¥ä¸€ä¸ªå®¹å™¨ï¼Œç„¶åè·¨èŠ‚ç‚¹è®¿é—®åˆšæ‰é‚£ä¸ªå®¹å™¨ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">docker exec -it ea60d3290dd5 /bin/bash</span><br><span class="line"></span><br><span class="line">curl -vvv 192.168.1.9:80</span><br></pre></td></tr></table></figure></div>

<p><img src="/2022/06/11/uncatalog/cl49wrxfs001elwr7evfs8y08/15.png" alt="image"></p>
<p>4.3.2        éš§é“ç½‘ç»œæ‰“é€šæ‰€æœ‰å®¹å™¨ã€‚<br>è¿™ç§å°±ç¨å¾®å¤æ‚ä¸€ç‚¹ï¼Œå°±æ˜¯è®©æ‰€æœ‰å®¹å™¨å¤„äºåŒä¸€ä¸ªå±€åŸŸç½‘ä¸­ã€‚</p>
<p>éš§é“æ¨¡å¼ï¼Œå®ç°æ–¹å¼åŸºæœ¬æ˜¯å„æ˜¾ç¥é€šäº†ã€‚é™¤äº†æ–°ç‰ˆæœ¬Dockeræœ‰è‡ªå·±çš„å®ç°ï¼Œå„å¤§å‚å•†ä¹Ÿéƒ½æœ‰ä¸ä¸€æ ·çš„å®ç°ï¼Œæ¯”å¦‚ç°åœ¨å„ç§flannelï¼Œweaveï¼Œcalicoç­‰ç°å®ã€‚</p>
<p>åŸç†å˜›ï¼Œè¯·å‚è€ƒæ—©æœŸçš„ éš§é“è¯¾ç¨‹ã€‚ï¼ˆå¯ä»¥ç…§ç€ç‰©ç†ä¸–ç•Œå»è€ƒè™‘ï¼Œå¥½æ¯”ä¸ºå¾ˆå¤šç‰©ç†æœºé‡Œé¢çš„æ‰€æœ‰VMåˆ›å»ºè™šæ‹Ÿå±€åŸŸç½‘ç±»ä¼¼ï¼‰</p>
<p><img src="/2022/06/11/uncatalog/cl49wrxfs001elwr7evfs8y08/16.jpg" alt="image"></p>
]]></content>
      <tags>
        <tag>äº‘åŸç”ŸåŸºç¡€ç³»åˆ—</tag>
        <tag>Kubernetesç½‘ç»œ</tag>
      </tags>
  </entry>
  <entry>
    <title>Kubernetesç½‘ç»œç³»åˆ—ä¹‹(åä¹)CloudFoundryç½‘ç»œå®ç°</title>
    <url>/2022/06/11/uncatalog/cl49x52lf001hlwr7g9qrfjev/</url>
    <content><![CDATA[<hr>
<span id="more"></span>



<hr>
<blockquote>
<p>åœ¨K8sç‹¬éœ¸å¤©ä¸‹ä¹‹å‰ï¼ŒCloudFoundryæ‰æ˜¯é‚£æ—¶çš„PaaSå¹³å°ä¸€å“¥å‘¢ã€‚è™½ç„¶ä½ ä¹‹å‰å¯èƒ½æ²¡äº†è§£è¿‡CloudFoundryæ˜¯ä»€ä¹ˆï¼Œä¸è¿‡ä»Šå¤©ï¼Œæˆ‘ä»¬å¯ä»¥æ¥å›é¡¾ä¸€ä¸‹å½“å¹´è€PaaSæ˜¯å¦‚ä½•å®ç°å®¹å™¨é›†ç¾¤ä¸­ç½‘ç»œåˆ†å‘çš„ï¼Œä¹Ÿè®¸è¿˜èƒ½é¡ºé“çœ‹ä¸‹è¿™å®¶ä¼™æ˜¯å¦‚ä½•è¢«åæµªæ‹æ­»åœ¨æ²™æ»©ä¸Šçš„</p>
</blockquote>
<h3 id="ç®€å•ä»‹ç»ä¸‹CloudFoundry"><a href="#ç®€å•ä»‹ç»ä¸‹CloudFoundry" class="headerlink" title="ç®€å•ä»‹ç»ä¸‹CloudFoundry"></a>ç®€å•ä»‹ç»ä¸‹CloudFoundry</h3><p><img src="/2022/06/11/uncatalog/cl49x52lf001hlwr7g9qrfjev/1.png" alt="image"></p>
<p>Dockerè§£å†³äº†å•æœºä¸Šé¢çš„å®¹å™¨ç®¡ç†ï¼Œå½“åœ¨å¤§è§„æ¨¡é›†ç¾¤ä¸Šé¢ç®¡ç†å®¹å™¨é›†ç¾¤æ—¶ï¼Œåˆ™éœ€è¦ä¾èµ–PaaSå¹³å°ã€‚CloudFoundryå°±æ˜¯ä¸šç•Œé¦–ä¸ªå¼€æºçš„PaaSå¹³å°ï¼Œé‚£åœ¨å½“å¹´ï¼ˆå¤§æ¦‚2013~2015ï¼‰å¯æ˜¯å±å’¤é£äº‘ï¼Œä¸€æ—¶é£å…‰æ— é™ã€‚</p>
<p>åæ¥çš„æ•…äº‹å¤§å®¶åŸºæœ¬ä¹Ÿçœ‹åˆ°äº†ï¼Œå‡ ä¸ªæ¯”è¾ƒæœ‰åçš„PaaSå¹³å°èµ·æ¥ï¼Œç„¶åå°±æ˜¯K8sä¸€å®¶ç‹¬å¤§ï¼Œç„¶åå°±æ²¡æœ‰ç„¶åäº†ã€‚ï¼ˆå¯å‚è€ƒå”è€å¸ˆçš„ã€ŠK8Så‰ä¸–ä»Šç”Ÿã€‹æ–‡ç« ï¼‰</p>
<p><img src="/2022/06/11/uncatalog/cl49x52lf001hlwr7g9qrfjev/2.png" alt="image"></p>
<p>è¿™é‡Œæä¸€ä¸‹ï¼Œå½“å¹´çš„CFç”¨çš„å®¹å™¨æŠ€æœ¯ï¼Œè¿˜ä¸æ˜¯Dockerï¼Œè€Œæ˜¯è‡ªåˆ›çš„ä¸€ä¸ªå«åšWardençš„å®¹å™¨æŠ€æœ¯ï¼ˆåŸç†å’ŒDockerå·®ä¸å¤šï¼Œä½†æ˜¯æ²¡æœ‰é•œåƒç®¡ç†è¿™ä¸ªåŠŸèƒ½ï¼Œæ‰€ä»¥åé¢è¢«Dockerç¢¾å‹äº†ï¼‰ã€‚åæ¥Dockerå®åœ¨å¤ªç«ï¼ŒCFæŠŠåº•å±‚çš„å®¹å™¨æ¢æˆäº†Dockerï¼Œä¸è¿‡ä¹Ÿæ¥ä¸åŠäº†ã€‚</p>
<p>2      é›†ç¾¤ä¸­å®¹å™¨ç½‘ç»œæ€ä¹ˆæ‰“é€š<br>è¦è®¿é—®å®¹å™¨ï¼Œæœ‰2ç§åœºæ™¯ï¼š ï¼ˆ1ï¼‰å®¹å™¨é—´äº’ç›¸è®¿é—®ã€‚ï¼ˆ2ï¼‰PaaSå¹³å°å¤–éƒ¨è®¿é—®å®¹å™¨ã€‚</p>
<p>CFåŸºæœ¬æ²¡æ€ä¹ˆè€ƒè™‘ç¬¬ï¼ˆ1ï¼‰ç§åœºæ™¯ï¼Œåªæ˜¯å¯¹ç¬¬ï¼ˆ2ï¼‰ç§åœºæ™¯åšäº†è¾ƒå¥½çš„å¤„ç†ã€‚æ‰€ä»¥æˆ‘ä»¬è¯¦ç»†ä»‹ç»ä¸‹ç¬¬ï¼ˆ2ï¼‰ç§åœºæ™¯ï¼šPaaSå¤–éƒ¨æ€ä¹ˆè®¿é—®å®¹å™¨ã€‚</p>
<p>ä¸ºäº†ä»å¤–éƒ¨å¯ä»¥è®¿é—®å®¹å™¨ï¼ŒCFæ–°å¢äº†ä¸€ä¸ªå«åšGoRouterçš„ç»„ä»¶ï¼Œä½ å°±ç†è§£æˆä¸€ä¸ªè‡ªå·±å®ç°çš„å®šåˆ¶ç‰ˆNginxã€‚</p>
<p><img src="/2022/06/11/uncatalog/cl49x52lf001hlwr7g9qrfjev/3.png" alt="image"></p>
<p>PaaSé›†ç¾¤å¤–éƒ¨ï¼Œè®¿é—®é›†ç¾¤é‡Œé¢çš„å®¹å™¨ï¼Œéƒ½éœ€è¦ä¸€ä¸ªè¿™æ ·çš„LBçš„ã€‚å®šåˆ¶ä¹Ÿå¥½ï¼Œå–ç¬¬ä¸‰æ–¹ä¹Ÿç½¢ã€‚ æ¯”å¦‚ä½œä¸ºåæ¥è€…ï¼ŒK8sä¸ºäº†å·æ‡’ï¼Œå®ç°å¼¯é“è¶…è½¦CFï¼Œç›´æ¥åªåšæ§åˆ¶é€»è¾‘ï¼ˆè¿˜å–ä¸ªå¥½å¬çš„åå­—å«Ingressï¼‰ï¼Œå…·ä½“è½¬å‘åŠ¨ä½œäº¤ç»™Nginxè¿™ç§ç¬¬ä¸‰æ–¹å·¥å…·å»å®ç°äº†ã€‚</p>
<p>å›åˆ°CFï¼Œé‚£æˆ‘ä»¬å°±è¯¦ç»†çœ‹ä¸‹æŠ¥æ–‡æ˜¯æ€ä¹ˆç»è¿‡GoRouterï¼Œåˆ°è¾¾å®¹å™¨çš„ã€‚</p>
<p><img src="/2022/06/11/uncatalog/cl49x52lf001hlwr7g9qrfjev/4.png" alt="image"></p>
<p>ï¼ˆ1ï¼‰       é¦–å…ˆï¼ŒGoRouter å’Œ å®¹å™¨æ‰€åœ¨çš„èŠ‚ç‚¹ï¼ˆDEAï¼‰ï¼Œæ˜¯å±€åŸŸç½‘çš„VMï¼Œäº’ç›¸è¿é€šã€‚</p>
<p>ï¼ˆ2ï¼‰       GoRouterè®°å½•URLå’Œå®¹å™¨endpointçš„æ˜ å°„å…³ç³»ã€‚</p>
<p>ï¼ˆ3ï¼‰       æ”¶åˆ°è¯·æ±‚ï¼Œå°†æŠ¥æ–‡è½¬ç»™å¯¹åº”çš„å®¹å™¨HostèŠ‚ç‚¹ã€‚è¿™ä¸ªå’ŒK8sæ˜¯ä¸€æ ·çš„ã€‚</p>
<p>2.1      HostèŠ‚ç‚¹çš„å®¹å™¨ç½‘ç»œ<br>Wardenå®¹å™¨å‡ºç°çš„æ¯”Dockerå®¹å™¨æ—©ï¼Œæ‰€ä»¥ç½‘ç»œæ¨¡å‹ï¼Œä¹Ÿæ›´ç®€å•ã€‚å…·ä½“æ¥è®²ï¼Œå°±æ˜¯æ²¡Bridgeç½‘æ¡¥ï¼ŒæŠ¥æ–‡ç›´æ¥é Hostè·¯ç”±å¯¼å…¥å®¹å™¨ã€‚</p>
<p>l  åœ¨DEAä¸Šè¿è¡Œifconfigçœ‹åˆ°çš„ç»“æœï¼š</p>
<p><img src="/2022/06/11/uncatalog/cl49x52lf001hlwr7g9qrfjev/5.png" alt="image"></p>
<p>w-å¼€å¤´çš„ å°±æ˜¯ Veth-pair ç½‘çº¿ï¼Œæ²¡æœ‰Bridgeç½‘æ¡¥ã€‚</p>
<p>l  åœ¨å®¹å™¨å†…è¿è¡Œifconfigçœ‹åˆ°çš„ç»“æœï¼š</p>
<p><img src="/2022/06/11/uncatalog/cl49x52lf001hlwr7g9qrfjev/6.png" alt="image"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œwardenå®¹å™¨å†…åªæœ‰ä¸€ä¸ªæ¥å£ï¼Œå°±æ˜¯Vethçš„å¦ä¸€å¤´ã€‚åœ¨wardenå®¹å™¨ä¸­è¿è¡Œçš„appä¹Ÿåªèƒ½çœ‹åˆ°è¿™ä¸€ä¸ªæ¥å£ã€‚</p>
<p>æ‰€ä»¥CFä¸ºæ¯ä¸ªå®¹å™¨ï¼Œåˆ›å»ºäº†ä¸€æ ¹Vethç½‘çº¿ï¼Œä¸€å¤´åœ¨Hostä¸»æœºï¼ˆDEAï¼‰ä¸­ï¼Œä¸€å¤´åœ¨Wardenå®¹å™¨ä¸­ï¼Œå¦‚ä¸‹å›¾ï¼š</p>
<p><img src="/2022/06/11/uncatalog/cl49x52lf001hlwr7g9qrfjev/7.png" alt="image"></p>
<p>l  DEAå¦‚ä½•æŠŠappè¯·æ±‚äº¤ç»™Wardenå®¹å™¨å†…</p>
<p>å‰é¢æåˆ°GoRouterè½¬å‘è¿‡æ¥çš„è¯·æ±‚ï¼Œç›®çš„IPéƒ½æ˜¯DEAçš„ï¼Œé‚£ä¹ˆDEAæ˜¯æ€ä¹ˆåŒºåˆ†è¯·æ±‚æ˜¯ç»™å“ªä¸ªwardenå®¹å™¨çš„å‘¢ï¼Ÿ ç­”æ¡ˆæ˜¯ç«¯å£æ˜ å°„ï¼ˆç›®çš„IPéƒ½ä¸€æ ·ï¼Œä¸æ˜¯è¿˜æœ‰ç«¯å£ä¸åŒä¹ˆï¼‰ã€‚æ˜¯çš„ï¼ŒDEAé€šè¿‡ç«¯å£æ¥åŒºåˆ†ä¸åŒçš„wardenå®¹å™¨ï¼Œä»è€Œäº¤ç»™ä¸åŒçš„appã€‚</p>
<p>DEAåšçš„ç«¯å£è½¬wardenå®¹å™¨IPå·¥ä½œæ˜¯äº¤ç»™Hostçš„iptablesè§„åˆ™æ¥å®Œæˆçš„ï¼ˆè·ŸDockerä¸€æ ·ï¼‰ï¼š</p>
<p><img src="/2022/06/11/uncatalog/cl49x52lf001hlwr7g9qrfjev/8.png" alt="image"></p>
<p>æ‰€ä»¥ï¼Œä¹‹å‰æåˆ°çš„è·¯ç”±ç»„ä»¶ï¼ˆGoRouterï¼‰ä¸å…³å¿ƒå®¹å™¨ï¼ˆWardenï¼‰é‡Œé¢çš„å®é™…IPï¼Œåªè®°å½•å®¹å™¨æ‰€åœ¨ä¸»æœºï¼ˆDEAï¼‰çš„IPå°±å¤Ÿäº†ã€‚Wardenå®¹å™¨ä¹‹é—´ç½‘ç»œå½¼æ­¤éš”ç¦»ï¼Œæ‰€ä»¥è¿™ä¸ªWardenå®¹å™¨å†…éƒ¨çš„IPå…¶å®å¹¶ä¸é‡è¦ï¼Œéšæœºéƒ½å¯ä»¥ï¼Œåªè¦ä¿è¯æ‰€æœ‰è™šæ‹ŸVethç½‘çº¿çš„IPä¸é‡å¤å°±èƒ½åŒºåˆ†ä¸åŒçš„Wardenå®¹å™¨ã€‚</p>
<p>2.2      å®¹å™¨å†…éƒ¨ç½‘ç»œ<br>ä»å®¹å™¨è§’åº¦æ¥çœ‹ï¼Œå®ƒè‡ªå·±è‚¯å®šè®¤ä¸ºè‡ªå·±æ˜¯å®Œæ•´çš„ä¸–ç•Œï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦æŠŠå®¹å™¨å½“ä½œæ™®é€šçš„ä¸»æœºå°±è¡Œã€‚ï¼ˆå®¹å™¨è¿˜æ˜¯ä¸ºäº†æ¨¡æ‹Ÿå‡ºä¸€ä¸ªâ€œçœŸå®â€çš„è¿è¡Œç¯å¢ƒï¼‰ã€‚</p>
<p><img src="/2022/06/11/uncatalog/cl49x52lf001hlwr7g9qrfjev/9.png" alt="image"></p>
<p>å¯¹äºwardenå®¹å™¨å†…éƒ¨æ¥è¯´ï¼Œä¸å¤–ç•Œé€šä¿¡çš„å”¯ä¸€é€”å¾„å°±é‚£æ ¹Vethç½‘çº¿ï¼Œç½‘çº¿çš„å¯¹ç«¯å°±æ˜¯å®ƒçš„ç½‘å…³ï¼ˆå³å®¹å™¨æ‰€åœ¨çš„ä¸»æœºï¼‰ï¼Œå†å¤–éƒ¨çš„ç½‘ç»œå®ƒå°±ä¸€ç‚¹éƒ½ä¸çŸ¥é“äº†ã€‚åœ¨è¿™ä¸ªè™šæ‹Ÿä¸–ç•Œä¸­ï¼ˆwardenå®¹å™¨ä¸­ï¼‰è¿è¡Œçš„appæ‰€çœ‹åˆ°çš„ç½‘ç»œä¹Ÿæ˜¯è¿™ä¹ˆçš„ç®€å•ï¼šæˆ‘çš„ä¸–ç•Œåªæœ‰ä¸€ä¸ªç½‘å¡ï¼Œè·¯ç”±ä¹Ÿåªæœ‰ä¸€æ¡ï¼š</p>
<p><img src="/2022/06/11/uncatalog/cl49x52lf001hlwr7g9qrfjev/10.png" alt="image"></p>
<p>2.3      æŠ¥æ–‡ä»å®¢æˆ·ç«¯åˆ°è¾¾å®¹å™¨<br>è¿™ä¸€ç« èŠ‚ï¼Œæ˜¯ä¸Šè¿°ç« èŠ‚çš„ç»†åŒ–ç‰ˆï¼Œæœ‰å…´è¶£çš„çœ‹çœ‹å°±è¡Œäº†ã€‚</p>
<p>2.3.1        å®¢æˆ·ç«¯åˆ°CFçš„GoRouter<br><img src="/2022/06/11/uncatalog/cl49x52lf001hlwr7g9qrfjev/11.png" alt="image"></p>
<ol>
<li><p>é¦–å…ˆå®¢æˆ·ç«¯çŸ¥é“appçš„URLç½‘å€ã€‚soä¼šå…ˆå»æŸ¥è¯¢DNSï¼ŒDNSè¿”å›çš„IPæ˜¯GoRouterçš„å¤–éƒ¨IPï¼ˆå³EIPå•¦ï¼‰ã€‚</p>
</li>
<li><p>æ¥ç€å®¢æˆ·ç«¯è®¿é—®åˆšæŸ¥åˆ°çš„GoRouterçš„å¤–éƒ¨EIPï¼ˆå®é™…å°±æ˜¯Openstackçš„ç½‘ç»œèŠ‚ç‚¹ï¼ŒIaaSæŠ¥æ–‡éƒ½æ˜¯é€šè¿‡ç½‘ç»œèŠ‚ç‚¹ï¼Œè½¬ç»™å†…éƒ¨çš„VMçš„ã€‚ï¼‰ã€‚</p>
</li>
<li><p>Openstackç½‘ç»œèŠ‚ç‚¹å°†å¤–éƒ¨IPé€šè¿‡NATè½¬æ¢æˆå†…éƒ¨çš„IPï¼Œäº¤ç»™å¯¹åº”çš„VMã€‚è¿™é‡Œä¹Ÿå°±æ˜¯GoRouteræ‰€åœ¨çš„èŠ‚ç‚¹äº†ã€‚</p>
</li>
</ol>
<p>Psï¼šå› ä¸ºNATå¯¹å®¢æˆ·ç«¯ç”¨æˆ·æ¥è¯´æ˜¯ä¸æ„ŸçŸ¥çš„ï¼Œå®¢æˆ·ç«¯ä¼šè®¤ä¸ºç”¨EIPå°±æ˜¯æ¥ä¸GoRouteré€šä¿¡äº†ã€‚</p>
<p>2.3.2        Routeråˆ°DEAï¼ˆAppæ‰€åœ¨çš„VMï¼‰<br><img src="/2022/06/11/uncatalog/cl49x52lf001hlwr7g9qrfjev/17.png" alt="image"></p>
<ol start="4">
<li><p>è·¯ç”±ç»„ä»¶GoRouteræ‰§è¡ŒL7å±‚ç»ˆç»“æ¨¡å¼ã€‚å³å…ˆå’Œå®¢æˆ·ç«¯æ­£å¸¸TCPå»ºé“¾ï¼Œè¿™æ—¶è¿˜ä¸è·Ÿä»»ä½•åç«¯å®¹å™¨è¿æ¥é€šä¿¡ã€‚ç­‰åˆ°å®¢æˆ·ç«¯å‘èµ·GETçš„æ—¶å€™ï¼Œä¼šæ ¹æ®å®¢æˆ·ç«¯è¯·æ±‚çš„URLï¼Œæ‰¾åˆ°â€œurl-appâ€çš„å…³è”æ˜ å°„è®°å½•ï¼Œæ‰¾å‡ºæ˜¯è®¿é—®å“ªä¸ªappï¼Œç„¶åæ‰å‘ç›®æ ‡appå‘èµ·synå»ºé“¾ã€‚æ³¨æ„è¿™é‡Œå‘å®¹å™¨ä¸­çš„appå‘èµ·è¯·æ±‚æ—¶çš„ç›®çš„ç«¯å£å·²ç»æ¢äº†ï¼Œä¸å†æ˜¯httpé»˜è®¤ç«¯å£80ã€‚</p>
</li>
<li><p>â€œurl-appâ€è®°å½•ä¸­appçš„åœ°å€æ˜¯å®¹å™¨æ‰€åœ¨çš„èŠ‚ç‚¹ï¼ˆå³ï¼šç›®çš„IPæ˜¯DEAï¼‰ã€‚æ‰€ä»¥GoRouteræŠŠæŠ¥æ–‡ä¸¢ç»™DEAï¼Œå…¶å®ä¹Ÿæ˜¯ä¸€ä¸ªVMã€‚</p>
</li>
</ol>
<p>2.3.3        DEAæ”¶åˆ°çš„æŠ¥æ–‡<br><img src="/2022/06/11/uncatalog/cl49x52lf001hlwr7g9qrfjev/12.png" alt="image"></p>
<ol start="6">
<li>å¯ä»¥çœ‹åˆ°GoRouterå‘å…¶å»ºé“¾æŠ¥æ–‡åˆ°è¾¾å®¹å™¨æ‰€åœ¨çš„HostèŠ‚ç‚¹ã€‚</li>
</ol>
<p>2.3.4        DEAè½¬å‘è¿›å…¥å®¹å™¨ï¼ˆAppæ‰€åœ¨çš„è¿è¡Œç¯å¢ƒï¼‰<br><img src="/2022/06/11/uncatalog/cl49x52lf001hlwr7g9qrfjev/13.png" alt="image"></p>
<p>deaæ‰§è¡Œnatï¼ŒæŠŠæŠ¥æ–‡è½¬å…¥åˆ°å®¹å™¨é‡Œé¢ã€‚</p>
<ol start="7">
<li> DEAæ ¹æ®æŠ¥æ–‡çš„ç›®çš„ç«¯å£ï¼Œæ³¨æ„æ˜¯ç«¯å£ï¼Œæ‰§è¡ŒNATåŠ¨ä½œï¼Œå°†ç›®çš„IPæ”¹æˆå†…éƒ¨å®¹å™¨çš„IPï¼Œäº¤ç»™APPã€‚</li>
</ol>
<p>2.3.5        æœ€ç»ˆAppçœ‹çš„è¯·æ±‚<br><img src="/2022/06/11/uncatalog/cl49x52lf001hlwr7g9qrfjev/14.png" alt="image"></p>
<p>appçœ‹åˆ°çš„æŠ“åŒ…</p>
<p>8 è¿˜æ˜¯ä¸€æ ·ï¼ŒNATè¡Œä¸ºå¯¹å®¢æˆ·ç«¯æ¥è¯´æ˜¯ä¸æ„ŸçŸ¥çš„ï¼Œäºæ˜¯GoRouterè·¯ç”±ç»„ä»¶ä»¥ä¸ºè‡ªå·±ç›´æ¥è·Ÿå®¹å™¨Appé€šä¿¡äº†ã€‚å®ƒç»§ç»­å¼€å¿ƒçš„è®¤ä¸ºâ€œurl-appâ€çš„æ˜ å°„å…³ç³»æ˜¯æ­£ç¡®çš„ï¼š</p>
<p><img src="/2022/06/11/uncatalog/cl49x52lf001hlwr7g9qrfjev/15.png" alt="image"></p>
<p>2.3.6        æ•´ä½“å›¾<br><img src="/2022/06/11/uncatalog/cl49x52lf001hlwr7g9qrfjev/16.png" alt="image"></p>
<p>3      æ€»ç»“<br>CFçš„å®¹å™¨ç½‘ç»œå®ç°ï¼Œå’ŒK8sä¸»è¦3ä¸ªåœ°æ–¹ç¨æœ‰åŒºåˆ«ã€‚</p>
<p>ï¼ˆ1ï¼‰       K8sç”¨Serviceæ¦‚å¿µæå®šå®¹å™¨é—´å¦‚ä½•äº’è®¿é—®é¢˜ï¼ŒCFæœªè€ƒè™‘å®¹å™¨å¦‚ä½•äº’è®¿ã€‚</p>
<p>ï¼ˆ2ï¼‰       å¤–éƒ¨è·¯ç”±è½¬å‘çš„å®ç°ï¼ŒK8så€ŸåŠ©ç¬¬ä¸‰æ–¹ç»„ä»¶ï¼ŒCFè‡ªå·±ä¸Šé˜µ</p>
<p>ï¼ˆ3ï¼‰       å®¹å™¨æ‰€åœ¨Hostç»„ç½‘ï¼ŒDockerå¸¦Bridgeï¼ŒCFä¸å¸¦Bridge</p>
<p>ç¬¬ä¸€ç‚¹ï¼šK8sç²¾æ˜çš„åœ°æ–¹ï¼Œä¹Ÿæ˜¯ä¸€æŠŠç›´æ¥ç«™åœ¨äº†CFçš„è‚©è†€ä¸Šã€‚</p>
<p>ç¬¬äºŒç‚¹ï¼šAppç½‘ç»œä¸»è¦è€ƒè™‘äº†é›†ç¾¤å¤–éƒ¨ï¼Œå¦‚ä½•è®¿é—®å®¹å™¨ï¼Œå³K8sä¸­çš„Ingresséƒ¨åˆ†ã€‚è·ŸK8s-Ingressä¸­åªå®šä¹‰â€œURL-&gt;å®¹å™¨â€æ˜ å°„è§„åˆ™ï¼Œè½¬å‘åˆ™äº¤ç»™Nginxä¸ä¸€æ ·çš„æ˜¯ã€‚CFæäº†ä¸ªGoRouterè·¯ç”±ç»„ä»¶ï¼Œé™¤äº†å®šä¹‰æ˜ å°„å…³ç³»ï¼Œè‡ªå·±ä¸Šæ‰‹åšäº†è½¬å‘åŠ¨ä½œã€‚</p>
<p>ç¬¬ä¸‰ç‚¹ï¼šå®¹å™¨æœ‰æ²¡æœ‰æ¥å…¥Bridgeç½‘æ¡¥ï¼Œå…¶å®æ²¡å¤ªå¤§åŒºåˆ«ï¼Œè¿™ä¸ªæœ¬èº«è¿˜æ˜¯Dockerå’ŒWardençš„å·®å¼‚ã€‚Dockeræ¯”Wardenæ›´é€šç”¨ä¸€äº›ï¼Œåœºæ™¯è€ƒè™‘çš„æ›´å‘¨åˆ°ï¼Œæ‰€ä»¥å’ŒK8sæ—¶ä»£ç›–ä½äº†CFä¸€æ ·ï¼ŒWardenè¿™ç§å®¹å™¨ï¼Œä¹Ÿè¢«Dockerç›–çš„æ­»æ­»çš„ã€‚</p>
]]></content>
      <tags>
        <tag>äº‘åŸç”ŸåŸºç¡€ç³»åˆ—</tag>
        <tag>Kubernetesç½‘ç»œ</tag>
      </tags>
  </entry>
  <entry>
    <title>Kubernetesç½‘ç»œç³»åˆ—ä¹‹(äºŒå)Kubernetesç½‘ç»œå®ç°</title>
    <url>/2022/06/11/uncatalog/cl49xdzwo001klwr71pcl8mu0/</url>
    <content><![CDATA[<hr>
<span id="more"></span>



<hr>
<blockquote>
<p>å½“ä»ŠK8sç‹¬éœ¸å¤©ä¸‹ä¹‹æ—¶ï¼Œå’±ä»¬ç«™åœ¨æ›´é«˜çš„è§’åº¦ï¼Œå¥½å¥½çš„çœ‹çœ‹K8sçš„ç½‘ç»œæ˜¯ä»¥ä»€ä¹ˆç†å¿µæ„ç­‘çš„ã€‚ä»¥åŠä¸€ä¸ªå®¹å™¨é›†ç¾¤çš„å¥½ä¿å§†ï¼Œæ˜¯å¦‚ä½•åˆ†åˆ«ç…§é¡¾ å—åŒ—æµé‡å’Œä¸œè¥¿æµé‡çš„ã€‚</p>
</blockquote>
<h3 id="ç®€å•ä»‹ç»ä¸‹Kubernetes"><a href="#ç®€å•ä»‹ç»ä¸‹Kubernetes" class="headerlink" title="ç®€å•ä»‹ç»ä¸‹Kubernetes"></a>ç®€å•ä»‹ç»ä¸‹Kubernetes</h3><p>1      ç®€å•ä»‹ç»ä¸‹Kubernetes<br>ç•¥ã€‚ã€‚å®¹å™¨é›†ç¾¤ç®¡ç†çš„äº‹å®æ ‡å‡†äº†ï¼Œä¸çŸ¥é“è¦æ‰“å±è‚¡ã€‚</p>
<p>ï¼ˆpsï¼šæœ¬ç« èŠ‚å¯å‚è€ƒå”è€å¸ˆçš„ã€ŠK8Så‰ä¸–ä»Šç”Ÿã€‹æ–‡ç« ï¼‰</p>
<p>2      ä¸–ç•Œä¸Šçš„é›†ç¾¤éƒ½ä¸€ä¸ªæ ·<br>æœ‰ç‚¹æ ‡é¢˜å…šå“ˆï¼Œä¸è¿‡æˆ‘æ¥è§¦è¿‡çš„å„ç§é›†ç¾¤ä¹Ÿä¸å°‘ï¼Œå„ç§å„æ ·ï¼š</p>
<ul>
<li><p>OpenStackï¼šåœ¨ä¸€å¤§å †ç‰©ç†æœºä¸Šé¢ï¼Œç®¡ç†ï¼ˆå¯åŠ¨/åœæ­¢ï¼‰VMçš„ã€‚</p>
</li>
<li><p>SGEï¼ŒSlurmï¼ŒPBSï¼šåœ¨ä¸€å¤§å †ç”µè„‘é›†ç¾¤é‡Œé¢ï¼Œç®¡ç†ï¼ˆå¯åŠ¨/åœæ­¢ï¼‰Appçš„ã€‚</p>
</li>
<li><p>Yarnï¼šåœ¨ä¸€å¤§å †ç”µè„‘é›†ç¾¤é‡Œé¢ï¼Œç®¡ç†ï¼ˆå¯åŠ¨/åœæ­¢ï¼‰å¤§æ•°æ®Appçš„ã€‚</p>
</li>
<li><p>CloudFoundryï¼šåœ¨ä¸€å¤§å †ç”µè„‘é›†ç¾¤é‡Œé¢ï¼Œç®¡ç†ï¼ˆå¯åŠ¨/åœæ­¢ï¼‰å®¹å™¨çš„</p>
</li>
<li><p>Kubernetesï¼šåœ¨ä¸€å¤§å †ç”µè„‘é›†ç¾¤é‡Œé¢ï¼Œç®¡ç†ï¼ˆå¯åŠ¨/åœæ­¢ï¼‰å®¹å™¨çš„ã€‚</p>
</li>
</ul>
<p>å®ƒä»¬éƒ½æœ‰ä¸€äº›å…±åŒç‰¹ç‚¹ï¼š</p>
<p>2.1      è·¨èŠ‚ç‚¹è·‘xxç¨‹åº<br><img src="/2022/06/11/uncatalog/cl49xdzwo001klwr71pcl8mu0/1.png" alt="image"></p>
<p>è¿™ä¸ªxxç¨‹åºä¸€å®šæ˜¯é¦–å…ˆå•æœºå¯ä»¥è¿è¡Œçš„ã€‚æ¯”å¦‚OpenStackï¼šå•æœºä¸Šé¢å¯ä»¥ç”¨qemuå¯åŠ¨VMï¼Œæƒ³è·¨èŠ‚ç‚¹ç®¡ç†VMï¼Œå°±å¼•å…¥äº†OpenStackã€‚Kubernetesä¹Ÿä¸€æ ·ï¼šå•æœºä¸Šé¢å¯ä»¥è·‘Dockerå®¹å™¨ï¼›æƒ³è·¨èŠ‚ç‚¹ç®¡ç†å®¹å™¨ï¼Œå°±å¾—å¼•å…¥é›†ç¾¤ç®¡ç†è€å¤§çš„æ¦‚å¿µã€‚</p>
<p>2.2      æœ‰ä¸€ä¸ªç®¡äº‹çš„è€å¤§<br>Aï¼‰é›†ç¾¤ç®¡ç†çš„è€å¤§ï¼Œè´Ÿè´£è®©æ‰‹ä¸‹çš„æŸä¸ªå°å¼Ÿå¹²æ´»ã€‚åˆ«ç®¡æ˜¯å‘½ä»¤å¼ï¼ˆç›´æ¥ä¸‹å‘½ä»¤ï¼‰çš„ï¼Œè¿˜æ˜¯ç”³æ˜å¼ï¼ˆå‘å‘Šç¤ºï¼‰çš„ï¼Œå°å¼Ÿæ”¶åˆ°å‘½ä»¤åï¼Œä¹–ä¹–å¹²æ´»å°±æ˜¯äº†ã€‚</p>
<p>Bï¼‰       åŒæ—¶ï¼Œè¿™ä¸ªé›†ç¾¤ç®¡ç†çš„è€å¤§ï¼Œéœ€è¦æœ‰è„‘å­ï¼Œä¸ç„¶å°å¼Ÿæ•°é‡å¤šäº†ç®¡ä¸å¥½ã€‚æ‰€ä»¥å®ƒéœ€è¦æ‹¿ç¬”è®°ä¸€è®°ã€‚æ¯”å¦‚OpenStackçš„è€å¤§å¾—å¸¦ä¸ªMysqlæ•°æ®åº“ï¼›KubernetesæŠŠç¬”è®°è®°åœ¨äº†ETCDé‡Œé¢ï¼ˆä¸è¿‡ETCDè¿™ä¸ªæœ¬å­å¤ªå°ï¼Œè®°å¾—ä¸œè¥¿ä¸èƒ½å¤ªå¤§ï¼Œè¿™æ˜¯å¦è¯ï¼‰ã€‚</p>
<p>Cï¼‰       ä¸ç®¡å“ªç§è€å¤§ï¼Œéƒ½å¾—æœ‰ä¸ªå†›å¸ˆã€‚ä¸€ä¸ªæ–°æ´»æ¥åˆ°è€å¤§è¿™é‡Œï¼Œé‚£ä¹ˆå¤šå°å¼Ÿï¼ŒæŒ‡æ´¾ç»™è°ä¸æ˜¯å¹²å‘€ã€‚è¿™æ´»å®é™…åˆ†é…ç»™å“ªä¸ªå°å¼Ÿï¼Œè¿™å¾—å†›å¸ˆè¯´äº†ç®—ï¼Œæ‰€ä»¥æ¯ä¸­é›†ç¾¤è½¯ä»¶éƒ½è‡ªå·±å†™äº†ä¸€å¥— Scheduler ç®—æ³•ï¼Œå¯è°“ç¨‹åºå‘˜é—´æµªè´¹é‡å¤è½®å­ä¹‹å…¸å‹ä»£è¡¨ã€‚</p>
<p>2.3      å°å¼Ÿä¸Šé¢éƒ½æœ‰ä¸€ä¸ªAgent<br><img src="/2022/06/11/uncatalog/cl49xdzwo001klwr71pcl8mu0/2.png" alt="image"></p>
<p>è¿™ä¸ªå°å¼Ÿä¸Šé¢çš„Agentï¼Œæ—¶åˆ»å‘è€å¤§æ±‡æŠ¥è‡ªå·±çš„çŠ¶æ€ï¼šæ´»ä¸æ´»ç€ï¼Œå¿™è¿˜æ˜¯é—²ï¼Œæ–¹ä¾¿è€å¤§æ´¾æ´»ã€‚åŒæ—¶ï¼ŒAgentä¹Ÿå°±æ˜¯é‚£å°ç”µè„‘é‡Œé¢çš„åœ°å¤´è›‡äº†ï¼Œå¸®å¿™è€å¤§è´Ÿè´£å„ç§ä¸´æ—¶äº‹ç‰©ã€‚åªæ˜¯å¤§å®¶çš„å–åä¸ä¸€æ ·ï¼š</p>
<p>OpenStackï¼šå–åNova</p>
<p>Kubernetesï¼šå–åKubelet</p>
<p>Yarnï¼šå–åNodeManager</p>
<p>2.4      è€å¤§æ€ä¹ˆç»™å°å¼Ÿå‘å·æ–½ä»¤<br>ä¸€èˆ¬è€å¤§éƒ½æ˜¯é€šè¿‡ï¼šæ¶ˆæ¯é˜Ÿåˆ—æ¥ï¼Œç»™å°å¼Ÿå‘å·æ–½ä»¤çš„ï¼Œè€Œä¸æ˜¯äº²è‡ªä¸Šé—¨ï¼ˆç›´è¿ï¼‰ä¸‹è¾¾å‘½ä»¤ã€‚åŸå› ä¹ˆï¼Œå½“ç„¶æ˜¯å°å¼Ÿå¯èƒ½ä¸´æ—¶å‡ºé—¨ï¼ˆæ•…éšœï¼‰äº†å‘—~ ç›´æ¥ä¸Šé—¨å¯èƒ½ä¸é€šï¼Œæ”¾æ¶ˆæ¯é˜Ÿåˆ—é‡Œé¢å°±å¯é å¤šäº†ã€‚ç­‰å°å¼Ÿå‡ºå·®å›æ¥ï¼Œè¿˜èƒ½çœ‹åˆ°è€å¤§ä¸‹è¾¾çš„ä»»åŠ¡ä»¤ã€‚</p>
<ul>
<li><p>OpenStackï¼šç”¨ RabbitMQ å‘å·æ–½ä»¤</p>
</li>
<li><p>Kubernetesï¼šç”¨ ETCD å‘å·æ–½ä»¤</p>
</li>
<li><p>CloudFoundryï¼šç”¨ NATS å‘å·æ–½ä»¤</p>
</li>
</ul>
<p>ä¸Šé¢è¿™äº›ç»„ä»¶éƒ½æ˜¯å¸¦æ¶ˆæ¯é€šçŸ¥çš„åŠŸèƒ½ï¼ŒåŒºåˆ«æœ‰äº›æœ‰åï¼Œæœ‰äº›æ²¡é‚£ä¹ˆå‡ºåç½¢äº†ã€‚</p>
<p>æ¯”å¦‚æˆ‘ä»¬çš„K8sï¼š</p>
<p><img src="/2022/06/11/uncatalog/cl49xdzwo001klwr71pcl8mu0/3.png" alt="image"></p>
<p>ç‰¹åˆ«éœ€è¦æä¸€ä¸‹ï¼šK8sè¿™ä¸ªè€å¤§ä¸ç®€å•ï¼Œæ‰¾äº†ä¸ªETCDè¿™ä¸ªå¥½å¸®æ‰‹ã€‚è¿™å°å®¶ä¼™æŒºç¥ï¼Œæ—¢èƒ½å½“ç¬”è®°æœ¬è®°ç‚¹äº‹æƒ…ï¼ˆä»£æ›¿OpenStackä¸­çš„Mysqlï¼‰ï¼Œåˆèƒ½å½“å…¬å‘Šç‰Œï¼Œé€šçŸ¥ç‚¹æ¶ˆæ¯ï¼ˆä»£æ›¿OpenStackä¸­çš„Rabbitï¼‰ã€‚æ‰€ä»¥K8sè¿™ä¸ªå®¹å™¨é›†ç¾¤ç®¡ç†ç›¸å¯¹OpenStackè¿™ä¸ªè™šæœºç®¡ç†ä¸éœ€è¦æ•°æ®åº“ï¼Œ666~</p>
<p>3      K8sæ€ä¹ˆè®¾è®¡å®¹å™¨ç½‘ç»œçš„å‘¢<br>3.1      å—åŒ—æµé‡<br>è¦çœ‹åˆ°K8sè¯ç”Ÿçš„æ—¶å€™ï¼Œé‚£æ—¶æ˜¯æœ‰CloudFoundryå’ŒDockerçš„ï¼Œä¸”éƒ½å·²ç»æ¯”è¾ƒæˆç†Ÿã€‚é‚£æ—¶ä½œä¸ºPaaSä¸€å“¥çš„CFå¯¹å®¹å™¨ç½‘ç»œçš„æŠ½è±¡ï¼š</p>
<p><img src="/2022/06/11/uncatalog/cl49xdzwo001klwr71pcl8mu0/4.png" alt="image"></p>
<p>ä¸»è¦è€ƒè™‘å¹³å°å¤–éƒ¨ï¼Œæ€ä¹ˆè®¿é—®å®¹å™¨é‡Œé¢çš„Appã€‚è€Œå¹³å°å†…éƒ¨çš„Appä¹‹é—´å¦‚ä½•äº’ç›¸è®¿é—®ï¼Œå‡ ä¹æ²¡æœ‰å¤ªå¤šçš„è®¾è®¡ã€‚</p>
<p>ç”±ä¸Šå›¾æ‰€ç¤ºï¼Œå¯ä»¥çœ‹åˆ°ï¼Œå¹³å°å¤–éƒ¨è®¿é—®ï¼Œä¸€èˆ¬éƒ½æ˜¯ä¸Šä¸‹ç”»çš„ï¼Œæ‰€ä»¥ä¹Ÿå«åšå—åŒ—æµé‡ã€‚æˆ‘ä»¬è¿™ä¹ˆå«ï¼Œä¹Ÿæ˜¯ä¾¿äºç¨‹åºå‘˜ä¹‹é—´æ²Ÿé€šå’Œç†è§£ã€‚</p>
<p>Psï¼šPaaSçš„åŸºæœ¬åŸå‹å¤§è‡´éƒ½è¿™æ ·ï¼š</p>
<p><img src="/2022/06/11/uncatalog/cl49xdzwo001klwr71pcl8mu0/5.png" alt="image"></p>
<p>3.2      ä¸œè¥¿æµé‡<br>K8så¸å–äº†å‰è¾ˆä»¬çš„ç²¾åï¼Œé™¤äº†å¹³å°å¤–éƒ¨è®¿é—®Appï¼Œè¿˜æ–°å¢è€ƒè™‘äº†å¹³å°å†…éƒ¨ï¼ŒAppä¹‹é—´å¦‚ä½•äº’ç›¸è®¿é—®ã€‚</p>
<p><img src="/2022/06/11/uncatalog/cl49xdzwo001klwr71pcl8mu0/6.png" alt="image"></p>
<p>å³K8sé€šè¿‡å¢åŠ ä¸€ä¸ªè´Ÿè½½å‡è¡¡çš„â€œLBâ€è®¾å¤‡ï¼Œæ¥æå®šå¹³å°å†…éƒ¨çš„Appé—´äº’ç›¸è®¿é—®ã€‚ç»™æ¯ä¸ªAppå–ä¸ªåˆ«åï¼Œåœ¨LBä¸Šé¢ç™»è®°ä¸€ä¸‹ï¼Œå°±å¯ä»¥è¢«å†…éƒ¨å…¶ä»–Appè®¿é—®ã€‚</p>
<p>ç”±ä¸Šå›¾æ‰€ç¤ºï¼Œå¯ä»¥çœ‹åˆ°ï¼Œå¹³å°å†…éƒ¨è®¿é—®ï¼Œä¸€èˆ¬éƒ½æ˜¯æ°´å¹³ç”»çš„ï¼Œæ‰€ä»¥ä¹Ÿå«åšä¸œè¥¿æµé‡ã€‚ä¸€ä¸ªå®Œæ•´çš„PaaSå¹³å°ï¼Œå°±æ˜¯éœ€è¦å—åŒ—æµé‡+ä¸œè¥¿æµé‡ï¼Œå…¨å¥—æ²»ç†çš„ã€‚</p>
<p>3.3      DockeråŸç”Ÿè®¿é—®æ–¹å¼<br>è¿˜è®°å¾—å”è€å¸ˆçš„ã€ŠDockerç½‘ç»œå®ç°ã€‹ç« èŠ‚å§ï¼ŒDockerå®¹å™¨å¯ä»¥é€šè¿‡â€œèŠ‚ç‚¹IP+èŠ‚ç‚¹Portâ€çš„æ–¹å¼è®¿é—®åˆ°å®¹å™¨ã€‚åŸç†çš„å®¹å™¨æ‰€åœ¨èŠ‚ç‚¹ï¼Œè®¾ç½®äº†NATè§„åˆ™ã€‚æŠ¥æ–‡ä¸€åˆ°è¾¾èŠ‚ç‚¹ï¼Œæ ¹æ®ç›®çš„ç«¯å£ï¼Œè½¬å‘è¿›å…¥å®¹å™¨ã€‚</p>
<p><img src="/2022/06/11/uncatalog/cl49xdzwo001klwr71pcl8mu0/7.png" alt="image"></p>
<p>3.4      å°ç»“ï¼šK8sä¸­3ç§è®¿é—®å®¹å™¨çš„é€šé“<br>ï¼ˆ1ï¼‰       é€šè¿‡å—åŒ—æµé‡ï¼ˆä»é›†ç¾¤å¤–éƒ¨è®¿é—®Appï¼‰è®¿é—®Appå®¹å™¨</p>
<p>ï¼ˆ2ï¼‰       é€šè¿‡ä¸œè¥¿æµé‡ï¼ˆé›†ç¾¤å†…Appä¹‹é—´ï¼‰è®¿é—®Appå®¹å™¨</p>
<p>ï¼ˆ3ï¼‰       é€šè¿‡DockeråŸç”Ÿè‡ªå¸¦çš„æ–¹å¼ï¼Œè®¿é—®Appå®¹å™¨</p>
<p><img src="/2022/06/11/uncatalog/cl49xdzwo001klwr71pcl8mu0/8.png" alt="image"></p>
<p>ä¸‹ä¸€ç« èŠ‚ï¼Œæˆ‘ä»¬ç®€å•ä»‹ç»ä¸‹æ¯ç§æ–¹å¼ï¼ŒK8såˆ†åˆ«æ€ä¹ˆå»å®ç°çš„ã€‚</p>
<p>4      K8sæ€ä¹ˆå®ç°å®¹å™¨è®¿é—®<br>è™½ç„¶K8sä¸Šé¢ï¼Œæœ‰å¤šç§è®¿é—®Appå®¹å™¨çš„æ–¹æ³•ã€‚ä½†æ˜¯ä¸ç®¡ç”¨ä»€ä¹ˆæ–¹å¼è®¿é—®ï¼Œä¸€ä¸ªAppæƒ³è¦èƒ½è¢«è®¿é—®ï¼Œå°±å¾—å¾—åˆ°K8sçš„åŒæ„ã€‚K8sæŠŠè¿™ä¸ªè®¸å¯è¯å«åšâ€œServiceâ€ï¼šä¹Ÿå°±æ˜¯ä¸ç®¡ä»€ä¹ˆå—åŒ—æµé‡ã€ä¸œè¥¿æµé‡ï¼Œä½ çš„Appæƒ³è¦èƒ½è¢«è®¿é—®ï¼Œå°±å¾—å…ˆç”³è¯·Serviceè®¸å¯è¯ã€‚</p>
<p>4.1      å—åŒ—æµé‡<br>è¦å®ç°ä¸€ä¸ªAppçš„è®¿é—®é€šé“ï¼Œä¸€å®šè¦2ä¸ªä¸œè¥¿ï¼šï¼ˆ1ï¼‰LBè´Ÿè½½å‡è¡¡å™¨ + ï¼ˆ2ï¼‰æ³¨å†Œæ˜ å°„å…³ç³»ã€‚</p>
<p>æ˜ å°„å…³ç³»å°±æ˜¯ï¼šæŠ¥æ–‡æ¥äº†ï¼Œåº”è¯¥è½¬å‘ç»™å“ªä¸ªAppå®ä¾‹ï¼Ÿ å³ï¼šæ‰¾åˆ° â€œå“ªä¸ªApp + å“ªä¸ªå®ä¾‹â€ã€‚</p>
<p>è´Ÿè½½å‡è¡¡å™¨å‘¢ï¼Œä¸€èˆ¬å¤§å®¶çˆ±ç”¨Nginxï¼Œä¸è¿‡ä¹Ÿæœ‰å…¶ä»–ç±»å‹çš„å®ç°ã€‚</p>
<p><img src="/2022/06/11/uncatalog/cl49xdzwo001klwr71pcl8mu0/9.png" alt="image"></p>
<p>K8sæ¯”CFèªæ˜çš„åœ°æ–¹æ˜¯ï¼Œæ²¡æœ‰è‡ªå·±å»å®ç°LBã€‚è€Œåªå®šä¹‰äº†Appéœ€è¦æ€ä¹ˆæ ·æ‰èƒ½ç™»è®°åˆ°LBä¸Šé¢ã€‚å³åªå®šè§„èŒƒï¼Œä¸é™åˆ¶å®ç°ï¼ˆè¿™ç§æ€è·¯ï¼Œåœ¨k8sé‡Œé¢å¥½å¤šï¼Œæ¯”å¦‚å­˜å‚¨çš„CSIï¼Œè¿è¡Œæ—¶çš„CRIçš„ï¼Œå®¹å™¨ç½‘ç»œçš„CNI éƒ½æ˜¯è¿™æ ·ã€‚ï¼‰</p>
<ul>
<li>4å±‚LB</li>
</ul>
<p>æœ€ç®€å•çš„4å±‚LBå®ç°ï¼ŒK8så–äº†ä¸ªåå­—ï¼šLoadBalancerï¼ˆ1ï¼‰ã€‚</p>
<p>å³å®šä¹‰ï¼šxxåè®®+xxç«¯å£ =ã€‹xxåº”ç”¨ï¼Œå…·ä½“è§„åˆ™è‡ªå·±å»çœ‹èµ„æ–™ã€‚</p>
<ul>
<li>7å±‚LB</li>
</ul>
<p>ä¸ºäº†å®šä¹‰7å±‚LBçš„è§„åˆ™ï¼ŒK8sç»™è§„èŒƒå–äº†åå­—ï¼šIngressï¼ˆ2ï¼‰ã€‚</p>
<p>å³å®šä¹‰ï¼šxxç½‘å€+xx-URLè·¯å¾„ =ã€‹xxåº”ç”¨ï¼Œå…·ä½“è§„åˆ™ä¹Ÿè‡ªå·±çœ‹K8sèµ„æ–™ã€‚</p>
<p>å—åŒ—LBéƒ½æ˜¯å…¨å±€çº§çš„ï¼Œå³ï¼šå…¨å±€ä¸€ä¸ªï¼ˆHAå¤šå®ä¾‹ï¼Œå’±ä¹Ÿå½“ä¸€ä¸ªæ•´ä½“ï¼‰å°±è¡Œï¼›ä¸éœ€è¦æ¯ä¸ªSlaverèŠ‚ç‚¹ä¸Šä¸€ä¸ªã€‚</p>
<p>4.2      ä¸œè¥¿æµé‡<br>ä¸œè¥¿æµé‡ï¼Œä¹Ÿä¸€æ ·ï¼Œéœ€è¦LB+è§„åˆ™æ³¨å…¥ã€‚è¿™é‡Œï¼ŒK8sè®¾è®¡å°±æ¯”è¾ƒæœ‰æ„æ€ã€‚</p>
<p><img src="/2022/06/11/uncatalog/cl49xdzwo001klwr71pcl8mu0/10.png" alt="image"></p>
<p>é€»è¾‘ä¸Šï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºã€‚åœ¨LBéƒ¨åˆ†çš„å®ç°ä¸Šï¼ŒK8så¾ˆå·§å¦™çš„è¦æ±‚æ¯ä¸ªèŠ‚ç‚¹ä¸Šé¢éƒ½ä¸€ä¸ªâ€œå°LBâ€ã€‚</p>
<p><img src="/2022/06/11/uncatalog/cl49xdzwo001klwr71pcl8mu0/11.png" alt="image"></p>
<p>æ‰€ä»¥å®ç°ä¸Šï¼Œå¤§è‡´å¦‚ä¸Šå›¾æ‰€ç¤ºã€‚</p>
<ul>
<li>æœ¬åœ°LB</li>
</ul>
<p>æœ¬åœ°LBï¼Œè¦æ±‚æ¯ä¸ªèŠ‚ç‚¹éƒ½æœ‰ã€‚æ‰€ä»¥æœ€å¼€å§‹çš„ç‰ˆæœ¬ï¼ŒK8sä½¿ç”¨äº†Linuxä½¿ç”¨å¹¿æ³›çš„iptablesæ¥å®ç°ã€‚</p>
<p>åé¢ç”±äºiptablesæ€§èƒ½ä¸æ˜¯ç‰¹åˆ«ç»™åŠ›ï¼Œåˆæœ‰äº† IPVS å®ç°ã€‚ç„¶åå…¶ä»–å„å¼å„æ ·çš„æ°‘é—´å®ç°ä¹Ÿæœ‰ã€‚</p>
<ul>
<li>æœ¬åœ°æ§åˆ¶å™¨</li>
</ul>
<p>LBéœ€è¦ä¸€ä¸ªæ§åˆ¶å™¨ï¼Œæ¯ä¸ªæœ¬åœ°â€œå°LBâ€å¸¦é…å¤‡ä¸€ä¸ªå°æ§åˆ¶å™¨ï¼Œä¸€æ ·çš„ï¼Œä¹Ÿæ˜¯æ¯ä¸ªèŠ‚ç‚¹ä¸€ä¸ªã€‚å’Œå°LBä¸€ä¸€å¯¹åº”ã€‚K8sç»™å®ƒå–äº†ä¸ªåå­—ï¼šKube-proxy</p>
<p><img src="/2022/06/11/uncatalog/cl49xdzwo001klwr71pcl8mu0/12.png" alt="image"></p>
<ul>
<li>å‡IPåœ°å€</li>
</ul>
<p>æ¯ä¸ªK8sä¸Šçš„Appï¼Œéƒ½å¯ä»¥ç”³è¯·â€œè¡Œèµ°æ±Ÿæ¹–çš„åå·â€ï¼Œç”¨æ¥ä»£è¡¨è‡ªå·±ã€‚K8så°±ä¼šç»™ä½ çš„Appåˆ†é…ä¸€ä¸ªServiceè®¸å¯è¯ï¼Œè®¸å¯è¯ä¸Šé¢å¸¦ç€â€œå½±å­IPâ€ï¼Œä»»ä½•é›†ç¾¤å†…éƒ¨åªè¦è®¿é—®è¿™ä¸ªIPï¼Œå°±ç­‰äºè®¿é—®ä½ çš„Appã€‚</p>
<p><img src="/2022/06/11/uncatalog/cl49xdzwo001klwr71pcl8mu0/13.png" alt="image"></p>
<p>å®ç°ä¸Šï¼š</p>
<ol>
<li><pre><code>å…ˆåˆ°K8sé‚£ç™»è®°ï¼Œè¯´æˆ‘æƒ³è¦ä¸ªâ€œåå·â€
</code></pre>
</li>
<li><pre><code>é€šè¿‡åï¼ŒK8sä¼šå‘ŠçŸ¥æ¯ä¸ªèŠ‚ç‚¹ä¸Šçš„æœ¬åœ°LB
</code></pre>
</li>
<li><pre><code>ä»æ­¤ä»¥åï¼Œæ¯ä¸ªLBéƒ½è®¤è¯†è¿™ä¸ªâ€œå½±å­IPâ€äº†ï¼Œè®¿é—®å®ƒï¼Œå°±ä»£è¡¨è®¿é—®å¯¹åº”Appã€‚
</code></pre>
</li>
</ol>
<p><img src="/2022/06/11/uncatalog/cl49xdzwo001klwr71pcl8mu0/14.png" alt="image"></p>
<p>ç”±äºè¿™ä¸ªâ€œåå·â€æ˜¯é›†ç¾¤é¢å¸ƒçš„ï¼Œæ‰€ä»¥ä»…åœ¨é›†ç¾¤å†…æœ‰æ•ˆã€‚K8så–åï¼šClusterIPï¼ˆ3ï¼‰ã€‚</p>
<p>å…³äºä¸œè¥¿æµé‡çš„æ•…äº‹ï¼Œè¿˜å¯ä»¥å»çœ‹çœ‹å”è€å¸ˆä¹‹å‰çš„ã€Šç½‘ç»œéª—å­ã€‹ç¯‡ã€‚</p>
<p>4.3      DockeråŸç”Ÿè®¿é—®æ–¹å¼<br>é™¤äº†ä¸Šé¢å‡ ç§è®¿é—®æ–¹å¼ï¼ŒK8sä¹Ÿä¸ºåŸç”Ÿçš„Dockerè®¿é—®é€šé“ç•™äº†ä¸ªåå­—ï¼šNodePortï¼ˆ4ï¼‰ã€‚</p>
<p>è¿™ç§æ–¹å¼ï¼Œåœ¨ã€ŠDockerç½‘ç»œå®ç°ã€‹é‡Œé¢è¯´è¿‡ï¼Œé ä¸»æœºHostè½¬å‘å®ç°ã€‚æ—¢ç„¶æ˜¯ä¸»æœºæå®šï¼Œæ‰€ä»¥è¿™æ¡è·¯å’Œæœ¬åœ°LBå®ç°ï¼Œå°±åˆå¹¶ä¸€èµ·æå®šäº†ã€‚</p>
<p><img src="/2022/06/11/uncatalog/cl49xdzwo001klwr71pcl8mu0/15.png" alt="image"></p>
<p>å¦‚ä¸Šå›¾ï¼ŒK8sä¸‹å‘è§„åˆ™çš„æ—¶å€™ï¼Œé¡ºä¾¿æŠŠè¿™æ¡è·¯çš„è§„åˆ™ä¹Ÿä¸‹å‘ä¸‹å»ã€‚</p>
<p>psï¼šç”±äºæ¯ä¸ªæœ¬åœ°LBéƒ½æ”¶åˆ°äº†K8sçš„é€šå‘Šå°çš®é­ï¼Œæ‰€ä»¥æ¯ä¸ªK8sçš„èŠ‚ç‚¹ï¼Œéƒ½å¼€é€šäº†NodePorté€šé“å“¦ã€‚å³ï¼šæ— è®ºå“ªä¸ªSlaverèŠ‚ç‚¹çš„Portéƒ½å¯ä»¥é€šå¾€è¯¥Appã€‚</p>
<p>4.4      å°ç»“<br>K8såœ¨å®ç°å®¹å™¨ç½‘ç»œçš„æ—¶å€™ï¼Œé€ äº†å¾ˆå¤šæ¦‚å¿µï¼š</p>
<p>ï¼ˆ1ï¼‰       LoadBalancer</p>
<p>ï¼ˆ2ï¼‰       Ingress</p>
<p>ï¼ˆ3ï¼‰       ClusterIP</p>
<p>ï¼ˆ4ï¼‰       NodePort</p>
<p>æœ¬è´¨éƒ½æ˜¯ä¸€æ ·çš„ï¼Œå°±æ˜¯LB+ç™»è®°è§„èŒƒã€‚ å¦‚æœä½ çœ‹è¿‡ã€ŠDNSç¯‡ã€‹+ã€ŠDockerç½‘ç»œå®ç°ã€‹ï¼Œè¿™äº›å°±æ¯”è¾ƒå¥½ç†è§£ã€‚</p>
<p>psï¼šå…·ä½“æœ¬åœ°LBæ€ä¹ˆå®ç°ï¼ŸçœŸæœ‰å…´è¶£å¯ä»¥å»æœæœKube-proxyçš„ä»£ç è§£è¯»ã€‚æˆ‘æœ¬èº«ä¸æ˜¯å¾ˆå…³å¿ƒï¼Œå› ä¸ºå…¶å®ä½ ç»™æ¯ä¸ªèŠ‚ç‚¹å®‰è£…ä¸€ä¸ª Nginx ä¹Ÿå¯ä»¥åšåˆ°çš„ã€‚</p>
<p>5      æ€»ç»“<br>K8sçš„ç½‘ç»œæ¦‚å¿µï¼Œç‰¹åˆ«æ˜¯Serviceï¼Œæ˜¯K8sé‡Œé¢çš„ç²¾åï¼ŒåŠ¡å¿…éœ€è¦ææ˜ç™½ã€‚</p>
<p>ï¼ˆ1ï¼‰       K8så—åŒ—æµé‡ï¼Œç”¨Loadbalancerï¼ˆ4å±‚ï¼‰å’ŒIngressï¼ˆ7å±‚ï¼‰æå®šã€‚</p>
<p>ï¼ˆ2ï¼‰       K8sçš„ä¸œè¥¿æµé‡ï¼Œç”¨Serviceæ¦‚å¿µæå®šã€‚ç‰¹åˆ«çš„ï¼Œè¿˜ç»™äº†ä¸ªâ€œè¡Œèµ°æ±Ÿæ¹–ç”¨çš„åå·â€ï¼Œå–åClusterIPï¼ˆä¸€ä¸ªä¸å­˜åœ¨çš„å‡IPåœ°å€ï¼‰ã€‚</p>
<p>ï¼ˆ3ï¼‰       å®¹å™¨æ‰€åœ¨Hostç»„ç½‘ï¼Œå­˜åœ¨DockeråŸç”Ÿé€šé“ï¼ŒK8sç»™é‡æ–°åŒ…è£…äº†ä¸ªåå­—ï¼šNodePortã€‚æ‰€ä»¥åªè¦æŠ¥æ–‡åˆ°è¾¾SlaverèŠ‚ç‚¹ï¼Œå°±èƒ½é€šåˆ°å®¹å™¨é‡Œé¢ã€‚</p>
<p>å¦å¤–ï¼Œæä¸€ä¸‹ä¸€ç›´æ²¡æœ‰è¯´çš„ä¸œè¥¿ï¼ˆæ€•æ¦‚å¿µå¤ªå¤šï¼Œå½±å“ç†è§£ï¼‰ï¼šK8sçš„æ•´ä¸ªç½‘ç»œåº•åº§ï¼Œæ˜¯è¦æ±‚èŠ‚ç‚¹IPå’Œå®¹å™¨IPæ˜¯èƒ½äº’ç›¸è¿é€šçš„ï¼ˆå³ï¼šåœ¨èŠ‚ç‚¹ä¸Šé¢pingå®¹å™¨IPï¼Œæ˜¯å¯ä»¥é€šçš„ï¼‰ã€‚å…·ä½“åˆ™æ˜¯é€šè¿‡å®¹å™¨ç½‘ç»œå®ç°çš„ã€‚è¿™ä¸ªå®ç°å¾ˆå¤šï¼ŒFlannelï¼ŒCalicoç­‰ï¼Œæœ¬è´¨è¦ä¹ˆéš§é“ï¼Œè¦ä¹ˆå­ç½‘ï¼ˆå¯ä»¥çœ‹çœ‹ç‰©ç†ç½‘ç»œé‡Œé¢çš„ã€ŠVLANå’ŒVxlanã€‹ç¯‡ï¼Œå…³äºå¦‚ä½•åˆ’åˆ†é—¨æ´¾çš„ç¯‡ç« ï¼‰</p>
]]></content>
      <tags>
        <tag>äº‘åŸç”ŸåŸºç¡€ç³»åˆ—</tag>
        <tag>Kubernetesç½‘ç»œ</tag>
      </tags>
  </entry>
  <entry>
    <title>Kubernetesç½‘ç»œç³»åˆ—ä¹‹(ä¸‰å)iptablesè‡ªå®šä¹‰é“¾</title>
    <url>/2022/06/13/uncatalog/cl4cifajw0000pwr7fssa1zca/</url>
    <content><![CDATA[<hr>
<span id="more"></span>

<hr>
<p>å‰æ–‡ä¸­ï¼Œæˆ‘ä»¬ä¸€ç›´åœ¨å®šä¹‰è§„åˆ™ï¼Œå‡†ç¡®çš„è¯´ï¼Œæˆ‘ä»¬ä¸€ç›´åœ¨iptablesçš„é»˜è®¤é“¾ä¸­å®šä¹‰è§„åˆ™ï¼Œé‚£ä¹ˆæ­¤å¤„ï¼Œæˆ‘ä»¬å°±æ¥äº†è§£ä¸€ä¸‹è‡ªå®šä¹‰é“¾ã€‚</p>
<p>ä½ å¯èƒ½ä¼šé—®ï¼Œiptablesçš„é»˜è®¤é“¾å°±å·²ç»èƒ½å¤Ÿæ»¡è¶³æˆ‘ä»¬äº†ï¼Œä¸ºä»€ä¹ˆè¿˜éœ€è¦è‡ªå®šä¹‰é“¾å‘¢ï¼Ÿ</p>
<p>åŸå› å¦‚ä¸‹ï¼š</p>
<p>å½“é»˜è®¤é“¾ä¸­çš„è§„åˆ™éå¸¸å¤šæ—¶ï¼Œä¸æ–¹ä¾¿æˆ‘ä»¬ç®¡ç†ã€‚</p>
<p>æƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœINPUTé“¾ä¸­å­˜æ”¾äº†200æ¡è§„åˆ™ï¼Œè¿™200æ¡è§„åˆ™æœ‰é’ˆå¯¹httpdæœåŠ¡çš„ï¼Œæœ‰é’ˆå¯¹sshdæœåŠ¡çš„ï¼Œæœ‰é’ˆå¯¹ç§ç½‘IPçš„ï¼Œæœ‰é’ˆå¯¹å…¬ç½‘IPçš„ï¼Œå‡å¦‚ï¼Œæˆ‘ä»¬çªç„¶æƒ³è¦ä¿®æ”¹é’ˆå¯¹httpdæœåŠ¡çš„ç›¸å…³è§„åˆ™ï¼Œéš¾é“æˆ‘ä»¬è¿˜è¦ä»å¤´çœ‹ä¸€éè¿™200æ¡è§„åˆ™ï¼Œæ‰¾å‡ºå“ªäº›è§„åˆ™æ˜¯é’ˆå¯¹httpdçš„å—ï¼Ÿè¿™æ˜¾ç„¶ä¸åˆç†ã€‚</p>
<p>æ‰€ä»¥ï¼Œiptablesä¸­ï¼Œå¯ä»¥è‡ªå®šä¹‰é“¾ï¼Œé€šè¿‡è‡ªå®šä¹‰é“¾å³å¯è§£å†³ä¸Šè¿°é—®é¢˜ã€‚</p>
<p>å‡è®¾ï¼Œæˆ‘ä»¬è‡ªå®šä¹‰ä¸€æ¡é“¾ï¼Œé“¾åå«IN_WEBï¼Œæˆ‘ä»¬å¯ä»¥å°†æ‰€æœ‰é’ˆå¯¹80ç«¯å£çš„å…¥ç«™è§„åˆ™éƒ½å†™å…¥åˆ°è¿™æ¡è‡ªå®šä¹‰é“¾ä¸­ï¼Œå½“ä»¥åæƒ³è¦ä¿®æ”¹é’ˆå¯¹webæœåŠ¡çš„å…¥ç«™è§„åˆ™æ—¶ï¼Œå°±ç›´æ¥ä¿®æ”¹IN_WEBé“¾ä¸­çš„è§„åˆ™å°±å¥½äº†ï¼Œå³ä½¿é»˜è®¤é“¾ä¸­æœ‰å†å¤šçš„è§„åˆ™ï¼Œæˆ‘ä»¬ä¹Ÿä¸ä¼šå®³æ€•äº†ï¼Œå› ä¸ºæˆ‘ä»¬çŸ¥é“ï¼Œæ‰€æœ‰é’ˆå¯¹80ç«¯å£çš„å…¥ç«™è§„åˆ™éƒ½å­˜æ”¾åœ¨IN_WEBé“¾ä¸­ï¼ŒåŒç†ï¼Œæˆ‘ä»¬å¯ä»¥å°†é’ˆå¯¹sshdçš„å‡ºç«™è§„åˆ™æ”¾å…¥åˆ°OUT_SSHè‡ªå®šä¹‰é“¾ä¸­ï¼Œå°†é’ˆå¯¹Nginxçš„å…¥ç«™è§„åˆ™æ”¾å…¥åˆ°IN_NGINXè‡ªå®šä¹‰é“¾ä¸­ï¼Œè¿™æ ·ï¼Œæˆ‘ä»¬å°±èƒ½æƒ³æ”¹å“ªé‡Œæ”¹å“ªé‡Œï¼Œå†ä¹Ÿä¸åŒæ‹…å¿ƒæ‰¾ä¸åˆ°è§„åˆ™åœ¨å“ªé‡Œäº†ã€‚</p>
<p>ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè‡ªå®šä¹‰é“¾å¹¶ä¸èƒ½ç›´æ¥ä½¿ç”¨ï¼Œè€Œæ˜¯éœ€è¦è¢«é»˜è®¤é“¾å¼•ç”¨æ‰èƒ½å¤Ÿä½¿ç”¨ï¼Œç©ºå£ç™½è¯è¯´ä¸æ˜ç™½ï¼Œç­‰åˆ°ç¤ºä¾‹æ—¶æˆ‘ä»¬è‡ªç„¶ä¼šæ˜ç™½ã€‚</p>
<p>è¯´äº†è¿™ä¹ˆå¤šï¼Œæˆ‘ä»¬æ¥åŠ¨æ‰‹åˆ›å»ºä¸€æ¡è‡ªå®šä¹‰é“¾ï¼Œä½¿ç”¨-Né€‰é¡¹å¯ä»¥åˆ›å»ºè‡ªå®šä¹‰é“¾ï¼Œç¤ºä¾‹å¦‚ä¸‹</p>
<p><img src="/2022/06/13/uncatalog/cl4cifajw0000pwr7fssa1zca/1.png" alt="IMAGE"></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œâ€-t filterâ€è¡¨ç¤ºæ“ä½œçš„è¡¨ä¸ºfilterè¡¨ï¼Œä¸ä¹‹å‰çš„ç¤ºä¾‹ç›¸åŒï¼Œçœç•¥-té€‰é¡¹æ—¶ï¼Œç¼ºçœæ“ä½œçš„å°±æ˜¯filterè¡¨ã€‚</p>
<p>â€œ-N IN_WEBâ€è¡¨ç¤ºåˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰é“¾ï¼Œè‡ªå®šä¹‰é“¾çš„åç§°ä¸ºâ€IN_WEBâ€</p>
<p>è‡ªå®šä¹‰é“¾åˆ›å»ºå®Œæˆåï¼ŒæŸ¥çœ‹filterè¡¨ä¸­çš„é“¾ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œè‡ªå®šä¹‰é“¾å·²ç»è¢«åˆ›å»ºï¼Œè€Œä¸”å¯ä»¥çœ‹åˆ°ï¼Œè¿™æ¡è‡ªå®šä¹‰é“¾çš„å¼•ç”¨è®¡æ•°ä¸º0 (0 references)ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™æ¡è‡ªå®šä¹‰é“¾è¿˜æ²¡æœ‰è¢«ä»»ä½•é»˜è®¤é“¾æ‰€å¼•ç”¨ï¼Œæ‰€ä»¥ï¼Œå³ä½¿IN_WEBä¸­é…ç½®äº†è§„åˆ™ï¼Œä¹Ÿä¸ä¼šç”Ÿæ•ˆï¼Œæˆ‘ä»¬ç°åœ¨ä¸ç”¨åœ¨æ„å®ƒï¼Œç»§ç»­èŠæˆ‘ä»¬çš„è‡ªå®šä¹‰é“¾ã€‚</p>
<p>å¥½äº†ï¼Œè‡ªå®šä¹‰é“¾å·²ç»åˆ›å»ºå®Œæ¯•ï¼Œç°åœ¨æˆ‘ä»¬å°±å¯ä»¥ç›´æ¥åœ¨è‡ªå®šä¹‰é“¾ä¸­é…ç½®è§„åˆ™äº†ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬é…ç½®ä¸€äº›è§„åˆ™ç”¨äºä¸¾ä¾‹ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifajw0000pwr7fssa1zca/2.png" alt="IMAGE"></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå¯¹è‡ªå®šä¹‰é“¾çš„æ“ä½œä¸å¯¹é»˜è®¤é“¾çš„æ“ä½œå¹¶æ²¡æœ‰ä»€ä¹ˆä¸åŒï¼Œä¸€åˆ‡æŒ‰ç…§æ“ä½œé»˜è®¤é“¾çš„æ–¹æ³•æ“ä½œè‡ªå®šä¹‰é“¾å³å¯ã€‚</p>
<p>ç°åœ¨ï¼Œè‡ªå®šä¹‰é“¾ä¸­å·²ç»æœ‰äº†ä¸€äº›è§„åˆ™ï¼Œä½†æ˜¯ç›®å‰ï¼Œè¿™äº›è§„åˆ™æ— æ³•åŒ¹é…åˆ°ä»»ä½•æŠ¥æ–‡ï¼Œå› ä¸ºæˆ‘ä»¬å¹¶æ²¡æœ‰åœ¨ä»»ä½•é»˜è®¤é“¾ä¸­å¼•ç”¨å®ƒã€‚</p>
<p>æ—¢ç„¶IN_WEBé“¾æ˜¯ä¸ºäº†é’ˆå¯¹webæœåŠ¡çš„å…¥ç«™è§„åˆ™è€Œåˆ›å»ºçš„ï¼Œé‚£ä¹ˆè¿™äº›è§„åˆ™åº”è¯¥å»åŒ¹é…å…¥ç«™çš„æŠ¥æ–‡ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬åº”è¯¥ç”¨INPUTé“¾å»å¼•ç”¨å®ƒã€‚</p>
<p>å½“ç„¶ï¼Œè‡ªå®šä¹‰é“¾åœ¨å“ªé‡Œåˆ›å»ºï¼Œåº”è¯¥è¢«å“ªæ¡é»˜è®¤é“¾å¼•ç”¨ï¼Œå–å†³äºå®é™…çš„å·¥ä½œåœºæ™¯ï¼Œå› ä¸ºæ­¤å¤„ç¤ºä¾‹çš„è§„åˆ™æ˜¯åŒ¹é…å…¥ç«™æŠ¥æ–‡ï¼Œæ‰€ä»¥åœ¨INPUTé“¾ä¸­å¼•ç”¨è‡ªå®šä¹‰é“¾ã€‚</p>
<p>ç¤ºä¾‹å¦‚ä¸‹ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifajw0000pwr7fssa1zca/3.png" alt="IMAGE"></p>
<p>ä¸Šå›¾ä¸­ï¼Œæˆ‘ä»¬åœ¨INPUTé“¾ä¸­æ·»åŠ äº†ä¸€æ¡è§„åˆ™ï¼Œè®¿é—®æœ¬æœº80ç«¯å£çš„tcpæŠ¥æ–‡å°†ä¼šè¢«è¿™æ¡è§„åˆ™åŒ¹é…åˆ°</p>
<p>è€Œä¸Šè¿°è§„åˆ™ä¸­çš„â€-j IN_WEBâ€è¡¨ç¤ºï¼šè®¿é—®80ç«¯å£çš„tcpæŠ¥æ–‡å°†ç”±è‡ªå®šä¹‰é“¾â€IN_WEBâ€ä¸­çš„è§„åˆ™è¿›è¡Œå¤„ç†ï¼Œæ²¡é”™ï¼Œåœ¨ä¹‹å‰çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨â€-jâ€é€‰é¡¹æŒ‡å®šåŠ¨ä½œï¼Œè€Œæ­¤å¤„ï¼Œæˆ‘ä»¬å°†â€åŠ¨ä½œâ€æ›¿æ¢ä¸ºäº†â€è‡ªå®šä¹‰é“¾â€ï¼Œå½“â€-jâ€å¯¹åº”çš„å€¼ä¸ºä¸€ä¸ªè‡ªå®šä¹‰é“¾æ—¶ï¼Œå°±è¡¨ç¤ºè¢«å½“å‰è§„åˆ™åŒ¹é…åˆ°çš„æŠ¥æ–‡å°†äº¤ç”±å¯¹åº”çš„è‡ªå®šä¹‰é“¾å¤„ç†ï¼Œå…·ä½“æ€æ ·å¤„ç†ï¼Œå–å†³äºè‡ªå®šä¹‰é“¾ä¸­çš„è§„åˆ™ï¼Œå½“IN_WEBè‡ªå®šä¹‰é“¾è¢«INPUTé“¾å¼•ç”¨ä»¥åï¼Œå¯ä»¥å‘ç°ï¼ŒIN_WEBé“¾çš„å¼•ç”¨è®¡æ•°å·²ç»å˜ä¸º1ï¼Œè¡¨ç¤ºè¿™æ¡è‡ªå®šä¹‰é“¾å·²ç»è¢«å¼•ç”¨äº†1æ¬¡ï¼Œè‡ªå®šä¹‰é“¾è¿˜å¯ä»¥å¼•ç”¨å…¶ä»–çš„è‡ªå®šä¹‰é“¾ï¼Œæ„Ÿå…´è¶£çš„è¯ï¼ŒåŠ¨æ‰‹è¯•è¯•å§ã€‚</p>
<p>åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬è¯´è¿‡ï¼Œâ€åŠ¨ä½œâ€åœ¨iptablesä¸­è¢«ç§°ä¸ºâ€targetâ€ï¼Œè¿™æ ·æè¿°å¹¶ä¸å‡†ç¡®ï¼Œå› ä¸ºtargetä¸ºç›®æ ‡ä¹‹æ„ï¼ŒæŠ¥æ–‡è¢«è§„åˆ™åŒ¹é…åˆ°ä»¥åï¼Œtargetèƒ½æ˜¯ä¸€ä¸ªâ€åŠ¨ä½œâ€ï¼Œtargetä¹Ÿèƒ½æ˜¯ä¸€ä¸ªâ€è‡ªå®šä¹‰é“¾â€ï¼Œå½“targetä¸ºä¸€ä¸ªåŠ¨ä½œæ—¶ï¼Œè¡¨ç¤ºæŠ¥æ–‡æŒ‰ç…§æŒ‡å®šçš„åŠ¨ä½œå¤„ç†ï¼Œå½“targetä¸ºè‡ªå®šä¹‰é“¾æ—¶ï¼Œè¡¨ç¤ºæŠ¥æ–‡ç”±è‡ªå®šä¹‰é“¾ä¸­çš„è§„åˆ™å¤„ç†ï¼Œç°åœ¨å›è¿‡å¤´å†ç†è§£ä¹‹å‰çš„æœ¯è¯­ï¼Œä¼¼ä¹æ›´åŠ æ˜äº†äº†ã€‚</p>
<p>é‚£ä¹ˆæ­¤åˆ»ï¼Œæˆ‘ä»¬åœ¨192.168.1.139ä¸Šå°è¯•è®¿é—®æœ¬æœºçš„80ç«¯å£ï¼Œå·²ç»è¢«æ‹’ç»è®¿é—®ï¼Œè¯æ˜åˆšæ‰è‡ªå®šä¹‰é“¾ä¸­çš„è§„åˆ™å·²ç»ç”Ÿæ•ˆäº†ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifajw0000pwr7fssa1zca/4.png" alt="IMAGE"></p>
<p>è¿‡äº†ä¸€æ®µæ—¶é—´ï¼Œæˆ‘ä»¬å‘ç°IN_WEBè¿™ä¸ªåå­—ä¸å¤ªåˆé€‚ï¼Œæˆ‘ä»¬æƒ³è¦å°†è¿™æ¡è‡ªå®šä¹‰é“¾é‡å‘½åï¼ŒæŠŠåå­—æ”¹æˆWEBï¼Œå¯ä»¥å—ï¼Ÿå¿…é¡»èƒ½å•Šï¼Œç¤ºä¾‹å¦‚ä¸‹</p>
<p><img src="/2022/06/13/uncatalog/cl4cifajw0000pwr7fssa1zca/5.png" alt="IMAGE"></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œä½¿ç”¨â€-Eâ€é€‰é¡¹å¯ä»¥ä¿®æ”¹è‡ªå®šä¹‰é“¾åï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå¼•ç”¨è‡ªå®šä¹‰é“¾å¤„çš„åç§°ä¼šè‡ªåŠ¨å‘ç”Ÿæ”¹å˜ã€‚</p>
<p>å¥½äº†ï¼Œæˆ‘ä»¬å·²ç»èƒ½å¤Ÿåˆ›å»ºè‡ªå®šä¹‰äº†ï¼Œé‚£ä¹ˆæ€æ ·åˆ é™¤è‡ªå®šä¹‰é“¾å‘¢ï¼Ÿ</p>
<p>ä½¿ç”¨â€-Xâ€é€‰é¡¹å¯ä»¥åˆ é™¤è‡ªå®šä¹‰é“¾ï¼Œä½†æ˜¯åˆ é™¤è‡ªå®šä¹‰é“¾æ—¶ï¼Œéœ€è¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼š</p>
<p>1ã€è‡ªå®šä¹‰é“¾æ²¡æœ‰è¢«ä»»ä½•é»˜è®¤é“¾å¼•ç”¨ï¼Œå³è‡ªå®šä¹‰é“¾çš„å¼•ç”¨è®¡æ•°ä¸º0ã€‚</p>
<p>2ã€è‡ªå®šä¹‰é“¾ä¸­æ²¡æœ‰ä»»ä½•è§„åˆ™ï¼Œå³è‡ªå®šä¹‰é“¾ä¸ºç©ºã€‚</p>
<p>é‚£ä¹ˆï¼Œæˆ‘ä»¬æ¥åˆ é™¤è‡ªå®šä¹‰é“¾WEBè¯•è¯•ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifajw0000pwr7fssa1zca/6.png" alt="IMAGE"></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œä½¿ç”¨â€-Xâ€é€‰é¡¹åˆ é™¤å¯¹åº”çš„è‡ªå®šä¹‰é“¾ï¼Œä½†æ˜¯ä¸Šä¾‹ä¸­ï¼Œå¹¶æ²¡æœ‰æˆåŠŸåˆ é™¤è‡ªå®šä¹‰é“¾WEBï¼Œæç¤ºï¼šToo many linksï¼Œæ˜¯å› ä¸ºWEBé“¾å·²ç»è¢«é»˜è®¤é“¾æ‰€å¼•ç”¨ï¼Œä¸æ»¡è¶³ä¸Šè¿°æ¡ä»¶1ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦åˆ é™¤å¯¹åº”çš„å¼•ç”¨è§„åˆ™ï¼Œç¤ºä¾‹å¦‚ä¸‹ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifajw0000pwr7fssa1zca/7.png" alt="IMAGE"></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œåˆ é™¤å¼•ç”¨è‡ªå®šä¹‰é“¾çš„è§„åˆ™åï¼Œå†æ¬¡å°è¯•åˆ é™¤è‡ªå®šä¹‰é“¾ï¼Œæç¤ºï¼šDirectory not emptyï¼Œæ˜¯å› ä¸ºWEBé“¾ä¸­å­˜åœ¨è§„åˆ™ï¼Œä¸æ»¡è¶³ä¸Šè¿°æ¡ä»¶2ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦æ¸…ç©ºå¯¹åº”çš„è‡ªå®šä¹‰é“¾ï¼Œç¤ºä¾‹å¦‚ä¸‹</p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œä½¿ç”¨â€-Xâ€é€‰é¡¹å¯ä»¥åˆ é™¤ä¸€ä¸ªå¼•ç”¨è®¡æ•°ä¸º0çš„ã€ç©ºçš„è‡ªå®šä¹‰é“¾ã€‚</p>
<p>å°ç»“<br>ä¸ºäº†æ–¹ä¾¿ä»¥åå›é¡¾ï¼Œæˆ‘ä»¬å°†ä¸Šè¿°å‘½ä»¤è¿›è¡Œæ€»ç»“ã€‚</p>
<p>åˆ›å»ºè‡ªå®šä¹‰é“¾</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">ç¤ºä¾‹ï¼šåœ¨filterè¡¨ä¸­åˆ›å»ºIN_WEBè‡ªå®šä¹‰é“¾</span></span><br><span class="line">iptables -t filter -N IN_WEB</span><br></pre></td></tr></table></figure></div>


<p>å¼•ç”¨è‡ªå®šä¹‰é“¾</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">ç¤ºä¾‹ï¼šåœ¨INPUTé“¾ä¸­å¼•ç”¨åˆšæ‰åˆ›å»ºçš„è‡ªå®šä¹‰é“¾</span></span><br><span class="line">iptables -t filter -I INPUT -p tcp --dport 80 -j IN_WEB</span><br></pre></td></tr></table></figure></div>


<p>é‡å‘½åè‡ªå®šä¹‰é“¾</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">ç¤ºä¾‹ï¼šå°†IN_WEBè‡ªå®šä¹‰é“¾é‡å‘½åä¸ºWEB</span></span><br><span class="line">iptables -E IN_WEB WEB</span><br></pre></td></tr></table></figure></div>


<p>åˆ é™¤è‡ªå®šä¹‰é“¾<br>åˆ é™¤è‡ªå®šä¹‰é“¾éœ€è¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶</p>
<p>1ã€è‡ªå®šä¹‰é“¾æ²¡æœ‰è¢«å¼•ç”¨</p>
<p>2ã€è‡ªå®šä¹‰é“¾ä¸­æ²¡æœ‰ä»»ä½•è§„åˆ™</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">ç¤ºä¾‹ï¼šåˆ é™¤å¼•ç”¨è®¡æ•°ä¸º0å¹¶ä¸”ä¸åŒ…å«ä»»ä½•è§„åˆ™çš„WEBé“¾</span></span><br><span class="line">iptables -X WEB</span><br></pre></td></tr></table></figure></div>]]></content>
      <tags>
        <tag>äº‘åŸç”ŸåŸºç¡€ç³»åˆ—</tag>
        <tag>Kubernetesç½‘ç»œ</tag>
      </tags>
  </entry>
  <entry>
    <title>Kubernetesç½‘ç»œç³»åˆ—ä¹‹(ä¸‰åä¸€)iptablesä¹‹ç½‘ç»œé˜²ç«å¢™</title>
    <url>/2022/06/13/uncatalog/cl4cifajy0001pwr71ippfotz/</url>
    <content><![CDATA[<hr>
<span id="more"></span>

<hr>
<p>é˜…è¯»è¿™ç¯‡æ–‡ç« éœ€è¦ç«™åœ¨å‰æ–‡çš„åŸºç¡€ä¹‹ä¸Šï¼Œå¦‚æœåœ¨é˜…è¯»æ—¶é‡åˆ°éšœç¢ï¼Œè¯·å›é¡¾å‰æ–‡ã€‚</p>
<p>æˆ‘ä»¬ä¸€èµ·æ¥å›é¡¾ä¸€ä¸‹ä¹‹å‰çš„çŸ¥è¯†ï¼Œåœ¨ç¬¬ä¸€ç¯‡ä»‹ç»iptablesçš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°±æè¿°è¿‡é˜²ç«å¢™çš„æ¦‚å¿µï¼Œæˆ‘ä»¬è¯´è¿‡ï¼Œé˜²ç«å¢™ä»é€»è¾‘ä¸Šè®²ï¼Œå¯ä»¥åˆ†ä¸ºä¸»æœºé˜²ç«å¢™ä¸ç½‘ç»œé˜²ç«å¢™ã€‚</p>
<p>ä¸»æœºé˜²ç«å¢™ï¼šé’ˆå¯¹äºå•ä¸ªä¸»æœºè¿›è¡Œé˜²æŠ¤ã€‚</p>
<p>ç½‘ç»œé˜²ç«å¢™ï¼š å¾€å¾€å¤„äºç½‘ç»œå…¥å£æˆ–è¾¹ç¼˜ï¼Œé’ˆå¯¹äºç½‘ç»œå…¥å£è¿›è¡Œé˜²æŠ¤ï¼ŒæœåŠ¡äºé˜²ç«å¢™èƒŒåçš„æœ¬åœ°å±€åŸŸç½‘ã€‚</p>
<p>åœ¨å‰æ–‡çš„ä¸¾ä¾‹ä¸­ï¼Œiptableséƒ½æ˜¯ä½œä¸ºä¸»æœºé˜²ç«å¢™çš„è§’è‰²å‡ºç°çš„ï¼Œé‚£ä¹ˆï¼Œiptablesæ€æ ·ä½œä¸ºç½‘ç»œé˜²ç«å¢™å‘¢ï¼Ÿè¿™å°±æ˜¯æˆ‘ä»¬ä»Šå¤©è¦èŠçš„è¯é¢˜ã€‚</p>
<p>å›åˆ°åˆšæ‰çš„æ¦‚å¿µï¼Œç½‘ç»œé˜²ç«å¢™å¾€å¾€å¤„äºç½‘ç»œçš„å…¥å£æˆ–è€…è¾¹ç¼˜ï¼Œé‚£ä¹ˆï¼Œå¦‚æœæƒ³è¦ä½¿ç”¨iptableså……å½“ç½‘ç»œé˜²ç«å¢™ï¼Œiptablesæ‰€åœ¨çš„ä¸»æœºåˆ™éœ€è¦å¤„äºç½‘ç»œå…¥å£å¤„ï¼Œç¤ºæ„å›¾å¦‚ä¸‹ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifajy0001pwr71ippfotz/1.png" alt="iamge"><br>ä¸Šå›¾ä¸­ï¼Œæ©˜é»„è‰²ä¸»æœºä¸ºiptablesæ‰€åœ¨ä¸»æœºï¼Œæ­¤æ—¶iptableså……å½“çš„è§’è‰²å³ä¸ºç½‘ç»œé˜²ç«å¢™ï¼Œä¸Šå›¾ä¸­çš„æµ…è“è‰²åœ†å½¢è¡¨ç¤ºç½‘ç»œé˜²ç«å¢™æ‰€é˜²æŠ¤çš„ç½‘ç»œåŒºåŸŸï¼Œåœ†å½¢å†…çš„è“è‰²çŸ©å½¢è¡¨ç¤ºç½‘ç»œå†…çš„ä¸»æœºã€‚</p>
<p>å½“å¤–éƒ¨ç½‘ç»œä¸­çš„ä¸»æœºä¸ç½‘ç»œå†…éƒ¨ä¸»æœºé€šè®¯æ—¶ï¼Œä¸ç®¡æ˜¯ç”±å¤–éƒ¨ä¸»æœºå‘å¾€å†…éƒ¨ä¸»æœºçš„æŠ¥æ–‡ï¼Œè¿˜æ˜¯ç”±å†…éƒ¨ä¸»æœºå‘å¾€å¤–éƒ¨ä¸»æœºçš„æŠ¥æ–‡ï¼Œéƒ½éœ€è¦ç»è¿‡iptablesæ‰€åœ¨çš„ä¸»æœºï¼Œç”±iptablesæ‰€åœ¨çš„ä¸»æœºè¿›è¡Œâ€è¿‡æ»¤å¹¶è½¬å‘â€ï¼Œæ‰€ä»¥ï¼Œé˜²ç«å¢™ä¸»æœºçš„ä¸»è¦å·¥ä½œå°±æ˜¯â€è¿‡æ»¤å¹¶è½¬å‘â€ï¼Œé‚£ä¹ˆï¼Œè¯´åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬åˆ™ä¸å¾—ä¸å†æ¬¡å›é¡¾ä¹‹å‰çš„iptablesæŠ¥æ–‡æµç¨‹å›¾äº†ï¼Œå¦‚ä¸‹ï¼š</p>
<p><img src="/2022/06/13/uncatalog/cl4cifajy0001pwr71ippfotz/2.png" alt="iamge"></p>
<p>å‰æ–‡ä¸­ï¼Œiptableséƒ½æ˜¯ä½œä¸ºâ€ä¸»æœºé˜²ç«å¢™â€çš„è§’è‰²å‡ºç°çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸¾ä¾‹æ—¶ï¼Œåªç”¨åˆ°äº†ä¸Šå›¾ä¸­çš„INPUTé“¾ä¸OUTPUTé“¾ï¼Œå› ä¸ºæ‹¥æœ‰â€è¿‡æ»¤åŠŸèƒ½â€çš„é“¾åªæœ‰3æ¡ï¼ŒINPUTã€OUTPUTã€FORWARDï¼Œå½“æŠ¥æ–‡å‘å¾€æœ¬æœºæ—¶ï¼Œå¦‚æœæƒ³è¦è¿‡æ»¤ï¼Œåªèƒ½åœ¨INPUTé“¾ä¸OUTPUTé“¾ä¸­å®ç°ï¼Œè€Œæ­¤æ—¶ï¼Œiptablesçš„è§’è‰²å‘ç”Ÿäº†è½¬å˜ï¼Œæˆ‘ä»¬æƒ³è¦å°†iptablesæ‰€åœ¨çš„ä¸»æœºæ‰“é€ æˆâ€ç½‘ç»œé˜²ç«å¢™â€ï¼Œè€Œåˆšæ‰å·²ç»è¯´è¿‡ï¼Œç½‘ç»œé˜²ç«å¢™çš„èŒè´£å°±æ˜¯â€è¿‡æ»¤å¹¶è½¬å‘â€ï¼Œè¦æƒ³â€è¿‡æ»¤â€ï¼Œåªèƒ½åœ¨INPUTã€OUTPUTã€FORWARDä¸‰æ¡é“¾ä¸­å®ç°ï¼Œè¦æƒ³â€è½¬å‘â€ï¼ŒæŠ¥æ–‡åˆ™åªä¼šç»è¿‡FORWARDé“¾ï¼ˆå‘å¾€æœ¬æœºçš„æŠ¥æ–‡æ‰ä¼šç»è¿‡INPUTé“¾ï¼‰ï¼Œæ‰€ä»¥ï¼Œç»¼ä¸Šæ‰€è¿°ï¼Œiptablesçš„è§’è‰²å˜ä¸ºâ€ç½‘ç»œé˜²ç«å¢™â€æ—¶ï¼Œè§„åˆ™åªèƒ½å®šä¹‰åœ¨FORWARDé“¾ä¸­ã€‚</p>
<h3 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h3><p>é‚£ä¹ˆä¸ºäº†èƒ½å¤Ÿè¿›è¡Œå®éªŒï¼Œæˆ‘ä»¬æ¥è®¾ç½®ä¸€ä¸‹å®éªŒåœºæ™¯ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼ˆåé¢æœ‰å¯¹å›¾çš„è§£é‡Šï¼‰</p>
<p><img src="/2022/06/13/uncatalog/cl4cifajy0001pwr71ippfotz/3.png" alt="iamge"></p>
<p>æˆ‘ä»¬å‡è®¾ï¼Œä¸Šå›¾ä¸­åœ†å½¢æ‰€ç¤ºçš„ç½‘ç»œä¸ºå†…éƒ¨ç½‘ç»œ</p>
<p>æ³¨ï¼šæ­¤å¤„æ‰€æè¿°çš„å†…ç½‘ã€å¤–ç½‘ä¸æˆ‘ä»¬å¹³å¸¸æ‰€è¯´çš„å…¬ç½‘ã€ç§ç½‘ä¸åŒã€‚</p>
<p>æ­¤å¤„æè¿°çš„å†…å¤–éƒ¨ç½‘ç»œä½ å¯ä»¥ç†è§£æˆä¸¤ä¸ªç½‘æ®µï¼ŒAç½‘ç»œä¸Bç½‘ç»œï¼Œä¸ºäº†æ–¹ä¾¿æè¿°ï¼Œæˆ‘ä»¬æŠŠåœ†å½¢å†…çš„ä¸»æœºç§°ä¸ºå†…éƒ¨ä¸»æœºï¼ŒæŠŠä¸Šå›¾ä¸­åœ†å½¢æ‰€è¡¨ç¤ºçš„ç½‘ç»œç§°ä¸ºå†…éƒ¨ç½‘ç»œï¼ŒæŠŠåœ†å½¢å¤–çš„ç½‘ç»œç§°ä¸ºå¤–éƒ¨ç½‘ç»œã€‚</p>
<p>å‡è®¾ï¼Œå†…éƒ¨ç½‘ç»œçš„ç½‘æ®µä¸º10.1.0.0/16ï¼Œæ­¤å†…éƒ¨ç½‘ç»œä¸­å­˜åœ¨ä¸»æœºCï¼Œä¸»æœºCçš„IPåœ°å€ä¸º10.1.0.1ã€‚</p>
<p>ä¸Šå›¾ä¸­çš„ä¸»æœºBå……å½“äº†ç½‘ç»œé˜²ç«å¢™çš„è§’è‰²ï¼Œä¸»æœºBä¹Ÿå±äºå†…éƒ¨ç½‘ç»œï¼ŒåŒæ—¶ä¸»æœºBä¹Ÿèƒ½ä¸å¤–éƒ¨ç½‘ç»œè¿›è¡Œé€šè®¯ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œä¸»æœºBæœ‰ä¸¤å—ç½‘å¡ï¼Œç½‘å¡1ä¸ç½‘å¡2ï¼Œç½‘å¡1çš„IPåœ°å€ä¸º10.1.0.3ï¼Œç½‘å¡2çš„IPåœ°å€ä¸º192.168.1.146ï¼Œæ‰€ä»¥ï¼Œé˜²ç«å¢™ä¸»æœºåœ¨å†…éƒ¨ç½‘ç»œä¸­çš„IPåœ°å€ä¸º10.1.0.3ï¼Œé˜²ç«å¢™ä¸»æœºä¸å¤–éƒ¨ç½‘ç»œé€šè®¯çš„IPåœ°å€ä¸º192.168.1.146ã€‚</p>
<p>ä¸Šå›¾ä¸­çš„ä¸»æœºAå……å½“äº†â€å¤–éƒ¨ç½‘ç»œä¸»æœºâ€çš„è§’è‰²ï¼ŒAä¸»æœºçš„IPåœ°å€ä¸º192.168.1.147ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸»æœºAè®¿é—®å†…éƒ¨ç½‘ç»œä¸­çš„ä¸»æœºCï¼Œä½†æ˜¯éœ€è¦ä¸»æœºBè¿›è¡Œè½¬å‘ï¼Œä¸»æœºBåœ¨è½¬å‘æŠ¥æ–‡æ—¶ä¼šè¿›è¡Œè¿‡æ»¤ï¼Œä»¥å®ç°ç½‘ç»œé˜²ç«å¢™çš„åŠŸèƒ½ã€‚</p>
<p>æˆ‘å·²ç»å‡†å¤‡äº†3å°è™šæ‹Ÿæœºï¼ŒAã€Bã€C</p>
<p>è™šæ‹ŸæœºAä¸è™šæ‹ŸæœºBçš„ç½‘å¡2éƒ½ä½¿ç”¨äº†æ¡¥æ¥æ¨¡å¼ã€‚</p>
<p>ä¸ºäº†èƒ½å¤Ÿå°½é‡æ¨¡æ‹Ÿå†…éƒ¨ç½‘ç»œçš„ç½‘ç»œå…¥å£ï¼Œæˆ‘ä»¬å°†è™šæ‹ŸæœºBçš„ç½‘å¡1ä¸è™šæ‹ŸæœºCåŒæ—¶æ”¾åœ¨â€ä»…ä¸»æœºæ¨¡å¼â€çš„è™šæ‹Ÿç½‘ç»œä¸­ï¼Œè™šæ‹Ÿæœºè®¾ç½®å¦‚ä¸‹å›¾æ‰€ç¤º</p>
<p>ç‚¹å‡»vmwareç¼–è¾‘èœå•ï¼Œæ‰“å¼€è™šæ‹Ÿç½‘ç»œç¼–è¾‘å™¨ï¼Œç‚¹å‡»æ›´æ”¹è®¾ç½®æŒ‰é’®ï¼Œæ·»åŠ ä¸€ä¸ªä»…ä¸»æœºæ¨¡å¼çš„è™šæ‹Ÿç½‘ç»œï¼Œä¸‹å›¾ä¸­çš„vmnet6ä¸ºå·²ç»æ·»åŠ è¿‡çš„è™šæ‹Ÿç½‘ç»œï¼Œæ­¤å¤„ä¸å†é‡å¤æ·»åŠ ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifajy0001pwr71ippfotz/4.png" alt="iamge"></p>
<p>ç”±äºBä¸»æœºç°åœ¨çš„è§’è‰²æ˜¯10.1.0.0ä¸­çš„â€ç½‘ç»œé˜²ç«å¢™â€ï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬ç›´æ¥å°†Cä¸»æœºçš„ç½‘å…³æŒ‡å‘Bä¸»æœºçš„å†…éƒ¨ç½‘ç»œIPï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º</p>
<p><img src="/2022/06/13/uncatalog/cl4cifajy0001pwr71ippfotz/5.png" alt="iamge"></p>
<p>åŒæ—¶ï¼Œä¸ºäº†å°½é‡ç®€åŒ–è·¯ç”±è®¾ç½®ï¼Œæˆ‘ä»¬ç›´æ¥å°†Aä¸»æœºè®¿é—®10.1ç½‘ç»œæ—¶çš„ç½‘å…³æŒ‡å‘Bä¸»æœºçš„ç½‘å¡2ä¸Šçš„IPï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p>
<p>æ³¨ï¼šrouteå‘½ä»¤é…ç½®çš„è·¯ç”±æ¡ç›®åœ¨ç½‘ç»œé‡å¯åå°†ä¼šå¤±æ•ˆ</p>
<p><img src="/2022/06/13/uncatalog/cl4cifajy0001pwr71ippfotz/6.png" alt="iamge"></p>
<p>ç°åœ¨Aä¸»æœºé€šå¾€10.1ç½‘ç»œçš„ç½‘å…³å·²ç»æŒ‡å‘äº†Bä¸»æœºï¼Œé‚£ä¹ˆï¼Œç°åœ¨Aä¸»æœºèƒ½å¤Ÿè¾¾åˆ°10.1.0.0/16ç½‘ç»œå—ï¼Ÿæˆ‘ä»¬æ¥è¯•è¯•</p>
<p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬ç›´æ¥åœ¨Aä¸»æœºä¸Šå‘Cä¸»æœºå‘èµ·pingè¯·æ±‚ï¼Œå¹¶æ²¡æœ‰å¾—åˆ°ä»»ä½•å›åº”ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifajy0001pwr71ippfotz/7.png" alt="iamge"></p>
<p>é‚£ä¹ˆï¼Œæˆ‘ä»¬å†æ¥è¯•è¯•Bä¸»æœºä¸Šçš„å†…éƒ¨ç½‘IPï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œç›´æ¥åœ¨Aä¸»æœºä¸Šå‘Bä¸»æœºçš„å†…éƒ¨ç½‘IPå‘èµ·pingè¯·æ±‚ï¼Œå‘ç°æ˜¯å¯ä»¥pingé€šçš„ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ<br><img src="/2022/06/13/uncatalog/cl4cifajy0001pwr71ippfotz/8.png" alt="iamge"></p>
<p>æŒ‰ç…§é“ç†æ¥è¯´ï¼Œ10.1.0.1ä¸10.1.0.3éƒ½å±äº10.1.0.0/16ç½‘æ®µï¼Œä¸ºä»€ä¹ˆBä¸»æœºä¸Šçš„IPå°±èƒ½é€šï¼ŒCä¸»æœºä¸Šçš„IPå´ä¸é€šå‘¢ï¼Ÿ</p>
<p>å’±ä»¬å…ˆæ¥èŠèŠä¸ºä»€ä¹ˆ10.1.0.1æ²¡æœ‰å›åº”ã€‚</p>
<p>Aä¸»æœºé€šè¿‡è·¯ç”±è¡¨å¾—çŸ¥ï¼Œå‘å¾€10.1.0.0/16ç½‘æ®µçš„æŠ¥æ–‡çš„ç½‘å…³ä¸ºBä¸»æœºï¼Œå½“æŠ¥æ–‡è¾¾åˆ°Bä¸»æœºæ—¶ï¼ŒBä¸»æœºå‘ç°Açš„ç›®æ ‡ä¸º10.1.0.1ï¼Œè€Œè‡ªå·±çš„IPæ˜¯10.1.0.3ï¼Œè¿™æ—¶ï¼ŒBä¸»æœºåˆ™éœ€è¦å°†è¿™ä¸ªæŠ¥æ–‡è½¬å‘ç»™10.1.0.1ï¼ˆä¹Ÿå°±æ˜¯Cä¸»æœºï¼‰ï¼Œä½†æ˜¯ï¼ŒLinuxä¸»æœºåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œå¹¶ä¸ä¼šè½¬å‘æŠ¥æ–‡ï¼Œå¦‚æœæƒ³è¦è®©Linuxä¸»æœºèƒ½å¤Ÿè½¬å‘æŠ¥æ–‡ï¼Œéœ€è¦é¢å¤–çš„è®¾ç½®ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆ10.1.0.1æ²¡æœ‰å›åº”çš„åŸå› ï¼Œå› ä¸ºBä¸»æœºå‹æ ¹å°±æ²¡æœ‰å°†Aä¸»æœºçš„pingè¯·æ±‚è½¬å‘ç»™Cä¸»æœºï¼ŒCä¸»æœºå‹æ ¹å°±æ²¡æœ‰æ”¶åˆ°Açš„pingè¯·æ±‚ï¼Œæ‰€ä»¥Aè‡ªç„¶å¾—ä¸åˆ°å›åº”ã€‚</p>
<p>ç°åœ¨å†æ¥èŠèŠä¸ºä»€ä¹ˆ10.1.0.3ä¼šå›åº”ã€‚</p>
<p>è¿™æ˜¯å› ä¸º10.1.0.3è¿™ä¸ªIPä¸192.168.1.146è¿™ä¸ªIPéƒ½å±äºBä¸»æœºï¼Œå½“Aä¸»æœºé€šè¿‡è·¯ç”±è¡¨å°†pingæŠ¥æ–‡å‘é€åˆ°Bä¸»æœºä¸Šæ—¶ï¼ŒBä¸»æœºå‘ç°è‡ªå·±æ—¢æ˜¯192.168.1.146åˆæ˜¯10.1.0.3ï¼Œæ‰€ä»¥ï¼ŒBä¸»æœºå°±ç›´æ¥å›åº”äº†Aä¸»æœºï¼Œå¹¶æ²¡æœ‰å°†æŠ¥æ–‡è½¬å‘ç»™è°ï¼Œæ‰€ä»¥Aä¸»æœºå¾—åˆ°äº†10.1.0.3çš„å›åº”ã€‚</p>
<p>æˆ‘æƒ³æˆ‘åº”è¯¥è¯´æ˜ç™½äº†ï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬åº”è¯¥æ€æ ·è®¾ç½®ï¼Œæ‰èƒ½è®©Linuxä¸»æœºè½¬å‘æŠ¥æ–‡å‘¢ï¼Ÿæˆ‘ä»¬ä¸€èµ·æ¥è®¾ç½®ä¸€éå°±å¥½äº†ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥çœ‹/proc/sys/net/ipv4/ip_forwardæ–‡ä»¶ä¸­çš„å†…å®¹ï¼Œå¦‚æœæ–‡ä»¶å†…å®¹ä¸º0ï¼Œåˆ™è¡¨ç¤ºå½“å‰ä¸»æœºä¸æ”¯æŒè½¬å‘ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifajy0001pwr71ippfotz/9.png" alt="iamge"></p>
<p>å¦‚æœæˆ‘ä»¬æƒ³è¦è®©å½“å‰ä¸»æœºæ”¯æŒæ ¸å¿ƒè½¬å‘åŠŸèƒ½ï¼Œåªéœ€è¦å°†æ­¤æ–‡ä»¶ä¸­çš„å€¼è®¾ç½®ä¸º1å³å¯ï¼Œç¤ºä¾‹å¦‚ä¸‹ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifajy0001pwr71ippfotz/10.png" alt="iamge"></p>
<p>å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬å°±å¼€å¯äº†Bä¸»æœºçš„æ ¸å¿ƒè½¬å‘åŠŸèƒ½ã€‚</p>
<p>é™¤äº†ä¸Šè¿°æ–¹æ³•ï¼Œè¿˜èƒ½ä½¿ç”¨sysctlå‘½ä»¤å»è®¾ç½®æ˜¯å¦å¼€å¯æ ¸å¿ƒè½¬å‘ï¼Œç¤ºä¾‹å¦‚ä¸‹ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifajy0001pwr71ippfotz/11.png" alt="iamge"></p>
<p>ä¸Šè¿°ä¸¤ç§æ–¹æ³•éƒ½èƒ½æ§åˆ¶æ˜¯å¦å¼€å¯æ ¸å¿ƒè½¬å‘ï¼Œä½†æ˜¯é€šè¿‡ä¸Šè¿°ä¸¤ç§æ–¹æ³•è®¾ç½®åï¼Œåªèƒ½ä¸´æ—¶ç”Ÿæ•ˆï¼Œå½“é‡å¯ç½‘ç»œæœåŠ¡ä»¥åï¼Œæ ¸å¿ƒè½¬å‘åŠŸèƒ½å°†ä¼šå¤±æ•ˆã€‚</p>
<p>å¦‚æœæƒ³è¦æ°¸ä¹…ç”Ÿæ•ˆï¼Œåˆ™éœ€è¦è®¾ç½®/etc/sysctl.confæ–‡ä»¶ï¼ˆcentos7ä¸­é…ç½®/usr/lib/sysctl.d/00-system.confæ–‡ä»¶ï¼‰ï¼Œæ·»åŠ ï¼ˆæˆ–ä¿®æ”¹ï¼‰é…ç½®é¡¹ net.ipv4.ip_forward = 1 å³å¯ï¼Œç¤ºä¾‹å¦‚ä¸‹ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifajy0001pwr71ippfotz/12.png" alt="iamge"></p>
<p>ç°åœ¨ï¼ŒBä¸»æœºå·²ç»å…·å¤‡äº†æ ¸å¿ƒè½¬å‘åŠŸèƒ½ï¼Œå·²ç»å¯ä»¥è½¬å‘æŠ¥æ–‡äº†ï¼Œç°åœ¨ï¼Œæˆ‘ä»¬å†æ¬¡å›åˆ°Aä¸»æœºä¸­ï¼Œå‘Cä¸»æœºå‘èµ·pingè¯·æ±‚ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå·²ç»å¯ä»¥pingé€šã€‚</p>
<p>æ³¨ï¼šå¦‚æœä½ ä»ç„¶æ— æ³•pingé€šï¼Œå¯èƒ½æ˜¯å› ä¸ºä½ ä½¿ç”¨routeå‘½ä»¤é…ç½®äº†Cä¸»æœºçš„é»˜è®¤ç½‘å…³ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œè¯·æŸ¥çœ‹Cä¸»æœºçš„è·¯ç”±é…ç½®æ˜¯å¦è‡ªåŠ¨æ¶ˆå¤±äº†ï¼Œå¦‚æœæ²¡æœ‰å¯¹åº”çš„è·¯ç”±æ¡ç›®ï¼Œè¯·é‡æ–°é…ç½®ï¼ŒåŒæ—¶ï¼Œå¦‚æœä½ çš„ä¸»æœºCå¦‚æœæœ‰å¤šå—ç½‘å¡ï¼Œå¯ä»¥æš‚æ—¶ç¦ç”¨å…¶ä»–ç½‘å¡è¯•è¯•</p>
<p><img src="/2022/06/13/uncatalog/cl4cifajy0001pwr71ippfotz/13.png" alt="iamge"><br>åŒæ—¶ï¼Œä»ä¸»æœºCå‘ä¸»æœºAå‘èµ·pingè¯·æ±‚ï¼Œä¹Ÿå¯ä»¥pingé€šï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º</p>
<p><img src="/2022/06/13/uncatalog/cl4cifajy0001pwr71ippfotz/14.png" alt="iamge"></p>
<p>å¥½äº†ï¼Œæˆ‘ä»¬çš„æµ‹è¯•ç¯å¢ƒå·²ç»å‡†å¤‡å®Œæ¯•ï¼Œç°åœ¨å¯ä»¥å¼€å§‹æµ‹è¯•äº†ã€‚</p>
<p>ä½†æ˜¯åœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·ç¡®å®šä¸»æœºAä¸ä¸»æœºCä¸Šæ²¡æœ‰å¯¹åº”çš„iptablesè§„åˆ™ï¼Œå› ä¸ºæ­¤å¤„æˆ‘ä»¬ä¸»è¦æ˜¯ç”¨æ¥æµ‹è¯•â€ç½‘ç»œé˜²ç«å¢™â€çš„ï¼Œä¸ºäº†å‡å°‘ä¸»æœºé˜²ç«å¢™å¸¦æ¥çš„å½±å“ï¼Œæˆ‘ä»¬ç›´æ¥å°†ä¸»æœºAä¸ä¸»æœºCä¸Šçš„è§„åˆ™æ¸…ç©ºã€‚</p>
<h3 id="ç½‘ç»œé˜²ç«å¢™æµ‹è¯•"><a href="#ç½‘ç»œé˜²ç«å¢™æµ‹è¯•" class="headerlink" title="ç½‘ç»œé˜²ç«å¢™æµ‹è¯•"></a>ç½‘ç»œé˜²ç«å¢™æµ‹è¯•</h3><p>ä¹‹å‰è¯´è¿‡ï¼Œiptablesä½œä¸ºç½‘ç»œé˜²ç«å¢™æ—¶ï¼Œä¸»è¦è´Ÿè´£â€è¿‡æ»¤ä¸è½¬å‘â€ï¼Œæ—¢ç„¶è¦è¿‡æ»¤ï¼Œåˆ™éœ€é…ç½®filterè¡¨ï¼Œæ—¢ç„¶è¦è½¬å‘ï¼Œåˆ™éœ€åœ¨FORWAEDé“¾ä¸­å®šä¹‰è§„åˆ™ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬åº”è¯¥åœ¨filterè¡¨ä¸­çš„FORWARDé“¾ä¸­é…ç½®è§„åˆ™ã€‚</p>
<p>é‚£ä¹ˆï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ä¸»æœºBä¸Šçš„filterè¡¨ä¸­æ˜¯å¦å·²ç»å­˜åœ¨è§„åˆ™ï¼Œå¦‚ä¸‹</p>
<p><img src="/2022/06/13/uncatalog/cl4cifajy0001pwr71ippfotz/15.png" alt="iamge"></p>
<p>ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼ŒFORWARDé“¾ä¸­æ²¡æœ‰ä»»ä½•è§„åˆ™ï¼Œé»˜è®¤ç­–ç•¥ä¸ºACCEPTï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨â€ç™½åå•æœºåˆ¶â€ï¼ˆå¦‚æœå¿˜äº†è¯·å›é¡¾å‰æ–‡ï¼šé»‘ç™½åå•æœºåˆ¶ï¼‰</p>
<p>åœ¨ä¸»æœºBä¸­FORWARDé“¾çš„æœ«ç«¯æ·»åŠ ä¸€æ¡é»˜è®¤æ‹’ç»çš„è§„åˆ™ï¼Œç„¶åå°†â€æ”¾è¡Œè§„åˆ™â€è®¾ç½®åœ¨è¿™æ¡â€é»˜è®¤æ‹’ç»è§„åˆ™â€ä¹‹å‰å³å¯ã€‚</p>
<p>ç¤ºä¾‹å¦‚ä¸‹</p>
<p><img src="/2022/06/13/uncatalog/cl4cifajy0001pwr71ippfotz/16.png" alt="iamge"></p>
<p>å¥½äº†ï¼Œé…ç½®å®Œä¸Šè¿°è§„åˆ™åï¼Œä¸»æœºAä¸ä¸»æœºCå·²ç»æ— æ³•é€šè®¯äº†ï¼Œå› ä¸ºå®ƒä»¬ä¹‹é—´å¦‚æœæƒ³è¦é€šè®¯ï¼Œåˆ™éœ€è¦é ä¸»æœºBè¿›è¡Œè½¬å‘ï¼Œè€Œä¸Šè¿°è§„åˆ™è®¾ç½®å®Œæˆåï¼Œæ‰€æœ‰æŠ¥æ–‡éƒ½æ— æ³•é€šè¿‡FORWARDé“¾äº†ï¼Œæ‰€ä»¥ä»»ä½•ç»è¿‡è½¬å‘çš„æŠ¥æ–‡åœ¨ç»è¿‡FORWARDé“¾æ—¶éƒ½ä¼šè¢«æ‹’ç»ï¼Œå¤–éƒ¨ä¸»æœºçš„æŠ¥æ–‡æ— æ³•è½¬å‘åˆ°å†…éƒ¨ä¸»æœºä¸­ï¼Œå†…éƒ¨ç½‘ä¸»æœºçš„æŠ¥æ–‡ä¹Ÿæ— æ³•è½¬å‘åˆ°å¤–éƒ¨ä¸»æœºä¸­ï¼Œå› ä¸ºä¸»æœºBå·²ç»æ‹’ç»è½¬å‘æ‰€æœ‰æŠ¥æ–‡ã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬åŒæ—¶å°†Aä¸»æœºä¸Cä¸»æœºä¸­çš„webæœåŠ¡å¯åŠ¨ï¼Œä»¥ä¾¿è¿›è¡Œæµ‹è¯•ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬å¯åŠ¨Aä¸»æœºçš„httpdæœåŠ¡</p>
<p><img src="/2022/06/13/uncatalog/cl4cifajy0001pwr71ippfotz/17.png" alt="iamge"></p>
<p>åŒæ—¶ï¼Œå¯åŠ¨Cä¸»æœºçš„httpdæœåŠ¡</p>
<p><img src="/2022/06/13/uncatalog/cl4cifajy0001pwr71ippfotz/18.png" alt="iamge"></p>
<p>ç”±äºåˆšæ‰å·²ç»åœ¨ä¸»æœºBä¸­è®¾ç½®äº†é»˜è®¤æ‹’ç»çš„è§„åˆ™ï¼Œæ‰€ä»¥æ­¤åˆ»ï¼ŒAä¸»æœºæ— æ³•è®¿é—®Cä¸»æœºçš„webæœåŠ¡ï¼ŒCä¸»æœºåŒæ ·æ— æ³•è®¿é—®Aä¸»æœºçš„webæœåŠ¡ã€‚</p>
<p>é‚£ä¹ˆï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦ä½¿å†…éƒ¨çš„ä¸»æœºèƒ½å¤Ÿè®¿é—®å¤–éƒ¨ä¸»æœºçš„webæœåŠ¡ï¼Œæˆ‘ä»¬åº”è¯¥æ€æ ·åšå‘¢ï¼Ÿæ²¡é”™ï¼Œæˆ‘ä»¬éœ€è¦åœ¨FORWARDé“¾ä¸­æ”¾è¡Œå†…éƒ¨ä¸»æœºå¯¹å¤–éƒ¨ä¸»æœºçš„webè¯·æ±‚ï¼Œåªéœ€å¦‚ä¸‹é…ç½®å³å¯ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifajy0001pwr71ippfotz/19.png" alt="iamge"></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œé˜²ç«å¢™æ”¾è¡Œäº†å†…éƒ¨ä¸»æœºçš„webè¯·æ±‚ï¼Œå› ä¸ºæˆ‘ä»¬å°†æ¥è‡ªå†…éƒ¨ç½‘ç»œä¸­ç›®æ ‡ç«¯å£ä¸º80çš„æŠ¥æ–‡éƒ½æ”¾è¡Œäº†ï¼Œé‚£ä¹ˆæ­¤æ—¶ï¼Œæˆ‘ä»¬åœ¨Cä¸»æœºä¸Šè®¿é—®Aä¸»æœºçš„webæœåŠ¡è¯•è¯•</p>
<p>æ­¤æ—¶ï¼Œåœ¨ä¸»æœºCä¸Šè®¿é—®ä¸»æœºAçš„webæœåŠ¡ï¼Œå¦‚ä¸‹</p>
<p><img src="/2022/06/13/uncatalog/cl4cifajy0001pwr71ippfotz/20.png" alt="iamge"><br>å¯ä»¥çœ‹åˆ°ï¼Œä¸»æœºCå¹¶æ— æ³•è®¿é—®åˆ°ä¸»æœºAä¸Šçš„webæœåŠ¡ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>èªæ˜å¦‚ä½ è‚¯å®šå·²ç»æƒ³åˆ°äº†ï¼Œæˆ‘ä»¬åªåœ¨ä¸»æœºBä¸Šæ”¾è¡Œäº†å†…éƒ¨ä¸»æœºè®¿é—®80ç«¯å£çš„è¯·æ±‚ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰æ”¾è¡Œå¤–éƒ¨ä¸»æœºçš„å›åº”æŠ¥æ–‡ï¼Œè™½ç„¶å†…éƒ¨ä¸»æœºçš„è¯·æ±‚èƒ½å¤Ÿé€šè¿‡é˜²ç«å¢™ä¸»æœºBè½¬å‘å‡ºå»ï¼Œä½†æ˜¯å›åº”çš„æŠ¥æ–‡åˆ™æ— æ³•è¿›å…¥é˜²ç«å¢™ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬ä»ç„¶éœ€è¦åœ¨ä¸»æœºBä¸Šè¿›è¡Œå¦‚ä¸‹è®¾ç½®ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifajy0001pwr71ippfotz/21.png" alt="iamge"></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå½“å¤–éƒ¨ä¸»æœºä¸­çš„webæœåŠ¡å“åº”å†…éƒ¨ä¸»æœºæ—¶ï¼Œç›®æ ‡åœ°å€è‚¯å®šä¸ºå†…éƒ¨ä¸»æœºï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦æ”¾è¡Œç›®æ ‡IPå±äºå†…éƒ¨ä¸»æœºç½‘æ®µçš„æŠ¥æ–‡ï¼Œæºç«¯å£ä¸º80ï¼Œå› ä¸ºå¤–éƒ¨ä¸»æœºè‚¯å®šä¼šä½¿ç”¨80ç«¯å£è¿›è¡Œå›åº”ã€‚</p>
<p>å®Œæˆä¸Šè¿°é…ç½®åï¼Œå†æ¬¡å›åˆ°Cä¸»æœºä¸Šï¼Œè®¿é—®Aä¸»æœºçš„webæœåŠ¡ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œå·²ç»èƒ½å¤Ÿæ­£å¸¸è®¿é—®äº†ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifajy0001pwr71ippfotz/22.png" alt="iamge"></p>
<p>ä»ä¸Šè¿°ç¤ºä¾‹å¯ä»¥çœ‹å‡ºï¼Œå½“iptablesä½œä¸ºâ€ç½‘ç»œé˜²ç«å¢™â€æ—¶ï¼Œåœ¨é…ç½®è§„åˆ™æ—¶ï¼Œå¾€å¾€éœ€è¦è€ƒè™‘â€åŒå‘æ€§â€ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬ä¸ºäº†è¾¾æˆä¸€ä¸ªç›®çš„ï¼Œå¾€å¾€éœ€è¦ä¸¤æ¡è§„åˆ™æ‰èƒ½å®Œæˆã€‚</p>
<p>é‚£ä¹ˆæ­¤æ—¶ï¼ŒAä¸»æœºèƒ½å¤Ÿè®¿é—®Cä¸»æœºä¸­çš„webæœåŠ¡å—ï¼Ÿæˆ‘æƒ³ä½ å·²ç»çŸ¥é“ç­”æ¡ˆäº†ï¼Œæ²¡é”™ï¼ŒAä¸»æœºæ­¤æ—¶æ— æ³•è®¿é—®Cä¸»æœºä¸­çš„webæœåŠ¡ï¼Œå› ä¸ºBä¸»æœºä¸­å¹¶æ²¡æœ‰æ”¾è¡Œç›¸å…³æŠ¥æ–‡ã€‚</p>
<p>ç»“åˆä¹‹å‰çš„çŸ¥è¯†ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¸Šè¿°è§„åˆ™é…ç½®è¿›è¡Œä¼˜åŒ–ï¼Œæ¯”å¦‚ï¼Œä¸ç®¡æ˜¯ç”±å†…è€Œå¤–ï¼Œè¿˜æ˜¯ç”±å¤–è€Œå†…ï¼Œåªè¦æ˜¯â€å“åº”æŠ¥æ–‡â€ï¼Œæˆ‘ä»¬ç»Ÿç»Ÿæ”¾è¡Œï¼Œé…ç½®å¦‚ä¸‹</p>
<p>æ³¨ï¼šå¦‚æœä½ æ²¡æœ‰æ˜ç™½å¦‚ä¸‹é…ç½®çš„å«ä¹‰ï¼Œè¯·å›é¡¾ä¹‹å‰çš„æ–‡ç« </p>
<p><img src="/2022/06/13/uncatalog/cl4cifajy0001pwr71ippfotz/23.png" alt="iamge"></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå…ˆå°†â€webå“åº”æŠ¥æ–‡æ”¾è¡Œè§„åˆ™â€åˆ é™¤ï¼ŒåŒæ—¶å¢åŠ äº†ä¸Šå›¾ä¸­çš„è§„åˆ™ï¼Œåªéœ€è¦åœ¨ç½‘ç»œé˜²ç«å¢™ä¸»æœºçš„FORWARDé“¾ä¸­æ·»åŠ å¦‚ä¸Šä¸€æ¡è§„åˆ™ï¼Œå°±å¯ä»¥å°†ç»å¤§å¤šæ•°å“åº”æŠ¥æ–‡æ”¾è¡Œäº†ï¼Œä¸ç®¡æ˜¯å¤–éƒ¨å“åº”å†…éƒ¨ï¼Œè¿˜æ˜¯å†…éƒ¨å“åº”å¤–éƒ¨ï¼Œä¸€æ¡è§„åˆ™å°±èƒ½æå®šï¼Œå½“iptablesä½œä¸ºç½‘ç»œé˜²ç«å¢™æ—¶ï¼Œæ¯æ¬¡é…ç½®è§„åˆ™æ—¶éƒ½è¦è€ƒè™‘â€åŒå‘â€çš„é—®é¢˜ï¼Œä½†æ˜¯é…ç½®å®Œä¸Šè¿°è§„åˆ™åï¼Œæˆ‘ä»¬åªè¦è€ƒè™‘è¯·æ±‚æŠ¥æ–‡çš„æ–¹å‘å°±è¡Œäº†ï¼Œè€Œå›åº”æŠ¥æ–‡ï¼Œä¸Šè¿°ä¸€æ¡è§„åˆ™å°±èƒ½æå®šï¼Œè¿™æ ·é…ç½®ï¼Œå³ä½¿ä»¥åæœ‰æ›´å¤šæœåŠ¡çš„å“åº”æŠ¥æ–‡éœ€è¦æ”¾è¡Œï¼Œæˆ‘ä»¬ä¹Ÿä¸ç”¨å†å»é’ˆå¯¹å“åº”æŠ¥æ–‡è®¾ç½®è§„åˆ™äº†ï¼ˆå…·ä½“åŸå› å‰æ–‡å·²ç»è¯¦ç»†çš„æ€»ç»“è¿‡ï¼‰ï¼Œåº”è¯¥ä¼šè®©æˆ‘ä»¬çœå»ä¸å°‘è§„åˆ™å§ã€‚</p>
<p>æ¯”å¦‚ï¼Œæˆ‘ä»¬é™¤äº†æƒ³è¦è®©å†…éƒ¨ä¸»æœºèƒ½å¤Ÿè®¿é—®å¤–éƒ¨çš„webæœåŠ¡ï¼Œè¿˜æƒ³è®©å†…éƒ¨ä¸»æœºèƒ½å¤Ÿè®¿é—®å¤–éƒ¨çš„sshdæœåŠ¡ï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬åˆ™å¯ä»¥è¿›è¡Œå¦‚ä¸‹è®¾ç½®ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifajy0001pwr71ippfotz/24.png" alt="iamge"></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬åªè¦è€ƒè™‘å†…éƒ¨ä¸»æœºçš„è¯·æ±‚æ–¹å‘çš„æŠ¥æ–‡è§„åˆ™å³å¯ï¼Œå› ä¸ºå“åº”æŠ¥æ–‡çš„è§„åˆ™å·²ç»è¢«ä¹‹å‰é…ç½®çš„è§„åˆ™â€æ‰¿åŒ…äº†â€ã€‚</p>
<p>æ­¤åˆ»ï¼Œä½¿ç”¨Cä¸»æœºå³å¯è®¿é—®Aä¸»æœºçš„22ç«¯å£ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifajy0001pwr71ippfotz/25.png" alt="iamge"></p>
<p>ç›®å‰ï¼Œæˆ‘ä»¬åªå…è®¸å†…éƒ¨ä¸»æœºè®¿é—®å¤–éƒ¨ä¸»æœºçš„webæœåŠ¡ä¸sshdæœåŠ¡ï¼Œä½†æ˜¯å¤–éƒ¨ä¸»æœºè¿˜æ— æ³•è®¿é—®å†…éƒ¨ä¸»æœºçš„æœåŠ¡ï¼Œé‚£ä¹ˆå…·ä½“æ€ä¹ˆé…ç½®æˆ‘ä»¬å°±ä¸èµ˜è¿°äº†ï¼Œå°±ç”±å®¢å®˜ä½ å»è´Ÿè´£å®ç°å§ã€‚</p>
<p>å¤‡æ³¨ï¼šåœ¨ä¹‹å‰çš„ä¸€æ¬¡å®éªŒä¸­ï¼Œä½¿ç”¨centos6.8ä½œä¸ºç½‘ç»œé˜²ç«å¢™ï¼Œå‡ºç°äº†å³ä½¿å¼€å¯æ ¸å¿ƒè½¬å‘ï¼Œä¹Ÿæ— æ³•è½¬å‘æŠ¥æ–‡çš„æƒ…å†µï¼Œå…·ä½“åŸå› ä»æœªæŸ¥æ˜ï¼Œé‡åˆ°è¿‡ç±»ä¼¼åœºæ™¯çš„æœ‹å‹å¦‚æœæœ‰è§£å†³æ–¹æ³•ï¼Œæ¬¢è¿èµæ•™ã€‚</p>
<p>å°ç»“<br>ä¸ºäº†æ–¹ä¾¿ä»¥åå›é¡¾ï¼Œæˆ‘ä»¬å°†ä¸Šè¿°è¿‡ç¨‹æç‚¼æ€»ç»“ä¸€ä¸‹ã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">å¦‚æœæƒ³è¦iptablesä½œä¸ºç½‘ç»œé˜²ç«å¢™ï¼Œiptablesæ‰€åœ¨ä¸»æœºå¼€å¯æ ¸å¿ƒè½¬å‘åŠŸèƒ½ï¼Œä»¥ä¾¿èƒ½å¤Ÿè½¬å‘æŠ¥æ–‡ã€‚</span></span><br><span class="line"><span class="meta">#</span><span class="bash">ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹å½“å‰ä¸»æœºæ˜¯å¦å·²ç»å¼€å¯äº†æ ¸å¿ƒè½¬å‘ï¼Œ0è¡¨ç¤ºæœªå¼€å¯ï¼Œ1è¡¨ç¤ºå·²å¼€å¯</span></span><br><span class="line">cat /proc/sys/net/ipv4/ip_forward</span><br><span class="line"><span class="meta">#</span><span class="bash">ä½¿ç”¨å¦‚ä¸‹ä¸¤ç§æ–¹æ³•å‡å¯ä¸´æ—¶å¼€å¯æ ¸å¿ƒè½¬å‘ï¼Œç«‹å³ç”Ÿæ•ˆï¼Œä½†æ˜¯é‡å¯ç½‘ç»œé…ç½®åä¼šå¤±æ•ˆã€‚</span></span><br><span class="line">æ–¹æ³•ä¸€ï¼šecho 1 &gt; /proc/sys/net/ipv4/ip_forward</span><br><span class="line">æ–¹æ³•äºŒï¼šsysctl -w net.ipv4.ip_forward=1</span><br><span class="line"><span class="meta">#</span><span class="bash">ä½¿ç”¨å¦‚ä¸‹æ–¹æ³•å¼€å¯æ ¸å¿ƒè½¬å‘åŠŸèƒ½ï¼Œé‡å¯ç½‘ç»œæœåŠ¡åæ°¸ä¹…ç”Ÿæ•ˆã€‚</span></span><br><span class="line">é…ç½®/etc/sysctl.confæ–‡ä»¶ï¼ˆcentos7ä¸­é…ç½®/usr/lib/sysctl.d/00-system.confæ–‡ä»¶ï¼‰ï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­å°† net.ipv4.ip_forwardè®¾ç½®ä¸º1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">ç”±äºiptablesæ­¤æ—¶çš„è§’è‰²ä¸º<span class="string">&quot;ç½‘ç»œé˜²ç«å¢™&quot;</span>ï¼Œæ‰€ä»¥éœ€è¦åœ¨filterè¡¨ä¸­çš„FORWARDé“¾ä¸­è®¾ç½®è§„åˆ™ã€‚</span></span><br><span class="line"><span class="meta">#</span><span class="bash">å¯ä»¥ä½¿ç”¨<span class="string">&quot;ç™½åå•æœºåˆ¶&quot;</span>ï¼Œå…ˆæ·»åŠ ä¸€æ¡é»˜è®¤æ‹’ç»çš„è§„åˆ™ï¼Œç„¶åå†ä¸ºéœ€è¦æ”¾è¡Œçš„æŠ¥æ–‡è®¾ç½®è§„åˆ™ã€‚</span></span><br><span class="line"><span class="meta">#</span><span class="bash">é…ç½®è§„åˆ™æ—¶éœ€è¦è€ƒè™‘<span class="string">&quot;æ–¹å‘é—®é¢˜&quot;</span>ï¼Œé’ˆå¯¹è¯·æ±‚æŠ¥æ–‡ä¸å›åº”æŠ¥æ–‡ï¼Œè€ƒè™‘æŠ¥æ–‡çš„æºåœ°å€ä¸ç›®æ ‡åœ°å€ï¼Œæºç«¯å£ä¸ç›®æ ‡ç«¯å£ç­‰ã€‚</span></span><br><span class="line"><span class="meta">#</span><span class="bash">ç¤ºä¾‹ä¸ºå…è®¸ç½‘ç»œå†…ä¸»æœºè®¿é—®ç½‘ç»œå¤–ä¸»æœºçš„webæœåŠ¡ä¸sshdæœåŠ¡ã€‚</span></span><br><span class="line">iptables -A FORWARD -j REJECT</span><br><span class="line">iptables -I FORWARD -s 10.1.0.0/16 -p tcp --dport 80 -j ACCEPT</span><br><span class="line">iptables -I FORWARD -d 10.1.0.0/16 -p tcp --sport 80 -j ACCEPT</span><br><span class="line">iptables -I FORWARD -s 10.1.0.0/16 -p tcp --dport 22 -j ACCEPT</span><br><span class="line">iptables -I FORWARD -d 10.1.0.0/16 -p tcp --sport 22 -j ACCEPT</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">å¯ä»¥ä½¿ç”¨stateæ‰©å±•æ¨¡å—ï¼Œå¯¹ä¸Šè¿°è§„åˆ™è¿›è¡Œä¼˜åŒ–ï¼Œä½¿ç”¨å¦‚ä¸‹é…ç½®å¯ä»¥çœç•¥è®¸å¤š<span class="string">&quot;å›åº”æŠ¥æ–‡æ”¾è¡Œè§„åˆ™&quot;</span>ã€‚</span></span><br><span class="line">iptables -A FORWARD -j REJECT</span><br><span class="line">iptables -I FORWARD -s 10.1.0.0/16 -p tcp --dport 80 -j ACCEPT</span><br><span class="line">iptables -I FORWARD -s 10.1.0.0/16 -p tcp --dport 22 -j ACCEPT</span><br><span class="line">iptables -I FORWARD -m state --state ESTABLISHED,RELATED -j ACCEPT</span><br></pre></td></tr></table></figure></div>

<p>ä¸€äº›æ³¨æ„ç‚¹ï¼š</p>
<p>1ã€å½“æµ‹è¯•ç½‘ç»œé˜²ç«å¢™æ—¶ï¼Œé»˜è®¤å‰æä¸ºç½‘ç»œå·²ç»æ­£ç¡®é…ç½®ã€‚</p>
<p>2ã€å½“æµ‹è¯•ç½‘ç»œé˜²ç«å¢™æ—¶ï¼Œå¦‚æœå‡ºç°é—®é¢˜ï¼Œè¯·å…ˆç¡®å®šä¸»æœºé˜²ç«å¢™è§„åˆ™çš„é…ç½®æ²¡æœ‰é—®é¢˜ã€‚</p>
]]></content>
      <tags>
        <tag>äº‘åŸç”ŸåŸºç¡€ç³»åˆ—</tag>
        <tag>Kubernetesç½‘ç»œ</tag>
      </tags>
  </entry>
  <entry>
    <title>Kubernetesç½‘ç»œç³»åˆ—ä¹‹(ä¸‰åäºŒ)iptablesåŠ¨ä½œæ€»ç»“ä¹‹ä¸€</title>
    <url>/2022/06/13/uncatalog/cl4cifak10004pwr75tri6w43/</url>
    <content><![CDATA[<hr>
<span id="more"></span>

<hr>
<p>å‰æ–‡ä¸€ç›´åœ¨ä»‹ç»iptablesçš„åŒ¹é…æ¡ä»¶ï¼Œå¹¶æ²¡æœ‰å¯¹åŠ¨ä½œè¿›è¡Œè¿‡æ€»ç»“ï¼Œé‚£ä¹ˆæ­¤å¤„ï¼Œæˆ‘ä»¬å°±æ¥æ€»ç»“ä¸€ä¸‹iptablesä¸­çš„åŠ¨ä½œã€‚</p>
<p>ä¹‹å‰çš„ä¸¾ä¾‹ä¸­å·²ç»ç”¨åˆ°äº†ä¸€äº›å¸¸ç”¨åŠ¨ä½œï¼Œæ¯”å¦‚ACCEPTã€DROPã€REJECTç­‰ã€‚</p>
<p>å…¶å®ï¼Œâ€åŠ¨ä½œâ€ä¸â€åŒ¹é…æ¡ä»¶â€ä¸€æ ·ï¼Œä¹Ÿæœ‰â€åŸºç¡€â€ä¸â€æ‰©å±•â€ä¹‹åˆ†ã€‚</p>
<p>åŒæ ·ï¼Œä½¿ç”¨æ‰©å±•åŠ¨ä½œä¹Ÿéœ€è¦å€ŸåŠ©æ‰©å±•æ¨¡å—ï¼Œä½†æ˜¯ï¼Œæ‰©å±•åŠ¨ä½œå¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œä¸ç”¨åƒä½¿ç”¨â€æ‰©å±•åŒ¹é…æ¡ä»¶â€é‚£æ ·æŒ‡å®šç‰¹å®šçš„æ¨¡å—ã€‚</p>
<p>ä¹‹å‰ç”¨åˆ°çš„ACCEPTä¸DROPéƒ½å±äºåŸºç¡€åŠ¨ä½œã€‚</p>
<p>è€ŒREJECTåˆ™å±äºæ‰©å±•åŠ¨ä½œã€‚</p>
<p>ä¹‹å‰ä¸¾è¿‡å¾ˆå¤šä¾‹å­ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œä½¿ç”¨-jå¯ä»¥æŒ‡å®šåŠ¨ä½œï¼Œæ¯”å¦‚</p>
<ul>
<li><p>-j ACCEPT</p>
</li>
<li><p>-j DROP</p>
</li>
<li><p>-j REJECT</p>
</li>
</ul>
<p>å…¶å®ï¼Œâ€åŠ¨ä½œâ€ä¹Ÿæœ‰è‡ªå·±çš„é€‰é¡¹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä½¿ç”¨åŠ¨ä½œæ—¶ï¼Œè®¾ç½®å¯¹åº”çš„é€‰é¡¹ï¼Œæ­¤å¤„ä»¥REJECTä¸ºä¾‹ï¼Œå±•å¼€ä¸â€åŠ¨ä½œâ€æœ‰å…³çš„è¯é¢˜ã€‚</p>
<h3 id="åŠ¨ä½œREJECT"><a href="#åŠ¨ä½œREJECT" class="headerlink" title="åŠ¨ä½œREJECT"></a>åŠ¨ä½œREJECT</h3><p>REJECTåŠ¨ä½œçš„å¸¸ç”¨é€‰é¡¹ä¸ºâ€“reject-with</p>
<p>ä½¿ç”¨â€“reject-withé€‰é¡¹ï¼Œå¯ä»¥è®¾ç½®æç¤ºä¿¡æ¯ï¼Œå½“å¯¹æ–¹è¢«æ‹’ç»æ—¶ï¼Œä¼šæç¤ºå¯¹æ–¹ä¸ºä»€ä¹ˆè¢«æ‹’ç»ã€‚</p>
<p>å¯ç”¨å€¼å¦‚ä¸‹</p>
<ul>
<li><p>icmp-net-unreachable</p>
</li>
<li><p>icmp-host-unreachable</p>
</li>
<li><p>icmp-port-unreachable,</p>
</li>
<li><p>icmp-proto-unreachable</p>
</li>
<li><p>icmp-net-prohibited</p>
</li>
<li><p>icmp-host-pro-hibited</p>
</li>
<li><p>icmp-admin-prohibited</p>
</li>
</ul>
<p>å½“ä¸è®¾ç½®ä»»ä½•å€¼æ—¶ï¼Œé»˜è®¤å€¼ä¸ºicmp-port-unreachableã€‚</p>
<p>æˆ‘ä»¬æ¥åŠ¨æ‰‹å®è·µä¸€ä¸‹ï¼Œåœ¨ä¸»æœº139ä¸Šè®¾ç½®å¦‚ä¸‹è§„åˆ™ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå½“æ²¡æœ‰æ˜ç¡®è®¾ç½®â€“reject-withçš„å€¼æ—¶ï¼Œé»˜è®¤æç¤ºä¿¡æ¯ä¸ºicmp-port-unreachableï¼Œå³ç«¯å£ä¸å¯è¾¾ä¹‹æ„ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifak10004pwr75tri6w43/1.png" alt="iamge"></p>
<p>æ­¤æ—¶åœ¨å¦ä¸€å°ä¸»æœºä¸Šå‘ä¸»æœº139å‘èµ·pingè¯·æ±‚ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæç¤ºç›®æ ‡ç«¯å£ä¸å¯è¾¾ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifak10004pwr75tri6w43/2.png" alt="iamge"></p>
<p>é‚£ä¹ˆæˆ‘ä»¬å°†æ‹’ç»æŠ¥æ–‡çš„æç¤ºè®¾ç½®ä¸ºâ€ä¸»æœºä¸å¯è¾¾â€ï¼Œç¤ºä¾‹å¦‚ä¸‹</p>
<p><img src="/2022/06/13/uncatalog/cl4cifak10004pwr75tri6w43/3.png" alt="iamge"></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬åœ¨è®¾ç½®æ‹’ç»çš„åŠ¨ä½œæ—¶ï¼Œä½¿ç”¨äº†â€“reject-withé€‰é¡¹ï¼Œå°†æç¤ºä¿¡æ¯è®¾ç½®ä¸ºicmp-host-unreachableï¼Œå®Œæˆä¸Šè¿°æ“ä½œåï¼Œæˆ‘ä»¬å†æ¬¡åœ¨åœ¨å¦ä¸€å°ä¸»æœºä¸Šå‘ä¸»æœº139å‘èµ·pingè¯·æ±‚ã€‚</p>
<p>å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚<br><img src="/2022/06/13/uncatalog/cl4cifak10004pwr75tri6w43/4.png" alt="iamge"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œpingè¯·æ±‚è¢«æ‹’ç»æ—¶ï¼Œæç¤ºä¿¡æ¯å·²ç»ä»â€ç›®æ ‡ç«¯å£ä¸å¯è¾¾â€å˜æˆäº†â€ç›®æ ‡ä¸»æœºä¸å¯è¾¾â€ã€‚</p>
<h3 id="åŠ¨ä½œLOG"><a href="#åŠ¨ä½œLOG" class="headerlink" title="åŠ¨ä½œLOG"></a>åŠ¨ä½œLOG</h3><p>åœ¨æœ¬åšå®¢ä¸­ï¼Œå‰æ–‡å¹¶æ²¡æœ‰å¯¹LOGåŠ¨ä½œè¿›è¡Œç¤ºä¾‹ï¼Œæ­¤å¤„æˆ‘ä»¬æ¥äº†è§£ä¸€ä¸‹LOGåŠ¨ä½œã€‚</p>
<p>ä½¿ç”¨LOGåŠ¨ä½œï¼Œå¯ä»¥å°†ç¬¦åˆæ¡ä»¶çš„æŠ¥æ–‡çš„ç›¸å…³ä¿¡æ¯è®°å½•åˆ°æ—¥å¿—ä¸­ï¼Œä½†å½“å‰æŠ¥æ–‡å…·ä½“æ˜¯è¢«â€æ¥å—â€ï¼Œè¿˜æ˜¯è¢«â€æ‹’ç»â€ï¼Œéƒ½ç”±åé¢çš„è§„åˆ™æ§åˆ¶ï¼Œæ¢å¥è¯è¯´ï¼ŒLOGåŠ¨ä½œåªè´Ÿè´£è®°å½•åŒ¹é…åˆ°çš„æŠ¥æ–‡çš„ç›¸å…³ä¿¡æ¯ï¼Œä¸è´Ÿè´£å¯¹æŠ¥æ–‡çš„å…¶ä»–å¤„ç†ï¼Œå¦‚æœæƒ³è¦å¯¹æŠ¥æ–‡è¿›è¡Œè¿›ä¸€æ­¥çš„å¤„ç†ï¼Œå¯ä»¥åœ¨ä¹‹åè®¾ç½®å…·ä½“è§„åˆ™ï¼Œè¿›è¡Œè¿›ä¸€æ­¥çš„å¤„ç†ã€‚</p>
<p>ç¤ºä¾‹å¦‚ä¸‹ï¼Œä¸‹ä¾‹è¡¨ç¤ºå°†å‘å¾€22å·ç«¯å£çš„æŠ¥æ–‡ç›¸å…³ä¿¡æ¯è®°å½•åœ¨æ—¥å¿—ä¸­ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifak10004pwr75tri6w43/5.png" alt="iamge"></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œä¸Šè¿°è§„åˆ™è¡¨ç¤ºæ‰€æœ‰å‘å¾€22å·ç«¯å£çš„tcpæŠ¥æ–‡éƒ½ç¬¦åˆæ¡ä»¶ï¼Œæ‰€ä»¥éƒ½ä¼šè¢«è®°å½•åˆ°æ—¥å¿—ä¸­ï¼ŒæŸ¥çœ‹/var/log/messageså³å¯çœ‹åˆ°å¯¹åº”æŠ¥æ–‡çš„ç›¸å…³ä¿¡æ¯ï¼Œä½†æ˜¯ä¸Šè¿°è§„åˆ™åªæ˜¯ç”¨äºç¤ºä¾‹ï¼Œå› ä¸ºä¸Šä¾‹ä¸­ä½¿ç”¨çš„åŒ¹é…æ¡ä»¶è¿‡äºå®½æ³›ï¼Œæ‰€ä»¥åŒ¹é…åˆ°çš„æŠ¥æ–‡æ•°é‡å°†ä¼šéå¸¸ä¹‹å¤šï¼Œè®°å½•åˆ°çš„ä¿¡æ¯ä¹Ÿä¸åˆ©äºåˆ†æï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨LOGåŠ¨ä½œæ—¶ï¼ŒåŒ¹é…æ¡ä»¶åº”è¯¥å°½é‡å†™çš„ç²¾ç¡®ä¸€äº›ï¼ŒåŒ¹é…åˆ°çš„æŠ¥æ–‡æ•°é‡ä¹Ÿä¼šå¤§å¹…åº¦çš„å‡å°‘ï¼Œè¿™æ ·å†—ä½™çš„æ—¥å¿—ä¿¡æ¯å°±ä¼šå˜å°‘ï¼ŒåŒæ—¶æ—¥ååˆ†ææ—¥å¿—æ—¶ï¼Œæ—¥å¿—ä¸­çš„ä¿¡æ¯å¯ç”¨ç¨‹åº¦æ›´é«˜ã€‚</p>
<p>æ³¨ï¼šè¯·æŠŠåˆšæ‰ç”¨äºç¤ºä¾‹çš„è§„åˆ™åˆ é™¤ã€‚</p>
<p>ä»åˆšæ‰çš„ç¤ºä¾‹ä¸­æˆ‘ä»¬å·²ç»äº†è§£åˆ°ï¼ŒLOGåŠ¨ä½œä¼šå°†æŠ¥æ–‡çš„ç›¸å…³ä¿¡æ¯è®°å½•åœ¨/var/log/messageæ–‡ä»¶ä¸­ï¼Œå½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å°†ç›¸å…³ä¿¡æ¯è®°å½•åœ¨æŒ‡å®šçš„æ–‡ä»¶ä¸­ï¼Œä»¥é˜²æ­¢iptablesçš„ç›¸å…³ä¿¡æ¯ä¸å…¶ä»–æ—¥å¿—ä¿¡æ¯ç›¸æ··æ·†ï¼Œä¿®æ”¹/etc/rsyslog.confæ–‡ä»¶ï¼ˆæˆ–è€…/etc/syslog.confï¼‰ï¼Œåœ¨rsyslogé…ç½®æ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹é…ç½®å³å¯ã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">vim /etc/rsyslog.conf</span></span><br><span class="line"></span><br><span class="line">kern.warning /var/log/iptables.log</span><br></pre></td></tr></table></figure></div>

<p>åŠ å…¥ä¸Šè¿°é…ç½®åï¼ŒæŠ¥æ–‡çš„ç›¸å…³ä¿¡æ¯å°†ä¼šè¢«è®°å½•åˆ°/var/log/iptables.logæ–‡ä»¶ä¸­ã€‚</p>
<p>å®Œæˆä¸Šè¿°é…ç½®åï¼Œé‡å¯rsyslogæœåŠ¡ï¼ˆæˆ–è€…syslogdï¼‰</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">service rsyslog restart</span></span><br></pre></td></tr></table></figure></div>

<p>æœåŠ¡é‡å¯åï¼Œé…ç½®å³å¯ç”Ÿæ•ˆï¼ŒåŒ¹é…åˆ°çš„æŠ¥æ–‡çš„ç›¸å…³ä¿¡æ¯å°†è¢«è®°å½•åˆ°æŒ‡å®šçš„æ–‡ä»¶ä¸­ã€‚</p>
<p>LOGåŠ¨ä½œä¹Ÿæœ‰è‡ªå·±çš„é€‰é¡¹ï¼Œå¸¸ç”¨é€‰é¡¹å¦‚ä¸‹ï¼ˆå…ˆåˆ—å‡ºæ¦‚å¿µï¼Œåé¢æœ‰ç¤ºä¾‹ï¼‰</p>
<ul>
<li><p>â€“log-levelé€‰é¡¹å¯ä»¥æŒ‡å®šè®°å½•æ—¥å¿—çš„æ—¥å¿—çº§åˆ«ï¼Œå¯ç”¨çº§åˆ«æœ‰emergï¼Œalertï¼Œcritï¼Œerrorï¼Œwarningï¼Œnoticeï¼Œinfoï¼Œdebugã€‚</p>
</li>
<li><p>â€“log-prefixé€‰é¡¹å¯ä»¥ç»™è®°å½•åˆ°çš„ç›¸å…³ä¿¡æ¯æ·»åŠ â€æ ‡ç­¾â€ä¹‹ç±»çš„ä¿¡æ¯ï¼Œä»¥ä¾¿åŒºåˆ†å„ç§è®°å½•åˆ°çš„æŠ¥æ–‡ä¿¡æ¯ï¼Œæ–¹ä¾¿åœ¨åˆ†ææ—¶è¿›è¡Œè¿‡æ»¤ã€‚</p>
</li>
</ul>
<p>æ³¨ï¼šâ€“log-prefixå¯¹åº”çš„å€¼ä¸èƒ½è¶…è¿‡29ä¸ªå­—ç¬¦ã€‚</p>
<p>æ¯”å¦‚ï¼Œæˆ‘æƒ³è¦å°†ä¸»åŠ¨è¿æ¥22å·ç«¯å£çš„æŠ¥æ–‡çš„ç›¸å…³ä¿¡æ¯éƒ½è®°å½•åˆ°æ—¥å¿—ä¸­ï¼Œå¹¶ä¸”æŠŠè¿™ç±»è®°å½•å‘½åä¸ºâ€want-in-from-port-22â€³,åˆ™å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤</p>
<p><img src="/2022/06/13/uncatalog/cl4cifak10004pwr75tri6w43/6.png" alt="iamge"></p>
<p>å®Œæˆä¸Šè¿°é…ç½®åï¼Œæˆ‘åœ¨IPåœ°å€ä¸º192.168.1.98çš„å®¢æˆ·ç«¯æœºä¸Šï¼Œå°è¯•ä½¿ç”¨sshå·¥å…·è¿æ¥ä¸Šä¾‹ä¸­çš„ä¸»æœºï¼Œç„¶åæŸ¥çœ‹å¯¹åº”çš„æ—¥å¿—æ–‡ä»¶ï¼ˆå·²ç»å°†æ—¥å¿—æ–‡ä»¶è®¾ç½®ä¸º/var/log/iptables.logï¼‰</p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œsshè¿æ¥æ“ä½œçš„æŠ¥æ–‡çš„ç›¸å…³ä¿¡æ¯å·²ç»è¢«è®°å½•åˆ°äº†iptables.logæ—¥å¿—æ–‡ä»¶ä¸­ï¼Œè€Œä¸”è¿™æ¡æ—¥å¿—ä¸­åŒ…å«â€æ ‡ç­¾â€ï¼šwant-in-from-port-22ï¼Œå¦‚æœæœ‰å¾ˆå¤šæ—¥å¿—è®°å½•ï¼Œæˆ‘ä»¬å°±èƒ½é€šè¿‡è¿™ä¸ªâ€æ ‡ç­¾â€è¿›è¡Œç­›é€‰äº†ï¼Œè¿™æ ·æ–¹ä¾¿æˆ‘ä»¬æŸ¥çœ‹æ—¥å¿—ï¼ŒåŒæ—¶ï¼Œä»ä¸Šè¿°è®°å½•ä¸­è¿˜èƒ½å¤Ÿå¾—çŸ¥æŠ¥æ–‡çš„æºIPä¸ç›®æ ‡IPï¼Œæºç«¯å£ä¸ç›®æ ‡ç«¯å£ç­‰ä¿¡æ¯ï¼Œä»ä¸Šè¿°æ—¥å¿—æˆ‘ä»¬èƒ½å¤Ÿçœ‹å‡ºï¼Œ192.168.1.98è¿™ä¸ªIPæƒ³è¦åœ¨14ç‚¹11åˆ†è¿æ¥åˆ°192.168.1.139ï¼ˆå½“å‰ä¸»æœºçš„IPï¼‰çš„22å·ç«¯å£ï¼ŒæŠ¥æ–‡ç”±eth4ç½‘å¡è¿›å…¥ï¼Œeth4ç½‘å¡çš„MACåœ°å€ä¸º00:0C:29:B7:F4:D1ï¼Œå®¢æˆ·ç«¯ç½‘å¡çš„macåœ°å€ä¸ºF4-8E-38-82-B1-29ã€‚</p>
<p>é™¤äº†ACCEPTã€DROPã€REJECTã€LOGç­‰åŠ¨ä½œï¼Œè¿˜æœ‰ä¸€äº›å…¶ä»–çš„å¸¸ç”¨åŠ¨ä½œï¼Œæ¯”å¦‚DNATã€SNATç­‰ï¼Œæˆ‘ä»¬ä¼šåœ¨ä¹‹åçš„æ–‡ç« ä¸­å¯¹å®ƒä»¬è¿›è¡Œæ€»ç»“ã€‚</p>
]]></content>
      <tags>
        <tag>äº‘åŸç”ŸåŸºç¡€ç³»åˆ—</tag>
        <tag>Kubernetesç½‘ç»œ</tag>
      </tags>
  </entry>
  <entry>
    <title>Kubernetesç½‘ç»œç³»åˆ—ä¹‹(äºŒåä¸€)iptablesæ¦‚å¿µ</title>
    <url>/2022/06/13/uncatalog/cl4cifak60008pwr77vkbd1sn/</url>
    <content><![CDATA[<hr>
<span id="more"></span>



<hr>
<blockquote>
<p>è¿™ç¯‡æ–‡ç« ä¼šå°½é‡ä»¥é€šä¿—æ˜“æ‡‚çš„æ–¹å¼æè¿°iptablesçš„ç›¸å…³æ¦‚å¿µï¼Œè¯·è€å¿ƒçš„è¯»å®Œå®ƒ</p>
</blockquote>
<h3 id="é˜²ç«å¢™ç›¸å…³æ¦‚å¿µ"><a href="#é˜²ç«å¢™ç›¸å…³æ¦‚å¿µ" class="headerlink" title="é˜²ç«å¢™ç›¸å…³æ¦‚å¿µ"></a>é˜²ç«å¢™ç›¸å…³æ¦‚å¿µ</h3><p>æ­¤å¤„å…ˆæè¿°ä¸€äº›ç›¸å…³æ¦‚å¿µã€‚</p>
<p>ä»é€»è¾‘ä¸Šè®²ã€‚é˜²ç«å¢™å¯ä»¥å¤§ä½“åˆ†ä¸ºä¸»æœºé˜²ç«å¢™å’Œç½‘ç»œé˜²ç«å¢™ã€‚</p>
<p>ä¸»æœºé˜²ç«å¢™ï¼šé’ˆå¯¹äºå•ä¸ªä¸»æœºè¿›è¡Œé˜²æŠ¤ã€‚</p>
<p>ç½‘ç»œé˜²ç«å¢™ï¼šå¾€å¾€å¤„äºç½‘ç»œå…¥å£æˆ–è¾¹ç¼˜ï¼Œé’ˆå¯¹äºç½‘ç»œå…¥å£è¿›è¡Œé˜²æŠ¤ï¼ŒæœåŠ¡äºé˜²ç«å¢™èƒŒåçš„æœ¬åœ°å±€åŸŸç½‘ã€‚</p>
<p>ç½‘ç»œé˜²ç«å¢™å’Œä¸»æœºé˜²ç«å¢™å¹¶ä¸å†²çªï¼Œå¯ä»¥ç†è§£ä¸ºï¼Œç½‘ç»œé˜²ç«å¢™ä¸»å¤–ï¼ˆé›†ä½“ï¼‰ï¼Œ ä¸»æœºé˜²ç«å¢™ä¸»å†…ï¼ˆä¸ªäººï¼‰ã€‚</p>
<p>ä»ç‰©ç†ä¸Šè®²ï¼Œé˜²ç«å¢™å¯ä»¥åˆ†ä¸ºç¡¬ä»¶é˜²ç«å¢™å’Œè½¯ä»¶é˜²ç«å¢™ã€‚</p>
<p>ç¡¬ä»¶é˜²ç«å¢™ï¼šåœ¨ç¡¬ä»¶çº§åˆ«å®ç°éƒ¨åˆ†é˜²ç«å¢™åŠŸèƒ½ï¼Œå¦ä¸€éƒ¨åˆ†åŠŸèƒ½åŸºäºè½¯ä»¶å®ç°ï¼Œæ€§èƒ½é«˜ï¼Œæˆæœ¬é«˜ã€‚</p>
<p>è½¯ä»¶é˜²ç«å¢™ï¼šåº”ç”¨è½¯ä»¶å¤„ç†é€»è¾‘è¿è¡Œäºé€šç”¨ç¡¬ä»¶å¹³å°ä¹‹ä¸Šçš„é˜²ç«å¢™ï¼Œæ€§èƒ½ä½ï¼Œæˆæœ¬ä½ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifak60008pwr77vkbd1sn/1.png" alt="image"></p>
<p>é‚£ä¹ˆåœ¨æ­¤å¤„ï¼Œæˆ‘ä»¬å°±æ¥èŠèŠLinuxçš„iptables</p>
<p>iptableså…¶å®ä¸æ˜¯çœŸæ­£çš„é˜²ç«å¢™ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒç†è§£æˆä¸€ä¸ªå®¢æˆ·ç«¯ä»£ç†ï¼Œç”¨æˆ·é€šè¿‡iptablesè¿™ä¸ªä»£ç†ï¼Œå°†ç”¨æˆ·çš„å®‰å…¨è®¾å®šæ‰§è¡Œåˆ°å¯¹åº”çš„â€å®‰å…¨æ¡†æ¶â€ä¸­ï¼Œè¿™ä¸ªâ€å®‰å…¨æ¡†æ¶â€æ‰æ˜¯çœŸæ­£çš„é˜²ç«å¢™ï¼Œè¿™ä¸ªæ¡†æ¶çš„åå­—å«netfilter</p>
<p>netfilteræ‰æ˜¯é˜²ç«å¢™çœŸæ­£çš„å®‰å…¨æ¡†æ¶ï¼ˆframeworkï¼‰ï¼Œnetfilterä½äºå†…æ ¸ç©ºé—´ã€‚</p>
<p>iptableså…¶å®æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œä½äºç”¨æˆ·ç©ºé—´ï¼Œæˆ‘ä»¬ç”¨è¿™ä¸ªå·¥å…·æ“ä½œçœŸæ­£çš„æ¡†æ¶ã€‚</p>
<p>netfilter/iptablesï¼ˆä¸‹æ–‡ä¸­ç®€ç§°ä¸ºiptablesï¼‰ç»„æˆLinuxå¹³å°ä¸‹çš„åŒ…è¿‡æ»¤é˜²ç«å¢™ï¼Œä¸å¤§å¤šæ•°çš„Linuxè½¯ä»¶ä¸€æ ·ï¼Œè¿™ä¸ªåŒ…è¿‡æ»¤é˜²ç«å¢™æ˜¯å…è´¹çš„ï¼Œå®ƒå¯ä»¥ä»£æ›¿æ˜‚è´µçš„å•†ä¸šé˜²ç«å¢™è§£å†³æ–¹æ¡ˆï¼Œå®Œæˆå°åŒ…è¿‡æ»¤ã€å°åŒ…é‡å®šå‘å’Œç½‘ç»œåœ°å€è½¬æ¢ï¼ˆNATï¼‰ç­‰åŠŸèƒ½ã€‚</p>
<p>Netfilteræ˜¯Linuxæ“ä½œç³»ç»Ÿæ ¸å¿ƒå±‚å†…éƒ¨çš„ä¸€ä¸ªæ•°æ®åŒ…å¤„ç†æ¨¡å—ï¼Œå®ƒå…·æœ‰å¦‚ä¸‹åŠŸèƒ½ï¼š</p>
<p>ç½‘ç»œåœ°å€è½¬æ¢(Network Address Translate)</p>
<p>æ•°æ®åŒ…å†…å®¹ä¿®æ”¹</p>
<p>ä»¥åŠæ•°æ®åŒ…è¿‡æ»¤çš„é˜²ç«å¢™åŠŸèƒ½</p>
<p>æ‰€ä»¥è¯´ï¼Œè™½ç„¶æˆ‘ä»¬ä½¿ç”¨service iptables startå¯åŠ¨iptablesâ€æœåŠ¡â€ï¼Œä½†æ˜¯å…¶å®å‡†ç¡®çš„æ¥è¯´ï¼Œiptableså¹¶æ²¡æœ‰ä¸€ä¸ªå®ˆæŠ¤è¿›ç¨‹ï¼Œæ‰€ä»¥å¹¶ä¸èƒ½ç®—æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„æœåŠ¡ï¼Œè€Œåº”è¯¥ç®—æ˜¯å†…æ ¸æä¾›çš„åŠŸèƒ½ã€‚</p>
<h3 id="iptablesåŸºç¡€"><a href="#iptablesåŸºç¡€" class="headerlink" title="iptablesåŸºç¡€"></a>iptablesåŸºç¡€</h3><p>æˆ‘ä»¬çŸ¥é“iptablesæ˜¯æŒ‰ç…§è§„åˆ™æ¥åŠäº‹çš„ï¼Œæˆ‘ä»¬å°±æ¥è¯´è¯´è§„åˆ™ï¼ˆrulesï¼‰ï¼Œè§„åˆ™å…¶å®å°±æ˜¯ç½‘ç»œç®¡ç†å‘˜é¢„å®šä¹‰çš„æ¡ä»¶ï¼Œè§„åˆ™ä¸€èˆ¬çš„å®šä¹‰ä¸ºâ€å¦‚æœæ•°æ®åŒ…å¤´ç¬¦åˆè¿™æ ·çš„æ¡ä»¶ï¼Œå°±è¿™æ ·å¤„ç†è¿™ä¸ªæ•°æ®åŒ…â€ã€‚è§„åˆ™å­˜å‚¨åœ¨å†…æ ¸ç©ºé—´çš„ä¿¡æ¯åŒ…è¿‡æ»¤è¡¨ä¸­ï¼Œè¿™äº›è§„åˆ™åˆ†åˆ«æŒ‡å®šäº†æºåœ°å€ã€ç›®çš„åœ°å€ã€ä¼ è¾“åè®®ï¼ˆå¦‚TCPã€UDPã€ICMPï¼‰å’ŒæœåŠ¡ç±»å‹ï¼ˆå¦‚HTTPã€FTPå’ŒSMTPï¼‰ç­‰ã€‚å½“æ•°æ®åŒ…ä¸è§„åˆ™åŒ¹é…æ—¶ï¼Œiptableså°±æ ¹æ®è§„åˆ™æ‰€å®šä¹‰çš„æ–¹æ³•æ¥å¤„ç†è¿™äº›æ•°æ®åŒ…ï¼Œå¦‚æ”¾è¡Œï¼ˆacceptï¼‰ã€æ‹’ç»ï¼ˆrejectï¼‰å’Œä¸¢å¼ƒï¼ˆdropï¼‰ç­‰ã€‚é…ç½®é˜²ç«å¢™çš„ä¸»è¦å·¥ä½œå°±æ˜¯æ·»åŠ ã€ä¿®æ”¹å’Œåˆ é™¤è¿™äº›è§„åˆ™ã€‚</p>
<p>è¿™æ ·è¯´å¯èƒ½å¹¶ä¸å®¹æ˜“ç†è§£ï¼Œæˆ‘ä»¬æ¥æ¢ä¸ªå®¹æ˜“ç†è§£çš„è§’åº¦ï¼Œä»å¤´è¯´èµ·.</p>
<p>å½“å®¢æˆ·ç«¯è®¿é—®æœåŠ¡å™¨çš„webæœåŠ¡æ—¶ï¼Œå®¢æˆ·ç«¯å‘é€æŠ¥æ–‡åˆ°ç½‘å¡ï¼Œè€Œtcp/ipåè®®æ ˆæ˜¯å±äºå†…æ ¸çš„ä¸€éƒ¨åˆ†ï¼Œæ‰€ä»¥ï¼Œå®¢æˆ·ç«¯çš„ä¿¡æ¯ä¼šé€šè¿‡å†…æ ¸çš„TCPåè®®ä¼ è¾“åˆ°ç”¨æˆ·ç©ºé—´ä¸­çš„webæœåŠ¡ä¸­ï¼Œè€Œæ­¤æ—¶ï¼Œå®¢æˆ·ç«¯æŠ¥æ–‡çš„ç›®æ ‡ç»ˆç‚¹ä¸ºwebæœåŠ¡æ‰€ç›‘å¬çš„å¥—æ¥å­—ï¼ˆIPï¼šPortï¼‰ä¸Šï¼Œå½“webæœåŠ¡éœ€è¦å“åº”å®¢æˆ·ç«¯è¯·æ±‚æ—¶ï¼ŒwebæœåŠ¡å‘å‡ºçš„å“åº”æŠ¥æ–‡çš„ç›®æ ‡ç»ˆç‚¹åˆ™ä¸ºå®¢æˆ·ç«¯ï¼Œè¿™ä¸ªæ—¶å€™ï¼ŒwebæœåŠ¡æ‰€ç›‘å¬çš„IPä¸ç«¯å£åè€Œå˜æˆäº†åŸç‚¹ï¼Œæˆ‘ä»¬è¯´è¿‡ï¼Œnetfilteræ‰æ˜¯çœŸæ­£çš„é˜²ç«å¢™ï¼Œå®ƒæ˜¯å†…æ ¸çš„ä¸€éƒ¨åˆ†ï¼Œæ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦é˜²ç«å¢™èƒ½å¤Ÿè¾¾åˆ°â€é˜²ç«â€çš„ç›®çš„ï¼Œåˆ™éœ€è¦åœ¨å†…æ ¸ä¸­è®¾ç½®å…³å¡ï¼Œæ‰€æœ‰è¿›å‡ºçš„æŠ¥æ–‡éƒ½è¦é€šè¿‡è¿™äº›å…³å¡ï¼Œç»è¿‡æ£€æŸ¥åï¼Œç¬¦åˆæ”¾è¡Œæ¡ä»¶çš„æ‰èƒ½æ”¾è¡Œï¼Œç¬¦åˆé˜»æ‹¦æ¡ä»¶çš„åˆ™éœ€è¦è¢«é˜»æ­¢ï¼Œäºæ˜¯ï¼Œå°±å‡ºç°äº†inputå…³å¡å’Œoutputå…³å¡ï¼Œè€Œè¿™äº›å…³å¡åœ¨iptablesä¸­ä¸è¢«ç§°ä¸ºâ€å…³å¡â€,è€Œè¢«ç§°ä¸ºâ€é“¾â€ã€‚<br><img src="/2022/06/13/uncatalog/cl4cifak60008pwr77vkbd1sn/2.png" alt="image"></p>
<p>å…¶å®æˆ‘ä»¬ä¸Šé¢æè¿°çš„åœºæ™¯å¹¶ä¸å®Œå–„ï¼Œå› ä¸ºå®¢æˆ·ç«¯å‘æ¥çš„æŠ¥æ–‡è®¿é—®çš„ç›®æ ‡åœ°å€å¯èƒ½å¹¶ä¸æ˜¯æœ¬æœºï¼Œè€Œæ˜¯å…¶ä»–æœåŠ¡å™¨ï¼Œå½“æœ¬æœºçš„å†…æ ¸æ”¯æŒIP_FORWARDæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥å°†æŠ¥æ–‡è½¬å‘ç»™å…¶ä»–æœåŠ¡å™¨ï¼Œæ‰€ä»¥ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±ä¼šæåˆ°iptablesä¸­çš„å…¶ä»–â€å…³å¡â€ï¼Œä¹Ÿå°±æ˜¯å…¶ä»–â€é“¾â€ï¼Œä»–ä»¬å°±æ˜¯  â€œè·¯ç”±å‰â€ã€â€è½¬å‘â€ã€â€è·¯ç”±åâ€ï¼Œä»–ä»¬çš„è‹±æ–‡åæ˜¯</p>
<p>PREROUTINGã€FORWARDã€POSTROUTING</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æˆ‘ä»¬å¯ç”¨äº†é˜²ç«å¢™åŠŸèƒ½æ—¶ï¼ŒæŠ¥æ–‡éœ€è¦ç»è¿‡å¦‚ä¸‹å…³å¡ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ ¹æ®å®é™…æƒ…å†µçš„ä¸åŒï¼ŒæŠ¥æ–‡ç»è¿‡â€é“¾â€å¯èƒ½ä¸åŒã€‚å¦‚æœæŠ¥æ–‡éœ€è¦è½¬å‘ï¼Œé‚£ä¹ˆæŠ¥æ–‡åˆ™ä¸ä¼šç»è¿‡inputé“¾å‘å¾€ç”¨æˆ·ç©ºé—´ï¼Œè€Œæ˜¯ç›´æ¥åœ¨å†…æ ¸ç©ºé—´ä¸­ç»è¿‡forwardé“¾å’Œpostroutingé“¾è½¬å‘å‡ºå»çš„ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifak60008pwr77vkbd1sn/3.png" alt="image"></p>
<p>æ‰€ä»¥ï¼Œæ ¹æ®ä¸Šå›¾ï¼Œæˆ‘ä»¬èƒ½å¤Ÿæƒ³è±¡å‡ºæŸäº›å¸¸ç”¨åœºæ™¯ä¸­ï¼ŒæŠ¥æ–‡çš„æµå‘ï¼š</p>
<p>åˆ°æœ¬æœºæŸè¿›ç¨‹çš„æŠ¥æ–‡ï¼šPREROUTING â€“&gt; INPUT</p>
<p>ç”±æœ¬æœºè½¬å‘çš„æŠ¥æ–‡ï¼šPREROUTING â€“&gt; FORWARD â€“&gt; POSTROUTING</p>
<p>ç”±æœ¬æœºçš„æŸè¿›ç¨‹å‘å‡ºæŠ¥æ–‡ï¼ˆé€šå¸¸ä¸ºå“åº”æŠ¥æ–‡ï¼‰ï¼šOUTPUT â€“&gt; POSTROUTING</p>
<h3 id="é“¾çš„æ¦‚å¿µ"><a href="#é“¾çš„æ¦‚å¿µ" class="headerlink" title="é“¾çš„æ¦‚å¿µ"></a>é“¾çš„æ¦‚å¿µ</h3><p>ç°åœ¨ï¼Œæˆ‘ä»¬æƒ³è±¡ä¸€ä¸‹ï¼Œè¿™äº›â€å…³å¡â€åœ¨iptablesä¸­ä¸ºä»€ä¹ˆè¢«ç§°ä½œâ€é“¾â€å‘¢ï¼Ÿæˆ‘ä»¬çŸ¥é“ï¼Œé˜²ç«å¢™çš„ä½œç”¨å°±åœ¨äºå¯¹ç»è¿‡çš„æŠ¥æ–‡åŒ¹é…â€è§„åˆ™â€ï¼Œç„¶åæ‰§è¡Œå¯¹åº”çš„â€åŠ¨ä½œâ€,æ‰€ä»¥ï¼Œå½“æŠ¥æ–‡ç»è¿‡è¿™äº›å…³å¡çš„æ—¶å€™ï¼Œåˆ™å¿…é¡»åŒ¹é…è¿™ä¸ªå…³å¡ä¸Šçš„è§„åˆ™ï¼Œä½†æ˜¯ï¼Œè¿™ä¸ªå…³å¡ä¸Šå¯èƒ½ä¸æ­¢æœ‰ä¸€æ¡è§„åˆ™ï¼Œè€Œæ˜¯æœ‰å¾ˆå¤šæ¡è§„åˆ™ï¼Œå½“æˆ‘ä»¬æŠŠè¿™äº›è§„åˆ™ä¸²åˆ°ä¸€ä¸ªé“¾æ¡ä¸Šçš„æ—¶å€™ï¼Œå°±å½¢æˆäº†â€é“¾â€,æ‰€ä»¥ï¼Œæˆ‘ä»¬æŠŠæ¯ä¸€ä¸ªâ€å…³å¡â€æƒ³è±¡æˆå¦‚ä¸‹å›¾ä¸­çš„æ¨¡æ ·  ï¼Œè¿™æ ·æ¥è¯´ï¼ŒæŠŠä»–ä»¬ç§°ä¸ºâ€é“¾â€æ›´ä¸ºåˆé€‚ï¼Œæ¯ä¸ªç»è¿‡è¿™ä¸ªâ€å…³å¡â€çš„æŠ¥æ–‡ï¼Œéƒ½è¦å°†è¿™æ¡â€é“¾â€ä¸Šçš„æ‰€æœ‰è§„åˆ™åŒ¹é…ä¸€éï¼Œå¦‚æœæœ‰ç¬¦åˆæ¡ä»¶çš„è§„åˆ™ï¼Œåˆ™æ‰§è¡Œè§„åˆ™å¯¹åº”çš„åŠ¨ä½œã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifak60008pwr77vkbd1sn/4.png" alt="image"></p>
<h3 id="è¡¨çš„æ¦‚å¿µ"><a href="#è¡¨çš„æ¦‚å¿µ" class="headerlink" title="è¡¨çš„æ¦‚å¿µ"></a>è¡¨çš„æ¦‚å¿µ</h3><p>æˆ‘ä»¬å†æƒ³æƒ³å¦å¤–ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯¹æ¯ä¸ªâ€é“¾â€ä¸Šéƒ½æ”¾ç½®äº†ä¸€ä¸²è§„åˆ™ï¼Œä½†æ˜¯è¿™äº›è§„åˆ™æœ‰äº›å¾ˆç›¸ä¼¼ï¼Œæ¯”å¦‚ï¼ŒAç±»è§„åˆ™éƒ½æ˜¯å¯¹IPæˆ–è€…ç«¯å£çš„è¿‡æ»¤ï¼ŒBç±»è§„åˆ™æ˜¯ä¿®æ”¹æŠ¥æ–‡ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬æ˜¯ä¸æ˜¯èƒ½æŠŠå®ç°ç›¸åŒåŠŸèƒ½çš„è§„åˆ™æ”¾åœ¨ä¸€èµ·å‘¢ï¼Œå¿…é¡»èƒ½çš„ã€‚</p>
<p>æˆ‘ä»¬æŠŠå…·æœ‰ç›¸åŒåŠŸèƒ½çš„è§„åˆ™çš„é›†åˆå«åšâ€è¡¨â€ï¼Œæ‰€ä»¥è¯´ï¼Œä¸åŒåŠŸèƒ½çš„è§„åˆ™ï¼Œæˆ‘ä»¬å¯ä»¥æ”¾ç½®åœ¨ä¸åŒçš„è¡¨ä¸­è¿›è¡Œç®¡ç†ï¼Œè€Œiptableså·²ç»ä¸ºæˆ‘ä»¬å®šä¹‰äº†4ç§è¡¨ï¼Œæ¯ç§è¡¨å¯¹åº”äº†ä¸åŒçš„åŠŸèƒ½ï¼Œè€Œæˆ‘ä»¬å®šä¹‰çš„è§„åˆ™ä¹Ÿéƒ½é€ƒè„±ä¸äº†è¿™4ç§åŠŸèƒ½çš„èŒƒå›´ï¼Œæ‰€ä»¥ï¼Œå­¦ä¹ iptablesä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»å…ˆææ˜ç™½æ¯ç§è¡¨ çš„ä½œç”¨ã€‚</p>
<p>iptablesä¸ºæˆ‘ä»¬æä¾›äº†å¦‚ä¸‹è§„åˆ™çš„åˆ†ç±»ï¼Œæˆ–è€…è¯´ï¼Œiptablesä¸ºæˆ‘ä»¬æä¾›äº†å¦‚ä¸‹â€è¡¨â€</p>
<p>filterè¡¨ï¼šè´Ÿè´£è¿‡æ»¤åŠŸèƒ½ï¼Œé˜²ç«å¢™ï¼›å†…æ ¸æ¨¡å—ï¼šiptables_filter</p>
<p>natè¡¨ï¼šnetwork address translationï¼Œç½‘ç»œåœ°å€è½¬æ¢åŠŸèƒ½ï¼›å†…æ ¸æ¨¡å—ï¼šiptable_nat</p>
<p>mangleè¡¨ï¼šæ‹†è§£æŠ¥æ–‡ï¼Œåšå‡ºä¿®æ”¹ï¼Œå¹¶é‡æ–°å°è£… çš„åŠŸèƒ½ï¼›iptable_mangle</p>
<p>rawè¡¨ï¼šå…³é—­natè¡¨ä¸Šå¯ç”¨çš„è¿æ¥è¿½è¸ªæœºåˆ¶ï¼›iptable_raw</p>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬è‡ªå®šä¹‰çš„æ‰€æœ‰è§„åˆ™ï¼Œéƒ½æ˜¯è¿™å››ç§åˆ†ç±»ä¸­çš„è§„åˆ™ï¼Œæˆ–è€…è¯´ï¼Œæ‰€æœ‰è§„åˆ™éƒ½å­˜åœ¨äºè¿™4å¼ â€è¡¨â€ä¸­ã€‚</p>
<h3 id="è¡¨é“¾å…³ç³»"><a href="#è¡¨é“¾å…³ç³»" class="headerlink" title="è¡¨é“¾å…³ç³»"></a>è¡¨é“¾å…³ç³»</h3><p>ä½†æ˜¯æˆ‘ä»¬éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒæŸäº›â€é“¾â€ä¸­æ³¨å®šä¸ä¼šåŒ…å«â€æŸç±»è§„åˆ™â€ï¼Œå°±åƒæŸäº›â€å…³å¡â€å¤©ç”Ÿå°±ä¸å…·å¤‡æŸäº›åŠŸèƒ½ä¸€æ ·ï¼Œæ¯”å¦‚ï¼ŒAâ€å…³å¡â€åªè´Ÿè´£æ‰“å‡»é™†åœ°æ•Œäººï¼Œæ²¡æœ‰é˜²ç©ºèƒ½åŠ›ï¼ŒBâ€å…³å¡â€åªè´Ÿè´£æ‰“å‡»ç©ºä¸­æ•Œäººï¼Œæ²¡æœ‰é˜²å¾¡æ­¥å…µçš„èƒ½åŠ›ï¼ŒCâ€å…³å¡â€å¯èƒ½æ¯”è¾ƒNBï¼Œæ—¢èƒ½é˜²ç©ºï¼Œä¹Ÿèƒ½é˜²å¾¡é™†åœ°æ•Œäººï¼ŒDâ€å…³å¡â€æœ€å±Œï¼Œæµ·é™†ç©ºéƒ½èƒ½é˜²ã€‚</p>
<p>é‚£è®©æˆ‘ä»¬æ¥çœ‹çœ‹ï¼Œæ¯ä¸ªâ€å…³å¡â€éƒ½æœ‰å“ªäº›èƒ½åŠ›ï¼Œæˆ–è€…è¯´ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹æ¯ä¸ªâ€é“¾â€ä¸Šçš„è§„åˆ™éƒ½å­˜åœ¨äºå“ªäº›â€è¡¨â€ä¸­ã€‚</p>
<p>æˆ‘ä»¬è¿˜æ˜¯ä»¥å›¾ä¸ºä¾‹ï¼Œå…ˆçœ‹çœ‹preroutingâ€é“¾â€ä¸Šçš„è§„åˆ™éƒ½å­˜åœ¨äºå“ªäº›è¡¨ä¸­ã€‚</p>
<p>æ³¨æ„ï¼šä¸‹å›¾åªç”¨äºè¯´æ˜preroutingé“¾ä¸Šçš„è§„åˆ™å­˜åœ¨äºå“ªäº›è¡¨ä¸­ï¼Œå¹¶æ²¡æœ‰æè¿°è¡¨çš„é¡ºåºã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifak60008pwr77vkbd1sn/5.png" alt="image"></p>
<p>è¿™å¹…å›¾æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿå®ƒçš„æ„æ€æ˜¯è¯´ï¼Œpreroutingâ€é“¾â€åªæ‹¥æœ‰natè¡¨ã€rawè¡¨å’Œmangleè¡¨æ‰€å¯¹åº”çš„åŠŸèƒ½ï¼Œæ‰€ä»¥ï¼Œpreroutingä¸­çš„è§„åˆ™åªèƒ½å­˜æ”¾äºnatè¡¨ã€rawè¡¨å’Œmangleè¡¨ä¸­ã€‚</p>
<p>é‚£ä¹ˆï¼Œæ ¹æ®ä¸Šè¿°æ€è·¯ï¼Œæˆ‘ä»¬æ¥æ€»ç»“ä¸€ä¸‹ï¼Œæ¯ä¸ªâ€å…³å¡â€éƒ½æ‹¥æœ‰ä»€ä¹ˆåŠŸèƒ½ï¼Œ</p>
<p>æˆ–è€…è¯´ï¼Œæ¯ä¸ªâ€é“¾â€ä¸­çš„è§„åˆ™éƒ½å­˜åœ¨äºå“ªäº›â€è¡¨â€ä¸­ã€‚</p>
<p>PREROUTING      çš„è§„åˆ™å¯ä»¥å­˜åœ¨äºï¼šrawè¡¨ï¼Œmangleè¡¨ï¼Œnatè¡¨ã€‚</p>
<p>INPUT          çš„è§„åˆ™å¯ä»¥å­˜åœ¨äºï¼šmangleè¡¨ï¼Œfilterè¡¨ï¼Œï¼ˆcentos7ä¸­è¿˜æœ‰natè¡¨ï¼Œcentos6ä¸­æ²¡æœ‰ï¼‰ã€‚</p>
<p>FORWARD         çš„è§„åˆ™å¯ä»¥å­˜åœ¨äºï¼šmangleè¡¨ï¼Œfilterè¡¨ã€‚</p>
<p>OUTPUT         çš„è§„åˆ™å¯ä»¥å­˜åœ¨äºï¼šrawè¡¨mangleè¡¨ï¼Œnatè¡¨ï¼Œfilterè¡¨ã€‚</p>
<p>POSTROUTING      çš„è§„åˆ™å¯ä»¥å­˜åœ¨äºï¼šmangleè¡¨ï¼Œnatè¡¨ã€‚</p>
<p>ä½†æ˜¯ï¼Œæˆ‘ä»¬åœ¨å®é™…çš„ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œå¾€å¾€æ˜¯é€šè¿‡â€è¡¨â€ä½œä¸ºæ“ä½œå…¥å£ï¼Œå¯¹è§„åˆ™è¿›è¡Œå®šä¹‰çš„ï¼Œä¹‹æ‰€ä»¥æŒ‰ç…§ä¸Šè¿°è¿‡ç¨‹ä»‹ç»iptablesï¼Œæ˜¯å› ä¸ºä»â€å…³å¡â€çš„è§’åº¦æ›´å®¹æ˜“ä»å…¥é—¨çš„è§’åº¦ç†è§£ï¼Œä½†æ˜¯ä¸ºäº†ä»¥ä¾¿åœ¨å®é™…ä½¿ç”¨çš„æ—¶å€™ï¼Œæ›´åŠ é¡ºç•…çš„ç†è§£å®ƒä»¬ï¼Œæ­¤å¤„æˆ‘ä»¬è¿˜è¦å°†å„â€è¡¨â€ä¸â€é“¾â€çš„å…³ç³»ç½—åˆ—å‡ºæ¥ï¼Œ</p>
<p>è¡¨ï¼ˆåŠŸèƒ½ï¼‰&lt;â€“&gt;   é“¾ï¼ˆé’©å­ï¼‰ï¼š</p>
<p>raw     è¡¨ä¸­çš„è§„åˆ™å¯ä»¥è¢«å“ªäº›é“¾ä½¿ç”¨ï¼šPREROUTINGï¼ŒOUTPUT</p>
<p>mangle  è¡¨ä¸­çš„è§„åˆ™å¯ä»¥è¢«å“ªäº›é“¾ä½¿ç”¨ï¼šPREROUTINGï¼ŒINPUTï¼ŒFORWARDï¼ŒOUTPUTï¼ŒPOSTROUTING</p>
<p>nat     è¡¨ä¸­çš„è§„åˆ™å¯ä»¥è¢«å“ªäº›é“¾ä½¿ç”¨ï¼šPREROUTINGï¼ŒOUTPUTï¼ŒPOSTROUTINGï¼ˆcentos7ä¸­è¿˜æœ‰INPUTï¼Œcentos6ä¸­æ²¡æœ‰ï¼‰</p>
<p>filter  è¡¨ä¸­çš„è§„åˆ™å¯ä»¥è¢«å“ªäº›é“¾ä½¿ç”¨ï¼šINPUTï¼ŒFORWARDï¼ŒOUTPUT</p>
<p>å…¶å®æˆ‘ä»¬è¿˜éœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œå› ä¸ºæ•°æ®åŒ…ç»è¿‡ä¸€ä¸ªâ€é“¾â€çš„æ—¶å€™ï¼Œä¼šå°†å½“å‰é“¾çš„æ‰€æœ‰è§„åˆ™éƒ½åŒ¹é…ä¸€éï¼Œä½†æ˜¯åŒ¹é…æ—¶æ€»å½’è¦æœ‰é¡ºåºï¼Œæˆ‘ä»¬åº”è¯¥ä¸€æ¡ä¸€æ¡çš„å»åŒ¹é…ï¼Œè€Œä¸”æˆ‘ä»¬è¯´è¿‡ï¼Œç›¸åŒåŠŸèƒ½ç±»å‹çš„è§„åˆ™ä¼šæ±‡èšåœ¨ä¸€å¼ â€è¡¨â€ä¸­ï¼Œé‚£ä¹ˆï¼Œå“ªäº›â€è¡¨â€ä¸­çš„è§„åˆ™ä¼šæ”¾åœ¨â€é“¾â€çš„æœ€å‰é¢æ‰§è¡Œå‘¢ï¼Œè¿™æ—¶å€™å°±éœ€è¦æœ‰ä¸€ä¸ªä¼˜å…ˆçº§çš„é—®é¢˜ï¼Œæˆ‘ä»¬è¿˜æ‹¿preroutingâ€é“¾â€åšå›¾ç¤ºã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifak60008pwr77vkbd1sn/6.png" alt="image"></p>
<p>preroutingé“¾ä¸­çš„è§„åˆ™å­˜æ”¾äºä¸‰å¼ è¡¨ä¸­ï¼Œè€Œè¿™ä¸‰å¼ è¡¨ä¸­çš„è§„åˆ™æ‰§è¡Œçš„ä¼˜å…ˆçº§å¦‚ä¸‹ï¼š</p>
<p>raw â€“&gt; mangle â€“&gt; nat</p>
<p>ä½†æ˜¯æˆ‘ä»¬çŸ¥é“ï¼Œiptablesä¸ºæˆ‘ä»¬å®šä¹‰äº†4å¼ â€è¡¨â€,å½“ä»–ä»¬å¤„äºåŒä¸€æ¡â€é“¾â€æ—¶ï¼Œæ‰§è¡Œçš„ä¼˜å…ˆçº§å¦‚ä¸‹ã€‚</p>
<p>ä¼˜å…ˆçº§æ¬¡åºï¼ˆç”±é«˜è€Œä½ï¼‰ï¼š</p>
<p>raw â€“&gt; mangle â€“&gt; nat â€“&gt; filter</p>
<p>ä½†æ˜¯æˆ‘ä»¬å‰é¢è¯´è¿‡ï¼ŒæŸäº›é“¾å¤©ç”Ÿå°±ä¸èƒ½ä½¿ç”¨æŸäº›è¡¨ä¸­çš„è§„åˆ™ï¼Œæ‰€ä»¥ï¼Œ4å¼ è¡¨ä¸­çš„è§„åˆ™å¤„äºåŒä¸€æ¡é“¾çš„ç›®å‰åªæœ‰outputé“¾ï¼Œå®ƒå°±æ˜¯ä¼ è¯´ä¸­æµ·é™†ç©ºéƒ½èƒ½é˜²å®ˆçš„å…³å¡ã€‚</p>
<p>ä¸ºäº†æ›´æ–¹ä¾¿çš„ç®¡ç†ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åœ¨æŸä¸ªè¡¨é‡Œé¢åˆ›å»ºè‡ªå®šä¹‰é“¾ï¼Œå°†é’ˆå¯¹æŸä¸ªåº”ç”¨ç¨‹åºæ‰€è®¾ç½®çš„è§„åˆ™æ”¾ç½®åœ¨è¿™ä¸ªè‡ªå®šä¹‰é“¾ä¸­ï¼Œä½†æ˜¯è‡ªå®šä¹‰é“¾æ¥ä¸èƒ½ç›´æ¥ä½¿ç”¨ï¼Œåªèƒ½è¢«æŸä¸ªé»˜è®¤çš„é“¾å½“åšåŠ¨ä½œå»è°ƒç”¨æ‰èƒ½èµ·ä½œç”¨ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·æƒ³è±¡ï¼Œè‡ªå®šä¹‰é“¾å°±æ˜¯ä¸€æ®µæ¯”è¾ƒâ€çŸ­â€çš„é“¾å­ï¼Œè¿™æ¡â€çŸ­â€é“¾å­ä¸Šçš„è§„åˆ™éƒ½æ˜¯é’ˆå¯¹æŸä¸ªåº”ç”¨ç¨‹åºåˆ¶å®šçš„ï¼Œä½†æ˜¯è¿™æ¡çŸ­çš„é“¾å­å¹¶ä¸èƒ½ç›´æ¥ä½¿ç”¨ï¼Œè€Œæ˜¯éœ€è¦â€ç„Šæ¥â€åœ¨iptablesé»˜è®¤å®šä¹‰é“¾å­ä¸Šï¼Œæ‰èƒ½è¢«IPtablesä½¿ç”¨ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆé»˜è®¤å®šä¹‰çš„â€é“¾â€éœ€è¦æŠŠâ€è‡ªå®šä¹‰é“¾â€å½“åšâ€åŠ¨ä½œâ€å»å¼•ç”¨çš„åŸå› ã€‚è¿™æ˜¯åè¯ï¼Œåé¢å†èŠï¼Œåœ¨å®é™…ä½¿ç”¨æ—¶æˆ‘ä»¬å³å¯æ›´åŠ çš„æ˜ç™½ã€‚</p>
<h3 id="æ•°æ®ç»è¿‡é˜²ç«å¢™çš„æµç¨‹"><a href="#æ•°æ®ç»è¿‡é˜²ç«å¢™çš„æµç¨‹" class="headerlink" title="æ•°æ®ç»è¿‡é˜²ç«å¢™çš„æµç¨‹"></a>æ•°æ®ç»è¿‡é˜²ç«å¢™çš„æµç¨‹</h3><p>ç»“åˆä¸Šè¿°æ‰€æœ‰çš„æè¿°ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ•°æ®åŒ…é€šè¿‡é˜²ç«å¢™çš„æµç¨‹æ€»ç»“ä¸ºä¸‹å›¾ï¼š</p>
<p><img src="/2022/06/13/uncatalog/cl4cifak60008pwr77vkbd1sn/7.png" alt="image"></p>
<p>æˆ‘ä»¬åœ¨å†™Iptablesè§„åˆ™çš„æ—¶å€™ï¼Œè¦æ—¶åˆ»ç‰¢è®°è¿™å¼ è·¯ç”±æ¬¡åºå›¾ï¼Œçµæ´»é…ç½®è§„åˆ™ã€‚</p>
<p>æˆ‘ä»¬å°†ç»å¸¸ç”¨åˆ°çš„å¯¹åº”å…³ç³»é‡æ–°å†™åœ¨æ­¤å¤„ï¼Œæ–¹ä¾¿å¯¹åº”å›¾ä¾‹æŸ¥çœ‹ã€‚</p>
<p>é“¾çš„è§„åˆ™å­˜æ”¾äºå“ªäº›è¡¨ä¸­ï¼ˆä»é“¾åˆ°è¡¨çš„å¯¹åº”å…³ç³»ï¼‰ï¼š</p>
<p>PREROUTING   çš„è§„åˆ™å¯ä»¥å­˜åœ¨äºï¼šrawè¡¨ï¼Œmangleè¡¨ï¼Œnatè¡¨ã€‚</p>
<p>INPUT        çš„è§„åˆ™å¯ä»¥å­˜åœ¨äºï¼šmangleè¡¨ï¼Œfilterè¡¨ï¼Œï¼ˆcentos7ä¸­è¿˜æœ‰natè¡¨ï¼Œcentos6ä¸­æ²¡æœ‰ï¼‰ã€‚</p>
<p>FORWARD      çš„è§„åˆ™å¯ä»¥å­˜åœ¨äºï¼šmangleè¡¨ï¼Œfilterè¡¨ã€‚</p>
<p>OUTPUT       çš„è§„åˆ™å¯ä»¥å­˜åœ¨äºï¼šrawè¡¨mangleè¡¨ï¼Œnatè¡¨ï¼Œfilterè¡¨ã€‚</p>
<p>POSTROUTING  çš„è§„åˆ™å¯ä»¥å­˜åœ¨äºï¼šmangleè¡¨ï¼Œnatè¡¨ã€‚</p>
<p>è¡¨ä¸­çš„è§„åˆ™å¯ä»¥è¢«å“ªäº›é“¾ä½¿ç”¨ï¼ˆä»è¡¨åˆ°é“¾çš„å¯¹åº”å…³ç³»ï¼‰ï¼š</p>
<p>raw     è¡¨ä¸­çš„è§„åˆ™å¯ä»¥è¢«å“ªäº›é“¾ä½¿ç”¨ï¼šPREROUTINGï¼ŒOUTPUT</p>
<p>mangle  è¡¨ä¸­çš„è§„åˆ™å¯ä»¥è¢«å“ªäº›é“¾ä½¿ç”¨ï¼šPREROUTINGï¼ŒINPUTï¼ŒFORWARDï¼ŒOUTPUTï¼ŒPOSTROUTING</p>
<p>nat     è¡¨ä¸­çš„è§„åˆ™å¯ä»¥è¢«å“ªäº›é“¾ä½¿ç”¨ï¼šPREROUTINGï¼ŒOUTPUTï¼ŒPOSTROUTINGï¼ˆcentos7ä¸­è¿˜æœ‰INPUTï¼Œcentos6ä¸­æ²¡æœ‰ï¼‰</p>
<p>filter  è¡¨ä¸­çš„è§„åˆ™å¯ä»¥è¢«å“ªäº›é“¾ä½¿ç”¨ï¼šINPUTï¼ŒFORWARDï¼ŒOUTPUT</p>
<p>ä¸‹å›¾ä¸­natè¡¨åœ¨centos7ä¸­çš„æƒ…å†µå°±ä¸å†æ ‡æ˜ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifak60008pwr77vkbd1sn/8.png" alt="image"></p>
<h3 id="è§„åˆ™çš„æ¦‚å¿µ"><a href="#è§„åˆ™çš„æ¦‚å¿µ" class="headerlink" title="è§„åˆ™çš„æ¦‚å¿µ"></a>è§„åˆ™çš„æ¦‚å¿µ</h3><p>è¯´äº†ä¸€åœˆåˆè¯´å›æ¥äº†ï¼Œåœ¨ä¸Šè¿°æè¿°ä¸­æˆ‘ä»¬ä¸€ç›´åœ¨æè§„åˆ™ï¼Œå¯æ˜¯æ²¡æœ‰ç»†è¯´ï¼Œç°åœ¨è¯´è¯´å®ƒã€‚</p>
<p>å…ˆè¯´è¯´è§„åˆ™çš„æ¦‚å¿µï¼Œç„¶åå†é€šä¿—çš„è§£é‡Šå®ƒã€‚</p>
<p>è§„åˆ™ï¼šæ ¹æ®æŒ‡å®šçš„åŒ¹é…æ¡ä»¶æ¥å°è¯•åŒ¹é…æ¯ä¸ªæµç»æ­¤å¤„çš„æŠ¥æ–‡ï¼Œä¸€æ—¦åŒ¹é…æˆåŠŸï¼Œåˆ™ç”±è§„åˆ™åé¢æŒ‡å®šçš„å¤„ç†åŠ¨ä½œè¿›è¡Œå¤„ç†ï¼›</p>
<p>é‚£ä¹ˆæˆ‘ä»¬æ¥é€šä¿—çš„è§£é‡Šä¸€ä¸‹ä»€ä¹ˆæ˜¯iptablesçš„è§„åˆ™ï¼Œä¹‹å‰æ‰“è¿‡ä¸€ä¸ªæ¯”æ–¹ï¼Œæ¯æ¡â€é“¾â€éƒ½æ˜¯ä¸€ä¸ªâ€å…³å¡â€ï¼Œæ¯ä¸ªé€šè¿‡è¿™ä¸ªâ€å…³å¡â€çš„æŠ¥æ–‡éƒ½è¦åŒ¹é…è¿™ä¸ªå…³å¡ä¸Šçš„è§„åˆ™ï¼Œå¦‚æœåŒ¹é…ï¼Œåˆ™å¯¹æŠ¥æ–‡è¿›è¡Œå¯¹åº”çš„å¤„ç†ï¼Œæ¯”å¦‚è¯´ï¼Œä½ æˆ‘äºŒäººæ­¤åˆ»å°±å¥½åƒä¸¤ä¸ªâ€æŠ¥æ–‡â€ï¼Œä½ æˆ‘äºŒäººæ­¤åˆ»éƒ½è¦å…¥å…³ï¼Œå¯æ˜¯åŸä¸»æœ‰å‘½ï¼Œåªæœ‰å™¨å®‡è½©æ˜‚çš„äººæ‰èƒ½å…¥å…³ï¼Œä¸ç¬¦åˆæ­¤æ¡ä»¶çš„äººä¸èƒ½å…¥å…³ï¼Œäºæ˜¯å®ˆå…³å°†å£«æŒ‰ç…§åŸä¸»åˆ¶å®šçš„â€è§„åˆ™â€ï¼Œå¼€å§‹æ‰“é‡ä½ æˆ‘äºŒäººï¼Œæœ€ç»ˆï¼Œä½ é¡ºåˆ©å…¥å…³äº†ï¼Œè€Œæˆ‘å·²è¢«æ‹’ä¹‹é—¨å¤–ï¼Œå› ä¸ºä½ ç¬¦åˆâ€å™¨å®‡è½©æ˜‚â€çš„æ ‡å‡†ï¼Œæ‰€ä»¥æŠŠä½ â€æ”¾è¡Œâ€äº†ï¼Œè€Œæˆ‘ä¸ç¬¦åˆæ ‡å‡†ï¼Œæ‰€ä»¥æ²¡æœ‰è¢«æ”¾è¡Œï¼Œå…¶å®ï¼Œâ€å™¨å®‡è½©æ˜‚â€å°±æ˜¯ä¸€ç§â€åŒ¹é…æ¡ä»¶â€ï¼Œâ€æ”¾è¡Œâ€å°±æ˜¯ä¸€ç§â€åŠ¨ä½œâ€ï¼Œâ€åŒ¹é…æ¡ä»¶â€ä¸â€åŠ¨ä½œâ€ç»„æˆäº†è§„åˆ™ã€‚</p>
<p>äº†è§£äº†è§„åˆ™çš„æ¦‚å¿µï¼Œé‚£æˆ‘ä»¬æ¥èŠèŠè§„åˆ™çš„ç»„æˆéƒ¨åˆ†,æ­¤å¤„åªæ˜¯å¤§æ¦‚çš„å°†è§„åˆ™çš„ç»“æ„åˆ—å‡ºï¼Œåé¢çš„æ–‡ç« ä¸­ä¼šå•ç‹¬å¯¹è§„åˆ™è¿›è¡Œæ€»ç»“ã€‚</p>
<p>è§„åˆ™ç”±åŒ¹é…æ¡ä»¶å’Œå¤„ç†åŠ¨ä½œç»„æˆã€‚</p>
<h4 id="åŒ¹é…æ¡ä»¶"><a href="#åŒ¹é…æ¡ä»¶" class="headerlink" title="åŒ¹é…æ¡ä»¶"></a>åŒ¹é…æ¡ä»¶</h4><p>åŒ¹é…æ¡ä»¶åˆ†ä¸ºåŸºæœ¬åŒ¹é…æ¡ä»¶ä¸æ‰©å±•åŒ¹é…æ¡ä»¶</p>
<h4 id="åŸºæœ¬åŒ¹é…æ¡ä»¶ï¼š"><a href="#åŸºæœ¬åŒ¹é…æ¡ä»¶ï¼š" class="headerlink" title="åŸºæœ¬åŒ¹é…æ¡ä»¶ï¼š"></a>åŸºæœ¬åŒ¹é…æ¡ä»¶ï¼š</h4><p>æºåœ°å€Source IPï¼Œç›®æ ‡åœ°å€ Destination IP</p>
<p>ä¸Šè¿°å†…å®¹éƒ½å¯ä»¥ä½œä¸ºåŸºæœ¬åŒ¹é…æ¡ä»¶ã€‚</p>
<h4 id="æ‰©å±•åŒ¹é…æ¡ä»¶ï¼š"><a href="#æ‰©å±•åŒ¹é…æ¡ä»¶ï¼š" class="headerlink" title="æ‰©å±•åŒ¹é…æ¡ä»¶ï¼š"></a>æ‰©å±•åŒ¹é…æ¡ä»¶ï¼š</h4><p>é™¤äº†ä¸Šè¿°çš„æ¡ä»¶å¯ä»¥ç”¨äºåŒ¹é…ï¼Œè¿˜æœ‰å¾ˆå¤šå…¶ä»–çš„æ¡ä»¶å¯ä»¥ç”¨äºåŒ¹é…ï¼Œè¿™äº›æ¡ä»¶æ³›ç§°ä¸ºæ‰©å±•æ¡ä»¶ï¼Œè¿™äº›æ‰©å±•æ¡ä»¶å…¶å®ä¹Ÿæ˜¯netfilterä¸­çš„ä¸€éƒ¨åˆ†ï¼Œåªæ˜¯ä»¥æ¨¡å—çš„å½¢å¼å­˜åœ¨ï¼Œå¦‚æœæƒ³è¦ä½¿ç”¨è¿™äº›æ¡ä»¶ï¼Œåˆ™éœ€è¦ä¾èµ–å¯¹åº”çš„æ‰©å±•æ¨¡å—ã€‚</p>
<p>æºç«¯å£Source Port, ç›®æ ‡ç«¯å£Destination Port</p>
<p>ä¸Šè¿°å†…å®¹éƒ½å¯ä»¥ä½œä¸ºæ‰©å±•åŒ¹é…æ¡ä»¶</p>
<h4 id="å¤„ç†åŠ¨ä½œ"><a href="#å¤„ç†åŠ¨ä½œ" class="headerlink" title="å¤„ç†åŠ¨ä½œ"></a>å¤„ç†åŠ¨ä½œ</h4><p>å¤„ç†åŠ¨ä½œåœ¨iptablesä¸­è¢«ç§°ä¸ºtargetï¼ˆè¿™æ ·è¯´å¹¶ä¸å‡†ç¡®ï¼Œæˆ‘ä»¬æš‚ä¸”è¿™æ ·ç§°å‘¼ï¼‰ï¼ŒåŠ¨ä½œä¹Ÿå¯ä»¥åˆ†ä¸ºåŸºæœ¬åŠ¨ä½œå’Œæ‰©å±•åŠ¨ä½œã€‚</p>
<p>æ­¤å¤„åˆ—å‡ºä¸€äº›å¸¸ç”¨çš„åŠ¨ä½œï¼Œä¹‹åçš„æ–‡ç« ä¼šå¯¹å®ƒä»¬è¿›è¡Œè¯¦ç»†çš„ç¤ºä¾‹ä¸æ€»ç»“ï¼š</p>
<ul>
<li><p>ACCEPTï¼šå…è®¸æ•°æ®åŒ…é€šè¿‡ã€‚</p>
</li>
<li><p>DROPï¼šç›´æ¥ä¸¢å¼ƒæ•°æ®åŒ…ï¼Œä¸ç»™ä»»ä½•å›åº”ä¿¡æ¯ï¼Œè¿™æ—¶å€™å®¢æˆ·ç«¯ä¼šæ„Ÿè§‰è‡ªå·±çš„è¯·æ±‚æ³¥ç‰›å…¥æµ·äº†ï¼Œè¿‡äº†è¶…æ—¶æ—¶é—´æ‰ä¼šæœ‰ååº”ã€‚</p>
</li>
<li><p>REJECTï¼šæ‹’ç»æ•°æ®åŒ…é€šè¿‡ï¼Œå¿…è¦æ—¶ä¼šç»™æ•°æ®å‘é€ç«¯ä¸€ä¸ªå“åº”çš„ä¿¡æ¯ï¼Œå®¢æˆ·ç«¯åˆšè¯·æ±‚å°±ä¼šæ”¶åˆ°æ‹’ç»çš„ä¿¡æ¯ã€‚</p>
</li>
<li><p>SNATï¼šæºåœ°å€è½¬æ¢ï¼Œè§£å†³å†…ç½‘ç”¨æˆ·ç”¨åŒä¸€ä¸ªå…¬ç½‘åœ°å€ä¸Šç½‘çš„é—®é¢˜ã€‚</p>
</li>
<li><p>MASQUERADEï¼šæ˜¯SNATçš„ä¸€ç§ç‰¹æ®Šå½¢å¼ï¼Œé€‚ç”¨äºåŠ¨æ€çš„ã€ä¸´æ—¶ä¼šå˜çš„ipä¸Šã€‚</p>
</li>
<li><p>DNATï¼šç›®æ ‡åœ°å€è½¬æ¢ã€‚</p>
</li>
<li><p>REDIRECTï¼šåœ¨æœ¬æœºåšç«¯å£æ˜ å°„ã€‚</p>
</li>
<li><p>LOGï¼šåœ¨/var/log/messagesæ–‡ä»¶ä¸­è®°å½•æ—¥å¿—ä¿¡æ¯ï¼Œç„¶åå°†æ•°æ®åŒ…ä¼ é€’ç»™ä¸‹ä¸€æ¡è§„åˆ™ï¼Œä¹Ÿå°±æ˜¯è¯´é™¤äº†è®°å½•ä»¥å¤–ä¸å¯¹æ•°æ®åŒ…åšä»»ä½•å…¶ä»–æ“ä½œï¼Œä»ç„¶è®©ä¸‹ä¸€æ¡è§„åˆ™å»åŒ¹é…ã€‚</p>
</li>
</ul>
]]></content>
      <tags>
        <tag>äº‘åŸç”ŸåŸºç¡€ç³»åˆ—</tag>
        <tag>Kubernetesç½‘ç»œ</tag>
      </tags>
  </entry>
  <entry>
    <title>Kubernetesç½‘ç»œç³»åˆ—ä¹‹(äºŒåä¸ƒ)iptablesæ‰©å±•ä¹‹udpæ‰©å±•ä¸icmpæ‰©å±•</title>
    <url>/2022/06/13/uncatalog/cl4cifak7000apwr7hgyg2fgs/</url>
    <content><![CDATA[<hr>
<span id="more"></span>

<hr>
<p>å‰æ–‡ä¸­æ€»ç»“äº†iptablesçš„tcpæ‰©å±•æ¨¡å—ï¼Œæ­¤å¤„ï¼Œæˆ‘ä»¬æ¥æ€»ç»“ä¸€ä¸‹å¦å¤–ä¸¤ä¸ªè·Ÿåè®®æœ‰å…³çš„å¸¸ç”¨çš„æ‰©å±•æ¨¡å—ï¼Œudpæ‰©å±•ä¸icmpæ‰©å±•ã€‚</p>
<h3 id="udpæ‰©å±•"><a href="#udpæ‰©å±•" class="headerlink" title="udpæ‰©å±•"></a>udpæ‰©å±•</h3><p>æˆ‘ä»¬å…ˆæ¥è¯´è¯´udpæ‰©å±•æ¨¡å—ï¼Œè¿™ä¸ªæ‰©å±•æ¨¡å—ä¸­èƒ½ç”¨çš„åŒ¹é…æ¡ä»¶æ¯”è¾ƒå°‘ï¼Œåªæœ‰ä¸¤ä¸ªï¼Œå°±æ˜¯â€“sportä¸â€“dportï¼Œå³åŒ¹é…æŠ¥æ–‡çš„æºç«¯å£ä¸ç›®æ ‡ç«¯å£ã€‚</p>
<p>æ²¡é”™ï¼Œtcpæ¨¡å—ä¸­ä¹Ÿæœ‰è¿™ä¸¤ä¸ªé€‰é¡¹ï¼Œåç§°éƒ½ä¸€æ¨¡ä¸€æ ·ã€‚</p>
<p>åªä¸è¿‡udpæ‰©å±•æ¨¡å—çš„â€“sportä¸â€“dportæ˜¯ç”¨äºåŒ¹é…UDPåè®®æŠ¥æ–‡çš„æºç«¯å£ä¸ç›®æ ‡ç«¯å£ï¼Œæ¯”å¦‚ï¼Œæ”¾è¡ŒsambaæœåŠ¡çš„137ä¸138è¿™ä¸¤ä¸ªUDPç«¯å£ï¼Œç¤ºä¾‹å¦‚ä¸‹</p>
<p><img src="/2022/06/13/uncatalog/cl4cifak7000apwr7hgyg2fgs/1.png" alt="image"></p>
<p>å‰æ–‡è¯´æ˜è¿‡ï¼Œå½“ä½¿ç”¨æ‰©å±•åŒ¹é…æ¡ä»¶æ—¶ï¼Œå¦‚æœæœªæŒ‡å®šæ‰©å±•æ¨¡å—ï¼Œiptablesä¼šé»˜è®¤è°ƒç”¨ä¸â€-pâ€å¯¹åº”çš„åè®®åç§°ç›¸åŒçš„æ¨¡å—ï¼Œæ‰€ä»¥ï¼Œå½“ä½¿ç”¨â€-p udpâ€æ—¶ï¼Œå¯ä»¥çœç•¥â€-m udpâ€ï¼Œç¤ºä¾‹å¦‚ä¸‹ã€‚</p>
<p>udpæ‰©å±•ä¸­çš„â€“sportä¸â€“dportåŒæ ·æ”¯æŒæŒ‡å®šä¸€ä¸ªè¿ç»­çš„ç«¯å£èŒƒå›´ï¼Œç¤ºä¾‹å¦‚ä¸‹</p>
<p><img src="/2022/06/13/uncatalog/cl4cifak7000apwr7hgyg2fgs/2.png" alt="image"></p>
<p>ä¸Šå›¾ä¸­çš„é…ç½®è¡¨ç¤º137åˆ°157ä¹‹é—´çš„æ‰€æœ‰udpç«¯å£å…¨éƒ¨å¯¹å¤–å¼€æ”¾ï¼Œå…¶å®ä¸tcpæ‰©å±•ä¸­çš„ä½¿ç”¨æ–¹æ³•ç›¸åŒã€‚<br><img src="/2022/06/13/uncatalog/cl4cifak7000apwr7hgyg2fgs/3.png" alt="image"><br>ä½†æ˜¯udpä¸­çš„â€“sportä¸â€“dportä¹Ÿåªèƒ½æŒ‡å®šè¿ç»­çš„ç«¯å£èŒƒå›´ï¼Œå¹¶ä¸èƒ½ä¸€æ¬¡æ€§æŒ‡å®šå¤šä¸ªç¦»æ•£çš„ç«¯å£ï¼Œæ²¡é”™ï¼Œèªæ˜å¦‚ä½ ä¸€å®šæƒ³åˆ°ï¼Œä½¿ç”¨ä¹‹å‰æ€»ç»“è¿‡çš„multiportæ‰©å±•æ¨¡å—ï¼Œå³å¯æŒ‡å®šå¤šä¸ªç¦»æ•£çš„UDPç«¯å£ï¼Œå¦‚æœä½ å¿˜äº†multiportæ¨¡å—æ€æ ·ä½¿ç”¨ï¼Œè¯·å›é¡¾å‰æ–‡ã€‚</p>
<p>æ€»ä¹‹æœ‰äº†å‰æ–‡çš„åŸºç¡€ï¼Œå†ç†è§£ä¸Šè¿°ç¤ºä¾‹å°±å®¹æ˜“å¤šäº†ï¼Œæ­¤å¤„ä¸å†å¯¹udpæ¨¡å—çš„â€“sportä¸â€“dportè¿›è¡Œèµ˜è¿°ã€‚</p>
<h3 id="icmpæ‰©å±•"><a href="#icmpæ‰©å±•" class="headerlink" title="icmpæ‰©å±•"></a>icmpæ‰©å±•</h3><p>æœ€å¸¸ç”¨çš„tcpæ‰©å±•ã€udpæ‰©å±•å·²ç»æ€»ç»“å®Œæ¯•ï¼Œç°åœ¨èŠèŠicmpæ‰©å±•ï¼Œæ²¡é”™ï¼Œçœ‹åˆ°icmpï¼Œä½ è‚¯å®šå°±æƒ³åˆ°äº†pingå‘½ä»¤ï¼Œå› ä¸ºpingå‘½ä»¤ä½¿ç”¨çš„å°±æ˜¯icmpåè®®ã€‚</p>
<p>ICMPåè®®çš„å…¨ç§°ä¸ºInternet Control Message Protocolï¼Œç¿»è¯‘ä¸ºäº’è”ç½‘æ§åˆ¶æŠ¥æ–‡åè®®ï¼Œå®ƒä¸»è¦ç”¨äºæ¢æµ‹ç½‘ç»œä¸Šçš„ä¸»æœºæ˜¯å¦å¯ç”¨ï¼Œç›®æ ‡æ˜¯å¦å¯è¾¾ï¼Œç½‘ç»œæ˜¯å¦é€šç•…ï¼Œè·¯ç”±æ˜¯å¦å¯ç”¨ç­‰ã€‚</p>
<p>æˆ‘ä»¬å¹³å¸¸ä½¿ç”¨pingå‘½ä»¤pingæŸä¸»æœºæ—¶ï¼Œå¦‚æœä¸»æœºå¯è¾¾ï¼Œå¯¹åº”ä¸»æœºä¼šå¯¹æˆ‘ä»¬çš„pingè¯·æ±‚åšå‡ºå›åº”ï¼ˆæ­¤å¤„ä¸è€ƒè™‘ç¦pingç­‰æƒ…å†µï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å‘å‡ºpingè¯·æ±‚ï¼Œå¯¹æ–¹å›åº”pingè¯·æ±‚ï¼Œè™½ç„¶pingè¯·æ±‚æŠ¥æ–‡ä¸pingå›åº”æŠ¥æ–‡éƒ½å±äºICMPç±»å‹çš„æŠ¥æ–‡ï¼Œä½†æ˜¯å¦‚æœåœ¨æ¦‚å¿µä¸Šç»†åˆ†çš„è¯ï¼Œå®ƒä»¬æ‰€å±çš„ç±»å‹è¿˜æ˜¯ä¸åŒçš„ï¼Œæˆ‘ä»¬å‘å‡ºçš„pingè¯·æ±‚å±äºç±»å‹8çš„icmpæŠ¥æ–‡ï¼Œè€Œå¯¹æ–¹ä¸»æœºçš„pingå›åº”æŠ¥æ–‡åˆ™å±äºç±»å‹0çš„icmpæŠ¥æ–‡ï¼Œæ ¹æ®åº”ç”¨åœºæ™¯çš„ä¸åŒï¼ŒicmpæŠ¥æ–‡è¢«ç»†åˆ†ä¸ºå¦‚ä¸‹å„ç§ç±»å‹ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifak7000apwr7hgyg2fgs/4.png" alt="image"></p>
<p>ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œæ‰€æœ‰è¡¨ç¤ºâ€ç›®æ ‡ä¸å¯è¾¾â€çš„icmpæŠ¥æ–‡çš„typeç ä¸º3ï¼Œè€Œâ€ç›®æ ‡ä¸å¯è¾¾â€åˆå¯ä»¥ç»†åˆ†ä¸ºå¤šç§æƒ…å†µï¼Œæ˜¯ç½‘ç»œä¸å¯è¾¾å‘¢ï¼Ÿè¿˜æ˜¯ä¸»æœºä¸å¯è¾¾å‘¢ï¼Ÿå†æˆ–è€…æ˜¯ç«¯å£ä¸å¯è¾¾å‘¢ï¼Ÿæ‰€ä»¥ï¼Œä¸ºäº†æ›´åŠ ç»†åŒ–çš„åŒºåˆ†å®ƒä»¬ï¼Œicmpå¯¹æ¯ç§typeåˆç»†åˆ†äº†å¯¹åº”çš„codeï¼Œç”¨ä¸åŒçš„codeå¯¹åº”å…·ä½“çš„åœºæ™¯ï¼Œ  æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨type/codeå»åŒ¹é…å…·ä½“ç±»å‹çš„ICMPæŠ¥æ–‡ï¼Œæ¯”å¦‚å¯ä»¥ä½¿ç”¨â€3/1â€³è¡¨ç¤ºä¸»æœºä¸å¯è¾¾çš„icmpæŠ¥æ–‡ã€‚</p>
<p>ä¸Šå›¾ä¸­çš„ç¬¬ä¸€è¡Œå°±è¡¨ç¤ºpingå›åº”æŠ¥æ–‡ï¼Œå®ƒçš„typeä¸º0ï¼Œcodeä¹Ÿä¸º0ï¼Œä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œpingå›åº”æŠ¥æ–‡å±äºæŸ¥è¯¢ç±»ï¼ˆqueryï¼‰çš„ICMPæŠ¥æ–‡ï¼Œä»å¤§ç±»ä¸Šåˆ†ï¼ŒICMPæŠ¥æ–‡è¿˜èƒ½åˆ†ä¸ºæŸ¥è¯¢ç±»ä¸é”™è¯¯ç±»ä¸¤å¤§ç±»ï¼Œç›®æ ‡ä¸å¯è¾¾ç±»çš„icmpæŠ¥æ–‡åˆ™å±äºé”™è¯¯ç±»æŠ¥æ–‡ã€‚</p>
<p>è€Œæˆ‘ä»¬å‘å‡ºçš„pingè¯·æ±‚æŠ¥æ–‡å¯¹åº”çš„typeä¸º8ï¼Œcodeä¸º0ã€‚</p>
<p>äº†è§£å®Œä¸Šè¿°æ¦‚å¿µï¼Œå°±å¥½åŠäº†ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€äº›åº”ç”¨åœºæ™¯ã€‚</p>
<p>å‡è®¾ï¼Œæˆ‘ä»¬ç°åœ¨æƒ³è¦ç¦æ­¢æ‰€æœ‰icmpç±»å‹çš„æŠ¥æ–‡è¿›å…¥æœ¬æœºï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è¿›è¡Œå¦‚ä¸‹è®¾ç½®ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifak7000apwr7hgyg2fgs/5.png" alt="image"><br>ä¸Šä¾‹ä¸­ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰ä½¿ç”¨ä»»ä½•æ‰©å±•åŒ¹é…æ¡ä»¶ï¼Œæˆ‘ä»¬åªæ˜¯ä½¿ç”¨â€-p icmpâ€åŒ¹é…äº†æ‰€æœ‰icmpåè®®ç±»å‹çš„æŠ¥æ–‡ã€‚</p>
<p>å¦‚æœè¿›è¡Œäº†ä¸Šè¿°è®¾ç½®ï¼Œåˆ«çš„ä¸»æœºå‘æˆ‘ä»¬å‘é€çš„pingè¯·æ±‚æŠ¥æ–‡æ— æ³•è¿›å…¥é˜²ç«å¢™ï¼Œæˆ‘ä»¬å‘åˆ«äººå‘é€çš„pingè¯·æ±‚å¯¹åº”çš„å›åº”æŠ¥æ–‡ä¹Ÿæ— æ³•è¿›å…¥é˜²ç«å¢™ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬æ—¢æ— æ³•pingé€šåˆ«äººï¼Œåˆ«äººä¹Ÿæ— æ³•pingé€šæˆ‘ä»¬ã€‚</p>
<p>å‡è®¾ï¼Œæ­¤åˆ»éœ€æ±‚æœ‰å˜ï¼Œæˆ‘ä»¬åªæƒ³è¦pingé€šåˆ«äººï¼Œä½†æ˜¯ä¸æƒ³è®©åˆ«äººpingé€šæˆ‘ä»¬ï¼Œåˆšæ‰çš„é…ç½®å°±ä¸èƒ½æ»¡è¶³æˆ‘ä»¬äº†ï¼Œæˆ‘ä»¬åˆ™å¯ä»¥è¿›è¡Œå¦‚ä¸‹è®¾ç½®ï¼ˆæ­¤å¤„ä¸è€ƒè™‘ç¦pingçš„æƒ…å†µï¼‰</p>
<p><img src="/2022/06/13/uncatalog/cl4cifak7000apwr7hgyg2fgs/6.png" alt="image"><br>ä¸Šå›¾ä¸­ï¼Œä½¿ç”¨â€-m icmpâ€è¡¨ç¤ºä½¿ç”¨icmpæ‰©å±•ï¼Œå› ä¸ºä¸Šä¾‹ä¸­ä½¿ç”¨äº†â€-p icmpâ€ï¼Œæ‰€ä»¥â€-m icmpâ€å¯ä»¥çœç•¥ï¼Œä½¿ç”¨â€â€“icmp-typeâ€é€‰é¡¹è¡¨ç¤ºæ ¹æ®å…·ä½“çš„typeä¸codeå»åŒ¹é…å¯¹åº”çš„icmpæŠ¥æ–‡ï¼Œè€Œä¸Šå›¾ä¸­çš„â€â€“icmp-type 8/0â€³è¡¨ç¤ºicmpæŠ¥æ–‡çš„typeä¸º8ï¼Œcodeä¸º0æ‰ä¼šè¢«åŒ¹é…åˆ°ï¼Œä¹Ÿå°±æ˜¯åªæœ‰pingè¯·æ±‚ç±»å‹çš„æŠ¥æ–‡æ‰èƒ½è¢«åŒ¹é…åˆ°ï¼Œæ‰€ä»¥ï¼Œåˆ«äººå¯¹æˆ‘ä»¬å‘èµ·çš„pingè¯·æ±‚å°†ä¼šè¢«æ‹’ç»é€šè¿‡é˜²ç«å¢™ï¼Œè€Œæˆ‘ä»¬ä¹‹æ‰€ä»¥èƒ½å¤Ÿpingé€šåˆ«äººï¼Œæ˜¯å› ä¸ºåˆ«äººå›åº”æˆ‘ä»¬çš„æŠ¥æ–‡çš„icmp typeä¸º0ï¼Œcodeä¹Ÿä¸º0ï¼Œæ‰€ä»¥æ— æ³•è¢«ä¸Šè¿°è§„åˆ™åŒ¹é…åˆ°ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åˆ«äººå›åº”æˆ‘ä»¬çš„ä¿¡æ¯ã€‚</p>
<p>å› ä¸ºtypeä¸º8çš„ç±»å‹ä¸‹åªæœ‰ä¸€ä¸ªcodeä¸º0çš„ç±»å‹ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥çœç•¥å¯¹åº”çš„codeï¼Œç¤ºä¾‹å¦‚ä¸‹</p>
<p><img src="/2022/06/13/uncatalog/cl4cifak7000apwr7hgyg2fgs/7.png" alt="image"></p>
<p>é™¤äº†èƒ½å¤Ÿä½¿ç”¨å¯¹åº”type/codeåŒ¹é…åˆ°å…·ä½“ç±»å‹çš„icmpæŠ¥æ–‡ä»¥å¤–ï¼Œæˆ‘ä»¬è¿˜èƒ½ç”¨icmpæŠ¥æ–‡çš„æè¿°åç§°å»åŒ¹é…å¯¹åº”ç±»å‹çš„æŠ¥æ–‡ï¼Œç¤ºä¾‹å¦‚ä¸‹</p>
<p>æ²¡é”™ï¼Œä¸Šä¾‹ä¸­ä½¿ç”¨çš„ â€“icmp-type â€œecho-requestâ€ä¸ â€“icmp-type 8/0çš„æ•ˆæœå®Œå…¨ç›¸åŒï¼Œå‚è€ƒæœ¬æ–‡æœ€ä¸Šæ–¹çš„è¡¨æ ¼å³å¯è·å–å¯¹åº”çš„icmpç±»å‹çš„æè¿°åç§°ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifak7000apwr7hgyg2fgs/8.png" alt="image"><br>æ³¨æ„ï¼šåç§°ä¸­çš„â€ç©ºæ ¼â€éœ€è¦æ›¿æ¢ä¸ºâ€-â€œã€‚</p>
<p>å°ç»“<br>udpæ‰©å±•<br>å¸¸ç”¨çš„æ‰©å±•åŒ¹é…æ¡ä»¶</p>
<ul>
<li><p>â€“sportï¼šåŒ¹é…udpæŠ¥æ–‡çš„æºåœ°å€</p>
</li>
<li><p>â€“dportï¼šåŒ¹é…udpæŠ¥æ–‡çš„ç›®æ ‡åœ°å€</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">ç¤ºä¾‹</span></span><br><span class="line">iptables -t filter -I INPUT -p udp -m udp --dport 137 -j ACCEPT</span><br><span class="line">iptables -t filter -I INPUT -p udp -m udp --dport 137:157 -j ACCEPT</span><br><span class="line"><span class="meta">#</span><span class="bash">å¯ä»¥ç»“åˆmultiportæ¨¡å—æŒ‡å®šå¤šä¸ªç¦»æ•£çš„ç«¯å£</span></span><br></pre></td></tr></table></figure></div></li>
</ul>
<p>icmpæ‰©å±•<br>å¸¸ç”¨çš„æ‰©å±•åŒ¹é…æ¡ä»¶</p>
<p>â€“icmp-typeï¼šåŒ¹é…icmpæŠ¥æ–‡çš„å…·ä½“ç±»å‹</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">ç¤ºä¾‹</span></span><br><span class="line">iptables -t filter -I INPUT -p icmp -m icmp --icmp-type 8/0 -j REJECT</span><br><span class="line">iptables -t filter -I INPUT -p icmp --icmp-type 8 -j REJECT</span><br><span class="line">iptables -t filter -I OUTPUT -p icmp -m icmp --icmp-type 0/0 -j REJECT</span><br><span class="line">iptables -t filter -I OUTPUT -p icmp --icmp-type 0 -j REJECT</span><br><span class="line">iptables -t filter -I INPUT -p icmp --icmp-type &quot;echo-request&quot; -j REJECT</span><br></pre></td></tr></table></figure></div>]]></content>
      <tags>
        <tag>äº‘åŸç”ŸåŸºç¡€ç³»åˆ—</tag>
        <tag>Kubernetesç½‘ç»œ</tag>
      </tags>
  </entry>
  <entry>
    <title>Kubernetesç½‘ç»œç³»åˆ—ä¹‹(äºŒåä¹)iptablesçš„é»‘ç™½åå•æœºåˆ¶</title>
    <url>/2022/06/13/uncatalog/cl4cifak8000cpwr739275b4h/</url>
    <content><![CDATA[<hr>
<span id="more"></span>

<hr>
<p>å‰æ–‡ä¸­ä¸€ç›´åœ¨å¼ºè°ƒä¸€ä¸ªæ¦‚å¿µï¼šæŠ¥æ–‡åœ¨ç»è¿‡iptablesçš„é“¾æ—¶ï¼Œä¼šåŒ¹é…é“¾ä¸­çš„è§„åˆ™ï¼Œé‡åˆ°åŒ¹é…çš„è§„åˆ™æ—¶ï¼Œå°±æ‰§è¡Œå¯¹åº”çš„åŠ¨ä½œï¼Œå¦‚æœé“¾ä¸­çš„è§„åˆ™éƒ½æ— æ³•åŒ¹é…åˆ°å½“å‰æŠ¥æ–‡ï¼Œåˆ™ä½¿ç”¨é“¾çš„é»˜è®¤ç­–ç•¥ï¼ˆé»˜è®¤åŠ¨ä½œï¼‰ï¼Œé“¾çš„é»˜è®¤ç­–ç•¥é€šå¸¸è®¾ç½®ä¸ºACCEPTæˆ–è€…DROPã€‚</p>
<p>é‚£ä¹ˆï¼Œå½“é“¾çš„é»˜è®¤ç­–ç•¥è®¾ç½®ä¸ºACCEPTæ—¶ï¼Œå¦‚æœå¯¹åº”çš„é“¾ä¸­æ²¡æœ‰é…ç½®ä»»ä½•è§„åˆ™ï¼Œå°±è¡¨ç¤ºæ¥å—æ‰€æœ‰çš„æŠ¥æ–‡ï¼Œå¦‚æœå¯¹åº”çš„é“¾ä¸­å­˜åœ¨è§„åˆ™ï¼Œä½†æ˜¯è¿™äº›è§„åˆ™æ²¡æœ‰åŒ¹é…åˆ°æŠ¥æ–‡ï¼ŒæŠ¥æ–‡è¿˜æ˜¯ä¼šè¢«æ¥å—ã€‚</p>
<p>åŒç†ï¼Œå½“é“¾çš„é»˜è®¤ç­–ç•¥è®¾ç½®ä¸ºDROPæ—¶ï¼Œå¦‚æœå¯¹åº”çš„é“¾ä¸­æ²¡æœ‰é…ç½®ä»»ä½•è§„åˆ™ï¼Œå°±è¡¨ç¤ºæ‹’ç»æ‰€æœ‰æŠ¥æ–‡ï¼Œå¦‚æœå¯¹åº”çš„é“¾ä¸­å­˜åœ¨è§„åˆ™ï¼Œä½†æ˜¯è¿™äº›è§„åˆ™æ²¡æœ‰åŒ¹é…åˆ°æŠ¥æ–‡ï¼ŒæŠ¥æ–‡è¿˜æ˜¯ä¼šè¢«æ‹’ç»ã€‚</p>
<p>æ‰€ä»¥ï¼Œå½“é“¾çš„é»˜è®¤ç­–ç•¥è®¾ç½®ä¸ºACCEPTæ—¶ï¼ŒæŒ‰ç…§é“ç†æ¥è¯´ï¼Œæˆ‘ä»¬åœ¨é“¾ä¸­é…ç½®è§„åˆ™æ—¶ï¼Œå¯¹åº”çš„åŠ¨ä½œåº”è¯¥è®¾ç½®ä¸ºDROPæˆ–è€…REJECTï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>å› ä¸ºé»˜è®¤ç­–ç•¥å·²ç»ä¸ºACCEPTäº†ï¼Œå¦‚æœæˆ‘ä»¬åœ¨è®¾ç½®è§„åˆ™æ—¶ï¼Œå¯¹åº”åŠ¨ä½œä»ç„¶ä¸ºACCEPTï¼Œé‚£ä¹ˆæ‰€æœ‰æŠ¥æ–‡éƒ½ä¼šè¢«æ”¾è¡Œäº†ï¼Œå› ä¸ºä¸ç®¡æŠ¥æ–‡æ˜¯å¦è¢«è§„åˆ™åŒ¹é…åˆ°éƒ½ä¼šè¢«ACCEPTï¼Œæ‰€ä»¥å°±å¤±å»äº†è®¿é—®æ§åˆ¶çš„æ„ä¹‰ã€‚</p>
<p>æ‰€ä»¥ï¼Œå½“é“¾çš„é»˜è®¤ç­–ç•¥ä¸ºACCEPTæ—¶ï¼Œé“¾ä¸­çš„è§„åˆ™å¯¹åº”çš„åŠ¨ä½œåº”è¯¥ä¸ºDROPæˆ–è€…REJECTï¼Œè¡¨ç¤ºåªæœ‰åŒ¹é…åˆ°è§„åˆ™çš„æŠ¥æ–‡æ‰ä¼šè¢«æ‹’ç»ï¼Œæ²¡æœ‰è¢«è§„åˆ™åŒ¹é…åˆ°çš„æŠ¥æ–‡éƒ½ä¼šè¢«é»˜è®¤æ¥å—ï¼Œè¿™å°±æ˜¯â€é»‘åå•â€æœºåˆ¶ã€‚</p>
<p>åŒç†ï¼Œå½“é“¾çš„é»˜è®¤ç­–ç•¥ä¸ºDROPæ—¶ï¼Œé“¾ä¸­çš„è§„åˆ™å¯¹åº”çš„åŠ¨ä½œåº”è¯¥ä¸ºACCEPTï¼Œè¡¨ç¤ºåªæœ‰åŒ¹é…åˆ°è§„åˆ™çš„æŠ¥æ–‡æ‰ä¼šè¢«æ”¾è¡Œï¼Œæ²¡æœ‰è¢«è§„åˆ™åŒ¹é…åˆ°çš„æŠ¥æ–‡éƒ½ä¼šè¢«é»˜è®¤æ‹’ç»ï¼Œè¿™å°±æ˜¯â€ç™½åå•â€æœºåˆ¶ã€‚</p>
<p>å¦‚æœä½¿ç”¨ç™½åå•æœºåˆ¶ï¼Œæˆ‘ä»¬å°±è¦æŠŠæ‰€æœ‰äººéƒ½å½“åšåäººï¼Œåªæ”¾è¡Œå¥½äººã€‚</p>
<p>å¦‚æœä½¿ç”¨é»‘åå•æœºåˆ¶ï¼Œæˆ‘ä»¬å°±è¦æŠŠæ‰€æœ‰äººéƒ½å½“æˆå¥½äººï¼Œåªæ‹’ç»åäººã€‚</p>
<p>ç™½åå•æœºåˆ¶ä¼¼ä¹æ›´åŠ å®‰å…¨ä¸€äº›ï¼Œé»‘åå•æœºåˆ¶ä¼¼ä¹æ›´åŠ çµæ´»ä¸€äº›ã€‚</p>
<p>é‚£ä¹ˆï¼Œæˆ‘ä»¬å°±æ¥åšä¸€ä¸ªç®€å•çš„ç™½åå•å§ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåªæ”¾è¡Œè¢«è§„åˆ™åŒ¹é…åˆ°çš„æŠ¥æ–‡ï¼Œå…¶ä»–æŠ¥æ–‡ä¸€å¾‹æ‹’ç»ï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬å…ˆæ¥é…ç½®è§„åˆ™ã€‚</p>
<p>å‡è®¾ï¼Œæˆ‘æƒ³è¦æ”¾è¡Œsshè¿œç¨‹è¿æ¥ç›¸å…³çš„æŠ¥æ–‡ï¼Œä¹Ÿæƒ³è¦æ”¾è¡ŒwebæœåŠ¡ç›¸å…³çš„æŠ¥æ–‡ï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬åœ¨INPUTé“¾ä¸­æ·»åŠ å¦‚ä¸‹è§„åˆ™ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifak8000cpwr739275b4h/1.png" alt="image"></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬å·²ç»æ”¾è¡Œäº†ç‰¹å®šçš„æŠ¥æ–‡ï¼Œåªæœ‰ä¸Šè¿°ä¸¤æ¡è§„åˆ™åŒ¹é…åˆ°çš„æŠ¥æ–‡æ‰ä¼šè¢«æ”¾è¡Œï¼Œç°åœ¨ï¼Œæˆ‘ä»¬åªè¦å°†INPUTé“¾çš„é»˜è®¤ç­–ç•¥æ”¹ä¸ºDROPï¼Œå³å¯å®ç°ç™½åå•æœºåˆ¶ã€‚</p>
<p>ç¤ºä¾‹å¦‚ä¸‹ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifak8000cpwr739275b4h/2.png" alt="image"></p>
<p>ä¸Šå›¾ä¸­ï¼Œæˆ‘ä»¬å·²ç»å°†INPUTé“¾çš„é»˜è®¤ç­–ç•¥æ”¹ä¸ºDROPï¼Œå¹¶ä¸”å·²ç»å®ç°äº†æ‰€è°“çš„ç™½åå•æœºåˆ¶ï¼Œå³é»˜è®¤æ‹’ç»æ‰€æœ‰æŠ¥æ–‡ï¼Œåªæ”¾è¡Œç‰¹å®šçš„æŠ¥æ–‡ã€‚</p>
<p>å¦‚æœæ­¤æ—¶ï¼Œæˆ‘ä¸å°å¿ƒæ‰§è¡Œäº†â€iptables -Fâ€æ“ä½œï¼Œæ ¹æ®æˆ‘ä»¬ä¹‹å‰å­¦åˆ°çš„çŸ¥è¯†å»åˆ¤æ–­ï¼Œæˆ‘ä»¬è¿˜èƒ½å¤Ÿé€šè¿‡sshå·¥å…·è¿œç¨‹åˆ°æœåŠ¡å™¨ä¸Šå—ï¼Ÿ</p>
<p>æˆ‘æƒ³ä½ å·²ç»åˆ¤æ–­å‡ºäº†æ­£ç¡®ç­”æ¡ˆï¼Œæ²¡é”™ï¼ŒæŒ‰ç…§ä¸Šå›¾ä¸­çš„æƒ…å†µï¼Œå¦‚æœæ­¤æ—¶æ‰§è¡Œâ€iptables -Fâ€æ“ä½œï¼Œfilterè¡¨ä¸­çš„æ‰€æœ‰é“¾ä¸­çš„æ‰€æœ‰è§„åˆ™éƒ½ä¼šè¢«æ¸…ç©ºï¼Œè€ŒINPUTé“¾çš„é»˜è®¤ç­–ç•¥ä¸ºDROPï¼Œæ‰€ä»¥æ‰€æœ‰æŠ¥æ–‡éƒ½ä¼šè¢«æ‹’ç»ï¼Œä¸æ­¢sshè¿œç¨‹è¯·æ±‚ä¼šè¢«æ‹’ç»ï¼Œå…¶ä»–æŠ¥æ–‡ä¹Ÿä¼šè¢«æ‹’ç»ï¼Œæˆ‘ä»¬æ¥å®éªŒä¸€ä¸‹ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifak8000cpwr739275b4h/3.png" alt="image"></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œåœ¨å½“å‰sshè¿œç¨‹å·¥å…·ä¸­æ‰§è¡Œâ€iptables -Fâ€å‘½ä»¤åï¼Œç”±äºINPUTé“¾ä¸­å·²ç»ä¸å­˜åœ¨ä»»ä½•è§„åˆ™ï¼Œæ‰€ä»¥ï¼Œæ‰€æœ‰æŠ¥æ–‡éƒ½è¢«æ‹’ç»äº†ï¼ŒåŒ…æ‹¬å½“å‰çš„sshè¿œç¨‹è¿æ¥ã€‚</p>
<p>è¿™å°±æ˜¯é»˜è®¤ç­–ç•¥è®¾ç½®ä¸ºDROPçš„ç¼ºç‚¹ï¼Œåœ¨å¯¹åº”çš„é“¾ä¸­æ²¡æœ‰è®¾ç½®ä»»ä½•è§„åˆ™æ—¶ï¼Œè¿™æ ·ä½¿ç”¨é»˜è®¤ç­–ç•¥ä¸ºDROPæ˜¯éå¸¸ä¸æ˜æ™ºçš„ï¼Œå› ä¸ºç®¡ç†å‘˜ä¹Ÿä¼šæŠŠè‡ªå·±æ‹’ä¹‹é—¨å¤–ï¼Œå³ä½¿å¯¹åº”çš„é“¾ä¸­å­˜åœ¨æ”¾è¡Œè§„åˆ™ï¼Œå½“æˆ‘ä»¬ä¸å°å¿ƒä½¿ç”¨â€iptables -Fâ€æ¸…ç©ºè§„åˆ™æ—¶ï¼Œæ”¾è¡Œè§„åˆ™è¢«åˆ é™¤ï¼Œåˆ™æ‰€æœ‰æ•°æ®åŒ…éƒ½æ— æ³•è¿›å…¥ï¼Œè¿™ä¸ªæ—¶å€™å°±ç›¸å½“äºç»™ç®¡ç†å‘˜æŒ–äº†ä¸ªå‘ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å¦‚æœæƒ³è¦ä½¿ç”¨â€ç™½åå•â€çš„æœºåˆ¶ï¼Œæœ€å¥½å°†é“¾çš„é»˜è®¤ç­–ç•¥ä¿æŒä¸ºâ€ACCEPTâ€ï¼Œç„¶åå°†â€æ‹’ç»æ‰€æœ‰è¯·æ±‚â€è¿™æ¡è§„åˆ™æ”¾åœ¨é“¾çš„å°¾éƒ¨ï¼Œå°†â€æ”¾è¡Œè§„åˆ™â€æ”¾åœ¨å‰é¢ï¼Œè¿™æ ·åšï¼Œæ—¢èƒ½å®ç°â€ç™½åå•â€æœºåˆ¶ï¼Œåˆèƒ½ä¿è¯åœ¨è§„åˆ™è¢«æ¸…ç©ºæ—¶ï¼Œç®¡ç†å‘˜è¿˜æœ‰æœºä¼šè¿æ¥åˆ°ä¸»æœºï¼Œç¤ºä¾‹å¦‚ä¸‹ã€‚</p>
<p>å› ä¸ºåˆšæ‰çš„sshè¿æ¥å·²ç»è¢«æ‹’ç»ï¼Œæ‰€ä»¥ï¼Œæ­¤æ—¶ç›´æ¥åœ¨æ§åˆ¶å°ä¸­è®¾ç½®iptablesè§„åˆ™</p>
<p><img src="/2022/06/13/uncatalog/cl4cifak8000cpwr739275b4h/4.png" alt="image"></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå…ˆå°†INPUTé“¾çš„é»˜è®¤ç­–ç•¥è®¾ç½®ä¸ºACCEPT</p>
<p>ç„¶åç»§ç»­é…ç½®éœ€è¦æ”¾è¡Œçš„æŠ¥æ–‡çš„è§„åˆ™ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå½“æ‰€æœ‰æ”¾è¡Œè§„åˆ™è®¾ç½®å®Œæˆåï¼Œåœ¨INPUTé“¾çš„å°¾éƒ¨ï¼Œè®¾ç½®ä¸€æ¡æ‹’ç»æ‰€æœ‰è¯·æ±‚çš„è§„åˆ™ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifak8000cpwr739275b4h/5.png" alt="image"></p>
<p>ä¸Šå›¾ä¸­çš„è®¾ç½®ï¼Œæ—¢å°†INPUTé“¾çš„é»˜è®¤ç­–ç•¥è®¾ç½®ä¸ºäº†ACCEPTï¼ŒåŒæ—¶åˆä½¿ç”¨äº†ç™½åå•æœºåˆ¶ï¼Œå› ä¸ºå¦‚æœæŠ¥æ–‡ç¬¦åˆæ”¾è¡Œæ¡ä»¶ï¼Œåˆ™ä¼šè¢«å‰é¢çš„æ”¾è¡Œè§„åˆ™åŒ¹é…åˆ°ï¼Œå¦‚æœæŠ¥æ–‡ä¸ç¬¦åˆæ”¾è¡Œæ¡ä»¶ï¼Œåˆ™ä¼šè¢«æœ€åä¸€æ¡æ‹’ç»è§„åˆ™åŒ¹é…åˆ°ï¼Œæ­¤åˆ»ï¼Œå³ä½¿æˆ‘ä»¬è¯¯æ“ä½œï¼Œæ‰§è¡Œäº†â€iptables -Fâ€æ“ä½œï¼Œä¹Ÿèƒ½ä¿è¯ç®¡ç†å‘˜èƒ½å¤Ÿè¿œç¨‹åˆ°ä¸»æœºä¸Šè¿›è¡Œç»´æŠ¤ï¼Œå› ä¸ºé»˜è®¤ç­–ç•¥ä»ç„¶æ˜¯ACCEPTã€‚</p>
]]></content>
      <tags>
        <tag>äº‘åŸç”ŸåŸºç¡€ç³»åˆ—</tag>
        <tag>Kubernetesç½‘ç»œ</tag>
      </tags>
  </entry>
  <entry>
    <title>Kubernetesç½‘ç»œç³»åˆ—ä¹‹(äºŒåäºŒ)iptableså®é™…æ“ä½œä¹‹è§„åˆ™æŸ¥è¯¢</title>
    <url>/2022/06/13/uncatalog/cl4cifak9000epwr7cx322y2s/</url>
    <content><![CDATA[<hr>
<span id="more"></span>



<hr>
<p>å¦‚æœä½ æ˜¯ä¸€ä¸ªæ–°æ‰‹ï¼Œåœ¨é˜…è¯»å¦‚ä¸‹æ–‡ç« æ—¶ï¼Œè¯·åšæŒè¯»åˆ°æœ€åï¼Œè¯»çš„è¿‡ç¨‹ä¸­å¯èƒ½ä¼šæœ‰éšœç¢ï¼Œä½†æ˜¯åœ¨è¯»å®Œä»¥åï¼Œä½ ä¼šå‘ç°ä½ å·²ç»æ˜ç™½äº†ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifak9000epwr7cx322y2s/1.jpg" alt="image"></p>
<p>åœ¨è¿›è¡Œiptableså®éªŒæ—¶ï¼Œè¯·åŠ¡å¿…åœ¨æµ‹è¯•æœºä¸Šè¿›è¡Œã€‚</p>
<p>ä¹‹å‰åœ¨iptablesçš„æ¦‚å¿µä¸­å·²ç»æåˆ°è¿‡ï¼Œåœ¨å®é™…æ“ä½œiptablesçš„è¿‡ç¨‹ä¸­ï¼Œæ˜¯ä»¥â€è¡¨â€ä½œä¸ºæ“ä½œå…¥å£çš„ï¼Œå¦‚æœä½ ç»å¸¸æ“ä½œå…³ç³»å‹æ•°æ®åº“ï¼Œé‚£ä¹ˆå½“ä½ å¬åˆ°â€è¡¨â€è¿™ä¸ªè¯çš„æ—¶å€™ï¼Œä½ å¯èƒ½ä¼šè”æƒ³åˆ°å¦ä¸€ä¸ªè¯â€”-â€œå¢åˆ æ”¹æŸ¥â€ï¼Œå½“æˆ‘ä»¬å®šä¹‰iptablesè§„åˆ™æ—¶ï¼Œæ‰€åšçš„æ“ä½œå…¶å®ç±»ä¼¼äºâ€å¢åˆ æ”¹æŸ¥â€ï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬å°±å…ˆä»æœ€ç®€å•çš„â€æŸ¥â€æ“ä½œå…¥æ‰‹ï¼Œå¼€å§‹å®é™…æ“ä½œiptablesã€‚</p>
<p>åœ¨ä¹‹å‰çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å·²ç»æ€»ç»“è¿‡ï¼Œiptablesä¸ºæˆ‘ä»¬é¢„å®šä¹‰äº†4å¼ è¡¨ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯rawè¡¨ã€mangleè¡¨ã€natè¡¨ã€filterè¡¨ï¼Œä¸åŒçš„è¡¨æ‹¥æœ‰ä¸åŒçš„åŠŸèƒ½ã€‚</p>
<p>filterè´Ÿè´£è¿‡æ»¤åŠŸèƒ½ï¼Œæ¯”å¦‚å…è®¸å“ªäº›IPåœ°å€è®¿é—®ï¼Œæ‹’ç»å“ªäº›IPåœ°å€è®¿é—®ï¼Œå…è®¸è®¿é—®å“ªäº›ç«¯å£ï¼Œç¦æ­¢è®¿é—®å“ªäº›ç«¯å£ï¼Œfilterè¡¨ä¼šæ ¹æ®æˆ‘ä»¬å®šä¹‰çš„è§„åˆ™è¿›è¡Œè¿‡æ»¤ï¼Œfilterè¡¨åº”è¯¥æ˜¯æˆ‘ä»¬æœ€å¸¸ç”¨åˆ°çš„è¡¨äº†ï¼Œæ‰€ä»¥æ­¤å¤„ï¼Œæˆ‘ä»¬ä»¥filterè¡¨ä¸ºä¾‹ï¼Œå¼€å§‹å­¦ä¹ æ€æ ·å®é™…æ“ä½œiptablesã€‚</p>
<p>æ€æ ·æŸ¥çœ‹filterè¡¨ä¸­çš„è§„åˆ™å‘¢ï¼Ÿä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å³å¯æŸ¥çœ‹ã€‚<br><img src="/2022/06/13/uncatalog/cl4cifak9000epwr7cx322y2s/2.png" alt="image"></p>
<p>ä¸Šä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨-té€‰é¡¹ï¼ŒæŒ‡å®šè¦æ“ä½œçš„è¡¨ï¼Œä½¿ç”¨-Lé€‰é¡¹ï¼ŒæŸ¥çœ‹-té€‰é¡¹å¯¹åº”çš„è¡¨çš„è§„åˆ™ï¼Œ-Lé€‰é¡¹çš„æ„æ€æ˜¯ï¼Œåˆ—å‡ºè§„åˆ™ï¼Œæ‰€ä»¥ï¼Œä¸Šè¿°å‘½ä»¤çš„å«ä¹‰ä¸ºåˆ—å‡ºfilterè¡¨çš„æ‰€æœ‰è§„åˆ™ï¼Œæ³¨æ„ï¼Œä¸Šå›¾ä¸­æ˜¾ç¤ºçš„è§„åˆ™ï¼ˆç»¿è‰²æ ‡æ³¨çš„éƒ¨åˆ†ä¸ºè§„åˆ™ï¼‰æ˜¯Centos6å¯åŠ¨iptablesä»¥åé»˜è®¤è®¾ç½®çš„è§„åˆ™ï¼Œæˆ‘ä»¬æš‚ä¸”ä¸ç”¨åœ¨æ„å®ƒä»¬ï¼Œä¸Šå›¾ä¸­ï¼Œæ˜¾ç¤ºå‡ºäº†3æ¡é“¾ï¼ˆè“è‰²æ ‡æ³¨éƒ¨åˆ†ä¸ºé“¾ï¼‰ï¼ŒINPUTé“¾ã€FORWARDé“¾ã€OUTPUTé“¾ï¼Œæ¯æ¡é“¾ä¸­éƒ½æœ‰è‡ªå·±çš„è§„åˆ™ï¼Œå‰æ–‡ä¸­ï¼Œæˆ‘ä»¬æ‰“è¿‡ä¸€ä¸ªæ¯”æ–¹ï¼ŒæŠŠâ€é“¾â€æ¯”ä½œâ€å…³å¡â€ï¼Œä¸åŒçš„â€å…³å¡â€æ‹¥æœ‰ä¸åŒçš„èƒ½åŠ›ï¼Œæ‰€ä»¥ï¼Œä»ä¸Šå›¾ä¸­å¯ä»¥çœ‹å‡ºï¼ŒINPUTé“¾ã€FORWARDé“¾ã€OUTPUTé“¾éƒ½æ‹¥æœ‰â€è¿‡æ»¤â€çš„èƒ½åŠ›ï¼Œæ‰€ä»¥ï¼Œå½“æˆ‘ä»¬è¦å®šä¹‰æŸæ¡â€è¿‡æ»¤â€çš„è§„åˆ™æ—¶ï¼Œæˆ‘ä»¬ä¼šåœ¨filterè¡¨ä¸­å®šä¹‰ï¼Œä½†æ˜¯å…·ä½“åœ¨å“ªæ¡â€é“¾â€ä¸Šå®šä¹‰è§„åˆ™å‘¢ï¼Ÿè¿™å–å†³äºæˆ‘ä»¬çš„å·¥ä½œåœºæ™¯ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬éœ€è¦ç¦æ­¢æŸä¸ªIPåœ°å€è®¿é—®æˆ‘ä»¬çš„ä¸»æœºï¼Œæˆ‘ä»¬åˆ™éœ€è¦åœ¨INPUTé“¾ä¸Šå®šä¹‰è§„åˆ™ã€‚å› ä¸ºï¼Œæˆ‘ä»¬åœ¨ç†è®ºæ€»ç»“ä¸­å·²ç»æåˆ°è¿‡ï¼ŒæŠ¥æ–‡å‘å¾€æœ¬æœºæ—¶ï¼Œä¼šç»è¿‡PREROUTINGé“¾ä¸INPUTé“¾ï¼ˆå¦‚æœä½ æ²¡æœ‰æ˜ç™½ï¼Œè¯·å›é¡¾å‰æ–‡ï¼‰ï¼Œæ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦ç¦æ­¢æŸäº›æŠ¥æ–‡å‘å¾€æœ¬æœºï¼Œæˆ‘ä»¬åªèƒ½åœ¨PREROUTINGé“¾å’ŒINPUTé“¾ä¸­å®šä¹‰è§„åˆ™ï¼Œä½†æ˜¯PREROUTINGé“¾å¹¶ä¸å­˜åœ¨äºfilterè¡¨ä¸­ï¼Œæ¢å¥è¯è¯´å°±æ˜¯ï¼ŒPREROUTINGå…³å¡å¤©ç”Ÿå°±æ²¡æœ‰è¿‡æ»¤çš„èƒ½åŠ›ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬åªèƒ½åœ¨INPUTé“¾ä¸­å®šä¹‰ï¼Œå½“ç„¶ï¼Œå¦‚æœæ˜¯å…¶ä»–å·¥ä½œåœºæ™¯ï¼Œå¯èƒ½éœ€è¦åœ¨FORWARDé“¾æˆ–è€…OUTPUTé“¾ä¸­å®šä¹‰è¿‡æ»¤è§„åˆ™ã€‚</p>
<p>è¯è¯´å›æ¥ï¼Œæˆ‘ä»¬ç»§ç»­èŠæ€æ ·æŸ¥çœ‹æŸå¼ è¡¨ä¸­çš„è§„åˆ™ã€‚</p>
<p>åˆšæ‰æåˆ°ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨iptables -t filter -Lå‘½ä»¤åˆ—å‡ºfilterè¡¨ä¸­çš„æ‰€æœ‰è§„åˆ™ï¼Œé‚£ä¹ˆä¸¾ä¸€åä¸‰ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æŸ¥çœ‹å…¶å®ƒè¡¨ä¸­çš„è§„åˆ™ï¼Œç¤ºä¾‹å¦‚ä¸‹ã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">iptables -t raw -L</span><br><span class="line"></span><br><span class="line">iptables -t mangle -L</span><br><span class="line"></span><br><span class="line">iptables -t nat -L</span><br></pre></td></tr></table></figure></div>

<p>å…¶å®ï¼Œæˆ‘ä»¬å¯ä»¥çœç•¥-t filterï¼Œå½“æ²¡æœ‰ä½¿ç”¨-té€‰é¡¹æŒ‡å®šè¡¨æ—¶ï¼Œé»˜è®¤ä¸ºæ“ä½œfilterè¡¨ï¼Œå³iptables -Lè¡¨ç¤ºåˆ—å‡ºfilterè¡¨ä¸­çš„æ‰€æœ‰è§„åˆ™ã€‚</p>
<p>æˆ‘ä»¬è¿˜å¯ä»¥åªæŸ¥çœ‹æŒ‡å®šè¡¨ä¸­çš„æŒ‡å®šé“¾çš„è§„åˆ™ï¼Œæ¯”å¦‚ï¼Œæˆ‘ä»¬åªæŸ¥çœ‹filterè¡¨ä¸­INPUTé“¾çš„è§„åˆ™ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼ˆæ³¨æ„å¤§å°å†™ï¼‰ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifak9000epwr7cx322y2s/3.png" alt="image"></p>
<p>ä¸Šå›¾ä¸­åªæ˜¾ç¤ºäº†filterè¡¨ä¸­INPUTé“¾ä¸­çš„è§„åˆ™ï¼ˆçœç•¥-té€‰é¡¹é»˜è®¤ä¸ºfilterè¡¨ï¼‰ï¼Œå½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥æŒ‡å®šåªæŸ¥çœ‹å…¶ä»–é“¾ï¼Œå…¶å®ï¼Œæˆ‘ä»¬æŸ¥çœ‹åˆ°çš„ä¿¡æ¯è¿˜ä¸æ˜¯æœ€è¯¦ç»†çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨-vé€‰é¡¹ï¼ŒæŸ¥çœ‹å‡ºæ›´å¤šçš„ã€æ›´è¯¦ç»†çš„ä¿¡æ¯ï¼Œç¤ºä¾‹å¦‚ä¸‹ã€‚<br><img src="/2022/06/13/uncatalog/cl4cifak9000epwr7cx322y2s/4.png" alt="image"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œä½¿ç”¨-vé€‰é¡¹åï¼Œiptablesä¸ºæˆ‘ä»¬å±•ç¤ºçš„ä¿¡æ¯æ›´å¤šäº†ï¼Œé‚£ä¹ˆï¼Œè¿™äº›å­—æ®µéƒ½æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿæˆ‘ä»¬æ¥æ€»ç»“ä¸€ä¸‹ï¼Œçœ‹ä¸æ‡‚æ²¡å…³ç³»ï¼Œç­‰åˆ°å®é™…ä½¿ç”¨çš„æ—¶å€™ï¼Œè‡ªç„¶ä¼šæ˜ç™½ï¼Œæ­¤å¤„å¤§æ¦‚äº†è§£ä¸€ä¸‹å³å¯ã€‚</p>
<p>å…¶å®ï¼Œè¿™äº›å­—æ®µå°±æ˜¯è§„åˆ™å¯¹åº”çš„å±æ€§ï¼Œè¯´ç™½äº†å°±æ˜¯è§„åˆ™çš„å„ç§ä¿¡æ¯ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¥æ€»ç»“ä¸€ä¸‹è¿™äº›å­—æ®µçš„å«ä¹‰ã€‚</p>
<ul>
<li><p>pkts:å¯¹åº”è§„åˆ™åŒ¹é…åˆ°çš„æŠ¥æ–‡çš„ä¸ªæ•°ã€‚</p>
</li>
<li><p>bytes:å¯¹åº”åŒ¹é…åˆ°çš„æŠ¥æ–‡åŒ…çš„å¤§å°æ€»å’Œã€‚</p>
</li>
<li><p>target:è§„åˆ™å¯¹åº”çš„targetï¼Œå¾€å¾€è¡¨ç¤ºè§„åˆ™å¯¹åº”çš„â€åŠ¨ä½œâ€ï¼Œå³è§„åˆ™åŒ¹é…æˆåŠŸåéœ€è¦é‡‡å–çš„æªæ–½ã€‚</p>
</li>
<li><p>prot:è¡¨ç¤ºè§„åˆ™å¯¹åº”çš„åè®®ï¼Œæ˜¯å¦åªé’ˆå¯¹æŸäº›åè®®åº”ç”¨æ­¤è§„åˆ™ã€‚</p>
</li>
<li><p>opt:è¡¨ç¤ºè§„åˆ™å¯¹åº”çš„é€‰é¡¹ã€‚</p>
</li>
<li><p>in:è¡¨ç¤ºæ•°æ®åŒ…ç”±å“ªä¸ªæ¥å£(ç½‘å¡)æµå…¥ï¼Œå³ä»å“ªä¸ªç½‘å¡æ¥ã€‚</p>
</li>
<li><p>out:è¡¨ç¤ºæ•°æ®åŒ…å°†ç”±å“ªä¸ªæ¥å£(ç½‘å¡)æµå‡ºï¼Œå³åˆ°å“ªä¸ªç½‘å¡å»ã€‚</p>
</li>
<li><p>source:è¡¨ç¤ºè§„åˆ™å¯¹åº”çš„æºå¤´åœ°å€ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªIPï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªç½‘æ®µã€‚</p>
</li>
<li><p>destination:è¡¨ç¤ºè§„åˆ™å¯¹åº”çš„ç›®æ ‡åœ°å€ã€‚å¯ä»¥æ˜¯ä¸€ä¸ªIPï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªç½‘æ®µã€‚</p>
</li>
</ul>
<p>ç»†å¿ƒå¦‚ä½ ä¸€å®šå‘ç°äº†ï¼Œä¸Šå›¾ä¸­çš„æºåœ°å€ä¸ç›®æ ‡åœ°å€éƒ½ä¸ºanywhereï¼Œçœ‹æ¥ï¼Œiptablesé»˜è®¤ä¸ºæˆ‘ä»¬è¿›è¡Œäº†åç§°è§£æï¼Œä½†æ˜¯åœ¨è§„åˆ™éå¸¸å¤šçš„æƒ…å†µä¸‹å¦‚æœè¿›è¡Œåç§°è§£æï¼Œæ•ˆç‡ä¼šæ¯”è¾ƒä½ï¼Œæ‰€ä»¥ï¼Œåœ¨æ²¡æœ‰æ­¤éœ€æ±‚çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨-né€‰é¡¹ï¼Œè¡¨ç¤ºä¸å¯¹IPåœ°å€è¿›è¡Œåç§°åè§£ï¼Œç›´æ¥æ˜¾ç¤ºIPåœ°å€ï¼Œç¤ºä¾‹å¦‚ä¸‹ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifak9000epwr7cx322y2s/5.png" alt="image"></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œè§„åˆ™ä¸­çš„æºåœ°å€ä¸ç›®æ ‡åœ°å€å·²ç»æ˜¾ç¤ºä¸ºIPï¼Œè€Œéè½¬æ¢åçš„åç§°ã€‚</p>
<p>å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åªæŸ¥çœ‹æŸä¸ªé“¾çš„è§„åˆ™ï¼Œå¹¶ä¸”ä¸è®©IPè¿›è¡Œåè§£ï¼Œè¿™æ ·æ›´æ¸…æ™°ä¸€äº›ï¼Œæ¯”å¦‚ iptables -nvL INPUT</p>
<p>å¦‚æœä½ ä¹ æƒ¯äº†æŸ¥çœ‹æœ‰åºå·çš„åˆ—è¡¨ï¼Œä½ åœ¨æŸ¥çœ‹iptablesè¡¨ä¸­çš„è§„åˆ™æ—¶è‚¯å®šä¼šå¾ˆä¸çˆ½ï¼Œæ²¡æœ‰å…³ç³»ï¼Œæ»¡è¶³ä½ ï¼Œä½¿ç”¨â€“line-numberså³å¯æ˜¾ç¤ºè§„åˆ™çš„ç¼–å·ï¼Œç¤ºä¾‹å¦‚ä¸‹ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifak9000epwr7cx322y2s/6.png" alt="image"></p>
<p>â€“line-numbersé€‰é¡¹å¹¶æ²¡æœ‰å¯¹åº”çš„çŸ­é€‰é¡¹ï¼Œä¸è¿‡æˆ‘ä»¬ç¼©å†™æˆâ€“lineæ—¶ï¼Œcentosä¸­çš„iptablesä¹Ÿå¯ä»¥è¯†åˆ«ã€‚</p>
<p>æˆ‘çŸ¥é“ä½ ç›®å…‰å¦‚ç‚¬ï¼Œä½ å¯èƒ½æ—©å°±å‘ç°äº†ï¼Œè¡¨ä¸­çš„æ¯ä¸ªé“¾çš„åé¢éƒ½æœ‰ä¸€ä¸ªæ‹¬å·ï¼Œæ‹¬å·é‡Œé¢æœ‰ä¸€äº›ä¿¡æ¯ï¼Œå¦‚ä¸‹å›¾çº¢è‰²æ ‡æ³¨ä½ç½®ï¼Œé‚£ä¹ˆè¿™äº›ä¿¡æ¯éƒ½ä»£è¡¨äº†ä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬æ¥çœ‹çœ‹ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifak9000epwr7cx322y2s/7.png" alt="image"></p>
<p>ä¸Šå›¾ä¸­INPUTé“¾åé¢çš„æ‹¬å·ä¸­åŒ…å«policy ACCEPT ï¼Œ0 packetsï¼Œ0bytes ä¸‰éƒ¨åˆ†ã€‚</p>
<ul>
<li><p>policyè¡¨ç¤ºå½“å‰é“¾çš„é»˜è®¤ç­–ç•¥ï¼Œpolicy ACCEPTè¡¨ç¤ºä¸Šå›¾ä¸­INPUTçš„é“¾çš„é»˜è®¤åŠ¨ä½œä¸ºACCEPTï¼Œæ¢å¥è¯è¯´å°±æ˜¯ï¼Œé»˜è®¤æ¥å—é€šè¿‡INPUTå…³å¡çš„æ‰€æœ‰è¯·æ±‚ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨é…ç½®INPUTé“¾çš„å…·ä½“è§„åˆ™æ—¶ï¼Œåº”è¯¥å°†éœ€è¦æ‹’ç»çš„è¯·æ±‚é…ç½®åˆ°è§„åˆ™ä¸­ï¼Œè¯´ç™½äº†å°±æ˜¯â€é»‘åå•â€æœºåˆ¶ï¼Œé»˜è®¤æ‰€æœ‰äººéƒ½èƒ½é€šè¿‡ï¼Œåªæœ‰æŒ‡å®šçš„äººä¸èƒ½é€šè¿‡ï¼Œå½“æˆ‘ä»¬æŠŠINPUTé“¾é»˜è®¤åŠ¨ä½œè®¾ç½®ä¸ºæ¥å—(ACCEPT)ï¼Œå°±è¡¨ç¤ºæ‰€æœ‰äººéƒ½èƒ½é€šè¿‡è¿™ä¸ªå…³å¡ï¼Œæ­¤æ—¶å°±åº”è¯¥åœ¨å…·ä½“çš„è§„åˆ™ä¸­æŒ‡å®šéœ€è¦æ‹’ç»çš„è¯·æ±‚ï¼Œå°±è¡¨ç¤ºåªæœ‰æŒ‡å®šçš„äººä¸èƒ½é€šè¿‡è¿™ä¸ªå…³å¡ï¼Œè¿™å°±æ˜¯é»‘åå•æœºåˆ¶ï¼Œä½†æ˜¯ï¼Œä½ ä¸€å®šå‘ç°äº†ï¼Œä¸Šå›¾ä¸­æ‰€æ˜¾ç¤ºå‡ºçš„è§„åˆ™ï¼Œå¤§éƒ¨åˆ†éƒ½æ˜¯æ¥å—è¯·æ±‚(ACCEPT)ï¼Œå¹¶ä¸æ˜¯æƒ³è±¡ä¸­çš„æ‹’ç»è¯·æ±‚(DROPæˆ–è€…REJECT)ï¼Œè¿™ä¸æˆ‘ä»¬æ‰€æè¿°çš„é»‘åå•æœºåˆ¶ä¸ç¬¦å•Šï¼ŒæŒ‰ç…§é“ç†æ¥è¯´ï¼Œé»˜è®¤åŠ¨ä½œä¸ºæ¥å—ï¼Œå°±åº”è¯¥åœ¨å…·ä½“çš„è§„åˆ™ä¸­é…ç½®éœ€è¦æ‹’ç»çš„äººï¼Œä½†æ˜¯ä¸Šå›¾ä¸­å¹¶ä¸æ˜¯è¿™æ ·çš„ï¼Œä¹‹æ‰€ä»¥å‡ºç°ä¸Šå›¾ä¸­çš„æƒ…å†µï¼Œæ˜¯å› ä¸ºIPTABLESçš„å·¥ä½œæœºåˆ¶å¯¼è‡´åˆ°ï¼Œä¸Šä¾‹å…¶å®æ˜¯åˆ©ç”¨äº†è¿™äº›â€æœºåˆ¶â€ï¼Œå®Œæˆäº†æ‰€è°“çš„â€ç™½åå•â€æœºåˆ¶ï¼Œå¹¶ä¸æ˜¯æˆ‘ä»¬æ‰€æè¿°çš„â€é»‘åå•â€æœºåˆ¶ï¼Œæˆ‘ä»¬æ­¤å¤„æš‚æ—¶ä¸ç”¨å…³æ³¨è¿™ä¸€ç‚¹ï¼Œä¹‹åä¼šè¿›è¡Œè¯¦ç»†çš„ä¸¾ä¾‹å¹¶è§£é‡Šï¼Œæ­¤å¤„æˆ‘ä»¬åªè¦æ˜ç™½policyå¯¹åº”çš„åŠ¨ä½œä¸ºé“¾çš„é»˜è®¤åŠ¨ä½œå³å¯ï¼Œæˆ–è€…æ¢å¥è¯è¯´ï¼Œæˆ‘ä»¬åªè¦ç†è§£ï¼Œpolicyä¸ºé“¾çš„é»˜è®¤ç­–ç•¥å³å¯ã€‚</p>
</li>
<li><p>packetsè¡¨ç¤ºå½“å‰é“¾ï¼ˆä¸Šä¾‹ä¸ºINPUTé“¾ï¼‰é»˜è®¤ç­–ç•¥åŒ¹é…åˆ°çš„åŒ…çš„æ•°é‡ï¼Œ0 packetsè¡¨ç¤ºé»˜è®¤ç­–ç•¥åŒ¹é…åˆ°0ä¸ªåŒ…ã€‚</p>
</li>
<li><p>bytesè¡¨ç¤ºå½“å‰é“¾é»˜è®¤ç­–ç•¥åŒ¹é…åˆ°çš„æ‰€æœ‰åŒ…çš„å¤§å°æ€»å’Œã€‚</p>
</li>
</ul>
<p>å…¶å®ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠpacketsä¸bytesç§°ä½œâ€è®¡æ•°å™¨â€ï¼Œä¸Šå›¾ä¸­çš„è®¡æ•°å™¨è®°å½•äº†é»˜è®¤ç­–ç•¥åŒ¹é…åˆ°çš„æŠ¥æ–‡æ•°é‡ä¸æ€»å¤§å°ï¼Œâ€è®¡æ•°å™¨â€åªä¼šåœ¨ä½¿ç”¨-vé€‰é¡¹æ—¶ï¼Œæ‰ä¼šæ˜¾ç¤ºå‡ºæ¥ã€‚</p>
<p>å½“è¢«åŒ¹é…åˆ°çš„åŒ…è¾¾åˆ°ä¸€å®šæ•°é‡æ—¶ï¼Œè®¡æ•°å™¨ä¼šè‡ªåŠ¨å°†åŒ¹é…åˆ°çš„åŒ…çš„å¤§å°è½¬æ¢ä¸ºå¯è¯»æ€§è¾ƒé«˜çš„å•ä½ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifak9000epwr7cx322y2s/8.png" alt="image"></p>
<p>å¦‚æœä½ æƒ³è¦æŸ¥çœ‹ç²¾ç¡®çš„è®¡æ•°å€¼ï¼Œè€Œä¸æ˜¯ç»è¿‡å¯è¯»æ€§ä¼˜åŒ–è¿‡çš„è®¡æ•°å€¼ï¼Œé‚£ä¹ˆä½ å¯ä»¥ä½¿ç”¨-xé€‰é¡¹ï¼Œè¡¨ç¤ºæ˜¾ç¤ºç²¾ç¡®çš„è®¡æ•°å€¼ï¼Œç¤ºä¾‹å¦‚ä¸‹ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifak9000epwr7cx322y2s/9.png" alt="image"></p>
<p>æ¯å¼ è¡¨ä¸­çš„æ¯æ¡é“¾éƒ½æœ‰è‡ªå·±çš„è®¡æ•°å™¨ï¼Œé“¾ä¸­çš„æ¯ä¸ªè§„åˆ™ä¹Ÿéƒ½æœ‰è‡ªå·±çš„è®¡æ•°å™¨ï¼Œæ²¡é”™ï¼Œå°±æ˜¯æ¯æ¡è§„åˆ™å¯¹åº”çš„pktså­—æ®µä¸byteså­—æ®µçš„ä¿¡æ¯ã€‚</p>
<p>å‘½ä»¤å°èŠ‚<br>å¥½äº†ï¼Œæˆ‘ä»¬å·²ç»ä¼šä½¿ç”¨å‘½ä»¤ç®€å•çš„æŸ¥çœ‹iptablesè¡¨çš„è§„åˆ™äº†ï¼Œä¸ºäº†æ–¹ä¾¿ä»¥åå›é¡¾ï¼Œæˆ‘ä»¬å°†ä¸Šæ–‡ä¸­çš„ç›¸å…³å‘½ä»¤æ€»ç»“ä¸€ä¸‹ã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">iptables -t è¡¨å -L</span><br></pre></td></tr></table></figure></div>
<p>æŸ¥çœ‹å¯¹åº”è¡¨çš„æ‰€æœ‰è§„åˆ™ï¼Œ-té€‰é¡¹æŒ‡å®šè¦æ“ä½œçš„è¡¨ï¼Œçœç•¥â€-t è¡¨åâ€æ—¶ï¼Œé»˜è®¤è¡¨ç¤ºæ“ä½œfilterè¡¨ï¼Œ-Lè¡¨ç¤ºåˆ—å‡ºè§„åˆ™ï¼Œå³æŸ¥çœ‹è§„åˆ™ã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">iptables -t è¡¨å -L é“¾å</span><br></pre></td></tr></table></figure></div>

<p>æŸ¥çœ‹æŒ‡å®šè¡¨çš„æŒ‡å®šé“¾ä¸­çš„è§„åˆ™ã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">iptables -t è¡¨å -v -L</span><br></pre></td></tr></table></figure></div>
<p>æŸ¥çœ‹æŒ‡å®šè¡¨çš„æ‰€æœ‰è§„åˆ™ï¼Œå¹¶ä¸”æ˜¾ç¤ºæ›´è¯¦ç»†çš„ä¿¡æ¯ï¼ˆæ›´å¤šå­—æ®µï¼‰ï¼Œ-vè¡¨ç¤ºverboseï¼Œè¡¨ç¤ºè¯¦ç»†çš„ï¼Œå†—é•¿çš„ï¼Œå½“ä½¿ç”¨-vé€‰é¡¹æ—¶ï¼Œä¼šæ˜¾ç¤ºå‡ºâ€è®¡æ•°å™¨â€çš„ä¿¡æ¯ï¼Œç”±äºä¸Šä¾‹ä¸­ä½¿ç”¨çš„é€‰é¡¹éƒ½æ˜¯çŸ­é€‰é¡¹ï¼Œæ‰€ä»¥ä¸€èˆ¬ç®€å†™ä¸ºiptables -t è¡¨å -vL</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">iptables -t è¡¨å -n -L</span><br></pre></td></tr></table></figure></div>
<p>è¡¨ç¤ºæŸ¥çœ‹è¡¨çš„æ‰€æœ‰è§„åˆ™ï¼Œå¹¶ä¸”åœ¨æ˜¾ç¤ºè§„åˆ™æ—¶ï¼Œä¸å¯¹è§„åˆ™ä¸­çš„IPæˆ–è€…ç«¯å£è¿›è¡Œåç§°åè§£ï¼Œ-né€‰é¡¹è¡¨ç¤ºä¸è§£æIPåœ°å€ã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">iptables --line-numbers -t è¡¨å -L</span><br></pre></td></tr></table></figure></div>
<p>è¡¨ç¤ºæŸ¥çœ‹è¡¨çš„æ‰€æœ‰è§„åˆ™ï¼Œå¹¶ä¸”æ˜¾ç¤ºè§„åˆ™çš„åºå·ï¼Œâ€“line-numbersé€‰é¡¹è¡¨ç¤ºæ˜¾ç¤ºè§„åˆ™çš„åºå·ï¼Œæ³¨æ„ï¼Œæ­¤é€‰é¡¹ä¸ºé•¿é€‰é¡¹ï¼Œä¸èƒ½ä¸å…¶ä»–çŸ­é€‰é¡¹åˆå¹¶ï¼Œä¸è¿‡æ­¤é€‰é¡¹å¯ä»¥ç®€å†™ä¸ºâ€“lineï¼Œæ³¨æ„ï¼Œç®€å†™åä»ç„¶æ˜¯ä¸¤æ¡æ¨ªæ ï¼Œä»ç„¶æ˜¯é•¿é€‰é¡¹ã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">iptables -t è¡¨å -v -x -L</span><br></pre></td></tr></table></figure></div>
<p>è¡¨ç¤ºæŸ¥çœ‹è¡¨ä¸­çš„æ‰€æœ‰è§„åˆ™ï¼Œå¹¶ä¸”æ˜¾ç¤ºæ›´è¯¦ç»†çš„ä¿¡æ¯(-vé€‰é¡¹)ï¼Œä¸è¿‡ï¼Œè®¡æ•°å™¨ä¸­çš„ä¿¡æ¯æ˜¾ç¤ºä¸ºç²¾ç¡®çš„è®¡æ•°å€¼ï¼Œè€Œä¸æ˜¯æ˜¾ç¤ºä¸ºç»è¿‡å¯è¯»ä¼˜åŒ–çš„è®¡æ•°å€¼ï¼Œ-xé€‰é¡¹è¡¨ç¤ºæ˜¾ç¤ºè®¡æ•°å™¨çš„ç²¾ç¡®å€¼ã€‚</p>
<p>å®é™…ä½¿ç”¨ä¸­ï¼Œä¸ºäº†æ–¹ä¾¿ï¼Œå¾€å¾€ä¼šå°†çŸ­é€‰é¡¹è¿›è¡Œåˆå¹¶ï¼Œæ‰€ä»¥ï¼Œå¦‚æœå°†ä¸Šè¿°é€‰é¡¹éƒ½ç³…åˆåœ¨ä¸€èµ·ï¼Œå¯ä»¥å†™æˆå¦‚ä¸‹å‘½ä»¤ï¼Œæ­¤å¤„ä»¥filterè¡¨ä¸ºä¾‹ã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">iptables --line -t filter -nvxL</span><br></pre></td></tr></table></figure></div>
<p>å½“ç„¶ï¼Œä¹Ÿå¯ä»¥åªæŸ¥çœ‹æŸå¼ è¡¨ä¸­çš„æŸæ¡é“¾ï¼Œæ­¤å¤„ä»¥filterè¡¨çš„INPUTé“¾ä¸ºä¾‹</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">iptables --line -t filter -nvxL INPUT</span><br></pre></td></tr></table></figure></div>
<p>å¥½äº†ï¼Œæ€æ ·ä½¿ç”¨iptableså‘½ä»¤è¿›è¡ŒåŸºæœ¬çš„æŸ¥çœ‹æ“ä½œï¼Œå°±å…ˆæ€»ç»“åˆ°è¿™é‡Œå§ï¼Œä¸‹ä¸€ç¯‡æ–‡ç« ä¼šæ€»ç»“iptablesè§„åˆ™çš„â€å¢ã€åˆ ã€æ”¹â€æ“ä½œï¼Œç›´è¾¾é“¾æ¥å¦‚ä¸‹ï¼š</p>
]]></content>
      <tags>
        <tag>äº‘åŸç”ŸåŸºç¡€ç³»åˆ—</tag>
        <tag>Kubernetesç½‘ç»œ</tag>
      </tags>
  </entry>
  <entry>
    <title>Kubernetesç½‘ç»œç³»åˆ—ä¹‹(äºŒåå…«)iptablesæ‰©å±•æ¨¡å—ä¹‹stateæ‰©å±•</title>
    <url>/2022/06/13/uncatalog/cl4cifaka000gpwr787db5toi/</url>
    <content><![CDATA[<hr>
<span id="more"></span>

<hr>
<p>å½“æˆ‘ä»¬é€šè¿‡httpçš„urlè®¿é—®æŸä¸ªç½‘ç«™çš„ç½‘é¡µæ—¶ï¼Œå®¢æˆ·ç«¯å‘æœåŠ¡ç«¯çš„80ç«¯å£å‘èµ·è¯·æ±‚ï¼ŒæœåŠ¡ç«¯å†é€šè¿‡80ç«¯å£å“åº”æˆ‘ä»¬çš„è¯·æ±‚ï¼Œäºæ˜¯ï¼Œä½œä¸ºå®¢æˆ·ç«¯ï¼Œæˆ‘ä»¬ä¼¼ä¹åº”è¯¥ç†æ‰€åº”å½“çš„æ”¾è¡Œ80ç«¯å£ï¼Œä»¥ä¾¿æœåŠ¡ç«¯å›åº”æˆ‘ä»¬çš„æŠ¥æ–‡å¯ä»¥è¿›å…¥å®¢æˆ·ç«¯ä¸»æœºï¼Œäºæ˜¯ï¼Œæˆ‘ä»¬åœ¨å®¢æˆ·ç«¯æ”¾è¡Œäº†80ç«¯å£ï¼ŒåŒç†ï¼Œå½“æˆ‘ä»¬é€šè¿‡sshå·¥å…·è¿œç¨‹è¿æ¥åˆ°æŸå°æœåŠ¡å™¨æ—¶ï¼Œå®¢æˆ·ç«¯å‘æœåŠ¡ç«¯çš„22å·ç«¯å£å‘èµ·è¯·æ±‚ï¼ŒæœåŠ¡ç«¯å†é€šè¿‡22å·ç«¯å£å“åº”æˆ‘ä»¬çš„è¯·æ±‚ï¼Œäºæ˜¯æˆ‘ä»¬ç†æ‰€åº”å½“çš„æ”¾è¡Œäº†æ‰€æœ‰22å·ç«¯å£ï¼Œä»¥ä¾¿è¿œç¨‹ä¸»æœºçš„å“åº”è¯·æ±‚èƒ½å¤Ÿé€šè¿‡é˜²ç«å¢™ï¼Œä½†æ˜¯ï¼Œä½œä¸ºå®¢æˆ·ç«¯ï¼Œå¦‚æœæˆ‘ä»¬å¹¶æ²¡æœ‰ä¸»åŠ¨å‘80ç«¯å£å‘èµ·è¯·æ±‚ï¼Œä¹Ÿæ²¡æœ‰ä¸»åŠ¨å‘22å·ç«¯å£å‘èµ·è¯·æ±‚ï¼Œé‚£ä¹ˆå…¶ä»–ä¸»æœºé€šè¿‡80ç«¯å£æˆ–è€…22å·ç«¯å£å‘æˆ‘ä»¬å‘é€æ•°æ®æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æ¥æ”¶åˆ°å—ï¼Ÿåº”è¯¥æ˜¯å¯ä»¥çš„ï¼Œå› ä¸ºæˆ‘ä»¬ä¸ºäº†æ”¶åˆ°httpä¸sshçš„å“åº”æŠ¥æ–‡ï¼Œå·²ç»æ”¾è¡Œäº†80ç«¯å£ä¸22å·ç«¯å£ï¼Œæ‰€ä»¥ï¼Œä¸ç®¡æ˜¯â€å“åº”â€æˆ‘ä»¬çš„æŠ¥æ–‡ï¼Œè¿˜æ˜¯â€ä¸»åŠ¨å‘é€â€ç»™æˆ‘ä»¬çš„æŠ¥æ–‡ï¼Œåº”è¯¥éƒ½æ˜¯å¯ä»¥é€šè¿‡è¿™ä¸¤ä¸ªç«¯å£çš„ï¼Œé‚£ä¹ˆä»”ç»†æƒ³æƒ³ï¼Œè¿™æ ·æ˜¯ä¸æ˜¯ä¸å¤ªå®‰å…¨å‘¢ï¼Ÿå¦‚æœæŸäº›ä¸ä½ æ•Œå¯¹çš„äººï¼Œåˆ©ç”¨è¿™äº›ç«¯å£â€ä¸»åŠ¨â€è¿æ¥åˆ°ä½ çš„ä¸»æœºï¼Œä½ è‚¯å®šä¼šä¸çˆ½çš„å§ï¼Œä¸€èˆ¬éƒ½æ˜¯æˆ‘ä»¬ä¸»åŠ¨è¯·æ±‚80ç«¯å£ï¼Œ80ç«¯å£å›åº”æˆ‘ä»¬ï¼Œä½†æ˜¯ä¸€èˆ¬ä¸ä¼šå‡ºç°80ç«¯å£ä¸»åŠ¨è¯·æ±‚æˆ‘ä»¬çš„æƒ…å†µå§ã€‚</p>
<p>ä½ å¿ƒé‡Œå¯èƒ½ä¼šè¿™æ ·æƒ³ï¼šæˆ‘çŸ¥é“å“ªäº›ä¸»æœºæ˜¯å®‰å…¨çš„ï¼Œæˆ‘åªè¦é’ˆå¯¹è¿™äº›å®‰å…¨çš„ä¸»æœºæ”¾è¡Œå¯¹åº”çš„ç«¯å£å°±è¡Œäº†ï¼Œå…¶ä»–IPä¸€å¾‹æ‹’ç»ï¼Œæ¯”å¦‚ï¼Œæˆ‘çŸ¥é“IPä¸º123çš„ä¸»æœºæ˜¯å®‰å…¨çš„ï¼Œæ‰€ä»¥ï¼Œæˆ‘å¯¹123ä¸»æœºå¼€æ”¾äº†22å·ç«¯å£ï¼Œä»¥ä¾¿123ä¸»æœºèƒ½å¤Ÿé€šè¿‡22å·ç«¯å£å“åº”æˆ‘ä»¬çš„sshè¯·æ±‚ï¼Œé‚£ä¹ˆï¼Œå¦‚æœä½ éœ€è¦ç®¡ç†çš„ä¸»æœºè¶Šæ¥è¶Šå¤šå‘¢ï¼Ÿä½ æ˜¯ä¸æ˜¯æ¯æ¬¡éƒ½è¦ä¸ºæ–°çš„ä¸»æœºé…ç½®è¿™äº›è§„åˆ™å‘¢ï¼Ÿå¦‚æœæœ‰30å°ä¸»æœºå‘¢ï¼Ÿå¦‚æœæœ‰300å°ä¸»æœºå‘¢ï¼Ÿ80ç«¯å£å°±æ›´åˆ«æäº†ï¼Œéš¾é“ä½ æ¯æ¬¡è®¿é—®ä¸€ä¸ªæ–°çš„ç½‘å€ï¼Œéƒ½è¦å¯¹è¿™ä¸ªç½‘å€æ·»åŠ ä¿¡ä»»å—ï¼Ÿè¿™æ˜¾ç„¶ä¸å¤ªåˆç†ã€‚</p>
<p>ä½ å¿ƒé‡Œå¯èƒ½åˆä¼šæƒ³ï¼šé’ˆå¯¹å¯¹åº”çš„ç«¯å£ï¼Œæˆ‘ç”¨â€“tcp-flagså»åŒ¹é…tcpæŠ¥æ–‡çš„æ ‡å¿—ä½ï¼ŒæŠŠå¤–æ¥çš„â€ç¬¬ä¸€æ¬¡æ¡æ‰‹â€çš„è¯·æ±‚æ‹’ç»ï¼Œæ˜¯ä¸æ˜¯ä¹Ÿå¯ä»¥å‘¢ï¼Ÿé‚£ä¹ˆå¦‚æœå¯¹æ–¹ä½¿ç”¨çš„æ˜¯UDPåè®®æˆ–è€…ICMPåè®®å‘¢ï¼Ÿä¼¼ä¹æ€»æ˜¯æœ‰ä¸€äº›ä¸å®Œç¾çš„åœ°æ–¹ã€‚</p>
<p>é‚£ä¹ˆæˆ‘ä»¬ä»”ç»†çš„æ€è€ƒä¸€ä¸‹ï¼Œé€ æˆä¸Šè¿°é—®é¢˜çš„â€æ ¹æºâ€åœ¨å“ªé‡Œï¼Œæˆ‘ä»¬ä¸ºäº†è®©â€æä¾›æœåŠ¡æ–¹â€èƒ½å¤Ÿæ­£å¸¸çš„â€å“åº”â€æˆ‘ä»¬çš„è¯·æ±‚ï¼Œäºæ˜¯åœ¨ä¸»æœºä¸Šå¼€æ”¾äº†å¯¹åº”çš„ç«¯å£ï¼Œå¼€æ”¾è¿™äº›ç«¯å£çš„åŒæ—¶ï¼Œä¹Ÿå‡ºç°äº†é—®é¢˜ï¼Œåˆ«äººåˆ©ç”¨è¿™äº›å¼€æ”¾çš„ç«¯å£ï¼Œâ€ä¸»åŠ¨â€çš„æ”»å‡»æˆ‘ä»¬ï¼Œä»–ä»¬å‘é€è¿‡æ¥çš„æŠ¥æ–‡å¹¶ä¸æ˜¯ä¸ºäº†å“åº”æˆ‘ä»¬ï¼Œè€Œæ˜¯ä¸ºäº†ä¸»åŠ¨æ”»å‡»æˆ‘ä»¬ï¼Œå¥½äº†ï¼Œæˆ‘ä»¬ä¼¼ä¹æ‰¾åˆ°äº†é—®é¢˜æ‰€åœ¨ï¼Ÿ</p>
<p>é—®é¢˜å°±æ˜¯ï¼šæ€æ ·åˆ¤æ–­è¿™äº›æŠ¥æ–‡æ˜¯ä¸ºäº†å›åº”æˆ‘ä»¬ä¹‹å‰å‘å‡ºçš„æŠ¥æ–‡ï¼Œè¿˜æ˜¯ä¸»åŠ¨å‘æˆ‘ä»¬å‘é€çš„æŠ¥æ–‡å‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡iptablesçš„stateæ‰©å±•æ¨¡å—è§£å†³ä¸Šè¿°é—®é¢˜ï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦å…ˆäº†è§£ä¸€äº›stateæ¨¡å—çš„ç›¸å…³æ¦‚å¿µï¼Œç„¶åå†å›è¿‡å¤´æ¥è§£å†³ä¸Šè¿°é—®é¢˜ã€‚</p>
<p>ä»å­—é¢ä¸Šç†è§£ï¼Œstateå¯ä»¥è¯‘ä¸ºçŠ¶æ€ï¼Œä½†æ˜¯æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨ä¸€ä¸ªé«˜å¤§ä¸Šçš„è¯å»è§£é‡Šå®ƒï¼Œstateæ¨¡å—å¯ä»¥è®©iptableså®ç°â€è¿æ¥è¿½è¸ªâ€æœºåˆ¶ã€‚</p>
<p>é‚£ä¹ˆï¼Œæ—¢ç„¶æ˜¯â€è¿æ¥è¿½è¸ªâ€ï¼Œåˆ™å¿…ç„¶è¦æœ‰â€è¿æ¥â€ã€‚</p>
<p>å’±ä»¬å°±æ¥èŠèŠä»€ä¹ˆæ˜¯è¿æ¥å§ï¼Œä¸€è¯´åˆ°è¿æ¥ï¼Œä½ å¯èƒ½ä¼šä¸‹æ„è¯†çš„æƒ³åˆ°tcpè¿æ¥ï¼Œä½†æ˜¯ï¼Œå¯¹äºstateæ¨¡å—è€Œè¨€çš„â€è¿æ¥â€å¹¶ä¸èƒ½ä¸tcpçš„â€è¿æ¥â€ç”»ç­‰å·ï¼Œåœ¨TCP/IPåè®®ç°‡ä¸­ï¼ŒUDPå’ŒICMPæ˜¯æ²¡æœ‰æ‰€è°“çš„è¿æ¥çš„ï¼Œä½†æ˜¯å¯¹äºstateæ¨¡å—æ¥è¯´ï¼ŒtcpæŠ¥æ–‡ã€udpæŠ¥æ–‡ã€icmpæŠ¥æ–‡éƒ½æ˜¯æœ‰è¿æ¥çŠ¶æ€çš„ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·è®¤ä¸ºï¼Œå¯¹äºstateæ¨¡å—è€Œè¨€ï¼Œåªè¦ä¸¤å°æœºå™¨åœ¨â€ä½ æ¥æˆ‘å¾€â€çš„é€šä¿¡ï¼Œå°±ç®—å»ºç«‹èµ·äº†è¿æ¥ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º</p>
<p><img src="/2022/06/13/uncatalog/cl4cifaka000gpwr787db5toi/1.png" alt="image"></p>
<p>è€ŒæŠ¥æ–‡åœ¨è¿™ä¸ªæ‰€è°“çš„é“¾æ¥ä¸­æ˜¯ä»€ä¹ˆçŠ¶æ€çš„å‘¢ï¼Ÿè¿™æ˜¯æˆ‘ä»¬åé¢è®¨è®ºçš„è¯é¢˜ã€‚</p>
<p>å¯¹äºstateæ¨¡å—çš„è¿æ¥è€Œè¨€ï¼Œâ€è¿æ¥â€å…¶ä¸­çš„æŠ¥æ–‡å¯ä»¥åˆ†ä¸º5ç§çŠ¶æ€ï¼ŒæŠ¥æ–‡çŠ¶æ€å¯ä»¥ä¸ºNEWã€ESTABLISHEDã€RELATEDã€INVALIDã€UNTRACKED</p>
<p>é‚£ä¹ˆä¸Šè¿°æŠ¥æ–‡çš„çŠ¶æ€éƒ½ä»£è¡¨ä»€ä¹ˆå«ä¹‰å‘¢ï¼Ÿæˆ‘ä»¬å…ˆæ¥å¤§æ¦‚çš„äº†è§£ä¸€ä¸‹æ¦‚å¿µï¼Œç„¶åå†ç»“åˆç¤ºä¾‹è¯´æ˜ã€‚</p>
<p>æ³¨æ„ï¼šå¦‚ä¸‹æŠ¥æ–‡çŠ¶æ€éƒ½æ˜¯å¯¹äºstateæ¨¡å—æ¥è¯´çš„ã€‚</p>
<p>NEWï¼šè¿æ¥ä¸­çš„ç¬¬ä¸€ä¸ªåŒ…ï¼ŒçŠ¶æ€å°±æ˜¯NEWï¼Œæˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºæ–°è¿æ¥çš„ç¬¬ä¸€ä¸ªåŒ…çš„çŠ¶æ€ä¸ºNEWã€‚</p>
<p>ESTABLISHEDï¼šæˆ‘ä»¬å¯ä»¥æŠŠNEWçŠ¶æ€åŒ…åé¢çš„åŒ…çš„çŠ¶æ€ç†è§£ä¸ºESTABLISHEDï¼Œè¡¨ç¤ºè¿æ¥å·²å»ºç«‹ã€‚</p>
<p>æˆ–è®¸ç”¨å›¾è¯´è¯æ›´å®¹æ˜“è¢«äººç†è§£</p>
<p><img src="/2022/06/13/uncatalog/cl4cifaka000gpwr787db5toi/2.png" alt="image"></p>
<p>RELATEDï¼šä»å­—é¢ä¸Šç†è§£RELATEDè¯‘ä¸ºå…³ç³»ï¼Œä½†æ˜¯è¿™æ ·ä»ç„¶ä¸å®¹æ˜“ç†è§£ï¼Œæˆ‘ä»¬ä¸¾ä¸ªä¾‹å­ã€‚</p>
<p>æ¯”å¦‚FTPæœåŠ¡ï¼ŒFTPæœåŠ¡ç«¯ä¼šå»ºç«‹ä¸¤ä¸ªè¿›ç¨‹ï¼Œä¸€ä¸ªå‘½ä»¤è¿›ç¨‹ï¼Œä¸€ä¸ªæ•°æ®è¿›ç¨‹ã€‚</p>
<p>å‘½ä»¤è¿›ç¨‹è´Ÿè´£æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯ä¹‹é—´çš„å‘½ä»¤ä¼ è¾“ï¼ˆæˆ‘ä»¬å¯ä»¥æŠŠè¿™ä¸ªä¼ è¾“è¿‡ç¨‹ç†è§£æˆstateä¸­æ‰€è°“çš„ä¸€ä¸ªâ€è¿æ¥â€ï¼Œæš‚ç§°ä¸ºâ€å‘½ä»¤è¿æ¥â€ï¼‰ã€‚</p>
<p>æ•°æ®è¿›ç¨‹è´Ÿè´£æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯ä¹‹é—´çš„æ•°æ®ä¼ è¾“ ( æˆ‘ä»¬æŠŠè¿™ä¸ªè¿‡ç¨‹æš‚ç§°ä¸ºâ€æ•°æ®è¿æ¥â€ )ã€‚</p>
<p>ä½†æ˜¯å…·ä½“ä¼ è¾“å“ªäº›æ•°æ®ï¼Œæ˜¯ç”±å‘½ä»¤å»æ§åˆ¶çš„ï¼Œæ‰€ä»¥ï¼Œâ€æ•°æ®è¿æ¥â€ä¸­çš„æŠ¥æ–‡ä¸â€å‘½ä»¤è¿æ¥â€æ˜¯æœ‰â€å…³ç³»â€çš„ã€‚</p>
<p>é‚£ä¹ˆï¼Œâ€æ•°æ®è¿æ¥â€ä¸­çš„æŠ¥æ–‡å¯èƒ½å°±æ˜¯RELATEDçŠ¶æ€ï¼Œå› ä¸ºè¿™äº›æŠ¥æ–‡ä¸â€å‘½ä»¤è¿æ¥â€ä¸­çš„æŠ¥æ–‡æœ‰å…³ç³»ã€‚</p>
<p>(æ³¨ï¼šå¦‚æœæƒ³è¦å¯¹ftpè¿›è¡Œè¿æ¥è¿½è¸ªï¼Œéœ€è¦å•ç‹¬åŠ è½½å¯¹åº”çš„å†…æ ¸æ¨¡å—nf_conntrack_ftpï¼Œå¦‚æœæƒ³è¦è‡ªåŠ¨åŠ è½½ï¼Œå¯ä»¥é…ç½®/etc/sysconfig/iptables-configæ–‡ä»¶)</p>
<p>INVALIDï¼šå¦‚æœä¸€ä¸ªåŒ…æ²¡æœ‰åŠæ³•è¢«è¯†åˆ«ï¼Œæˆ–è€…è¿™ä¸ªåŒ…æ²¡æœ‰ä»»ä½•çŠ¶æ€ï¼Œé‚£ä¹ˆè¿™ä¸ªåŒ…çš„çŠ¶æ€å°±æ˜¯INVALIDï¼Œæˆ‘ä»¬å¯ä»¥ä¸»åŠ¨å±è”½çŠ¶æ€ä¸ºINVALIDçš„æŠ¥æ–‡ã€‚</p>
<p>UNTRACKEDï¼šæŠ¥æ–‡çš„çŠ¶æ€ä¸ºuntrackedæ—¶ï¼Œè¡¨ç¤ºæŠ¥æ–‡æœªè¢«è¿½è¸ªï¼Œå½“æŠ¥æ–‡çš„çŠ¶æ€ä¸ºUntrackedæ—¶é€šå¸¸è¡¨ç¤ºæ— æ³•æ‰¾åˆ°ç›¸å…³çš„è¿æ¥ã€‚</p>
<p>ä¸Šè¿°5ç§çŠ¶æ€çš„è¯¦ç»†è§£é‡Šå¯ä»¥å‚è€ƒ<a href="http://www.iptables.info/en/connection-state.html">User-land states</a>ç« èŠ‚</p>
<p>å¥½äº†ï¼Œæˆ‘ä»¬å·²ç»å¤§è‡´äº†è§£äº†stateæ¨¡å—ä¸­æ‰€å®šä¹‰çš„5ç§çŠ¶æ€ï¼Œé‚£ä¹ˆç°åœ¨ï¼Œæˆ‘ä»¬å›è¿‡å¤´æƒ³æƒ³åˆšæ‰çš„é—®é¢˜ã€‚</p>
<p>åˆšæ‰é—®é¢˜çš„æ ¹æºå°±æ˜¯ï¼šæ€æ ·åˆ¤æ–­æŠ¥æ–‡æ˜¯å¦æ˜¯ä¸ºäº†å›åº”ä¹‹å‰å‘å‡ºçš„æŠ¥æ–‡ã€‚</p>
<p>åˆšæ‰ä¸¾ä¾‹ä¸­çš„é—®é¢˜å³å¯ä½¿ç”¨stateæ‰©å±•æ¨¡å—è§£å†³ï¼Œæˆ‘ä»¬åªè¦æ”¾è¡ŒçŠ¶æ€ä¸ºESTABLISHEDçš„æŠ¥æ–‡å³å¯ï¼Œå› ä¸ºå¦‚æœæŠ¥æ–‡çš„çŠ¶æ€ä¸ºESTABLISHEDï¼Œé‚£ä¹ˆæŠ¥æ–‡è‚¯å®šæ˜¯ä¹‹å‰å‘å‡ºçš„æŠ¥æ–‡çš„å›åº”ï¼Œå¦‚æœä½ è¿˜ä¸æ”¾å¿ƒï¼Œå¯ä»¥å°†çŠ¶æ€ä¸ºRELATEDæˆ–ESTABLISHEDçš„æŠ¥æ–‡éƒ½æ”¾è¡Œï¼Œè¿™æ ·ï¼Œå°±è¡¨ç¤ºåªæœ‰å›åº”æˆ‘ä»¬çš„æŠ¥æ–‡èƒ½å¤Ÿé€šè¿‡é˜²ç«å¢™ï¼Œå¦‚æœæ˜¯åˆ«äººä¸»åŠ¨å‘é€è¿‡æ¥çš„æ–°çš„æŠ¥æ–‡ï¼Œåˆ™æ— æ³•é€šè¿‡é˜²ç«å¢™ï¼Œç¤ºä¾‹å¦‚ä¸‹ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifaka000gpwr787db5toi/3.png" alt="image"></p>
<p>å½“å‰ä¸»æœºIPä¸º104ï¼Œå½“æ”¾è¡ŒESTABLISHEDä¸RELATEDçŠ¶æ€çš„åŒ…ä»¥åï¼Œå¹¶æ²¡æœ‰å½±å“é€šè¿‡æœ¬æœºè¿œç¨‹sshåˆ°IPä¸º77çš„ä¸»æœºä¸Šï¼Œä½†æ˜¯æ— æ³•ä»77ä¸Šä½¿ç”¨22ç«¯å£ä¸»åŠ¨è¿æ¥åˆ°104ä¸Šã€‚</p>
<p>å¯¹äºå…¶ä»–ç«¯å£ä¸IPæ¥è¯´ï¼Œä¹Ÿæ˜¯ç›¸åŒçš„ï¼Œå¯ä»¥ä»104ä¸»åŠ¨å‘é€æŠ¥æ–‡ï¼Œå¹¶ä¸”èƒ½å¤Ÿæ”¶åˆ°å“åº”æŠ¥æ–‡ï¼Œä½†æ˜¯å…¶ä»–ä¸»æœºå¹¶ä¸èƒ½ä¸»åŠ¨å‘104å‘èµ·è¯·æ±‚ã€‚</p>
<p>å¥½äº†ï¼Œstateæ¨¡å—å°±æ€»ç»“åˆ°è¿™é‡Œï¼Œå¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¤Ÿå¯¹ä½ æœ‰æ‰€å¸®åŠ©ã€‚</p>
]]></content>
      <tags>
        <tag>äº‘åŸç”ŸåŸºç¡€ç³»åˆ—</tag>
        <tag>Kubernetesç½‘ç»œ</tag>
      </tags>
  </entry>
  <entry>
    <title>Kubernetesç½‘ç»œç³»åˆ—ä¹‹(äºŒåå…­)iptablesæ‰©å±•åŒ¹é…æ¡ä»¶ä¹‹[â€“tcp-flags]</title>
    <url>/2022/06/13/uncatalog/cl4cifakc000ipwr7bhs4dux2/</url>
    <content><![CDATA[<hr>
<span id="more"></span>

<hr>
<p>å¦‚æœä½ çœ‹è¿‡å‰æ–‡ï¼Œé‚£ä¹ˆä½ ä¸€å®šçŸ¥é“ï¼Œå‰æ–‡å·²ç»å¯¹â€tcpæ‰©å±•æ¨¡å—â€åšè¿‡æ€»ç»“ï¼Œä½†æ˜¯åªæ€»ç»“äº†tcpæ‰©å±•æ¨¡å—ä¸­çš„â€â€“sportâ€ä¸â€â€“dportâ€é€‰é¡¹ï¼Œå¹¶æ²¡æœ‰æ€»ç»“â€â€“tcp-flagsâ€é€‰é¡¹ï¼Œé‚£ä¹ˆæ­¤å¤„ï¼Œæˆ‘ä»¬å°±æ¥è®¤è¯†ä¸€ä¸‹tcpæ‰©å±•æ¨¡å—ä¸­çš„â€â€“tcp-flagsâ€ã€‚</p>
<p>æ³¨ï¼šé˜…è¯»è¿™ç¯‡æ–‡ç« ä¹‹å‰ï¼Œéœ€è¦å¯¹tcpåè®®çš„åŸºç¡€çŸ¥è¯†æœ‰ä¸€å®šçš„äº†è§£ï¼Œæ¯”å¦‚ï¼štcpå¤´çš„ç»“æ„ã€tcpä¸‰æ¬¡æ¡æ‰‹çš„è¿‡ç¨‹ã€‚</p>
<p>è§åçŸ¥ä¹‰ï¼Œâ€â€“tcp-flagsâ€æŒ‡çš„å°±æ˜¯tcpå¤´ä¸­çš„æ ‡å¿—ä½ï¼Œçœ‹æ¥ï¼Œåœ¨ä½¿ç”¨iptablesæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ­¤æ‰©å±•åŒ¹é…æ¡ä»¶ï¼Œå»åŒ¹é…tcpæŠ¥æ–‡çš„å¤´éƒ¨çš„æ ‡è¯†ä½ï¼Œç„¶åæ ¹æ®æ ‡è¯†ä½çš„å®é™…æƒ…å†µå®ç°è®¿é—®æ§åˆ¶çš„åŠŸèƒ½ã€‚</p>
<p>æ—¢ç„¶è¯´åˆ°äº†tcpå¤´ä¸­çš„æ ‡å¿—ä½ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æ¥å›é¡¾ä¸€ä¸‹tcpå¤´çš„ç»“æ„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚<br><img src="/2022/06/13/uncatalog/cl4cifakc000ipwr7bhs4dux2/1.png" alt="image"></p>
<p>åœ¨ä½¿ç”¨iptablesæ—¶ï¼Œä½¿ç”¨tcpæ‰©å±•æ¨¡å—çš„â€â€“tcp-flagsâ€é€‰é¡¹ï¼Œå³å¯å¯¹ä¸Šå›¾ä¸­çš„æ ‡å¿—ä½è¿›è¡ŒåŒ¹é…ï¼Œåˆ¤æ–­æŒ‡å®šçš„æ ‡å¿—ä½çš„å€¼æ˜¯å¦ä¸ºâ€1â€³ï¼Œè€Œtcp headerçš„ç»“æ„ä¸æ˜¯æˆ‘ä»¬ä»Šå¤©è®¨è®ºçš„é‡ç‚¹ï¼Œæˆ‘ä»¬ç»§ç»­èŠtcpçš„æ ‡è¯†ä½ï¼Œåœ¨tcpåè®®å»ºç«‹è¿æ¥çš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦å…ˆè¿›è¡Œä¸‰æ¬¡æ¡æ‰‹ï¼Œè€Œä¸‰æ¬¡æ¡æ‰‹å°±è¦ä¾é tcpå¤´ä¸­çš„æ ‡å¿—ä½è¿›è¡Œã€‚</p>
<p>ä¸ºäº†æ›´åŠ å…·è±¡åŒ–çš„æè¿°è¿™ä¸ªè¿‡ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥æŠ“åŒ…æŸ¥çœ‹sshå»ºç«‹è¿æ¥çš„è¿‡ç¨‹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼ˆä½¿ç”¨wiresharkåœ¨sshå®¢æˆ·ç«¯æŠ“åŒ…ï¼Œè·Ÿè¸ªå¯¹åº”çš„tcpæµï¼‰ï¼š</p>
<p><img src="/2022/06/13/uncatalog/cl4cifakc000ipwr7bhs4dux2/2.png" alt="image"></p>
<p>ä¸Šå›¾ä¸ºtcpä¸‰æ¬¡æ¡æ‰‹ä¸­çš„ç¬¬ä¸€æ¬¡æ¡æ‰‹ï¼Œå®¢æˆ·ç«¯ï¼ˆIPä¸º98ï¼‰ä½¿ç”¨æœ¬åœ°çš„éšæœºç«¯å£54808å‘æœåŠ¡ç«¯ï¼ˆIPä¸º137ï¼‰å‘èµ·è¿æ¥è¯·æ±‚ï¼Œtcpå¤´çš„æ ‡å¿—ä½ä¸­ï¼Œåªæœ‰SYNä½è¢«æ ‡è¯†ä¸º1ï¼Œå…¶ä»–æ ‡å¿—ä½å‡ä¸º0ã€‚</p>
<p>åœ¨ä¸Šå›¾çš„ä¸‹æ–¹å¯ä»¥çœ‹åˆ°â€[TCP Flags: Â·Â·Â·Â·Â·Â·Â·Â·Â·Â·SÂ·]â€ï¼Œå…¶ä¸­çš„â€Sâ€å°±è¡¨ç¤ºSYNä½ï¼Œæ•´ä½“è¡¨ç¤ºåªæœ‰SYNä½ä¸º1ã€‚</p>
<p>ä¸Šå›¾ä¸ºtcpä¸‰æ¬¡æ¡æ‰‹ä¸­ç¬¬ä¸€æ¬¡æ¡æ‰‹çš„tcpå¤´ä¸­çš„æ ‡å¿—ä½ï¼Œä¸‹å›¾æ˜¯ç¬¬äºŒæ¬¡æ¡æ‰‹çš„ï¼ŒæœåŠ¡ç«¯å›åº”åˆšæ‰çš„è¯·æ±‚ï¼Œå°†è‡ªå·±çš„tcpå¤´çš„SYNæ ‡å¿—ä½ä¹Ÿè®¾ç½®ä¸º1ï¼ŒåŒæ—¶å°†ACKæ ‡å¿—ä½ä¹Ÿè®¾ç½®ä¸º1ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifakc000ipwr7bhs4dux2/3.png" alt="image"></p>
<p>ä¸Šå›¾ä¸­çš„ä¸‹æ–¹æ˜¾ç¤ºçš„æ ‡å¿—ä½åˆ—è¡¨ä¹Ÿå˜æˆäº†ï¼Œ[TCP Flags: Â·Â·Â·Â·Â·Â·Â·AÂ·Â·SÂ·]ï¼Œè¡¨ç¤ºåªæœ‰ACKæ ‡å¿—ä½ä¸SYNæ ‡å¿—ä½ä¸º1ï¼Œå¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œç¬¬ä¸‰æ¬¡æ¡æ‰‹æˆ‘å°±ä¸å†æˆªå›¾äº†ï¼Œè¯´åˆ°è¿™é‡Œï¼Œå°±å·²ç»èƒ½å¤Ÿå¼•å‡ºæˆ‘ä»¬ä»Šå¤©è¦è¯´çš„è¯é¢˜äº†ï¼Œå°±æ˜¯â€â€“tcp-flagsâ€é€‰é¡¹ï¼Œå‡è®¾ï¼Œæˆ‘ç°åœ¨æƒ³è¦åŒ¹é…åˆ°ä¸Šæ–‡ä¸­æåˆ°çš„â€ç¬¬ä¸€æ¬¡æ¡æ‰‹â€çš„æŠ¥æ–‡ï¼Œåˆ™å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š</p>
<p><img src="/2022/06/13/uncatalog/cl4cifakc000ipwr7bhs4dux2/4.png" alt="image"></p>
<p>ä¸Šå›¾ä¸­ï¼Œâ€-m tcp â€“dport 22â€³çš„å«ä¹‰åœ¨å‰æ–‡ä¸­å·²ç»æ€»ç»“è¿‡ï¼Œè¡¨ç¤ºä½¿ç”¨tcpæ‰©å±•æ¨¡å—ï¼ŒæŒ‡å®šç›®æ ‡ç«¯å£ä¸º22å·ç«¯å£(sshé»˜è®¤ç«¯å£)ï¼Œâ€â€“tcp-flagsâ€å°±æ˜¯æˆ‘ä»¬ä»Šå¤©è¦è®¨è®ºçš„æ‰©å±•åŒ¹é…æ¡ä»¶ï¼Œç”¨äºåŒ¹é…æŠ¥æ–‡tcpå¤´éƒ¨çš„æ ‡å¿—ä½ï¼Œâ€SYN,ACK,FIN,RST,URG,PSH SYNâ€æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿè¿™ä¸²å­—ç¬¦å°±æ˜¯ç”¨äºé…ç½®æˆ‘ä»¬è¦åŒ¹é…çš„æ ‡å¿—ä½çš„ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè¿™ä¸²å­—ç¬¦æ‹†æˆä¸¤éƒ¨åˆ†å»ç†è§£ï¼Œç¬¬ä¸€éƒ¨åˆ†ä¸ºâ€SYN,ACK,FIN,RST,URG,PSHâ€ï¼Œç¬¬äºŒéƒ¨åˆ†ä¸ºâ€SYNâ€ã€‚</p>
<p>ç¬¬ä¸€éƒ¨åˆ†è¡¨ç¤ºï¼šæˆ‘ä»¬éœ€è¦åŒ¹é…æŠ¥æ–‡tcpå¤´ä¸­çš„å“ªäº›æ ‡å¿—ä½ï¼Œé‚£ä¹ˆä¸Šä¾‹çš„é…ç½®è¡¨ç¤ºï¼Œæˆ‘ä»¬éœ€è¦åŒ¹é…æŠ¥æ–‡tcpå¤´ä¸­çš„6ä¸ªæ ‡å¿—ä½ï¼Œè¿™6ä¸ªæ ‡å¿—ä½åˆ†åˆ«ä¸ºä¸ºâ€SYNã€ACKã€FINã€RSTã€URGã€PSHâ€ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠè¿™ä¸€éƒ¨åˆ†ç†è§£æˆéœ€è¦åŒ¹é…çš„æ ‡å¿—ä½åˆ—è¡¨ã€‚</p>
<p>ç¬¬äºŒéƒ¨åˆ†è¡¨ç¤ºï¼šç¬¬ä¸€éƒ¨åˆ†çš„æ ‡å¿—ä½åˆ—è¡¨ä¸­ï¼Œå“ªäº›æ ‡å¿—ä½å¿…é¡»ä¸º1ï¼Œä¸Šä¾‹ä¸­ï¼Œç¬¬äºŒéƒ¨åˆ†ä¸ºSYNï¼Œåˆ™è¡¨ç¤ºï¼Œç¬¬ä¸€éƒ¨åˆ†éœ€è¦åŒ¹é…çš„æ ‡å¿—ä½åˆ—è¡¨ä¸­ï¼ŒSYNæ ‡å¿—ä½çš„å€¼å¿…é¡»ä¸º1ï¼Œå…¶ä»–æ ‡å¿—ä½å¿…é¡»ä¸º0ã€‚</p>
<p>æ‰€ä»¥ï¼Œä¸Šä¾‹ä¸­çš„â€SYN,ACK,FIN,RST,URG,PSH SYNâ€è¡¨ç¤ºï¼Œéœ€è¦åŒ¹é…æŠ¥æ–‡tcpå¤´ä¸­çš„â€SYNã€ACKã€FINã€RSTã€URGã€PSHâ€è¿™äº›æ ‡å¿—ä½ï¼Œå…¶ä¸­SYNæ ‡å¿—ä½å¿…é¡»ä¸º1ï¼Œå…¶ä»–çš„5ä¸ªæ ‡å¿—ä½å¿…é¡»ä¸º0ï¼Œè¿™ä¸ä¸Šæ–‡ä¸­wiresharkæŠ“åŒ…æ—¶çš„æƒ…å†µç›¸åŒï¼Œæ­£æ˜¯tcpä¸‰æ¬¡æ¡æ‰‹æ—¶ç¬¬ä¸€æ¬¡æ¡æ‰‹æ—¶çš„æƒ…å†µï¼Œä¸Šæ–‡ä¸­ç¬¬ä¸€æ¬¡æ¡æ‰‹çš„æŠ¥æ–‡çš„tcpå¤´ä¸­çš„æ ‡å¿—ä½å¦‚ä¸‹ï¼š</p>
<p><img src="/2022/06/13/uncatalog/cl4cifakc000ipwr7bhs4dux2/5.png" alt="image"></p>
<p>å…¶å®ï¼Œâ€“tcp-flagsçš„è¡¨ç¤ºæ–¹æ³•ä¸wiresharkçš„è¡¨ç¤ºæ–¹æ³•æœ‰å¼‚æ›²åŒå·¥ä¹‹å¦™ï¼Œåªä¸è¿‡ï¼Œwiresharkä¸­ï¼Œæ ‡å¿—ä½ä¸º0çš„ç”¨â€ç‚¹â€è¡¨ç¤ºï¼Œæ ‡å¿—ä½ä¸º1çš„ç”¨å¯¹åº”å­—æ¯è¡¨ç¤ºï¼Œåœ¨â€“tcp-flagsä¸­ï¼Œéœ€è¦å…ˆæŒ‡æ˜éœ€è¦åŒ¹é…å“ªäº›æ ‡å¿—ä½ï¼Œç„¶åå†æŒ‡æ˜è¿™äº›æ ‡å¿—ä½ä¸­ï¼Œå“ªäº›å¿…é¡»ä¸º1ï¼Œå‰©ä½™çš„éƒ½å¿…é¡»ä¸º0ã€‚</p>
<p>é‚£ä¹ˆï¼Œèªæ˜å¦‚ä½ ä¸€å®šæƒ³åˆ°äº†ï¼Œå¦‚æœæˆ‘æƒ³è¦åŒ¹é…tcpå¤´ä¸­çš„ç¬¬äºŒæ¬¡æ¡æ‰‹æ—¶çš„æ ‡å¿—ä½çš„æƒ…å†µï¼Œè¯¥æ€ä¹ˆè¡¨ç¤ºå‘¢ï¼Ÿ</p>
<p>ç¤ºä¾‹å¦‚ä¸‹ï¼ˆæ­¤å¤„çœç•¥å¯¹æºåœ°å€ä¸ç›®æ ‡åœ°å€çš„åŒ¹é…ï¼Œé‡ç‚¹åœ¨äºå¯¹tcp-flagsçš„ç¤ºä¾‹ï¼‰</p>
<p><img src="/2022/06/13/uncatalog/cl4cifakc000ipwr7bhs4dux2/6.png" alt="image"></p>
<p>ä¸Šå›¾ä¸­ï¼Œç¬¬ä¸€æ¡å‘½ä»¤åŒ¹é…åˆ°çš„æŠ¥æ–‡æ˜¯ç¬¬ä¸€æ¬¡æ¡æ‰‹çš„æŠ¥æ–‡ï¼Œç¬¬äºŒæ¡å‘½ä»¤åŒ¹é…åˆ°çš„æŠ¥æ–‡æ˜¯ç¬¬äºŒæ¬¡æ¡æ‰‹çš„æŠ¥æ–‡ã€‚</p>
<p>ç»¼ä¸Šæ‰€è¿°ï¼Œåªè¦æˆ‘ä»¬èƒ½å¤Ÿçµæ´»çš„é…ç½®ä¸Šä¾‹ä¸­çš„æ ‡å¿—ä½ï¼Œå³å¯åŒ¹é…åˆ°æ›´å¤šçš„åº”ç”¨åœºæ™¯ä¸­ã€‚</p>
<p>å…¶å®ï¼Œä¸Šä¾‹ä¸­çš„ä¸¤æ¡å‘½ä»¤è¿˜å¯ä»¥ç®€å†™ä¸ºå¦‚ä¸‹æ¨¡æ ·</p>
<p><img src="/2022/06/13/uncatalog/cl4cifakc000ipwr7bhs4dux2/7.png" alt="image"></p>
<p>æ²¡é”™ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ALLè¡¨ç¤ºâ€SYN,ACK,FIN,RST,URG,PSHâ€ã€‚</p>
<p>å…¶å®ï¼Œtcpæ‰©å±•æ¨¡å—è¿˜ä¸ºæˆ‘ä»¬ä¸“é—¨æä¾›äº†ä¸€ä¸ªé€‰é¡¹ï¼Œå¯ä»¥åŒ¹é…ä¸Šæ–‡ä¸­æåˆ°çš„â€ç¬¬ä¸€æ¬¡æ¡æ‰‹â€ï¼Œé‚£å°±æ˜¯â€“syné€‰é¡¹</p>
<p>ä½¿ç”¨â€â€“synâ€é€‰é¡¹ç›¸å½“äºä½¿ç”¨â€â€“tcp-flags SYN,RST,ACK,FIN  SYNâ€ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¯ä»¥ä½¿ç”¨â€â€“synâ€é€‰é¡¹å»åŒ¹é…tcpæ–°å»ºè¿æ¥çš„è¯·æ±‚æŠ¥æ–‡ã€‚</p>
<p>ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<p><img src="/2022/06/13/uncatalog/cl4cifakc000ipwr7bhs4dux2/8.png" alt="image"></p>
<p>å°ç»“<br>ç»“åˆä¹‹å‰çš„æ–‡ç« ï¼Œæˆ‘ä»¬æŠŠtcpæ¨¡å—çš„å¸¸ç”¨æ‰©å±•åŒ¹é…æ¡ä»¶å†æ€»ç»“ä¸€éï¼Œæ–¹ä¾¿ä»¥åå›é¡¾ã€‚</p>
<p>tcpæ‰©å±•æ¨¡å—å¸¸ç”¨çš„æ‰©å±•åŒ¹é…æ¡ä»¶å¦‚ä¸‹ï¼š</p>
<p>â€“sport<br>ç”¨äºåŒ¹é…tcpåè®®æŠ¥æ–‡çš„æºç«¯å£ï¼Œå¯ä»¥ä½¿ç”¨å†’å·æŒ‡å®šä¸€ä¸ªè¿ç»­çš„ç«¯å£èŒƒå›´</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">ç¤ºä¾‹</span></span><br><span class="line">iptables -t filter -I OUTPUT -d 192.168.1.146 -p tcp -m tcp --sport 22 -j REJECT</span><br><span class="line">iptables -t filter -I OUTPUT -d 192.168.1.146 -p tcp -m tcp --sport 22:25 -j REJECT</span><br><span class="line">iptables -t filter -I OUTPUT -d 192.168.1.146 -p tcp -m tcp ! --sport 22 -j ACCEPT</span><br></pre></td></tr></table></figure></div>


<p>â€“dport<br>ç”¨äºåŒ¹é…tcpåè®®æŠ¥æ–‡çš„ç›®æ ‡ç«¯å£ï¼Œå¯ä»¥ä½¿ç”¨å†’å·æŒ‡å®šä¸€ä¸ªè¿ç»­çš„ç«¯å£èŒƒå›´</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">ç¤ºä¾‹</span></span><br><span class="line">iptables -t filter -I INPUT -s 192.168.1.146 -p tcp -m tcp --dport 22:25 -j REJECT</span><br><span class="line">iptables -t filter -I INPUT -s 192.168.1.146 -p tcp -m tcp --dport :22 -j REJECT</span><br><span class="line">iptables -t filter -I INPUT -s 192.168.1.146 -p tcp -m tcp --dport 80: -j REJECT</span><br></pre></td></tr></table></figure></div>


<p>â€“tcp-flags<br>ç”¨äºåŒ¹é…æŠ¥æ–‡çš„tcpå¤´çš„æ ‡å¿—ä½</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">ç¤ºä¾‹</span></span><br><span class="line">iptables -t filter -I INPUT -p tcp -m tcp --dport 22 --tcp-flags SYN,ACK,FIN,RST,URG,PSH SYN -j REJECT</span><br><span class="line">iptables -t filter -I OUTPUT -p tcp -m tcp --sport 22 --tcp-flags SYN,ACK,FIN,RST,URG,PSH SYN,ACK -j REJECT</span><br><span class="line">iptables -t filter -I INPUT -p tcp -m tcp --dport 22 --tcp-flags ALL SYN -j REJECT</span><br><span class="line">iptables -t filter -I OUTPUT -p tcp -m tcp --sport 22 --tcp-flags ALL SYN,ACK -j REJECT</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>â€“syn<br>ç”¨äºåŒ¹é…tcpæ–°å»ºè¿æ¥çš„è¯·æ±‚æŠ¥æ–‡ï¼Œç›¸å½“äºä½¿ç”¨â€â€“tcp-flags SYN,RST,ACK,FIN  SYNâ€</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">ç¤ºä¾‹</span></span><br><span class="line">iptables -t filter -I INPUT -p tcp -m tcp --dport 22 --syn -j REJECT</span><br></pre></td></tr></table></figure></div>]]></content>
      <tags>
        <tag>äº‘åŸç”ŸåŸºç¡€ç³»åˆ—</tag>
        <tag>Kubernetesç½‘ç»œ</tag>
      </tags>
  </entry>
  <entry>
    <title>äº‘åŸç”Ÿç³»åˆ—æ–‡ç« ç›®å½•é¡µ</title>
    <url>/2022/06/13/uncatalog/cl4cifal9000rpwr7ffrw6e1h/</url>
    <content><![CDATA[<hr>
<span id="more"></span>
<font size="1">

<blockquote>
<p>åœ¨Kuberneteså·²ç»æˆä¸ºäº‘åŸç”Ÿä»£åè¯çš„ä»Šå¤©ï¼Œå¸‚é¢ä¸Šä»‹ç»Kubernetesçš„ä¹¦ç±å·²ç»å¾ˆå¤šï¼Œç„¶è€Œé™äºç¯‡å¹…ã€ æœ¯ä¸šæœ‰ä¸“æ”»å’ŒKubernetesæ¶‰åŠçŸ¥è¯†é¢è¿‡äºåºå¤§ç­‰è¯¸å¤šä¸»å®¢è§‚å› ç´ ï¼ŒåŒ…æ‹¬ã€ŠKubernetesæƒå¨æŒ‡å—ï¼šä»Dockeråˆ°Kuberneteså®è·µå…¨æ¥è§¦ã€‹åœ¨å†…ï¼Œè‡³ä»Šæ²¡æœ‰å‡ºç°ä¸€å¥—æˆ–è€…ä¸€ç³»åˆ—èƒ½å¤Ÿè®©åˆå­¦è€…ï¼Œç‰¹åˆ«æ˜¯äº‘åŸç”Ÿå¼€å‘è€…ï¼Œä»å…¥é—¨åˆ°è¿›é˜¶å†åˆ°å…¥åœŸçš„æ•™ç¨‹ï¼Œè¿™å°±é€ æˆäº†ä¼—å¤šåˆå­¦è€…ï¼Œåœ¨æŸ¥æ‰¾èµ„æ–™ç”±ç‚¹åˆ°é¢çš„å­¦ä¹ è¿‡ç¨‹ä¸­èµ°ä¸Šäº†ä»å…¥é—¨åˆ°æ”¾å¼ƒçš„é“è·¯ã€‚<br>ç„¶è€Œï¼Œå¯¹äºä»¥ä¸Šç°è±¡ï¼Œå¹¶ä¸æ˜¯ä¸€ä¸ªäººæ‰€èƒ½æ”¹å˜çš„ï¼Œæ‰€ä»¥æˆ‘æŠŠè‡ªå·±çš„äº‘åŸç”Ÿæ±‚ç´¢è¿‡ç¨‹è®°å½•ä¸€ä¸‹ï¼Œå¸Œæœ›èƒ½å¤Ÿå¸®åˆ°å…¶ä»–äººçœä¸‹æŸ¥æ‰¾èµ„æ–™çš„æ—¶é—´ï¼Œå¦‚æœè¿˜èƒ½å¤Ÿèµ·åˆ°å°‘èµ°å¼¯è·¯çš„ä½œç”¨ï¼Œé‚£å°±å†å¥½ä¸è¿‡äº†ã€‚</p>
</blockquote>
<p><strong>äº‘åŸç”ŸåŸºç¡€ç³»åˆ—ä¹‹Dockerç³»åˆ—</strong>ä¸»è¦åŒ…æ‹¬Dockeræ¦‚å¿µçš„ä»‹ç»ã€ç†è§£å’Œå®è·µï¼Œå°†åŒ…æ‹¬ä»¥ä¸‹éƒ¨åˆ†ï¼š</p>
<ul>
<li><a href="https://bugkillerpro.github.io/2022/06/10/uncatalog/cl483pse2000038r7fnpqhzig/" title="Front-end web development">dockeråŸºç¡€æŠ€æœ¯ä¹‹linux namespace</a></li>
<li><a href="https://bugkillerpro.github.io/2022/06/10/uncatalog/cl4884cmp000060r7fhji6teg/" title="Front-end web development">dockeråŸºç¡€æŠ€æœ¯ä¹‹linux cgroup</a></li>
<li><a href="https://bugkillerpro.github.io/2022/06/09/uncatalog/cl46zbgi6000y7or7g7cnd6w6/" title="Front-end web development">dockeråŸºç¡€</a></li>
<li><a href="https://bugkillerpro.github.io/2022/06/09/uncatalog/cl46zffyz00127or72j1r80ti/" title="Front-end web development">dockerè¿›é˜¶</a></li>
</ul>
<p><strong>äº‘åŸç”ŸåŸºç¡€ç³»åˆ—ä¹‹Kubernetes</strong>å†…å®¹é£æ ¼å’Œã€ŠKubernetesæƒå¨æŒ‡å—ï¼šä»Dockeråˆ°Kuberneteså®è·µå…¨æ¥è§¦ã€‹ç±»ä¼¼ï¼Œå°†åŒ…æ‹¬ä»¥ä¸‹éƒ¨åˆ†ï¼š</p>
<ul>
<li><a href="https://bugkillerpro.github.io/2022/06/09/uncatalog/cl46zoo76000028r79whb5rff/" title="Front-end web development">Kubernetesä»‹ç»</a></li>
<li><a href="https://bugkillerpro.github.io/2022/06/09/uncatalog/cl46zkqb400157or761km2b46/" title="Front-end web development">é›†ç¾¤ç¯å¢ƒæ­å»º</a></li>
<li><a href="https://bugkillerpro.github.io/2022/06/09/uncatalog/cl46zbaxk00017or7fpbp30br/" title="Front-end web development">èµ„æºç®¡ç†</a></li>
<li><a href="https://bugkillerpro.github.io/2022/06/09/uncatalog/cl46zbayd000p7or77mughk0e/" title="Front-end web development">å®æˆ˜å…¥é—¨</a></li>
<li><a href="https://bugkillerpro.github.io/2022/06/09/uncatalog/cl46zbayg000v7or7a4o0f4yd/" title="Front-end web development">Podè¯¦è§£</a></li>
<li><a href="https://bugkillerpro.github.io/2022/06/09/uncatalog/cl46zbaye000q7or7bx6mhrl3/" title="Front-end web development">Podæ§åˆ¶å™¨è¯¦è§£</a></li>
<li><a href="https://bugkillerpro.github.io/2022/06/09/uncatalog/cl46zbay9000j7or7b2e4b2pr/" title="Front-end web development">Serviceè¯¦è§£</a></li>
<li><a href="https://bugkillerpro.github.io/2022/06/09/uncatalog/cl46zbay9000k7or71j4vcb8a/" title="Front-end web development">æ•°æ®å­˜å‚¨</a></li>
<li><a href="https://bugkillerpro.github.io/2022/06/09/uncatalog/cl46zbaxw00037or72v2f9efa/" title="Front-end web development">å®‰å…¨è®¤è¯</a></li>
<li><a href="https://bugkillerpro.github.io/2022/06/09/uncatalog/cl46zbaxy00047or77oe22gjt/" title="Front-end web development">DashBoard</a></li>
</ul>
<p><strong>Kubernetesç½‘ç»œç³»åˆ—</strong>äº‘è®¡ç®—çš„ä¸–ç•Œé‡Œï¼Œè®¡ç®—æœ€åŸºç¡€ï¼Œå­˜å‚¨æœ€é‡è¦ï¼Œç½‘ç»œæœ€å¤æ‚ã€‚ æ‰€ä»¥å°†ä¸€äº›  å¿…é¡»å…·å¤‡çš„å‰ç½®ç½‘ç»œçŸ¥è¯†å’Œk8sç½‘ç»œæ’ä»¶éƒ¨åˆ†å•ç‹¬æ‹¿å‡ºæ¥ä½œä¸ºä¸€ä¸ªç³»åˆ—ï¼Œå°†åŒ…æ‹¬ä»¥ä¸‹éƒ¨åˆ†ï¼š</p>
<ul>
<li><a href="https://bugkillerpro.github.io/2022/06/10/uncatalog/cl48bverj000054r77iq83ab9/" title="Front-end web development">ç½‘ç»œæ˜¯æ€ä¹ˆè¿é€šçš„</a></li>
<li><a href="https://bugkillerpro.github.io/2022/06/11/uncatalog/cl49mkqxy0002lwr76770ae47/" title="Front-end web development">ç½‘ç»œåŸºæœ¬æ¦‚å¿µ</a></li>
<li><a href="https://bugkillerpro.github.io/2022/06/11/uncatalog/cl49muw310005lwr7dukkfz6m/" title="Front-end web development">IPå’Œæ©ç </a></li>
<li><a href="https://bugkillerpro.github.io/2022/06/11/uncatalog/cl49n9zab0008lwr79y835duy/" title="Front-end web development">routerè·¯å’‹èµ°å•Š</a></li>
<li><a href="https://bugkillerpro.github.io/2022/06/11/uncatalog/cl49np026000blwr7c4y2ebgu/" title="Front-end web development">PingæŠ¥æ–‡</a></li>
<li><a href="https://bugkillerpro.github.io/2022/06/11/uncatalog/cl49nvljx000elwr7fha73lvv/" title="Front-end web development">ARPä½ åœ¨å“ª</a></li>
<li><a href="https://bugkillerpro.github.io/2022/06/11/uncatalog/cl49qvoa2000hlwr7bjyn3m3x/" title="Front-end web development">Tcpdumpå¤§æ€å™¨æŠ“åŒ…</a></li>
<li><a href="https://bugkillerpro.github.io/2022/06/11/uncatalog/cl49qytpu000klwr7el00gnwf/" title="Front-end web development">iptables-filterè¿‡æ»¤åŠŸèƒ½</a></li>
<li><a href="https://bugkillerpro.github.io/2022/06/11/uncatalog/cl49r424d000nlwr732iq6tli/" title="Front-end web development">ç½‘ç»œéª—å­</a></li>
<li><a href="https://bugkillerpro.github.io/2022/06/11/uncatalog/cl49r8bkh000qlwr7dta2fv8f/" title="Front-end web development">iptables-natç©¿è¶ŠåŠŸèƒ½</a></li>
<li><a href="https://bugkillerpro.github.io/2022/06/11/uncatalog/cl49s0k3u000tlwr77i2gctw9/" title="Front-end web development">ä»€ä¹ˆæ˜¯VLANå’ŒVXLAN</a></li>
<li><a href="https://bugkillerpro.github.io/2022/06/11/uncatalog/cl49ss3al000wlwr78qw42gtt/" title="Front-end web development">GRE</a></li>
<li><a href="https://bugkillerpro.github.io/2022/06/11/uncatalog/cl49t00i2000zlwr72uaw2411/" title="Front-end web development">ipå‘½ä»¤</a></li>
<li><a href="https://bugkillerpro.github.io/2022/06/11/uncatalog/cl49v1eys0012lwr741221o3z/" title="Front-end web development">ç½‘ç»œå‘½åç©ºé—´Network Namespace</a></li>
<li><a href="https://bugkillerpro.github.io/2022/06/11/uncatalog/cl49vyb870015lwr7gd0l1mz1/" title="Front-end web development">Vethç½‘çº¿</a></li>
<li><a href="https://bugkillerpro.github.io/2022/06/11/uncatalog/cl49wfzo90018lwr70q7u4yf0/" title="Front-end web development">TUN/TAPç½‘çº¿</a></li>
<li><a href="https://bugkillerpro.github.io/2022/06/11/uncatalog/cl49wklgu001blwr7a55t1phs/" title="Front-end web development">Bridgeç½‘æ¡¥</a></li>
<li><a href="https://bugkillerpro.github.io/2022/06/11/uncatalog/cl49wrxfs001elwr7evfs8y08/" title="Front-end web development">Dockerç½‘ç»œå®ç°</a></li>
<li><a href="https://bugkillerpro.github.io/2022/06/11/uncatalog/cl49x52lf001hlwr7g9qrfjev/" title="Front-end web development">CloudFoundryç½‘ç»œå®ç°</a></li>
<li><a href="https://bugkillerpro.github.io/2022/06/11/uncatalog/cl49xdzwo001klwr71pcl8mu0/" title="Front-end web development">Kubernetesç½‘ç»œå®ç°</a></li>
<li><a href="https://bugkillerpro.github.io/2022/06/13/uncatalog/cl4cifak60008pwr77vkbd1sn/" title="Front-end web development">iptablesæ¦‚å¿µ</a></li>
<li><a href="https://bugkillerpro.github.io/2022/06/13/uncatalog/cl4cifak9000epwr7cx322y2s/" title="Front-end web development">iptableså®é™…æ“ä½œä¹‹è§„åˆ™æŸ¥è¯¢</a></li>
<li><a href="https://bugkillerpro.github.io/2022/06/13/uncatalog/cl4cifap3000vpwr7cqad5sgx/" title="Front-end web development">iptablesè§„åˆ™ç®¡ç†</a></li>
<li><a href="https://bugkillerpro.github.io/2022/06/13/uncatalog/cl4cifap5000zpwr721cugaqx/" title="Front-end web development">iptablesåŒ¹é…æ¡ä»¶æ€»ç»“ä¹‹ä¸€</a></li>
<li><a href="https://bugkillerpro.github.io/2022/06/13/uncatalog/cl4cifap4000xpwr7gg0bhm2w/" title="Front-end web development">iptablesåŒ¹é…æ¡ä»¶æ€»ç»“ä¹‹äºŒ(å¸¸ç”¨æ‰©å±•æ¨¡å—)</a></li>
<li><a href="https://bugkillerpro.github.io/2022/06/13/uncatalog/cl4cifakc000ipwr7bhs4dux2/" title="Front-end web development">iptablesæ‰©å±•åŒ¹é…æ¡ä»¶ä¹‹(â€“tcp-flags)</a></li>
<li><a href="https://bugkillerpro.github.io/2022/06/13/uncatalog/cl4cifak7000apwr7hgyg2fgs/" title="Front-end web development">iptablesæ‰©å±•ä¹‹udpæ‰©å±•ä¸icmpæ‰©å±•</a></li>
<li><a href="https://bugkillerpro.github.io/2022/06/13/uncatalog/cl4cifaka000gpwr787db5toi/" title="Front-end web development">iptablesæ‰©å±•æ¨¡å—ä¹‹stateæ‰©å±•</a></li>
<li><a href="https://bugkillerpro.github.io/2022/06/13/uncatalog/cl4cifak8000cpwr739275b4h/" title="Front-end web development">iptablesçš„é»‘ç™½åå•æœºåˆ¶</a></li>
<li><a href="https://bugkillerpro.github.io/2022/06/13/uncatalog/cl4cifajw0000pwr7fssa1zca/" title="Front-end web development">iptablesè‡ªå®šä¹‰é“¾</a></li>
<li><a href="https://bugkillerpro.github.io/2022/06/13/uncatalog/cl4cifajy0001pwr71ippfotz/" title="Front-end web development">iptablesä¹‹ç½‘ç»œé˜²ç«å¢™</a></li>
<li><a href="https://bugkillerpro.github.io/2022/06/13/uncatalog/cl4cifak10004pwr75tri6w43/" title="Front-end web development">iptablesåŠ¨ä½œæ€»ç»“ä¹‹ä¸€</a></li>
<li><a href="https://bugkillerpro.github.io/2022/06/13/uncatalog/cl4cifaoy000upwr7fsyw1c87/" title="Front-end web development">iptablesåŠ¨ä½œæ€»ç»“ä¹‹äºŒ</a></li>
<li><a href="https://bugkillerpro.github.io/2022/06/13/uncatalog/cl4cisjv20000f8r79ldw1df5/" title="Front-end web development">iptableså°ç»“ä¹‹å¸¸ç”¨å¥—è·¯</a></li>
<li><a href="https://www.google.com/" title="Front-end web development">å¾…æ›´æ–°â€¦</a></li>
</ul>
<p><strong>äº‘åŸç”Ÿè¿›é˜¶ç³»åˆ—</strong>ä¸»è¦åŒ…æ‹¬äº‘åŸç”Ÿå¼€å‘ã€service meshå’Œå…¶ä»–CNCFç›¸å…³çš„å†…å®¹ï¼Œé¢å‘äº‘åŸç”Ÿå¼€å‘äººå‘˜ã€‚å°†åŒ…æ‹¬ä»¥ä¸‹éƒ¨åˆ†ï¼š</p>
<ul>
<li><a href="https://www.google.com/" title="Front-end web development">å¾…æ›´æ–°â€¦</a></li>
</ul>
<p><strong>äº‘åŸç”Ÿå…¶ä»–ç›¸å…³</strong>ä¸»è¦åŒ…æ‹¬æˆ‘åœ¨äº‘åŸç”Ÿå­¦ä¹ è¿‡ç¨‹ä¸­çš„ä¸€äº›å¿ƒå¾—ä½“ä¼šå’Œè¯»ä¹¦ç¬”è®°ç­‰ã€‚</p>
<ul>
<li><a href="https://bugkillerpro.github.io/2022/06/10/uncatalog/cl48eey5y0000owr728gk66p6/" title="Front-end web development">kubernetesè¯»ä¹¦ç¬”è®°</a></li>
<li><a href="https://www.google.com/" title="Front-end web development">å¾…æ›´æ–°â€¦</a></li>
</ul>
</font>

<hr>
]]></content>
      <tags>
        <tag>äº‘åŸç”ŸåŸºç¡€ç³»åˆ—</tag>
        <tag>Kubernetesç½‘ç»œ</tag>
      </tags>
  </entry>
  <entry>
    <title>Kubernetesç½‘ç»œç³»åˆ—ä¹‹(ä¸‰åä¸‰)iptablesåŠ¨ä½œæ€»ç»“ä¹‹äºŒ</title>
    <url>/2022/06/13/uncatalog/cl4cifaoy000upwr7fsyw1c87/</url>
    <content><![CDATA[<hr>
<span id="more"></span>

<hr>
<h3 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h3><p>é˜…è¯»è¿™ç¯‡æ–‡ç« éœ€è¦ç«™åœ¨å‰æ–‡çš„åŸºç¡€ä¸Šï¼Œå¦‚æœä½ åœ¨é˜…è¯»æ—¶é‡åˆ°éšœç¢ï¼Œè¯·å‚è€ƒä¹‹å‰çš„æ–‡ç« ã€‚</p>
<p>å‰æ–‡ä¸­ï¼Œæˆ‘ä»¬å·²ç»äº†è§£äº†å¦‚ä¸‹åŠ¨ä½œ</p>
<p>ACCEPTã€DROPã€REJECTã€LOG</p>
<p>ä»Šå¤©ï¼Œæˆ‘ä»¬æ¥è®¤è¯†å‡ ä¸ªæ–°åŠ¨ä½œï¼Œå®ƒä»¬æ˜¯ï¼š</p>
<p>SNATã€DNATã€MASQUERADEã€REDIRECT</p>
<p>åœ¨è®¤è¯†å®ƒä»¬ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥èŠèŠNATï¼Œå¦‚æœä½ å¯¹NATçš„ç›¸å…³æ¦‚å¿µå·²ç»æ»šç“œçƒ‚ç†Ÿï¼Œå¯ä»¥è·³è¿‡å¦‚ä¸‹åœºæ™¯æè¿°ã€‚</p>
<p>NATæ˜¯Network Address Translationçš„ç¼©å†™ï¼Œè¯‘ä¸ºâ€ç½‘ç»œåœ°å€è½¬æ¢â€ï¼ŒNATè¯´ç™½äº†å°±æ˜¯ä¿®æ”¹æŠ¥æ–‡çš„IPåœ°å€ï¼ŒNATåŠŸèƒ½é€šå¸¸ä¼šè¢«é›†æˆåˆ°è·¯ç”±å™¨ã€é˜²ç«å¢™ã€æˆ–ç‹¬ç«‹çš„NATè®¾å¤‡ä¸­ã€‚</p>
<p>ä¸ºä»€ä¹ˆè¦ä¿®æ”¹æŠ¥æ–‡çš„IPåœ°å€å‘¢ï¼Ÿæˆ‘ä»¬æ¥æè¿°ä¸€äº›åœºæ™¯ï¼Œå³å¯çŸ¥é“ä¸ºä»€ä¹ˆæœ‰è¿™æ–¹é¢çš„éœ€æ±‚äº†ã€‚</p>
<h4 id="åœºæ™¯1ï¼š"><a href="#åœºæ™¯1ï¼š" class="headerlink" title="åœºæ™¯1ï¼š"></a>åœºæ™¯1ï¼š</h4><p>å‡è®¾ï¼Œç½‘ç»œå†…éƒ¨æœ‰10å°ä¸»æœºï¼Œå®ƒä»¬æœ‰å„è‡ªçš„IPåœ°å€ï¼Œå½“ç½‘ç»œå†…éƒ¨çš„ä¸»æœºä¸å…¶ä»–ç½‘ç»œä¸­çš„ä¸»æœºé€šè®¯æ—¶ï¼Œåˆ™ä¼šæš´éœ²è‡ªå·±çš„IPåœ°å€ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦éšè—è¿™äº›ä¸»æœºçš„IPåœ°å€ï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿå¯ä»¥è¿™æ ·åŠï¼Œå¦‚ä¸‹ã€‚</p>
<p>å½“ç½‘ç»œå†…éƒ¨çš„ä¸»æœºå‘ç½‘ç»œå¤–éƒ¨ä¸»æœºå‘é€æŠ¥æ–‡æ—¶ï¼ŒæŠ¥æ–‡ä¼šç»è¿‡é˜²ç«å¢™æˆ–è·¯ç”±å™¨ï¼Œå½“æŠ¥æ–‡ç»è¿‡é˜²ç«å¢™æˆ–è·¯ç”±å™¨æ—¶ï¼Œå°†æŠ¥æ–‡çš„æºIPä¿®æ”¹ä¸ºé˜²ç«å¢™æˆ–è€…è·¯ç”±å™¨çš„IPåœ°å€ï¼Œå½“å…¶ä»–ç½‘ç»œä¸­çš„ä¸»æœºæ”¶åˆ°è¿™äº›æŠ¥æ–‡æ—¶ï¼Œæ˜¾ç¤ºçš„æºIPåœ°å€åˆ™æ˜¯è·¯ç”±å™¨æˆ–è€…é˜²ç«å¢™çš„ï¼Œè€Œä¸æ˜¯é‚£10å°ä¸»æœºçš„IPåœ°å€ï¼Œè¿™æ ·ï¼Œå°±èµ·åˆ°éšè—ç½‘ç»œå†…éƒ¨ä¸»æœºIPçš„ä½œç”¨ï¼Œå½“ç½‘ç»œå†…éƒ¨ä¸»æœºçš„æŠ¥æ–‡ç»è¿‡è·¯ç”±å™¨æ—¶ï¼Œè·¯ç”±å™¨ä¼šç»´æŠ¤ä¸€å¼ NATè¡¨ï¼Œè¡¨ä¸­è®°å½•äº†æŠ¥æ–‡æ¥è‡ªäºå“ªä¸ªå†…éƒ¨ä¸»æœºçš„å“ªä¸ªè¿›ç¨‹ï¼ˆå†…éƒ¨ä¸»æœºIP+ç«¯å£ï¼‰ï¼Œå½“æŠ¥æ–‡ç»è¿‡è·¯ç”±å™¨æ—¶ï¼Œè·¯ç”±å™¨ä¼šå°†æŠ¥æ–‡çš„å†…éƒ¨ä¸»æœºæºIPæ›¿æ¢ä¸ºè·¯ç”±å™¨çš„IPåœ°å€ï¼ŒæŠŠæºç«¯å£ä¹Ÿæ˜ å°„ä¸ºæŸä¸ªç«¯å£ï¼ŒNATè¡¨ä¼šæŠŠè¿™ç§å¯¹åº”å…³ç³»è®°å½•ä¸‹æ¥ã€‚</p>
<p>ç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p>
<p> <img src="/2022/06/13/uncatalog/cl4cifaoy000upwr7fsyw1c87/1.png" alt="img"></p>
<p>äºæ˜¯ï¼Œå¤–éƒ¨ä¸»æœºæ”¶åˆ°æŠ¥æ–‡æ—¶ï¼ŒæºIPä¸æºç«¯å£æ˜¾ç¤ºçš„éƒ½æ˜¯è·¯ç”±çš„IPä¸ç«¯å£ï¼Œå½“å¤–éƒ¨ç½‘ç»œä¸­çš„ä¸»æœºè¿›è¡Œå›åº”æ—¶ï¼Œå¤–éƒ¨ä¸»æœºå°†å“åº”æŠ¥æ–‡å‘é€ç»™è·¯ç”±å™¨ï¼Œè·¯ç”±å™¨æ ¹æ®åˆšæ‰NATè¡¨ä¸­çš„æ˜ å°„è®°å½•ï¼Œå°†å“åº”æŠ¥æ–‡ä¸­çš„ç›®æ ‡IPä¸ç›®æ ‡ç«¯å£å†æ”¹ä¸ºå†…éƒ¨ä¸»æœºçš„IPä¸ç«¯å£å·ï¼Œç„¶åå†å°†å“åº”æŠ¥æ–‡å‘é€ç»™å†…éƒ¨ç½‘ç»œä¸­çš„ä¸»æœºã€‚æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œå¤–éƒ¨ä¸»æœºéƒ½ä¸çŸ¥é“å†…éƒ¨ä¸»æœºçš„IPåœ°å€ï¼Œå†…éƒ¨ä¸»æœºè¿˜èƒ½ä¸å¤–éƒ¨ä¸»æœºé€šè®¯ï¼Œäºæ˜¯èµ·åˆ°äº†éšè—ç½‘ç»œå†…ä¸»æœºIPçš„ä½œç”¨ã€‚</p>
<p>ä¸Šè¿°æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œå°±ç”¨åˆ°äº†NATåŠŸèƒ½ï¼Œå‡†ç¡®çš„è¯´æ˜¯ç”¨åˆ°äº†NAPTåŠŸèƒ½ï¼ŒNAPTæ˜¯NATçš„ä¸€ç§ï¼Œå…¨ç§°ä¸ºNetwork Address Port Translationï¼Œè¯´ç™½äº†å°±æ˜¯æ˜ å°„æŠ¥æ–‡IPåœ°å€çš„åŒæ—¶è¿˜ä¼šæ˜ å°„å…¶ç«¯å£å·ï¼Œå°±åƒåˆšæ‰æè¿°çš„è¿‡ç¨‹ä¸€æ ·ã€‚</p>
<p>åˆšæ‰æè¿°çš„è¿‡ç¨‹ä¸­ï¼Œâ€IPåœ°å€çš„è½¬æ¢â€ä¸€å…±å‘ç”Ÿäº†ä¸¤æ¬¡ã€‚</p>
<p>å†…éƒ¨ç½‘ç»œçš„æŠ¥æ–‡å‘é€å‡ºå»æ—¶ï¼ŒæŠ¥æ–‡çš„æºIPä¼šè¢«ä¿®æ”¹ï¼Œä¹Ÿå°±æ˜¯æºåœ°å€è½¬æ¢ï¼šSource Network Address Translationï¼Œç¼©å†™ä¸ºSNATã€‚</p>
<p>å¤–éƒ¨ç½‘ç»œçš„æŠ¥æ–‡å“åº”æ—¶ï¼Œå“åº”æŠ¥æ–‡çš„ç›®æ ‡IPä¼šå†æ¬¡è¢«ä¿®æ”¹ï¼Œä¹Ÿå°±æ˜¯ç›®æ ‡åœ°å€è½¬æ¢ï¼šDestinationnetwork address translationï¼Œç¼©å†™ä¸ºDNATã€‚</p>
<p>ä½†æ˜¯ï¼Œä¸Šè¿°â€æ•´ä¸ªè¿‡ç¨‹â€è¢«ç§°ä¸ºSNATï¼Œå› ä¸ºâ€æ•´ä¸ªè¿‡ç¨‹â€çš„å‰åŠæ®µä½¿ç”¨äº†SNATï¼Œå¦‚æœä¸Šè¿°â€æ•´ä¸ªè¿‡ç¨‹â€çš„å‰åŠæ®µä½¿ç”¨äº†DNATï¼Œåˆ™æ•´ä¸ªè¿‡ç¨‹è¢«ç§°ä¸ºDNATï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ•´ä¸ªè¿‡ç¨‹è¢«ç§°ä¸ºSNATè¿˜æ˜¯DNATï¼Œå–å†³äºæ•´ä¸ªè¿‡ç¨‹çš„å‰åŠæ®µä½¿ç”¨äº†SNATè¿˜æ˜¯DNATã€‚</p>
<p>å…¶å®åˆšæ‰æè¿°çš„åœºæ™¯ä¸ä»…ä»…èƒ½å¤Ÿéšè—ç½‘ç»œå†…éƒ¨ä¸»æœºçš„IPåœ°å€ï¼Œè¿˜èƒ½å¤Ÿè®©å±€åŸŸç½‘å†…çš„ä¸»æœºå…±äº«å…¬ç½‘IPï¼Œè®©ä½¿ç”¨ç§ç½‘IPçš„ä¸»æœºèƒ½å¤Ÿè®¿é—®äº’è”ç½‘ã€‚</p>
<p>æ¯”å¦‚ï¼Œæ•´ä¸ªå…¬å¸åªæœ‰ä¸€ä¸ªå…¬ç½‘IPï¼Œä½†æ˜¯æ•´ä¸ªå…¬å¸æœ‰10å°ç”µè„‘ï¼Œæˆ‘ä»¬æ€æ ·èƒ½è®©è¿™10å°ç”µè„‘éƒ½è®¿é—®äº’è”ç½‘å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥ä¸ºè¿™10å°ç”µè„‘éƒ½é…ç½®ä¸Šå„è‡ªçš„ç§ç½‘IPï¼Œæ¯”å¦‚â€192.168â€³è¿™ç§ç§ç½‘IPï¼Œä½†æ˜¯äº’è”ç½‘æ˜¯ä¸ä¼šè·¯ç”±ç§ç½‘IPçš„ï¼Œå¦‚æœæƒ³è¦è®¿é—®äº’è”ç½‘ï¼Œåˆ™å¿…é¡»ä½¿ç”¨å…¬ç½‘IPï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬å°±éœ€è¦æƒ³åŠæ³•ï¼Œèƒ½è®©è¿™10å°ä¸»æœºå…±äº«å…¬å¸ä»…æœ‰çš„ä¸€ä¸ªå…¬ç½‘IPï¼Œæ²¡é”™ï¼Œè¿™ä¸åˆšæ‰æè¿°çš„åœºæ™¯å…¶å®å®Œå…¨ä¸€è‡´ï¼Œæˆ‘ä»¬åªè¦åœ¨è·¯ç”±å™¨ä¸Šé…ç½®å…¬ç½‘IPï¼Œåœ¨ç§ç½‘ä¸»æœºè®¿é—®å…¬ç½‘æœåŠ¡æ—¶ï¼ŒæŠ¥æ–‡ç»è¿‡è·¯ç”±å™¨ï¼Œè·¯ç”±å™¨å°†æŠ¥æ–‡ä¸­çš„ç§ç½‘IPä¸ç«¯å£å·è¿›è¡Œä¿®æ”¹å’Œæ˜ å°„ï¼Œå°†å…¶æ˜ å°„ä¸ºå…¬ç½‘IPä¸ç«¯å£å·ï¼Œè¿™æ—¶ï¼Œå†…ç½‘ä¸»æœºå³å¯å…±äº«å…¬ç½‘IPè®¿é—®äº’è”ç½‘ä¸Šçš„æœåŠ¡äº†ï¼ŒNATè¡¨ç¤ºæ„å›¾å¦‚ä¸‹</p>
<p><img src="/2022/06/13/uncatalog/cl4cifaoy000upwr7fsyw1c87/2.png" alt="img"></p>
<p>ç»¼ä¸Šæ‰€è¿°ï¼ŒSNATä¸ä»…èƒ½å¤Ÿéšè—ç½‘å†…çš„ä¸»æœºIPï¼Œè¿˜èƒ½å¤Ÿå…±äº«å…¬ç½‘IPï¼Œè¿™åœ¨IPV4åœ°å€è¾ƒä¸ºç´§å¼ çš„ä»Šå¤©ï¼Œæ˜¯éå¸¸æœ‰ç”¨çš„ã€‚</p>
<h4 id="åœºæ™¯2ï¼š"><a href="#åœºæ™¯2ï¼š" class="headerlink" title="åœºæ™¯2ï¼š"></a>åœºæ™¯2ï¼š</h4><p>åœºæ™¯1ä¸­ï¼Œæˆ‘ä»¬æè¿°çš„è¿‡ç¨‹ä¸ºSNATçš„è¿‡ç¨‹ï¼Œè™½ç„¶å…¶è¿‡ç¨‹ä¸­ä¹Ÿç‰µæ‰¯åˆ°DNATï¼Œä½†æ˜¯ç”±äºæ•´ä¸ªè¿‡ç¨‹çš„å‰åŠæ®µä½¿ç”¨äº†SNATï¼Œæ‰€ä»¥æ•´ä¸ªè¿‡ç¨‹ç§°ä¹‹ä¸ºSNATï¼Œé‚£ä¹ˆåœ¨ä»€ä¹ˆæƒ…å†µä¸‹ï¼Œæ•´ä¸ªè¿‡ç¨‹èƒ½ç§°ä¹‹ä¸ºDNATå‘¢ï¼Ÿ</p>
<p>æ²¡é”™ï¼Œå½“æ•´ä¸ªè¿‡ç¨‹çš„å‰åŠæ®µä½¿ç”¨äº†DNATæ—¶ï¼Œæ•´ä¸ªè¿‡ç¨‹è¢«ç§°ä¸ºDNATï¼Œå…·ä½“åœºæ™¯å¦‚ä¸‹ã€‚</p>
<p>å…¬å¸æœ‰è‡ªå·±çš„å±€åŸŸç½‘ï¼Œç½‘ç»œä¸­æœ‰ä¸¤å°ä¸»æœºä½œä¸ºæœåŠ¡å™¨ï¼Œä¸»æœº1æä¾›webæœåŠ¡ï¼Œä¸»æœº2æä¾›æ•°æ®åº“æœåŠ¡ï¼Œä½†æ˜¯è¿™ä¸¤å°æœåŠ¡å™¨åœ¨å±€åŸŸç½‘ä¸­ä½¿ç”¨ç§æœ‰IPåœ°å€ï¼Œåªèƒ½è¢«å±€åŸŸç½‘å†…çš„ä¸»æœºè®¿é—®ï¼Œäº’è”ç½‘æ— æ³•è®¿é—®åˆ°è¿™ä¸¤å°æœåŠ¡å™¨ï¼Œæ•´ä¸ªå…¬å¸åªæœ‰ä¸€ä¸ªå¯ç”¨çš„å…¬ç½‘IPï¼Œæ€æ ·é€šè¿‡è¿™ä¸ªå…¬ç½‘IPè®¿é—®åˆ°å†…ç½‘ä¸­çš„è¿™äº›æœåŠ¡å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥å°†è¿™ä¸ªå…¬ç½‘IPé…ç½®åˆ°å…¬å¸çš„æŸå°ä¸»æœºæˆ–è·¯ç”±å™¨ä¸Šï¼Œç„¶åå¯¹å¤–å®£ç§°ï¼Œè¿™ä¸ªIPåœ°å€å¯¹å¤–æä¾›webæœåŠ¡ä¸æ•°æ®åº“æœåŠ¡ï¼Œäºæ˜¯äº’è”ç½‘ä¸»æœºå°†è¯·æ±‚æŠ¥æ–‡å‘é€ç»™è¿™å…¬ç½‘ IPåœ°å€ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ­¤æ—¶æŠ¥æ–‡ä¸­çš„ç›®æ ‡IPä¸ºå…¬ç½‘IPï¼Œå½“è·¯ç”±å™¨æ”¶åˆ°æŠ¥æ–‡åï¼Œå°†æŠ¥æ–‡çš„ç›®æ ‡åœ°å€æ”¹ä¸ºå¯¹åº”çš„ç§ç½‘åœ°å€ï¼Œæ¯”å¦‚ï¼Œå¦‚æœæŠ¥æ–‡çš„ç›®æ ‡IPä¸ç«¯å£å·ä¸ºï¼šå…¬ç½‘IP+3306ï¼Œæˆ‘ä»¬å°±å°†æŠ¥æ–‡çš„ç›®æ ‡åœ°å€ä¸ç«¯å£æ”¹ä¸ºï¼šä¸»æœº2çš„ç§ç½‘IP+3306ï¼ŒåŒç†ï¼Œå…¬ç½‘IP+80ç«¯å£æ˜ å°„ä¸ºä¸»æœº1çš„ç§ç½‘IP+80ç«¯å£ï¼Œå½“ç§ç½‘ä¸­çš„ä¸»æœºå›åº”å¯¹åº”è¯·æ±‚æŠ¥æ–‡æ—¶ï¼Œå†å°†å›åº”æŠ¥æ–‡çš„æºåœ°å€ä»ç§ç½‘IP+ç«¯å£å·æ˜ å°„ä¸ºå…¬ç½‘IP+ç«¯å£å·ï¼Œå†ç”±è·¯ç”±å™¨æˆ–å…¬ç½‘ä¸»æœºå‘é€ç»™äº’è”ç½‘ä¸­çš„ä¸»æœºã€‚</p>
<p>ä¸Šè¿°è¿‡ç¨‹ä¹Ÿç‰µæ‰¯åˆ°DNATä¸SNATï¼Œä½†æ˜¯ç”±äºæ•´ä¸ªè¿‡ç¨‹çš„å‰åŠæ®µä½¿ç”¨äº†DNATï¼Œæ‰€ä»¥ä¸Šè¿°è¿‡ç¨‹è¢«ç§°ä¸ºDNAT</p>
<p>å…¶å®ï¼Œä¸ç®¡æ˜¯SNATè¿˜æ˜¯DNATï¼Œéƒ½èµ·åˆ°äº†éšè—å†…éƒ¨ä¸»æœºIPçš„ä½œç”¨ã€‚</p>
<h3 id="å®éªŒç¯å¢ƒå‡†å¤‡"><a href="#å®éªŒç¯å¢ƒå‡†å¤‡" class="headerlink" title="å®éªŒç¯å¢ƒå‡†å¤‡"></a>å®éªŒç¯å¢ƒå‡†å¤‡</h3><p>å¥½äº†ï¼Œæˆ‘ä»¬å·²ç»äº†è§£äº†SNATä¸DNATçš„ç›¸å…³æ¦‚å¿µï¼Œé‚£ä¹ˆç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥åŠ¨åŠ¨æ‰‹äº†ï¼Œé¦–å…ˆï¼Œå‡†å¤‡ä¸€ä¸‹å®éªŒç¯å¢ƒ</p>
<p>å¤§è‡´çš„å®éªŒç¯å¢ƒæ˜¯è¿™æ ·çš„ï¼Œå…¬å¸å±€åŸŸç½‘ä½¿ç”¨çš„ç½‘æ®µä¸º10.1.0.0/16ï¼Œç›®å‰å…¬å¸åªæœ‰ä¸€ä¸ªå…¬ç½‘IPï¼Œå±€åŸŸç½‘å†…çš„ä¸»æœºéœ€è¦å…±äº«è¿™ä¸ªIPä¸äº’è”ç½‘ä¸Šçš„ä¸»æœºè¿›è¡Œé€šè®¯ã€‚</p>
<p>ç”±äºæˆ‘ä»¬æ²¡æœ‰çœŸæ­£çš„å…¬ç½‘IPï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬ä½¿ç”¨ç§ç½‘IPï¼š192.168.1.146æ¨¡æ‹Ÿæ‰€è°“çš„å…¬ç½‘IPï¼Œç¤ºæ„å›¾å¦‚ä¸‹</p>
<p><img src="/2022/06/13/uncatalog/cl4cifaoy000upwr7fsyw1c87/3.png" alt="img"></p>
<p>å¦‚ä¸Šè¿°ç¤ºæ„å›¾æ‰€ç¤ºï¼Œå®éªŒä½¿ç”¨4å°è™šæ‹Ÿæœºï¼ŒAã€Bã€Cã€D</p>
<ul>
<li><p>ä¸»æœºAï¼šæ‰®æ¼”å…¬ç½‘ä¸»æœºï¼Œå°è¯•è®¿é—®å…¬å¸æä¾›çš„æœåŠ¡ï¼ŒIPåœ°å€ä¸º192.168.1.147</p>
</li>
<li><p>ä¸»æœºBï¼šæ‰®æ¼”äº†æ‹¥æœ‰NATåŠŸèƒ½çš„é˜²ç«å¢™æˆ–è·¯ç”±å™¨ï¼Œå……å½“ç½‘å…³ï¼Œå¹¶ä¸”è´Ÿè´£NATï¼Œå…¬ç½‘ã€ç§ç½‘é€šè®¯çš„æŠ¥æ–‡é€šè¿‡Bä¸»æœºæ—¶ï¼ŒæŠ¥æ–‡ä¼šè¢«NAT</p>
</li>
<li><p>ä¸»æœºCï¼šæ‰®æ¼”å†…ç½‘webæœåŠ¡å™¨</p>
</li>
<li><p>ä¸»æœºDï¼šæ‰®æ¼”å†…ç½‘windowsä¸»æœº</p>
</li>
</ul>
<p>ä¸Šå›¾ä¸­åœ†å½¢æ‰€ç¤ºçš„é€»è¾‘åŒºåŸŸè¡¨ç¤ºå…¬å¸å†…ç½‘ï¼Œç½‘æ®µä¸º10.1.0.0/16ï¼Œä¸»æœºBã€Cã€Déƒ½å±äºå†…ç½‘ä¸»æœºï¼Œä¸»æœºBæ¯”è¾ƒç‰¹æ®Šï¼ŒåŒæ—¶æ‰®æ¼”äº†ç½‘å…³ä¸é˜²ç«å¢™ï¼Œä¸»æœºBæŒæœ‰å…¬å¸å”¯ä¸€çš„å…¬ç½‘IPï¼ˆæˆ‘ä»¬ç”¨äº†ä¸€ä¸ªå‡çš„å…¬ç½‘IPï¼‰ï¼Œå±€åŸŸç½‘å†…ä¸»æœºå¦‚æœæƒ³ä¸å…¬ç½‘ä¸»æœºé€šè®¯ï¼Œéœ€è¦å…±äº«æ­¤å…¬ç½‘IPï¼Œç”±Bä¸»æœºè¿›è¡ŒNATï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬ä¸ºä¸»æœºBå‡†å¤‡äº†ä¸¤å—ç½‘å¡ï¼Œå…¬ç½‘IPä¸ç§ç½‘IPåˆ†åˆ«é…ç½®åˆ°è¿™ä¸¤å—ç½‘å¡ä¸­ï¼ŒåŒæ—¶ï¼Œåœ¨è™šæ‹Ÿæœºä¸­è®¾ç½®äº†ä¸€ä¸ªâ€ä»…ä¸»æœºæ¨¡å¼â€çš„è™šæ‹Ÿç½‘ç»œï¼Œä»¥æ¨¡æ‹Ÿå…¬å¸å±€åŸŸç½‘ã€‚</p>
<p>èªæ˜å¦‚ä½ ï¼Œåº”è¯¥å·²ç»å‘ç°äº†ï¼Œä¸Šè¿°å®éªŒç¯å¢ƒä¸ä¹‹å‰æè¿°çš„â€ç½‘ç»œé˜²ç«å¢™â€çš„å®éªŒç¯å¢ƒç›¸å·®æ— å‡ ï¼Œåªä¸è¿‡ä¹‹å‰çš„ç¯å¢ƒå¹¶æ²¡æœ‰å…¬ç½‘ï¼Œç§ç½‘çš„æ¦‚å¿µï¼Œè€Œæ­¤åˆ»ï¼Œåœ†å½¢é€»è¾‘åŒºåŸŸä¹‹å†…ä¸ºç§ç½‘ï¼Œåœ†å½¢é€»è¾‘åŒºåŸŸä¹‹å¤–ä¸ºå…¬ç½‘ã€‚</p>
<p>ç¯å¢ƒå…·ä½“å‡†å¤‡è¿‡ç¨‹å¦‚ä¸‹</p>
<p>é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªè™šæ‹Ÿç½‘ç»œï¼Œæ¨¡æ‹Ÿå…¬å¸å†…ç½‘ã€‚</p>
<p>ç‚¹å‡»vmwareè™šæ‹Ÿæœºçš„ç¼–è¾‘èœå•ï¼Œæ‰“å¼€â€è™šæ‹Ÿç½‘ç»œç¼–è¾‘å™¨â€ï¼Œç‚¹å‡»æ›´æ”¹è®¾ç½®ï¼Œæ·»åŠ â€ä»…ä¸»æœºæ¨¡å¼â€çš„è™šæ‹Ÿç½‘ç»œï¼Œä¸‹å›¾ä¸­çš„VMnet6ä¸ºå·²ç»æ·»åŠ è¿‡çš„è™šæ‹Ÿç½‘ç»œï¼Œæ­¤å¤„ä¸å†é‡å¤æ“ä½œã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifaoy000upwr7fsyw1c87/4.png" alt="img"></p>
<p>ä¸»æœºCä¸ä¸»æœºDçš„ç½‘å…³éƒ½æŒ‡å‘ä¸»æœºBçš„ç§ç½‘IPï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º</p>
<p><img src="/2022/06/13/uncatalog/cl4cifaoy000upwr7fsyw1c87/5.png" alt="img"><br><img src="/2022/06/13/uncatalog/cl4cifaoy000upwr7fsyw1c87/6.png" alt="img"></p>
<p>ä¸»æœºBæœ‰ä¸¤å—ç½‘å¡ï¼Œåˆ†åˆ«é…ç½®äº†ç§ç½‘IPä¸å…¬ç½‘IPï¼Œç§ç½‘IPä¸º10.1.0.3ï¼Œç§ç½‘IPæ‰€åœ¨çš„ç½‘å¡ä¹Ÿå­˜åœ¨äºvmnet6ä¸­ï¼Œæ¨¡æ‹Ÿå…¬ç½‘çš„IPä¸º192.168.1.146ï¼ŒBä¸»æœºçš„å…¬ç½‘IPæ‰€åœ¨çš„ç½‘å¡ä¸Aä¸»æœºéƒ½ä½¿ç”¨æ¡¥æ¥æ¨¡å¼çš„è™šæ‹Ÿç½‘ç»œï¼Œæ‰€ä»¥ï¼ŒBä¸»æœºæ—¢èƒ½ä¸ç§ç½‘ä¸»æœºé€šè®¯ï¼Œä¹Ÿèƒ½ä¸å…¬ç½‘ä¸»æœºé€šè®¯ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifaoy000upwr7fsyw1c87/7.png" alt="img"></p>
<p>ç”±äºBä¸»æœºæ­¤æ—¶éœ€è¦è´Ÿè´£å¯¹æŠ¥æ–‡çš„ä¿®æ”¹ä¸è½¬å‘ï¼Œæ‰€ä»¥ï¼Œéœ€è¦å¼€å¯Bä¸»æœºä¸­çš„æ ¸å¿ƒè½¬å‘åŠŸèƒ½ï¼ŒLinuxä¸»æœºé»˜è®¤ä¸ä¼šå¼€å¯æ ¸å¿ƒè½¬å‘ï¼Œè¿™åœ¨å‰æ–‡ä¸­å·²ç»è¯¦ç»†çš„æè¿°è¿‡ï¼Œæ­¤å¤„ä¸å†èµ˜è¿°ï¼Œå¦‚æœä½ è¿˜ä¸æ˜ç™½ä¸ºä»€ä¹ˆï¼Œè¯·å›é¡¾å‰æ–‡ï¼Œä½¿ç”¨ä¸´æ—¶ç”Ÿæ•ˆçš„æ–¹æ³•å¼€å¯Bä¸»æœºçš„æ ¸å¿ƒè½¬å‘åŠŸèƒ½ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifaoy000upwr7fsyw1c87/8.png" alt="img"></p>
<p>Aä¸»æœºçš„IPåœ°å€å¦‚ä¸‹ï¼Œå¯ä»¥ä¸Bä¸»æœºè¿›è¡Œé€šè®¯ï¼Œä½†æ˜¯ä¸èƒ½ä¸Cã€Dè¿›è¡Œé€šè®¯ï¼Œå› ä¸ºæ­¤åˆ»ï¼ŒAæ˜¯å…¬ç½‘ä¸»æœºï¼ŒBæ—¢æ˜¯å…¬ç½‘ä¸»æœºåˆæ˜¯ç§ç½‘ä¸»æœºï¼ŒCã€Dæ˜¯ç§ç½‘çš„ä¸»æœºï¼ŒAæ˜¯ä¸å¯èƒ½è®¿é—®åˆ°Cå’ŒDçš„ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifaoy000upwr7fsyw1c87/9.png" alt="img"></p>
<p>ä¸ºäº†èƒ½å¤Ÿæ›´å¥½çš„åŒºåˆ†å…¬ç½‘æœåŠ¡ä¸ç§ç½‘æœåŠ¡ï¼Œæˆ‘ä»¬åˆ†åˆ«åœ¨ä¸»æœºAä¸ä¸»æœºCä¸Šå¯åŠ¨httpdæœåŠ¡ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifaoy000upwr7fsyw1c87/10.png" alt="img"></p>
<p>å¥½äº†ï¼Œå®éªŒç¯å¢ƒå‡†å¤‡å®Œæ¯•ï¼Œæˆ‘ä»¬æ¥ä¸€èµ·åŠ¨åŠ¨æ‰‹ï¼Œå®é™…æ“ä½œä¸€ä¸‹ã€‚</p>
<h3 id="åŠ¨ä½œï¼šSNAT"><a href="#åŠ¨ä½œï¼šSNAT" class="headerlink" title="åŠ¨ä½œï¼šSNAT"></a>åŠ¨ä½œï¼šSNAT</h3><p>åœ¨æ–‡ç« å¼€å¤´çš„åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬å·²ç»æè¿°è¿‡ï¼Œç½‘ç»œå†…éƒ¨çš„ä¸»æœºå¯ä»¥å€ŸåŠ©SNATéšè—è‡ªå·±çš„IPåœ°å€ï¼ŒåŒæ—¶è¿˜èƒ½å¤Ÿå…±äº«åˆæ³•çš„å…¬ç½‘IPï¼Œè®©å±€åŸŸç½‘å†…çš„å¤šå°ä¸»æœºå…±äº«å…¬ç½‘IPè®¿é—®äº’è”ç½‘ã€‚</p>
<p>è€Œæ­¤æ—¶çš„ä¸»æœºBå°±æ‰®æ¼”äº†æ‹¥æœ‰NATåŠŸèƒ½çš„è®¾å¤‡ï¼Œæˆ‘ä»¬ä½¿ç”¨iptablesçš„SNATåŠ¨ä½œè¾¾åˆ°åˆšæ‰æ‰€è¯´çš„ç›®çš„ã€‚</p>
<p>è¿æ¥åˆ°Bä¸»æœºï¼Œæ·»åŠ å¦‚ä¸‹è§„åˆ™ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifaoy000upwr7fsyw1c87/11.png" alt="img"></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œä¸Šå›¾ä¸­çš„è§„åˆ™è¡¨ç¤ºå°†æ¥è‡ªäº10.1.0.0/16ç½‘æ®µçš„æŠ¥æ–‡çš„æºåœ°å€æ”¹ä¸ºå…¬å¸çš„å…¬ç½‘IPåœ°å€ã€‚</p>
<p>â€œ-t natâ€è¡¨ç¤ºæ“ä½œnatè¡¨ï¼Œæˆ‘ä»¬ä¹‹å‰ä¸€ç›´åœ¨çŒè¾“ä¸€ä¸ªæ¦‚å¿µï¼Œå°±æ˜¯ä¸åŒçš„è¡¨æœ‰ä¸åŒçš„åŠŸèƒ½ï¼Œfilterè¡¨çš„åŠŸèƒ½æ˜¯è¿‡æ»¤ï¼Œnatè¡¨çš„åŠŸèƒ½å°±æ˜¯åœ°å€è½¬æ¢ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨natè¡¨ä¸­å®šä¹‰natè§„åˆ™ã€‚</p>
<p>â€œ-A POSTROUTINGâ€è¡¨ç¤ºå°†SNATè§„åˆ™æ·»åŠ åˆ°POSTROUTINGé“¾çš„æœ«å°¾ï¼Œåœ¨centos7ä¸­ï¼ŒSNATè§„åˆ™åªèƒ½å­˜åœ¨äºPOSTROUTINGé“¾ä¸INPUTé“¾ä¸­ï¼Œåœ¨centos6ä¸­ï¼ŒSNATè§„åˆ™åªèƒ½å­˜åœ¨äºPOSTROUTINGé“¾ä¸­ã€‚</p>
<p>ä½ å¯èƒ½ä¼šé—®ï¼Œä¸ºä»€ä¹ˆSNATè§„åˆ™å¿…é¡»å®šä¹‰åœ¨POSTROUTINGé“¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·è®¤ä¸ºï¼ŒPOSTROUTINGé“¾æ˜¯iptablesä¸­æŠ¥æ–‡å‘å‡ºçš„æœ€åä¸€ä¸ªâ€å…³å¡â€ï¼Œæˆ‘ä»¬åº”è¯¥åœ¨æŠ¥æ–‡é©¬ä¸Šå‘å‡ºä¹‹å‰ï¼Œä¿®æ”¹æŠ¥æ–‡çš„æºåœ°å€ï¼Œå¦åˆ™å°±å†ä¹Ÿæ²¡æœ‰æœºä¼šä¿®æ”¹æŠ¥æ–‡çš„æºåœ°å€äº†ï¼Œåœ¨centos7ä¸­ï¼ŒSNATè§„åˆ™ä¹Ÿå¯ä»¥å®šä¹‰åœ¨INPUTé“¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·ç†è§£ï¼Œå‘å¾€æœ¬æœºçš„æŠ¥æ–‡ç»è¿‡INPUTé“¾ä»¥åæŠ¥æ–‡å°±åˆ°è¾¾äº†æœ¬æœºï¼Œå¦‚æœå†ä¸ä¿®æ”¹æŠ¥æ–‡çš„æºåœ°å€ï¼Œå°±æ²¡æœ‰æœºä¼šä¿®æ”¹äº†ã€‚</p>
<p>â€œ-s 10.1.0.0/16â€³è¡¨ç¤ºæŠ¥æ–‡æ¥è‡ªäº10.1.0.0/16ç½‘æ®µï¼Œå‰æ–‡ä¸­ä¸€ç›´åœ¨ä½¿ç”¨è¿™ä¸ªåŒ¹é…æ¡ä»¶ï¼Œæˆ‘æƒ³æ­¤å¤„åº”è¯¥ä¸ç”¨èµ˜è¿°äº†ã€‚</p>
<p>â€œ-j SNATâ€è¡¨ç¤ºä½¿ç”¨SNATåŠ¨ä½œï¼Œå¯¹åŒ¹é…åˆ°çš„æŠ¥æ–‡è¿›è¡Œå¤„ç†ï¼Œå¯¹åŒ¹é…åˆ°çš„æŠ¥æ–‡è¿›è¡Œæºåœ°å€è½¬æ¢ã€‚</p>
<p>â€œâ€“to-source 192.168.1.146â€³è¡¨ç¤ºå°†åŒ¹é…åˆ°çš„æŠ¥æ–‡çš„æºIPä¿®æ”¹ä¸º192.168.1.146ï¼Œå‰æ–‡ä¸­ï¼Œæˆ‘ä»¬å·²ç»æ€»ç»“è¿‡ï¼ŒæŸäº›åŠ¨ä½œä¼šæœ‰è‡ªå·±çš„é€‰é¡¹ï¼Œâ€â€“to-sourceâ€å°±æ˜¯SNATåŠ¨ä½œçš„å¸¸ç”¨é€‰é¡¹ï¼Œç”¨äºæŒ‡å®šSNATéœ€è¦å°†æŠ¥æ–‡çš„æºIPä¿®æ”¹ä¸ºå“ªä¸ªIPåœ°å€ã€‚</p>
<p>å¥½äº†ï¼Œåªè¦ç«™åœ¨å‰æ–‡çš„åŸºç¡€ä¸Šï¼Œç†è§£ä¸Šè¿°è¯­å¥åº”è¯¥æ˜¯åˆ†åˆ†é’Ÿçš„äº‹æƒ…ï¼Œèªæ˜å¦‚ä½ åº”è¯¥å·²ç»å­¦ä¼šäº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ã€‚</p>
<p>ç›®å‰æ¥è¯´ï¼Œæˆ‘ä»¬åªé…ç½®äº†ä¸€æ¡SNATè§„åˆ™ï¼Œå¹¶æ²¡æœ‰è®¾ç½®ä»»ä½•DNATï¼Œç°åœ¨ï¼Œæˆ‘ä»¬ä»å†…ç½‘ä¸»æœºä¸Špingå¤–ç½‘ä¸»æœºï¼Œçœ‹çœ‹èƒ½ä¸èƒ½pingé€šï¼Œç™»å½•å†…ç½‘ä¸»æœºCï¼Œåœ¨Cä¸»æœºä¸Šå‘Aä¸»æœºçš„å¤–ç½‘IPå‘é€pingè¯·æ±‚(å‡å¤–ç½‘IP)ï¼Œç¤ºä¾‹å¦‚ä¸‹</p>
<p><img src="/2022/06/13/uncatalog/cl4cifaoy000upwr7fsyw1c87/12.png" alt="img"><br>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œâ€å†…ç½‘ä¸»æœºâ€å·²ç»å¯ä»¥ä¾é SNATè®¿é—®â€äº’è”ç½‘â€äº†ã€‚</p>
<p>ä¸ºäº†æ›´åŠ æ¸…æ™°çš„ç†è§£æ•´ä¸ªSNATè¿‡ç¨‹ï¼Œåœ¨Cä¸»æœºä¸ŠæŠ“åŒ…çœ‹çœ‹ï¼ŒæŸ¥çœ‹ä¸€ä¸‹è¯·æ±‚æŠ¥æ–‡ä¸å“åº”æŠ¥æ–‡çš„IPåœ°å€ï¼Œå¦‚ä¸‹ï¼Œåœ¨Cä¸»æœºä¸ŠåŒæ—¶æ‰“å¼€ä¸¤ä¸ªå‘½ä»¤çª—å£ï¼Œä¸€ä¸ªå‘½ä»¤çª—å£ä¸­å‘Aä¸»æœºå‘é€pingè¯·æ±‚ï¼Œå¦ä¸€ä¸ªçª—å£ä¸­ï¼Œä½¿ç”¨tcpdumpå‘½ä»¤å¯¹æŒ‡å®šçš„ç½‘å¡è¿›è¡ŒæŠ“åŒ…ï¼ŒæŠ“å–icmpåè®®çš„åŒ…ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifaoy000upwr7fsyw1c87/13.png" alt="img"></p>
<p>ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼Œ10.1.0.1å‘å‡ºpingåŒ…ï¼Œ192.168.1.147è¿›è¡Œå›åº”ï¼Œæ­£æ˜¯Aä¸»æœºçš„IPåœ°å€ï¼ˆç”¨äºæ¨¡æ‹Ÿå…¬ç½‘IPçš„IPåœ°å€ï¼‰</p>
<p>çœ‹æ¥ï¼Œåªæ˜¯ç”¨äºé…ç½®SNATçš„è¯ï¼Œæˆ‘ä»¬å¹¶ä¸ç”¨ æ‰‹åŠ¨çš„è¿›è¡ŒDNATè®¾ç½®ï¼Œiptablesä¼šè‡ªåŠ¨ç»´æŠ¤NATè¡¨ï¼Œå¹¶å°†å“åº”æŠ¥æ–‡çš„ç›®æ ‡åœ°å€è½¬æ¢å›æ¥ã€‚</p>
<p>é‚£ä¹ˆï¼Œæˆ‘ä»¬å»Aä¸»æœºä¸Šå†æ¬¡é‡å¤ä¸€éåˆšæ‰çš„æ“ä½œï¼Œåœ¨Aä¸»æœºä¸ŠæŠ“åŒ…çœ‹çœ‹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒCä¸»æœºä¸Šç»§ç»­å‘Aä¸»æœºçš„å…¬ç½‘IPå‘é€pingè¯·æ±‚ï¼Œåœ¨ä¸»æœºAçš„ç½‘å¡ä¸ŠæŠ“åŒ…çœ‹çœ‹ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifaoy000upwr7fsyw1c87/14.png" alt="img"></p>
<p>ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼ŒCä¸»æœºå‘Aä¸»æœºå‘èµ·pingè¯·æ±‚æ—¶å¾—åˆ°äº†å›åº”ï¼Œä½†æ˜¯åœ¨Aä¸»æœºä¸Šï¼Œå¹¶ä¸çŸ¥é“æ˜¯Cä¸»æœºå‘æ¥çš„pingè¯·æ±‚ï¼ŒAä¸»æœºä»¥ä¸ºæ˜¯Bä¸»æœºå‘æ¥çš„pingè¯·æ±‚ï¼Œä»æŠ“åŒ…çš„ä¿¡æ¯æ¥çœ‹ï¼ŒAä¸»æœºä»¥ä¸ºBä¸»æœºé€šè¿‡å…¬ç½‘IPï¼š192.168.1.146å‘è‡ªå·±å‘èµ·äº†pingè¯·æ±‚ï¼Œè€ŒAä¸»æœºä¹Ÿå°†å“åº”æŠ¥æ–‡å›åº”ç»™äº†Bä¸»æœºï¼Œæ‰€ä»¥ï¼Œæ•´ä¸ªè¿‡ç¨‹ï¼ŒAä¸»æœºéƒ½ä¸çŸ¥é“Cä¸»æœºçš„å­˜åœ¨ï¼Œéƒ½ä»¥ä¸ºæ˜¯Bä¸»æœºåœ¨å‘è‡ªå·±å‘é€è¯·æ±‚ï¼Œå³ä½¿ä¸æ˜¯åœ¨å…¬ç½‘ç§ç½‘çš„åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½å¤Ÿä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œéšè—ç½‘ç»œå†…çš„ä¸»æœºï¼Œåªä¸è¿‡æ­¤å¤„ï¼Œæˆ‘ä»¬æ‰€æè¿°çš„ç¯å¢ƒå°±æ˜¯ç§ç½‘ä¸»æœºå…±äº«å…¬ç½‘IPè®¿é—®äº’è”ç½‘ï¼Œé‚£ä¹ˆå¯ä»¥çœ‹åˆ°ï¼Œç§ç½‘ä¸­çš„ä¸»æœºå·²ç»å…±äº«äº†192.168.1.146è¿™ä¸ªâ€ä¼ªå…¬ç½‘IPâ€ï¼Œé‚£ä¹ˆçœŸçš„å…±äº«äº†å—ï¼Ÿæˆ‘ä»¬ä½¿ç”¨å†…ç½‘ä¸»æœºDè¯•è¯•ï¼Œä¸»æœºDæ˜¯ä¸€å°windowsè™šæ‹Ÿæœºï¼Œæˆ‘ä»¬ä½¿ç”¨å®ƒå‘ä¸»æœºAå‘é€pingè¯·æ±‚ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½pingé€šã€‚å¦‚ä¸‹</p>
<p><img src="/2022/06/13/uncatalog/cl4cifaoy000upwr7fsyw1c87/15.png" alt="img"></p>
<p>windowsä¸»æœºä¹Ÿpingé€šäº†å¤–ç½‘ä¸»æœºï¼Œåœ¨Aä¸»æœºä¸ŠæŠ“åŒ…ï¼Œçœ‹åˆ°çš„ä»ç„¶æ˜¯Bä¸»æœºçš„IPåœ°å€ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifaoy000upwr7fsyw1c87/101.png" alt="img"></p>
<p>é‚£ä¹ˆï¼ŒCä¸»æœºä¸Dä¸»æœºèƒ½å¤Ÿè®¿é—®å¤–ç½‘æœåŠ¡å—ï¼Ÿæˆ‘ä»¬æ¥çœ‹çœ‹ã€‚</p>
<p>åœ¨Cä¸»æœºä¸Šè®¿é—®Aä¸»æœºçš„webæœåŠ¡ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè®¿é—®æ­£å¸¸ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifaoy000upwr7fsyw1c87/102.png" alt="img"><br>åŒç†ï¼Œåœ¨windowsä¸»æœºä¸­è®¿é—®Aä¸»æœºçš„webæœåŠ¡ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè®¿é—®æ­£å¸¸ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifaoy000upwr7fsyw1c87/103.png" alt="img"></p>
<p>å¥½äº†ï¼Œæºåœ°å€è½¬æ¢ï¼Œå·²ç»å®Œæˆäº†ï¼Œæˆ‘ä»¬åªä¾é äº†ä¸€æ¡iptablesè§„åˆ™ï¼Œå°±èƒ½å¤Ÿä½¿å†…ç½‘ä¸»æœºèƒ½å¤Ÿå…±äº«å…¬ç½‘IPè®¿é—®äº’è”ç½‘äº†ã€‚</p>
<h3 id="åŠ¨ä½œDNAT"><a href="#åŠ¨ä½œDNAT" class="headerlink" title="åŠ¨ä½œDNAT"></a>åŠ¨ä½œDNAT</h3><p>å…¬å¸åªæœ‰ä¸€ä¸ªå…¬ç½‘IPï¼Œä½†æ˜¯å…¬å¸çš„å†…ç½‘ä¸­å´æœ‰å¾ˆå¤šæœåŠ¡å™¨æä¾›å„ç§æœåŠ¡ï¼Œæˆ‘ä»¬æƒ³è¦é€šè¿‡å…¬ç½‘è®¿é—®è¿™äº›æœåŠ¡ï¼Œæ”¹æ€ä¹ˆåŠå‘¢ï¼Ÿ</p>
<p>æ²¡é”™ï¼Œä½¿ç”¨DNATå³å¯ï¼Œæˆ‘ä»¬å¯¹å¤–å®£ç§°ï¼Œå…¬å¸çš„å…¬ç½‘IPä¸Šæ—¢æä¾›äº†webæœåŠ¡ï¼Œä¹Ÿæä¾›äº†windowsè¿œç¨‹æ¡Œé¢ï¼Œä¸ç®¡æ˜¯è®¿é—®webæœåŠ¡è¿˜æ˜¯è¿œç¨‹æ¡Œé¢ï¼Œåªè¦è®¿é—®è¿™ä¸ªå…¬ç½‘IPå°±è¡Œäº†ï¼Œæˆ‘ä»¬åˆ©ç”¨DNATï¼Œå°†å…¬ç½‘å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„æŠ¥æ–‡çš„ç›®æ ‡åœ°å€ä¸ç«¯å£å·åšäº†æ˜ å°„ï¼Œå°†è®¿é—®webæœåŠ¡çš„æŠ¥æ–‡è½¬å‘åˆ°äº†å†…ç½‘ä¸­çš„Cä¸»æœºä¸­ï¼Œå°†è®¿é—®è¿œç¨‹æ¡Œé¢çš„æŠ¥æ–‡è½¬å‘åˆ°äº†å†…ç½‘ä¸­çš„Dä¸»æœºä¸­ã€‚</p>
<p>å¥½äº†ï¼Œç†è®ºè¯´å®Œäº†ï¼Œæ¥åŠ¨æ‰‹å®è·µä¸€ä¸‹ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬æƒ³è¦å®ç°åˆšæ‰æè¿°çš„åœºæ™¯ï¼Œåˆ™éœ€è¦åœ¨Bä¸»æœºä¸­è¿›è¡Œå¦‚ä¸‹é…ç½®ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifaoy000upwr7fsyw1c87/16.png" alt="img"><br>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬å…ˆå°†natè¡¨ä¸­çš„è§„åˆ™æ¸…ç©ºäº†ï¼Œä»å¤´æ¥è¿‡ï¼Œæ¸…ç©ºnatè¡¨è§„åˆ™åï¼Œå®šä¹‰äº†ä¸€æ¡DNATè§„åˆ™ã€‚</p>
<ul>
<li><p>-t nat -I PREROUTINGâ€è¡¨ç¤ºåœ¨natè¡¨ä¸­çš„PREROUTINGé“¾ä¸­é…ç½®DNATè§„åˆ™ï¼ŒDNATè§„åˆ™åªé…ç½®åœ¨PREROUTINGé“¾ä¸OUTPUTé“¾ä¸­ã€‚</p>
</li>
<li><p>â€œ-d 192.168.1.146 -p tcp â€“dport 3389â€³è¡¨ç¤ºæŠ¥æ–‡çš„ç›®æ ‡åœ°å€ä¸ºå…¬å¸çš„å…¬ç½‘IPåœ°å€ï¼Œç›®æ ‡ç«¯å£ä¸ºtcpçš„3389å·ç«¯å£ï¼Œè€Œæˆ‘ä»¬çŸ¥é“ï¼Œwindowsè¿œç¨‹æ¡Œé¢ä½¿ç”¨çš„é»˜è®¤ç«¯å£å·å°±æ˜¯3389ï¼Œå½“å¤–éƒ¨ä¸»æœºè®¿é—®å…¬å¸å…¬ç½‘IPçš„3389å·ç«¯å£æ—¶ï¼ŒæŠ¥æ–‡åˆ™ç¬¦åˆåŒ¹é…æ¡ä»¶ã€‚</p>
</li>
<li><p>â€œ-j DNAT â€“to-destination 10.1.0.6:3389â€³è¡¨ç¤ºå°†ç¬¦åˆæ¡ä»¶çš„æŠ¥æ–‡è¿›è¡ŒDNATï¼Œä¹Ÿå°±æ˜¯ç›®æ ‡åœ°å€è½¬æ¢ï¼Œå°†ç¬¦åˆæ¡ä»¶çš„æŠ¥æ–‡çš„ç›®æ ‡åœ°å€ä¸ç›®æ ‡ç«¯å£ä¿®æ”¹ä¸º10.1.0.6:3389ï¼Œâ€â€“to-destinationâ€å°±æ˜¯åŠ¨ä½œDNATçš„å¸¸ç”¨é€‰é¡¹ã€‚</p>
</li>
</ul>
<p>é‚£ä¹ˆç»¼ä¸Šæ‰€è¿°ï¼Œä¸Šå›¾ä¸­å®šä¹‰çš„è§„åˆ™çš„å«ä¹‰ä¸ºï¼Œå½“å¤–ç½‘ä¸»æœºè®¿é—®å…¬å¸å…¬ç½‘IPçš„3389æ—¶ï¼Œå…¶æŠ¥æ–‡çš„ç›®æ ‡åœ°å€ä¸ç«¯å£å°†ä¼šè¢«æ˜ å°„åˆ°10.1.0.6:3389ä¸Šã€‚</p>
<p>å¥½äº†ï¼ŒDNATè§„åˆ™å®šä¹‰å®Œäº†ï¼Œç°åœ¨èƒ½å¤Ÿç›´æ¥ä½¿ç”¨å¤–ç½‘ä¸»æœºè®¿é—®ç§ç½‘ä¸­çš„æœåŠ¡äº†å—ï¼Ÿ</p>
<p>ç†è®ºä¸Šåªè¦å®Œæˆä¸Šè¿°DNATé…ç½®è§„åˆ™å³å¯ï¼Œä½†æ˜¯åœ¨æµ‹è¯•æ—¶ï¼Œåªé…ç½®DNATè§„åˆ™åï¼Œå¹¶ä¸èƒ½æ­£å¸¸DNATï¼Œç»è¿‡æµ‹è¯•å‘ç°ï¼Œå°†ç›¸åº”çš„SNATè§„åˆ™åŒæ—¶é…ç½®åï¼Œå³å¯æ­£å¸¸DNATï¼Œäºæ˜¯æˆ‘ä»¬åˆé…ç½®äº†SNAT</p>
<p>ç¤ºä¾‹å¦‚ä¸‹ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifaoy000upwr7fsyw1c87/17.png" alt="img"></p>
<p>æ³¨ï¼šç†è®ºä¸Šåªé…ç½®DNATè§„åˆ™å³å¯ï¼Œä½†æ˜¯å¦‚æœåœ¨æµ‹è¯•æ—¶æ— æ³•æ­£å¸¸DNATï¼Œå¯ä»¥å°è¯•é…ç½®å¯¹åº”çš„SNATï¼Œæ­¤å¤„æŒ‰ç…§é…ç½®SNATçš„æµç¨‹è¿›è¡Œã€‚</p>
<p>æ²¡é”™ï¼Œä¸åˆšæ‰å®šä¹‰SNATæ—¶ä½¿ç”¨çš„è§„åˆ™å®Œå…¨ä¸€æ ·ã€‚</p>
<p>å¥½äº†ï¼Œå®Œæˆä¸Šè¿°é…ç½®åï¼Œæˆ‘ä»¬åˆ™å¯ä»¥é€šè¿‡Bä¸»æœºçš„å…¬ç½‘IPï¼Œè¿æ¥Dä¸»æœºï¼ˆwindowsä¸»æœºï¼‰çš„è¿œç¨‹æ¡Œé¢äº†ï¼Œç¤ºä¾‹å¦‚ä¸‹ã€‚</p>
<p>æ‰¾åˆ°å…¬ç½‘ä¸­çš„ä¸€å°windowsä¸»æœºï¼Œæ‰“å¼€è¿œç¨‹ç¨‹åº</p>
<p><img src="/2022/06/13/uncatalog/cl4cifaoy000upwr7fsyw1c87/18.png" alt="img"></p>
<p>è¾“å…¥å…¬å¸çš„å…¬ç½‘IPï¼Œç‚¹å‡»è¿æ¥æŒ‰é’®</p>
<p>æ³¨æ„ï¼šæ²¡æœ‰æŒ‡å®šç«¯å£çš„æƒ…å†µä¸‹ï¼Œé»˜è®¤ä½¿ç”¨3389ç«¯å£è¿›è¡Œè¿æ¥ï¼ŒåŒæ—¶ï¼Œä¸ºäº†ç¡®ä¿èƒ½å¤Ÿè¿æ¥åˆ°windowsè™šæ‹Ÿä¸»æœºï¼Œè¯·å°†windowsè™šæ‹Ÿä¸»æœºè®¾ç½®ä¸ºå…è®¸è¿œç¨‹è¿æ¥ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifaoy000upwr7fsyw1c87/19.png" alt="img"></p>
<p>è¾“å…¥è¿œç¨‹è¿æ¥ç”¨æˆ·çš„å¯†ç ä»¥åï¼Œå³å¯è¿æ¥åˆ°windowsä¸»æœº</p>
<p><img src="/2022/06/13/uncatalog/cl4cifaoy000upwr7fsyw1c87/20.png" alt="img"><br>è¿æ¥ä»¥åï¼Œè¿œç¨‹è¿æ¥ç¨‹åºæ˜¾ç¤ºæˆ‘ä»¬è¿æ¥åˆ°äº†å…¬å¸çš„å…¬ç½‘IPï¼Œä½†æ˜¯å½“æˆ‘ä»¬æŸ¥çœ‹IPåœ°å€æ—¶ï¼Œå‘ç°è¢«è¿œç¨‹æœºå™¨çš„IPåœ°å€å…¶å®æ˜¯å…¬å¸ç§ç½‘ä¸­çš„Dä¸»æœºçš„IPåœ°å€ã€‚</p>
<p>ä¸Šå›¾è¯æ˜ï¼Œæˆ‘ä»¬å·²ç»æˆåŠŸçš„é€šè¿‡å…¬ç½‘IPè®¿é—®åˆ°äº†å†…ç½‘ä¸­çš„æœåŠ¡ã€‚</p>
<p>åŒç†ï¼Œä½¿ç”¨ç±»ä¼¼çš„æ–¹æ³•ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½å¤Ÿåœ¨å¤–ç½‘ä¸­è®¿é—®åˆ°Cä¸»æœºæä¾›çš„webæœåŠ¡ã€‚</p>
<p>ç¤ºä¾‹å¦‚ä¸‹ã€‚<br><img src="/2022/06/13/uncatalog/cl4cifaoy000upwr7fsyw1c87/21.png" alt="img"></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬å°†å…¬å¸å…¬ç½‘IPçš„801å·ç«¯å£æ˜ å°„åˆ°äº†å…¬å¸å†…ç½‘ä¸­Cä¸»æœºçš„80ç«¯å£ï¼Œæ‰€ä»¥ï¼Œå½“å¤–ç½‘ä¸»æœºè®¿é—®å…¬å¸å…¬ç½‘IPçš„801ç«¯å£æ—¶ï¼ŒæŠ¥æ–‡å°†ä¼šå‘é€åˆ°Cä¸»æœºçš„80ç«¯å£ä¸Šã€‚</p>
<p>è¿™æ¬¡ï¼Œæˆ‘ä»¬ä¸ç”¨å†æ¬¡å®šä¹‰SNATè§„åˆ™äº†ï¼Œå› ä¸ºä¹‹å‰å·²ç»å®šä¹‰è¿‡SNATè§„åˆ™ï¼Œä¸Šæ¬¡å®šä¹‰çš„SNATè§„åˆ™åªè¦å®šä¹‰ä¸€æ¬¡å°±è¡Œï¼Œè€ŒDNATè§„åˆ™åˆ™éœ€è¦æ ¹æ®å®é™…çš„æƒ…å†µå»å®šä¹‰ã€‚</p>
<p>å¥½äº†ï¼Œå®Œæˆä¸Šè¿°DNATæ˜ å°„åï¼Œæˆ‘ä»¬åœ¨Aä¸»æœºä¸Šè®¿é—®Bä¸»æœºçš„801ç«¯å£è¯•è¯•ï¼Œå¦‚ä¸‹</p>
<p><img src="/2022/06/13/uncatalog/cl4cifaoy000upwr7fsyw1c87/22.png" alt="img"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬è®¿é—®çš„æ˜¯Bä¸»æœºçš„å…¬ç½‘IPï¼Œä½†æ˜¯è¿”å›ç»“æœæ˜¾ç¤ºçš„å´æ˜¯Cä¸»æœºæä¾›çš„æœåŠ¡å†…å®¹ï¼Œè¯æ˜DNATå·²ç»æˆåŠŸã€‚</p>
<p>è€Œä¸Šè¿°è¿‡ç¨‹ä¸­ï¼Œå¤–ç½‘ä¸»æœºAè®¿é—®çš„å§‹ç»ˆéƒ½æ˜¯å…¬å¸çš„å…¬ç½‘IPï¼Œä½†æ˜¯æä¾›æœåŠ¡çš„å´æ˜¯å†…ç½‘ä¸»æœºï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥å¯¹å¤–å®£ç§°ï¼Œå…¬ç½‘IPä¸Šæä¾›äº†æŸäº›æœåŠ¡ï¼Œå¿«æ¥è®¿é—®å§ï¼</p>
<p>æˆ‘è§‰å¾—æˆ‘è¯´æ˜ç™½äº†ï¼Œä½ å¬æ˜ç™½äº†å—ï¼Ÿ</p>
<h3 id="åŠ¨ä½œMASQUERADE"><a href="#åŠ¨ä½œMASQUERADE" class="headerlink" title="åŠ¨ä½œMASQUERADE"></a>åŠ¨ä½œMASQUERADE</h3><p>ä¸Šæ–‡ä¸­ï¼Œæˆ‘ä»¬å·²ç»æè¿°äº†SNATï¼Œä¹Ÿå°±æ˜¯æºåœ°å€è½¬æ¢ï¼Œé‚£ä¹ˆæˆ‘ä»¬ç°åœ¨æ¥è®¤è¯†ä¸€ä¸ªä¸SNATç±»ä¼¼çš„åŠ¨ä½œï¼šMASQUERADE</p>
<p>å½“æˆ‘ä»¬æ‹¨å·ç½‘ä¸Šæ—¶ï¼Œæ¯æ¬¡åˆ†é…çš„IPåœ°å€å¾€å¾€ä¸åŒï¼Œä¸ä¼šé•¿æœŸåˆ†ç»™æˆ‘ä»¬ä¸€ä¸ªå›ºå®šçš„IPåœ°å€ï¼Œå¦‚æœè¿™æ—¶ï¼Œæˆ‘ä»¬æƒ³è¦è®©å†…ç½‘ä¸»æœºå…±äº«å…¬ç½‘IPä¸Šç½‘ï¼Œå°±ä¼šå¾ˆéº»çƒ¦ï¼Œå› ä¸ºæ¯æ¬¡IPåœ°å€å‘ç”Ÿå˜åŒ–ä»¥åï¼Œæˆ‘ä»¬éƒ½è¦é‡æ–°é…ç½®SNATè§„åˆ™ï¼Œè¿™æ ·æ˜¾ç¤ºä¸æ˜¯å¾ˆäººæ€§åŒ–ï¼Œæˆ‘ä»¬é€šè¿‡MASQUERADEå³å¯è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒMASQUERADEä¼šåŠ¨æ€çš„å°†æºåœ°å€è½¬æ¢ä¸ºå¯ç”¨çš„IPåœ°å€ï¼Œå…¶å®ä¸SNATå®ç°çš„åŠŸèƒ½å®Œå…¨ä¸€è‡´ï¼Œéƒ½æ˜¯ä¿®æ”¹æºåœ°å€ï¼Œåªä¸è¿‡SNATéœ€è¦æŒ‡æ˜å°†æŠ¥æ–‡çš„æºåœ°å€æ”¹ä¸ºå“ªä¸ªIPï¼Œè€ŒMASQUERADEåˆ™ä¸ç”¨æŒ‡å®šæ˜ç¡®çš„IPï¼Œä¼šåŠ¨æ€çš„å°†æŠ¥æ–‡çš„æºåœ°å€ä¿®æ”¹ä¸ºæŒ‡å®šç½‘å¡ä¸Šå¯ç”¨çš„IPåœ°å€ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<p><img src="/2022/06/13/uncatalog/cl4cifaoy000upwr7fsyw1c87/23.png" alt="img"></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬æŒ‡å®šï¼Œé€šè¿‡å¤–ç½‘ç½‘å¡å‡ºå»çš„æŠ¥æ–‡åœ¨ç»è¿‡POSTROUTINGé“¾æ—¶ï¼Œä¼šè‡ªåŠ¨å°†æŠ¥æ–‡çš„æºåœ°å€ä¿®æ”¹ä¸ºå¤–ç½‘ç½‘å¡ä¸Šå¯ç”¨çš„IPåœ°å€ï¼Œè¿™æ—¶ï¼Œå³ä½¿å¤–ç½‘ç½‘å¡ä¸­çš„å…¬ç½‘IPåœ°å€å‘ç”Ÿäº†æ”¹å˜ï¼Œä¹Ÿèƒ½å¤Ÿæ­£å¸¸çš„ã€åŠ¨æ€çš„å°†å†…éƒ¨ä¸»æœºçš„æŠ¥æ–‡çš„æºIPæ˜ å°„ä¸ºå¯¹åº”çš„å…¬ç½‘IPã€‚</p>
<p>å¯ä»¥æŠŠMASQUERADEç†è§£ä¸ºåŠ¨æ€çš„ã€è‡ªåŠ¨åŒ–çš„SNATï¼Œå¦‚æœæ²¡æœ‰åŠ¨æ€SNATçš„éœ€æ±‚ï¼Œæ²¡æœ‰å¿…è¦ä½¿ç”¨MASQUERADEï¼Œå› ä¸ºSNATæ›´åŠ é«˜æ•ˆã€‚</p>
<h3 id="åŠ¨ä½œREDIRECT"><a href="#åŠ¨ä½œREDIRECT" class="headerlink" title="åŠ¨ä½œREDIRECT"></a>åŠ¨ä½œREDIRECT</h3><p>ä½¿ç”¨REDIRECTåŠ¨ä½œå¯ä»¥åœ¨æœ¬æœºä¸Šè¿›è¡Œç«¯å£æ˜ å°„</p>
<p>æ¯”å¦‚ï¼Œå°†æœ¬æœºçš„80ç«¯å£æ˜ å°„åˆ°æœ¬æœºçš„8080ç«¯å£ä¸Š</p>
<p>iptables -t nat -A PREROUTING -p tcp â€“dport 80 -j REDIRECT â€“to-ports 8080</p>
<p>ç»è¿‡ä¸Šè¿°è§„åˆ™æ˜ å°„åï¼Œå½“åˆ«çš„æœºå™¨è®¿é—®æœ¬æœºçš„80ç«¯å£æ—¶ï¼ŒæŠ¥æ–‡ä¼šè¢«é‡å®šå‘åˆ°æœ¬æœºçš„8080ç«¯å£ä¸Šã€‚</p>
<p>REDIRECTè§„åˆ™åªèƒ½å®šä¹‰åœ¨PREROUTINGé“¾æˆ–è€…OUTPUTé“¾ä¸­ã€‚</p>
<h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>ä¸ºäº†æ–¹ä¾¿ä»¥åå›é¡¾ï¼Œæˆ‘ä»¬å¯¹ä¸Šè¿°å‘½ä»¤è¿›è¡Œæ€»ç»“ã€‚</p>
<p>å¦‚æœæƒ³è¦NATåŠŸèƒ½èƒ½å¤Ÿæ­£å¸¸ä½¿ç”¨ï¼Œéœ€è¦å¼€å¯Linuxä¸»æœºçš„æ ¸å¿ƒè½¬å‘åŠŸèƒ½ã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">echo 1 &gt; /proc/sys/net/ipv4/ip_forward</span><br></pre></td></tr></table></figure></div>


<h4 id="SNATç›¸å…³æ“ä½œ"><a href="#SNATç›¸å…³æ“ä½œ" class="headerlink" title="SNATç›¸å…³æ“ä½œ"></a>SNATç›¸å…³æ“ä½œ</h4><p>é…ç½®SNATï¼Œå¯ä»¥éšè—ç½‘å†…ä¸»æœºçš„IPåœ°å€ï¼Œä¹Ÿå¯ä»¥å…±äº«å…¬ç½‘IPï¼Œè®¿é—®äº’è”ç½‘ï¼Œå¦‚æœåªæ˜¯å…±äº«IPçš„è¯ï¼Œåªé…ç½®å¦‚ä¸‹SNATè§„åˆ™å³å¯ã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">iptables -t nat -A POSTROUTING -s 10.1.0.0/16 -j SNAT --to-source å…¬ç½‘IP</span><br></pre></td></tr></table></figure></div>


<p>å¦‚æœå…¬ç½‘IPæ˜¯åŠ¨æ€è·å–çš„ï¼Œä¸æ˜¯å›ºå®šçš„ï¼Œåˆ™å¯ä»¥ä½¿ç”¨MASQUERADEè¿›è¡ŒåŠ¨æ€çš„SNATæ“ä½œï¼Œå¦‚ä¸‹å‘½ä»¤è¡¨ç¤ºå°†10.1ç½‘æ®µçš„æŠ¥æ–‡çš„æºIPä¿®æ”¹ä¸ºeth0ç½‘å¡ä¸­å¯ç”¨çš„åœ°å€ã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">iptables -t nat -A POSTROUTING -s 10.1.0.0/16 -o eth0 -j MASQUERADE</span><br></pre></td></tr></table></figure></div>


<h4 id="DNATç›¸å…³æ“ä½œ"><a href="#DNATç›¸å…³æ“ä½œ" class="headerlink" title="DNATç›¸å…³æ“ä½œ"></a>DNATç›¸å…³æ“ä½œ</h4><p>é…ç½®DNATï¼Œå¯ä»¥é€šè¿‡å…¬ç½‘IPè®¿é—®å±€åŸŸç½‘å†…çš„æœåŠ¡ã€‚</p>
<p>æ³¨ï¼šç†è®ºä¸Šæ¥è¯´ï¼Œåªè¦é…ç½®DNATè§„åˆ™ï¼Œä¸éœ€è¦å¯¹åº”çš„SNATè§„åˆ™å³å¯è¾¾åˆ°DNATæ•ˆæœã€‚</p>
<p>ä½†æ˜¯åœ¨æµ‹è¯•DNATæ—¶ï¼Œå¯¹åº”SNATè§„åˆ™ä¹Ÿéœ€è¦é…ç½®ï¼Œæ‰èƒ½æ­£å¸¸DNATï¼Œå¯ä»¥å…ˆå°è¯•åªé…ç½®DNATè§„åˆ™ï¼Œå¦‚æœæ— æ³•æ­£å¸¸DNATï¼Œå†å°è¯•æ·»åŠ å¯¹åº”çš„SNATè§„åˆ™ï¼ŒSNATè§„åˆ™é…ç½®ä¸€æ¡å³å¯ï¼ŒDNATè§„åˆ™éœ€è¦æ ¹æ®å®é™…æƒ…å†µé…ç½®ä¸åŒçš„DNATè§„åˆ™ã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">iptables -t nat -I PREROUTING -d å…¬ç½‘IP -p tcp --dport å…¬ç½‘ç«¯å£ -j DNAT --to-destination ç§ç½‘IP:ç«¯å£å·</span><br><span class="line">iptables -t nat -I PREROUTING -d å…¬ç½‘IP -p tcp --dport 8080 -j DNAT --to-destination 10.1.0.1:80</span><br><span class="line">iptables -t nat -A POSTROUTING -s 10.1.0.0/16 -j SNAT --to-source å…¬ç½‘IP</span><br></pre></td></tr></table></figure></div>


<p>åœ¨æœ¬æœºè¿›è¡Œç›®æ ‡ç«¯å£æ˜ å°„æ—¶å¯ä»¥ä½¿ç”¨REDIRECTåŠ¨ä½œã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">iptables -t nat -A PREROUTING -p tcp --dport 80 -j REDIRECT --to-ports 8080</span><br></pre></td></tr></table></figure></div>
<p>é…ç½®å®Œæˆä¸Šè¿°è§„åˆ™åï¼Œå…¶ä»–æœºå™¨è®¿é—®æœ¬æœºçš„80ç«¯å£æ—¶ï¼Œä¼šè¢«æ˜ å°„åˆ°8080ç«¯å£ã€‚</p>
]]></content>
      <tags>
        <tag>äº‘åŸç”ŸåŸºç¡€ç³»åˆ—</tag>
        <tag>Kubernetesç½‘ç»œ</tag>
      </tags>
  </entry>
  <entry>
    <title>Kubernetesç½‘ç»œç³»åˆ—ä¹‹(äºŒåä¸‰)iptablesè§„åˆ™ç®¡ç†</title>
    <url>/2022/06/13/uncatalog/cl4cifap3000vpwr7cqad5sgx/</url>
    <content><![CDATA[<hr>
<span id="more"></span>

<hr>
<p>ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å·²ç»å­¦ä¼šäº†æ€æ ·ä½¿ç”¨iptableså‘½ä»¤æŸ¥çœ‹è§„åˆ™ï¼Œé‚£ä¹ˆè¿™ç¯‡æ–‡ç« æˆ‘ä»¬å°±æ¥æ€»ç»“ä¸€ä¸‹ï¼Œæ€æ ·ç®¡ç†è§„åˆ™ã€‚</p>
<p>ä¹‹å‰ï¼Œæˆ‘ä»¬æŠŠæŸ¥çœ‹iptablesè§„åˆ™çš„æ“ä½œæ¯”ä½œâ€å¢åˆ æ”¹æŸ¥â€å½“ä¸­çš„â€æŸ¥â€ï¼Œé‚£ä¹ˆåœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°±èŠèŠæ€æ ·å¯¹iptablesè¿›è¡Œâ€å¢ã€åˆ ã€æ”¹â€æ“ä½œã€‚</p>
<p>æ³¨æ„ï¼šåœ¨å‚ç…§æœ¬æ–‡è¿›è¡Œiptableså®éªŒæ—¶ï¼Œè¯·åŠ¡å¿…åœ¨ä¸ªäººçš„æµ‹è¯•æœºä¸Šè¿›è¡Œï¼Œå› ä¸ºå¦‚æœiptablesè§„åˆ™è®¾ç½®ä¸å½“ï¼Œæœ‰å¯èƒ½ä½¿ä½ æ— æ³•è¿æ¥åˆ°è¿œç¨‹ä¸»æœºä¸­ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifap3000vpwr7cqad5sgx/1.png" alt="image"></p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬æ¥å›é¡¾ä¸€ä¸‹ä»€ä¹ˆæ˜¯iptablesçš„è§„åˆ™ã€‚</p>
<p>ä¹‹å‰æ‰“è¿‡ä¸€ä¸ªæ¯”æ–¹ï¼Œæ¯æ¡â€é“¾â€éƒ½æ˜¯ä¸€ä¸ªâ€å…³å¡â€ï¼Œæ¯ä¸ªé€šè¿‡è¿™ä¸ªâ€å…³å¡â€çš„æŠ¥æ–‡éƒ½è¦åŒ¹é…è¿™ä¸ªå…³å¡ä¸Šçš„è§„åˆ™ï¼Œå¦‚æœåŒ¹é…ï¼Œåˆ™å¯¹æŠ¥æ–‡è¿›è¡Œå¯¹åº”çš„å¤„ç†ï¼Œæ¯”å¦‚è¯´ï¼Œä½ æˆ‘äºŒäººæ­¤åˆ»å°±å¥½åƒä¸¤ä¸ªâ€æŠ¥æ–‡â€ï¼Œä½ æˆ‘äºŒäººæ­¤åˆ»éƒ½è¦å…¥å…³ï¼Œå¯æ˜¯åŸä¸»æœ‰å‘½ï¼Œåªæœ‰å™¨å®‡è½©æ˜‚ä¹‹äººæ‰èƒ½å…¥å…³ï¼Œä¸ç¬¦åˆæ­¤æ¡ä»¶çš„äººä¸èƒ½å…¥å…³ï¼Œäºæ˜¯å®ˆå…³å°†å£«æŒ‰ç…§åŸä¸»åˆ¶å®šçš„â€è§„åˆ™â€ï¼Œå¼€å§‹æ‰“é‡ä½ æˆ‘äºŒäººï¼Œæœ€ç»ˆï¼Œä½ é¡ºåˆ©å…¥å…³äº†ï¼Œè€Œæˆ‘å·²è¢«æ‹’ä¹‹é—¨å¤–ï¼Œå› ä¸ºä½ ç¬¦åˆâ€å™¨å®‡è½©æ˜‚â€çš„æ ‡å‡†ï¼Œæ‰€ä»¥æŠŠä½ â€æ”¾è¡Œâ€äº†ï¼Œè€Œæˆ‘ä¸ç¬¦åˆæ ‡å‡†ï¼Œæ‰€ä»¥æ²¡æœ‰è¢«æ”¾è¡Œï¼Œå…¶å®ï¼Œâ€å™¨å®‡è½©æ˜‚â€å°±æ˜¯ä¸€ç§â€åŒ¹é…æ¡ä»¶â€ï¼Œâ€æ”¾è¡Œâ€å°±æ˜¯ä¸€ç§â€åŠ¨ä½œâ€ï¼Œâ€åŒ¹é…æ¡ä»¶â€ä¸â€åŠ¨ä½œâ€ç»„æˆäº†è§„åˆ™ã€‚</p>
<p>åªä¸è¿‡ï¼Œåœ¨iptablesçš„ä¸–ç•Œä¸­ï¼Œæœ€å¸¸ç”¨çš„åŒ¹é…æ¡ä»¶å¹¶ä¸æ˜¯â€å™¨å®‡è½©æ˜‚â€ï¼Œè€Œæ˜¯æŠ¥æ–‡çš„â€æºåœ°å€â€ã€â€ç›®æ ‡åœ°å€â€ã€â€æºç«¯å£â€ã€â€ç›®æ ‡ç«¯å£â€ç­‰ï¼Œåœ¨iptablesçš„ä¸–ç•Œä¸­ï¼Œæœ€å¸¸ç”¨çš„åŠ¨ä½œæœ‰ACCEPTï¼ˆæ¥å—ï¼‰ã€DROPï¼ˆä¸¢å¼ƒï¼‰ã€REJECTï¼ˆæ‹’ç»ï¼‰ï¼Œå…¶ä¸­ACCEPTå°±ä¸æˆ‘ä»¬ä¸¾ä¾‹ä¸­çš„â€æ”¾è¡Œâ€ç±»ä¼¼ï¼Œä½†æ˜¯ï¼Œæˆ‘ä»¬åˆšæ‰æåˆ°çš„è¿™äº›å¹¶ä¸æ˜¯å…¨éƒ¨çš„åŒ¹é…æ¡ä»¶ä¸åŠ¨ä½œï¼Œåªæ˜¯æœ€å¸¸ç”¨çš„ä¸€äº›ç½¢äº†ï¼Œå…·ä½“çš„åŒ¹é…æ¡ä»¶ä¸åŠ¨ä½œä¸æ˜¯æˆ‘ä»¬ä»Šå¤©è®¨è®ºçš„é‡ç‚¹ï¼Œæˆ‘ä»¬ä¼šåœ¨ä»¥åçš„æ–‡ç« ä¸­å†åšæ€»ç»“ã€‚</p>
<p>å¥½äº†ï¼Œæˆ‘ä»¬å·²ç»å›é¡¾äº†è§„åˆ™çš„æ¦‚å¿µï¼Œå¹¶ä¸”å·²ç»æ˜ç™½äº†ï¼Œè§„åˆ™å¤§è‡´ç”±ä¸¤ä¸ªé€»è¾‘å•å…ƒç»„æˆï¼ŒåŒ¹é…æ¡ä»¶ä¸åŠ¨ä½œï¼Œé‚£ä¹ˆå¤šè¯´æ— ç›Šï¼Œæˆ‘ä»¬æ¥åŠ¨æ‰‹å®šä¹‰ä¸€æ¡è§„åˆ™ï¼Œæ­¤å¤„ä»ç„¶ä»¥filterè¡¨ä¸­çš„INPUTé“¾ä¸ºä¾‹ï¼Œå› ä¸ºfilterè¡¨è´Ÿè´£â€è¿‡æ»¤â€åŠŸèƒ½ï¼Œè€Œæ‰€æœ‰å‘å¾€æœ¬æœºçš„æŠ¥æ–‡å¦‚æœéœ€è¦è¢«è¿‡æ»¤ï¼Œé¦–å…ˆä¼šç»è¿‡INPUTé“¾ï¼ˆPREROUTINGé“¾æ²¡æœ‰è¿‡æ»¤åŠŸèƒ½ï¼‰ï¼Œè¿™ä¸æˆ‘ä»¬æ‰€æ¯”å–»çš„â€å…¥å…³â€åœºæ™¯éå¸¸ç›¸ä¼¼ï¼Œæ‰€ä»¥ï¼Œä½¿ç”¨filterè¡¨çš„INPUTé“¾ä¸ºä¾‹ï¼Œæœ‰åŠ©äºæˆ‘ä»¬è¿›è¡Œç†è§£ã€‚</p>
<p>é¦–å…ˆï¼ŒæŸ¥çœ‹ä¸€ä¸‹filterè¡¨ä¸­çš„INPUTé“¾ä¸­çš„è§„åˆ™ï¼ŒæŸ¥çœ‹è§„åˆ™çš„ç›¸å…³å‘½ä»¤åœ¨å‰æ–‡å·²ç»æ€»ç»“äº†ï¼Œæ­¤å¤„ä¸å†èµ˜è¿°ï¼Œå¦‚æœä½ å¿˜äº†ï¼Œè¯·å›é¡¾å‰æ–‡ã€‚</p>
<p>ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹filterè¡¨INPUTé“¾çš„è§„åˆ™ï¼Œä¸‹å›¾ä¸­çš„è§„åˆ™ä¸ºcentos6é»˜è®¤æ·»åŠ çš„è§„åˆ™ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifap3000vpwr7cqad5sgx/2.png" alt="image"></p>
<p>æ³¨æ„ï¼šåœ¨å‚ç…§æœ¬æ–‡è¿›è¡Œiptableså®éªŒæ—¶ï¼Œè¯·åŠ¡å¿…åœ¨ä¸ªäººçš„æµ‹è¯•æœºä¸Šè¿›è¡Œã€‚</p>
<p>ä¸ºäº†å‡†å¤‡ä¸€ä¸ªä»é›¶å¼€å§‹çš„ç¯å¢ƒï¼Œæˆ‘ä»¬å°†centos6é»˜è®¤æä¾›çš„è§„åˆ™æ¸…ç©ºï¼Œä»¥ä¾¿æˆ‘ä»¬è¿›è¡Œå®éªŒï¼Œä½¿ç”¨iptables -F INPUTå‘½ä»¤æ¸…ç©ºfilterè¡¨INPUTé“¾ä¸­çš„è§„åˆ™ï¼Œåé¢æˆ‘ä»¬ä¼šå•ç‹¬å¯¹æ¸…é™¤è§„åˆ™çš„ç›¸å…³å‘½ä»¤è¿›è¡Œæ€»ç»“ï¼Œæ­¤å¤„ä¸ç”¨çº ç»“æ­¤å‘½ä»¤ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifap3000vpwr7cqad5sgx/3.png" alt="image"></p>
<p>æ¸…ç©ºINPUTé“¾ä»¥åï¼Œfilterè¡¨ä¸­çš„INPUTé“¾å·²ç»ä¸å­˜åœ¨ä»»ä½•çš„è§„åˆ™ï¼Œä½†æ˜¯å¯ä»¥çœ‹å‡ºï¼ŒINPUTé“¾çš„é»˜è®¤ç­–ç•¥æ˜¯ACCEPTï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒINPUTé“¾é»˜è®¤â€æ”¾è¡Œâ€æ‰€æœ‰å‘å¾€æœ¬æœºçš„æŠ¥æ–‡ï¼Œå½“æ²¡æœ‰ä»»ä½•è§„åˆ™æ—¶ï¼Œä¼šæ¥å—æ‰€æœ‰æŠ¥æ–‡ï¼Œå½“æŠ¥æ–‡æ²¡æœ‰è¢«ä»»ä½•è§„åˆ™åŒ¹é…åˆ°æ—¶ï¼Œä¹Ÿä¼šé»˜è®¤æ”¾è¡ŒæŠ¥æ–‡ã€‚</p>
<p>é‚£ä¹ˆæ­¤åˆ»ï¼Œæˆ‘ä»¬å°±åœ¨å¦å¤–ä¸€å°æœºå™¨ä¸Šï¼Œä½¿ç”¨pingå‘½ä»¤ï¼Œå‘å½“å‰æœºå™¨å‘é€æŠ¥æ–‡ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œpingå‘½ä»¤å¯ä»¥å¾—åˆ°å›åº”ï¼Œè¯æ˜pingå‘½ä»¤å‘é€çš„æŠ¥æ–‡å·²ç»æ­£å¸¸çš„å‘é€åˆ°äº†é˜²ç«å¢™æ‰€åœ¨çš„ä¸»æœºï¼Œpingå‘½ä»¤æ‰€åœ¨æœºå™¨IPåœ°å€ä¸º146ï¼Œå½“å‰æµ‹è¯•é˜²ç«å¢™ä¸»æœºçš„IPåœ°å€ä¸º156ï¼Œæˆ‘ä»¬å°±ç”¨è¿™æ ·çš„ç¯å¢ƒï¼Œå¯¹iptablesè¿›è¡Œæ“ä½œæ¼”ç¤ºã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifap3000vpwr7cqad5sgx/4.png" alt="image"></p>
<h3 id="å¢åŠ è§„åˆ™"><a href="#å¢åŠ è§„åˆ™" class="headerlink" title="å¢åŠ è§„åˆ™"></a>å¢åŠ è§„åˆ™</h3><p>é‚£ä¹ˆæ­¤å¤„ï¼Œæˆ‘ä»¬å°±åœ¨156ä¸Šé…ç½®ä¸€æ¡è§„åˆ™ï¼Œæ‹’ç»192.168.1.146ä¸Šçš„æ‰€æœ‰æŠ¥æ–‡è®¿é—®å½“å‰æœºå™¨ï¼Œä¹‹å‰ä¸€ç›´åœ¨è¯´ï¼Œè§„åˆ™ç”±åŒ¹é…æ¡ä»¶ä¸åŠ¨ä½œç»„æˆï¼Œé‚£ä¹ˆâ€æ‹’ç»192.168.1.146ä¸Šçš„æ‰€æœ‰æŠ¥æ–‡è®¿é—®å½“å‰æœºå™¨â€è¿™æ¡è§„åˆ™ä¸­ï¼ŒæŠ¥æ–‡çš„â€æºåœ°å€ä¸º192.168.1.146â€³åˆ™å±äºåŒ¹é…æ¡ä»¶ï¼Œå¦‚æœæŠ¥æ–‡æ¥è‡ªâ€192.168.1.146â€³ï¼Œåˆ™è¡¨ç¤ºæ»¡è¶³åŒ¹é…æ¡ä»¶ï¼Œè€Œâ€æ‹’ç»â€è¿™ä¸ªæŠ¥æ–‡ï¼Œå°±å±äºå¯¹åº”çš„åŠ¨ä½œï¼Œå¥½äº†ï¼Œé‚£ä¹ˆæ€æ ·ç”¨å‘½ä»¤å»å®šä¹‰è¿™æ¡è§„åˆ™å‘¢ï¼Ÿä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å³å¯</p>
<p><img src="/2022/06/13/uncatalog/cl4cifap3000vpwr7cqad5sgx/5.png" alt="image"></p>
<p>ä¸Šå›¾ä¸­ï¼Œä½¿ç”¨ -té€‰é¡¹æŒ‡å®šäº†è¦æ“ä½œçš„è¡¨ï¼Œæ­¤å¤„æŒ‡å®šäº†æ“ä½œfilterè¡¨ï¼Œä¸ä¹‹å‰çš„æŸ¥çœ‹å‘½ä»¤ä¸€æ ·ï¼Œä¸ä½¿ç”¨-té€‰é¡¹æŒ‡å®šè¡¨æ—¶ï¼Œé»˜è®¤ä¸ºæ“ä½œfilterè¡¨ã€‚</p>
<p>ä½¿ç”¨-Ié€‰é¡¹ï¼ŒæŒ‡æ˜å°†â€è§„åˆ™â€æ’å…¥è‡³å“ªä¸ªé“¾ä¸­ï¼Œ-Iè¡¨ç¤ºinsertï¼Œå³æ’å…¥çš„æ„æ€ï¼Œæ‰€ä»¥-I INPUTè¡¨ç¤ºå°†è§„åˆ™æ’å…¥äºINPUTé“¾ä¸­ï¼Œå³æ·»åŠ è§„åˆ™ä¹‹æ„ã€‚</p>
<p>ä½¿ç”¨-sé€‰é¡¹ï¼ŒæŒ‡æ˜â€åŒ¹é…æ¡ä»¶â€ä¸­çš„â€æºåœ°å€â€ï¼Œå³å¦‚æœæŠ¥æ–‡çš„æºåœ°å€å±äº-så¯¹åº”çš„åœ°å€ï¼Œé‚£ä¹ˆæŠ¥æ–‡åˆ™æ»¡è¶³åŒ¹é…æ¡ä»¶ï¼Œ-sä¸ºsourceä¹‹æ„ï¼Œè¡¨ç¤ºæºåœ°å€ã€‚</p>
<p>ä½¿ç”¨-jé€‰é¡¹ï¼ŒæŒ‡æ˜å½“â€åŒ¹é…æ¡ä»¶â€è¢«æ»¡è¶³æ—¶ï¼Œæ‰€å¯¹åº”çš„åŠ¨ä½œï¼Œä¸Šä¾‹ä¸­æŒ‡å®šçš„åŠ¨ä½œä¸ºDROPï¼Œåœ¨ä¸Šä¾‹ä¸­ï¼Œå½“æŠ¥æ–‡çš„æºåœ°å€ä¸º192.168.1.146æ—¶ï¼ŒæŠ¥æ–‡åˆ™è¢«DROPï¼ˆä¸¢å¼ƒï¼‰ã€‚</p>
<p>å†æ¬¡æŸ¥çœ‹filterè¡¨ä¸­çš„INPUTé“¾ï¼Œå‘ç°è§„åˆ™å·²ç»è¢«æ·»åŠ äº†ï¼Œåœ¨iptablesä¸­ï¼ŒåŠ¨ä½œè¢«ç§°ä¹‹ä¸ºâ€targetâ€ï¼Œæ‰€ä»¥ï¼Œä¸Šå›¾ä¸­tagetå­—æ®µå¯¹åº”çš„åŠ¨ä½œä¸ºDROPã€‚</p>
<p>é‚£ä¹ˆæ­¤æ—¶ï¼Œæˆ‘ä»¬å†é€šè¿‡192.168.1.146å»pingä¸»æœº156ï¼Œçœ‹çœ‹èƒ½å¦pingé€šã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifap3000vpwr7cqad5sgx/6.png" alt="image"></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œping 156ä¸»æœºæ—¶ï¼ŒPINGå‘½ä»¤ä¸€ç›´æ²¡æœ‰å¾—åˆ°å›åº”ï¼Œçœ‹æ¥æˆ‘ä»¬çš„iptablesè§„åˆ™å·²ç»ç”Ÿæ•ˆäº†ï¼Œpingå‘é€çš„æŠ¥æ–‡å‹æ ¹æ²¡æœ‰è¢«156ä¸»æœºæ¥å—ï¼Œè€Œæ˜¯è¢«ä¸¢å¼ƒäº†ï¼Œæ‰€ä»¥æ›´ä¸è¦è¯´ä»€ä¹ˆå›åº”äº†ï¼Œå¥½äº†ï¼Œæˆ‘ä»¬å·²ç»æˆåŠŸçš„é…ç½®äº†ä¸€æ¡iptablesè§„åˆ™ï¼Œçœ‹æ¥ï¼Œæˆ‘ä»¬å·²ç»å…¥é—¨äº†ã€‚</p>
<p>è¿˜è®°å¾—æˆ‘ä»¬åœ¨å‰æ–‡ä¸­è¯´è¿‡çš„â€è®¡æ•°å™¨â€å—ï¼Ÿæ­¤æ—¶ï¼Œæˆ‘ä»¬å†æ¬¡æŸ¥çœ‹iptablesä¸­çš„è§„åˆ™ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œå·²ç»æœ‰24ä¸ªåŒ…è¢«å¯¹åº”çš„è§„åˆ™åŒ¹é…åˆ°ï¼Œæ€»è®¡å¤§å°2016bytesã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifap3000vpwr7cqad5sgx/7.png" alt="image"></p>
<p>æ­¤åˆ»ï¼Œæˆ‘ä»¬æ¥åšä¸€ä¸ªå®éªŒã€‚</p>
<p>ç°åœ¨INPUTé“¾ä¸­å·²ç»å­˜åœ¨äº†ä¸€æ¡è§„åˆ™ï¼Œå®ƒæ‹’ç»äº†æ‰€æœ‰æ¥è‡ª192.168.1.146ä¸»æœºä¸­çš„æŠ¥æ–‡ï¼Œå¦‚æœæ­¤æ—¶ï¼Œæˆ‘ä»¬åœ¨è¿™æ¡è§„åˆ™ä¹‹åå†é…ç½®ä¸€æ¡è§„åˆ™ï¼Œåé¢è¿™æ¡è§„åˆ™è§„å®šï¼Œæ¥å—æ‰€æœ‰æ¥è‡ª192.168.1.146ä¸»æœºä¸­çš„æŠ¥æ–‡ï¼Œé‚£ä¹ˆï¼Œiptablesæ˜¯å¦ä¼šæ¥å—æ¥è‡ª146ä¸»æœºçš„æŠ¥æ–‡å‘¢ï¼Ÿæˆ‘ä»¬åŠ¨æ‰‹è¯•è¯•ã€‚</p>
<p>ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤åœ¨filterè¡¨çš„INPUTé“¾ä¸­è¿½åŠ ä¸€æ¡è§„åˆ™ï¼Œè¿™æ¡è§„åˆ™è¡¨ç¤ºæ¥å—æ‰€æœ‰æ¥è‡ª192.168.1.146çš„å‘å¾€æœ¬æœºçš„æŠ¥æ–‡ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifap3000vpwr7cqad5sgx/8.png" alt="image"></p>
<p>ä¸Šå›¾ä¸­çš„å‘½ä»¤å¹¶æ²¡æœ‰ä½¿ç”¨-té€‰é¡¹æŒ‡å®šfilterè¡¨ï¼Œæˆ‘ä»¬ä¸€ç›´åœ¨è¯´ï¼Œä¸ä½¿ç”¨-té€‰é¡¹æŒ‡å®šè¡¨æ—¶è¡¨ç¤ºé»˜è®¤æ“ä½œfilterè¡¨ã€‚</p>
<p>ä¸Šå›¾ä¸­ï¼Œä½¿ç”¨-Aé€‰é¡¹ï¼Œè¡¨ç¤ºåœ¨å¯¹åº”çš„é“¾ä¸­â€è¿½åŠ è§„åˆ™â€ï¼Œ-Aä¸ºappendä¹‹æ„ï¼Œæ‰€ä»¥ï¼Œ-A INPUTåˆ™è¡¨ç¤ºåœ¨INPUTé“¾ä¸­è¿½åŠ è§„åˆ™ï¼Œè€Œä¹‹å‰ç¤ºä¾‹ä¸­ä½¿ç”¨çš„-Ié€‰é¡¹åˆ™è¡¨ç¤ºåœ¨é“¾ä¸­â€æ’å…¥è§„åˆ™â€ï¼Œèªæ˜å¦‚ä½ ä¸€å®šæ˜ç™½äº†ï¼Œå®ƒä»¬çš„æœ¬æ„éƒ½æ˜¯æ·»åŠ ä¸€æ¡è§„åˆ™ï¼Œåªæ˜¯-Aè¡¨ç¤ºåœ¨é“¾çš„å°¾éƒ¨è¿½åŠ è§„åˆ™ï¼Œ-Iè¡¨ç¤ºåœ¨é“¾çš„é¦–éƒ¨æ’å…¥è§„åˆ™è€Œå·²ã€‚</p>
<p>ä½¿ç”¨-jé€‰é¡¹ï¼ŒæŒ‡å®šå½“å‰è§„åˆ™å¯¹åº”çš„åŠ¨ä½œä¸ºACCEPTã€‚</p>
<p>æ‰§è¡Œå®Œæ·»åŠ è§„åˆ™çš„å‘½ä»¤åï¼Œå†æ¬¡æŸ¥çœ‹INPUTé“¾ï¼Œå‘ç°è§„åˆ™å·²ç»æˆåŠŸâ€è¿½åŠ â€è‡³INPUTé“¾çš„æœ«å°¾ï¼Œé‚£ä¹ˆç°åœ¨ï¼Œç¬¬ä¸€æ¡è§„åˆ™æŒ‡æ˜äº†ä¸¢å¼ƒæ‰€æœ‰æ¥è‡ª192.168.1.146çš„æŠ¥æ–‡ï¼Œç¬¬äºŒæ¡è§„åˆ™æŒ‡æ˜äº†æ¥å—æ‰€æœ‰æ¥è‡ª192.168.1.146çš„æŠ¥æ–‡ï¼Œé‚£ä¹ˆç»“æœåˆ°åº•æ˜¯æ€æ ·çš„å‘¢ï¼Ÿå®è·µå‡ºçœŸçŸ¥ï¼Œåœ¨146ä¸»æœºä¸Šå†æ¬¡ä½¿ç”¨pingå‘½ä»¤å‘156ä¸»æœºå‘é€æŠ¥æ–‡ï¼Œå‘ç°ä»ç„¶æ˜¯pingä¸é€šçš„ï¼Œçœ‹æ¥ç¬¬äºŒæ¡è§„åˆ™å¹¶æ²¡æœ‰ç”Ÿæ•ˆã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifap3000vpwr7cqad5sgx/9.png" alt="image"></p>
<p>è€Œä¸”ä»ä¸Šå›¾ä¸­ç¬¬äºŒæ¡è§„åˆ™çš„è®¡æ•°å™¨å¯ä»¥çœ‹åˆ°ï¼Œæ ¹æœ¬æ²¡æœ‰ä»»ä½•æŠ¥æ–‡è¢«ç¬¬äºŒæ¡è§„åˆ™åŒ¹é…åˆ°ã€‚</p>
<p>èªæ˜å¦‚ä½ ä¸€å®šåœ¨çŒœæƒ³ï¼Œå‘ç”Ÿä¸Šè¿°æƒ…å†µï¼Œä¼šä¸ä¼šä¸è§„åˆ™çš„å…ˆåé¡ºåºæœ‰å…³å‘¢ï¼Ÿæµ‹è¯•ä¸€ä¸‹ä¸å°±çŸ¥é“äº†ï¼Œæˆ‘ä»¬å†æ·»åŠ ä¸€æ¡è§„åˆ™ï¼Œæ–°è§„åˆ™ä»ç„¶è§„å®šæ¥å—æ‰€æœ‰æ¥è‡ª192.168.1.146ä¸»æœºä¸­çš„æŠ¥æ–‡ï¼Œåªæ˜¯è¿™ä¸€æ¬¡ï¼Œæˆ‘ä»¬å°†æ–°è§„åˆ™æ·»åŠ è‡³INPUTé“¾çš„æœ€å‰é¢è¯•è¯•ã€‚</p>
<p>åœ¨æ·»åŠ è¿™æ¡è§„åˆ™ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæŠŠ146ä¸Šçš„pingå‘½ä»¤å¼ºåˆ¶åœæ­¢äº†ï¼Œç„¶åä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼Œåœ¨filterè¡¨çš„INPUTé“¾çš„å‰ç«¯æ·»åŠ æ–°è§„åˆ™ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifap3000vpwr7cqad5sgx/10.png" alt="image"></p>
<p>å¥½äº†ï¼Œç°åœ¨ç¬¬ä¸€æ¡è§„åˆ™å°±æ˜¯æ¥å—æ‰€æœ‰æ¥è‡ª192.168.1.146çš„æŠ¥æ–‡ï¼Œè€Œä¸”æ­¤æ—¶è®¡æ•°æ˜¯0ï¼Œæ­¤åˆ»ï¼Œæˆ‘ä»¬å†ä»146ä¸Šå‘156å‘èµ·pingè¯·æ±‚ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifap3000vpwr7cqad5sgx/11.png" alt="image"></p>
<p>146ä¸Šå·²ç»å¯ä»¥æ­£å¸¸çš„æ”¶åˆ°å“åº”æŠ¥æ–‡äº†ï¼Œé‚£ä¹ˆå›åˆ°156æŸ¥çœ‹INPUTé“¾çš„è§„åˆ™ï¼Œç¬¬ä¸€æ¡è§„åˆ™çš„è®¡æ•°å™¨å·²ç»æ˜¾ç¤ºå‡ºäº†åŒ¹é…åˆ°çš„æŠ¥æ–‡æ•°é‡ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifap3000vpwr7cqad5sgx/12.png" alt="image"><br>çœ‹æ¥ï¼Œè§„åˆ™çš„é¡ºåºå¾ˆé‡è¦ã€‚</p>
<p>å¦‚æœæŠ¥æ–‡å·²ç»è¢«å‰é¢çš„è§„åˆ™åŒ¹é…åˆ°ï¼Œiptablesåˆ™ä¼šå¯¹æŠ¥æ–‡æ‰§è¡Œå¯¹åº”çš„åŠ¨ä½œï¼Œå³ä½¿åé¢çš„è§„åˆ™ä¹Ÿèƒ½åŒ¹é…åˆ°å½“å‰æŠ¥æ–‡ï¼Œå¾ˆæœ‰å¯èƒ½ä¹Ÿæ²¡æœ‰æœºä¼šå†å¯¹æŠ¥æ–‡æ‰§è¡Œç›¸åº”çš„åŠ¨ä½œäº†ï¼Œå°±ä»¥ä¸Šå›¾ä¸ºä¾‹ï¼ŒæŠ¥æ–‡å…ˆè¢«ç¬¬ä¸€æ¡è§„åˆ™åŒ¹é…åˆ°äº†ï¼Œäºæ˜¯å½“å‰æŠ¥æ–‡è¢«â€æ”¾è¡Œâ€äº†ï¼Œå› ä¸ºæŠ¥æ–‡å·²ç»è¢«æ”¾è¡Œäº†ï¼Œæ‰€ä»¥ï¼Œå³ä½¿ä¸Šå›¾ä¸­çš„ç¬¬äºŒæ¡è§„åˆ™å³ä½¿èƒ½å¤ŸåŒ¹é…åˆ°åˆšæ‰â€æ”¾è¡Œâ€çš„æŠ¥æ–‡ï¼Œä¹Ÿæ²¡æœ‰æœºä¼šå†å¯¹åˆšæ‰çš„æŠ¥æ–‡è¿›è¡Œä¸¢å¼ƒæ“ä½œäº†ã€‚è¿™å°±æ˜¯iptablesçš„å·¥ä½œæœºåˆ¶ã€‚</p>
<p>ä¹‹å‰åœ¨æ€»ç»“æŸ¥çœ‹å‘½ä»¤æ—¶æåˆ°è¿‡ï¼Œä½¿ç”¨â€“line-numberé€‰é¡¹å¯ä»¥åˆ—å‡ºè§„åˆ™çš„åºå·ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º<br><img src="/2022/06/13/uncatalog/cl4cifap3000vpwr7cqad5sgx/13.png" alt="image"></p>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨æ·»åŠ è§„åˆ™æ—¶ï¼ŒæŒ‡å®šæ–°å¢è§„åˆ™çš„ç¼–å·ï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½åœ¨ä»»æ„ä½ç½®æ’å…¥è§„åˆ™äº†ï¼Œæˆ‘ä»¬åªè¦æŠŠåˆšæ‰çš„å‘½ä»¤ç¨ä½œä¿®æ”¹å³å¯ï¼Œå¦‚ä¸‹ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifap3000vpwr7cqad5sgx/14.png" alt="image"></p>
<p>ä»ç„¶ä½¿ç”¨-Ié€‰é¡¹è¿›è¡Œæ’å…¥è§„åˆ™æ“ä½œï¼Œ-I INPUT 2è¡¨ç¤ºåœ¨INPUTé“¾ä¸­æ–°å¢è§„åˆ™ï¼Œæ–°å¢çš„è§„åˆ™çš„ç¼–å·ä¸º2ï¼Œå¥½äº†ï¼Œè‡ªå·±åŠ¨æ‰‹è¯•è¯•å§ã€‚</p>
<h3 id="åˆ é™¤è§„åˆ™"><a href="#åˆ é™¤è§„åˆ™" class="headerlink" title="åˆ é™¤è§„åˆ™"></a>åˆ é™¤è§„åˆ™</h3><p>æ³¨æ„ï¼šåœ¨å‚ç…§æœ¬æ–‡è¿›è¡Œiptableså®éªŒæ—¶ï¼Œè¯·åŠ¡å¿…åœ¨ä¸ªäººçš„æµ‹è¯•æœºä¸Šè¿›è¡Œã€‚</p>
<p>æ­¤åˆ»ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦åˆ é™¤filterè¡¨ä¸­INPUTä¸­çš„ä¸€æ¡è§„åˆ™ï¼Œè¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ</p>
<p>æœ‰ä¸¤ç§åŠæ³•</p>
<p>æ–¹æ³•ä¸€ï¼šæ ¹æ®è§„åˆ™çš„ç¼–å·å»åˆ é™¤è§„åˆ™</p>
<p>æ–¹æ³•äºŒï¼šæ ¹æ®å…·ä½“çš„åŒ¹é…æ¡ä»¶ä¸åŠ¨ä½œåˆ é™¤è§„åˆ™</p>
<p>é‚£ä¹ˆæˆ‘ä»¬å…ˆçœ‹çœ‹æ–¹æ³•ä¸€ï¼Œå…ˆæŸ¥çœ‹ä¸€ä¸‹filterè¡¨ä¸­INPUTé“¾ä¸­çš„è§„åˆ™</p>
<p><img src="/2022/06/13/uncatalog/cl4cifap3000vpwr7cqad5sgx/15.png" alt="image"></p>
<p>å‡å¦‚æˆ‘ä»¬æƒ³è¦åˆ é™¤ä¸Šå›¾ä¸­çš„ç¬¬3æ¡è§„åˆ™ï¼Œåˆ™å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifap3000vpwr7cqad5sgx/16.png" alt="image"></p>
<p>ä¸Šä¾‹ä¸­ï¼Œä½¿ç”¨äº†-té€‰é¡¹æŒ‡å®šäº†è¦æ“ä½œçš„è¡¨ï¼ˆæ²¡é”™ï¼Œçœç•¥-té»˜è®¤è¡¨ç¤ºæ“ä½œfilterè¡¨ï¼‰ï¼Œä½¿ç”¨-Dé€‰é¡¹è¡¨ç¤ºåˆ é™¤æŒ‡å®šé“¾ä¸­çš„æŸæ¡è§„åˆ™ï¼Œ-D INPUT 3è¡¨ç¤ºåˆ é™¤INPUTé“¾ä¸­çš„ç¬¬3æ¡è§„åˆ™ã€‚</p>
<p>å½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ ¹æ®å…·ä½“çš„åŒ¹é…æ¡ä»¶ä¸åŠ¨ä½œå»åˆ é™¤è§„åˆ™ï¼Œæ¯”å¦‚ï¼Œåˆ é™¤ä¸‹å›¾ä¸­æºåœ°å€ä¸º192.168.1.146ï¼ŒåŠ¨ä½œä¸ºACCEPTçš„è§„åˆ™ï¼Œäºæ˜¯ï¼Œåˆ é™¤è§„åˆ™çš„å‘½ä»¤å¦‚ä¸‹ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifap3000vpwr7cqad5sgx/17.png" alt="image"></p>
<p>ä¸Šå›¾ä¸­ï¼Œåˆ é™¤å¯¹åº”è§„åˆ™æ—¶ï¼Œä»ç„¶ä½¿ç”¨-Dé€‰é¡¹ï¼Œ-D INPUTè¡¨ç¤ºåˆ é™¤INPUTé“¾ä¸­çš„è§„åˆ™ï¼Œå‰©ä¸‹çš„é€‰é¡¹ä¸æˆ‘ä»¬æ·»åŠ è§„åˆ™æ—¶ä¸€æ¯›ä¸€æ ·ï¼Œ-sè¡¨ç¤ºä»¥å¯¹åº”çš„æºåœ°å€ä½œä¸ºåŒ¹é…æ¡ä»¶ï¼Œ-j ACCEPTè¡¨ç¤ºå¯¹åº”çš„åŠ¨ä½œä¸ºæ¥å—ï¼Œæ‰€ä»¥ï¼Œä¸Šè¿°å‘½ä»¤è¡¨ç¤ºåˆ é™¤INPUTé“¾ä¸­æºåœ°å€ä¸º192.168.1.146ï¼ŒåŠ¨ä½œä¸ºACCEPTçš„è§„åˆ™ã€‚</p>
<p>è€Œåˆ é™¤æŒ‡å®šè¡¨ä¸­æŸæ¡é“¾ä¸­çš„æ‰€æœ‰è§„åˆ™çš„å‘½ä»¤ï¼Œæˆ‘ä»¬åœ¨ä¸€å¼€å§‹å°±ä½¿ç”¨åˆ°äº†ï¼Œå°±æ˜¯â€iptables -t è¡¨å -F é“¾åâ€</p>
<p>-Fé€‰é¡¹ä¸ºflushä¹‹æ„ï¼Œå³å†²åˆ·æŒ‡å®šçš„é“¾ï¼Œå³åˆ é™¤æŒ‡å®šé“¾ä¸­çš„æ‰€æœ‰è§„åˆ™ï¼Œä½†æ˜¯æ³¨æ„ï¼Œæ­¤æ“ä½œç›¸å½“äºåˆ é™¤æ“ä½œï¼Œåœ¨æ²¡æœ‰ä¿å­˜iptablesè§„åˆ™çš„æƒ…å†µä¸‹ï¼Œè¯·æ…ç”¨ã€‚</p>
<p>å…¶å®ï¼Œ-Fé€‰é¡¹ä¸ä»…ä»…èƒ½æ¸…ç©ºæŒ‡å®šé“¾ä¸Šçš„è§„åˆ™ï¼Œå…¶å®å®ƒè¿˜èƒ½æ¸…ç©ºæ•´ä¸ªè¡¨ä¸­æ‰€æœ‰é“¾ä¸Šçš„è§„åˆ™ï¼Œä¸æŒ‡å®šé“¾åï¼ŒåªæŒ‡å®šè¡¨åå³å¯åˆ é™¤è¡¨ä¸­çš„æ‰€æœ‰è§„åˆ™ï¼Œå‘½ä»¤å¦‚ä¸‹</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">iptables -t è¡¨å -F</span><br></pre></td></tr></table></figure></div>

<p>ä¸è¿‡å†æ¬¡å¼ºè°ƒï¼Œåœ¨æ²¡æœ‰ä¿å­˜iptablesè§„åˆ™æ—¶ï¼Œè¯·å‹¿éšä¾¿æ¸…ç©ºé“¾æˆ–è€…è¡¨ä¸­çš„è§„åˆ™ï¼Œé™¤éä½ æ˜ç™½ä½ åœ¨å¹²ä»€ä¹ˆã€‚</p>
<h3 id="ä¿®æ”¹è§„åˆ™"><a href="#ä¿®æ”¹è§„åˆ™" class="headerlink" title="ä¿®æ”¹è§„åˆ™"></a>ä¿®æ”¹è§„åˆ™</h3><p>æ³¨æ„ï¼šåœ¨å‚ç…§æœ¬æ–‡è¿›è¡Œiptableså®éªŒæ—¶ï¼Œè¯·åŠ¡å¿…åœ¨ä¸ªäººçš„æµ‹è¯•æœºä¸Šè¿›è¡Œã€‚</p>
<p>é‚£ä¹ˆï¼Œæˆ‘ä»¬æ€æ ·ä¿®æ”¹æŸæ¡è§„åˆ™ä¸­çš„åŠ¨ä½œå‘¢ï¼Ÿæ¯”å¦‚ï¼Œæˆ‘æƒ³æŠŠå¦‚ä¸‹è§„åˆ™ä¸­çš„åŠ¨ä½œä»DROPæ”¹ä¸ºREJECTï¼Œæ”¹æ€ä¹ˆåŠå‘¢ï¼Ÿ</p>
<p><img src="/2022/06/13/uncatalog/cl4cifap3000vpwr7cqad5sgx/18.png" alt="image"></p>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨-Ré€‰é¡¹ä¿®æ”¹æŒ‡å®šçš„é“¾ä¸­çš„è§„åˆ™ï¼Œåœ¨ä¿®æ”¹è§„åˆ™æ—¶æŒ‡å®šè§„åˆ™å¯¹åº”çš„ç¼–å·å³å¯(æœ‰å‘ï¼Œæ…è¡Œ)ï¼Œç¤ºä¾‹å‘½ä»¤å¦‚ä¸‹</p>
<p><img src="/2022/06/13/uncatalog/cl4cifap3000vpwr7cqad5sgx/19.png" alt="image"></p>
<p>ä¸Šä¾‹ä¸­ï¼Œ-Ré€‰é¡¹è¡¨ç¤ºä¿®æ”¹æŒ‡å®šçš„é“¾ï¼Œä½¿ç”¨-R INPUT 1è¡¨ç¤ºä¿®æ”¹INPUTé“¾çš„ç¬¬1æ¡è§„åˆ™ï¼Œä½¿ç”¨-j REJECTè¡¨ç¤ºå°†INPUTé“¾ä¸­çš„ç¬¬ä¸€æ¡è§„åˆ™çš„åŠ¨ä½œä¿®æ”¹ä¸ºREJECTï¼Œæ³¨æ„ï¼šä¸Šä¾‹ä¸­ï¼Œ -sé€‰é¡¹ä»¥åŠå¯¹åº”çš„æºåœ°å€ä¸å¯çœç•¥ï¼Œå³ä½¿æˆ‘ä»¬å·²ç»æŒ‡å®šäº†è§„åˆ™å¯¹åº”çš„ç¼–å·ï¼Œä½†æ˜¯åœ¨ä½¿ç”¨-Ré€‰é¡¹ä¿®æ”¹æŸä¸ªè§„åˆ™æ—¶ï¼Œå¿…é¡»æŒ‡å®šè§„åˆ™å¯¹åº”çš„åŸæœ¬çš„åŒ¹é…æ¡ä»¶ï¼ˆå¦‚æœæœ‰å¤šä¸ªåŒ¹é…æ¡ä»¶ï¼Œéƒ½éœ€è¦æŒ‡å®šï¼‰ã€‚</p>
<p>å¦‚æœä¸Šä¾‹ä¸­çš„å‘½ä»¤æ²¡æœ‰ä½¿ç”¨-sæŒ‡å®šå¯¹åº”è§„åˆ™ä¸­åŸæœ¬çš„æºåœ°å€ï¼Œé‚£ä¹ˆåœ¨ä¿®æ”¹å®Œæˆåï¼Œä½ ä¿®æ”¹çš„è§„åˆ™ä¸­çš„æºåœ°å€ä¼šè‡ªåŠ¨å˜ä¸º0.0.0.0/0ï¼ˆæ­¤IPè¡¨ç¤ºåŒ¹é…æ‰€æœ‰ç½‘æ®µçš„IPåœ°å€ï¼‰ï¼Œè€Œæ­¤æ—¶ï¼Œ-jå¯¹åº”çš„åŠ¨ä½œåˆä¸ºREJECTï¼Œæ‰€ä»¥åœ¨æ‰§è¡Œä¸Šè¿°å‘½ä»¤æ—¶å¦‚æœæ²¡æœ‰æŒ‡æ˜è§„åˆ™åŸæœ¬çš„æºåœ°å€ï¼Œé‚£ä¹ˆæ‰€æœ‰IPçš„è¯·æ±‚éƒ½è¢«æ‹’ç»äº†ï¼ˆå› ä¸ºæ²¡æœ‰æŒ‡å®šåŸæœ¬çš„æºåœ°å€ï¼Œå½“å‰è§„åˆ™çš„æºåœ°å€è‡ªåŠ¨å˜ä¸º0.0.0.0/0ï¼‰ï¼Œå¦‚æœä½ æ­£åœ¨ä½¿ç”¨sshè¿œç¨‹åˆ°æœåŠ¡å™¨ä¸Šè¿›è¡Œiptablesè®¾ç½®ï¼Œé‚£ä¹ˆä½ çš„sshè¯·æ±‚ä¹Ÿå°†ä¼šè¢«é˜»æ–­ã€‚</p>
<p>æ—¢ç„¶ä½¿ç”¨-Ré€‰é¡¹ä¿®æ”¹è§„åˆ™æ—¶ï¼Œå¿…é¡»æŒ‡æ˜è§„åˆ™åŸæœ¬çš„åŒ¹é…æ¡ä»¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬åˆ™å¯ä»¥ç†è§£ä¸ºï¼Œåªèƒ½é€šè¿‡-Ré€‰é¡¹ä¿®æ”¹è§„åˆ™å¯¹åº”çš„åŠ¨ä½œäº†ï¼Œæ‰€ä»¥æˆ‘è§‰å¾—ï¼Œå¦‚æœä½ æƒ³è¦ä¿®æ”¹æŸæ¡è§„åˆ™ï¼Œè¿˜ä¸å¦‚å…ˆå°†è¿™æ¡è§„åˆ™åˆ é™¤ï¼Œç„¶ååœ¨åŒæ ·ä½ç½®å†æ’å…¥ä¸€æ¡æ–°è§„åˆ™ï¼Œè¿™æ ·æ›´å¥½ï¼Œå½“ç„¶ï¼Œå¦‚æœä½ åªæ˜¯ä¸ºäº†ä¿®æ”¹æŸæ¡è§„åˆ™çš„åŠ¨ä½œï¼Œé‚£ä¹ˆä½¿ç”¨-Ré€‰é¡¹æ—¶ï¼Œä¸è¦å¿˜äº†æŒ‡æ˜è§„åˆ™åŸæœ¬å¯¹åº”çš„åŒ¹é…æ¡ä»¶ã€‚</p>
<p>å¥½äº†ï¼Œä¸Šä¾‹ä¸­ï¼Œæˆ‘ä»¬å·²ç»å°†è§„åˆ™ä¸­çš„åŠ¨ä½œä»DROPæ”¹ä¸ºäº†REJECTï¼Œé‚£ä¹ˆDROPä¸REJECTæœ‰ä»€ä¹ˆä¸åŒå‘¢ï¼Ÿä»å­—é¢ä¸Šç†è§£ï¼ŒDROPè¡¨ç¤ºä¸¢å¼ƒï¼ŒREJECTè¡¨ç¤ºæ‹’ç»ï¼ŒREJECTè¡¨è¾¾çš„æ„æ€å¥½åƒæ›´åšå†³ä¸€ç‚¹ï¼Œæˆ‘ä»¬å†æ¬¡ä»146ä¸»æœºä¸Šå‘156ä¸»æœºä¸Šå‘èµ·pingè¯·æ±‚ï¼Œçœ‹çœ‹ä¸ä¹‹å‰åŠ¨ä½œä¸ºDROPæ—¶æœ‰ä»€ä¹ˆä¸åŒã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifap3000vpwr7cqad5sgx/20.png" alt="image"></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå½“156ä¸»æœºä¸­çš„iptablesè§„åˆ™å¯¹åº”çš„åŠ¨ä½œä¸ºREJECTæ—¶ï¼Œä»146ä¸Šè¿›è¡Œpingæ“ä½œæ—¶ï¼Œç›´æ¥å°±æç¤ºâ€ç›®æ ‡ä¸å¯è¾¾â€ï¼Œå¹¶æ²¡æœ‰åƒä¹‹å‰é‚£æ ·å¡åœ¨é‚£é‡Œï¼Œçœ‹æ¥ï¼ŒREJECTæ¯”DROPæ›´åŠ â€å¹²è„†â€ã€‚</p>
<p>å…¶å®ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä¿®æ”¹æŒ‡å®šé“¾çš„â€é»˜è®¤ç­–ç•¥â€ï¼Œæ²¡é”™ï¼Œå°±æ˜¯ä¸‹å›¾ä¸­æ ‡æ³¨çš„é»˜è®¤ç­–ç•¥ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifap3000vpwr7cqad5sgx/21.png" alt="image"></p>
<p>æ¯å¼ è¡¨çš„æ¯æ¡é“¾ä¸­ï¼Œéƒ½æœ‰è‡ªå·±çš„é»˜è®¤ç­–ç•¥ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç†è§£ä¸ºé»˜è®¤â€åŠ¨ä½œâ€ã€‚</p>
<p>å½“æŠ¥æ–‡æ²¡æœ‰è¢«é“¾ä¸­çš„ä»»ä½•è§„åˆ™åŒ¹é…åˆ°æ—¶ï¼Œæˆ–è€…ï¼Œå½“é“¾ä¸­æ²¡æœ‰ä»»ä½•è§„åˆ™æ—¶ï¼Œé˜²ç«å¢™ä¼šæŒ‰ç…§é»˜è®¤åŠ¨ä½œå¤„ç†æŠ¥æ–‡ï¼Œæˆ‘ä»¬å¯ä»¥ä¿®æ”¹æŒ‡å®šé“¾çš„é»˜è®¤ç­–ç•¥ï¼Œä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å³å¯ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifap3000vpwr7cqad5sgx/22.png" alt="image"></p>
<p>ä½¿ç”¨-tæŒ‡å®šè¦æ“ä½œçš„è¡¨ï¼Œä½¿ç”¨-Pé€‰é¡¹æŒ‡å®šè¦ä¿®æ”¹çš„é“¾ï¼Œä¸Šä¾‹ä¸­ï¼Œ-P FORWARD DROPè¡¨ç¤ºå°†è¡¨ä¸­FORWRDé“¾çš„é»˜è®¤ç­–ç•¥æ”¹ä¸ºDROPã€‚</p>
<h3 id="ä¿å­˜è§„åˆ™"><a href="#ä¿å­˜è§„åˆ™" class="headerlink" title="ä¿å­˜è§„åˆ™"></a>ä¿å­˜è§„åˆ™</h3><p>åœ¨é»˜è®¤çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯¹â€é˜²ç«å¢™â€æ‰€åšå‡ºçš„ä¿®æ”¹éƒ½æ˜¯â€ä¸´æ—¶çš„â€ï¼Œæ¢å¥è¯è¯´å°±æ˜¯ï¼Œå½“é‡å¯iptablesæœåŠ¡æˆ–è€…é‡å¯æœåŠ¡å™¨ä»¥åï¼Œæˆ‘ä»¬å¹³å¸¸æ·»åŠ çš„è§„åˆ™æˆ–è€…å¯¹è§„åˆ™æ‰€åšå‡ºçš„ä¿®æ”¹éƒ½å°†æ¶ˆå¤±ï¼Œä¸ºäº†é˜²æ­¢è¿™ç§æƒ…å†µçš„å‘ç”Ÿï¼Œæˆ‘ä»¬éœ€è¦å°†è§„åˆ™â€ä¿å­˜â€ã€‚</p>
<p>centos7ä¸centos6ä¸­çš„æƒ…å†µç¨å¾®æœ‰äº›ä¸åŒï¼Œæˆ‘ä»¬å…ˆè¯´centos6ä¸­æ€æ ·ä¿å­˜iptablesè§„åˆ™ã€‚</p>
<p>centos6ä¸­ï¼Œä½¿ç”¨â€service iptables saveâ€å‘½ä»¤å³å¯ä¿å­˜è§„åˆ™ï¼Œè§„åˆ™é»˜è®¤ä¿å­˜åœ¨/etc/sysconfig/iptablesæ–‡ä»¶ä¸­ï¼Œå¦‚æœä½ åˆšåˆšå®‰è£…å®Œcentos6ï¼Œåœ¨åˆšå¼€å§‹ä½¿ç”¨iptablesæ—¶ï¼Œä¼šå‘ç°filterè¡¨ä¸­ä¼šæœ‰ä¸€äº›é»˜è®¤çš„è§„åˆ™ï¼Œè¿™äº›é»˜è®¤æä¾›çš„è§„åˆ™å…¶å®å°±ä¿å­˜åœ¨/etc/sysconfig/iptablesä¸­ï¼Œ  ä¿å­˜è§„åˆ™çš„ç¤ºä¾‹å¦‚ä¸‹ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifap3000vpwr7cqad5sgx/23.png" alt="image"></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæ–‡ä»¶ä¸­ä¿å­˜äº†filterè¡¨ä¸­æ¯æ¡é“¾çš„é»˜è®¤ç­–ç•¥ï¼Œä»¥åŠæ¯æ¡é“¾ä¸­çš„è§„åˆ™ï¼Œç”±äºå…¶ä»–è¡¨ä¸­å¹¶æ²¡æœ‰è®¾ç½®è§„åˆ™ï¼Œä¹Ÿæ²¡æœ‰ä½¿ç”¨è¿‡å…¶ä»–è¡¨ï¼Œæ‰€ä»¥æ–‡ä»¶ä¸­åªä¿å­˜äº†filterè¡¨ä¸­çš„è§„åˆ™ã€‚</p>
<p>å½“æˆ‘ä»¬å¯¹è§„åˆ™è¿›è¡Œäº†ä¿®æ”¹ä»¥åï¼Œå¦‚æœæƒ³è¦ä¿®æ”¹æ°¸ä¹…ç”Ÿæ•ˆï¼Œå¿…é¡»ä½¿ç”¨service iptables saveä¿å­˜è§„åˆ™ï¼Œå½“ç„¶ï¼Œå¦‚æœä½ è¯¯æ“ä½œäº†è§„åˆ™ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰ä¿å­˜ï¼Œé‚£ä¹ˆä½¿ç”¨service iptables restartå‘½ä»¤é‡å¯iptablesä»¥åï¼Œè§„åˆ™ä¼šå†æ¬¡å›åˆ°ä¸Šæ¬¡ä¿å­˜/etc/sysconfig/iptablesæ–‡ä»¶æ—¶çš„æ¨¡æ ·ã€‚</p>
<p>ä»ç°åœ¨å¼€å§‹ï¼Œæœ€å¥½å…»æˆåŠæ—¶ä¿å­˜è§„åˆ™çš„å¥½ä¹ æƒ¯ã€‚</p>
<p>centos7ä¸­ï¼Œå·²ç»ä¸å†ä½¿ç”¨inité£æ ¼çš„è„šæœ¬å¯åŠ¨æœåŠ¡ï¼Œè€Œæ˜¯ä½¿ç”¨unitæ–‡ä»¶ï¼Œæ‰€ä»¥ï¼Œåœ¨centos7ä¸­å·²ç»ä¸èƒ½å†ä½¿ç”¨ç±»ä¼¼service iptables startè¿™æ ·çš„å‘½ä»¤äº†ï¼Œæ‰€ä»¥service iptables saveä¹Ÿæ— æ³•æ‰§è¡Œï¼ŒåŒæ—¶ï¼Œåœ¨centos7ä¸­ï¼Œä½¿ç”¨firewallæ›¿ä»£äº†åŸæ¥çš„iptables serviceï¼Œä¸è¿‡ä¸ç”¨æ‹…å¿ƒï¼Œæˆ‘ä»¬åªè¦é€šè¿‡yumæºå®‰è£…iptablesä¸iptables-serviceså³å¯ï¼ˆiptablesä¸€èˆ¬ä¼šè¢«é»˜è®¤å®‰è£…ï¼Œä½†æ˜¯iptables-servicesåœ¨centos7ä¸­ä¸€èˆ¬ä¸ä¼šè¢«é»˜è®¤å®‰è£…ï¼‰ï¼Œåœ¨centos7ä¸­å®‰è£…å®Œiptables-servicesåï¼Œå³å¯åƒcentos6ä¸­ä¸€æ ·ï¼Œé€šè¿‡service iptables saveå‘½ä»¤ä¿å­˜è§„åˆ™äº†ï¼Œè§„åˆ™åŒæ ·ä¿å­˜åœ¨/etc/sysconfig/iptablesæ–‡ä»¶ä¸­ã€‚</p>
<p>æ­¤å¤„ç»™å‡ºcentos7ä¸­é…ç½®iptables-serviceçš„æ­¥éª¤</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">é…ç½®å¥½yumæºä»¥åå®‰è£…iptables-service</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> yum install -y iptables-services</span></span><br><span class="line"><span class="meta">#</span><span class="bash">åœæ­¢firewalld</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> systemctl stop firewalld</span></span><br><span class="line"><span class="meta">#</span><span class="bash">ç¦æ­¢firewalldè‡ªåŠ¨å¯åŠ¨</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> systemctl <span class="built_in">disable</span> firewalld</span></span><br><span class="line"><span class="meta">#</span><span class="bash">å¯åŠ¨iptables</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> systemctl start iptables</span></span><br><span class="line"><span class="meta">#</span><span class="bash">å°†iptablesè®¾ç½®ä¸ºå¼€æœºè‡ªåŠ¨å¯åŠ¨ï¼Œä»¥åå³å¯é€šè¿‡iptables-serviceæ§åˆ¶iptablesæœåŠ¡</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> systemctl <span class="built_in">enable</span> iptables</span></span><br></pre></td></tr></table></figure></div>


<p>ä¸Šè¿°é…ç½®è¿‡ç¨‹åªéœ€ä¸€æ¬¡ï¼Œä»¥åå³å¯åœ¨centos7ä¸­æ„‰å¿«çš„ä½¿ç”¨service iptables saveå‘½ä»¤ä¿å­˜iptablesè§„åˆ™äº†ã€‚</p>
<h3 id="å…¶ä»–é€šç”¨æ–¹æ³•"><a href="#å…¶ä»–é€šç”¨æ–¹æ³•" class="headerlink" title="å…¶ä»–é€šç”¨æ–¹æ³•"></a>å…¶ä»–é€šç”¨æ–¹æ³•</h3><p>è¿˜å¯ä»¥ä½¿ç”¨å¦ä¸€ç§æ–¹æ³•ä¿å­˜iptablesè§„åˆ™ï¼Œå°±æ˜¯ä½¿ç”¨iptables-saveå‘½ä»¤</p>
<p>ä½¿ç”¨iptables-saveå¹¶ä¸èƒ½ä¿å­˜å½“å‰çš„iptablesè§„åˆ™ï¼Œä½†æ˜¯å¯ä»¥å°†å½“å‰çš„iptablesè§„åˆ™ä»¥â€ä¿å­˜åçš„æ ¼å¼â€è¾“å‡ºåˆ°å±å¹•ä¸Šã€‚</p>
<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨iptables-saveå‘½ä»¤ï¼Œå†é…åˆé‡å®šå‘ï¼Œå°†è§„åˆ™é‡å®šå‘åˆ°/etc/sysconfig/iptablesæ–‡ä»¶ä¸­å³å¯ã€‚</p>
<p>iptables-save &gt; /etc/sysconfig/iptables</p>
<p>æˆ‘ä»¬ä¹Ÿå¯ä»¥å°†/etc/sysconfig/iptablesä¸­çš„è§„åˆ™é‡æ–°è½½å…¥ä¸ºå½“å‰çš„iptablesè§„åˆ™ï¼Œä½†æ˜¯æ³¨æ„ï¼Œæœªä¿å­˜å…¥/etc/sysconfig/iptablesæ–‡ä»¶ä¸­çš„ä¿®æ”¹å°†ä¼šä¸¢å¤±æˆ–è€…è¢«è¦†ç›–ã€‚</p>
<p>ä½¿ç”¨iptables-restoreå‘½ä»¤å¯ä»¥ä»æŒ‡å®šæ–‡ä»¶ä¸­é‡è½½è§„åˆ™ï¼Œç¤ºä¾‹å¦‚ä¸‹</p>
<p>iptables-restore &lt; /etc/sysconfig/iptables</p>
<p>å†æ¬¡æé†’ï¼šé‡è½½è§„åˆ™æ—¶ï¼Œç°æœ‰è§„åˆ™å°†ä¼šè¢«è¦†ç›–ã€‚</p>
<h3 id="å‘½ä»¤å°ç»“"><a href="#å‘½ä»¤å°ç»“" class="headerlink" title="å‘½ä»¤å°ç»“"></a>å‘½ä»¤å°ç»“</h3><p>ä¸Šæ–‡å·²ç»è¯¦ç»†çš„ä¸¾ä¾‹å¹¶æè¿°äº†æ€æ ·è¿›è¡Œiptablesè§„åˆ™ç®¡ç†ï¼Œä¸ºäº†ä»¥åèƒ½å¤Ÿå¿«é€Ÿçš„å›é¡¾ï¼Œæˆ‘ä»¬æŠŠä¸Šè¿°å‘½ä»¤æ€»ç»“ä¸€ä¸‹ã€‚</p>
<h4 id="æ·»åŠ è§„åˆ™"><a href="#æ·»åŠ è§„åˆ™" class="headerlink" title="æ·»åŠ è§„åˆ™"></a>æ·»åŠ è§„åˆ™</h4><p>æ³¨æ„ç‚¹ï¼šæ·»åŠ è§„åˆ™æ—¶ï¼Œè§„åˆ™çš„é¡ºåºéå¸¸é‡è¦</p>
<p>åœ¨æŒ‡å®šè¡¨çš„æŒ‡å®šé“¾çš„å°¾éƒ¨æ·»åŠ ä¸€æ¡è§„åˆ™ï¼Œ-Aé€‰é¡¹è¡¨ç¤ºåœ¨å¯¹åº”é“¾çš„æœ«å°¾æ·»åŠ è§„åˆ™ï¼Œçœç•¥-té€‰é¡¹æ—¶ï¼Œè¡¨ç¤ºé»˜è®¤æ“ä½œfilterè¡¨ä¸­çš„è§„åˆ™</p>
<p>å‘½ä»¤è¯­æ³•ï¼šiptables -t è¡¨å -A é“¾å åŒ¹é…æ¡ä»¶ -j åŠ¨ä½œ<br>ç¤ºä¾‹ï¼šiptables -t filter -A INPUT -s 192.168.1.146 -j DROP</p>
<p>åœ¨æŒ‡å®šè¡¨çš„æŒ‡å®šé“¾çš„é¦–éƒ¨æ·»åŠ ä¸€æ¡è§„åˆ™ï¼Œ-Ié€‰å‹è¡¨ç¤ºåœ¨å¯¹åº”é“¾çš„å¼€å¤´æ·»åŠ è§„åˆ™</p>
<p>å‘½ä»¤è¯­æ³•ï¼šiptables -t è¡¨å -I é“¾å åŒ¹é…æ¡ä»¶ -j åŠ¨ä½œ<br>ç¤ºä¾‹ï¼šiptables -t filter -I INPUT -s 192.168.1.146 -j ACCEPT</p>
<p>åœ¨æŒ‡å®šè¡¨çš„æŒ‡å®šé“¾çš„æŒ‡å®šä½ç½®æ·»åŠ ä¸€æ¡è§„åˆ™</p>
<p>å‘½ä»¤è¯­æ³•ï¼šiptables -t è¡¨å -I é“¾å è§„åˆ™åºå· åŒ¹é…æ¡ä»¶ -j åŠ¨ä½œ<br>ç¤ºä¾‹ï¼šiptables -t filter -I INPUT 5 -s 192.168.1.146 -j REJECT</p>
<p>è®¾ç½®æŒ‡å®šè¡¨çš„æŒ‡å®šé“¾çš„é»˜è®¤ç­–ç•¥ï¼ˆé»˜è®¤åŠ¨ä½œï¼‰ï¼Œå¹¶éæ·»åŠ è§„åˆ™ã€‚</p>
<p>å‘½ä»¤è¯­æ³•ï¼šiptables -t è¡¨å -P é“¾å åŠ¨ä½œ<br>ç¤ºä¾‹ï¼šiptables -t filter -P FORWARD ACCEPT<br>ä¸Šä¾‹è¡¨ç¤ºå°†filterè¡¨ä¸­FORWARDé“¾çš„é»˜è®¤ç­–ç•¥è®¾ç½®ä¸ºACCEPT</p>
<h4 id="åˆ é™¤è§„åˆ™-1"><a href="#åˆ é™¤è§„åˆ™-1" class="headerlink" title="åˆ é™¤è§„åˆ™"></a>åˆ é™¤è§„åˆ™</h4><p>æ³¨æ„ç‚¹ï¼šå¦‚æœæ²¡æœ‰ä¿å­˜è§„åˆ™ï¼Œåˆ é™¤è§„åˆ™æ—¶è¯·æ…é‡</p>
<p>æŒ‰ç…§è§„åˆ™åºå·åˆ é™¤è§„åˆ™ï¼Œåˆ é™¤æŒ‡å®šè¡¨çš„æŒ‡å®šé“¾çš„æŒ‡å®šè§„åˆ™ï¼Œ-Dé€‰é¡¹è¡¨ç¤ºåˆ é™¤å¯¹åº”é“¾ä¸­çš„è§„åˆ™ã€‚</p>
<p>å‘½ä»¤è¯­æ³•ï¼šiptables -t è¡¨å -D é“¾å è§„åˆ™åºå·<br>ç¤ºä¾‹ï¼šiptables -t filter -D INPUT 3<br>ä¸Šè¿°ç¤ºä¾‹è¡¨ç¤ºåˆ é™¤filterè¡¨ä¸­INPUTé“¾ä¸­åºå·ä¸º3çš„è§„åˆ™ã€‚</p>
<p>æŒ‰ç…§å…·ä½“çš„åŒ¹é…æ¡ä»¶ä¸åŠ¨ä½œåˆ é™¤è§„åˆ™ï¼Œåˆ é™¤æŒ‡å®šè¡¨çš„æŒ‡å®šé“¾çš„æŒ‡å®šè§„åˆ™ã€‚</p>
<p>å‘½ä»¤è¯­æ³•ï¼šiptables -t è¡¨å -D é“¾å åŒ¹é…æ¡ä»¶ -j åŠ¨ä½œ<br>ç¤ºä¾‹ï¼šiptables -t filter -D INPUT -s 192.168.1.146 -j DROP<br>ä¸Šè¿°ç¤ºä¾‹è¡¨ç¤ºåˆ é™¤filterè¡¨ä¸­INPUTé“¾ä¸­æºåœ°å€ä¸º192.168.1.146å¹¶ä¸”åŠ¨ä½œä¸ºDROPçš„è§„åˆ™ã€‚</p>
<p>åˆ é™¤æŒ‡å®šè¡¨çš„æŒ‡å®šé“¾ä¸­çš„æ‰€æœ‰è§„åˆ™ï¼Œ-Fé€‰é¡¹è¡¨ç¤ºæ¸…ç©ºå¯¹åº”é“¾ä¸­çš„è§„åˆ™ï¼Œæ‰§è¡Œæ—¶éœ€ä¸‰æ€ã€‚</p>
<p>å‘½ä»¤è¯­æ³•ï¼šiptables -t è¡¨å -F é“¾å<br>ç¤ºä¾‹ï¼šiptables -t filter -F INPUT</p>
<p>åˆ é™¤æŒ‡å®šè¡¨ä¸­çš„æ‰€æœ‰è§„åˆ™ï¼Œæ‰§è¡Œæ—¶éœ€ä¸‰æ€ã€‚</p>
<p>å‘½ä»¤è¯­æ³•ï¼šiptables -t è¡¨å -F<br>ç¤ºä¾‹ï¼šiptables -t filter -F</p>
<h4 id="ä¿®æ”¹è§„åˆ™-1"><a href="#ä¿®æ”¹è§„åˆ™-1" class="headerlink" title="ä¿®æ”¹è§„åˆ™"></a>ä¿®æ”¹è§„åˆ™</h4><p>æ³¨æ„ç‚¹ï¼šå¦‚æœä½¿ç”¨-Ré€‰é¡¹ä¿®æ”¹è§„åˆ™ä¸­çš„åŠ¨ä½œï¼Œé‚£ä¹ˆå¿…é¡»æŒ‡æ˜åŸè§„åˆ™ä¸­çš„åŸåŒ¹é…æ¡ä»¶ï¼Œä¾‹å¦‚æºIPï¼Œç›®æ ‡IPç­‰ã€‚</p>
<p>ä¿®æ”¹æŒ‡å®šè¡¨ä¸­æŒ‡å®šé“¾çš„æŒ‡å®šè§„åˆ™ï¼Œ-Ré€‰é¡¹è¡¨ç¤ºä¿®æ”¹å¯¹åº”é“¾ä¸­çš„è§„åˆ™ï¼Œä½¿ç”¨-Ré€‰é¡¹æ—¶è¦åŒæ—¶æŒ‡å®šå¯¹åº”çš„é“¾ä»¥åŠè§„åˆ™å¯¹åº”çš„åºå·ï¼Œå¹¶ä¸”è§„åˆ™ä¸­åŸæœ¬çš„åŒ¹é…æ¡ä»¶ä¸å¯çœç•¥ã€‚</p>
<p>å‘½ä»¤è¯­æ³•ï¼šiptables -t è¡¨å -R é“¾å è§„åˆ™åºå· è§„åˆ™åŸæœ¬çš„åŒ¹é…æ¡ä»¶ -j åŠ¨ä½œ<br>ç¤ºä¾‹ï¼šiptables -t filter -R INPUT 3 -s 192.168.1.146 -j ACCEPT<br>ä¸Šè¿°ç¤ºä¾‹è¡¨ç¤ºä¿®æ”¹filterè¡¨ä¸­INPUTé“¾çš„ç¬¬3æ¡è§„åˆ™ï¼Œå°†è¿™æ¡è§„åˆ™çš„åŠ¨ä½œä¿®æ”¹ä¸ºACCEPTï¼Œ -s 192.168.1.146ä¸ºè¿™æ¡è§„åˆ™ä¸­åŸæœ¬çš„åŒ¹é…æ¡ä»¶ï¼Œå¦‚æœçœç•¥æ­¤åŒ¹é…æ¡ä»¶ï¼Œä¿®æ”¹åçš„è§„åˆ™ä¸­çš„æºåœ°å€å¯èƒ½ä¼šå˜ä¸º0.0.0.0/0ã€‚</p>
<p>å…¶ä»–ä¿®æ”¹è§„åˆ™çš„æ–¹æ³•ï¼šå…ˆé€šè¿‡ç¼–å·åˆ é™¤è§„åˆ™ï¼Œå†åœ¨åŸç¼–å·ä½ç½®æ·»åŠ ä¸€æ¡è§„åˆ™ã€‚</p>
<p>ä¿®æ”¹æŒ‡å®šè¡¨çš„æŒ‡å®šé“¾çš„é»˜è®¤ç­–ç•¥ï¼ˆé»˜è®¤åŠ¨ä½œï¼‰ï¼Œå¹¶éä¿®æ”¹è§„åˆ™ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ã€‚</p>
<p>å‘½ä»¤è¯­æ³•ï¼šiptables -t è¡¨å -P é“¾å åŠ¨ä½œ<br>ç¤ºä¾‹ï¼šiptables -t filter -P FORWARD ACCEPT<br>ä¸Šä¾‹è¡¨ç¤ºå°†filterè¡¨ä¸­FORWARDé“¾çš„é»˜è®¤ç­–ç•¥ä¿®æ”¹ä¸ºACCEPT</p>
<h4 id="ä¿å­˜è§„åˆ™-1"><a href="#ä¿å­˜è§„åˆ™-1" class="headerlink" title="ä¿å­˜è§„åˆ™"></a>ä¿å­˜è§„åˆ™</h4><p>ä¿å­˜è§„åˆ™å‘½ä»¤å¦‚ä¸‹ï¼Œè¡¨ç¤ºå°†iptablesè§„åˆ™ä¿å­˜è‡³/etc/sysconfig/iptablesæ–‡ä»¶ä¸­ï¼Œå¦‚æœå¯¹åº”çš„æ“ä½œæ²¡æœ‰ä¿å­˜ï¼Œé‚£ä¹ˆå½“é‡å¯iptablesæœåŠ¡ä»¥å</p>
<p>service iptables save<br>æ³¨æ„ç‚¹ï¼šcentos7ä¸­ä½¿ç”¨é»˜è®¤ä½¿ç”¨firewalldï¼Œå¦‚æœæƒ³è¦ä½¿ç”¨ä¸Šè¿°å‘½ä»¤ä¿å­˜è§„åˆ™ï¼Œéœ€è¦å®‰è£…iptables-servicesï¼Œå…·ä½“é…ç½®è¿‡ç¨‹è¯·å›é¡¾ä¸Šæ–‡ã€‚</p>
<p>æˆ–è€…ä½¿ç”¨å¦‚ä¸‹æ–¹æ³•ä¿å­˜è§„åˆ™</p>
<p>iptables-save &gt; /etc/sysconfig/iptables<br>å¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ä»æŒ‡å®šçš„æ–‡ä»¶è½½å…¥è§„åˆ™ï¼Œæ³¨æ„ï¼šé‡è½½è§„åˆ™æ—¶ï¼Œæ–‡ä»¶ä¸­çš„è§„åˆ™å°†ä¼šè¦†ç›–ç°æœ‰è§„åˆ™ã€‚</p>
<p>iptables-restore &lt; /etc/sysconfig/iptables</p>
<p>å¥½äº†ï¼Œè¿™ç¯‡æ–‡ç« å·²ç»æ€»ç»“äº†æ€æ ·æ·»åŠ ã€åˆ é™¤ã€ä¿®æ”¹ iptablesè§„åˆ™ï¼Œä¸å‰æ–‡ç»“åˆèµ·æ¥ï¼Œæˆ‘ä»¬å·²ç»æŒæ¡äº†å¯¹iptablesè§„åˆ™çš„â€å¢åˆ æ”¹æŸ¥â€ï¼ŒåŒæ—¶ï¼Œè¿™ç¯‡æ–‡ç« ä¹Ÿæ€»ç»“äº†å¦‚ä½•è®¾ç½®é“¾çš„é»˜è®¤ç­–ç•¥ï¼Œä»¥åŠæ€æ ·ä¿å­˜iptablesè§„åˆ™ã€‚</p>
<p>æˆ‘æƒ³ï¼Œä½ å·²ç»å…¥é—¨äº†ï¼Œå¯¹å—ï¼Ÿå¦‚æœä½ æ˜¯ä¸€ä¸ªæ–°æ‰‹ï¼Œå¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¯¹ä½ æœ‰æ‰€å¸®åŠ©ã€‚</p>
]]></content>
      <tags>
        <tag>äº‘åŸç”ŸåŸºç¡€ç³»åˆ—</tag>
        <tag>Kubernetesç½‘ç»œ</tag>
      </tags>
  </entry>
  <entry>
    <title>Kubernetesç½‘ç»œç³»åˆ—ä¹‹(äºŒåäº”)iptablesåŒ¹é…æ¡ä»¶æ€»ç»“ä¹‹äºŒ(å¸¸ç”¨æ‰©å±•æ¨¡å—)</title>
    <url>/2022/06/13/uncatalog/cl4cifap4000xpwr7gg0bhm2w/</url>
    <content><![CDATA[<hr>
<span id="more"></span>

<hr>
<p>å‰æ–‡å·²ç»æ€»ç»“äº†iptablesä¸­çš„åŸºæœ¬åŒ¹é…æ¡ä»¶ï¼Œä»¥åŠç®€å•çš„æ‰©å±•åŒ¹é…æ¡ä»¶ï¼Œæ­¤å¤„ï¼Œæˆ‘ä»¬æ¥è®¤è¯†ä¸€äº›æ–°çš„æ‰©å±•æ¨¡å—ã€‚</p>
<h3 id="iprangeæ‰©å±•æ¨¡å—"><a href="#iprangeæ‰©å±•æ¨¡å—" class="headerlink" title="iprangeæ‰©å±•æ¨¡å—"></a>iprangeæ‰©å±•æ¨¡å—</h3><p>ä¹‹å‰æˆ‘ä»¬å·²ç»æ€»ç»“è¿‡ï¼Œåœ¨ä¸ä½¿ç”¨ä»»ä½•æ‰©å±•æ¨¡å—çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨-sé€‰é¡¹æˆ–è€…-dé€‰é¡¹å³å¯åŒ¹é…æŠ¥æ–‡çš„æºåœ°å€ä¸ç›®æ ‡åœ°å€ï¼Œè€Œä¸”åœ¨æŒ‡å®šIPåœ°å€æ—¶ï¼Œå¯ä»¥åŒæ—¶æŒ‡å®šå¤šä¸ªIPåœ°å€ï¼Œæ¯ä¸ªIPç”¨â€é€—å·â€éš”å¼€ï¼Œä½†æ˜¯ï¼Œ-sé€‰é¡¹ä¸-dé€‰é¡¹å¹¶ä¸èƒ½ä¸€æ¬¡æ€§çš„æŒ‡å®šä¸€æ®µè¿ç»­çš„IPåœ°å€èŒƒå›´ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦æŒ‡å®šä¸€æ®µè¿ç»­çš„IPåœ°å€èŒƒå›´ï¼Œå¯ä»¥ä½¿ç”¨iprangeæ‰©å±•æ¨¡å—ã€‚</p>
<p>ä½¿ç”¨iprangeæ‰©å±•æ¨¡å—å¯ä»¥æŒ‡å®šâ€ä¸€æ®µè¿ç»­çš„IPåœ°å€èŒƒå›´â€ï¼Œç”¨äºåŒ¹é…æŠ¥æ–‡çš„æºåœ°å€æˆ–è€…ç›®æ ‡åœ°å€ã€‚</p>
<p>iprangeæ‰©å±•æ¨¡å—ä¸­æœ‰ä¸¤ä¸ªæ‰©å±•åŒ¹é…æ¡ä»¶å¯ä»¥ä½¿ç”¨</p>
<ul>
<li><p>â€“src-range</p>
</li>
<li><p>â€“dst-range</p>
</li>
</ul>
<p>æ²¡é”™ï¼Œè§åçŸ¥æ„ï¼Œä¸Šè¿°ä¸¤ä¸ªé€‰é¡¹åˆ†åˆ«ç”¨äºåŒ¹é…æŠ¥æ–‡çš„æºåœ°å€æ‰€åœ¨èŒƒå›´ä¸ç›®æ ‡åœ°å€æ‰€åœ¨èŒƒå›´ã€‚</p>
<p>ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<p><img src="/2022/06/13/uncatalog/cl4cifap4000xpwr7gg0bhm2w/1.png" alt="image"></p>
<p>ä¸Šä¾‹è¡¨ç¤ºå¦‚æœæŠ¥æ–‡çš„æºIPåœ°å€å¦‚æœåœ¨192.168.1.127åˆ°192.168.1.146ä¹‹é—´ï¼Œåˆ™ä¸¢å¼ƒæŠ¥æ–‡ï¼ŒIPæ®µçš„å§‹æœ«IPä½¿ç”¨â€æ¨ªæ â€è¿æ¥ï¼Œâ€“src-rangeä¸â€“dst-rangeå’Œå…¶ä»–åŒ¹é…æ¡ä»¶ä¸€æ ·ï¼Œèƒ½å¤Ÿä½¿ç”¨â€!â€å–åï¼Œæœ‰äº†å‰æ–‡ä¸­çš„çŸ¥è¯†ä½œä¸ºåŸºç¡€ï¼Œæ­¤å¤„å°±ä¸å†èµ˜è¿°äº†ã€‚</p>
<h3 id="stringæ‰©å±•æ¨¡å—"><a href="#stringæ‰©å±•æ¨¡å—" class="headerlink" title="stringæ‰©å±•æ¨¡å—"></a>stringæ‰©å±•æ¨¡å—</h3><p>ä½¿ç”¨stringæ‰©å±•æ¨¡å—ï¼Œå¯ä»¥æŒ‡å®šè¦åŒ¹é…çš„å­—ç¬¦ä¸²ï¼Œå¦‚æœæŠ¥æ–‡ä¸­åŒ…å«å¯¹åº”çš„å­—ç¬¦ä¸²ï¼Œåˆ™ç¬¦åˆåŒ¹é…æ¡ä»¶ã€‚</p>
<p>æ¯”å¦‚ï¼Œå¦‚æœæŠ¥æ–‡ä¸­åŒ…å«å­—ç¬¦â€OOXXâ€ï¼Œæˆ‘ä»¬å°±ä¸¢å¼ƒå½“å‰æŠ¥æ–‡ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬åœ¨IPä¸º146çš„ä¸»æœºä¸Šå¯åŠ¨httpæœåŠ¡ï¼Œç„¶ååœ¨é»˜è®¤çš„é¡µé¢ç›®å½•ä¸­æ·»åŠ ä¸¤ä¸ªé¡µé¢ï¼Œé¡µé¢ä¸­çš„å†…å®¹åˆ†åˆ«ä¸ºâ€OOXXâ€å’Œâ€Hello Worldâ€ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œåœ¨æ²¡æœ‰é…ç½®ä»»ä½•è§„åˆ™æ—¶ï¼Œ126ä¸»æœºå¯ä»¥æ­£å¸¸è®¿é—®146ä¸»æœºä¸Šçš„è¿™ä¸¤ä¸ªé¡µé¢ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifap4000xpwr7gg0bhm2w/2.png" alt="image"></p>
<p>é‚£ä¹ˆï¼Œæˆ‘ä»¬æƒ³è¦è¾¾åˆ°çš„ç›®çš„æ˜¯ï¼Œå¦‚æœæŠ¥æ–‡ä¸­åŒ…å«â€OOXXâ€å­—ç¬¦ï¼Œæˆ‘ä»¬å°±æ‹’ç»æŠ¥æ–‡è¿›å…¥æœ¬æœºï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨126ä¸Šè¿›è¡Œå¦‚ä¸‹é…ç½®ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifap4000xpwr7gg0bhm2w/3.png" alt="image"></p>
<p>ä¸Šå›¾ä¸­ï¼Œâ€™-m stringâ€™è¡¨ç¤ºä½¿ç”¨stringæ¨¡å—ï¼Œâ€™â€“algo bmâ€™è¡¨ç¤ºä½¿ç”¨bmç®—æ³•å»åŒ¹é…æŒ‡å®šçš„å­—ç¬¦ä¸²ï¼Œâ€™ â€“string â€œOOXXâ€ â€˜åˆ™è¡¨ç¤ºæˆ‘ä»¬æƒ³è¦åŒ¹é…çš„å­—ç¬¦ä¸²ä¸ºâ€OOXXâ€</p>
<p>è®¾ç½®å®Œä¸Šå›¾ä¸­çš„è§„åˆ™åï¼Œç”±äºindex.htmlä¸­åŒ…å«â€OOXXâ€å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥ï¼Œ146çš„å›åº”æŠ¥æ–‡æ— æ³•é€šè¿‡126çš„INPUTé“¾ï¼Œæ‰€ä»¥æ— æ³•è·å–åˆ°é¡µé¢å¯¹åº”çš„å†…å®¹ã€‚</p>
<p>é‚£ä¹ˆï¼Œæˆ‘ä»¬æ¥æ€»ç»“ä¸€ä¸‹stringæ¨¡å—çš„å¸¸ç”¨é€‰é¡¹</p>
<ul>
<li><p>â€“algoï¼šç”¨äºæŒ‡å®šåŒ¹é…ç®—æ³•ï¼Œå¯é€‰çš„ç®—æ³•æœ‰bmä¸kmpï¼Œæ­¤é€‰é¡¹ä¸ºå¿…é¡»é€‰é¡¹ï¼Œæˆ‘ä»¬ä¸ç”¨çº ç»“äºé€‰æ‹©å“ªä¸ªç®—æ³•ï¼Œä½†æ˜¯æˆ‘ä»¬å¿…é¡»æŒ‡å®šä¸€ä¸ªã€‚</p>
</li>
<li><p>â€“stringï¼šç”¨äºæŒ‡å®šéœ€è¦åŒ¹é…çš„å­—ç¬¦ä¸²ã€‚</p>
</li>
</ul>
<h3 id="timeæ‰©å±•æ¨¡å—"><a href="#timeæ‰©å±•æ¨¡å—" class="headerlink" title="timeæ‰©å±•æ¨¡å—"></a>timeæ‰©å±•æ¨¡å—</h3><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡timeæ‰©å±•æ¨¡å—ï¼Œæ ¹æ®æ—¶é—´æ®µåŒºåŒ¹é…æŠ¥æ–‡ï¼Œå¦‚æœæŠ¥æ–‡åˆ°è¾¾çš„æ—¶é—´åœ¨æŒ‡å®šçš„æ—¶é—´èŒƒå›´ä»¥å†…ï¼Œåˆ™ç¬¦åˆåŒ¹é…æ¡ä»¶ã€‚</p>
<p>æ¯”å¦‚ï¼Œâ€æˆ‘æƒ³è¦è‡ªæˆ‘çº¦æŸï¼Œæ¯å¤©æ—©ä¸Š9ç‚¹åˆ°ä¸‹åˆ6ç‚¹ä¸èƒ½çœ‹ç½‘é¡µâ€ï¼Œæ“¦ï¼Œå¤šä¹ˆæ®‹å¿çš„è§„å®šï¼Œå¦‚æœä½ æƒ³è¦è¿™æ ·å®šä¹‰ï¼Œå¯ä»¥å°è¯•ä½¿ç”¨å¦‚ä¸‹è§„åˆ™ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifap4000xpwr7gg0bhm2w/4.png" alt="image"></p>
<p>ä¸Šå›¾ä¸­â€-m timeâ€è¡¨ç¤ºä½¿ç”¨timeæ‰©å±•æ¨¡å—ï¼Œâ€“timestarté€‰é¡¹ç”¨äºæŒ‡å®šèµ·å§‹æ—¶é—´ï¼Œâ€“timestopé€‰é¡¹ç”¨äºæŒ‡å®šç»“æŸæ—¶é—´ã€‚</p>
<p>å¦‚æœä½ æƒ³è¦æ¢ä¸€ç§çº¦æŸæ–¹æ³•ï¼Œåªæœ‰å‘¨å…­æ—¥ä¸èƒ½çœ‹ç½‘é¡µï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨å¦‚ä¸‹è§„åˆ™ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifap4000xpwr7gg0bhm2w/5.png" alt="image"></p>
<p>æ²¡é”™ï¼Œå¦‚ä½ æ‰€è§ï¼Œä½¿ç”¨â€“weekdaysé€‰é¡¹å¯ä»¥æŒ‡å®šæ¯ä¸ªæ˜ŸæœŸçš„å…·ä½“å“ªä¸€å¤©ï¼Œå¯ä»¥åŒæ—¶æŒ‡å®šå¤šä¸ªï¼Œç”¨é€—å·éš”å¼€ï¼Œé™¤äº†èƒ½å¤Ÿæ•°å­—è¡¨ç¤ºâ€æ˜ŸæœŸå‡ â€,è¿˜èƒ½ç”¨ç¼©å†™è¡¨ç¤ºï¼Œä¾‹å¦‚ï¼šMon, Tue, Wed, Thu, Fri, Sat, Sun</p>
<p>å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥å°†ä¸Šè¿°å‡ ä¸ªé€‰é¡¹ç»“åˆèµ·æ¥ä½¿ç”¨ï¼Œæ¯”å¦‚æŒ‡å®šåªæœ‰å‘¨å…­æ—¥çš„æ—©ä¸Š9ç‚¹åˆ°ä¸‹åˆ6ç‚¹ä¸èƒ½æµè§ˆç½‘é¡µã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifap4000xpwr7gg0bhm2w/6.png" alt="image"></p>
<p>èªæ˜å¦‚ä½ ä¸€å®šæƒ³åˆ°äº†ï¼Œæ—¢ç„¶æœ‰â€“weekdaysé€‰é¡¹äº†ï¼Œé‚£ä¹ˆæœ‰æ²¡æœ‰â€“monthdaysé€‰é¡¹å‘¢ï¼Ÿå¿…é¡»æœ‰å•Šï¼</p>
<p>ä½¿ç”¨â€“monthdaysé€‰é¡¹å¯ä»¥å…·ä½“æŒ‡å®šçš„æ¯ä¸ªæœˆçš„å“ªä¸€å¤©ï¼Œæ¯”å¦‚ï¼Œå¦‚ä¸‹å›¾è®¾ç½®è¡¨ç¤ºæŒ‡æ˜æ¯æœˆçš„22å·ï¼Œ23å·ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifap4000xpwr7gg0bhm2w/7.png" alt="image"></p>
<p>å‰æ–‡å·²ç»æ€»ç»“è¿‡ï¼Œå½“ä¸€æ¡è§„åˆ™ä¸­åŒæ—¶å­˜åœ¨å¤šä¸ªæ¡ä»¶æ—¶ï¼Œå¤šä¸ªæ¡ä»¶ä¹‹é—´é»˜è®¤å­˜åœ¨â€ä¸â€çš„å…³ç³»ï¼Œæ‰€ä»¥ï¼Œä¸‹å›¾ä¸­çš„è®¾ç½®è¡¨ç¤ºåŒ¹é…çš„æ—¶é—´å¿…é¡»ä¸ºæ˜ŸæœŸ5ï¼Œå¹¶ä¸”è¿™ä¸ªâ€æ˜ŸæœŸ5â€³åŒæ—¶è¿˜éœ€è¦æ˜¯æ¯ä¸ªæœˆçš„22å·åˆ°28å·ä¹‹é—´çš„ä¸€å¤©ï¼Œæ‰€ä»¥ï¼Œä¸‹å›¾ä¸­çš„è®¾ç½®è¡¨ç¤ºæ¯ä¸ªæœˆçš„ç¬¬4ä¸ªæ˜ŸæœŸ5</p>
<p><img src="/2022/06/13/uncatalog/cl4cifap4000xpwr7gg0bhm2w/9.png" alt="image"></p>
<p>é™¤äº†ä½¿ç”¨â€“weekdaysé€‰é¡¹ä¸â€“monthdaysé€‰é¡¹ï¼Œè¿˜å¯ä»¥ä½¿ç”¨â€“datestart é€‰é¡¹ä¸-datestopé€‰é¡¹ï¼ŒæŒ‡å®šå…·ä½“çš„æ—¥æœŸèŒƒå›´ï¼Œå¦‚ä¸‹ã€‚<br><img src="/2022/06/13/uncatalog/cl4cifap4000xpwr7gg0bhm2w/10.png" alt="image"></p>
<p>ä¸Šå›¾ä¸­æŒ‡å®šçš„æ—¥æœŸèŒƒå›´ä¸º2017å¹´12æœˆ24æ—¥åˆ°2017å¹´12æœˆ27æ—¥</p>
<p>ä¸Šè¿°é€‰é¡¹ä¸­ï¼Œâ€“monthdaysä¸â€“weekdayså¯ä»¥ä½¿ç”¨â€!â€å–åï¼Œå…¶ä»–é€‰é¡¹ä¸èƒ½å–åã€‚</p>
<h3 id="connlimitæ‰©å±•æ¨¡å—"><a href="#connlimitæ‰©å±•æ¨¡å—" class="headerlink" title="connlimitæ‰©å±•æ¨¡å—"></a>connlimitæ‰©å±•æ¨¡å—</h3><p>ä½¿ç”¨connlimitæ‰©å±•æ¨¡å—ï¼Œå¯ä»¥é™åˆ¶æ¯ä¸ªIPåœ°å€åŒæ—¶é“¾æ¥åˆ°serverç«¯çš„é“¾æ¥æ•°é‡ï¼Œæ³¨æ„ï¼šæˆ‘ä»¬ä¸ç”¨æŒ‡å®šIPï¼Œå…¶é»˜è®¤å°±æ˜¯é’ˆå¯¹â€æ¯ä¸ªå®¢æˆ·ç«¯IPâ€ï¼Œå³å¯¹å•IPçš„å¹¶å‘è¿æ¥æ•°é™åˆ¶ã€‚</p>
<p>æ¯”å¦‚ï¼Œæˆ‘ä»¬æƒ³è¦é™åˆ¶ï¼Œæ¯ä¸ªIPåœ°å€æœ€å¤šåªèƒ½å ç”¨ä¸¤ä¸ªsshé“¾æ¥è¿œç¨‹åˆ°serverç«¯ï¼Œæˆ‘ä»¬åˆ™å¯ä»¥è¿›è¡Œå¦‚ä¸‹é™åˆ¶ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifap4000xpwr7gg0bhm2w/11.png" alt="image"></p>
<p>ä¸Šä¾‹ä¸­ï¼Œä½¿ç”¨â€-m connlimitâ€æŒ‡å®šä½¿ç”¨connlimitæ‰©å±•ï¼Œä½¿ç”¨â€â€“connlimit-above 2â€³è¡¨ç¤ºé™åˆ¶æ¯ä¸ªIPçš„é“¾æ¥æ•°é‡ä¸Šé™ä¸º2ï¼Œå†é…åˆ-p tcp â€“dport 22ï¼Œå³è¡¨ç¤ºé™åˆ¶æ¯ä¸ªå®¢æˆ·ç«¯IPçš„sshå¹¶å‘é“¾æ¥æ•°é‡ä¸èƒ½é«˜äº2ã€‚</p>
<p>centos6ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹â€“connlimit-aboveé€‰é¡¹è¿›è¡Œå–åï¼Œæ²¡é”™ï¼Œè€è§„çŸ©ï¼Œä½¿ç”¨â€!â€å¯¹æ­¤æ¡ä»¶è¿›è¡Œå–åï¼Œç¤ºä¾‹å¦‚ä¸‹<br><img src="/2022/06/13/uncatalog/cl4cifap4000xpwr7gg0bhm2w/12.png" alt="image"></p>
<p>ä¸Šä¾‹è¡¨ç¤ºï¼Œæ¯ä¸ªå®¢æˆ·ç«¯IPçš„sshé“¾æ¥æ•°é‡åªè¦ä¸è¶…è¿‡ä¸¤ä¸ªï¼Œåˆ™å…è®¸é“¾æ¥ã€‚</p>
<p>ä½†æ˜¯èªæ˜å¦‚ä½ ä¸€å®šæƒ³åˆ°äº†ï¼Œä¸Šä¾‹çš„è§„åˆ™å¹¶ä¸èƒ½è¡¨ç¤ºï¼šæ¯ä¸ªå®¢æˆ·ç«¯IPçš„sshé“¾æ¥æ•°é‡è¶…è¿‡ä¸¤ä¸ªåˆ™æ‹’ç»é“¾æ¥ï¼ˆä¸å‰æ–‡ä¸­çš„ä¸¾ä¾‹åŸç†ç›¸åŒï¼Œæ­¤å¤„ä¸å†èµ˜è¿°ï¼Œå¦‚æœä½ ä¸æ˜ç™½ï¼Œè¯·å‚è€ƒä¹‹å‰çš„æ–‡ç« ï¼‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå³ä½¿æˆ‘ä»¬é…ç½®äº†ä¸Šä¾‹ä¸­çš„è§„åˆ™ï¼Œä¹Ÿä¸èƒ½è¾¾åˆ°â€é™åˆ¶â€çš„ç›®çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬é€šå¸¸å¹¶ä¸ä¼šå¯¹æ­¤é€‰é¡¹å–åï¼Œå› ä¸ºæ—¢ç„¶ä½¿ç”¨äº†æ­¤é€‰é¡¹ï¼Œæˆ‘ä»¬çš„ç›®çš„é€šå¸¸å°±æ˜¯â€é™åˆ¶â€è¿æ¥æ•°é‡ã€‚</p>
<p>centos7ä¸­iptablesä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªæ–°çš„é€‰é¡¹ï¼Œâ€“connlimit-uptoï¼Œè¿™ä¸ªé€‰é¡¹çš„å«ä¹‰ä¸â€! â€“commlimit-aboveâ€çš„å«ä¹‰ç›¸åŒï¼Œå³é“¾æ¥æ•°é‡æœªè¾¾åˆ°æŒ‡å®šçš„è¿æ¥æ•°é‡ä¹‹æ„ï¼Œæ‰€ä»¥ç»¼ä¸Šæ‰€è¿°ï¼Œâ€“connlimit-uptoé€‰é¡¹ä¹Ÿä¸å¸¸ç”¨ã€‚</p>
<p>åˆšæ‰è¯´è¿‡ï¼Œâ€“connlimit-aboveé»˜è®¤è¡¨ç¤ºé™åˆ¶â€æ¯ä¸ªIPâ€çš„é“¾æ¥æ•°é‡ï¼Œå…¶å®ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é…åˆâ€“connlimit-maské€‰é¡¹ï¼Œå»é™åˆ¶â€æŸç±»ç½‘æ®µâ€çš„é“¾æ¥æ•°é‡ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<p>ï¼ˆæ³¨ï¼šä¸‹ä¾‹éœ€è¦ä¸€å®šçš„ç½‘ç»œçŸ¥è¯†åŸºç¡€ï¼Œå¦‚æœä½ è¿˜ä¸äº†è§£å®ƒä»¬ï¼Œå¯ä»¥é€‰æ‹©å…ˆè·³è¿‡æ­¤é€‰é¡¹æˆ–è€…å…ˆå»å­¦ä¹ éƒ¨åˆ†çš„ç½‘ç»œçŸ¥è¯†ï¼‰</p>
<p><img src="/2022/06/13/uncatalog/cl4cifap4000xpwr7gg0bhm2w/13.png" alt="image"><br>ä¸Šä¾‹ä¸­ï¼Œâ€â€“connlimit-mask 24â€³è¡¨ç¤ºæŸä¸ªCç±»ç½‘æ®µï¼Œæ²¡é”™ï¼Œmaskä¸ºæ©ç ä¹‹æ„ï¼Œæ‰€ä»¥å°†24è½¬æ¢æˆç‚¹åˆ†åè¿›åˆ¶å°±è¡¨ç¤º255.255.255.0ï¼Œæ‰€ä»¥ï¼Œä¸Šå›¾ç¤ºä¾‹çš„è§„åˆ™è¡¨ç¤ºï¼Œä¸€ä¸ªæœ€å¤šåŒ…å«254ä¸ªIPçš„Cç±»ç½‘ç»œä¸­ï¼ŒåŒæ—¶æœ€å¤šåªèƒ½æœ‰2ä¸ªsshå®¢æˆ·ç«¯è¿æ¥åˆ°å½“å‰æœåŠ¡å™¨ï¼Œçœ‹æ¥èµ„æºå¾ˆç´§ä¿å•Šï¼254ä¸ªIPæ‰æœ‰2ä¸ªåé¢ï¼Œå¦‚æœä¸€ä¸ªIPåŒæ—¶æŠŠä¸¤ä¸ªè¿æ¥åé¢éƒ½å ç”¨äº†ï¼Œé‚£ä¹ˆå‰©ä¸‹çš„253ä¸ªIPè¿ä¸€ä¸ªè¿æ¥åé¢éƒ½æ²¡æœ‰äº†ï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬å†çœ‹çœ‹ä¸‹ä¾‹ï¼Œæ˜¯ä¸æ˜¯å°±å¥½å¤šäº†ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifap4000xpwr7gg0bhm2w/14.png" alt="image"></p>
<p>ä¸Šä¾‹ä¸­ï¼Œâ€â€“connlimit-mask 27â€³è¡¨ç¤ºæŸä¸ªCç±»ç½‘æ®µï¼Œé€šè¿‡è®¡ç®—åå¯ä»¥å¾—çŸ¥ï¼Œè¿™ä¸ªç½‘æ®µä¸­æœ€å¤šåªèƒ½æœ‰30å°æœºå™¨ï¼ˆ30ä¸ªIPï¼‰ï¼Œè¿™30ä¸ªIPåœ°å€æœ€å¤šåªèƒ½æœ‰10ä¸ªsshè¿æ¥åŒæ—¶è¿æ¥åˆ°æœåŠ¡å™¨ç«¯ï¼Œæ˜¯ä¸æ˜¯æ¯”åˆšæ‰çš„è®¾ç½®å¤§æ–¹å¤šäº†ï¼Œå½“ç„¶ï¼Œè¿™æ ·å¹¶ä¸èƒ½é¿å…æŸä¸ªIPå ç”¨æ‰€æœ‰è¿æ¥çš„æƒ…å†µå‘ç”Ÿï¼Œå‡è®¾ï¼ŒæŠ¥æ–‡æ¥è‡ª192.168.1.40è¿™ä¸ªIPï¼ŒæŒ‰ç…§æ©ç ä¸º27è¿›è¡Œè®¡ç®—ï¼Œè¿™ä¸ªIPå±äº192.168.1.32/27ç½‘æ®µï¼Œå¦‚æœ192.168.1.40åŒæ—¶å ç”¨äº†10ä¸ªsshè¿æ¥ï¼Œé‚£ä¹ˆå½“192.168.1.51è¿™ä¸ªIPå‘æœåŠ¡ç«¯å‘èµ·sshè¿æ¥è¯·æ±‚æ—¶ï¼ŒåŒæ ·ä¼šè¢«æ‹’ç»ï¼Œå› ä¸º192.168.1.51è¿™ä¸ªIPæŒ‰ç…§æ©ç ä¸º27è¿›è¡Œè®¡ç®—ï¼Œä¹Ÿæ˜¯å±äº192.168.1.32/27ç½‘æ®µï¼Œæ‰€ä»¥ä»–ä»¬å…±äº«è¿™10ä¸ªè¿æ¥åé¢ã€‚</p>
<p>èªæ˜å¦‚ä½ ä¸€å®šæ˜ç™½äº†ï¼Œåœ¨ä¸ä½¿ç”¨â€“connlimit-maskçš„æƒ…å†µä¸‹ï¼Œè¿æ¥æ•°é‡çš„é™åˆ¶æ˜¯é’ˆå¯¹â€æ¯ä¸ªIPâ€è€Œè¨€çš„ï¼Œå½“ä½¿ç”¨äº†â€“connlimit-maské€‰é¡¹ä»¥åï¼Œåˆ™å¯ä»¥é’ˆå¯¹â€æŸç±»IPæ®µå†…çš„ä¸€å®šæ•°é‡çš„IPâ€è¿›è¡Œè¿æ¥æ•°é‡çš„é™åˆ¶ï¼Œè¿™æ ·å°±èƒ½å¤Ÿçµæ´»è®¸å¤šï¼Œä¸æ˜¯å—ï¼Ÿ</p>
<h3 id="limitæ‰©å±•æ¨¡å—"><a href="#limitæ‰©å±•æ¨¡å—" class="headerlink" title="limitæ‰©å±•æ¨¡å—"></a>limitæ‰©å±•æ¨¡å—</h3><p>åˆšæ‰è®¤è¯†äº†connlimitæ¨¡å—ï¼Œç°åœ¨æ¥è®¤è¯†ä¸€ä¸‹limitæ¨¡å—ã€‚</p>
<p>connlimitæ¨¡å—æ˜¯å¯¹è¿æ¥æ•°é‡è¿›è¡Œé™åˆ¶çš„ï¼Œlimitæ¨¡å—æ˜¯å¯¹â€æŠ¥æ–‡åˆ°è¾¾é€Ÿç‡â€è¿›è¡Œé™åˆ¶çš„ã€‚</p>
<p>ç”¨å¤§ç™½è¯è¯´å°±æ˜¯ï¼Œå¦‚æœæˆ‘æƒ³è¦é™åˆ¶å•ä½æ—¶é—´å†…æµå…¥çš„åŒ…çš„æ•°é‡ï¼Œå°±èƒ½ç”¨limitæ¨¡å—ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ä»¥ç§’ä¸ºå•ä½è¿›è¡Œé™åˆ¶ï¼Œä¹Ÿå¯ä»¥ä»¥åˆ†é’Ÿã€å°æ—¶ã€å¤©ä½œä¸ºå•ä½è¿›è¡Œé™åˆ¶ã€‚</p>
<p>æ¯”å¦‚ï¼Œé™åˆ¶æ¯ç§’ä¸­æœ€å¤šæµå…¥3ä¸ªåŒ…ï¼Œæˆ–è€…é™åˆ¶æ¯åˆ†é’Ÿæœ€å¤šæµå…¥30ä¸ªåŒ…ï¼Œéƒ½å¯ä»¥ã€‚</p>
<p>é‚£ä¹ˆï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªæœ€ç®€å•çš„ç¤ºä¾‹ï¼Œå‡è®¾ï¼Œæˆ‘ä»¬æƒ³è¦é™åˆ¶ï¼Œå¤–éƒ¨ä¸»æœºå¯¹æœ¬æœºè¿›è¡Œpingæ“ä½œæ—¶ï¼Œæœ¬æœºæœ€å¤šæ¯6ç§’ä¸­æ”¾è¡Œä¸€ä¸ªpingåŒ…ï¼Œé‚£ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥è¿›è¡Œå¦‚ä¸‹è®¾ç½®ï¼ˆæ³¨æ„ï¼Œåªè¿›è¡Œå¦‚ä¸‹è®¾ç½®æœ‰å¯èƒ½æ— æ³•å®ç°é™åˆ¶åŠŸèƒ½ï¼Œè¯·çœ‹å®Œåé¢çš„å†…å®¹ï¼‰</p>
<p><img src="/2022/06/13/uncatalog/cl4cifap4000xpwr7gg0bhm2w/16.png" alt="image"></p>
<p>ä¸Šä¾‹ä¸­ï¼Œâ€-p icmpâ€è¡¨ç¤ºæˆ‘ä»¬é’ˆå¯¹pingè¯·æ±‚æ·»åŠ äº†ä¸€æ¡è§„åˆ™ï¼ˆpingä½¿ç”¨icmpåè®®ï¼‰ï¼Œâ€-m limitâ€è¡¨ç¤ºä½¿ç”¨limitæ¨¡å—ï¼Œ â€œâ€“limit 10/minute -j ACCEPTâ€è¡¨ç¤ºæ¯åˆ†é’Ÿæœ€å¤šæ”¾è¡Œ10ä¸ªåŒ…ï¼Œå°±ç›¸å½“äºæ¯6ç§’é’Ÿæœ€å¤šæ”¾è¡Œä¸€ä¸ªåŒ…ï¼Œæ¢å¥è¯è¯´ï¼Œå°±æ˜¯æ¯è¿‡6ç§’é’Ÿæ”¾è¡Œä¸€ä¸ªåŒ…ï¼Œé‚£ä¹ˆé…ç½®å®Œä¸Šè¿°è§„åˆ™åï¼Œæˆ‘ä»¬åœ¨å¦å¤–ä¸€å°æœºå™¨ä¸Šå¯¹å½“å‰æœºå™¨è¿›è¡Œpingæ“ä½œï¼Œçœ‹çœ‹æ˜¯å¦èƒ½å¤Ÿè¾¾åˆ°é™åˆ¶çš„ç›®çš„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifap4000xpwr7gg0bhm2w/15.png" alt="image"></p>
<p>æˆ‘ä»¬å‘ç°ï¼Œåˆšæ‰é…ç½®çš„è§„åˆ™å¹¶æ²¡æœ‰å¦‚æˆ‘ä»¬æƒ³è±¡ä¸­çš„ä¸€æ ·ï¼Œpingè¯·æ±‚çš„å“åº”é€Ÿç‡å®Œå…¨æ²¡æœ‰å‘ç”Ÿä»»ä½•å˜åŒ–ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬ä¸€èµ·æ¥åˆ†æä¸€ä¸‹ã€‚</p>
<p>æˆ‘ä»¬å†æ¥å›é¡¾ä¸€ä¸‹åˆšæ‰é…ç½®çš„è§„åˆ™ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifap4000xpwr7gg0bhm2w/16.png" alt="image"></p>
<p>å…¶å®ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠä¸Šå›¾ä¸­çš„è§„åˆ™ç†è§£ä¸ºå¦‚ä¸‹å«ä¹‰ã€‚</p>
<p>æ¯6ç§’æ”¾è¡Œä¸€ä¸ªåŒ…ï¼Œé‚£ä¹ˆiptableså°±ä¼šè®¡æ—¶ï¼Œæ¯6ç§’ä¸€ä¸ªè½®æ¬¡ï¼Œåˆ°ç¬¬6ç§’æ—¶ï¼Œè¾¾åˆ°çš„æŠ¥æ–‡å°±ä¼šåŒ¹é…åˆ°å¯¹åº”çš„è§„åˆ™ï¼Œæ‰§è¡Œå¯¹åº”çš„åŠ¨ä½œï¼Œè€Œä¸Šå›¾ä¸­çš„åŠ¨ä½œæ˜¯ACCEPTã€‚</p>
<p>é‚£ä¹ˆåœ¨ç¬¬6ç§’ä¹‹å‰åˆ°è¾¾çš„åŒ…ï¼Œåˆ™æ— æ³•è¢«ä¸Šè¿°è§„åˆ™åŒ¹é…åˆ°ã€‚</p>
<p>ä¹‹å‰æ€»ç»“è¿‡ï¼ŒæŠ¥æ–‡ä¼šåŒ¹é…é“¾ä¸­çš„æ¯ä¸€æ¡è§„åˆ™ï¼Œå¦‚æœæ²¡æœ‰ä»»ä½•ä¸€æ¡è§„åˆ™èƒ½å¤ŸåŒ¹é…åˆ°ï¼Œåˆ™åŒ¹é…é»˜è®¤åŠ¨ä½œï¼ˆé“¾çš„é»˜è®¤ç­–ç•¥ï¼‰ã€‚</p>
<p>æ—¢ç„¶ç¬¬6ç§’ä¹‹å‰çš„åŒ…æ²¡æœ‰è¢«ä¸Šè¿°è§„åˆ™åŒ¹é…åˆ°ï¼Œè€Œæˆ‘ä»¬åˆæ²¡æœ‰åœ¨INPUTé“¾ä¸­é…ç½®å…¶ä»–è§„åˆ™ï¼Œæ‰€ä»¥ï¼Œç¬¬6ç§’ä¹‹å‰çš„åŒ…è‚¯å®šä¼šè¢«é»˜è®¤ç­–ç•¥åŒ¹é…åˆ°ï¼Œé‚£ä¹ˆæˆ‘ä»¬çœ‹çœ‹é»˜è®¤ç­–ç•¥æ˜¯ä»€ä¹ˆã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifap4000xpwr7gg0bhm2w/17.png" alt="image"></p>
<p>ç°åœ¨å†æƒ³æƒ³ï¼Œæˆ‘æƒ³ä½ åº”è¯¥æ˜ç™½ä¸ºä»€ä¹ˆåˆšæ‰çš„pingçš„å“åº”é€Ÿç‡æ²¡æœ‰å˜åŒ–äº†ã€‚</p>
<p>å› ä¸ºï¼Œä¸Šä¾‹ä¸­ï¼Œç¬¬å…­ç§’çš„æŠ¥æ–‡çš„ç¡®è¢«å¯¹åº”çš„è§„åˆ™åŒ¹é…åˆ°äº†ï¼Œäºæ˜¯æ‰§è¡Œäº†â€æ”¾è¡Œâ€æ“ä½œï¼Œç¬¬6ç§’ä¹‹å‰çš„æŠ¥æ–‡æ²¡æœ‰è¢«ä¸Šå›¾ä¸­é…ç½®çš„è§„åˆ™åŒ¹é…åˆ°ï¼Œä½†æ˜¯è¢«é»˜è®¤ç­–ç•¥åŒ¹é…åˆ°äº†ï¼Œè€Œæ°å·§ï¼Œé»˜è®¤åŠ¨ä½œä¹Ÿæ˜¯ACCEPTï¼Œæ‰€ä»¥ï¼Œç›¸å½“äºæ‰€æœ‰çš„pingæŠ¥æ–‡éƒ½è¢«æ”¾è¡Œäº†ï¼Œæ€ªä¸å¾—ä¸æ²¡æœ‰é…ç½®è§„åˆ™æ—¶çš„é€Ÿç‡ä¸€æ¯›ä¸€æ ·äº†ã€‚</p>
<p>é‚£ä¹ˆï¼ŒçŸ¥é”™å°±æ”¹ï¼Œèªæ˜å¦‚ä½ ä¸€å®šæƒ³åˆ°äº†ï¼Œæˆ‘ä»¬å¯ä»¥ä¿®æ”¹INPUTé“¾çš„é»˜è®¤ç­–ç•¥ï¼Œæˆ–è€…åœ¨ä¸Šä¾‹é™åˆ¶è§„åˆ™çš„åé¢å†åŠ å…¥ä¸€æ¡è§„åˆ™ï¼Œå°†â€æ¼ç½‘ä¹‹é±¼â€åŒ¹é…åˆ°å³å¯ï¼Œç¤ºä¾‹å¦‚ä¸‹ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifap4000xpwr7gg0bhm2w/18.png" alt="image"></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œç¬¬ä¸€æ¡è§„åˆ™è¡¨ç¤ºæ¯åˆ†é’Ÿæœ€å¤šæ”¾è¡Œ10ä¸ªicmpåŒ…ï¼Œä¹Ÿå°±æ˜¯6ç§’æ”¾è¡Œä¸€ä¸ªï¼Œç¬¬6ç§’çš„icmpåŒ…ä¼šè¢«ä¸Šä¾‹ä¸­çš„ç¬¬ä¸€æ¡è§„åˆ™åŒ¹é…åˆ°ï¼Œç¬¬6ç§’ä¹‹å‰çš„åŒ…åˆ™ä¸ä¼šè¢«ç¬¬ä¸€æ¡è§„åˆ™åŒ¹é…åˆ°ï¼Œäºæ˜¯è¢«åé¢çš„æ‹’ç»è§„åˆ™åŒ¹é…åˆ°äº†ï¼Œé‚£ä¹ˆï¼Œæ­¤åˆ»ï¼Œæˆ‘ä»¬å†æ¥è¯•è¯•ï¼Œçœ‹çœ‹pingçš„æŠ¥æ–‡æ”¾è¡Œé€Ÿç‡æœ‰æ²¡æœ‰å‘ç”Ÿæ”¹å˜ã€‚</p>
<p>å¦‚ä¸‹å›¾æ‰€ç¤º<br><img src="/2022/06/13/uncatalog/cl4cifap4000xpwr7gg0bhm2w/19.png" alt="image"></p>
<p>åˆšå¼€å§‹è¿˜çœŸå“æˆ‘ä¸€è·³ï¼Œéš¾é“é…ç½®çš„è§„åˆ™è¿˜æ˜¯æœ‰é—®é¢˜ï¼Ÿ</p>
<p>ç»“æœå‘ç°ï¼Œåªæœ‰å‰5ä¸ªpingåŒ…æ²¡æœ‰å—åˆ°é™åˆ¶ï¼Œä¹‹åçš„pingåŒ…å·²ç»å¼€å§‹å—åˆ°äº†è§„åˆ™çš„é™åˆ¶äº†ã€‚</p>
<p>ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œé™¤äº†å‰5ä¸ªpingåŒ…ä»¥å¤–ï¼Œä¹‹åçš„pingåŒ…å·®ä¸å¤šæ¯6ç§’æ‰èƒ½pingé€šä¸€æ¬¡ï¼Œçœ‹æ¥ï¼Œä¹‹åçš„pingåŒ…å·²ç»å—åˆ°äº†è§„åˆ™çš„æ§åˆ¶ï¼Œè¢«é™åˆ¶äº†æµå…¥é˜²ç«å¢™çš„é€Ÿç‡äº†ï¼Œé‚£ä¹ˆï¼Œå‰5ä¸ªpingåŒ…æ˜¯ä»€ä¹ˆé¬¼ï¼Ÿä¸ºä»€ä¹ˆå®ƒä»¬ä¸å—è§„åˆ™é™åˆ¶å‘¢ï¼Ÿå…¶å®ï¼Œè¿™ä¸ªç°è±¡æ­£å¥½å¼•å‡ºå¦ä¸€ä¸ªè¯é¢˜ï¼Œå‡ºç°ä¸Šå›¾ä¸­çš„æƒ…å†µï¼Œæ˜¯å› ä¸ºå¦ä¸€ä¸ªé€‰é¡¹ï¼šâ€â€“limit-burstâ€</p>
<p>limit-bursté€‰é¡¹æ˜¯å¹²ä»€ä¹ˆç”¨çš„å‘¢ï¼Ÿæˆ‘ä»¬å…ˆç”¨ä¸å‡†ç¡®çš„å¤§ç™½è¯æè¿°ä¸€éï¼Œâ€â€“limit-burstâ€å¯ä»¥æŒ‡å®šâ€ç©ºé—²æ—¶å¯æ”¾è¡Œçš„åŒ…çš„æ•°é‡â€ï¼Œå…¶å®ï¼Œè¿™æ ·è¯´å¹¶ä¸å‡†ç¡®ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥å…ˆè¿™æ ·å¤§æ¦‚çš„ç†è§£ï¼Œåœ¨ä¸ä½¿ç”¨â€â€“limit-burstâ€é€‰é¡¹æ˜ç¡®æŒ‡å®šæ”¾è¡ŒåŒ…çš„æ•°é‡æ—¶ï¼Œé»˜è®¤å€¼ä¸º5ï¼Œæ‰€ä»¥ï¼Œæ‰ä¼šå‡ºç°ä¸Šå›¾ä¸­çš„æƒ…å†µï¼Œå‰5ä¸ªpingåŒ…å¹¶æ²¡æœ‰å—åˆ°ä»»ä½•é€Ÿç‡é™åˆ¶ï¼Œä¹‹åçš„åŒ…æ‰å—åˆ°äº†è§„åˆ™çš„é™åˆ¶ã€‚</p>
<p>å¦‚æœæƒ³è¦å½»åº•äº†è§£limitæ¨¡å—çš„å·¥ä½œåŸç†ï¼Œæˆ‘ä»¬éœ€è¦å…ˆäº†è§£ä¸€ä¸‹â€ä»¤ç‰Œæ¡¶â€ç®—æ³•ï¼Œå› ä¸ºlimitæ¨¡å—ä½¿ç”¨äº†ä»¤ç‰Œæ¡¶ç®—æ³•ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥è¿™æ ·æƒ³è±¡ï¼Œæœ‰ä¸€ä¸ªæœ¨æ¡¶ï¼Œæœ¨æ¡¶é‡Œé¢æ”¾äº†5å—ä»¤ç‰Œï¼Œè€Œä¸”è¿™ä¸ªæœ¨æ¡¶æœ€å¤šä¹Ÿåªèƒ½æ”¾ä¸‹5å—ä»¤ç‰Œï¼Œæ‰€æœ‰æŠ¥æ–‡å¦‚æœæƒ³è¦å‡ºå…³å…¥å…³ï¼Œéƒ½å¿…é¡»è¦æŒæœ‰æœ¨æ¡¶ä¸­çš„ä»¤ç‰Œæ‰è¡Œï¼Œè¿™ä¸ªæœ¨æ¡¶æœ‰ä¸€ä¸ªç¥å¥‡çš„åŠŸèƒ½ï¼Œå°±æ˜¯æ¯éš”6ç§’é’Ÿä¼šç”Ÿæˆä¸€å—æ–°çš„ä»¤ç‰Œï¼Œå¦‚æœæ­¤æ—¶ï¼Œæœ¨æ¡¶ä¸­çš„ä»¤ç‰Œä¸è¶³5å—ï¼Œé‚£ä¹ˆæ–°ç”Ÿæˆçš„ä»¤ç‰Œå°±å­˜æ”¾åœ¨æœ¨æ¡¶ä¸­ï¼Œå¦‚æœæœ¨æ¡¶ä¸­å·²ç»å­˜åœ¨5å—ä»¤ç‰Œï¼Œæ–°ç”Ÿæˆçš„ä»¤ç‰Œå°±æ— å¤„å®‰æ”¾äº†ï¼Œåªèƒ½æº¢å‡ºæœ¨æ¡¶ï¼ˆä»¤ç‰Œè¢«ä¸¢å¼ƒï¼‰ï¼Œå¦‚æœæ­¤æ—¶æœ‰5ä¸ªæŠ¥æ–‡æƒ³è¦å…¥å…³ï¼Œé‚£ä¹ˆè¿™5ä¸ªæŠ¥æ–‡å°±å»æœ¨æ¡¶é‡Œæ‰¾ä»¤ç‰Œï¼Œæ­£å¥½ä¸€äººä¸€ä¸ªï¼Œäºæ˜¯ä»–ä»¬5ä¸ªæ‰‹æŒä»¤ç‰Œï¼Œå¿«ä¹çš„å…¥å…³äº†ï¼Œæ­¤æ—¶æœ¨æ¡¶ç©ºäº†ï¼Œå†æœ‰æŠ¥æ–‡æƒ³è¦å…¥å…³ï¼Œå·²ç»æ²¡æœ‰å¯¹åº”çš„ä»¤ç‰Œå¯ä»¥ä½¿ç”¨äº†ï¼Œä½†æ˜¯ï¼Œè¿‡äº†6ç§’é’Ÿï¼Œæ–°çš„ä»¤ç‰Œç”Ÿæˆäº†ï¼Œæ­¤åˆ»ï¼Œæ­£å¥½æ¥äº†ä¸€ä¸ªæŠ¥æ–‡æƒ³è¦å…¥å…³ï¼Œäºæ˜¯ï¼Œè¿™ä¸ªæŠ¥æ–‡æ‹¿èµ·è¿™ä¸ªä»¤ç‰Œï¼Œå°±å…¥å…³äº†ï¼Œåœ¨è¿™ä¸ªæŠ¥æ–‡ä¹‹åï¼Œå¦‚æœå¾ˆé•¿ä¸€æ®µæ—¶é—´å†…æ²¡æœ‰æ–°çš„æŠ¥æ–‡æƒ³è¦å…¥å…³ï¼Œæœ¨æ¡¶ä¸­çš„ä»¤ç‰Œåˆä¼šæ…¢æ…¢çš„ç§¯æ”’äº†èµ·æ¥ï¼Œç›´åˆ°è¾¾åˆ°5ä¸ªä»¤ç‰Œï¼Œå¹¶ä¸”ä¸€ç›´ä¿æŒç€5ä¸ªä»¤ç‰Œï¼Œç›´åˆ°æœ‰äººéœ€è¦ä½¿ç”¨è¿™äº›ä»¤ç‰Œï¼Œè¿™å°±æ˜¯ä»¤ç‰Œæ¡¶ç®—æ³•çš„å¤§è‡´é€»è¾‘ã€‚</p>
<p>é‚£ä¹ˆï¼Œå°±æ‹¿åˆšæ‰çš„â€ä»¤ç‰Œæ¡¶â€ç†è®ºç±»æ¯”æˆ‘ä»¬çš„å‘½ä»¤ï¼Œâ€â€“limitâ€é€‰é¡¹å°±æ˜¯ç”¨äºæŒ‡å®šâ€å¤šé•¿æ—¶é—´ç”Ÿæˆä¸€ä¸ªæ–°ä»¤ç‰Œçš„â€ï¼Œâ€â€“limit-burstâ€é€‰é¡¹å°±æ˜¯ç”¨äºæŒ‡å®šâ€æœ¨æ¡¶ä¸­æœ€å¤šå­˜æ”¾å‡ ä¸ªä»¤ç‰Œçš„â€ï¼Œç°åœ¨ï¼Œä½ æ˜ç™½äº†å—ï¼Ÿï¼Ÿç¤ºä¾‹å¦‚ä¸‹</p>
<p><img src="/2022/06/13/uncatalog/cl4cifap4000xpwr7gg0bhm2w/20.png" alt="image"></p>
<p>ä¸Šä¾‹è¡¨ç¤ºï¼Œä»¤ç‰Œæ¡¶ä¸­æœ€å¤šèƒ½å­˜æ”¾3ä¸ªä»¤ç‰Œï¼Œæ¯åˆ†é’Ÿç”Ÿæˆ10ä¸ªä»¤ç‰Œï¼ˆå³6ç§’é’Ÿç”Ÿæˆä¸€ä¸ªä»¤ç‰Œï¼‰ã€‚</p>
<p>ä¹‹å‰è¯´è¿‡ï¼Œä½¿ç”¨â€â€“limitâ€é€‰é¡¹æ—¶ï¼Œå¯ä»¥é€‰æ‹©çš„æ—¶é—´å•ä½æœ‰å¤šç§ï¼Œå¦‚ä¸‹</p>
<ul>
<li><p>/second</p>
</li>
<li><p>/minute</p>
</li>
<li><p>/hour</p>
</li>
<li><p>/day</p>
</li>
</ul>
<p>æ¯”å¦‚ï¼Œ3/secondè¡¨ç¤ºæ¯ç§’ç”Ÿæˆ3ä¸ªâ€ä»¤ç‰Œâ€ï¼Œ30/minuteè¡¨ç¤ºæ²¡åˆ†é’Ÿç”Ÿæˆ30ä¸ªâ€ä»¤ç‰Œâ€ã€‚</p>
<p>æˆ‘ä¸çŸ¥é“æˆ‘åˆ°åº•è§£é‡Šæ¸…æ¥šæ²¡æœ‰ï¼Œæˆ‘æ„Ÿè§‰æˆ‘è§£é‡Šæ¸…æ¥šäº†ï¼Œå“¥ä»¬å„¿ä½ èµ¶ç´§åŠ¨æ‰‹è¯•è¯•å§ã€‚</p>
<h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>è€è§„çŸ©ï¼Œä¸ºäº†æ–¹ä¾¿ä»¥åå›é¡¾ï¼Œæˆ‘ä»¬å°†ä¸Šæ–‡ä¸­æåˆ°çš„å‘½ä»¤æ€»ç»“å¦‚ä¸‹ã€‚</p>
<p>iprangeæ¨¡å—<br>åŒ…å«çš„æ‰©å±•åŒ¹é…æ¡ä»¶å¦‚ä¸‹</p>
<ul>
<li><p>â€“src-rangeï¼šæŒ‡å®šè¿ç»­çš„æºåœ°å€èŒƒå›´</p>
</li>
<li><p>â€“dst-rangeï¼šæŒ‡å®šè¿ç»­çš„ç›®æ ‡åœ°å€èŒƒå›´</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">ç¤ºä¾‹</span></span><br><span class="line">iptables -t filter -I INPUT -m iprange --src-range 192.168.1.127-192.168.1.146 -j DROP</span><br><span class="line">iptables -t filter -I OUTPUT -m iprange --dst-range 192.168.1.127-192.168.1.146 -j DROP</span><br><span class="line">iptables -t filter -I INPUT -m iprange ! --src-range 192.168.1.127-192.168.1.146 -j DROP</span><br><span class="line"></span><br></pre></td></tr></table></figure></div></li>
</ul>
<p>stringæ¨¡å—<br>å¸¸ç”¨æ‰©å±•åŒ¹é…æ¡ä»¶å¦‚ä¸‹</p>
<ul>
<li><p>â€“algoï¼šæŒ‡å®šå¯¹åº”çš„åŒ¹é…ç®—æ³•ï¼Œå¯ç”¨ç®—æ³•ä¸ºbmã€kmpï¼Œæ­¤é€‰é¡¹ä¸ºå¿…éœ€é€‰é¡¹ã€‚</p>
</li>
<li><p>â€“stringï¼šæŒ‡å®šéœ€è¦åŒ¹é…çš„å­—ç¬¦ä¸²</p>
</li>
</ul>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">ç¤ºä¾‹</span></span><br><span class="line">iptables -t filter -I INPUT -p tcp --sport 80 -m string --algo bm --string &quot;OOXX&quot; -j REJECT</span><br><span class="line">iptables -t filter -I INPUT -p tcp --sport 80 -m string --algo bm --string &quot;OOXX&quot; -j REJECT</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>timeæ¨¡å—<br>å¸¸ç”¨æ‰©å±•åŒ¹é…æ¡ä»¶å¦‚ä¸‹</p>
<ul>
<li><p>â€“timestartï¼šç”¨äºæŒ‡å®šæ—¶é—´èŒƒå›´çš„å¼€å§‹æ—¶é—´ï¼Œä¸å¯å–å</p>
</li>
<li><p>â€“timestopï¼šç”¨äºæŒ‡å®šæ—¶é—´èŒƒå›´çš„ç»“æŸæ—¶é—´ï¼Œä¸å¯å–å</p>
</li>
<li><p>â€“weekdaysï¼šç”¨äºæŒ‡å®šâ€æ˜ŸæœŸå‡ â€ï¼Œå¯å–å</p>
</li>
<li><p>â€“monthdaysï¼šç”¨äºæŒ‡å®šâ€å‡ å·â€ï¼Œå¯å–å</p>
</li>
<li><p>â€“datestartï¼šç”¨äºæŒ‡å®šæ—¥æœŸèŒƒå›´çš„å¼€å§‹æ—¥æœŸï¼Œä¸å¯å–å</p>
</li>
<li><p>â€“datestopï¼šç”¨äºæŒ‡å®šæ—¥æœŸèŒƒå›´çš„ç»“æŸæ—¶é—´ï¼Œä¸å¯å–å</p>
</li>
</ul>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">ç¤ºä¾‹</span></span><br><span class="line">iptables -t filter -I OUTPUT -p tcp --dport 80 -m time --timestart 09:00:00 --timestop 19:00:00 -j REJECT</span><br><span class="line">iptables -t filter -I OUTPUT -p tcp --dport 443 -m time --timestart 09:00:00 --timestop 19:00:00 -j REJECT</span><br><span class="line">iptables -t filter -I OUTPUT -p tcp --dport 80  -m time --weekdays 6,7 -j REJECT</span><br><span class="line">iptables -t filter -I OUTPUT -p tcp --dport 80  -m time --monthdays 22,23 -j REJECT</span><br><span class="line">iptables -t filter -I OUTPUT -p tcp --dport 80  -m time ! --monthdays 22,23 -j REJECT</span><br><span class="line">iptables -t filter -I OUTPUT -p tcp --dport 80  -m time --timestart 09:00:00 --timestop 18:00:00 --weekdays 6,7 -j REJECT</span><br><span class="line">iptables -t filter -I OUTPUT -p tcp --dport 80  -m time --weekdays 5 --monthdays 22,23,24,25,26,27,28 -j REJECT</span><br><span class="line">iptables -t filter -I OUTPUT -p tcp --dport 80  -m time --datestart 2017-12-24 --datestop 2017-12-27 -j REJECT</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>connlimit æ¨¡å—<br>å¸¸ç”¨çš„æ‰©å±•åŒ¹é…æ¡ä»¶å¦‚ä¸‹</p>
<ul>
<li><p>â€“connlimit-aboveï¼šå•ç‹¬ä½¿ç”¨æ­¤é€‰é¡¹æ—¶ï¼Œè¡¨ç¤ºé™åˆ¶æ¯ä¸ªIPçš„é“¾æ¥æ•°é‡ã€‚</p>
</li>
<li><p>â€“connlimit-maskï¼šæ­¤é€‰é¡¹ä¸èƒ½å•ç‹¬ä½¿ç”¨ï¼Œåœ¨ä½¿ç”¨â€“connlimit-aboveé€‰é¡¹æ—¶ï¼Œé…åˆæ­¤é€‰é¡¹ï¼Œåˆ™å¯ä»¥é’ˆå¯¹â€æŸç±»IPæ®µå†…çš„ä¸€å®šæ•°é‡çš„IPâ€è¿›è¡Œè¿æ¥æ•°é‡çš„é™åˆ¶ï¼Œå¦‚æœä¸æ˜ç™½å¯ä»¥å‚è€ƒä¸Šæ–‡çš„è¯¦ç»†è§£é‡Šã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">ç¤ºä¾‹</span></span><br><span class="line">iptables -I INPUT -p tcp --dport 22 -m connlimit --connlimit-above 2 -j REJECT</span><br><span class="line">iptables -I INPUT -p tcp --dport 22 -m connlimit --connlimit-above 20 --connlimit-mask 24 -j REJECT</span><br><span class="line">iptables -I INPUT -p tcp --dport 22 -m connlimit --connlimit-above 10 --connlimit-mask 27 -j REJECT</span><br><span class="line"></span><br></pre></td></tr></table></figure></div></li>
</ul>
<p>limitæ¨¡å—<br>å¸¸ç”¨çš„æ‰©å±•åŒ¹é…æ¡ä»¶å¦‚ä¸‹</p>
<ul>
<li><p>â€“limit-burstï¼šç±»æ¯”â€ä»¤ç‰Œæ¡¶â€ç®—æ³•ï¼Œæ­¤é€‰é¡¹ç”¨äºæŒ‡å®šä»¤ç‰Œæ¡¶ä¸­ä»¤ç‰Œçš„æœ€å¤§æ•°é‡ï¼Œä¸Šæ–‡ä¸­å·²ç»è¯¦ç»†çš„æè¿°äº†â€ä»¤ç‰Œæ¡¶â€çš„æ¦‚å¿µï¼Œæ–¹ä¾¿å›é¡¾ã€‚</p>
</li>
<li><p>â€“limitï¼šç±»æ¯”â€ä»¤ç‰Œæ¡¶â€ç®—æ³•ï¼Œæ­¤é€‰é¡¹ç”¨äºæŒ‡å®šä»¤ç‰Œæ¡¶ä¸­ç”Ÿæˆæ–°ä»¤ç‰Œçš„é¢‘ç‡ï¼Œå¯ç”¨æ—¶é—´å•ä½æœ‰secondã€minute ã€hourã€dayã€‚</p>
</li>
</ul>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">ç¤ºä¾‹</span> </span><br><span class="line"><span class="meta">#</span><span class="bash">æ³¨æ„ï¼Œå¦‚ä¸‹ä¸¤æ¡è§„åˆ™éœ€é…åˆä½¿ç”¨ï¼Œå…·ä½“åŸå› ä¸Šæ–‡å·²ç»è§£é‡Šè¿‡ï¼Œå¿˜è®°äº†å¯ä»¥å›é¡¾ã€‚</span></span><br><span class="line">iptables -t filter -I INPUT -p icmp -m limit --limit-burst 3 --limit 10/minute -j ACCEPT</span><br><span class="line">iptables -t filter -A INPUT -p icmp -j REJECT</span><br></pre></td></tr></table></figure></div>]]></content>
      <tags>
        <tag>äº‘åŸç”ŸåŸºç¡€ç³»åˆ—</tag>
        <tag>Kubernetesç½‘ç»œ</tag>
      </tags>
  </entry>
  <entry>
    <title>Kubernetesç½‘ç»œç³»åˆ—ä¹‹(äºŒåå››)iptablesåŒ¹é…æ¡ä»¶æ€»ç»“ä¹‹ä¸€</title>
    <url>/2022/06/13/uncatalog/cl4cifap5000zpwr721cugaqx/</url>
    <content><![CDATA[<hr>
<span id="more"></span>

<hr>
<p>ç»è¿‡å‰æ–‡çš„æ€»ç»“ï¼Œæˆ‘ä»¬å·²ç»èƒ½å¤Ÿç†Ÿç»ƒçš„ç®¡ç†è§„åˆ™äº†ï¼Œä½†æ˜¯æˆ‘ä»¬ä½¿ç”¨è¿‡çš„â€åŒ¹é…æ¡ä»¶â€å°‘å¾—å¯æ€œï¼Œä¹‹å‰çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬åªä½¿ç”¨è¿‡ä¸€ç§åŒ¹é…æ¡ä»¶ï¼Œå°±æ˜¯å°†â€æºåœ°å€â€ä½œä¸ºåŒ¹é…æ¡ä»¶ã€‚</p>
<p>é‚£ä¹ˆè¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°±æ¥äº†è§£ä¸€ä¸‹æ›´å¤šçš„åŒ¹é…æ¡ä»¶ï¼Œä»¥åŠåŒ¹é…æ¡ä»¶çš„æ›´å¤šç”¨æ³•ã€‚</p>
<p>æ³¨æ„ï¼šåœ¨å‚ç…§æœ¬æ–‡è¿›è¡Œiptableså®éªŒæ—¶ï¼Œè¯·åŠ¡å¿…åœ¨ä¸ªäººçš„æµ‹è¯•æœºä¸Šè¿›è¡Œï¼Œå› ä¸ºå¦‚æœiptablesè§„åˆ™è®¾ç½®ä¸å½“ï¼Œæœ‰å¯èƒ½ä½¿ä½ æ— æ³•è¿æ¥åˆ°è¿œç¨‹ä¸»æœºä¸­ã€‚</p>
<h3 id="åŒ¹é…æ¡ä»¶çš„æ›´å¤šç”¨æ³•"><a href="#åŒ¹é…æ¡ä»¶çš„æ›´å¤šç”¨æ³•" class="headerlink" title="åŒ¹é…æ¡ä»¶çš„æ›´å¤šç”¨æ³•"></a>åŒ¹é…æ¡ä»¶çš„æ›´å¤šç”¨æ³•</h3><p>è¿˜æ˜¯ä»æˆ‘ä»¬æœ€å¸¸ç”¨çš„â€æºåœ°å€â€è¯´èµ·å§ï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œä½¿ç”¨-sé€‰é¡¹ä½œä¸ºåŒ¹é…æ¡ä»¶ï¼Œå¯ä»¥åŒ¹é…æŠ¥æ–‡çš„æºåœ°å€ï¼Œä½†æ˜¯ä¹‹å‰çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬æ¯æ¬¡æŒ‡å®šæºåœ°å€ï¼Œéƒ½åªæ˜¯æŒ‡å®šå•ä¸ªIPï¼Œç¤ºä¾‹å¦‚ä¸‹ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifap5000zpwr721cugaqx/1.png" alt="image"></p>
<p>å…¶å®ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨æŒ‡å®šæºåœ°å€æ—¶ï¼Œä¸€æ¬¡æŒ‡å®šå¤šä¸ªï¼Œç”¨â€é€—å·â€éš”å¼€å³å¯ï¼Œç¤ºä¾‹å¦‚ä¸‹ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifap5000zpwr721cugaqx/2.png" alt="image"></p>
<p>å¯ä»¥çœ‹å‡ºï¼Œä¸Šä¾‹ä¸­ï¼Œä¸€æ¬¡æ·»åŠ äº†ä¸¤æ¡è§„åˆ™ï¼Œä¸¤æ¡è§„åˆ™åªæ˜¯æºåœ°å€å¯¹åº”çš„IPä¸åŒï¼Œæ³¨æ„ï¼Œä¸Šä¾‹ä¸­çš„â€é€—å·â€ä¸¤ä¾§å‡ä¸èƒ½åŒ…å«ç©ºæ ¼ï¼Œå¤šä¸ªIPä¹‹é—´å¿…é¡»ä¸é€—å·ç›¸è¿ã€‚</p>
<p>é™¤äº†èƒ½æŒ‡å®šå…·ä½“çš„IPåœ°å€ï¼Œè¿˜èƒ½æŒ‡å®šæŸä¸ªç½‘æ®µï¼Œç¤ºä¾‹å¦‚ä¸‹</p>
<p><img src="/2022/06/13/uncatalog/cl4cifap5000zpwr721cugaqx/3.png" alt="image"></p>
<p>ä¸Šä¾‹è¡¨ç¤ºï¼Œå¦‚æœæŠ¥æ–‡çš„æºåœ°å€IPåœ¨10.6.0.0/16ç½‘æ®µå†…ï¼Œå½“æŠ¥æ–‡ç»è¿‡INPUTé“¾æ—¶å°±ä¼šè¢«DROPæ‰ã€‚</p>
<p>å…¶å®ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å¯¹åŒ¹é…æ¡ä»¶å–åï¼Œå…ˆçœ‹ç¤ºä¾‹ï¼Œå¦‚ä¸‹ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifap5000zpwr721cugaqx/4.png" alt="image"></p>
<p>ä¸Šå›¾ä¸­ï¼Œä½¿ç”¨â€! -s 192.168.1.146â€³è¡¨ç¤ºå¯¹ -s 192.168.1.146è¿™ä¸ªåŒ¹é…æ¡ä»¶å–åï¼Œ -s 192.168.1.146è¡¨ç¤ºæŠ¥æ–‡æºIPåœ°å€ä¸º192.168.1.146å³å¯æ»¡è¶³åŒ¹é…æ¡ä»¶ï¼Œä½¿ç”¨ â€œ!â€ å–åååˆ™è¡¨ç¤ºï¼ŒæŠ¥æ–‡æºåœ°å€IPåªè¦ä¸ä¸º192.168.1.146å³æ»¡è¶³æ¡ä»¶ï¼Œé‚£ä¹ˆï¼Œä¸Šä¾‹ä¸­è§„åˆ™è¡¨è¾¾çš„æ„æ€å°±æ˜¯ï¼Œåªè¦å‘å¾€æœ¬æœºçš„æŠ¥æ–‡çš„æºåœ°å€ä¸æ˜¯192.168.1.146ï¼Œå°±æ¥å—æŠ¥æ–‡ã€‚</p>
<p>æ­¤åˆ»ï¼Œä½ çŒœçŒœï¼ŒæŒ‰ç…§ä¸Šä¾‹ä¸­çš„é…ç½®ï¼Œå¦‚æœæ­¤æ—¶ä»146ä¸»æœºä¸Šå‘é˜²ç«å¢™æ‰€åœ¨çš„ä¸»æœºå‘é€pingè¯·æ±‚ï¼Œ146ä¸»æœºèƒ½å¾—åˆ°å›åº”å—ï¼Ÿï¼ˆæ­¤å¤„ä¸è€ƒè™‘å…¶ä»–é“¾ï¼Œåªè€ƒè™‘filterè¡¨çš„INPUTé“¾ï¼‰</p>
<p>ä¸ºäº†ç»™ä½ æ€è€ƒçš„ç©ºé—´ï¼Œæˆ‘æŠŠç­”æ¡ˆå†™çš„è¿œä¸€ç‚¹ã€‚</p>
<p><br><br><br><br><br><br><br><br></p>
<p>ç­”æ¡ˆæ˜¯ï¼šèƒ½ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒæŒ‰ç…§ä¸Šä¾‹çš„é…ç½®ï¼Œ146ä¸»æœºä»ç„¶èƒ½å¤Ÿpingé€šå½“å‰ä¸»æœºï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ã€‚</p>
<p>ä¸Šä¾‹ä¸­ï¼Œfilterè¡¨çš„INPUTé“¾ä¸­åªæœ‰ä¸€æ¡è§„åˆ™ï¼Œè¿™æ¡è§„åˆ™è¦è¡¨è¾¾çš„æ„æ€å°±æ˜¯ï¼š</p>
<p>åªè¦æŠ¥æ–‡çš„æºIPä¸æ˜¯192.168.1.146ï¼Œé‚£ä¹ˆå°±æ¥å—æ­¤æŠ¥æ–‡ï¼Œä½†æ˜¯ï¼ŒæŸäº›å°ä¼™ä¼´å¯èƒ½ä¼šè¯¯ä¼šï¼ŒæŠŠä¸Šä¾‹ä¸­çš„è§„åˆ™ç†è§£æˆå¦‚ä¸‹å«ä¹‰ï¼Œ</p>
<p>åªè¦æŠ¥æ–‡çš„æºIPæ˜¯192.168.1.146ï¼Œé‚£ä¹ˆå°±ä¸æ¥å—æ­¤æŠ¥æ–‡ï¼Œè¿™ç§ç†è§£ä¸ä¸Šè¿°ç†è§£çœ‹ä¼¼å·®åˆ«ä¸å¤§ï¼Œå…¶å®å®Œå…¨ä¸ä¸€æ ·ï¼Œè¿™æ ·ç†è§£æ˜¯é”™è¯¯çš„ï¼Œä¸Šè¿°ç†è§£æ‰æ˜¯æ­£ç¡®çš„ã€‚</p>
<p>æ¢å¥è¯è¯´å°±æ˜¯ï¼ŒæŠ¥æ–‡çš„æºIPä¸æ˜¯192.168.1.146æ—¶ï¼Œä¼šè¢«æ¥æ”¶ï¼Œå¹¶ä¸èƒ½ä»£è¡¨ï¼ŒæŠ¥æ–‡çš„æºIPæ˜¯192.168.1.146æ—¶ï¼Œä¼šè¢«æ‹’ç»ã€‚</p>
<p>ä¸Šä¾‹ä¸­ï¼Œå› ä¸ºå¹¶æ²¡æœ‰ä»»ä½•ä¸€æ¡è§„åˆ™æŒ‡æ˜æºIPæ˜¯192.168.1.146æ—¶ï¼Œè¯¥æ‰§è¡Œæ€æ ·çš„åŠ¨ä½œï¼Œæ‰€ä»¥ï¼Œå½“æ¥è‡ª192.168.1.146çš„æŠ¥æ–‡ç»è¿‡INPUTé“¾æ—¶ï¼Œå¹¶ä¸èƒ½åŒ¹é…ä¸Šä¾‹ä¸­çš„è§„åˆ™ï¼Œäºæ˜¯ï¼Œæ­¤æŠ¥æ–‡å°±ç»§ç»­åŒ¹é…åé¢çš„è§„åˆ™ï¼Œå¯æ˜¯ï¼Œä¸Šä¾‹ä¸­åªæœ‰ä¸€æ¡è§„åˆ™ï¼Œè¿™æ¡è§„åˆ™åé¢æ²¡æœ‰å…¶ä»–å¯ä»¥åŒ¹é…çš„è§„åˆ™ï¼Œäºæ˜¯ï¼Œæ­¤æŠ¥æ–‡å°±ä¼šå»åŒ¹é…å½“å‰é“¾çš„é»˜è®¤åŠ¨ä½œ(é»˜è®¤ç­–ç•¥)ï¼Œè€Œä¸Šä¾‹ä¸­ï¼ŒINPUTé“¾çš„é»˜è®¤åŠ¨ä½œä¸ºACCEPTï¼Œæ‰€ä»¥ï¼Œæ¥è‡ª146çš„pingæŠ¥æ–‡å°±è¢«æ¥æ”¶äº†ï¼Œå¦‚æœï¼ŒæŠŠä¸Šä¾‹ä¸­INPUTé“¾çš„é»˜è®¤ç­–ç•¥æ”¹ä¸ºDROPï¼Œé‚£ä¹ˆï¼Œ146çš„æŠ¥æ–‡å°†ä¼šè¢«ä¸¢å¼ƒï¼Œ146ä¸Šçš„pingå‘½ä»¤å°†å¾—ä¸åˆ°ä»»ä½•å›åº”ï¼Œä½†æ˜¯å¦‚æœå°†INPUTé“¾çš„é»˜è®¤ç­–ç•¥è®¾ç½®ä¸ºDROPï¼Œå½“INPUTé“¾ä¸­æ²¡æœ‰ä»»ä½•è§„åˆ™æ—¶ï¼Œæ‰€æœ‰å¤–æ¥æŠ¥æ–‡å°†ä¼šè¢«ä¸¢å¼ƒï¼ŒåŒ…æ‹¬æˆ‘ä»¬sshè¿œç¨‹è¿æ¥ã€‚</p>
<p>å¥½äº†ï¼Œæˆ‘ä»¬é€šè¿‡ä¸Šä¾‹ï¼Œä¸ä»…äº†è§£åˆ°äº†æ€æ ·å¯¹åŒ¹é…æ¡ä»¶å–åï¼Œè¿˜åŠ æ·±äº†æˆ‘ä»¬å¯¹é»˜è®¤ç­–ç•¥çš„äº†è§£ï¼Œä¸€ä¸¾ä¸¤å¾—ï¼Œæˆ‘ä»¬ç»§ç»­èŠã€‚</p>
<h3 id="åŒ¹é…æ¡ä»¶ï¼šç›®æ ‡IPåœ°å€"><a href="#åŒ¹é…æ¡ä»¶ï¼šç›®æ ‡IPåœ°å€" class="headerlink" title="åŒ¹é…æ¡ä»¶ï¼šç›®æ ‡IPåœ°å€"></a>åŒ¹é…æ¡ä»¶ï¼šç›®æ ‡IPåœ°å€</h3><p>é™¤äº†å¯ä»¥é€šè¿‡-sé€‰é¡¹æŒ‡å®šæºåœ°å€ä½œä¸ºåŒ¹é…æ¡ä»¶ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨-dé€‰é¡¹æŒ‡å®šâ€ç›®æ ‡åœ°å€â€ä½œä¸ºåŒ¹é…æ¡ä»¶ã€‚</p>
<p>æºåœ°å€è¡¨ç¤ºæŠ¥æ–‡ä»å“ªé‡Œæ¥ï¼Œç›®æ ‡åœ°å€è¡¨ç¤ºæŠ¥æ–‡è¦åˆ°å“ªé‡Œå»ã€‚</p>
<p>é™¤äº†127.0.0.1å›ç¯åœ°å€ä»¥å¤–ï¼Œå½“å‰æœºå™¨æœ‰ä¸¤ä¸ªIPåœ°å€ï¼ŒIPå¦‚ä¸‹ã€‚<br><img src="/2022/06/13/uncatalog/cl4cifap5000zpwr721cugaqx/5.png" alt="image"></p>
<p>å‡è®¾ï¼Œæˆ‘ä»¬æƒ³è¦æ‹’ç»146ä¸»æœºå‘æ¥çš„æŠ¥æ–‡ï¼Œä½†æ˜¯æˆ‘ä»¬åªæƒ³æ‹’ç»146å‘156è¿™ä¸ªIPå‘é€æŠ¥æ–‡ï¼Œå¹¶ä¸æƒ³è¦é˜²æ­¢146å‘101è¿™ä¸ªIPå‘é€æŠ¥æ–‡ï¼Œæˆ‘ä»¬å°±å¯ä»¥æŒ‡å®šç›®æ ‡åœ°å€ä½œä¸ºåŒ¹é…æ¡ä»¶ï¼Œç¤ºä¾‹å¦‚ä¸‹ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifap5000zpwr721cugaqx/6.png" alt="image"></p>
<p>ä¸Šä¾‹è¡¨ç¤ºåªä¸¢å¼ƒä»146å‘å¾€156è¿™ä¸ªIPçš„æŠ¥æ–‡ï¼Œä½†æ˜¯146å‘å¾€101è¿™ä¸ªIPçš„æŠ¥æ–‡å¹¶ä¸ä¼šè¢«ä¸¢å¼ƒï¼Œå¦‚æœæˆ‘ä»¬ä¸æŒ‡å®šä»»ä½•ç›®æ ‡åœ°å€ï¼Œåˆ™ç›®æ ‡åœ°å€é»˜è®¤ä¸º0.0.0.0/0ï¼ŒåŒç†ï¼Œå¦‚æœæˆ‘ä»¬ä¸æŒ‡å®šæºåœ°å€ï¼Œæºåœ°å€é»˜è®¤ä¸º0.0.0.0/0ï¼Œ0.0.0.0/0è¡¨ç¤ºæ‰€æœ‰IPï¼Œç¤ºä¾‹å¦‚ä¸‹ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifap5000zpwr721cugaqx/7.png" alt="image"></p>
<p>ä¸Šä¾‹è¡¨ç¤ºï¼Œæ‰€æœ‰IPå‘é€å¾€101çš„æŠ¥æ–‡éƒ½å°†è¢«ä¸¢å¼ƒã€‚</p>
<p>ä¸-sé€‰é¡¹ä¸€æ ·ï¼Œ-dé€‰é¡¹ä¹Ÿå¯ä»¥ä½¿ç”¨â€å¹å·â€è¿›è¡Œå–åï¼Œä¹Ÿèƒ½å¤ŸåŒæ—¶æŒ‡å®šå¤šä¸ªIPåœ°å€ï¼Œä½¿ç”¨â€é€—å·â€éš”å¼€å³å¯ã€‚</p>
<p>ä½†æ˜¯è¯·æ³¨æ„ï¼Œä¸ç®¡æ˜¯-sé€‰é¡¹è¿˜æ˜¯-dé€‰é¡¹ï¼Œå–åæ“ä½œä¸åŒæ—¶æŒ‡å®šå¤šä¸ªIPçš„æ“ä½œä¸èƒ½åŒæ—¶ä½¿ç”¨ã€‚</p>
<p>éœ€è¦æ˜ç¡®çš„ä¸€ç‚¹å°±æ˜¯ï¼šå½“ä¸€æ¡è§„åˆ™ä¸­æœ‰å¤šä¸ªåŒ¹é…æ¡ä»¶æ—¶ï¼Œè¿™å¤šä¸ªåŒ¹é…æ¡ä»¶ä¹‹é—´ï¼Œé»˜è®¤å­˜åœ¨â€ä¸â€çš„å…³ç³»ã€‚</p>
<p>è¯´ç™½äº†å°±æ˜¯ï¼Œå½“ä¸€æ¡è§„åˆ™ä¸­å­˜åœ¨å¤šä¸ªåŒ¹é…æ¡ä»¶æ—¶ï¼ŒæŠ¥æ–‡å¿…é¡»åŒæ—¶æ»¡è¶³è¿™äº›æ¡ä»¶ï¼Œæ‰ç®—åšè¢«è§„åˆ™åŒ¹é…ã€‚</p>
<p>å°±å¦‚ä¸‹ä¾‹æ‰€ç¤ºï¼Œä¸‹å›¾ä¸­çš„è§„åˆ™åŒ…å«æœ‰ä¸¤ä¸ªåŒ¹é…æ¡ä»¶ï¼Œæºåœ°å€ä¸ç›®æ ‡åœ°å€ï¼ŒæŠ¥æ–‡å¿…é¡»åŒæ—¶èƒ½è¢«è¿™ä¸¤ä¸ªæ¡ä»¶åŒ¹é…ï¼Œæ‰ç®—ä½œè¢«å½“å‰è§„åˆ™åŒ¹é…ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸‹ä¾‹ä¸­ï¼ŒæŠ¥æ–‡å¿…é¡»æ¥è‡ª146ï¼ŒåŒæ—¶æŠ¥æ–‡çš„ç›®æ ‡åœ°å€å¿…é¡»ä¸º101ï¼Œæ‰ä¼šè¢«å¦‚ä¸‹è§„åˆ™åŒ¹é…ï¼Œä¸¤ä¸ªæ¡ä»¶å¿…é¡»åŒæ—¶æ»¡è¶³ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifap5000zpwr721cugaqx/8.png" alt="image"></p>
<p>æˆ‘ä»¬é™¤äº†èƒ½å¤Ÿä½¿ç”¨-sé€‰é¡¹å’Œ-dé€‰é¡¹åŒ¹é…æºIPä¸ç›®æ ‡IPä»¥å¤–ï¼Œè¿˜èƒ½å¤ŸåŒ¹é…â€æºç«¯å£â€ä¸â€ç›®æ ‡ç«¯å£â€ï¼Œä½†æ˜¯æˆ‘ä»¬ä¸€ä¼šå„¿å†èŠæ€æ ·åŒ¹é…ç«¯å£ï¼Œæˆ‘ä»¬å…ˆèŠèŠå…¶ä»–é€‰é¡¹ã€‚</p>
<h3 id="åŒ¹é…æ¡ä»¶ï¼šåè®®ç±»å‹"><a href="#åŒ¹é…æ¡ä»¶ï¼šåè®®ç±»å‹" class="headerlink" title="åŒ¹é…æ¡ä»¶ï¼šåè®®ç±»å‹"></a>åŒ¹é…æ¡ä»¶ï¼šåè®®ç±»å‹</h3><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨-pé€‰é¡¹ï¼ŒæŒ‡å®šéœ€è¦åŒ¹é…çš„æŠ¥æ–‡çš„åè®®ç±»å‹ã€‚</p>
<p>å‡è®¾ï¼Œæˆ‘ä»¬åªæƒ³è¦æ‹’ç»æ¥è‡ª146çš„tcpç±»å‹çš„è¯·æ±‚ï¼Œé‚£ä¹ˆå¯ä»¥è¿›è¡Œå¦‚ä¸‹è®¾ç½®</p>
<p><img src="/2022/06/13/uncatalog/cl4cifap5000zpwr721cugaqx/9.png" alt="image"></p>
<p>ä¸Šå›¾ä¸­ï¼Œé˜²ç«å¢™æ‹’ç»äº†æ¥è‡ª146çš„tcpæŠ¥æ–‡å‘å¾€156è¿™ä¸ªIPï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¥æµ‹è¯•ä¸€ä¸‹ï¼Œæˆ‘ä»¬åœ¨146ä¸Šä½¿ç”¨sshè¿æ¥101è¿™ä¸ªIPè¯•è¯•ï¼ˆsshåè®®çš„ä¼ è¾“å±‚åè®®å±äºtcpåè®®ç±»å‹ï¼‰</p>
<p><img src="/2022/06/13/uncatalog/cl4cifap5000zpwr721cugaqx/10.png" alt="image"></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œsshè¿æ¥è¢«æ‹’ç»äº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä½¿ç”¨pingå‘½ä»¤è¯•è¯• (pingå‘½ä»¤ä½¿ç”¨icmpåè®®)ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½pingé€š156ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifap5000zpwr721cugaqx/11.png" alt="image"></p>
<p>å¯ä»¥çœ‹åˆ°ï¼ŒPINGå‘½ä»¤å¯ä»¥pingé€š156ï¼Œè¯æ˜icmpåè®®å¹¶æ²¡æœ‰è¢«è§„åˆ™åŒ¹é…åˆ°ï¼Œåªæœ‰tcpç±»å‹çš„æŠ¥æ–‡è¢«åŒ¹é…åˆ°äº†ã€‚</p>
<p>é‚£ä¹ˆï¼Œ-pé€‰é¡¹éƒ½æ”¯æŒåŒ¹é…å“ªäº›åè®®å‘¢ï¼Ÿæˆ‘ä»¬æ€»ç»“ä¸€ä¸‹</p>
<p>centos6ä¸­ï¼Œ-pé€‰é¡¹æ”¯æŒå¦‚ä¸‹åè®®ç±»å‹</p>
<p>tcp, udp, udplite, icmp, esp, ah, sctp</p>
<p>centos7ä¸­ï¼Œ-pé€‰é¡¹æ”¯æŒå¦‚ä¸‹åè®®ç±»å‹</p>
<p>tcp, udp, udplite, icmp, icmpv6,esp, ah, sctp, mh</p>
<p>å½“ä¸ä½¿ç”¨-pæŒ‡å®šåè®®ç±»å‹æ—¶ï¼Œé»˜è®¤è¡¨ç¤ºæ‰€æœ‰ç±»å‹çš„åè®®éƒ½ä¼šè¢«åŒ¹é…åˆ°ï¼Œä¸ä½¿ç”¨-p allçš„æ•ˆæœç›¸åŒã€‚</p>
<h3 id="åŒ¹é…æ¡ä»¶ï¼šç½‘å¡æ¥å£"><a href="#åŒ¹é…æ¡ä»¶ï¼šç½‘å¡æ¥å£" class="headerlink" title="åŒ¹é…æ¡ä»¶ï¼šç½‘å¡æ¥å£"></a>åŒ¹é…æ¡ä»¶ï¼šç½‘å¡æ¥å£</h3><p>æˆ‘ä»¬å†æ¥è®¤è¯†ä¸€ä¸ªæ–°çš„åŒ¹é…æ¡ä»¶ï¼Œå½“æœ¬æœºæœ‰å¤šä¸ªç½‘å¡æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ -i é€‰é¡¹å»åŒ¹é…æŠ¥æ–‡æ˜¯é€šè¿‡å“ªå—ç½‘å¡æµå…¥æœ¬æœºçš„ã€‚</p>
<p>æˆ‘ä»¬å…ˆåŠ¨æ‰‹åšä¸ªå°ä¾‹å­ï¼Œå¯¹-ié€‰é¡¹æœ‰ä¸€ä¸ªåˆæ­¥çš„äº†è§£ä»¥åï¼Œå†ç»“åˆç†è®ºå»çœ‹ã€‚</p>
<p>å½“å‰ä¸»æœºçš„ç½‘å¡åç§°ä¸ºeth4ï¼Œå¦‚ä¸‹å›¾</p>
<p><img src="/2022/06/13/uncatalog/cl4cifap5000zpwr721cugaqx/12.png" alt="image"></p>
<p>å‡è®¾æƒ³è¦æ‹’ç»ç”±ç½‘å¡eth4æµå…¥çš„pingè¯·æ±‚æŠ¥æ–‡ï¼Œåˆ™å¯ä»¥è¿›è¡Œå¦‚ä¸‹è®¾ç½®ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifap5000zpwr721cugaqx/13.png" alt="image"></p>
<p>ä¸Šå›¾ä¸­ï¼Œä½¿ç”¨-ié€‰é¡¹ï¼ŒæŒ‡å®šç½‘å¡åç§°ï¼Œä½¿ç”¨-pé€‰é¡¹ï¼ŒæŒ‡å®šäº†éœ€è¦åŒ¹é…çš„æŠ¥æ–‡åè®®ç±»å‹ï¼Œä¸Šä¾‹è¡¨ç¤ºä¸¢å¼ƒç”±eth4ç½‘å¡æµå…¥çš„icmpç±»å‹çš„æŠ¥æ–‡ã€‚</p>
<p>æ˜¯ä¸æ˜¯å¾ˆå®¹æ˜“ç†è§£ï¼Œä½†æ˜¯ï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘ä¸€ä¸ªé—®é¢˜ï¼Œ-ié€‰é¡¹æ˜¯ç”¨äºåŒ¹é…æŠ¥æ–‡æµå…¥çš„ç½‘å¡çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä»æœ¬æœºå‘å‡ºçš„æŠ¥æ–‡æ˜¯ä¸å¯èƒ½ä¼šä½¿ç”¨åˆ°-ié€‰é¡¹çš„ï¼Œå› ä¸ºè¿™äº›ç”±æœ¬æœºå‘å‡ºçš„æŠ¥æ–‡å‹æ ¹ä¸æ˜¯ä»ç½‘å¡æµå…¥çš„ï¼Œè€Œæ˜¯è¦é€šè¿‡ç½‘å¡å‘å‡ºçš„ï¼Œä»è¿™ä¸ªè§’åº¦è€ƒè™‘ï¼Œ-ié€‰é¡¹çš„ä½¿ç”¨æ˜¯æœ‰é™åˆ¶çš„ã€‚</p>
<p>ä¸ºäº†æ›´å¥½çš„è§£é‡Š-ié€‰é¡¹ï¼Œæˆ‘ä»¬å›é¡¾ä¸€ä¸‹åœ¨ç†è®ºæ€»ç»“ä¸­çš„ä¸€å¼ iptableså…¨å±€æŠ¥æ–‡æµå‘å›¾ï¼Œå¦‚ä¸‹ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifap5000zpwr721cugaqx/14.png" alt="image"></p>
<p>æ—¢ç„¶-ié€‰é¡¹æ˜¯ç”¨äºåˆ¤æ–­æŠ¥æ–‡æ˜¯ä»å“ªä¸ªç½‘å¡æµå…¥çš„ï¼Œé‚£ä¹ˆï¼Œ-ié€‰é¡¹åªèƒ½ç”¨äºä¸Šå›¾ä¸­çš„PREROUTINGé“¾ã€INPUTé“¾ã€FORWARDé“¾ï¼Œè¿™æ˜¯-ié€‰é¡¹çš„ç‰¹æ®Šæ€§ï¼Œå› ä¸ºå®ƒåªæ˜¯ç”¨äºåˆ¤æ–­æŠ¥æ–‡æ˜¯ä»å“ªä¸ªç½‘å¡æµå…¥çš„ï¼Œæ‰€ä»¥åªèƒ½åœ¨ä¸Šå›¾ä¸­â€æ•°æ®æµå…¥æµå‘â€çš„é“¾ä¸­ä¸FORWARDé“¾ä¸­å­˜åœ¨ï¼Œè€Œä¸Šå›¾ä¸­çš„â€æ•°æ®å‘å‡ºæµå‘â€ç»è¿‡çš„é“¾ä¸­ï¼Œæ˜¯ä¸å¯èƒ½ä½¿ç”¨-ié€‰é¡¹çš„ï¼Œæ¯”å¦‚ä¸Šå›¾ä¸­çš„OUTPUTé“¾ä¸POSTROUTINGé“¾ï¼Œä»–ä»¬éƒ½ä¸èƒ½ä½¿ç”¨-ié€‰é¡¹ã€‚</p>
<p>ç†è§£å®Œ-ié€‰é¡¹ï¼Œå†æ¥ç†è§£-oé€‰é¡¹å°±å¥½åŠäº†ã€‚</p>
<p>å½“ä¸»æœºæœ‰å¤šå—ç½‘å¡æ—¶ï¼Œå¯ä»¥ä½¿ç”¨-oé€‰é¡¹ï¼ŒåŒ¹é…æŠ¥æ–‡å°†ç”±å“ªå—ç½‘å¡æµå‡ºï¼Œæ²¡é”™ï¼Œ-oé€‰é¡¹ä¸-ié€‰é¡¹æ˜¯ç›¸å¯¹çš„ï¼Œ-ié€‰é¡¹ç”¨äºåŒ¹é…æŠ¥æ–‡ä»å“ªä¸ªç½‘å¡æµå…¥ï¼Œ-oé€‰é¡¹ç”¨äºåŒ¹é…æŠ¥æ–‡å°†ä»å“ªä¸ªç½‘å¡æµå‡ºã€‚</p>
<p>èªæ˜å¦‚ä½ ï¼Œä¸€å®šæƒ³åˆ°äº†ï¼Œ-ié€‰é¡¹åªèƒ½ç”¨äºPREROUTINGé“¾ã€INPUTé“¾ã€FORWARDé“¾ï¼Œé‚£ä¹ˆ-oé€‰é¡¹åªèƒ½ç”¨äºFORWARDé“¾ã€OUTPUTé“¾ã€POSTROUTINGé“¾ã€‚</p>
<p>å› ä¸º-oé€‰é¡¹æ˜¯ç”¨äºåŒ¹é…æŠ¥æ–‡å°†ç”±å“ªä¸ªç½‘å¡â€æµå‡ºâ€çš„ï¼Œæ‰€ä»¥ä¸ä¸Šå›¾ä¸­çš„â€æ•°æ®è¿›å…¥æµå‘â€ä¸­çš„é“¾æ²¡æœ‰ä»»ä½•ç¼˜åˆ†ï¼Œæ‰€ä»¥ï¼Œ-oé€‰é¡¹åªèƒ½ç”¨äºFORWARDé“¾ã€OUTPUTé“¾ã€POSTROUTINGé“¾ä¸­ã€‚</p>
<p>çœ‹æ¥ï¼ŒFORWARDé“¾å±äºâ€ä¸­ç«‹å›½â€ï¼Œå®ƒèƒ½åŒæ—¶ä½¿ç”¨-ié€‰é¡¹ä¸-oé€‰é¡¹ã€‚</p>
<h3 id="æ‰©å±•åŒ¹é…æ¡ä»¶"><a href="#æ‰©å±•åŒ¹é…æ¡ä»¶" class="headerlink" title="æ‰©å±•åŒ¹é…æ¡ä»¶"></a>æ‰©å±•åŒ¹é…æ¡ä»¶</h3><p>å¥½äº†ï¼Œç°åœ¨ï¼Œæˆ‘ä»¬å°±è¦èŠèŠï¼Œæ€æ ·åŒ¹é…æŠ¥æ–‡çš„â€æºç«¯å£â€ä¸â€ç›®æ ‡ç«¯å£â€ã€‚</p>
<p>åœ¨ä¸Šæ–‡ä¸­ï¼Œæˆ‘ä»¬æ€»ç»“äº†â€æºåœ°å€â€ä¸â€ç›®æ ‡åœ°å€â€ä»¥åï¼Œå°±é¡ºä¾¿æåˆ°äº†â€æºç«¯å£â€ä¸â€ç›®æ ‡ç«¯å£â€ï¼Œä½†æ˜¯ï¼Œä¸ºä»€ä¹ˆåˆšæ‰ä¸ä»‹ç»â€æºç«¯å£â€ä¸â€ç›®æ ‡ç«¯å£â€ï¼Œéè¦ç°åœ¨ä»‹ç»å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºâ€æºç«¯å£â€ä¸â€ç›®æ ‡ç«¯å£â€å±äºæ‰©å±•åŒ¹é…æ¡ä»¶ï¼Œâ€æºåœ°å€â€ä¸â€ç›®æ ‡åœ°å€â€å±äºåŸºæœ¬åŒ¹é…æ¡ä»¶ï¼Œä¸Šæ–‡ä¸­ä»‹ç»åˆ°çš„åŒ¹é…æ¡ä»¶ï¼Œéƒ½å±äºåŸºæœ¬åŒ¹é…æ¡ä»¶ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å•ç‹¬æŠŠâ€æºç«¯å£â€ä¸â€ç›®æ ‡ç«¯å£â€ï¼Œæ”¾åœ¨åé¢æ€»ç»“ï¼Œæ˜¯ä¸ºäº†å¼•å‡ºæ‰©å±•åŒ¹é…æ¡ä»¶çš„æ¦‚å¿µã€‚</p>
<p>é‚£ä¹ˆï¼Œå…ˆæ¥äº†è§£ä¸€ä¸‹ï¼Œä»€ä¹ˆæ˜¯æ‰©å±•åŒ¹é…æ¡ä»¶ã€‚</p>
<p>ä¸æ˜¯åŸºæœ¬åŒ¹é…æ¡ä»¶çš„å°±æ˜¯æ‰©å±•åŒ¹é…æ¡ä»¶ï¼Œè¿™æ ·è¯´å¥½åƒæ˜¯å¥åºŸè¯ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·ç†è§£ï¼ŒåŸºæœ¬åŒ¹é…æ¡ä»¶æˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œè€Œå¦‚æœæƒ³è¦ä½¿ç”¨æ‰©å±•åŒ¹é…æ¡ä»¶ï¼Œåˆ™éœ€è¦ä¾èµ–ä¸€äº›æ‰©å±•æ¨¡å—ï¼Œæˆ–è€…è¯´ï¼Œåœ¨ä½¿ç”¨æ‰©å±•åŒ¹é…æ¡ä»¶ä¹‹å‰ï¼Œéœ€è¦æŒ‡å®šç›¸åº”çš„æ‰©å±•æ¨¡å—æ‰è¡Œï¼Œè¿™æ ·è¯´ä¸å®¹æ˜“æ˜ç™½ï¼Œæˆ‘ä»¬åšä¸ªä¾‹å­ï¼Œå°±èƒ½å¤Ÿæ˜ç™½ã€‚</p>
<p>æˆ‘ä»¬çŸ¥é“ï¼ŒsshdæœåŠ¡çš„é»˜è®¤ç«¯å£ä¸º22ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨sshå·¥å…·è¿œç¨‹è¿æ¥ä¸»æœºæ—¶ï¼Œé»˜è®¤ä¼šè¿æ¥æœåŠ¡ç«¯çš„22å·ç«¯å£ï¼Œå‡è®¾ï¼Œæˆ‘ä»¬ç°åœ¨æƒ³è¦ä½¿ç”¨iptablesè®¾ç½®ä¸€æ¡è§„åˆ™ï¼Œæ‹’ç»æ¥è‡ª192.168.1.146çš„sshè¯·æ±‚ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ‹’ç»146ä¸Šçš„æŠ¥æ–‡èƒ½å¤Ÿå‘å¾€æœ¬æœºçš„22å·ç«¯å£ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œå°±éœ€è¦ç”¨åˆ°â€ç›®æ ‡ç«¯å£â€é€‰é¡¹ã€‚</p>
<p>ä½¿ç”¨é€‰é¡¹â€“dportå¯ä»¥åŒ¹é…æŠ¥æ–‡çš„ç›®æ ‡ç«¯å£ï¼Œâ€“dportæ„ä¸ºdestination-portï¼Œå³è¡¨ç¤ºç›®æ ‡ç«¯å£ã€‚</p>
<p>æ³¨æ„ï¼Œä¸ä¹‹å‰çš„é€‰é¡¹ä¸åŒï¼Œâ€“dportå‰æœ‰ä¸¤æ¡â€æ¨ªæ â€ï¼Œè€Œä¸”ï¼Œä½¿ç”¨â€“dporté€‰é¡¹æ—¶ï¼Œå¿…é¡»äº‹å…ˆæŒ‡å®šäº†ä½¿ç”¨å“ªç§åè®®ï¼Œå³å¿…é¡»å…ˆä½¿ç”¨-pé€‰é¡¹ï¼Œç¤ºä¾‹å¦‚ä¸‹</p>
<p><img src="/2022/06/13/uncatalog/cl4cifap5000zpwr721cugaqx/15.png" alt="image"></p>
<p>ä¸Šå›¾ä¸­ï¼Œæˆ‘ä»¬å°±ä½¿ç”¨äº†æ‰©å±•åŒ¹é…æ¡ä»¶â€“dportï¼ŒæŒ‡å®šäº†åŒ¹é…æŠ¥æ–‡çš„ç›®æ ‡ç«¯å£ï¼Œå¦‚æœå¤–æ¥æŠ¥æ–‡çš„ç›®æ ‡ç«¯å£ä¸ºæœ¬æœºçš„22å·ç«¯å£ï¼ˆsshé»˜è®¤ç«¯å£ï¼‰ï¼Œåˆ™æ‹’ç»ä¹‹ï¼Œè€Œåœ¨ä½¿ç”¨â€“dportä¹‹å‰ï¼Œæˆ‘ä»¬ä½¿ç”¨-mé€‰é¡¹ï¼ŒæŒ‡å®šäº†å¯¹åº”çš„æ‰©å±•æ¨¡å—ä¸ºtcpï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæƒ³è¦ä½¿ç”¨â€“dportè¿™ä¸ªæ‰©å±•åŒ¹é…æ¡ä»¶ï¼Œåˆ™å¿…é¡»ä¾é æŸä¸ªæ‰©å±•æ¨¡å—å®Œæˆï¼Œä¸Šä¾‹ä¸­ï¼Œè¿™ä¸ªæ‰©å±•æ¨¡å—å°±æ˜¯tcpæ‰©å±•æ¨¡å—ï¼Œæœ€ç»ˆï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯tcpæ‰©å±•æ¨¡å—ä¸­çš„dportæ‰©å±•åŒ¹é…æ¡ä»¶ã€‚</p>
<p>ç°åœ¨ï¼Œæˆ‘ä»¬å†å›è¿‡å¤´æ¥çœ‹çœ‹æ‰©å±•åŒ¹é…æ¡ä»¶çš„æ¦‚å¿µï¼Œå°±æ›´åŠ æ˜ç™½äº†ã€‚</p>
<p>æ‰©å±•åŒ¹é…æ¡ä»¶è¢«ä½¿ç”¨æ—¶ï¼Œåˆ™éœ€è¦ä¾èµ–ä¸€äº›æ‰©å±•æ¨¡å—ï¼Œæˆ–è€…è¯´ï¼Œåœ¨ä½¿ç”¨æ‰©å±•åŒ¹é…æ¡ä»¶ä¹‹å‰ï¼Œéœ€è¦æŒ‡å®šç›¸åº”çš„æ‰©å±•æ¨¡å—æ‰è¡Œã€‚</p>
<p>ç°åœ¨ä½ æ˜ç™½äº†å—ï¼Ÿ -m tcpè¡¨ç¤ºä½¿ç”¨tcpæ‰©å±•æ¨¡å—ï¼Œâ€“dportè¡¨ç¤ºtcpæ‰©å±•æ¨¡å—ä¸­çš„ä¸€ä¸ªæ‰©å±•åŒ¹é…æ¡ä»¶ï¼Œå¯ç”¨äºåŒ¹é…æŠ¥æ–‡çš„ç›®æ ‡ç«¯å£ã€‚</p>
<p>æ³¨æ„ï¼Œ-p tcpä¸ -m tcpå¹¶ä¸å†²çªï¼Œ-pç”¨äºåŒ¹é…æŠ¥æ–‡çš„åè®®ï¼Œ-m ç”¨äºæŒ‡å®šæ‰©å±•æ¨¡å—çš„åç§°ï¼Œæ­£å¥½ï¼Œè¿™ä¸ªæ‰©å±•æ¨¡å—ä¹Ÿå«tcpã€‚</p>
<p>å…¶å®ï¼Œä¸Šä¾‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœç•¥-mé€‰é¡¹ï¼Œç¤ºä¾‹å¦‚ä¸‹ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifap5000zpwr721cugaqx/16.png" alt="image"></p>
<p>å½“ä½¿ç”¨-pé€‰é¡¹æŒ‡å®šäº†æŠ¥æ–‡çš„åè®®æ—¶ï¼Œå¦‚æœåœ¨æ²¡æœ‰ä½¿ç”¨-mæŒ‡å®šå¯¹åº”çš„æ‰©å±•æ¨¡å—åç§°çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨äº†æ‰©å±•åŒ¹é…æ¡ä»¶ï¼Œ  iptablesé»˜è®¤ä¼šè°ƒç”¨ä¸-pé€‰é¡¹å¯¹åº”çš„åè®®åç§°ç›¸åŒçš„æ¨¡å—ã€‚</p>
<p>ä¸Šä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨-pé€‰é¡¹æŒ‡å®šäº†åè®®åç§°ï¼Œä½¿ç”¨æ‰©å±•åŒ¹é…æ¡ä»¶â€“dportæŒ‡å®šäº†ç›®æ ‡ç«¯å£ï¼Œåœ¨ä½¿ç”¨æ‰©å±•åŒ¹é…æ¡ä»¶çš„æ—¶å€™ï¼Œå¦‚æœæ²¡æœ‰ä½¿ç”¨-mæŒ‡å®šä½¿ç”¨å“ªä¸ªæ‰©å±•æ¨¡å—ï¼Œiptablesä¼šé»˜è®¤ä½¿ç”¨â€-m åè®®åâ€ï¼Œè€Œåè®®åå°±æ˜¯-pé€‰é¡¹å¯¹åº”çš„åè®®åï¼Œä¸Šä¾‹ä¸­ï¼Œ-p å¯¹åº”çš„å€¼ä¸ºtcpï¼Œæ‰€ä»¥é»˜è®¤è°ƒç”¨çš„æ‰©å±•æ¨¡å—å°±ä¸º-m tcpï¼Œå¦‚æœ-på¯¹åº”çš„å€¼ä¸ºudpï¼Œé‚£ä¹ˆé»˜è®¤è°ƒç”¨çš„æ‰©å±•æ¨¡å—å°±ä¸º-m udpã€‚</p>
<p>æ‰€ä»¥ï¼Œä¸Šä¾‹ä¸­ï¼Œå…¶å®â€éšå¼â€çš„æŒ‡å®šäº†æ‰©å±•æ¨¡å—ï¼Œåªæ˜¯æ²¡æœ‰è¡¨ç°å‡ºæ¥ç½¢äº†ã€‚</p>
<p>æ‰€ä»¥ï¼Œåœ¨ä½¿ç”¨æ‰©å±•åŒ¹é…æ¡ä»¶æ—¶ï¼Œä¸€å®šè¦æ³¨æ„ï¼Œå¦‚æœè¿™ä¸ªæ‰©å±•åŒ¹é…æ¡ä»¶æ‰€ä¾èµ–çš„æ‰©å±•æ¨¡å—åæ­£å¥½ä¸-på¯¹åº”çš„åè®®åç§°ç›¸åŒï¼Œé‚£ä¹ˆåˆ™å¯çœç•¥-mé€‰é¡¹ï¼Œå¦åˆ™åˆ™ä¸èƒ½çœç•¥-mé€‰é¡¹ï¼Œå¿…é¡»ä½¿ç”¨-mé€‰é¡¹æŒ‡å®šå¯¹åº”çš„æ‰©å±•æ¨¡å—åç§°ï¼Œè¿™æ ·è¯´å¯èƒ½è¿˜æ˜¯ä¸æ˜¯ç‰¹åˆ«æ˜äº†ï¼Œåœ¨åç»­çš„ä¸¾ä¾‹ä¸­ï¼Œæˆ‘ä»¬ä¼šæ›´åŠ æ˜äº†çš„ç†è§£è¿™äº›æ¦‚å¿µã€‚</p>
<p>æœ‰â€ç›®æ ‡ç«¯å£â€ï¼Œå°±æœ‰â€æºç«¯å£â€ï¼Œä»£è¡¨â€æºç«¯å£â€çš„æ‰©å±•åŒ¹é…æ¡ä»¶ä¸ºâ€“sport</p>
<p>ä½¿ç”¨â€“sportå¯ä»¥åˆ¤æ–­æŠ¥æ–‡æ˜¯å¦ä»æŒ‡å®šçš„ç«¯å£å‘å‡ºï¼Œå³åŒ¹é…æŠ¥æ–‡çš„æºç«¯å£æ˜¯å¦ä¸æŒ‡å®šçš„ç«¯å£ä¸€è‡´ï¼Œâ€“sportè¡¨ç¤ºsource-portï¼Œå³è¡¨ç¤ºæºç«¯å£ä¹‹æ„ã€‚</p>
<p>å› ä¸ºæˆ‘ä»¬å·²ç»ææ˜ç™½äº†dportï¼Œé‚£ä¹ˆsportæˆ‘å°±ä¸å†èµ˜è¿°äº†ï¼Œç¤ºä¾‹å¦‚ä¸‹</p>
<p><img src="/2022/06/13/uncatalog/cl4cifap5000zpwr721cugaqx/17.png" alt="image"></p>
<p>ä¸Šä¾‹ä¸­ï¼Œéšå«äº†â€-m tcpâ€ä¹‹æ„ï¼Œè¡¨ç¤ºä½¿ç”¨äº†tcpæ‰©å±•æ¨¡å—çš„â€“sportæ‰©å±•åŒ¹é…æ¡ä»¶ã€‚</p>
<p>æ‰©å±•åŒ¹é…æ¡ä»¶æ˜¯å¯ä»¥å–åçš„ï¼ŒåŒæ ·æ˜¯ä½¿ç”¨â€!â€è¿›è¡Œå–åï¼Œæ¯”å¦‚ â€œ! â€“dport 22â€³ï¼Œè¡¨ç¤ºç›®æ ‡ç«¯å£ä¸æ˜¯22çš„æŠ¥æ–‡å°†ä¼šè¢«åŒ¹é…åˆ°ã€‚</p>
<p>ä¸ç®¡æ˜¯â€“sportè¿˜æ˜¯â€“dsportï¼Œéƒ½èƒ½å¤ŸæŒ‡å®šä¸€ä¸ªç«¯å£èŒƒå›´ï¼Œæ¯”å¦‚ï¼Œâ€“dport 22:25è¡¨ç¤ºç›®æ ‡ç«¯å£ä¸º22åˆ°25ä¹‹é—´çš„æ‰€æœ‰ç«¯å£ï¼Œå³22ç«¯å£ã€23ç«¯å£ã€24ç«¯å£ã€25ç«¯å£ï¼Œç¤ºä¾‹å¦‚ä¸‹</p>
<p><img src="/2022/06/13/uncatalog/cl4cifap5000zpwr721cugaqx/18.png" alt="image"></p>
<p>ä¹Ÿå¯ä»¥å†™æˆå¦‚ä¸‹å›¾ä¸­çš„æ¨¡æ ·ï¼Œä¸‹å›¾ä¸­ç¬¬ä¸€æ¡è§„åˆ™è¡¨ç¤ºåŒ¹é…0å·åˆ°22å·ä¹‹é—´çš„æ‰€æœ‰ç«¯å£ï¼Œä¸‹å›¾ä¸­çš„ç¬¬äºŒæ¡è§„åˆ™è¡¨ç¤ºåŒ¹é…80å·ç«¯å£ä»¥åŠå…¶ä»¥åçš„æ‰€æœ‰ç«¯å£ï¼ˆç›´åˆ°65535ï¼‰ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifap5000zpwr721cugaqx/19.png" alt="image"></p>
<p>åˆšæ‰èŠåˆ°çš„ä¸¤ä¸ªæ‰©å±•åŒ¹é…æ¡ä»¶éƒ½æ˜¯tcpæ‰©å±•æ¨¡å—çš„ï¼Œå…¶å®ï¼Œtcpæ‰©å±•æ¨¡å—è¿˜æœ‰ä¸€ä¸ªæ¯”è¾ƒæœ‰ç”¨çš„æ‰©å±•åŒ¹é…æ¡ä»¶å«åšâ€â€“tcp-flagsâ€ï¼Œä½†æ˜¯ç”±äºç¯‡å¹…åŸå› ï¼Œä»¥åå†å¯¹è¿™ä¸ªæ‰©å±•åŒ¹é…æ¡ä»¶è¿›è¡Œæ€»ç»“ã€‚</p>
<p>å€ŸåŠ©tcpæ‰©å±•æ¨¡å—çš„â€“sportæˆ–è€…â€“dportéƒ½å¯ä»¥æŒ‡å®šä¸€ä¸ªè¿ç»­çš„ç«¯å£èŒƒå›´ï¼Œä½†æ˜¯æ— æ³•åŒæ—¶æŒ‡å®šå¤šä¸ªç¦»æ•£çš„ã€ä¸è¿ç»­çš„ç«¯å£ï¼Œå¦‚æœæƒ³è¦åŒæ—¶æŒ‡å®šå¤šä¸ªç¦»æ•£çš„ç«¯å£ï¼Œéœ€è¦å€ŸåŠ©å¦ä¸€ä¸ªæ‰©å±•æ¨¡å—ï¼Œâ€multiportâ€æ¨¡å—ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨multiportæ¨¡å—çš„â€“sportsæ‰©å±•æ¡ä»¶åŒæ—¶æŒ‡å®šå¤šä¸ªç¦»æ•£çš„æºç«¯å£ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨multiportæ¨¡å—çš„â€“dportsæ‰©å±•æ¡ä»¶åŒæ—¶æŒ‡å®šå¤šä¸ªç¦»æ•£çš„ç›®æ ‡ç«¯å£ã€‚</p>
<p>ç¤ºä¾‹å¦‚ä¸‹</p>
<p><img src="/2022/06/13/uncatalog/cl4cifap5000zpwr721cugaqx/20.png" alt="image"></p>
<p>ä¸Šå›¾ç¤ºä¾‹è¡¨ç¤ºï¼Œç¦æ­¢æ¥è‡ª146çš„ä¸»æœºä¸Šçš„tcpæŠ¥æ–‡è®¿é—®æœ¬æœºçš„22å·ç«¯å£ã€36å·ç«¯å£ä»¥åŠ80å·ç«¯å£ã€‚</p>
<p>ä¸Šå›¾ä¸­ï¼Œâ€-m multiport â€“dports 22,36,80â€³è¡¨ç¤ºä½¿ç”¨äº†multiportæ‰©å±•æ¨¡å—çš„â€“dportsæ‰©å±•æ¡ä»¶ï¼Œä»¥åŒæ—¶æŒ‡å®šäº†å¤šä¸ªç¦»æ•£çš„ç«¯å£ï¼Œæ¯ä¸ªç«¯å£ä¹‹é—´ç”¨é€—å·éš”å¼€ã€‚</p>
<p>ä¸Šå›¾ä¸­çš„-m multiportæ˜¯ä¸èƒ½çœç•¥çš„ï¼Œå¦‚æœä½ çœç•¥äº†-m multiportï¼Œå°±ç›¸å½“äºåœ¨æ²¡æœ‰æŒ‡å®šæ‰©å±•æ¨¡å—çš„æƒ…å†µä¸‹ï¼Œä½¿ç”¨äº†æ‰©å±•æ¡ä»¶ï¼ˆâ€â€“dportsâ€ï¼‰ï¼Œé‚£ä¹ˆä¸Šä¾‹ä¸­ï¼Œiptablesä¼šé»˜è®¤è°ƒç”¨â€-m tcpâ€ï¼Œä½†æ˜¯ï¼Œâ€â€“dportsæ‰©å±•æ¡ä»¶â€å¹¶ä¸å±äºâ€tcpæ‰©å±•æ¨¡å—â€,è€Œæ˜¯å±äºâ€multiportæ‰©å±•æ¨¡å—â€ï¼Œæ‰€ä»¥ï¼Œè¿™æ—¶å°±ä¼šæŠ¥é”™ã€‚</p>
<p>ç»¼ä¸Šæ‰€è¿°ï¼Œå½“ä½¿ç”¨â€“dportsæˆ–è€…â€“sportsè¿™ç§æ‰©å±•åŒ¹é…æ¡ä»¶æ—¶ï¼Œå¿…é¡»ä½¿ç”¨-mæŒ‡å®šæ¨¡å—çš„åç§°ã€‚</p>
<p>å…¶å®ï¼Œä½¿ç”¨multiportæ¨¡å—çš„â€“sportsä¸â€“dporsæ—¶ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šè¿ç»­çš„ç«¯å£èŒƒå›´ï¼Œå¹¶ä¸”èƒ½å¤Ÿåœ¨æŒ‡å®šè¿ç»­çš„ç«¯å£èŒƒå›´çš„åŒæ—¶ï¼ŒæŒ‡å®šç¦»æ•£çš„ç«¯å£å·ï¼Œç¤ºä¾‹å¦‚ä¸‹ã€‚</p>
<p><img src="/2022/06/13/uncatalog/cl4cifap5000zpwr721cugaqx/21.png" alt="image"></p>
<p>ä¸Šä¾‹ä¸­çš„å‘½ä»¤è¡¨ç¤ºæ‹’ç»æ¥è‡ª192.168.1.146çš„tcpæŠ¥æ–‡è®¿é—®å½“å‰ä¸»æœºçš„22å·ç«¯å£ä»¥åŠ80åˆ°88ä¹‹é—´çš„æ‰€æœ‰ç«¯å£å·ï¼Œæ˜¯ä¸æ˜¯å¾ˆæ–¹ä¾¿ï¼Ÿæœ‰æ²¡æœ‰å¾ˆçµæ´»ï¼Ÿ</p>
<p>ä¸è¿‡éœ€è¦æ³¨æ„ï¼Œmultiportæ‰©å±•åªèƒ½ç”¨äºtcpåè®®ä¸udpåè®®ï¼Œå³é…åˆ-p tcpæˆ–è€…-p udpä½¿ç”¨ã€‚</p>
<p>å†å›è¿‡å¤´çœ‹ä¹‹å‰çš„æ¦‚å¿µï¼Œæˆ‘æƒ³ï¼Œä½ åº”è¯¥å°±æ›´åŠ æ˜ç™½äº†ã€‚</p>
<p>ä»Šå¤©ï¼Œæˆ‘ä»¬åªæ˜¯åˆæ­¥çš„è®¤è¯†äº†æ‰©å±•æ¨¡å—ï¼Œä»¥åŠæ‰©å±•åŒ¹é…æ¡ä»¶ï¼Œè¿˜æœ‰ä¸€äº›æ¨¡å—æˆ‘ä»¬å¹¶æ²¡æœ‰æ€»ç»“ï¼Œå¥½é¥­ä¸æ€•æ™šï¼Œåç»­ä¼šæœ‰å¯¹å®ƒä»¬çš„æ€»ç»“ã€‚</p>
<h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬ä¸»è¦æ€»ç»“äº†ä¸€äº›å¸¸ç”¨çš„â€åŸºç¡€åŒ¹é…æ¡ä»¶â€ï¼Œå¹¶ä¸”åˆæ­¥çš„è®¤è¯†äº†ä¸¤ä¸ªâ€æ‰©å±•æ¨¡å—â€ä»¥åŠè¿™ä¸¤ä¸ªæ‰©å±•æ¨¡å—ä¸­ä¸€äº›å¸¸ç”¨çš„æ‰©å±•æ¡ä»¶ï¼Œä¸ºäº†æ–¹ä¾¿ä»¥åå›é¡¾ï¼Œæˆ‘ä»¬å°†å®ƒä»¬æ€»ç»“å¦‚ä¸‹ã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬è¦æ˜ç¡®ä¸€ç‚¹ï¼Œå½“è§„åˆ™ä¸­åŒæ—¶å­˜åœ¨å¤šä¸ªåŒ¹é…æ¡ä»¶æ—¶ï¼Œå¤šä¸ªæ¡ä»¶ä¹‹é—´é»˜è®¤å­˜åœ¨â€ä¸â€çš„å…³ç³»ï¼Œå³æŠ¥æ–‡å¿…é¡»åŒæ—¶æ»¡è¶³æ‰€æœ‰æ¡ä»¶ï¼Œæ‰èƒ½è¢«è§„åˆ™åŒ¹é…ã€‚</p>
<p>åŸºæœ¬åŒ¹é…æ¡ä»¶æ€»ç»“<br>-sç”¨äºåŒ¹é…æŠ¥æ–‡çš„æºåœ°å€,å¯ä»¥åŒæ—¶æŒ‡å®šå¤šä¸ªæºåœ°å€ï¼Œæ¯ä¸ªIPä¹‹é—´ç”¨é€—å·éš”å¼€ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šä¸ºä¸€ä¸ªç½‘æ®µã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">ç¤ºä¾‹å¦‚ä¸‹</span></span><br><span class="line">iptables -t filter -I INPUT -s 192.168.1.111,192.168.1.118 -j DROP</span><br><span class="line">iptables -t filter -I INPUT -s 192.168.1.0/24 -j ACCEPT</span><br><span class="line">iptables -t filter -I INPUT ! -s 192.168.1.0/24 -j ACCEPT</span><br></pre></td></tr></table></figure></div>


<p>-dç”¨äºåŒ¹é…æŠ¥æ–‡çš„ç›®æ ‡åœ°å€,å¯ä»¥åŒæ—¶æŒ‡å®šå¤šä¸ªç›®æ ‡åœ°å€ï¼Œæ¯ä¸ªIPä¹‹é—´ç”¨é€—å·éš”å¼€ï¼Œä¹Ÿå¯ä»¥æŒ‡å®šä¸ºä¸€ä¸ªç½‘æ®µã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">ç¤ºä¾‹å¦‚ä¸‹</span></span><br><span class="line">iptables -t filter -I OUTPUT -d 192.168.1.111,192.168.1.118 -j DROP</span><br><span class="line">iptables -t filter -I INPUT -d 192.168.1.0/24 -j ACCEPT</span><br><span class="line">iptables -t filter -I INPUT ! -d 192.168.1.0/24 -j ACCEPT</span><br></pre></td></tr></table></figure></div>


<p>-pç”¨äºåŒ¹é…æŠ¥æ–‡çš„åè®®ç±»å‹,å¯ä»¥åŒ¹é…çš„åè®®ç±»å‹tcpã€udpã€udpliteã€icmpã€espã€ahã€sctpç­‰ï¼ˆcentos7ä¸­è¿˜æ”¯æŒicmpv6ã€mhï¼‰ã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">ç¤ºä¾‹å¦‚ä¸‹</span></span><br><span class="line">iptables -t filter -I INPUT -p tcp -s 192.168.1.146 -j ACCEPT</span><br><span class="line">iptables -t filter -I INPUT ! -p udp -s 192.168.1.146 -j ACCEPT</span><br></pre></td></tr></table></figure></div>


<p>-iç”¨äºåŒ¹é…æŠ¥æ–‡æ˜¯ä»å“ªä¸ªç½‘å¡æ¥å£æµå…¥æœ¬æœºçš„ï¼Œç”±äºåŒ¹é…æ¡ä»¶åªæ˜¯ç”¨äºåŒ¹é…æŠ¥æ–‡æµå…¥çš„ç½‘å¡ï¼Œæ‰€ä»¥åœ¨OUTPUTé“¾ä¸POSTROUTINGé“¾ä¸­ä¸èƒ½ä½¿ç”¨æ­¤é€‰é¡¹ã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">ç¤ºä¾‹å¦‚ä¸‹</span></span><br><span class="line">iptables -t filter -I INPUT -p icmp -i eth4 -j DROP</span><br><span class="line">iptables -t filter -I INPUT -p icmp ! -i eth4 -j DROP</span><br></pre></td></tr></table></figure></div>


<p>-oç”¨äºåŒ¹é…æŠ¥æ–‡å°†è¦ä»å“ªä¸ªç½‘å¡æ¥å£æµå‡ºæœ¬æœºï¼ŒäºåŒ¹é…æ¡ä»¶åªæ˜¯ç”¨äºåŒ¹é…æŠ¥æ–‡æµå‡ºçš„ç½‘å¡ï¼Œæ‰€ä»¥åœ¨INPUTé“¾ä¸PREROUTINGé“¾ä¸­ä¸èƒ½ä½¿ç”¨æ­¤é€‰é¡¹ã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">ç¤ºä¾‹å¦‚ä¸‹</span></span><br><span class="line">iptables -t filter -I OUTPUT -p icmp -o eth4 -j DROP</span><br><span class="line">iptables -t filter -I OUTPUT -p icmp ! -o eth4 -j DROP</span><br></pre></td></tr></table></figure></div>


<p>æ‰©å±•åŒ¹é…æ¡ä»¶æ€»ç»“<br>æˆ‘ä»¬æ¥æ€»ç»“ä¸€ä¸‹ä»Šå¤©è®¤è¯†çš„ä¸¤ä¸ªæ‰©å±•æ¨¡å—ï¼Œä»¥åŠå…¶ä¸­çš„æ‰©å±•æ¡ä»¶ï¼ˆå¹¶éå…¨éƒ¨ï¼Œåªæ˜¯è¿™ç¯‡æ–‡ç« ä¸­ä»‹ç»è¿‡çš„ï¼‰</p>
<p>tcpæ‰©å±•æ¨¡å—</p>
<p>å¸¸ç”¨çš„æ‰©å±•åŒ¹é…æ¡ä»¶å¦‚ä¸‹ï¼š</p>
<p>-p tcp -m tcp â€“sport ç”¨äºåŒ¹é…tcpåè®®æŠ¥æ–‡çš„æºç«¯å£ï¼Œå¯ä»¥ä½¿ç”¨å†’å·æŒ‡å®šä¸€ä¸ªè¿ç»­çš„ç«¯å£èŒƒå›´</p>
<p>-p tcp -m tcp â€“dport ç”¨äºåŒ¹é…tcpåè®®æŠ¥æ–‡çš„ç›®æ ‡ç«¯å£ï¼Œå¯ä»¥ä½¿ç”¨å†’å·æŒ‡å®šä¸€ä¸ªè¿ç»­çš„ç«¯å£èŒƒå›´</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">ç¤ºä¾‹å¦‚ä¸‹</span></span><br><span class="line">iptables -t filter -I OUTPUT -d 192.168.1.146 -p tcp -m tcp --sport 22 -j REJECT</span><br><span class="line">iptables -t filter -I INPUT -s 192.168.1.146 -p tcp -m tcp --dport 22:25 -j REJECT</span><br><span class="line">iptables -t filter -I INPUT -s 192.168.1.146 -p tcp -m tcp --dport :22 -j REJECT</span><br><span class="line">iptables -t filter -I INPUT -s 192.168.1.146 -p tcp -m tcp --dport 80: -j REJECT</span><br><span class="line">iptables -t filter -I OUTPUT -d 192.168.1.146 -p tcp -m tcp ! --sport 22 -j ACCEPT</span><br></pre></td></tr></table></figure></div>


<p>multiportæ‰©å±•æ¨¡å—</p>
<p>å¸¸ç”¨çš„æ‰©å±•åŒ¹é…æ¡ä»¶å¦‚ä¸‹ï¼š</p>
<p>-p tcp -m multiport â€“sports ç”¨äºåŒ¹é…æŠ¥æ–‡çš„æºç«¯å£ï¼Œå¯ä»¥æŒ‡å®šç¦»æ•£çš„å¤šä¸ªç«¯å£å·,ç«¯å£ä¹‹é—´ç”¨â€é€—å·â€éš”å¼€</p>
<p>-p udp -m multiport â€“dports ç”¨äºåŒ¹é…æŠ¥æ–‡çš„ç›®æ ‡ç«¯å£ï¼Œå¯ä»¥æŒ‡å®šç¦»æ•£çš„å¤šä¸ªç«¯å£å·ï¼Œç«¯å£ä¹‹é—´ç”¨â€é€—å·â€éš”å¼€</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">ç¤ºä¾‹å¦‚ä¸‹</span></span><br><span class="line">iptables -t filter -I OUTPUT -d 192.168.1.146 -p udp -m multiport --sports 137,138 -j REJECT</span><br><span class="line">iptables -t filter -I INPUT -s 192.168.1.146 -p tcp -m multiport --dports 22,80 -j REJECT</span><br><span class="line">iptables -t filter -I INPUT -s 192.168.1.146 -p tcp -m multiport ! --dports 22,80 -j REJECT</span><br><span class="line">iptables -t filter -I INPUT -s 192.168.1.146 -p tcp -m multiport --dports 80:88 -j REJECT</span><br><span class="line">iptables -t filter -I INPUT -s 192.168.1.146 -p tcp -m multiport --dports 22,80:88 -j REJECT</span><br></pre></td></tr></table></figure></div>
]]></content>
      <tags>
        <tag>äº‘åŸç”ŸåŸºç¡€ç³»åˆ—</tag>
        <tag>Kubernetesç½‘ç»œ</tag>
      </tags>
  </entry>
  <entry>
    <title>Kubernetesç½‘ç»œç³»åˆ—ä¹‹(ä¸‰åå››)iptableså°ç»“ä¹‹å¸¸ç”¨å¥—è·¯</title>
    <url>/2022/06/13/uncatalog/cl4cisjv20000f8r79ldw1df5/</url>
    <content><![CDATA[<hr>
<span id="more"></span>

<hr>
<p>ä¸çŸ¥ä¸è§‰ï¼Œå·²ç»æ€»ç»“äº†13ç¯‡IPTABLESæ–‡ç« ï¼Œè¿™äº›æ–‡ç« ä¸­æœ‰ä¸€äº›éœ€è¦æ³¨æ„çš„åœ°æ–¹ã€‚</p>
<p>æ­¤å¤„ï¼Œæˆ‘ä»¬å¯¹å‰æ–‡ä¸­çš„ä¸€äº›æ³¨æ„ç‚¹è¿›è¡Œæ€»ç»“ï¼Œæˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºå¯¹â€å¸¸ç”¨å¥—è·¯â€çš„æ€»ç»“ã€‚</p>
<p>è®°ä½è¿™äº›å¥—è·¯ï¼Œèƒ½è®©æˆ‘ä»¬äº‹åŠåŠŸå€ã€‚</p>
<p>é˜…è¯»è¿™ç¯‡æ–‡ç« ä¹‹å‰ï¼Œè¯·ç¡®å®šä½ å·²ç»é˜…è¯»äº†ä¹‹å‰çš„æ–‡ç« ï¼Œå¦åˆ™ä½ æœ‰å¯èƒ½ä¼šä¸ç†è§£ä¸ºä»€ä¹ˆè¦è¿™æ ·åšã€‚</p>
<h3 id="è§„åˆ™çš„é¡ºåºéå¸¸é‡è¦ã€‚"><a href="#è§„åˆ™çš„é¡ºåºéå¸¸é‡è¦ã€‚" class="headerlink" title="è§„åˆ™çš„é¡ºåºéå¸¸é‡è¦ã€‚"></a>è§„åˆ™çš„é¡ºåºéå¸¸é‡è¦ã€‚</h3><p>å¦‚æœæŠ¥æ–‡å·²ç»è¢«å‰é¢çš„è§„åˆ™åŒ¹é…åˆ°ï¼ŒIPTABLESåˆ™ä¼šå¯¹æŠ¥æ–‡æ‰§è¡Œå¯¹åº”çš„åŠ¨ä½œï¼Œé€šå¸¸æ˜¯ACCEPTæˆ–è€…REJECTï¼ŒæŠ¥æ–‡è¢«æ”¾è¡Œæˆ–æ‹’ç»ä»¥åï¼Œå³ä½¿åé¢çš„è§„åˆ™ä¹Ÿèƒ½åŒ¹é…åˆ°åˆšæ‰æ”¾è¡Œæˆ–æ‹’ç»çš„æŠ¥æ–‡ï¼Œä¹Ÿæ²¡æœ‰æœºä¼šå†å¯¹æŠ¥æ–‡æ‰§è¡Œç›¸åº”çš„åŠ¨ä½œäº†ï¼ˆå‰é¢è§„åˆ™çš„åŠ¨ä½œä¸ºLOGæ—¶é™¤å¤–ï¼‰ï¼Œæ‰€ä»¥ï¼Œé’ˆå¯¹ç›¸åŒæœåŠ¡çš„è§„åˆ™ï¼Œæ›´ä¸¥æ ¼çš„è§„åˆ™åº”è¯¥æ”¾åœ¨å‰é¢ã€‚</p>
<h3 id="å½“è§„åˆ™ä¸­æœ‰å¤šä¸ªåŒ¹é…æ¡ä»¶æ—¶ï¼Œæ¡ä»¶ä¹‹é—´é»˜è®¤å­˜åœ¨â€ä¸â€çš„å…³ç³»ã€‚"><a href="#å½“è§„åˆ™ä¸­æœ‰å¤šä¸ªåŒ¹é…æ¡ä»¶æ—¶ï¼Œæ¡ä»¶ä¹‹é—´é»˜è®¤å­˜åœ¨â€ä¸â€çš„å…³ç³»ã€‚" class="headerlink" title="å½“è§„åˆ™ä¸­æœ‰å¤šä¸ªåŒ¹é…æ¡ä»¶æ—¶ï¼Œæ¡ä»¶ä¹‹é—´é»˜è®¤å­˜åœ¨â€ä¸â€çš„å…³ç³»ã€‚"></a>å½“è§„åˆ™ä¸­æœ‰å¤šä¸ªåŒ¹é…æ¡ä»¶æ—¶ï¼Œæ¡ä»¶ä¹‹é—´é»˜è®¤å­˜åœ¨â€ä¸â€çš„å…³ç³»ã€‚</h3><p>å¦‚æœä¸€æ¡è§„åˆ™ä¸­åŒ…å«äº†å¤šä¸ªåŒ¹é…æ¡ä»¶ï¼Œé‚£ä¹ˆæŠ¥æ–‡å¿…é¡»åŒæ—¶æ»¡è¶³è¿™ä¸ªè§„åˆ™ä¸­çš„æ‰€æœ‰åŒ¹é…æ¡ä»¶ï¼ŒæŠ¥æ–‡æ‰èƒ½è¢«è¿™æ¡è§„åˆ™åŒ¹é…åˆ°ã€‚</p>
<h3 id="åœ¨ä¸è€ƒè™‘1çš„æƒ…å†µä¸‹ï¼Œåº”è¯¥å°†æ›´å®¹æ˜“è¢«åŒ¹é…åˆ°çš„è§„åˆ™æ”¾ç½®åœ¨å‰é¢ã€‚"><a href="#åœ¨ä¸è€ƒè™‘1çš„æƒ…å†µä¸‹ï¼Œåº”è¯¥å°†æ›´å®¹æ˜“è¢«åŒ¹é…åˆ°çš„è§„åˆ™æ”¾ç½®åœ¨å‰é¢ã€‚" class="headerlink" title="åœ¨ä¸è€ƒè™‘1çš„æƒ…å†µä¸‹ï¼Œåº”è¯¥å°†æ›´å®¹æ˜“è¢«åŒ¹é…åˆ°çš„è§„åˆ™æ”¾ç½®åœ¨å‰é¢ã€‚"></a>åœ¨ä¸è€ƒè™‘1çš„æƒ…å†µä¸‹ï¼Œåº”è¯¥å°†æ›´å®¹æ˜“è¢«åŒ¹é…åˆ°çš„è§„åˆ™æ”¾ç½®åœ¨å‰é¢ã€‚</h3><p>æ¯”å¦‚ï¼Œä½ å†™äº†ä¸¤æ¡è§„åˆ™ï¼Œä¸€æ¡é’ˆå¯¹sshdæœåŠ¡ï¼Œä¸€æ¡é’ˆå¯¹webæœåŠ¡ã€‚</p>
<p>å‡è®¾ï¼Œä¸€å¤©ä¹‹å†…ï¼Œæœ‰20000ä¸ªè¯·æ±‚è®¿é—®webæœåŠ¡ï¼Œæœ‰200ä¸ªè¯·æ±‚è®¿é—®sshdæœåŠ¡ï¼Œ</p>
<p>é‚£ä¹ˆï¼Œåº”è¯¥å°†é’ˆå¯¹webæœåŠ¡çš„è§„åˆ™æ”¾åœ¨å‰é¢ï¼Œé’ˆå¯¹sshdçš„è§„åˆ™æ”¾åœ¨åé¢ï¼Œå› ä¸ºè®¿é—®webæœåŠ¡çš„è¯·æ±‚é¢‘ç‡æ›´é«˜ã€‚</p>
<p>å¦‚æœå°†sshdçš„è§„åˆ™æ”¾åœ¨å‰é¢ï¼Œå½“æŠ¥æ–‡æ˜¯è®¿é—®webæœåŠ¡æ—¶ï¼Œsshdçš„è§„åˆ™ä¹Ÿè¦ç™½ç™½çš„éªŒè¯ä¸€éï¼Œç”±äºè®¿é—®webæœåŠ¡çš„é¢‘ç‡æ›´é«˜ï¼Œç™½ç™½è€—è´¹çš„èµ„æºå°±æ›´å¤šã€‚</p>
<p>å¦‚æœwebæœåŠ¡çš„è§„åˆ™æ”¾åœ¨å‰é¢ï¼Œç”±äºè®¿é—®webæœåŠ¡çš„é¢‘ç‡æ›´é«˜ï¼Œæ‰€ä»¥æ— ç”¨åŠŸä¼šæ¯”è¾ƒå°‘ã€‚</p>
<p>æ¢å¥è¯è¯´å°±æ˜¯ï¼Œåœ¨æ²¡æœ‰é¡ºåºè¦æ±‚çš„æƒ…å†µä¸‹ï¼Œä¸åŒç±»åˆ«çš„è§„åˆ™ï¼Œè¢«åŒ¹é…æ¬¡æ•°å¤šçš„ã€åŒ¹é…é¢‘ç‡é«˜çš„è§„åˆ™åº”è¯¥æ”¾åœ¨å‰é¢ã€‚</p>
<h3 id="å½“IPTABLESæ‰€åœ¨ä¸»æœºä½œä¸ºç½‘ç»œé˜²ç«å¢™æ—¶"><a href="#å½“IPTABLESæ‰€åœ¨ä¸»æœºä½œä¸ºç½‘ç»œé˜²ç«å¢™æ—¶" class="headerlink" title="å½“IPTABLESæ‰€åœ¨ä¸»æœºä½œä¸ºç½‘ç»œé˜²ç«å¢™æ—¶"></a>å½“IPTABLESæ‰€åœ¨ä¸»æœºä½œä¸ºç½‘ç»œé˜²ç«å¢™æ—¶</h3><p>åœ¨é…ç½®è§„åˆ™æ—¶ï¼Œåº”ç€é‡è€ƒè™‘æ–¹å‘æ€§ï¼ŒåŒå‘éƒ½è¦è€ƒè™‘ï¼Œä»å¤–åˆ°å†…ï¼Œä»å†…åˆ°å¤–ã€‚</p>
<h3 id="åœ¨é…ç½®IPTABLESç™½åå•æ—¶"><a href="#åœ¨é…ç½®IPTABLESç™½åå•æ—¶" class="headerlink" title="åœ¨é…ç½®IPTABLESç™½åå•æ—¶"></a>åœ¨é…ç½®IPTABLESç™½åå•æ—¶</h3><p>å¾€å¾€ä¼šå°†é“¾çš„é»˜è®¤ç­–ç•¥è®¾ç½®ä¸ºACCEPTï¼Œé€šè¿‡åœ¨é“¾çš„æœ€åè®¾ç½®REJECTè§„åˆ™å®ç°ç™½åå•æœºåˆ¶ï¼Œè€Œä¸æ˜¯å°†é“¾çš„é»˜è®¤ç­–ç•¥è®¾ç½®ä¸ºDROPï¼Œå¦‚æœå°†é“¾çš„é»˜è®¤ç­–ç•¥è®¾ç½®ä¸ºDROPï¼Œå½“é“¾ä¸­çš„è§„åˆ™è¢«æ¸…ç©ºæ—¶ï¼Œç®¡ç†å‘˜çš„è¯·æ±‚ä¹Ÿå°†ä¼šè¢«DROPæ‰ã€‚</p>
]]></content>
      <tags>
        <tag>äº‘åŸç”ŸåŸºç¡€ç³»åˆ—</tag>
        <tag>Kubernetesç½‘ç»œ</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸€ä¸ªwebæ¡†æ¶--less</title>
    <url>/2022/06/13/uncatalog/cl4cnypz40000z4r77k3khkjx/</url>
    <content><![CDATA[<hr>
<span id="more"></span>
<p><a href="https://github.com/BugKillerPro/less">é¡¹ç›®åœ°å€</a></p>
<h2 id="ä¸€ï¼ŒèƒŒæ™¯"><a href="#ä¸€ï¼ŒèƒŒæ™¯" class="headerlink" title="ä¸€ï¼ŒèƒŒæ™¯"></a>ä¸€ï¼ŒèƒŒæ™¯</h2><blockquote>
<p>å®ç°ä¸€ä¸ªgo webæ¡†æ¶ï¼Œæ˜¯æˆ‘ä»javaè½¬goçš„ç¬¬ä¸€ä¸ªé¡¹ç›®ï¼Œå½“æ—¶å›¢é˜Ÿäººæ‰‹ç´§ç¼ºï¼Œä¸šåŠ¡çº¿åŸæœ‰çš„javaé¡¹ç›®é‡æ„éœ€æ±‚éå¸¸ç´§æ€¥ï¼Œå¯¹äºä¸ºè¿™äº›é¡¹ç›®æä¾›æ”¯æ’‘çš„webæ¡†æ¶ï¼Œç»™çš„å¼€å‘æ—¶é—´æ›´æ˜¯å°‘å¾—å¯æ€œï¼Œæ›´è®©äººæŠ“ç‹‚çš„æ˜¯ï¼Œè¿™ä¹ˆç´§æ€¥çš„æ¡†æ¶å¼€å‘ä»»åŠ¡ï¼Œäººå‘˜é…ç½®å°±æˆ‘ä¸€ä¸ªï¼Œå“ˆå“ˆå“ˆå“ˆã€‚ å½“æ—¶ï¼Œçœ‹äº†ä¸‹httprouterçš„æºç ï¼Œè¿˜æ²¡æ¥å¾—åŠå­¦ä¹ ä¸‹gin beegoç­‰çŸ¥åwebæ¡†æ¶ï¼Œå°±ç›´æ¥ä¸Šæ‰‹å¹²äº†ã€‚<br>ç°åœ¨å›æƒ³èµ·æ¥ï¼Œè™½ç„¶è¯¥æœ‰çš„åŠŸèƒ½éƒ½æœ‰äº†ï¼Œä½†æ˜¯ä»ç»†èŠ‚è®¾è®¡å’Œä»£ç ç»“æ„ä¸Šçœ‹ï¼Œè¿˜æœ‰ä¸å°‘å¯ä»¥ä¼˜åŒ–çš„åœ°æ–¹ï¼Œå¹¶ä¸”å½“æ—¶å¾ˆå¤šæ¶‰åŠåˆ°çš„çŸ¥è¯†ç‚¹è¿˜æ²¡æœ‰æ¥å¾—åŠç”±ç‚¹åˆ°é¢çš„å±•å¼€ï¼Œä¹Ÿå°±æ²¡æœ‰æ¥å¾—åŠåº”ç”¨åˆ°é¡¹ç›®ä¸­å»ã€‚æ‰€ä»¥å†³å®šä»é›¶å¼€å§‹ï¼Œå†å†™ä¸€ä¸ªwebæ¡†æ¶ï¼ŒåŒæ—¶æŠŠä¸€äº›æ¯”è¾ƒå€¼å¾—è®°å½•çš„åœ°æ–¹ï¼Œä»¥æ–‡å­—çš„å½¢å¼åšä¸€ä¸ªè¾“å‡ºå’Œæ€»ç»“ï¼Œå¸Œæœ›èƒ½å¤Ÿå¯¹çœ‹åˆ°è¿™ç¯‡æ–‡ç« çš„ä½ èµ·åˆ°ä¸€å®šçš„å¸®åŠ©ã€‚</p>
</blockquote>
<h3 id="1ï¼Œå½“æ—¶ä¸ºä»€ä¹ˆä¸ç”¨ç°æœ‰çš„gin-ã€beegoã€kitã€echoå’Œgorillaç­‰webæ¡†æ¶ï¼Œè€Œæ˜¯è¦é‡å¤é€ è½®å­ï¼Ÿ"><a href="#1ï¼Œå½“æ—¶ä¸ºä»€ä¹ˆä¸ç”¨ç°æœ‰çš„gin-ã€beegoã€kitã€echoå’Œgorillaç­‰webæ¡†æ¶ï¼Œè€Œæ˜¯è¦é‡å¤é€ è½®å­ï¼Ÿ" class="headerlink" title="1ï¼Œå½“æ—¶ä¸ºä»€ä¹ˆä¸ç”¨ç°æœ‰çš„gin ã€beegoã€kitã€echoå’Œgorillaç­‰webæ¡†æ¶ï¼Œè€Œæ˜¯è¦é‡å¤é€ è½®å­ï¼Ÿ"></a>1ï¼Œå½“æ—¶ä¸ºä»€ä¹ˆä¸ç”¨ç°æœ‰çš„<code>gin</code> ã€<code>beego</code>ã€<code>kit</code>ã€<code>echo</code>å’Œ<code>gorilla</code>ç­‰<code>web</code>æ¡†æ¶ï¼Œè€Œæ˜¯è¦é‡å¤é€ è½®å­ï¼Ÿ</h3><ul>
<li>ç¬¬ä¸€ï¼Œä¹Ÿæ˜¯æœ€é‡è¦çš„åŸå› â€“ç»ƒæ‰‹ã€‚äº†è§£ä¸€ä¸ªé¢†åŸŸ/çŸ¥è¯†ç‚¹ï¼Œæœ€å¥½çš„åŠæ³•å°±æ˜¯å®ç°å®ƒï¼Œå½“æ—¶åˆšä»javaè½¬goï¼Œæ€¥éœ€ä¸€ä¸ªé¡¹ç›®ç»ƒæ‰‹ã€‚</li>
<li>ç¬¬äºŒï¼Œæ‹¿webæ¡†æ¶ä½œä¸ºç»ƒæ‰‹é¡¹ç›®ï¼Œé™¤äº†éœ€è¦æ‰å®çš„åŸºç¡€ä¹‹å¤–ï¼Œéš¾åº¦æ–¹é¢ï¼Œä¸é«˜ä¸ä½ï¼Œéå¸¸åˆé€‚ã€‚</li>
<li>ç¬¬ä¸‰ï¼Œå›¢é˜Ÿå†…éƒ¨å…³äºç°æœ‰è½®å­çš„äº‰è®ºæ— æ³•è¾¾æˆä¸€è‡´ï¼Œæœ€ç»ˆå†³å®šè‡ªå·±å¼€å‘æ»¡è¶³å®šåˆ¶åŒ–éœ€æ±‚çš„è½»é‡çº§æ¡†æ¶ã€‚</li>
<li>ç¬¬å››ï¼Œæœ‰plan Bï¼Œä¹Ÿå°±æ˜¯å…œåº•æ–¹æ¡ˆã€‚å¦‚æœå¼€å‘å¤±è´¥ï¼Œå°±ç›´æ¥ä¸Šç°æœ‰çš„è½®å­ï¼Œå¯¹äºä¸šåŠ¡çº¿ï¼Œå‡ ä¹æ²¡æœ‰åˆ‡æ¢æˆæœ¬ã€‚</li>
</ul>
<h3 id="2ï¼Œå“ªä¸ªæ¡†æ¶æ›´å¥½ï¼Ÿ"><a href="#2ï¼Œå“ªä¸ªæ¡†æ¶æ›´å¥½ï¼Ÿ" class="headerlink" title="2ï¼Œå“ªä¸ªæ¡†æ¶æ›´å¥½ï¼Ÿ"></a>2ï¼Œå“ªä¸ªæ¡†æ¶æ›´å¥½ï¼Ÿ</h3><p>å¼€æºæ¡†æ¶å¾ˆå¤šï¼Œä¸çŸ¥é“åº”è¯¥å­¦ä¹ é€‰æ‹©ä»€ä¹ˆæ¡†æ¶ã€‚ç›¸ä¿¡å¤§å¤šæ•°gopheréƒ½æœ‰é‡åˆ°è¿‡è¿™ç§å›°æ‰°ã€‚ æˆ‘çš„å»ºè®®æ˜¯ä¸è¦è¢«æ¡†æ¶ç»‘æ¶ï¼Œææ¸…æ¥šäº‹æƒ…çš„æœ¬è´¨ï¼Œæ‰æ˜¯è§£å†³é—®é¢˜çš„ç‹é“ã€‚ ç°åœ¨æŠ€æœ¯æ›´æ–°æ˜¯æ—¥æ–°æœˆå¼‚çš„ï¼Œæ¡†æ¶æ›´æ˜¯å¦‚æ­¤ï¼Œéš”ä¸€æ®µæ—¶é—´æ¢ä¸€ä¸ªï¼Œä¸åŒçš„å…¬å¸å¾ˆå¤§å¯èƒ½é‡‡ç”¨ä¸åŒçš„æ¡†æ¶ï¼Œæ‰€ä»¥ä½ æ¢æ–°å·¥ä½œä¹‹åï¼Œä¸€èˆ¬éƒ½å¾—é‡æ–°å­¦ä¹ ä¸€é—¨æ–°æ¡†æ¶ï¼Œå¦‚æœæ–°å…¬å¸ç”¨çš„æ¡†æ¶ä½ ä¸ä¼šï¼Œé‚£å¦‚ä½•åšåˆ°å¿«é€Ÿä¸Šæ‰‹å°†ä¼šæ˜¯ä¸€ä¸ªæ¯”å­¦ä¹ æ¡†æ¶æ›´å¤§çš„æŒ‘æˆ˜ã€‚<br>å…¶å®è¿™äº›è¡¨é¢ç°è±¡çš„æœ¬è´¨åªæœ‰ä¸€ä¸ªï¼Œé‚£å°±æ˜¯ï¼šæ¡†æ¶åªæ˜¯ä¸€ä¸ªå·¥å…·è€Œå·²ï¼ä¸æ­¢æ¡†æ¶æ˜¯å·¥å…·ï¼Œæˆ‘ä»¬çš„ç¼–ç¨‹è¯­è¨€ä¹Ÿå¯ä»¥æ˜¯å·¥å…·ã€‚æ‰€ä»¥æ¡†æ¶å¯ä»¥ä¸€ä¸ªä¸ªçš„æ¢ï¼Œç¼–ç¨‹è¯­è¨€ä¹Ÿå¯ä»¥ï¼Œç°åœ¨å¾ˆå¤šæœåŠ¡å·²ç»ä½¿ç”¨ Go è¯­è¨€æ›¿ä»£ Javaã€Python äº†ã€‚<br>é‚£ä¹ˆåŸºäºè¿™ä¸ªæœ¬è´¨ï¼Œæˆ‘è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ</p>
<ul>
<li>æ‰“ç‰¢åŸºç¡€ã€‚ç¼–ç¨‹è¯­è¨€æœ¬èº«çš„åŠŸèƒ½ã€æ¦‚å¿µã€è¯­æ³•ã€æ¨¡å¼ç­‰ï¼Œå®ƒæ˜¯ç¼–ç¨‹çš„åœ°åŸºï¼Œä¸ä¼šéšç€æ¡†æ¶çš„æ”¹å˜è€Œæ”¹å˜ã€‚</li>
<li>ç²¾é€šåŸç†ã€‚å°±æ‹¿webæ¡†æ¶æ¥è¯´ï¼Œä¸»è¦è´Ÿè´£çš„å°±æ˜¯ä¸‰ä»¶äº‹ï¼šæ¥æ”¶è¯·æ±‚ã€æ‰¾åˆ°ç”¨æˆ·å¤„ç†é€»è¾‘è°ƒç”¨ä¸€ä¸‹ã€å†æŠŠå“åº”å†™å›å»ã€‚ç®€å•ç‚¹å°±æ˜¯ï¼šæ¥å—è¯·æ±‚ã€åˆ†å‘è¯·æ±‚ã€å†™å›å“åº”ã€‚åŒä¸€ç±»æ¡†æ¶ï¼Œåº•å±‚åŸç†éƒ½æ˜¯å·®ä¸å¤šçš„ï¼ŒåŒºåˆ«ä¸»è¦è¡¨ç°åœ¨å®ç°æ–¹å¼ã€ç”¨æˆ·ä½“éªŒï¼ˆå¼€å‘è€…æ˜¯ç”¨æˆ·ï¼‰ã€å‘¨è¾¹ç”Ÿæ€ç­‰æ–¹é¢ã€‚</li>
<li>å¤šå®è·µã€‚å®è·µæ˜¯æ£€éªŒçœŸç†çš„å”¯ä¸€æ ‡å‡†ï¼Œç§¯æå‚ä¸å…¬å¸æ–°é¡¹ç›®ï¼Œå¤šå‘å¤§ä½¬å­¦ä¹ ã€‚</li>
</ul>
<h3 id="3ï¼Œåå­—lessçš„ç”±æ¥ï¼Ÿ"><a href="#3ï¼Œåå­—lessçš„ç”±æ¥ï¼Ÿ" class="headerlink" title="3ï¼Œåå­—lessçš„ç”±æ¥ï¼Ÿ"></a>3ï¼Œåå­—<code>less</code>çš„ç”±æ¥ï¼Ÿ</h3><p>   <code>less is more</code></p>
<h3 id="4ï¼Œç†è§£lessï¼Œéœ€è¦äº†è§£å“ªäº›å‰ç½®çŸ¥è¯†ï¼Ÿ"><a href="#4ï¼Œç†è§£lessï¼Œéœ€è¦äº†è§£å“ªäº›å‰ç½®çŸ¥è¯†ï¼Ÿ" class="headerlink" title="4ï¼Œç†è§£lessï¼Œéœ€è¦äº†è§£å“ªäº›å‰ç½®çŸ¥è¯†ï¼Ÿ"></a>4ï¼Œç†è§£<code>less</code>ï¼Œéœ€è¦äº†è§£å“ªäº›å‰ç½®çŸ¥è¯†ï¼Ÿ</h3><h4 id="4-1ï¼Œè®¤çœŸè¯»æ‡‚net-httpæ ‡å‡†åº“ï¼Œå…¶ä¸­å¤§è‡´çš„é€»è¾‘å¦‚ä¸‹"><a href="#4-1ï¼Œè®¤çœŸè¯»æ‡‚net-httpæ ‡å‡†åº“ï¼Œå…¶ä¸­å¤§è‡´çš„é€»è¾‘å¦‚ä¸‹" class="headerlink" title="4.1ï¼Œè®¤çœŸè¯»æ‡‚net/httpæ ‡å‡†åº“ï¼Œå…¶ä¸­å¤§è‡´çš„é€»è¾‘å¦‚ä¸‹:"></a>4.1ï¼Œè®¤çœŸè¯»æ‡‚<code>net/http</code>æ ‡å‡†åº“ï¼Œå…¶ä¸­å¤§è‡´çš„é€»è¾‘å¦‚ä¸‹:</h4><ul>
<li>æ ‡å‡†åº“åˆ›å»º HTTP æœåŠ¡æ˜¯é€šè¿‡åˆ›å»ºä¸€ä¸ª Server æ•°æ®ç»“æ„å®Œæˆçš„</li>
<li>Server æ•°æ®ç»“æ„åœ¨ for å¾ªç¯ä¸­ä¸æ–­ç›‘å¬æ¯ä¸€ä¸ªè¿æ¥</li>
<li>æ¯ä¸ªè¿æ¥é»˜è®¤å¼€å¯ä¸€ä¸ª Goroutine ä¸ºå…¶æœåŠ¡</li>
<li>serverHandler ç»“æ„ä»£è¡¨è¯·æ±‚å¯¹åº”çš„å¤„ç†é€»è¾‘ï¼Œå¹¶ä¸”é€šè¿‡è¿™ä¸ªç»“æ„è¿›è¡Œå…·ä½“ä¸šåŠ¡é€»è¾‘å¤„ç†</li>
<li>Server æ•°æ®ç»“æ„å¦‚æœæ²¡æœ‰è®¾ç½®å¤„ç†å‡½æ•° Handlerï¼Œé»˜è®¤ä½¿ç”¨DefaultServerMux å¤„ç†è¯·æ±‚</li>
<li>DefaultServerMux æ˜¯ä½¿ç”¨ map ç»“æ„æ¥å­˜å‚¨å’ŒæŸ¥æ‰¾è·¯ç”±è§„åˆ™</li>
</ul>
<blockquote>
<p>å¾ˆæ˜¾ç„¶ï¼Œèªæ˜è€Œåˆç†Ÿæ‚‰<code>RESTful</code>çš„ä½ è‚¯å®šå·²ç»å‘ç°ï¼Œæœ€åä¸€æ­¥â€DefaultServerMux æ˜¯ä½¿ç”¨ map ç»“æ„æ¥å­˜å‚¨å’ŒæŸ¥æ‰¾è·¯ç”±è§„åˆ™â€æ˜¯ä¸€ä¸ªå¯ä¼˜åŒ–çš„ç‚¹ï¼Œè¿™ä¹Ÿæ˜¯ä¼—å¤šgo webæ¡†æ¶éœ€è¦è‡ªå·±å®ç°çš„ä¸€ä¸ªåœ°æ–¹ï¼Œå½“ç„¶<code>less</code>ä¹Ÿä¸ä¾‹å¤–ã€‚</p>
</blockquote>
<h4 id="4-2-ç†è§£Contextçš„è®¾è®¡æ€è·¯ï¼Œåœ¨lessä¸­ï¼Œæˆ‘ä»¬å°†è®¾è®¡ä¸€ä¸ªå®ç°Contextæ¥å£çš„custom-contextï¼Œå¹¶å°†è¢«åº”ç”¨äºä»¥ä¸‹æ–¹é¢ï¼š"><a href="#4-2-ç†è§£Contextçš„è®¾è®¡æ€è·¯ï¼Œåœ¨lessä¸­ï¼Œæˆ‘ä»¬å°†è®¾è®¡ä¸€ä¸ªå®ç°Contextæ¥å£çš„custom-contextï¼Œå¹¶å°†è¢«åº”ç”¨äºä»¥ä¸‹æ–¹é¢ï¼š" class="headerlink" title="4.2,ç†è§£Contextçš„è®¾è®¡æ€è·¯ï¼Œåœ¨lessä¸­ï¼Œæˆ‘ä»¬å°†è®¾è®¡ä¸€ä¸ªå®ç°Contextæ¥å£çš„custom contextï¼Œå¹¶å°†è¢«åº”ç”¨äºä»¥ä¸‹æ–¹é¢ï¼š"></a>4.2,ç†è§£<code>Context</code>çš„è®¾è®¡æ€è·¯ï¼Œåœ¨<code>less</code>ä¸­ï¼Œæˆ‘ä»¬å°†è®¾è®¡ä¸€ä¸ªå®ç°<code>Context</code>æ¥å£çš„<code>custom context</code>ï¼Œå¹¶å°†è¢«åº”ç”¨äºä»¥ä¸‹æ–¹é¢ï¼š</h4><ul>
<li>æ—¥å¸¸å¼€å‘ä¸­æˆ‘ä»¬å¤§æ¦‚ç‡ä¼šé‡åˆ°è¶…æ—¶æ§åˆ¶çš„åœºæ™¯ï¼Œæ¯”å¦‚ä¸€ä¸ªæ‰¹é‡è€—æ—¶ä»»åŠ¡ã€ç½‘ç»œè¯·æ±‚ç­‰ï¼›ä¸€ä¸ªè‰¯å¥½çš„è¶…æ—¶æ§åˆ¶å¯ä»¥æœ‰æ•ˆçš„é¿å…ä¸€äº›é—®é¢˜ï¼ˆæ¯”å¦‚ goroutine æ³„éœ²ã€èµ„æºä¸é‡Šæ”¾ç­‰ï¼‰</li>
<li>ä¸€ä¸ªè¯·æ±‚ï¼Œä»æ¥å—åˆ°è¿”å›è¿‡ç¨‹ä¸­çš„ä¿¡æ¯ä¼ é€’å’Œå…±äº«</li>
<li>è¶…æ—¶æ§åˆ¶groutineå’Œä¸šåŠ¡é€»è¾‘groutineå¹¶å‘å†™<code>ResponseWriter</code>é—®é¢˜çš„å¤„ç†</li>
<li>è¶…æ—¶æ§åˆ¶groutineï¼Œè§¦å‘è¶…æ—¶ï¼Œå†™å…¥<code>ResponseWriter</code>è¶…æ—¶å“åº”ä¹‹åï¼Œä¸šåŠ¡é€»è¾‘groutineé‡å¤å†™<code>ResponseWriter</code>çš„é—®é¢˜å¤„ç†</li>
</ul>
<p>Contextè®¾è®¡æ€æƒ³åŠä½¿ç”¨å®è·µï¼Œå¯ä»¥å‚è€ƒæˆ‘çš„è¿™ç¯‡<a href="https://bugkillerpro.github.io/2022/06/16/uncatalog/cl4gopymv00009or79u472iwp/">Contextè®¾è®¡æ€æƒ³åŠä½¿ç”¨å®è·µ</a></p>
<h3 id="4-3ï¼Œç†Ÿæ‚‰httpåè®®ï¼Œæ¨èé˜…è¯»ã€ŠHTTPæƒå¨æŒ‡å—ã€‹ï¼Œå¦‚æœæ—¶é—´å……è£•è¿˜å¯ä»¥è¯»ä¸€ä¸‹ã€ŠTCP-IPè¯¦è§£ã€‹ç³»åˆ—ã€‚"><a href="#4-3ï¼Œç†Ÿæ‚‰httpåè®®ï¼Œæ¨èé˜…è¯»ã€ŠHTTPæƒå¨æŒ‡å—ã€‹ï¼Œå¦‚æœæ—¶é—´å……è£•è¿˜å¯ä»¥è¯»ä¸€ä¸‹ã€ŠTCP-IPè¯¦è§£ã€‹ç³»åˆ—ã€‚" class="headerlink" title="4.3ï¼Œç†Ÿæ‚‰httpåè®®ï¼Œæ¨èé˜…è¯»ã€ŠHTTPæƒå¨æŒ‡å—ã€‹ï¼Œå¦‚æœæ—¶é—´å……è£•è¿˜å¯ä»¥è¯»ä¸€ä¸‹ã€ŠTCP/IPè¯¦è§£ã€‹ç³»åˆ—ã€‚"></a>4.3ï¼Œç†Ÿæ‚‰<code>http</code>åè®®ï¼Œæ¨èé˜…è¯»ã€ŠHTTPæƒå¨æŒ‡å—ã€‹ï¼Œå¦‚æœæ—¶é—´å……è£•è¿˜å¯ä»¥è¯»ä¸€ä¸‹ã€ŠTCP/IPè¯¦è§£ã€‹ç³»åˆ—ã€‚</h3><h3 id="4-4ï¼Œç†Ÿæ‚‰http-ResponseWriterå’Œ-http-Requestè¿™ä¸¤å¤§ä¿¡æ¯è½½ä½“çš„ç»“æ„å’Œæ–¹æ³•ï¼Œä¸ç„¶çš„è¯ï¼Œè¿ä»å“ªé‡Œè¯»å–query-valueså’Œ-form-dataä»¥åŠå¾€å“ªé‡Œå†™responseéƒ½ä¸çŸ¥é“ï¼Œé‚£å°±å°´å°¬äº†ã€‚"><a href="#4-4ï¼Œç†Ÿæ‚‰http-ResponseWriterå’Œ-http-Requestè¿™ä¸¤å¤§ä¿¡æ¯è½½ä½“çš„ç»“æ„å’Œæ–¹æ³•ï¼Œä¸ç„¶çš„è¯ï¼Œè¿ä»å“ªé‡Œè¯»å–query-valueså’Œ-form-dataä»¥åŠå¾€å“ªé‡Œå†™responseéƒ½ä¸çŸ¥é“ï¼Œé‚£å°±å°´å°¬äº†ã€‚" class="headerlink" title="4.4ï¼Œç†Ÿæ‚‰http.ResponseWriterå’Œ*http.Requestè¿™ä¸¤å¤§ä¿¡æ¯è½½ä½“çš„ç»“æ„å’Œæ–¹æ³•ï¼Œä¸ç„¶çš„è¯ï¼Œè¿ä»å“ªé‡Œè¯»å–query valueså’Œ form dataä»¥åŠå¾€å“ªé‡Œå†™responseéƒ½ä¸çŸ¥é“ï¼Œé‚£å°±å°´å°¬äº†ã€‚"></a>4.4ï¼Œç†Ÿæ‚‰<code>http.ResponseWriter</code>å’Œ<code>*http.Request</code>è¿™ä¸¤å¤§ä¿¡æ¯è½½ä½“çš„ç»“æ„å’Œæ–¹æ³•ï¼Œä¸ç„¶çš„è¯ï¼Œè¿ä»å“ªé‡Œè¯»å–<code>query values</code>å’Œ <code>form data</code>ä»¥åŠå¾€å“ªé‡Œå†™<code>response</code>éƒ½ä¸çŸ¥é“ï¼Œé‚£å°±å°´å°¬äº†ã€‚</h3><h3 id="4-5ï¼Œç†Ÿæ‚‰è®¾è®¡æ¨¡å¼ã€‚"><a href="#4-5ï¼Œç†Ÿæ‚‰è®¾è®¡æ¨¡å¼ã€‚" class="headerlink" title="4.5ï¼Œç†Ÿæ‚‰è®¾è®¡æ¨¡å¼ã€‚"></a>4.5ï¼Œç†Ÿæ‚‰è®¾è®¡æ¨¡å¼ã€‚</h3><p>å·§å¦™è€Œåˆä¼˜é›…ï¼Œå‡ ä¹æ˜¯æ‰€æœ‰æ¶æ„è®¾è®¡çš„åŸºæœ¬å‡†åˆ™ï¼Œ<code>less</code>ä¹Ÿä¸ä¾‹å¤–ï¼Œå¦‚æœä½ æ¥ä¸åŠè®¤çœŸç ”è¯»23ç§è®¾è®¡æ¨¡å¼ï¼Œå¯ä»¥è®¤çœŸé˜…è¯»æˆ‘çš„è¿™ç¯‡<a href="https://bugkillerpro.github.io/2022/06/17/uncatalog/cl4i43q7u00005sr70tpnfrfg/">é¢å‘å¯¹è±¡è®¾è®¡å…­å¤§åŸåˆ™</a>ï¼Œå¦‚æœèƒ½å¤Ÿåšåˆ°èä¼šè´¯é€šï¼Œé‚£ä¹ˆç”±æ­¤è¡åŒ–è€Œæ¥çš„è®¾è®¡æ¨¡å¼ï¼Œä½ ä¹Ÿå¯ä»¥åšåˆ°ä¿¡æ‰‹æ‹ˆæ¥ã€‚</p>
<h3 id="4-6ï¼Œone-more-thing"><a href="#4-6ï¼Œone-more-thing" class="headerlink" title="4.6ï¼Œone more thing"></a>4.6ï¼Œone more thing</h3><p><em><strong>ä¸ºäº†é™ä½lessæ¡†æ¶çš„é˜…è¯»éš¾åº¦ï¼Œå»ºè®®å…ˆçœ‹æ‡‚è¿™ä¸ªç¤ºä¾‹çº§åˆ«çš„å°æ¡†æ¶ï¼Œ</strong></em> <a href="https://github.com/BugKillerPro/less/tree/less_easy_demo">æºç åœ¨æ­¤</a>ã€‚<br>ä¸ºä»€ä¹ˆè¦å¼ºè°ƒä¸Šé¢é“¾æ¥é‡Œçš„æ¡†æ¶æ˜¯ç¤ºä¾‹çº§åˆ«ï¼ŸåŸå› åœ¨äºï¼Œè¿™ä¸ªç¤ºä¾‹æ¡†æ¶åªèƒ½ç”¨äºä¸ªäººå¼€å‘ï¼Œä¸èƒ½ç”¨äºç”Ÿäº§ï¼Œè€Œlessçš„ç›®æ ‡æ˜¯æ‰“é€ æˆä¸€ä¸ªç”Ÿäº§çº§åˆ«çš„æ¡†æ¶ã€‚<br>é‚£ä¹ˆç”Ÿäº§çº§åˆ«å’Œç¤ºä¾‹çº§åˆ«æœ‰å“ªäº›æ˜æ˜¾çš„å·®å¼‚å‘¢ï¼Ÿ<br>ç­”ï¼šç»†èŠ‚å’Œç”Ÿæ€<br>å…·ä½“ä½“ç°åœ¨ä¸€ä¸‹å‡ ç‚¹:</p>
<ul>
<li>æ ¸å¿ƒæ¨¡å—ã€‚æœåŠ¡å¯åŠ¨æ–¹å¼ã€è·¯ç”±åˆ†å‘æœºåˆ¶ã€contextå°è£…æ€§å’Œä¸­é—´ä»¶æœºåˆ¶ç­‰çš„è®¾è®¡</li>
<li>åŠŸèƒ½å®Œå¤‡æ€§ã€‚æ—¥å¿—æ¨¡å—ã€å‘½ä»¤è¡Œå·¥å…·å’Œç¼“å­˜æœºåˆ¶ç­‰åŠŸèƒ½æ˜¯å¦æä¾›</li>
<li>æ¡†æ¶æ‰©å±•æ€§ã€‚æ˜¯å¦æ”¯æŒæ‰©å±•ï¼Œæ‰©å±•æ–¹å¼æ˜¯å¦å‹å¥½</li>
<li>æ¡†æ¶æ€§èƒ½ã€‚qpsç­‰æ€§èƒ½</li>
<li>æ–‡æ¡£/ç¤¾åŒºã€‚</li>
</ul>
<p>å¾ˆæ˜¾ç„¶ï¼Œç¤ºä¾‹çº§åˆ«çš„æ¡†æ¶ï¼Œå¹¶ä¸æ»¡è¶³ä»¥ä¸Šå‡ ç‚¹ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œä¸€ä¸ªäººå®Œæˆå®Œç¾å¥‘åˆä»¥ä¸Šå‡ ç‚¹çš„ç”Ÿäº§çº§åˆ«çš„æ¡†æ¶ä¹Ÿæ˜¯ä¸å¯èƒ½çš„ï¼Œæ‰€ä»¥éœ€è¦å­¦ä¼šç«™åœ¨å·¨äººçš„è‚©è†€ä¸Šæ€è€ƒï¼Œå‘å·¨äººå€ŸåŠ›ï¼Œå› æ­¤ï¼Œlessåœ¨å…³é”®ä»£ç çš„è®¾è®¡ä¸Šï¼Œä¼šå€Ÿé‰´å·²ç»ç»è¿‡åƒé”¤ç™¾ç‚¼ã€åå¤è¿­ä»£å‡çº§è¿‡çš„ginçš„åšæ³•ï¼Œåªæœ‰è¿™æ ·ï¼Œæ‰èƒ½åšå‡ºåŠŸèƒ½å®Œå¤‡ã€æ€§èƒ½ä¼˜è‰¯çš„ç”Ÿäº§çº§æ¡†æ¶ã€‚</p>
<h3 id="4-7ï¼ŒLast-but-not-least-â€“-äº†è§£åŒ…æ‹¬ä½†ä¸é™äºä»¥ä¸‹å¼€æºåº“ï¼Œè¿™äº›å¼€æºåº“å°†ä¼šè¢«å¼•ç”¨åˆ°less"><a href="#4-7ï¼ŒLast-but-not-least-â€“-äº†è§£åŒ…æ‹¬ä½†ä¸é™äºä»¥ä¸‹å¼€æºåº“ï¼Œè¿™äº›å¼€æºåº“å°†ä¼šè¢«å¼•ç”¨åˆ°less" class="headerlink" title="4.7ï¼ŒLast but not least â€“ äº†è§£åŒ…æ‹¬ä½†ä¸é™äºä»¥ä¸‹å¼€æºåº“ï¼Œè¿™äº›å¼€æºåº“å°†ä¼šè¢«å¼•ç”¨åˆ°less"></a>4.7ï¼ŒLast but not least â€“ äº†è§£åŒ…æ‹¬ä½†ä¸é™äºä»¥ä¸‹å¼€æºåº“ï¼Œè¿™äº›å¼€æºåº“å°†ä¼šè¢«å¼•ç”¨åˆ°less</h3><ul>
<li><a href="https://github.com/spf13/cobra">cobra</a></li>
<li><a href="https://github.com/spf13/cast">cast</a> (è¿™ä¸¤ä¸ªåº“çš„ä½œè€…æ˜¯googleçš„å¤§ä½¬Steve Francia)</li>
<li><a href="https://github.com/AlecAivazis/survey">survey</a></li>
<li><a href="https://github.com/sevlyar/go-daemon">go-daemon</a></li>
<li><a href="https://github.com/src-d/go-git">go-git</a></li>
<li><a href="https://github.com/julienschmidt/httprouter">httprouter</a>  </li>
<li><a href="https://github.com/gin-gonic/contrib">gin-gonic/contrib</a></li>
<li><a href="https://github.com/google/uuid">uuid</a></li>
<li><a href="https://github.com/google/go-github">go-github</a></li>
<li><a href="https://github.com/swaggo/swag">swag</a> </li>
<li><a href="https://github.com/ErikDubbelboer/gspt">gspt</a></li>
<li><a href="github.com/mitchellh/mapstructure">mapstructure</a></li>
</ul>
<h2 id="äºŒï¼Œé‡è¦ç»“æ„-webæ¡†æ¶ä¸‰å¤§ä»¶ï¼šcontext-router-middleware"><a href="#äºŒï¼Œé‡è¦ç»“æ„-webæ¡†æ¶ä¸‰å¤§ä»¶ï¼šcontext-router-middleware" class="headerlink" title="äºŒï¼Œé‡è¦ç»“æ„(webæ¡†æ¶ä¸‰å¤§ä»¶ï¼šcontext,router,middleware)"></a>äºŒï¼Œé‡è¦ç»“æ„(webæ¡†æ¶ä¸‰å¤§ä»¶ï¼šcontext,router,middleware)</h2><blockquote>
<p>æ¡†æ¶ä¸­çš„æŸä¸ªæ¨¡å—ï¼Œæ¯”å¦‚è¯´è·¯ç”±ï¼Œå®ç°çš„æ–¹æ³•ä¸æ­¢ä¸€ç§ï¼Œæ¯ä¸€ä¸ªæ¨¡å—è¦å®ç°çš„åŠŸèƒ½ä¹Ÿå„æœ‰ä¸åŒï¼Œæ‰€ä»¥ç”¨å“ªä¸€ç§æ–¹æ³•æ¥å®ç°ï¼Œä»¥åŠè¦å®ç°å“ªäº›åŠŸèƒ½ï¼Œéƒ½æ˜¯ä¸€ç§é€‰æ‹©ã€‚ è€Œæ¯ç§é€‰æ‹©çš„èƒŒåï¼Œå…¶å®éƒ½æ˜¯æ–¹å‘é—®é¢˜ï¼Œå› ä¸ºè¿™äº›é€‰æ‹©å…±åŒæ„æˆäº†ä¸€ä¸ªæ¡†æ¶çš„å€¾å‘æ€§ï¼Œä¹Ÿå°±æ˜¯è®¾è®¡æ„Ÿã€‚è®¾è®¡æ„Ÿéå¸¸è€ƒéªŒå¼€å‘è€…çš„ç»¼åˆæŠ€èƒ½å’Œé¡¹ç›®ç»éªŒï¼Œä¹Ÿæ˜¯è€ƒæ ¸æ¡†æ¶è´¨é‡çš„ä¸€ä¸ªé‡è¦ç»´åº¦ã€‚</p>
</blockquote>
<h3 id="æ ¸å¿ƒæ¨¡å—"><a href="#æ ¸å¿ƒæ¨¡å—" class="headerlink" title="æ ¸å¿ƒæ¨¡å—"></a>æ ¸å¿ƒæ¨¡å—</h3><blockquote>
<p>ä¸€ä¸ªæ¡†æ¶æœ€æ ¸å¿ƒçš„æ¨¡å—ï¼šcontext,router,middlewareï¼Œå®ƒä»¬çš„è®¾è®¡æ„Ÿä¼šå½±å“åˆ°æ•´ä¸ªæ¡†æ¶çš„æ€§èƒ½å’Œè¡¨ç°ï¼Œä¹Ÿæœ€èƒ½ç›´æ¥ä½“ç°å‡ºæ¡†æ¶ä½œè€…çš„å¼€å‘æ°´å¹³ã€‚</p>
</blockquote>
<h4 id="1-context"><a href="#1-context" class="headerlink" title="1.context"></a>1.context</h4><p>å…³äº<a href="https://bugkillerpro.github.io/2022/06/16/uncatalog/cl4gopymv00009or79u472iwp/">Contextè®¾è®¡æ€æƒ³åŠä½¿ç”¨å®è·µ</a>ï¼Œæˆ‘åœ¨è¿™ç‰‡æ–‡ç« é‡Œå·²ç»è®²å¾—å¾ˆè¯¦ç»†äº†ã€‚åœ¨lessæ¡†æ¶é‡Œï¼Œæˆ‘ä»¬ä¸»è¦è¦äº†è§£çš„æ˜¯contextçš„åº”ç”¨å’Œè‡ªå®šä¹‰contextçš„æœ€ä½³å®è·µã€‚lessæ¡†æ¶é‡Œçš„è‡ªå®šä¹‰contextç»“æ„å¦‚ä¸‹ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">type</span> Context <span class="keyword">struct</span> &#123;</span><br><span class="line"><span class="comment">// æœåŠ¡å®¹å™¨</span></span><br><span class="line">container less.Container</span><br><span class="line"></span><br><span class="line">writermem responseWriter</span><br><span class="line">Request   *http.Request</span><br><span class="line">Writer    ResponseWriter</span><br><span class="line"></span><br><span class="line">Params   Params</span><br><span class="line">handlers HandlersChain</span><br><span class="line">index    <span class="keyword">int8</span></span><br><span class="line">fullPath <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line">engine *Engine</span><br><span class="line">params *Params</span><br><span class="line"></span><br><span class="line"><span class="comment">// This mutex protect Keys map</span></span><br><span class="line">mu sync.RWMutex</span><br><span class="line"></span><br><span class="line"><span class="comment">// Keys is a key/value pair exclusively for the context of each request.</span></span><br><span class="line">Keys <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">interface</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Errors is a list of errors attached to all the handlers/middlewares who used this context.</span></span><br><span class="line">Errors errorMsgs</span><br><span class="line"></span><br><span class="line"><span class="comment">// Accepted defines a list of manually accepted formats for content negotiation.</span></span><br><span class="line">Accepted []<span class="keyword">string</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// queryCache use url.ParseQuery cached the param query result from c.Request.URL.Query()</span></span><br><span class="line">queryCache url.Values</span><br><span class="line"></span><br><span class="line"><span class="comment">// formCache use url.ParseQuery cached PostForm contains the parsed form data from POST, PATCH,</span></span><br><span class="line"><span class="comment">// or PUT body parameters.</span></span><br><span class="line">formCache url.Values</span><br><span class="line"></span><br><span class="line"><span class="comment">// SameSite allows a server to define a cookie attribute making it impossible for</span></span><br><span class="line"><span class="comment">// the browser to send this cookie along with cross-site requests.</span></span><br><span class="line">sameSite http.SameSite</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h4 id="2-router"><a href="#2-router" class="headerlink" title="2.router"></a>2.router</h4><p>é¦–é€‰ï¼Œå¯¹äºä¸€ä¸ªwebæ¡†æ¶æ¥è¯´ï¼Œrouterå¿…é¡»è¦æ»¡è¶³ä»¥ä¸‹éœ€æ±‚ï¼š</p>
<ul>
<li>http method åŒ¹é…</li>
<li>é™æ€è·¯ç”±åŒ¹é…</li>
<li>è·¯ç”±æ‰¹é‡é€šç”¨å‰ç¼€</li>
<li>åŠ¨æ€è·¯ç”±åŒ¹é…</li>
</ul>
<p>æ‰€ä»¥åœ¨è·¯ç”±å­˜å‚¨ç»“æ„çš„è®¾è®¡é€‰å‹ä¸Šï¼Œéœ€è¦èŠ±äº›æ—¶é—´å»æ€è€ƒçš„ï¼Œæ¯•ç«Ÿè¯¥ç»“æ„é™¤äº†è¦æ»¡è¶³ä¸Šè¿°éœ€æ±‚å¤–ï¼Œè¿˜è¦æœ‰æ¯”è¾ƒé«˜çš„æŸ¥æ‰¾æ•ˆç‡ã€‚å¸¸è§çš„æ•°æ®ç»“æ„ï¼š</p>
<table>
<thead>
<tr>
<th align="left">æ•°æ®ç»“æ„</th>
<th align="left">æŸ¥æ‰¾æ—¶é—´å¤æ‚åº¦</th>
<th align="left">æ˜¯å¦æ»¡è¶³è·¯ç”±åŒ¹é…4ç‚¹è¦æ±‚</th>
</tr>
</thead>
<tbody><tr>
<td align="left">æ•°æ®ç»„</td>
<td align="left">O(n)</td>
<td align="left">æ»¡è¶³ï¼ŒåŒ¹é…éƒ½éœ€è¦éå†ï¼Œæ—¶é—´å¤æ‚åº¦O(n)</td>
</tr>
<tr>
<td align="left">å“ˆå¸Œè¡¨</td>
<td align="left">O(1)</td>
<td align="left">æ»¡è¶³ï¼ŒåŠ¨æ€è·¯ç”±åŒ¹é…éœ€è¦éå†ï¼Œæ—¶é—´å¤æ‚åº¦O(n)</td>
</tr>
<tr>
<td align="left">é˜Ÿåˆ—</td>
<td align="left">O(n)</td>
<td align="left">æ»¡è¶³ï¼ŒåŒ¹é…éƒ½éœ€è¦éå†ï¼Œæ—¶é—´å¤æ‚åº¦O(n)</td>
</tr>
<tr>
<td align="left">æ ˆ</td>
<td align="left">O(n)</td>
<td align="left">æ»¡è¶³ï¼ŒåŒ¹é…éƒ½éœ€è¦éå†ï¼Œæ—¶é—´å¤æ‚åº¦O(n)</td>
</tr>
<tr>
<td align="left">é“¾è¡¨</td>
<td align="left">O(n)</td>
<td align="left">æ»¡è¶³ï¼ŒåŒ¹é…éƒ½éœ€è¦éå†ï¼Œæ—¶é—´å¤æ‚åº¦O(n)</td>
</tr>
<tr>
<td align="left">å †</td>
<td align="left">O(n)</td>
<td align="left">æ»¡è¶³ï¼ŒåŒ¹é…éƒ½éœ€è¦éå†ï¼Œæ—¶é—´å¤æ‚åº¦O(n)</td>
</tr>
<tr>
<td align="left">å›¾</td>
<td align="left">O(n^2)</td>
<td align="left">æ»¡è¶³ï¼ŒåŒ¹é…éƒ½éœ€è¦éå†ï¼Œæ—¶é—´å¤æ‚åº¦O(n)</td>
</tr>
<tr>
<td align="left">æ ‘</td>
<td align="left">O(logn)</td>
<td align="left">æ»¡è¶³ï¼ŒåŒ¹é…ä¸éœ€è¦éå†</td>
</tr>
</tbody></table>
<p>æ‰€ä»¥ï¼Œä»å¯¹æ¯”å¯ä»¥å¾—å‡ºæˆ‘ä»¬çš„é€‰å‹ç»“æœï¼Œé‚£å°±æ˜¯â€“æ ‘ã€‚äº†è§£æ ‘è¿™ä¸ªæ•°æ®ç»“æ„çš„äººéƒ½åº”è¯¥çŸ¥é“ï¼Œæ ‘çš„æŸ¥æ‰¾æ—¶é—´å¤æ‚åº¦å’Œæ ‘é«˜æ˜¯è´Ÿç›¸å…³çš„ï¼Œæ ‘é«˜è¶Šé«˜ï¼ŒæŸ¥æ‰¾çš„æ•ˆç‡è¶Šä½ï¼Œå½“æ ‘çš„å·¦å³å­æ ‘æåº¦ä¸å¹³è¡¡çš„æ—¶å€™ï¼Œå°±ä¼šé€€åŒ–ä¸ºé“¾è¡¨ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(n)ã€‚æ‰€ä»¥ï¼Œè¿˜éœ€è¦å¯¹æ ‘çš„ç»“æ„å’ŒèŠ‚ç‚¹ä¸Šå­˜å‚¨çš„æ•°æ®åšä¸€äº›è®¾è®¡å’Œä¼˜åŒ–ï¼Œæ¥æé«˜æŸ¥æ‰¾æ€§èƒ½ã€‚æˆ‘ä»¬å¯ä»¥å‚è€ƒä¸‹ginæ‰€é‡‡å–çš„æ–¹æ¡ˆâ€“httprouterã€‚æˆ‘çš„è¿™ç¯‡åšå®¢<a href="https://bugkillerpro.github.io/2022/06/22/uncatalog/cl4pdun8r0000rsr7bninemtl/">httprouteræºç è§£æ</a>åˆ†æäº†httprouterçš„æºç ï¼Œå¯ä»¥ç§»æ­¥æŸ¥é˜…ï¼Œåœ¨æ­¤å°±ä¸åšé‡å¤å™è¿°äº†ã€‚<br>æˆ‘ä»¬çš„lessä¹Ÿä¼šé‡‡ç”¨httprouterä½œä¸ºè·¯ç”±ç®¡ç†çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> methodTrees []methodTree</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> methodTree <span class="keyword">struct</span> &#123;</span><br><span class="line">    method <span class="keyword">string</span></span><br><span class="line">    root   *node</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> node <span class="keyword">struct</span> &#123;</span><br><span class="line">    path      <span class="keyword">string</span></span><br><span class="line">    indices   <span class="keyword">string</span></span><br><span class="line">    wildChild <span class="keyword">bool</span></span><br><span class="line">    nType     nodeType</span><br><span class="line">    priority  <span class="keyword">uint32</span></span><br><span class="line">    children  []*node <span class="comment">// child nodes, at most 1 :param style node at the end of the array</span></span><br><span class="line">    handlers  HandlersChain</span><br><span class="line">    fullPath  <span class="keyword">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="è®¾è®¡æ€æƒ³"><a href="#è®¾è®¡æ€æƒ³" class="headerlink" title="è®¾è®¡æ€æƒ³"></a>è®¾è®¡æ€æƒ³</h3><h4 id="1ï¼Œä¸€åˆ‡çš†æœåŠ¡"><a href="#1ï¼Œä¸€åˆ‡çš†æœåŠ¡" class="headerlink" title="1ï¼Œä¸€åˆ‡çš†æœåŠ¡"></a>1ï¼Œä¸€åˆ‡çš†æœåŠ¡</h4><p>ç†è§£è¿™ç§è®¾è®¡ï¼Œéœ€è¦å¯¹é¢å‘å¯¹è±¡ã€é¢å‘æ¥å£æœ‰ä¸€å®šçš„äº†è§£ï¼ŒåŒæ—¶ï¼Œå¦‚æœçœŸæ­£åº”ç”¨çš„ä¸šåŠ¡å¼€å‘ä¸­ï¼Œåˆéœ€è¦ä½ å¯¹DDDèƒ½å¤Ÿåšåˆ°èä¼šè´¯é€šã€‚<br>åœ¨lessæ¡†æ¶é‡Œé¢ï¼Œæˆ‘ä»¬å‡ ä¹æ‰€æœ‰çš„æ¨¡å—(é…ç½®ã€ç¼“å­˜ã€æ—¥å¿—å’ŒwebæœåŠ¡ç­‰)éƒ½ä¼šè¢«è®¾è®¡ä¸ºä¸€ç§æœåŠ¡ï¼ŒåŒ…æ‹¬ä½¿ç”¨æ–¹ï¼Œåœ¨åšä¸šåŠ¡å¼€å‘çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¹Ÿå»ºè®®æŒ‰åŠŸèƒ½æŠŠä¸šåŠ¡åˆ’åˆ†ä¸ºä¸åŒçš„æœåŠ¡æ¥è®¾è®¡ï¼Œç„¶åæŠŠè¿™äº›æœåŠ¡æ³¨å†Œåˆ°æˆ‘ä»¬æ¡†æ¶å®šä¹‰çš„æœåŠ¡å®¹å™¨ä¸­å°±å¯ä»¥ã€‚ å°±åƒå †ç§¯ç§¯æœ¨ï¼Œåªè¦æƒ³å¥½äº†ä¸€ä¸ªæœåŠ¡çš„æ¥å£ï¼Œæˆ‘ä»¬é€æ­¥å®ç°æœåŠ¡ä¹‹åï¼Œè¿™ä¸€ä¸ªæœåŠ¡å°±æ˜¯ä¸€å—ç§¯æœ¨ï¼Œä¹‹åå¯ä»¥ç”¨ç›¸åŒçš„æ€è·¯å®ç°å„ç§æœåŠ¡çš„ç§¯æœ¨å—ï¼Œç”¨å®ƒä»¬æ¥æ‹¼å‡ºæˆ‘ä»¬éœ€è¦çš„ä¸šåŠ¡é€»è¾‘ã€‚è¿™å°±æ˜¯â€œä¸€åˆ‡çš†æœåŠ¡â€æ€æƒ³å¸¦æ¥çš„ä¾¿åˆ©ã€‚</p>
<p>æ¡†æ¶æ–¹é¢ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// NewInstance å®šä¹‰äº†å¦‚ä½•åˆ›å»ºä¸€ä¸ªæ–°å®ä¾‹ï¼Œæ‰€æœ‰æœåŠ¡å®¹å™¨çš„åˆ›å»ºæœåŠ¡</span></span><br><span class="line"><span class="keyword">type</span> NewInstance <span class="function"><span class="keyword">func</span><span class="params">(...<span class="keyword">interface</span>&#123;&#125;)</span> <span class="params">(<span class="keyword">interface</span>&#123;&#125;, error)</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ServiceProvider å®šä¹‰ä¸€ä¸ªæœåŠ¡æä¾›è€…éœ€è¦å®ç°çš„æ¥å£</span></span><br><span class="line"><span class="keyword">type</span> ServiceProvider <span class="keyword">interface</span> &#123;</span><br><span class="line">	<span class="comment">// Register åœ¨æœåŠ¡å®¹å™¨ä¸­æ³¨å†Œäº†ä¸€ä¸ªå®ä¾‹åŒ–æœåŠ¡çš„æ–¹æ³•ï¼Œæ˜¯å¦åœ¨æ³¨å†Œçš„æ—¶å€™å°±å®ä¾‹åŒ–è¿™ä¸ªæœåŠ¡ï¼Œéœ€è¦å‚è€ƒIsDeferæ¥å£ã€‚</span></span><br><span class="line">	Register(Container) NewInstance</span><br><span class="line">	<span class="comment">// Boot åœ¨è°ƒç”¨å®ä¾‹åŒ–æœåŠ¡çš„æ—¶å€™ä¼šè°ƒç”¨ï¼Œå¯ä»¥æŠŠä¸€äº›å‡†å¤‡å·¥ä½œï¼šåŸºç¡€é…ç½®ï¼Œåˆå§‹åŒ–å‚æ•°çš„æ“ä½œæ”¾åœ¨è¿™ä¸ªé‡Œé¢ã€‚</span></span><br><span class="line">	<span class="comment">// å¦‚æœBootè¿”å›errorï¼Œæ•´ä¸ªæœåŠ¡å®ä¾‹åŒ–å°±ä¼šå®ä¾‹åŒ–å¤±è´¥ï¼Œè¿”å›é”™è¯¯</span></span><br><span class="line">	Boot(Container) error</span><br><span class="line">	<span class="comment">// IsDefer å†³å®šæ˜¯å¦åœ¨æ³¨å†Œçš„æ—¶å€™å®ä¾‹åŒ–è¿™ä¸ªæœåŠ¡ï¼Œå¦‚æœä¸æ˜¯æ³¨å†Œçš„æ—¶å€™å®ä¾‹åŒ–ï¼Œé‚£å°±æ˜¯åœ¨ç¬¬ä¸€æ¬¡makeçš„æ—¶å€™è¿›è¡Œå®ä¾‹åŒ–æ“ä½œ</span></span><br><span class="line">	<span class="comment">// falseè¡¨ç¤ºä¸éœ€è¦å»¶è¿Ÿå®ä¾‹åŒ–ï¼Œåœ¨æ³¨å†Œçš„æ—¶å€™å°±å®ä¾‹åŒ–ã€‚trueè¡¨ç¤ºå»¶è¿Ÿå®ä¾‹åŒ–</span></span><br><span class="line">	IsDefer() <span class="keyword">bool</span></span><br><span class="line">	<span class="comment">// Params paramså®šä¹‰ä¼ é€’ç»™NewInstanceçš„å‚æ•°ï¼Œå¯ä»¥è‡ªå®šä¹‰å¤šä¸ªï¼Œå»ºè®®å°†containerä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°</span></span><br><span class="line">	Params(Container) []<span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">	<span class="comment">// Name ä»£è¡¨äº†è¿™ä¸ªæœåŠ¡æä¾›è€…çš„å‡­è¯</span></span><br><span class="line">	Name() <span class="keyword">string</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>æ—¥å¿—provider,å®ç°provideræ¥å£æä¾›å„ç§log service:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// LogServiceProvider æœåŠ¡æä¾›è€…</span></span><br><span class="line"><span class="keyword">type</span> LogServiceProvider <span class="keyword">struct</span> &#123;</span><br><span class="line">	framework.ServiceProvider</span><br><span class="line"></span><br><span class="line">	Driver <span class="keyword">string</span> <span class="comment">// Driver</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// æ—¥å¿—çº§åˆ«</span></span><br><span class="line">	Level contract.LogLevel</span><br><span class="line">	<span class="comment">// æ—¥å¿—è¾“å‡ºæ ¼å¼æ–¹æ³•</span></span><br><span class="line">	Formatter contract.Formatter</span><br><span class="line">	<span class="comment">// æ—¥å¿—contextä¸Šä¸‹æ–‡ä¿¡æ¯è·å–å‡½æ•°</span></span><br><span class="line">	CtxFielder contract.CtxFielder</span><br><span class="line">	<span class="comment">// æ—¥å¿—è¾“å‡ºä¿¡æ¯</span></span><br><span class="line">	Output io.Writer</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>ä¸šåŠ¡æ–¹é¢ï¼Œå®ç°provideræ¥å£æä¾›å„ç§ä¸šåŠ¡service:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> DemoProvider <span class="keyword">struct</span> &#123;</span><br><span class="line">	framework.ServiceProvider</span><br><span class="line"></span><br><span class="line">	c framework.Container</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(sp *DemoProvider)</span> <span class="title">Name</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> DemoKey</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(sp *DemoProvider)</span> <span class="title">Register</span><span class="params">(c framework.Container)</span> <span class="title">framework</span>.<span class="title">NewInstance</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> NewService</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(sp *DemoProvider)</span> <span class="title">IsDefer</span><span class="params">()</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(sp *DemoProvider)</span> <span class="title">Params</span><span class="params">(c framework.Container)</span> []<span class="title">interface</span></span>&#123;&#125; &#123;</span><br><span class="line">	<span class="keyword">return</span> []<span class="keyword">interface</span>&#123;&#125;&#123;sp.c&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(sp *DemoProvider)</span> <span class="title">Boot</span><span class="params">(c framework.Container)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">	sp.c = c</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
<h4 id="2ï¼ŒæœåŠ¡å®¹å™¨"><a href="#2ï¼ŒæœåŠ¡å®¹å™¨" class="headerlink" title="2ï¼ŒæœåŠ¡å®¹å™¨"></a>2ï¼ŒæœåŠ¡å®¹å™¨</h4><p>è®¾è®¡è¯¦è§æ³¨é‡Š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Container æ˜¯ä¸€ä¸ªæœåŠ¡å®¹å™¨ï¼Œæä¾›ç»‘å®šæœåŠ¡å’Œè·å–æœåŠ¡çš„åŠŸèƒ½</span></span><br><span class="line"><span class="keyword">type</span> Container <span class="keyword">interface</span> &#123;</span><br><span class="line">	<span class="comment">// Bind ç»‘å®šä¸€ä¸ªæœåŠ¡æä¾›è€…ï¼Œå¦‚æœå…³é”®å­—å‡­è¯å·²ç»å­˜åœ¨ï¼Œä¼šè¿›è¡Œæ›¿æ¢æ“ä½œï¼Œè¿”å›error</span></span><br><span class="line">	Bind(provider ServiceProvider) error</span><br><span class="line">	<span class="comment">// IsBind å…³é”®å­—å‡­è¯æ˜¯å¦å·²ç»ç»‘å®šæœåŠ¡æä¾›è€…</span></span><br><span class="line">	IsBind(key <span class="keyword">string</span>) <span class="keyword">bool</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// Make æ ¹æ®å…³é”®å­—å‡­è¯è·å–ä¸€ä¸ªæœåŠ¡ï¼Œ</span></span><br><span class="line">	Make(key <span class="keyword">string</span>) (<span class="keyword">interface</span>&#123;&#125;, error)</span><br><span class="line">	<span class="comment">// MustMake æ ¹æ®å…³é”®å­—å‡­è¯è·å–ä¸€ä¸ªæœåŠ¡ï¼Œå¦‚æœè¿™ä¸ªå…³é”®å­—å‡­è¯æœªç»‘å®šæœåŠ¡æä¾›è€…ï¼Œé‚£ä¹ˆä¼španicã€‚</span></span><br><span class="line">	<span class="comment">// æ‰€ä»¥åœ¨ä½¿ç”¨è¿™ä¸ªæ¥å£çš„æ—¶å€™è¯·ä¿è¯æœåŠ¡å®¹å™¨å·²ç»ä¸ºè¿™ä¸ªå…³é”®å­—å‡­è¯ç»‘å®šäº†æœåŠ¡æä¾›è€…ã€‚</span></span><br><span class="line">	MustMake(key <span class="keyword">string</span>) <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">	<span class="comment">// MakeNew æ ¹æ®å…³é”®å­—å‡­è¯è·å–ä¸€ä¸ªæœåŠ¡ï¼Œåªæ˜¯è¿™ä¸ªæœåŠ¡å¹¶ä¸æ˜¯å•ä¾‹æ¨¡å¼çš„</span></span><br><span class="line">	<span class="comment">// å®ƒæ˜¯æ ¹æ®æœåŠ¡æä¾›è€…æ³¨å†Œçš„å¯åŠ¨å‡½æ•°å’Œä¼ é€’çš„paramså‚æ•°å®ä¾‹åŒ–å‡ºæ¥çš„</span></span><br><span class="line">	<span class="comment">// è¿™ä¸ªå‡½æ•°åœ¨éœ€è¦ä¸ºä¸åŒå‚æ•°å¯åŠ¨ä¸åŒå®ä¾‹çš„æ—¶å€™éå¸¸æœ‰ç”¨</span></span><br><span class="line">	MakeNew(key <span class="keyword">string</span>, params []<span class="keyword">interface</span>&#123;&#125;) (<span class="keyword">interface</span>&#123;&#125;, error)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<h4 id="3ï¼Œå‘½ä»¤å·¥å…·"><a href="#3ï¼Œå‘½ä»¤å·¥å…·" class="headerlink" title="3ï¼Œå‘½ä»¤å·¥å…·"></a>3ï¼Œå‘½ä»¤å·¥å…·</h4><p>lesså¼•å…¥è‘—åçš„cobraåº“æ¥å®ç°æ‰©å±•å‘½ä»¤è¡ŒåŠŸèƒ½,Cronã€CronSpecså’Œcontainerä½¿æˆ‘ä»¬æ–°åŠ å…¥çš„å®šåˆ¶åŒ–åŠŸèƒ½ã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Command <span class="keyword">struct</span> &#123;</span><br><span class="line">	<span class="comment">// Commandæ”¯æŒcronï¼Œåªåœ¨RootCommandä¸­æœ‰è¿™ä¸ªå€¼</span></span><br><span class="line">	Cron *cron.Cron</span><br><span class="line">	<span class="comment">// å¯¹åº”Cronå‘½ä»¤çš„è¯´æ˜æ–‡æ¡£</span></span><br><span class="line">	CronSpecs []CronSpec</span><br><span class="line"></span><br><span class="line">	<span class="comment">// æœåŠ¡å®¹å™¨</span></span><br><span class="line">	container Container</span><br><span class="line">	<span class="comment">// Use is the one-line usage message.</span></span><br><span class="line">	<span class="comment">// Recommended syntax is as follow:</span></span><br><span class="line">	<span class="comment">//   [ ] identifies an optional argument. Arguments that are not enclosed in brackets are required.</span></span><br><span class="line">	<span class="comment">//   ... indicates that you can specify multiple values for the previous argument.</span></span><br><span class="line">	<span class="comment">//   |   indicates mutually exclusive information. You can use the argument to the left of the separator or the</span></span><br><span class="line">	<span class="comment">//       argument to the right of the separator. You cannot use both arguments in a single use of the command.</span></span><br><span class="line">	<span class="comment">//   &#123; &#125; delimits a set of mutually exclusive arguments when one of the arguments is required. If the arguments are</span></span><br><span class="line">	<span class="comment">//       optional, they are enclosed in brackets ([ ]).</span></span><br><span class="line">	<span class="comment">// Example: add [-F file | -D dir]... [-f format] profile</span></span><br><span class="line">	Use <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// Aliases is an array of aliases that can be used instead of the first word in Use.</span></span><br><span class="line">	Aliases []<span class="keyword">string</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// SuggestFor is an array of command names for which this command will be suggested -</span></span><br><span class="line">	<span class="comment">// similar to aliases but only suggests.</span></span><br><span class="line">	SuggestFor []<span class="keyword">string</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// Short is the short description shown in the &#x27;help&#x27; output.</span></span><br><span class="line">	Short <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// Long is the long message shown in the &#x27;help &lt;this-command&gt;&#x27; output.</span></span><br><span class="line">	Long <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// Example is examples of how to use the command.</span></span><br><span class="line">	Example <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// ValidArgs is list of all valid non-flag arguments that are accepted in shell completions</span></span><br><span class="line">	ValidArgs []<span class="keyword">string</span></span><br><span class="line">	<span class="comment">// ValidArgsFunction is an optional function that provides valid non-flag arguments for shell completion.</span></span><br><span class="line">	<span class="comment">// It is a dynamic version of using ValidArgs.</span></span><br><span class="line">	<span class="comment">// Only one of ValidArgs and ValidArgsFunction can be used for a command.</span></span><br><span class="line">	ValidArgsFunction <span class="function"><span class="keyword">func</span><span class="params">(cmd *Command, args []<span class="keyword">string</span>, toComplete <span class="keyword">string</span>)</span> <span class="params">([]<span class="keyword">string</span>, ShellCompDirective)</span></span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// Expected arguments</span></span><br><span class="line">	Args PositionalArgs</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ArgAliases is List of aliases for ValidArgs.</span></span><br><span class="line">	<span class="comment">// These are not suggested to the user in the shell completion,</span></span><br><span class="line">	<span class="comment">// but accepted if entered manually.</span></span><br><span class="line">	ArgAliases []<span class="keyword">string</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// BashCompletionFunction is custom bash functions used by the legacy bash autocompletion generator.</span></span><br><span class="line">	<span class="comment">// For portability with other shells, it is recommended to instead use ValidArgsFunction</span></span><br><span class="line">	BashCompletionFunction <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// Deprecated defines, if this command is deprecated and should print this string when used.</span></span><br><span class="line">	Deprecated <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// Annotations are key/value pairs that can be used by applications to identify or</span></span><br><span class="line">	<span class="comment">// group commands.</span></span><br><span class="line">	Annotations <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">string</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// Version defines the version for this command. If this value is non-empty and the command does not</span></span><br><span class="line">	<span class="comment">// define a &quot;version&quot; flag, a &quot;version&quot; boolean flag will be added to the command and, if specified,</span></span><br><span class="line">	<span class="comment">// will print content of the &quot;Version&quot; variable. A shorthand &quot;v&quot; flag will also be added if the</span></span><br><span class="line">	<span class="comment">// command does not define one.</span></span><br><span class="line">	Version <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// The *Run functions are executed in the following order:</span></span><br><span class="line">	<span class="comment">//   * PersistentPreRun()</span></span><br><span class="line">	<span class="comment">//   * PreRun()</span></span><br><span class="line">	<span class="comment">//   * Run()</span></span><br><span class="line">	<span class="comment">//   * PostRun()</span></span><br><span class="line">	<span class="comment">//   * PersistentPostRun()</span></span><br><span class="line">	<span class="comment">// All functions get the same args, the arguments after the command name.</span></span><br><span class="line">	<span class="comment">//</span></span><br><span class="line">	<span class="comment">// PersistentPreRun: children of this command will inherit and execute.</span></span><br><span class="line">	PersistentPreRun <span class="function"><span class="keyword">func</span><span class="params">(cmd *Command, args []<span class="keyword">string</span>)</span></span></span><br><span class="line">	<span class="comment">// PersistentPreRunE: PersistentPreRun but returns an error.</span></span><br><span class="line">	PersistentPreRunE <span class="function"><span class="keyword">func</span><span class="params">(cmd *Command, args []<span class="keyword">string</span>)</span> <span class="title">error</span></span></span><br><span class="line">	<span class="comment">// PreRun: children of this command will not inherit.</span></span><br><span class="line">	PreRun <span class="function"><span class="keyword">func</span><span class="params">(cmd *Command, args []<span class="keyword">string</span>)</span></span></span><br><span class="line">	<span class="comment">// PreRunE: PreRun but returns an error.</span></span><br><span class="line">	PreRunE <span class="function"><span class="keyword">func</span><span class="params">(cmd *Command, args []<span class="keyword">string</span>)</span> <span class="title">error</span></span></span><br><span class="line">	<span class="comment">// Run: Typically the actual work function. Most commands will only implement this.</span></span><br><span class="line">	Run <span class="function"><span class="keyword">func</span><span class="params">(cmd *Command, args []<span class="keyword">string</span>)</span></span></span><br><span class="line">	<span class="comment">// RunE: Run but returns an error.</span></span><br><span class="line">	RunE <span class="function"><span class="keyword">func</span><span class="params">(cmd *Command, args []<span class="keyword">string</span>)</span> <span class="title">error</span></span></span><br><span class="line">	<span class="comment">// PostRun: run after the Run command.</span></span><br><span class="line">	PostRun <span class="function"><span class="keyword">func</span><span class="params">(cmd *Command, args []<span class="keyword">string</span>)</span></span></span><br><span class="line">	<span class="comment">// PostRunE: PostRun but returns an error.</span></span><br><span class="line">	PostRunE <span class="function"><span class="keyword">func</span><span class="params">(cmd *Command, args []<span class="keyword">string</span>)</span> <span class="title">error</span></span></span><br><span class="line">	<span class="comment">// PersistentPostRun: children of this command will inherit and execute after PostRun.</span></span><br><span class="line">	PersistentPostRun <span class="function"><span class="keyword">func</span><span class="params">(cmd *Command, args []<span class="keyword">string</span>)</span></span></span><br><span class="line">	<span class="comment">// PersistentPostRunE: PersistentPostRun but returns an error.</span></span><br><span class="line">	PersistentPostRunE <span class="function"><span class="keyword">func</span><span class="params">(cmd *Command, args []<span class="keyword">string</span>)</span> <span class="title">error</span></span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// args is actual args parsed from flags.</span></span><br><span class="line">	args []<span class="keyword">string</span></span><br><span class="line">	<span class="comment">// flagErrorBuf contains all error messages from pflag.</span></span><br><span class="line">	flagErrorBuf *bytes.Buffer</span><br><span class="line">	<span class="comment">// flags is full set of flags.</span></span><br><span class="line">	flags *flag.FlagSet</span><br><span class="line">	<span class="comment">// pflags contains persistent flags.</span></span><br><span class="line">	pflags *flag.FlagSet</span><br><span class="line">	<span class="comment">// lflags contains local flags.</span></span><br><span class="line">	lflags *flag.FlagSet</span><br><span class="line">	<span class="comment">// iflags contains inherited flags.</span></span><br><span class="line">	iflags *flag.FlagSet</span><br><span class="line">	<span class="comment">// parentsPflags is all persistent flags of cmd&#x27;s parents.</span></span><br><span class="line">	parentsPflags *flag.FlagSet</span><br><span class="line">	<span class="comment">// globNormFunc is the global normalization function</span></span><br><span class="line">	<span class="comment">// that we can use on every pflag set and children commands</span></span><br><span class="line">	globNormFunc <span class="function"><span class="keyword">func</span><span class="params">(f *flag.FlagSet, name <span class="keyword">string</span>)</span> <span class="title">flag</span>.<span class="title">NormalizedName</span></span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// usageFunc is usage func defined by user.</span></span><br><span class="line">	usageFunc <span class="function"><span class="keyword">func</span><span class="params">(*Command)</span> <span class="title">error</span></span></span><br><span class="line">	<span class="comment">// usageTemplate is usage template defined by user.</span></span><br><span class="line">	usageTemplate <span class="keyword">string</span></span><br><span class="line">	<span class="comment">// flagErrorFunc is func defined by user and it&#x27;s called when the parsing of</span></span><br><span class="line">	<span class="comment">// flags returns an error.</span></span><br><span class="line">	flagErrorFunc <span class="function"><span class="keyword">func</span><span class="params">(*Command, error)</span> <span class="title">error</span></span></span><br><span class="line">	<span class="comment">// helpTemplate is help template defined by user.</span></span><br><span class="line">	helpTemplate <span class="keyword">string</span></span><br><span class="line">	<span class="comment">// helpFunc is help func defined by user.</span></span><br><span class="line">	helpFunc <span class="function"><span class="keyword">func</span><span class="params">(*Command, []<span class="keyword">string</span>)</span></span></span><br><span class="line">	<span class="comment">// helpCommand is command with usage &#x27;help&#x27;. If it&#x27;s not defined by user,</span></span><br><span class="line">	<span class="comment">// cobra uses default help command.</span></span><br><span class="line">	helpCommand *Command</span><br><span class="line">	<span class="comment">// versionTemplate is the version template defined by user.</span></span><br><span class="line">	versionTemplate <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// inReader is a reader defined by the user that replaces stdin</span></span><br><span class="line">	inReader io.Reader</span><br><span class="line">	<span class="comment">// outWriter is a writer defined by the user that replaces stdout</span></span><br><span class="line">	outWriter io.Writer</span><br><span class="line">	<span class="comment">// errWriter is a writer defined by the user that replaces stderr</span></span><br><span class="line">	errWriter io.Writer</span><br><span class="line"></span><br><span class="line">	<span class="comment">//FParseErrWhitelist flag parse errors to be ignored</span></span><br><span class="line">	FParseErrWhitelist FParseErrWhitelist</span><br><span class="line"></span><br><span class="line">	<span class="comment">// CompletionOptions is a set of options to control the handling of shell completion</span></span><br><span class="line">	CompletionOptions CompletionOptions</span><br><span class="line"></span><br><span class="line">	<span class="comment">// commandsAreSorted defines, if command slice are sorted or not.</span></span><br><span class="line">	commandsAreSorted <span class="keyword">bool</span></span><br><span class="line">	<span class="comment">// commandCalledAs is the name or alias value used to call this command.</span></span><br><span class="line">	commandCalledAs <span class="keyword">struct</span> &#123;</span><br><span class="line">		name   <span class="keyword">string</span></span><br><span class="line">		called <span class="keyword">bool</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	ctx context.Context</span><br><span class="line"></span><br><span class="line">	<span class="comment">// commands is the list of commands supported by this program.</span></span><br><span class="line">	commands []*Command</span><br><span class="line">	<span class="comment">// parent is a parent command for this command.</span></span><br><span class="line">	parent *Command</span><br><span class="line">	<span class="comment">// Max lengths of commands&#x27; string lengths for use in padding.</span></span><br><span class="line">	commandsMaxUseLen         <span class="keyword">int</span></span><br><span class="line">	commandsMaxCommandPathLen <span class="keyword">int</span></span><br><span class="line">	commandsMaxNameLen        <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// TraverseChildren parses flags on all parents before executing child command.</span></span><br><span class="line">	TraverseChildren <span class="keyword">bool</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// Hidden defines, if this command is hidden and should NOT show up in the list of available commands.</span></span><br><span class="line">	Hidden <span class="keyword">bool</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// SilenceErrors is an option to quiet errors down stream.</span></span><br><span class="line">	SilenceErrors <span class="keyword">bool</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// SilenceUsage is an option to silence usage when an error occurs.</span></span><br><span class="line">	SilenceUsage <span class="keyword">bool</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// DisableFlagParsing disables the flag parsing.</span></span><br><span class="line">	<span class="comment">// If this is true all flags will be passed to the command as arguments.</span></span><br><span class="line">	DisableFlagParsing <span class="keyword">bool</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// DisableAutoGenTag defines, if gen tag (&quot;Auto generated by spf13/cobra...&quot;)</span></span><br><span class="line">	<span class="comment">// will be printed by generating docs for this command.</span></span><br><span class="line">	DisableAutoGenTag <span class="keyword">bool</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// DisableFlagsInUseLine will disable the addition of [flags] to the usage</span></span><br><span class="line">	<span class="comment">// line of a command when printing help or generating docs</span></span><br><span class="line">	DisableFlagsInUseLine <span class="keyword">bool</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// DisableSuggestions disables the suggestions based on Levenshtein distance</span></span><br><span class="line">	<span class="comment">// that go along with &#x27;unknown command&#x27; messages.</span></span><br><span class="line">	DisableSuggestions <span class="keyword">bool</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// SuggestionsMinimumDistance defines minimum levenshtein distance to display suggestions.</span></span><br><span class="line">	<span class="comment">// Must be &gt; 0.</span></span><br><span class="line">	SuggestionsMinimumDistance <span class="keyword">int</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>å¾—ç›Šäºä¸€åˆ‡çš†æœåŠ¡çš„è®¾è®¡ï¼Œåœ¨lessä¸­ï¼Œç»“åˆå‘½ä»¤å·¥å…·ï¼Œä½ å¯ä»¥é€šè¿‡å‘½ä»¤æ“ä½œä¸€åˆ‡æœåŠ¡ï¼Œæ¯”å¦‚ï¼šå¯åŠ¨ã€åœæ­¢ã€æŸ¥è¯¢å’Œé‡å¯webã€‚</p>
<h4 id="4ï¼Œè‡ªåŠ¨åŒ–"><a href="#4ï¼Œè‡ªåŠ¨åŒ–" class="headerlink" title="4ï¼Œè‡ªåŠ¨åŒ–"></a>4ï¼Œè‡ªåŠ¨åŒ–</h4><blockquote>
<p>donâ€™t repeat yourselfï¼ŒæŠŠä¸€åˆ‡é‡å¤æ€§çš„åŠ³åŠ¨è‡ªåŠ¨åŒ–ã€‚</p>
</blockquote>
<h5 id="4-1ï¼Œè°ƒè¯•æ¨¡å¼"><a href="#4-1ï¼Œè°ƒè¯•æ¨¡å¼" class="headerlink" title="4.1ï¼Œè°ƒè¯•æ¨¡å¼"></a>4.1ï¼Œè°ƒè¯•æ¨¡å¼</h5><p>è°ƒè¯•æ¨¡å¼ä¸‹ï¼Œç›‘æ§æ–‡ä»¶ä¿®æ”¹ï¼Œè‡ªåŠ¨ç¼–è¯‘ï¼Œè‡ªåŠ¨è¿è¡Œã€‚</p>
<h5 id="4-2ï¼Œå…¼å®¹vueï¼Œå‰åç«¯ä¸€ä½“åŒ–"><a href="#4-2ï¼Œå…¼å®¹vueï¼Œå‰åç«¯ä¸€ä½“åŒ–" class="headerlink" title="4.2ï¼Œå…¼å®¹vueï¼Œå‰åç«¯ä¸€ä½“åŒ–"></a>4.2ï¼Œå…¼å®¹vueï¼Œå‰åç«¯ä¸€ä½“åŒ–</h5><p>å¯¹äºwebæ¡†æ¶æ¥è¯´ï¼Œè¿™ä¸€ç‚¹å¹¶ä¸æ˜¯åˆšéœ€ï¼Œä½†æ˜¯å¯¹äºåšåè¿ç»´/è¿è¥ä¾§äº§å“å¼€å‘çš„åŒå­¦æ¥è¯´ï¼Œéå¸¸å¾—å¿…è¦ã€‚</p>
<h5 id="4-3ï¼Œå‘å¸ƒè‡ªåŠ¨åŒ–"><a href="#4-3ï¼Œå‘å¸ƒè‡ªåŠ¨åŒ–" class="headerlink" title="4.3ï¼Œå‘å¸ƒè‡ªåŠ¨åŒ–"></a>4.3ï¼Œå‘å¸ƒè‡ªåŠ¨åŒ–</h5><p>è¿™ä¸€ç‚¹ä¹Ÿä¸æ˜¯åˆšéœ€ã€‚æœ‰å¾ˆå¤šæ–¹å¼å¯ä»¥å°†ä¸€ä¸ªæœåŠ¡è¿›è¡Œè‡ªåŠ¨åŒ–éƒ¨ç½²ï¼Œæ¯”å¦‚ç°åœ¨æ¯”è¾ƒæµè¡Œçš„ Docker åŒ–æˆ–è€… CI/CD æµç¨‹ã€‚ ä½†æ˜¯ä¸€äº›æ¯”è¾ƒä¸ªäººæ¯”è¾ƒå°çš„é¡¹ç›®ï¼Œæ¯”å¦‚ä¸€ä¸ªåšå®¢ã€ä¸€ä¸ªå®˜ç½‘ç½‘ç«™ï¼Œè¿™äº›éƒ¨ç½²æµç¨‹å¾€å¾€éƒ½å¤ªåºå¤§äº†ï¼Œæ›´éœ€è¦ä¸€ä¸ªæœåŠ¡ï¼Œèƒ½å¿«é€Ÿå°†åœ¨å¼€å‘æœºå™¨ä¸Šå†™å¥½ã€è°ƒè¯•å¥½çš„ç¨‹åºä¸Šä¼ åˆ°ç›®æ ‡æœåŠ¡å™¨ï¼Œå¹¶ä¸”æ›´æ–°åº”ç”¨ç¨‹åºã€‚</p>
<h5 id="4-4ï¼Œå…¶ä»–ä¸€ç³»åˆ—è‡ªåŠ¨åŒ–å·¥å…·"><a href="#4-4ï¼Œå…¶ä»–ä¸€ç³»åˆ—è‡ªåŠ¨åŒ–å·¥å…·" class="headerlink" title="4.4ï¼Œå…¶ä»–ä¸€ç³»åˆ—è‡ªåŠ¨åŒ–å·¥å…·"></a>4.4ï¼Œå…¶ä»–ä¸€ç³»åˆ—è‡ªåŠ¨åŒ–å·¥å…·</h5><ul>
<li>è‡ªåŠ¨åŒ–åˆ›å»ºæœåŠ¡å·¥å…·</li>
<li>è‡ªåŠ¨åŒ–åˆ›å»ºå‘½ä»¤è¡Œå·¥å…·</li>
<li>è‡ªåŠ¨åŒ–ginä¸­é—´ä»¶è¿ç§»å·¥å…·</li>
<li>è‡ªåŠ¨åŒ–lessè„šæ‰‹æ¶å·¥å…·</li>
</ul>
<h3 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h3><p>talk is cheap,ç›´æ¥çœ‹ä»£ç å§ï¼Œæ³¨é‡Šéå¸¸å‹å¥½</p>
<h3 id="quick-start"><a href="#quick-start" class="headerlink" title="quick start"></a>quick start</h3><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;github.com/BugKillerPro/less/app/console&quot;</span></span><br><span class="line">    <span class="string">&quot;github.com/BugKillerPro/less/app/http&quot;</span></span><br><span class="line">    <span class="string">&quot;github.com/BugKillerPro/less/framework&quot;</span></span><br><span class="line">    <span class="string">&quot;github.com/BugKillerPro/less/framework/provider/app&quot;</span></span><br><span class="line">    <span class="string">&quot;github.com/BugKillerPro/less/framework/provider/kernel&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–æœåŠ¡å®¹å™¨</span></span><br><span class="line">    container := framework.NewlessContainer()</span><br><span class="line">    <span class="comment">// ç»‘å®šAppæœåŠ¡æä¾›è€…</span></span><br><span class="line">    container.Bind(&amp;app.LessAppProvider&#123;&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†HTTPå¼•æ“åˆå§‹åŒ–,å¹¶ä¸”ä½œä¸ºæœåŠ¡æä¾›è€…ç»‘å®šåˆ°æœåŠ¡å®¹å™¨ä¸­</span></span><br><span class="line">    <span class="keyword">if</span> engine, err := http.NewHttpEngine(container); err == <span class="literal">nil</span> &#123;</span><br><span class="line">        container.Bind(&amp;kernel.LessKernelProvider&#123;HttpEngine: engine&#125;)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿è¡Œrootå‘½ä»¤</span></span><br><span class="line">    console.RunCommand(container)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>end</p>
<p><em><strong>å‚è€ƒ</strong></em></p>
<blockquote>
<p><a href="https://bugkillerpro.github.io/2022/06/16/uncatalog/cl4gopymv00009or79u472iwp/">Contextè®¾è®¡æ€æƒ³åŠä½¿ç”¨å®è·µ</a></p>
<p><a href="https://bugkillerpro.github.io/2022/06/17/uncatalog/cl4i43q7u00005sr70tpnfrfg/">é¢å‘å¯¹è±¡è®¾è®¡å…­å¤§åŸåˆ™</a></p>
<p><a href="https://bugkillerpro.github.io/2022/06/22/uncatalog/cl4pdun8r0000rsr7bninemtl/">httprouteræºç è§£æ</a></p>
</blockquote>
]]></content>
      <tags>
        <tag>æ‰‹æ’¸ä¸€ä¸ªwebæ¡†æ¶</tag>
      </tags>
  </entry>
  <entry>
    <title>ç«¯å£ç›‘å¬æƒ…å†µexporterå¼€å‘å®è·µ</title>
    <url>/2022/06/15/uncatalog/cl4fbnh440000bgr72qu68h03/</url>
    <content><![CDATA[<hr>
<span id="more"></span>

<blockquote>
<p>å…³äºcustom exporterçš„å¼€å‘æ–¹æ³•ï¼Œå‰é¢ä¸¤ç¯‡æ–‡ç« å·²ç»è®²å¾—å¾ˆæ¸…æ¥šäº†ï¼Œä»Šå¤©ç»“åˆå®é™…åº”ç”¨åœºæ™¯ï¼Œå¼€å‘ä¸€ä¸ªå¼€ç®±å³ç”¨çš„port exporter.</p>
</blockquote>
<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p> å¼€å§‹é˜…è¯»è¿™ç¯‡æ–‡ç« ä¹‹å‰ï¼Œéœ€è¦ä½ å¯¹linuxç³»ç»Ÿæœ‰ä¸€å®šçš„ç†è§£ï¼Œå¹¶ä¸”ç†è§£ä»¥ä¸‹å‡ ä¸ªæ–‡ä»¶/ç›®å½•çš„ç”¨é€”ã€‚</p>
<ul>
<li>/proc/net/tcp</li>
<li>/proc/pid/fd </li>
</ul>
<p>è¿™éƒ¨åˆ†å†…å®¹ç¯‡å¹…è¿‡é•¿ï¼Œéœ€è¦è¯»è€…è‡ªå·±å»å­¦ä¹ ç†è§£ã€‚æœ¬ç¯‡æ–‡ç« ä¸»è¦è®²è¿°port exporterçš„å¼€å‘ã€‚</p>
<h3 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h3><h4 id="ç›®å½•ç»“æ„"><a href="#ç›®å½•ç»“æ„" class="headerlink" title="ç›®å½•ç»“æ„"></a>ç›®å½•ç»“æ„</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">exporter/</span><br><span class="line">â”œâ”€â”€ collector</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ port.go</span><br><span class="line">â”‚Â Â  â””â”€â”€ port_test.go</span><br><span class="line">â”œâ”€â”€ go.mod</span><br><span class="line">â”œâ”€â”€ go.sum</span><br><span class="line">â”œâ”€â”€ main.go</span><br><span class="line">â”œâ”€â”€ metrics</span><br><span class="line">â”‚Â Â  â””â”€â”€ port</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ port.go</span><br><span class="line">â”‚Â Â      â”œâ”€â”€ port_linux.go</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p><code>main.go</code></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;exporter/collector&quot;</span></span><br><span class="line">	<span class="string">&quot;fmt&quot;</span></span><br><span class="line">	prom <span class="string">&quot;github.com/prometheus/client_golang/prometheus&quot;</span></span><br><span class="line">	<span class="string">&quot;github.com/prometheus/client_golang/prometheus/promhttp&quot;</span></span><br><span class="line">	<span class="string">&quot;net/http&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	prom.MustRegister(collector.NewCustomPortCollector())</span><br><span class="line">	http.Handle(<span class="string">&quot;/metrics&quot;</span>, promhttp.Handler())</span><br><span class="line">	<span class="keyword">if</span> err := http.ListenAndServe(<span class="string">&quot;:8088&quot;</span>, <span class="literal">nil</span>); err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Printf(<span class="string">&quot;Error occur when start custom collector on %v %v&quot;</span>,collector.HostName, err)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>æ ¹æ®å‰ä¸¤ç¯‡è®²çš„exporterå¼€å‘å¥—è·¯ï¼Œè¿™é‡Œçš„mainå‡½æ•°éå¸¸ç®€å•ï¼Œåªéœ€è¦æš´éœ²ä¸€ä¸ªå›ºå®šçš„urlç»™prometheusè®¿é—®å³å¯ã€‚å¦å¤–ï¼Œç›®å‰è¯¥custom exporteråªæœ‰ä¸€ä¸ªport exporteråŠŸèƒ½ï¼Œæ‰€ä»¥ä¸éœ€è¦åšå…¶ä»–çš„è¿‡åº¦ã€è¶…å‰è®¾è®¡ï¼Œé‡ç‚¹åœ¨äºport exporterçš„åŠŸèƒ½å®ç°å’Œæ€§èƒ½ä¸Šã€‚</p>
<h4 id="æ ¸å¿ƒä»£ç "><a href="#æ ¸å¿ƒä»£ç " class="headerlink" title="æ ¸å¿ƒä»£ç "></a>æ ¸å¿ƒä»£ç </h4><p>ä»£ç åœ°å€â€“<a href="https://github.com/BugKillerPro/exporter">custom exporter</a></p>
<p>é‡‡é›†ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p PortCollector)</span> <span class="title">Collect</span><span class="params">(c <span class="keyword">chan</span>&lt;- prometheus.Metric)</span></span> &#123;</span><br><span class="line">	tabs, err := port.TCPSockets(<span class="function"><span class="keyword">func</span><span class="params">(s *port.SocketEntry)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">		<span class="keyword">return</span> s.State == port.Listen</span><br><span class="line">	&#125;)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	lookup := <span class="function"><span class="keyword">func</span><span class="params">(skaddr *port.SocketAddr)</span> <span class="title">string</span></span> &#123;</span><br><span class="line">		<span class="keyword">const</span> IPv4Strlen = <span class="number">17</span></span><br><span class="line">		addr := skaddr.IP.String()</span><br><span class="line">		names, err := net.LookupAddr(addr)</span><br><span class="line">		<span class="keyword">if</span> err == <span class="literal">nil</span> &amp;&amp; <span class="built_in">len</span>(names) &gt; <span class="number">0</span> &#123;</span><br><span class="line">			addr = names[<span class="number">0</span>]</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> <span class="built_in">len</span>(addr) &gt; IPv4Strlen &#123;</span><br><span class="line">			addr = addr[:IPv4Strlen]</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> fmt.Sprintf(<span class="string">&quot;%s:%d&quot;</span>, addr, skaddr.Port)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> _, e := <span class="keyword">range</span> tabs &#123;</span><br><span class="line">		exec := <span class="string">&quot;&quot;</span></span><br><span class="line">		<span class="keyword">if</span> e.Process != <span class="literal">nil</span> &#123;</span><br><span class="line">			exec = e.Process.ExecName()</span><br><span class="line">		&#125;</span><br><span class="line">		saddr := lookup(e.LocalAddr)</span><br><span class="line">		c &lt;- prometheus.MustNewConstMetric(</span><br><span class="line">			prometheus.NewDesc(</span><br><span class="line">				<span class="string">&quot;custom_port_exporter&quot;</span>,</span><br><span class="line">				<span class="string">&quot;custom_port_exporter scrape node port state info&quot;</span>,</span><br><span class="line">				[]<span class="keyword">string</span>&#123;<span class="string">&quot;host&quot;</span>,<span class="string">&quot;app&quot;</span>,<span class="string">&quot;port&quot;</span>,<span class="string">&quot;state&quot;</span>,<span class="string">&quot;pid&quot;</span>&#125;,</span><br><span class="line">				<span class="literal">nil</span>,</span><br><span class="line">			),</span><br><span class="line">			prometheus.UntypedValue,</span><br><span class="line">			e.Process.PidFloatValue(),</span><br><span class="line">			[]<span class="keyword">string</span>&#123; HostName, exec, <span class="string">&quot;tcp &quot;</span>+saddr, e.State.String(), e.Process.PidValue()&#125;...,</span><br><span class="line">		)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>è¿™ä¸ªæ–¹æ³•çš„æ ¸å¿ƒæ˜¯<code>port.TCPSockets</code>ï¼Œç»è¿‡å±‚å±‚ç©¿é€ï¼Œ<code>port.TCPSockets</code>ä¸»è¦å®ç°æ˜¯ä¾èµ–<code>metrics/port/port_linux.go</code>çš„<code>netstat(path string, fn filterFunc) ([]SocketEntry, error)</code>:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">netstat</span><span class="params">(path <span class="keyword">string</span>, fn filterFunc)</span> <span class="params">([]SocketEntry, error)</span></span> &#123;</span><br><span class="line">	f, err := os.Open(path)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">	&#125;</span><br><span class="line">	tabs, err := readSocket(f, fn)</span><br><span class="line">	f.Close()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">	&#125;</span><br><span class="line">	getPidAndExec(tabs)</span><br><span class="line">	<span class="keyword">return</span> tabs, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>å…¶ä¸­ï¼Œ<code>readSocket</code>ä¸»è¦æ˜¯å®ç°å¯¹<code>/proc/net/tcp</code>çš„è¯»å–å’Œè§£æã€‚å†…å®¹ç»“æ„å‚è€ƒè¿™è¾¹åˆ†æ<a href="https://guanjunjian.github.io/2017/11/09/study-8-proc-net-tcp-analysis/">æ–‡ç« </a>,å…·ä½“çš„è§£æè¿‡ç¨‹ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">readSocket</span><span class="params">(r io.Reader, accept filterFunc)</span> <span class="params">([]SocketEntry, error)</span></span> &#123;</span><br><span class="line">	br := bufio.NewScanner(r)</span><br><span class="line">	tab := <span class="built_in">make</span>([]SocketEntry, <span class="number">0</span>, <span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Discard title</span></span><br><span class="line">	br.Scan()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> br.Scan() &#123;</span><br><span class="line">		<span class="keyword">var</span> e SocketEntry</span><br><span class="line">		line := br.Text()</span><br><span class="line">		<span class="comment">// Skip comments</span></span><br><span class="line">		<span class="keyword">if</span> i := strings.Index(line, <span class="string">&quot;#&quot;</span>); i &gt;= <span class="number">0</span> &#123;</span><br><span class="line">			line = line[:i]</span><br><span class="line">		&#125;</span><br><span class="line">		fields := strings.Fields(line)</span><br><span class="line">		<span class="keyword">if</span> <span class="built_in">len</span>(fields) &lt; <span class="number">12</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">nil</span>, fmt.Errorf(<span class="string">&quot;netstat: not enough fields: %v, %v&quot;</span>, <span class="built_in">len</span>(fields), fields)</span><br><span class="line">		&#125;</span><br><span class="line">		addr, err := parseAddr(fields[<span class="number">1</span>])</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">		&#125;</span><br><span class="line">		e.LocalAddr = addr</span><br><span class="line">		addr, err = parseAddr(fields[<span class="number">2</span>])</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">		&#125;</span><br><span class="line">		e.RemoteAddr = addr</span><br><span class="line">		u, err := strconv.ParseUint(fields[<span class="number">3</span>], <span class="number">16</span>, <span class="number">8</span>)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">		&#125;</span><br><span class="line">		e.State = SocketState(u)</span><br><span class="line">		u, err = strconv.ParseUint(fields[<span class="number">7</span>], <span class="number">10</span>, <span class="number">32</span>)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">		&#125;</span><br><span class="line">		e.UID = <span class="keyword">uint32</span>(u)</span><br><span class="line">		e.ino = fields[<span class="number">9</span>]</span><br><span class="line">		<span class="keyword">if</span> accept(&amp;e) &#123;</span><br><span class="line">			tab = <span class="built_in">append</span>(tab, e)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> tab, br.Err()</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
<p><code>getPidAndExec</code>ä¸»è¦æ˜¯å®ç°å¯¹<code>/proc/pid/fd </code>çš„è¯»å–å’Œè§£æã€‚å†…å®¹ç»“æ„å‚è€ƒè¿™è¾¹åˆ†æ<a href="https://blog.csdn.net/enweitech/article/details/53391567">æ–‡ç« </a>,å…·ä½“çš„è§£æè¿‡ç¨‹ä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *procFd)</span> <span class="title">readFdDir</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="comment">// link name is of the form socket:[5860846]</span></span><br><span class="line">	fddir := path.Join(p.base, <span class="string">&quot;/fd&quot;</span>)</span><br><span class="line">	fi, err := ioutil.ReadDir(fddir)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">var</span> buf [<span class="number">128</span>]<span class="keyword">byte</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> _, file := <span class="keyword">range</span> fi &#123;</span><br><span class="line">		fd := path.Join(fddir, file.Name())</span><br><span class="line">		lname, err := os.Readlink(fd)</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> || !strings.HasPrefix(lname, sockPrefix) &#123;</span><br><span class="line">			<span class="keyword">continue</span></span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> i := <span class="keyword">range</span> p.sktab &#123;</span><br><span class="line">			sk := &amp;p.sktab[i]</span><br><span class="line">			ss := sockPrefix + sk.ino + <span class="string">&quot;]&quot;</span></span><br><span class="line">			<span class="keyword">if</span> ss != lname &#123;</span><br><span class="line">				<span class="keyword">continue</span></span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">if</span> p.p == <span class="literal">nil</span> &#123;</span><br><span class="line">				stat, err := os.Open(path.Join(p.base, <span class="string">&quot;stat&quot;</span>))</span><br><span class="line">				<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">					<span class="keyword">return</span></span><br><span class="line">				&#125;</span><br><span class="line">				n, err := stat.Read(buf[:])</span><br><span class="line">				stat.Close()</span><br><span class="line">				<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">					<span class="keyword">return</span></span><br><span class="line">				&#125;</span><br><span class="line">				z := bytes.SplitN(buf[:n], []<span class="keyword">byte</span>(<span class="string">&quot; &quot;</span>), <span class="number">3</span>)</span><br><span class="line">				name := getProcName(z[<span class="number">1</span>])</span><br><span class="line">				p.p = &amp;Proc&#123;p.pid, name&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			sk.Process = p.p</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><h4 id="æŸ¥çœ‹æ•°æ®ï¼Œè®¿é—®ip-8088-metrics-å¦‚æœèƒ½çœ‹ç±»ä¼¼ä»¥ä¸‹çš„æ•°æ®ï¼Œåˆ™æ­£å¸¸ï¼š"><a href="#æŸ¥çœ‹æ•°æ®ï¼Œè®¿é—®ip-8088-metrics-å¦‚æœèƒ½çœ‹ç±»ä¼¼ä»¥ä¸‹çš„æ•°æ®ï¼Œåˆ™æ­£å¸¸ï¼š" class="headerlink" title="æŸ¥çœ‹æ•°æ®ï¼Œè®¿é—®ip:8088/metrics,å¦‚æœèƒ½çœ‹ç±»ä¼¼ä»¥ä¸‹çš„æ•°æ®ï¼Œåˆ™æ­£å¸¸ï¼š"></a>æŸ¥çœ‹æ•°æ®ï¼Œè®¿é—®<code>ip:8088/metrics</code>,å¦‚æœèƒ½çœ‹ç±»ä¼¼ä»¥ä¸‹çš„æ•°æ®ï¼Œåˆ™æ­£å¸¸ï¼š</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="TEXT"><figure class="iseeu highlight /text"><table><tr><td class="code"><pre><span class="line">custom_port_exporter&#123;app=&quot;docker-proxy&quot;,host=&quot;ip&quot;,pid=&quot;1814&quot;,port=&quot;tcp 0.0.0.0:8080&quot;,state=&quot;10&quot;&#125; 1814</span><br><span class="line">custom_port_exporter&#123;app=&quot;etcd&quot;,host=&quot;ip&quot;,pid=&quot;3063&quot;,port=&quot;tcp localhost:2379&quot;,state=&quot;10&quot;&#125; 3063</span><br><span class="line">custom_port_exporter&#123;app=&quot;etcd&quot;,host=&quot;ip&quot;,pid=&quot;3063&quot;,port=&quot;tcp localhost:2381&quot;,state=&quot;10&quot;&#125; 3063</span><br></pre></td></tr></table></figure></div>
<h4 id="æŠŠport-exporterçš„ä¿¡æ¯åŠ å…¥åˆ°prometheusçš„é…ç½®æ–‡ä»¶"><a href="#æŠŠport-exporterçš„ä¿¡æ¯åŠ å…¥åˆ°prometheusçš„é…ç½®æ–‡ä»¶" class="headerlink" title="æŠŠport exporterçš„ä¿¡æ¯åŠ å…¥åˆ°prometheusçš„é…ç½®æ–‡ä»¶:"></a>æŠŠport exporterçš„ä¿¡æ¯åŠ å…¥åˆ°prometheusçš„é…ç½®æ–‡ä»¶:</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="YAML"><figure class="iseeu highlight /yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">scrape_configs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;custom exporter&#x27;</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">targets:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">localhost:8088</span></span><br></pre></td></tr></table></figure></div>
<p>ä»¥åå¦‚æœæœ‰å…¶ä»–å¥½ç©çš„éœ€æ±‚ï¼Œä¼šæŒç»­æ›´æ–°åˆ°<a href="https://github.com/BugKillerPro/exporter">custom exporter</a><br>(å®Œ)</p>
]]></content>
      <tags>
        <tag>prometheus</tag>
        <tag>æºç é˜…è¯»</tag>
        <tag>exporterå¼€å‘</tag>
      </tags>
  </entry>
  <entry>
    <title>Contextè®¾è®¡æ€æƒ³åŠä½¿ç”¨å®è·µ</title>
    <url>/2022/06/16/uncatalog/cl4gopymv00009or79u472iwp/</url>
    <content><![CDATA[<hr>
<span id="more"></span>

<hr>
<h3 id="å…ˆæŠ›å‡ºä¸€ä¸ªé—®é¢˜"><a href="#å…ˆæŠ›å‡ºä¸€ä¸ªé—®é¢˜" class="headerlink" title="å…ˆæŠ›å‡ºä¸€ä¸ªé—®é¢˜?"></a>å…ˆæŠ›å‡ºä¸€ä¸ªé—®é¢˜?</h3><p>åœ¨goçš„contextæºç ä¸­ï¼Œæœ‰è¿™æ ·ä¸€æ®µè¯ï¼š</p>
<blockquote>
<p>Do not store Contexts inside a struct type; instead, pass a Context<br>explicitly to each function that needs it. The Context should be the first<br>parameter, typically named ctx:</p>
<pre><code>func DoSomething(ctx context.Context, arg Arg) error &#123;
    // ... use ctx ...
</code></pre>
<p>   }</p>
</blockquote>
<p>ä¸ºä»€ä¹ˆä¼šæœ‰è¿™åŒæ ·çš„è§„å®šå‘¢ï¼Ÿçœ‹å®Œè¿™ç¯‡æ–‡ç« ï¼Œä½ å°±ä¼šæ‰¾åˆ°ç­”æ¡ˆã€‚</p>
<h3 id="Context"><a href="#Context" class="headerlink" title="Context"></a>Context</h3><blockquote>
<p>ä¸å»ºè®®ç¿»è¯‘ä¸ºï¼šä¸Šä¸‹æ–‡ã€‚æ¯•ç«Ÿè¯­å¢ƒå’Œè¯­ä¹‰å¹¶ä¸èƒ½ååˆ†å¥‘åˆ<code>ä¿¡é›…è¾¾</code>çš„ç¿»è¯‘æ ‡å‡†ã€‚</p>
</blockquote>
<p>context.Contextåœ¨Goè¯­è¨€ä¸­ç”¨æ¥è®¾ç½®æˆªæ­¢æ—¥æœŸã€åŒæ­¥ä¿¡å·ï¼Œä¼ é€’è¯·æ±‚ç›¸å…³å€¼çš„ç»“æ„ä½“ã€‚Contextä¸ Goroutine æœ‰æ¯”è¾ƒå¯†åˆ‡çš„å…³ç³»ï¼Œæ˜¯Goè¯­è¨€ä¸­ç‹¬ç‰¹çš„è®¾è®¡ï¼Œåœ¨å…¶ä»–ç¼–ç¨‹è¯­è¨€ä¸­æˆ‘ä»¬å¾ˆå°‘è§åˆ°ç±»ä¼¼çš„æ¦‚å¿µã€‚ context.Contextæ˜¯Goè¯­è¨€åœ¨1.7ç‰ˆæœ¬ä¸­å¼•å…¥æ ‡å‡†åº“çš„æ¥å£ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// å»æ‰æ³¨é‡Šä¹‹åçš„ç»“æ„</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Context <span class="keyword">interface</span> &#123;</span><br><span class="line">	Deadline() (deadline time.Time, ok <span class="keyword">bool</span>)</span><br><span class="line">	Done() &lt;-<span class="keyword">chan</span> <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line">	Err() error</span><br><span class="line">	Value(key <span class="keyword">interface</span>&#123;&#125;) <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>è¯¥æ¥å£å®šä¹‰äº†å››ä¸ªéœ€è¦å®ç°çš„æ–¹æ³•ï¼Œå…¶ä¸­åŒ…æ‹¬ï¼š</p>
<ul>
<li>Deadline â€” è¿”å› context.Context è¢«å–æ¶ˆçš„æ—¶é—´ï¼Œä¹Ÿå°±æ˜¯å®Œæˆå·¥ä½œçš„æˆªæ­¢æ—¥æœŸï¼›</li>
<li>Done â€” è¿”å›ä¸€ä¸ª Channelï¼Œè¿™ä¸ª Channel ä¼šåœ¨å½“å‰å·¥ä½œå®Œæˆæˆ–è€…contextè¢«å–æ¶ˆåå…³é—­ï¼Œå¤šæ¬¡è°ƒç”¨ Done æ–¹æ³•ä¼šè¿”å›åŒä¸€ä¸ª Channelï¼›</li>
<li>Err â€” è¿”å› context.Context ç»“æŸçš„åŸå› ï¼Œå®ƒåªä¼šåœ¨ Done æ–¹æ³•å¯¹åº”çš„ Channel å…³é—­æ—¶è¿”å›éç©ºçš„å€¼ï¼›<ul>
<li>å¦‚æœ context.Context è¢«å–æ¶ˆï¼Œä¼šè¿”å› Canceled é”™è¯¯ï¼›</li>
<li>å¦‚æœ context.Context è¶…æ—¶ï¼Œä¼šè¿”å› DeadlineExceeded é”™è¯¯ï¼›</li>
</ul>
</li>
<li>Value â€” ä» context.Context ä¸­è·å–é”®å¯¹åº”çš„å€¼ï¼Œå¯¹äºåŒä¸€ä¸ªcontextæ¥è¯´ï¼Œå¤šæ¬¡è°ƒç”¨ Value å¹¶ä¼ å…¥ç›¸åŒçš„ Key ä¼šè¿”å›ç›¸åŒçš„ç»“æœï¼Œè¯¥æ–¹æ³•å¯ä»¥ç”¨æ¥ä¼ é€’è¯·æ±‚ç‰¹å®šçš„æ•°æ®ï¼›</li>
</ul>
<p>context åŒ…ä¸­æä¾›çš„ context.Backgroundã€context.TODOã€context.WithDeadline å’Œ context.WithValue å‡½æ•°ä¼šè¿”å›å®ç°è¯¥æ¥å£çš„ç§æœ‰ç»“æ„ä½“ï¼Œæˆ‘ä»¬ä¼šåœ¨åé¢è¯¦ç»†ä»‹ç»å®ƒä»¬çš„å·¥ä½œåŸç†ï¼›</p>
<h3 id="è®¾è®¡åŸç†"><a href="#è®¾è®¡åŸç†" class="headerlink" title="è®¾è®¡åŸç†"></a>è®¾è®¡åŸç†</h3><p>åœ¨ Goroutine æ„æˆçš„æ ‘å½¢ç»“æ„ä¸­å¯¹ä¿¡å·è¿›è¡ŒåŒæ­¥ä»¥å‡å°‘è®¡ç®—èµ„æºçš„æµªè´¹æ˜¯ context.Context çš„æœ€å¤§ä½œç”¨ã€‚Go æœåŠ¡çš„æ¯ä¸€ä¸ªè¯·æ±‚éƒ½æ˜¯é€šè¿‡å•ç‹¬çš„ Goroutine å¤„ç†çš„2ï¼ŒHTTP/RPC è¯·æ±‚çš„å¤„ç†å™¨ä¼šå¯åŠ¨æ–°çš„ Goroutine è®¿é—®æ•°æ®åº“å’Œå…¶ä»–æœåŠ¡ã€‚</p>
<p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬å¯èƒ½ä¼šåˆ›å»ºå¤šä¸ª Goroutine æ¥å¤„ç†ä¸€æ¬¡è¯·æ±‚ï¼Œè€Œ context.Context çš„ä½œç”¨æ˜¯åœ¨ä¸åŒ Goroutine ä¹‹é—´åŒæ­¥è¯·æ±‚ç‰¹å®šæ•°æ®ã€å–æ¶ˆä¿¡å·ä»¥åŠå¤„ç†è¯·æ±‚çš„æˆªæ­¢æ—¥æœŸã€‚<br><img src="/2022/06/16/uncatalog/cl4gopymv00009or79u472iwp/1.png" alt="img"><br>æ¯ä¸€ä¸ª context.Context éƒ½ä¼šä»æœ€é¡¶å±‚çš„ Goroutine ä¸€å±‚ä¸€å±‚ä¼ é€’åˆ°æœ€ä¸‹å±‚ã€‚context.Context å¯ä»¥åœ¨ä¸Šå±‚ Goroutine æ‰§è¡Œå‡ºç°é”™è¯¯æ—¶ï¼Œå°†ä¿¡å·åŠæ—¶åŒæ­¥ç»™ä¸‹å±‚ã€‚<br><img src="/2022/06/16/uncatalog/cl4gopymv00009or79u472iwp/2.png" alt="img"><br>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå½“æœ€ä¸Šå±‚çš„ Goroutine å› ä¸ºæŸäº›åŸå› æ‰§è¡Œå¤±è´¥æ—¶ï¼Œä¸‹å±‚çš„ Goroutine ç”±äºæ²¡æœ‰æ¥æ”¶åˆ°è¿™ä¸ªä¿¡å·æ‰€ä»¥ä¼šç»§ç»­å·¥ä½œï¼›ä½†æ˜¯å½“æˆ‘ä»¬æ­£ç¡®åœ°ä½¿ç”¨ context.Context æ—¶ï¼Œå°±å¯ä»¥åœ¨ä¸‹å±‚åŠæ—¶åœæ‰æ— ç”¨çš„å·¥ä½œä»¥å‡å°‘é¢å¤–èµ„æºçš„æ¶ˆè€—ï¼š<br><img src="/2022/06/16/uncatalog/cl4gopymv00009or79u472iwp/3.png" alt="img"><br>æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ä¸ªä»£ç ç‰‡æ®µäº†è§£ context.Context æ˜¯å¦‚ä½•å¯¹ä¿¡å·è¿›è¡ŒåŒæ­¥çš„ã€‚åœ¨è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªè¿‡æœŸæ—¶é—´ä¸º 1s çš„Contextï¼Œå¹¶å‘contextä¼ å…¥ handle å‡½æ•°ï¼Œè¯¥æ–¹æ³•ä¼šä½¿ç”¨ 500ms çš„æ—¶é—´å¤„ç†ä¼ å…¥çš„è¯·æ±‚ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	ctx, cancel := context.WithTimeout(context.Background(), <span class="number">1</span>*time.Second)</span><br><span class="line">	<span class="keyword">defer</span> cancel()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">go</span> handle(ctx, <span class="number">500</span>*time.Millisecond)</span><br><span class="line">	<span class="keyword">select</span> &#123;</span><br><span class="line">	<span class="keyword">case</span> &lt;-ctx.Done():</span><br><span class="line">		fmt.Println(<span class="string">&quot;main&quot;</span>, ctx.Err())</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">handle</span><span class="params">(ctx context.Context, duration time.Duration)</span></span> &#123;</span><br><span class="line">	<span class="keyword">select</span> &#123;</span><br><span class="line">	<span class="keyword">case</span> &lt;-ctx.Done():</span><br><span class="line">		fmt.Println(<span class="string">&quot;handle&quot;</span>, ctx.Err())</span><br><span class="line">	<span class="keyword">case</span> &lt;-time.After(duration):</span><br><span class="line">		fmt.Println(<span class="string">&quot;process request with&quot;</span>, duration)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>å› ä¸ºè¿‡æœŸæ—¶é—´å¤§äºå¤„ç†æ—¶é—´ï¼Œæ‰€ä»¥æˆ‘ä»¬æœ‰è¶³å¤Ÿçš„æ—¶é—´å¤„ç†è¯¥è¯·æ±‚ï¼Œè¿è¡Œä¸Šè¿°ä»£ç ä¼šæ‰“å°å‡ºä¸‹é¢çš„å†…å®¹ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> go run context.go</span></span><br><span class="line">process request with 500ms</span><br><span class="line">main context deadline exceeded</span><br></pre></td></tr></table></figure></div>
<p>handle å‡½æ•°æ²¡æœ‰è¿›å…¥è¶…æ—¶çš„ select åˆ†æ”¯ï¼Œä½†æ˜¯ main å‡½æ•°çš„ select å´ä¼šç­‰å¾… context.Context è¶…æ—¶å¹¶æ‰“å°å‡º main context deadline exceededã€‚</p>
<p>å¦‚æœæˆ‘ä»¬å°†å¤„ç†è¯·æ±‚æ—¶é—´å¢åŠ è‡³ 1500msï¼Œæ•´ä¸ªç¨‹åºéƒ½ä¼šå› ä¸ºContextçš„è¿‡æœŸè€Œè¢«ä¸­æ­¢ï¼Œï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> go run context.go</span></span><br><span class="line">main context deadline exceeded</span><br><span class="line">handle context deadline exceeded</span><br></pre></td></tr></table></figure></div>
<p>ç›¸ä¿¡è¿™ä¸¤ä¸ªä¾‹å­èƒ½å¤Ÿå¸®åŠ©å„ä½è¯»è€…ç†è§£ context.Context çš„ä½¿ç”¨æ–¹æ³•å’Œè®¾è®¡åŸç† â€” å¤šä¸ª Goroutine åŒæ—¶è®¢é˜… ctx.Done() ç®¡é“ä¸­çš„æ¶ˆæ¯ï¼Œä¸€æ—¦æ¥æ”¶åˆ°å–æ¶ˆä¿¡å·å°±ç«‹åˆ»åœæ­¢å½“å‰æ­£åœ¨æ‰§è¡Œçš„å·¥ä½œã€‚</p>
<h3 id="é»˜è®¤contextçš„ä½¿ç”¨"><a href="#é»˜è®¤contextçš„ä½¿ç”¨" class="headerlink" title="é»˜è®¤contextçš„ä½¿ç”¨"></a>é»˜è®¤contextçš„ä½¿ç”¨</h3><p>context åŒ…ä¸­æœ€å¸¸ç”¨çš„æ–¹æ³•è¿˜æ˜¯ context.Backgroundã€context.TODOï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•éƒ½ä¼šè¿”å›é¢„å…ˆåˆå§‹åŒ–å¥½çš„ç§æœ‰å˜é‡ background å’Œ todoï¼Œå®ƒä»¬ä¼šåœ¨åŒä¸€ä¸ª Go ç¨‹åºä¸­è¢«å¤ç”¨ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">background = <span class="built_in">new</span>(emptyCtx)</span><br><span class="line">todo       = <span class="built_in">new</span>(emptyCtx)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Background</span><span class="params">()</span> <span class="title">Context</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> background</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">TODO</span><span class="params">()</span> <span class="title">Context</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> todo</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>è¿™ä¸¤ä¸ªç§æœ‰å˜é‡éƒ½æ˜¯é€šè¿‡ new(emptyCtx) è¯­å¥åˆå§‹åŒ–çš„ï¼Œå®ƒä»¬æ˜¯æŒ‡å‘ç§æœ‰ç»“æ„ä½“ context.emptyCtx çš„æŒ‡é’ˆï¼Œè¿™æ˜¯æœ€ç®€å•ã€æœ€å¸¸ç”¨çš„contextç±»å‹</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> emptyCtx <span class="keyword">int</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(*emptyCtx)</span> <span class="title">Deadline</span><span class="params">()</span> <span class="params">(deadline time.Time, ok <span class="keyword">bool</span>)</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(*emptyCtx)</span> <span class="title">Done</span><span class="params">()</span> &lt;-<span class="title">chan</span> <span class="title">struct</span></span>&#123;&#125; &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(*emptyCtx)</span> <span class="title">Err</span><span class="params">()</span> <span class="title">error</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(*emptyCtx)</span> <span class="title">Value</span><span class="params">(key <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">interface</span></span>&#123;&#125; &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>ä»ä¸Šè¿°ä»£ç ä¸­ï¼Œæˆ‘ä»¬ä¸éš¾å‘ç° context.emptyCtx é€šè¿‡ç©ºæ–¹æ³•å®ç°äº† context.Context æ¥å£ä¸­çš„æ‰€æœ‰æ–¹æ³•ï¼Œå®ƒæ²¡æœ‰ä»»ä½•åŠŸèƒ½ã€‚<br><img src="/2022/06/16/uncatalog/cl4gopymv00009or79u472iwp/4.png" alt="img"></p>
<p>ä»æºä»£ç æ¥çœ‹ï¼Œcontext.Background å’Œ context.TODO ä¹Ÿåªæ˜¯äº’ä¸ºåˆ«åï¼Œæ²¡æœ‰å¤ªå¤§çš„å·®åˆ«ï¼Œåªæ˜¯åœ¨ä½¿ç”¨å’Œè¯­ä¹‰ä¸Šç¨æœ‰ä¸åŒï¼š</p>
<ul>
<li>context.Background æ˜¯contextçš„é»˜è®¤å€¼ï¼Œæ‰€æœ‰å…¶ä»–çš„contextéƒ½åº”è¯¥ä»å®ƒè¡ç”Ÿå‡ºæ¥ï¼›</li>
<li>context.TODO åº”è¯¥ä»…åœ¨ä¸ç¡®å®šåº”è¯¥ä½¿ç”¨å“ªç§contextæ—¶ä½¿ç”¨ï¼›</li>
</ul>
<p>åœ¨å¤šæ•°æƒ…å†µä¸‹ï¼Œå¦‚æœå½“å‰å‡½æ•°æ²¡æœ‰contextä½œä¸ºå…¥å‚ï¼Œæˆ‘ä»¬éƒ½ä¼šä½¿ç”¨ context.Background ä½œä¸ºèµ·å§‹çš„contextå‘ä¸‹ä¼ é€’ã€‚</p>
<h3 id="å–æ¶ˆä¿¡å·"><a href="#å–æ¶ˆä¿¡å·" class="headerlink" title="å–æ¶ˆä¿¡å·"></a>å–æ¶ˆä¿¡å·</h3><p>context.WithCancel å‡½æ•°èƒ½å¤Ÿä» context.Context ä¸­è¡ç”Ÿå‡ºä¸€ä¸ªæ–°çš„å­contextå¹¶è¿”å›ç”¨äºå–æ¶ˆè¯¥contextçš„å‡½æ•°ã€‚ä¸€æ—¦æˆ‘ä»¬æ‰§è¡Œè¿”å›çš„å–æ¶ˆå‡½æ•°ï¼Œå½“å‰contextä»¥åŠå®ƒçš„å­contextéƒ½ä¼šè¢«å–æ¶ˆï¼Œæ‰€æœ‰çš„ Goroutine éƒ½ä¼šåŒæ­¥æ”¶åˆ°è¿™ä¸€å–æ¶ˆä¿¡å·ã€‚<br><img src="/2022/06/16/uncatalog/cl4gopymv00009or79u472iwp/5.png" alt="img"></p>
<h4 id="Context-å­æ ‘çš„å–æ¶ˆ"><a href="#Context-å­æ ‘çš„å–æ¶ˆ" class="headerlink" title="Context å­æ ‘çš„å–æ¶ˆ"></a>Context å­æ ‘çš„å–æ¶ˆ</h4><p>æˆ‘ä»¬ç›´æ¥ä» context.WithCancel å‡½æ•°çš„å®ç°æ¥çœ‹å®ƒåˆ°åº•åšäº†ä»€ä¹ˆï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithCancel</span><span class="params">(parent Context)</span> <span class="params">(ctx Context, cancel CancelFunc)</span></span> &#123;</span><br><span class="line">	c := newCancelCtx(parent)</span><br><span class="line">	propagateCancel(parent, &amp;c)</span><br><span class="line">	<span class="keyword">return</span> &amp;c, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; c.cancel(<span class="literal">true</span>, Canceled) &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<ul>
<li>context.newCancelCtx å°†ä¼ å…¥çš„contextåŒ…è£…æˆç§æœ‰ç»“æ„ä½“ context.cancelCtxï¼› </li>
<li>context.propagateCancel ä¼šæ„å»ºçˆ¶å­contextä¹‹é—´çš„å…³è”ï¼Œå½“çˆ¶contextè¢«å–æ¶ˆæ—¶ï¼Œå­contextä¹Ÿä¼šè¢«å–æ¶ˆï¼š</li>
</ul>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">propagateCancel</span><span class="params">(parent Context, child canceler)</span></span> &#123;</span><br><span class="line">	done := parent.Done()</span><br><span class="line">	<span class="keyword">if</span> done == <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="comment">// çˆ¶contextä¸ä¼šè§¦å‘å–æ¶ˆä¿¡å·</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">select</span> &#123;</span><br><span class="line">	<span class="keyword">case</span> &lt;-done:</span><br><span class="line">		child.cancel(<span class="literal">false</span>, parent.Err()) <span class="comment">// çˆ¶contextå·²ç»è¢«å–æ¶ˆ</span></span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	<span class="keyword">default</span>:</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> p, ok := parentCancelCtx(parent); ok &#123;</span><br><span class="line">		p.mu.Lock()</span><br><span class="line">		<span class="keyword">if</span> p.err != <span class="literal">nil</span> &#123;</span><br><span class="line">			child.cancel(<span class="literal">false</span>, p.err)</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			p.children[child] = <span class="keyword">struct</span>&#123;&#125;&#123;&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		p.mu.Unlock()</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">			<span class="keyword">select</span> &#123;</span><br><span class="line">			<span class="keyword">case</span> &lt;-parent.Done():</span><br><span class="line">				child.cancel(<span class="literal">false</span>, parent.Err())</span><br><span class="line">			<span class="keyword">case</span> &lt;-child.Done():</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;()</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>ä¸Šè¿°å‡½æ•°æ€»å…±ä¸çˆ¶contextç›¸å…³çš„ä¸‰ç§ä¸åŒçš„æƒ…å†µï¼š</p>
<ul>
<li>å½“ parent.Done() == nilï¼Œä¹Ÿå°±æ˜¯ parent ä¸ä¼šè§¦å‘å–æ¶ˆäº‹ä»¶æ—¶ï¼Œå½“å‰å‡½æ•°ä¼šç›´æ¥è¿”å›ï¼›</li>
<li>å½“ child çš„ç»§æ‰¿é“¾åŒ…å«å¯ä»¥å–æ¶ˆçš„contextæ—¶ï¼Œä¼šåˆ¤æ–­ parent æ˜¯å¦å·²ç»è§¦å‘äº†å–æ¶ˆä¿¡å·ï¼› <ul>
<li>å¦‚æœå·²ç»è¢«å–æ¶ˆï¼Œchild ä¼šç«‹åˆ»è¢«å–æ¶ˆï¼›</li>
<li>å¦‚æœæ²¡æœ‰è¢«å–æ¶ˆï¼Œchild ä¼šè¢«åŠ å…¥ parent çš„ children åˆ—è¡¨ä¸­ï¼Œç­‰å¾… parent é‡Šæ”¾å–æ¶ˆä¿¡å·ï¼›</li>
</ul>
</li>
<li>å½“çˆ¶contextæ˜¯å¼€å‘è€…è‡ªå®šä¹‰çš„ç±»å‹ã€å®ç°äº† context.Context æ¥å£å¹¶åœ¨ Done() æ–¹æ³•ä¸­è¿”å›äº†éç©ºçš„ç®¡é“æ—¶ï¼›<ul>
<li>è¿è¡Œä¸€ä¸ªæ–°çš„ Goroutine åŒæ—¶ç›‘å¬ parent.Done() å’Œ child.Done() ä¸¤ä¸ª Channelï¼›</li>
<li>åœ¨ parent.Done() å…³é—­æ—¶è°ƒç”¨ child.cancel å–æ¶ˆå­contextï¼›</li>
</ul>
</li>
</ul>
<p>context.propagateCancel çš„ä½œç”¨æ˜¯åœ¨ parent å’Œ child ä¹‹é—´åŒæ­¥å–æ¶ˆå’Œç»“æŸçš„ä¿¡å·ï¼Œä¿è¯åœ¨ parent è¢«å–æ¶ˆæ—¶ï¼Œchild ä¹Ÿä¼šæ”¶åˆ°å¯¹åº”çš„ä¿¡å·ï¼Œä¸ä¼šå‡ºç°çŠ¶æ€ä¸ä¸€è‡´çš„æƒ…å†µã€‚<br>context.cancelCtx å®ç°çš„å‡ ä¸ªæ¥å£æ–¹æ³•ä¹Ÿæ²¡æœ‰å¤ªå¤šå€¼å¾—åˆ†æçš„åœ°æ–¹ï¼Œè¯¥ç»“æ„ä½“æœ€é‡è¦çš„æ–¹æ³•æ˜¯ context.cancelCtx.cancelï¼Œè¯¥æ–¹æ³•ä¼šå…³é—­contextä¸­çš„ Channel å¹¶å‘æ‰€æœ‰çš„å­contextåŒæ­¥å–æ¶ˆä¿¡å·ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *cancelCtx)</span> <span class="title">cancel</span><span class="params">(removeFromParent <span class="keyword">bool</span>, err error)</span></span> &#123;</span><br><span class="line">	c.mu.Lock()</span><br><span class="line">	<span class="keyword">if</span> c.err != <span class="literal">nil</span> &#123;</span><br><span class="line">		c.mu.Unlock()</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	c.err = err</span><br><span class="line">	<span class="keyword">if</span> c.done == <span class="literal">nil</span> &#123;</span><br><span class="line">		c.done = closedchan</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="built_in">close</span>(c.done)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> child := <span class="keyword">range</span> c.children &#123;</span><br><span class="line">		child.cancel(<span class="literal">false</span>, err)</span><br><span class="line">	&#125;</span><br><span class="line">	c.children = <span class="literal">nil</span></span><br><span class="line">	c.mu.Unlock()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> removeFromParent &#123;</span><br><span class="line">		removeChild(c.Context, c)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>é™¤äº† context.WithCancel ä¹‹å¤–ï¼Œcontext åŒ…ä¸­çš„å¦å¤–ä¸¤ä¸ªå‡½æ•° context.WithDeadline å’Œ context.WithTimeout ä¹Ÿéƒ½èƒ½åˆ›å»ºå¯ä»¥è¢«å–æ¶ˆçš„è®¡æ—¶å™¨context context.timerCtxï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithTimeout</span><span class="params">(parent Context, timeout time.Duration)</span> <span class="params">(Context, CancelFunc)</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> WithDeadline(parent, time.Now().Add(timeout))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithDeadline</span><span class="params">(parent Context, d time.Time)</span> <span class="params">(Context, CancelFunc)</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> cur, ok := parent.Deadline(); ok &amp;&amp; cur.Before(d) &#123;</span><br><span class="line">		<span class="keyword">return</span> WithCancel(parent)</span><br><span class="line">	&#125;</span><br><span class="line">	c := &amp;timerCtx&#123;</span><br><span class="line">		cancelCtx: newCancelCtx(parent),</span><br><span class="line">		deadline:  d,</span><br><span class="line">	&#125;</span><br><span class="line">	propagateCancel(parent, c)</span><br><span class="line">	dur := time.Until(d)</span><br><span class="line">	<span class="keyword">if</span> dur &lt;= <span class="number">0</span> &#123;</span><br><span class="line">		c.cancel(<span class="literal">true</span>, DeadlineExceeded) <span class="comment">// å·²ç»è¿‡äº†æˆªæ­¢æ—¥æœŸ</span></span><br><span class="line">		<span class="keyword">return</span> c, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; c.cancel(<span class="literal">false</span>, Canceled) &#125;</span><br><span class="line">	&#125;</span><br><span class="line">	c.mu.Lock()</span><br><span class="line">	<span class="keyword">defer</span> c.mu.Unlock()</span><br><span class="line">	<span class="keyword">if</span> c.err == <span class="literal">nil</span> &#123;</span><br><span class="line">		c.timer = time.AfterFunc(dur, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">			c.cancel(<span class="literal">true</span>, DeadlineExceeded)</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> c, <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123; c.cancel(<span class="literal">true</span>, Canceled) &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>context.WithDeadline åœ¨åˆ›å»º context.timerCtx çš„è¿‡ç¨‹ä¸­åˆ¤æ–­äº†çˆ¶contextçš„æˆªæ­¢æ—¥æœŸä¸å½“å‰æ—¥æœŸï¼Œå¹¶é€šè¿‡ time.AfterFunc åˆ›å»ºå®šæ—¶å™¨ï¼Œå½“æ—¶é—´è¶…è¿‡äº†æˆªæ­¢æ—¥æœŸåä¼šè°ƒç”¨ context.timerCtx.cancel åŒæ­¥å–æ¶ˆä¿¡å·ã€‚</p>
<p>context.timerCtx å†…éƒ¨ä¸ä»…é€šè¿‡åµŒå…¥ context.cancelCtx ç»“æ„ä½“ç»§æ‰¿äº†ç›¸å…³çš„å˜é‡å’Œæ–¹æ³•ï¼Œè¿˜é€šè¿‡æŒæœ‰çš„å®šæ—¶å™¨ timer å’Œæˆªæ­¢æ—¶é—´ deadline å®ç°äº†å®šæ—¶å–æ¶ˆçš„åŠŸèƒ½ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> timerCtx <span class="keyword">struct</span> &#123;</span><br><span class="line">	cancelCtx</span><br><span class="line">	timer *time.Timer <span class="comment">// Under cancelCtx.mu.</span></span><br><span class="line"></span><br><span class="line">	deadline time.Time</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *timerCtx)</span> <span class="title">Deadline</span><span class="params">()</span> <span class="params">(deadline time.Time, ok <span class="keyword">bool</span>)</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> c.deadline, <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *timerCtx)</span> <span class="title">cancel</span><span class="params">(removeFromParent <span class="keyword">bool</span>, err error)</span></span> &#123;</span><br><span class="line">	c.cancelCtx.cancel(<span class="literal">false</span>, err)</span><br><span class="line">	<span class="keyword">if</span> removeFromParent &#123;</span><br><span class="line">		removeChild(c.cancelCtx.Context, c)</span><br><span class="line">	&#125;</span><br><span class="line">	c.mu.Lock()</span><br><span class="line">	<span class="keyword">if</span> c.timer != <span class="literal">nil</span> &#123;</span><br><span class="line">		c.timer.Stop()</span><br><span class="line">		c.timer = <span class="literal">nil</span></span><br><span class="line">	&#125;</span><br><span class="line">	c.mu.Unlock()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œcontext.timerCtx.cancel æ–¹æ³•ä¸ä»…è°ƒç”¨äº† context.cancelCtx.cancelï¼Œè¿˜ä¼šåœæ­¢æŒæœ‰çš„å®šæ—¶å™¨å‡å°‘ä¸å¿…è¦çš„èµ„æºæµªè´¹ã€‚</p>
<h3 id="ä¼ å€¼æ–¹æ³•"><a href="#ä¼ å€¼æ–¹æ³•" class="headerlink" title="ä¼ å€¼æ–¹æ³•"></a>ä¼ å€¼æ–¹æ³•</h3><p>åœ¨æœ€åæˆ‘ä»¬éœ€è¦äº†è§£å¦‚ä½•ä½¿ç”¨contextä¼ å€¼ï¼Œcontext åŒ…ä¸­çš„ context.WithValue èƒ½ä»çˆ¶contextä¸­åˆ›å»ºä¸€ä¸ªå­contextï¼Œä¼ å€¼çš„å­contextä½¿ç”¨ context.valueCtx ç±»å‹</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithValue</span><span class="params">(parent Context, key, val <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">Context</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> key == <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(<span class="string">&quot;nil key&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> !reflectlite.TypeOf(key).Comparable() &#123;</span><br><span class="line">		<span class="built_in">panic</span>(<span class="string">&quot;key is not comparable&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> &amp;valueCtx&#123;parent, key, val&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>context.valueCtx ç»“æ„ä½“ä¼šå°†é™¤äº† Value ä¹‹å¤–çš„ Errã€Deadline ç­‰æ–¹æ³•ä»£ç†åˆ°çˆ¶contextä¸­ï¼Œå®ƒåªä¼šå“åº” context.valueCtx.Value æ–¹æ³•ï¼Œè¯¥æ–¹æ³•çš„å®ç°ä¹Ÿå¾ˆç®€å•ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> valueCtx <span class="keyword">struct</span> &#123;</span><br><span class="line">	Context</span><br><span class="line">	key, val <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *valueCtx)</span> <span class="title">Value</span><span class="params">(key <span class="keyword">interface</span>&#123;&#125;)</span> <span class="title">interface</span></span>&#123;&#125; &#123;</span><br><span class="line">	<span class="keyword">if</span> c.key == key &#123;</span><br><span class="line">		<span class="keyword">return</span> c.val</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> c.Context.Value(key)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>å¦‚æœ context.valueCtx ä¸­å­˜å‚¨çš„é”®å€¼å¯¹ä¸ context.valueCtx.Value æ–¹æ³•ä¸­ä¼ å…¥çš„å‚æ•°ä¸åŒ¹é…ï¼Œå°±ä¼šä»çˆ¶contextä¸­æŸ¥æ‰¾è¯¥é”®å¯¹åº”çš„å€¼ç›´åˆ°æŸä¸ªçˆ¶contextä¸­è¿”å› nil æˆ–è€…æŸ¥æ‰¾åˆ°å¯¹åº”çš„å€¼ã€‚</p>
<h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p>Go è¯­è¨€ä¸­çš„ context.Context çš„ä¸»è¦ä½œç”¨è¿˜æ˜¯åœ¨å¤šä¸ª Goroutine ç»„æˆçš„æ ‘ä¸­åŒæ­¥å–æ¶ˆä¿¡å·ä»¥å‡å°‘å¯¹èµ„æºçš„æ¶ˆè€—å’Œå ç”¨ï¼Œè™½ç„¶å®ƒä¹Ÿæœ‰ä¼ å€¼çš„åŠŸèƒ½ï¼Œä½†æ˜¯è¿™ä¸ªåŠŸèƒ½æˆ‘ä»¬è¿˜æ˜¯å¾ˆå°‘ç”¨åˆ°ã€‚</p>
<p>åœ¨çœŸæ­£ä½¿ç”¨ä¼ å€¼çš„åŠŸèƒ½æ—¶æˆ‘ä»¬ä¹Ÿåº”è¯¥éå¸¸è°¨æ…ï¼Œä½¿ç”¨ context.Context ä¼ é€’è¯·æ±‚çš„æ‰€æœ‰å‚æ•°ä¸€ç§éå¸¸å·®çš„è®¾è®¡ï¼Œæ¯”è¾ƒå¸¸è§çš„ä½¿ç”¨åœºæ™¯æ˜¯ä¼ é€’è¯·æ±‚å¯¹åº”ç”¨æˆ·çš„è®¤è¯ä»¤ç‰Œä»¥åŠç”¨äºè¿›è¡Œåˆ†å¸ƒå¼è¿½è¸ªçš„è¯·æ±‚ IDã€‚</p>
<h3 id="å¼€å¤´é—®é¢˜çš„è§£ç­”"><a href="#å¼€å¤´é—®é¢˜çš„è§£ç­”" class="headerlink" title="å¼€å¤´é—®é¢˜çš„è§£ç­”"></a>å¼€å¤´é—®é¢˜çš„è§£ç­”</h3><p>å…ˆå¯¹æ¯”ä¸‹ä»¥ä¸‹ä¸¤ç§æ–¹å¼ï¼š</p>
<h4 id="æ–¹å¼ä¸€ï¼šcontext-as-argumentæ–¹å¼"><a href="#æ–¹å¼ä¸€ï¼šcontext-as-argumentæ–¹å¼" class="headerlink" title="æ–¹å¼ä¸€ï¼šcontext-as-argumentæ–¹å¼"></a>æ–¹å¼ä¸€ï¼šcontext-as-argumentæ–¹å¼</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Worker fetches and adds works to a remote work orchestration server.</span></span><br><span class="line"><span class="keyword">type</span> Worker <span class="keyword">struct</span> &#123; <span class="comment">/* â€¦ */</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Work <span class="keyword">struct</span> &#123; <span class="comment">/* â€¦ */</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">New</span><span class="params">()</span> *<span class="title">Worker</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &amp;Worker&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(w *Worker)</span> <span class="title">Fetch</span><span class="params">(ctx context.Context)</span> <span class="params">(*Work, error)</span></span> &#123;</span><br><span class="line">  _ = ctx <span class="comment">// A per-call ctx is used for cancellation, deadlines, and metadata.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(w *Worker)</span> <span class="title">Process</span><span class="params">(ctx context.Context, work *Work)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">  _ = ctx <span class="comment">// A per-call ctx is used for cancellation, deadlines, and metadata.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<h4 id="æ–¹å¼äºŒï¼š-context-in-struct"><a href="#æ–¹å¼äºŒï¼š-context-in-struct" class="headerlink" title="æ–¹å¼äºŒï¼š context-in-struct"></a>æ–¹å¼äºŒï¼š context-in-struct</h4><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Worker <span class="keyword">struct</span> &#123;</span><br><span class="line">  ctx context.Context</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">New</span><span class="params">(ctx context.Context)</span> *<span class="title">Worker</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &amp;Worker&#123;ctx: ctx&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(w *Worker)</span> <span class="title">Fetch</span><span class="params">()</span> <span class="params">(*Work, error)</span></span> &#123;</span><br><span class="line">  _ = w.ctx <span class="comment">// A shared w.ctx is used for cancellation, deadlines, and metadata.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(w *Worker)</span> <span class="title">Process</span><span class="params">(work *Work)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">  _ = w.ctx <span class="comment">// A shared w.ctx is used for cancellation, deadlines, and metadata.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>ç»“è®ºï¼š</p>
<ul>
<li>æ–¹å¼ä¸€ä¼˜ç‚¹ï¼š<ul>
<li>æ–¹æ³•ç›´æ¥æ¥å—ä¸€ä¸ªcontextã€‚é€šè¿‡è¿™ç§ä¼ é€’å³å‚æ•°çš„è®¾è®¡ï¼Œç”¨æˆ·å¯ä»¥è®¾ç½®æ¯ä¸ªè°ƒç”¨çš„deadlinesã€cancellationå’Œmetadataã€‚</li>
<li>ä¼ é€’ç»™æ¯ä¸ªæ–¹æ³•çš„context.Contextå°†è¢«å¦‚ä½•ä½¿ç”¨æ˜¯å¾ˆæ¸…æ¥šçš„ï¼šä¸å­˜åœ¨ä¼ é€’ç»™ä¸€ä¸ªæ–¹æ³•çš„context.Contextä¼šè¢«å…¶ä»–æ–¹æ³•ä½¿ç”¨çš„æƒ…å†µã€‚ </li>
<li>contextçš„ä¼ é€’èŒƒå›´å‡ ä¹å’Œå®ƒå¿…é¡»è¢«ä½¿ç”¨çš„æ“ä½œèŒƒå›´ä¸€è‡´ï¼Œè¿™å¤§å¤§å¢åŠ äº†è¿™ä¸ªåŒ…ä¸­contextçš„æ•ˆç”¨å’Œæ¸…æ™°åº¦ã€‚</li>
</ul>
</li>
<li>æ–¹å¼äºŒç¼ºç‚¹ï¼š<ul>
<li>å½“ä½ å°†contextå­˜å‚¨åœ¨ä¸€ä¸ªstructä¸­æ—¶ï¼Œè°ƒç”¨è€…æ— æ³•æ§åˆ¶è¯¥contextçš„ç”Ÿå‘½å‘¨æœŸã€‚</li>
<li>è°ƒç”¨è€…æ— æ³•ä¸ºä¸‹æ¸¸<code>Fetch()</code>/<code>Process</code>è®¾ç½®deadlinesã€cancellationå’Œmetadataï¼Œæ— æ³•å¯¹ä¸‹æ¸¸è°ƒç”¨è®¾ç½®deadlinesã€cancellationæ§åˆ¶ã€‚</li>
<li>è°ƒç”¨è€…æœ¬èº«å¯èƒ½ä¹Ÿå­˜åœ¨contextï¼Œè¿™å°±ä¼šé€ æˆè°ƒç”¨è€…çš„contextå’Œè¢«è°ƒç”¨è€…<code>Work</code>ç»“æ„ä½“å†…çš„contextæ··æ·†ã€‚</li>
</ul>
</li>
</ul>
<p>ä½†æ˜¯é—®é¢˜åˆæ¥äº†ï¼š</p>
<p>1ï¼Œèªæ˜çš„ä½ è‚¯å®šå‘ç°äº†ï¼Œæ–¹å¼äºŒ<code>New</code>å¯ä»¥ä¼ ä¸€ä¸ªcontextç»™Workerï¼Œè¿™æ ·è°ƒç”¨Workerçš„ä¸¤ä¸ªæ–¹æ³•çš„æ—¶å€™ï¼Œå°±å¯ä»¥é¿å…ä¸Šé¢è¯´çš„æ–¹å¼äºŒçš„ç¼ºç‚¹ã€‚  </p>
<ul>
<li>è¿™ç§å®ç°æ–¹å¼ï¼Œéœ€è¦é…åˆç›¸å…³çš„æ–‡æ¡£è¯´æ˜ï¼Œæ¥å‘Šè¯‰è°ƒç”¨è€…æ€ä¹ˆä½¿ç”¨Workerã€‚</li>
<li>è°ƒç”¨è€…æ— æ³•æ ¹æ®Workerçš„æ–¹æ³•åç§°å’Œæ–¹æ³•å‚æ•°æ¥äº†è§£æ–¹æ³•çš„ä½œç”¨ï¼Œå¿…é¡»ä»¥æ¥æ–‡æ¡£ã€‚</li>
<li>æ— æ³•åšåˆ°æ–¹æ³•ä¸€ä¼˜ç‚¹çš„ç¬¬äºŒç‚¹å’Œç¬¬ä¸‰ç‚¹ã€‚</li>
</ul>
<p>2ï¼Œç†Ÿè¯»goæºç çš„ä½ å¯èƒ½ä¼šå‘ç°ï¼Œgoæ ‡å‡†åº“ä¸­å­˜åœ¨æ–¹å¼äºŒï¼šcontext-in-structçš„å®ç°ï¼Œæ¯”å¦‚ä¸‹é¢çš„æºç ï¼Œè¿™åˆæ˜¯æ€ä¹ˆå›äº‹å‘¢ï¼Ÿ</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// A Request represents an HTTP request received by a server or to be sent by a client.</span></span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="keyword">type</span> Request <span class="keyword">struct</span> &#123;</span><br><span class="line">  ctx context.Context</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// NewRequestWithContext returns a new Request given a method, URL, and optional</span></span><br><span class="line"><span class="comment">// body.</span></span><br><span class="line"><span class="comment">// [...]</span></span><br><span class="line"><span class="comment">// The given ctx is used for the lifetime of the Request.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewRequestWithContext</span><span class="params">(ctx context.Context, method, url <span class="keyword">string</span>, body io.Reader)</span> <span class="params">(*Request, error)</span></span> &#123;</span><br><span class="line">  <span class="comment">// Simplified for brevity of this article.</span></span><br><span class="line">  <span class="keyword">return</span> &amp;Request&#123;</span><br><span class="line">    ctx: ctx,</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Do sends an HTTP request and returns an HTTP response [...]</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Client)</span> <span class="title">Do</span><span class="params">(req *Request)</span> <span class="params">(*Response, error)</span></span></span><br></pre></td></tr></table></figure></div>
<p>åŸå› ï¼šcontextæ˜¯åœ¨Go 1.7æ‰å¼•å…¥çš„æ–¹æ¡ˆï¼Œå½“æ—¶æœ‰å¤§é‡çš„APIéœ€è¦å¼•å…¥contextï¼Œè€ƒè™‘åˆ°å‘å‰å…¼å®¹ï¼Œæ‰€ä»¥é‡‡ç”¨äº†æ–¹å¼äºŒã€‚</p>
<p>3ï¼Œå¦‚æœæˆ‘çš„åŸæœ‰ä»£ç éœ€è¦å¼•å…¥contextï¼Œæ€ä¹ˆåœ¨å‘å‰å…¼å®¹çš„å‰æä¸‹ï¼Œè¿›è¡Œè¿­ä»£å‘¢ï¼Ÿ<br>å‡½æ•°å¤ç”¨ï¼å®ä¾‹å¦‚ä¸‹ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Call uses context.Background internally; to specify the context, use</span></span><br><span class="line"><span class="comment">// CallContext.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Client)</span> <span class="title">Call</span><span class="params">()</span> <span class="title">error</span></span> &#123;</span><br><span class="line"><span class="keyword">return</span> c.CallContext(context.Background())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Client)</span> <span class="title">CallContext</span><span class="params">(ctx context.Context)</span> <span class="title">error</span></span> &#123;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>]]></content>
      <tags>
        <tag>golang</tag>
      </tags>
  </entry>
  <entry>
    <title>é¢å‘å¯¹è±¡è®¾è®¡å…­å¤§åŸåˆ™</title>
    <url>/2022/06/17/uncatalog/cl4i43q7u00005sr70tpnfrfg/</url>
    <content><![CDATA[<hr>
<span id="more"></span>

<h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><p>å¸¸è¨€é“å®è·µæ˜¯éœ€è¦ç†è®ºæ¥æŒ‡å¯¼çš„ï¼Œè€Œç†è®ºåˆæ˜¯éœ€è¦å®è·µæ¥æ£€éªŒå’Œä¿®æ­£çš„ï¼Œç†è®ºå’Œå®è·µå°±è¿™æ ·ç›¸äº’ä¿ƒè¿›ï¼Œæœ€åå°†ä¸€ä¸ªé¢†åŸŸæ¨å‘æ–°çš„é«˜åº¦ã€‚ä»é¢å‘å¯¹è±¡ç¼–ç¨‹çš„å‡ºç°åˆ°ç°åœ¨å¥½åƒå·²ç»æœ‰åŠä¸ªä¸–çºªäº†ï¼ˆäº1950sç¬¬ä¸€æ¬¡å‡ºç°åœ¨MITï¼‰ï¼Œæ‰€ä»¥è¿™å…­å¤§åŸåˆ™æ˜¯åœ¨æ— æ•°å…ˆè¾ˆçš„ç†è®ºä¸å®è·µä¸­äº§ç”Ÿçš„ã€‚ èº«ä¸ºä¸€åä¸»è¦ä½¿ç”¨é¢å‘å¯¹è±¡ç¼–ç¨‹è½¯ä»¶ä»ä¸šå‘˜ï¼ˆç å†œï¼‰ï¼Œè¿™å…­å¤§åŸåˆ™æ˜¯å¿…é¡»è¦æŒæ¡çš„ï¼Œå®ƒå°±æ˜¯è®¾è®¡æ¨¡å¼çš„ç†è®ºï¼Œè®¾è®¡æ¨¡å¼æ˜¯å®ƒçš„å®è·µã€‚</p>
<h3 id="å…­å¤§åŸåˆ™"><a href="#å…­å¤§åŸåˆ™" class="headerlink" title="å…­å¤§åŸåˆ™"></a>å…­å¤§åŸåˆ™</h3><p>è¿™å…­å¤§åŸåˆ™åº”è¯¥æˆä¸ºä½ åœ¨æ—¥å¸¸å¼€å‘ä¸­çš„ç†è®ºæŒ‡å¯¼ï¼Œåªè¦ä½ æˆ–å¤šæˆ–å°‘çš„éµå¾ªè¿™å…­å¤§è®¾è®¡åŸåˆ™ï¼Œé‚£ä¹ˆå†™å‡ºçš„ä»£ç å°±ä¸ä¼šå¤ªçƒ‚ï¼Œæ…¢æ…¢çš„ä½ ä¼šå‘ç°ä½ ç«Ÿç„¶ç†è§£äº†é‚£äº›åŠç‚¸å¤©çš„è®¾è®¡æ¨¡å¼æ„å›¾åŠè®¾è®¡æ€è·¯ã€‚</p>
<h4 id="1-å•ä¸€èŒè´£ï¼ˆSingle-Responsibility-Principleï¼‰"><a href="#1-å•ä¸€èŒè´£ï¼ˆSingle-Responsibility-Principleï¼‰" class="headerlink" title="1 å•ä¸€èŒè´£ï¼ˆSingle Responsibility Principleï¼‰"></a>1 å•ä¸€èŒè´£ï¼ˆSingle Responsibility Principleï¼‰</h4><p>è¿™ä¸ªåŸåˆ™é¡¾åå°±å¯ä»¥æ€ä¹‰ï¼Œå°±æ˜¯ä¸€ä¸ªç±»åº”è¯¥åªè´Ÿè´£ä¸€ä¸ªèŒè´£ï¼Œæœ¯è¯­å«ï¼šä»…æœ‰ä¸€ä¸ªå¼•èµ·å…¶å˜åŒ–çš„åŸå› ã€‚ç®€å•ç‚¹è¯´ï¼šä¸€ä¸ªç±»ä¸­åº”è¯¥æ˜¯ä¸€ç»„ç›¸å…³æ€§å¾ˆé«˜çš„å‡½æ•°åŠæ•°æ®çš„å°è£…ï¼Œä¸ªä¸­å«ä¹‰è¯·è‡ªè¡Œæ„ä¼šã€‚çœ‹èµ·æ¥ç®€å•ï¼Œä½†æ˜¯åšèµ·æ¥å°±éš¾äº†ï¼Œè¿™å¯èƒ½æ˜¯å…­å¤§åŸåˆ™ä¸­æœ€éš¾ä»¥ç†Ÿç»ƒæŒæ¡çš„ä¸€ä¸ªåŸåˆ™äº†ï¼Œå®ƒé«˜åº¦ä¾èµ–ç¨‹åºå‘˜çš„è‡ªèº«ç´ è´¨åŠä¸šåŠ¡åœºæ™¯ã€‚</p>
<p>ä¾‹å¦‚ä¸¤ä¸ªç”·ç å†œèƒ½ä¸ºæ˜¯å¦åº”è¯¥å°†ä¸€ä¸ªå‡½æ•°å†™è¿›æŸä¸ªç±»é‡Œé¢åµä¸€å¤©ï¼Œæœ€åè°ä¹Ÿæ²¡æœ‰è¯´æœè°ï¼Œæœ€åä»–ä¸¤æˆäº†åŒå¿—ï¼</p>
<h4 id="2-å¼€é—­åŸåˆ™ï¼ˆOpen-Close-Principleï¼‰"><a href="#2-å¼€é—­åŸåˆ™ï¼ˆOpen-Close-Principleï¼‰" class="headerlink" title="2 å¼€é—­åŸåˆ™ï¼ˆOpen Close Principleï¼‰"></a>2 å¼€é—­åŸåˆ™ï¼ˆOpen Close Principleï¼‰</h4><p>å®ƒæ˜¯é¢å‘å¯¹è±¡æœ€é‡è¦çš„è®¾è®¡åŸåˆ™ï¼Œç”±Bertrand Meyerï¼ˆå‹ƒå…°ç‰¹.æ¢…è€¶ï¼‰åœ¨1988å¹´å‡ºç‰ˆçš„ã€Šé¢å‘å¯¹è±¡è½¯ä»¶æ„é€ ã€‹ã€‚ä¸­æå‡ºçš„ã€‚</p>
<p>å®šä¹‰å¦‚ä¸‹ï¼š</p>
<p>å¼€é—­åŸåˆ™(Open-Closed Principle, OCP)ï¼šä¸€ä¸ªè½¯ä»¶å®ä½“åº”å½“å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ã€‚å³è½¯ä»¶å®ä½“åº”å°½é‡åœ¨ä¸ä¿®æ”¹åŸæœ‰ä»£ç çš„æƒ…å†µä¸‹è¿›è¡Œæ‰©å±•ã€‚<br>æå€¡ä¸€ä¸ªç±»ä¸€æ—¦å¼€å‘å®Œæˆï¼Œåç»­å¢åŠ æ–°çš„åŠŸèƒ½å°±ä¸åº”è¯¥é€šè¿‡ä¿®æ”¹è¿™ä¸ªç±»æ¥å®Œæˆï¼Œè€Œæ˜¯é€šè¿‡ç»§æ‰¿ï¼Œå¢åŠ æ–°çš„ç±»ã€‚ å¤§å®¶æƒ³å¿…éƒ½å¬è¿‡è½¯ä»¶éœ€æ±‚ä¸æ–­å˜åŒ–çš„é‚£ä¸ªæ®µå­ï¼Œåœ¨è½¯ä»¶å¼€å‘è¿™ä¸ªè¡Œå½“å”¯ä¸€ä¸å˜çš„å°±æ˜¯å˜åŒ–æœ¬èº«ã€‚é‚£ä¸ºä»€ä¹ˆåº”è¯¥å¯¹ä¿®æ”¹å…³é—­å‘¢ï¼Œå› ä¸ºä½ ä¸€æ—¦ä¿®æ”¹äº†æŸä¸ªç±»å°±æœ‰å¯èƒ½ç ´åç³»ç»ŸåŸæ¥çš„åŠŸèƒ½ï¼Œå°±éœ€è¦é‡æ–°æµ‹è¯•ã€‚å…¶å®æˆ‘çŸ¥é“ä½ ä»¬æ­¤åˆ»åœ¨æƒ³ä»€ä¹ˆï¼Œå›å¿†ä¸€ä¸‹è‡ªå·±çš„æ—¥å¸¸å·¥ä½œï¼Œæœ‰å‡ ä¸ªéµå®ˆäº†è¿™ä¸ªåŸåˆ™ï¼Œéƒ½æ˜¯éœ€æ±‚æ¥äº†å°±æ‰¾åˆ°åŸæ¥çš„ç±»ï¼Œè¿›å»æ”¹ä»£ç å‘—ï¼Œ^_^ã€‚çœ‹çœ‹æœ‰æŒ‡å¯¼åŸåˆ™å°šä¸”å¦‚æ­¤ï¼Œæ²¡æœ‰çš„è¯å°±æ›´åŠ ä¹±å¥—äº†ã€‚</p>
<p>é‚£ä¹ˆæ˜¯ä¸æ˜¯å°±ä¸€å®šä¸èƒ½ä¿®æ”¹åŸæ¥çš„ç±»çš„ï¼Œå½“ç„¶ä¸æ˜¯äº†ï¼Œæˆ‘ä»¬éƒ½æ˜¯æˆå¹´äººäº†ï¼Œè¦æ¸…æ¥šçš„è®¤è¯†åˆ°ï¼Œè¿™ä¸ªä¸–ç•Œä¸æ˜¯éé»‘å³ç™½çš„ã€‚å½“æˆ‘ä»¬å‘ç°åŸæ¥çš„ç±»å·²ç»çƒ‚åˆ°å®¶äº†ï¼Œå½“ç„¶åœ¨æœ‰æ¡ä»¶çš„æƒ…å†µä¸‹åŠæ—¶é‡æ„ï¼Œé¿å…ç³»ç»ŸåŠ é€Ÿè…è´¥ã€‚</p>
<h4 id="3-é‡Œæ°æ›¿æ¢åŸåˆ™ï¼ˆLiskov-Substitution-Principleï¼‰"><a href="#3-é‡Œæ°æ›¿æ¢åŸåˆ™ï¼ˆLiskov-Substitution-Principleï¼‰" class="headerlink" title="3 é‡Œæ°æ›¿æ¢åŸåˆ™ï¼ˆLiskov Substitution Principleï¼‰"></a>3 é‡Œæ°æ›¿æ¢åŸåˆ™ï¼ˆLiskov Substitution Principleï¼‰</h4><p>è¿™ä¸ªåŸåˆ™çš„çš„æå‡ºåˆ™å¯ä»¥æ˜¯ä¸€ä½å¥³æ€§Barbara Liskovï¼Œä¸‹å›¾ä¸ºå¥¹2010å¹´çš„ç…§ç‰‡ï¼Œç°åœ¨åº”è¯¥è¿˜å¥åœ¨å§ï¼Œå…¶å®è®¡ç®—æœºè¿™ä¸ªè¡Œå½“çš„ä»ä¸šäººå‘˜æ¯”è¾ƒå¹¸ç¦ï¼Œæˆ‘ä»¬çš„ç¥–å¸ˆçˆ·åŸºæœ¬éƒ½å¥åœ¨ï¼Œä¸åƒä¸€äº›å…¶ä»–è¡Œä¸šï¼Œéƒ½æ­»äº†ä¸çŸ¥é“å¤šå°‘å¹´äº†ï¼Œæ˜¾å¾—å¾ˆç¥ç§˜ã€‚</p>
<p>å®šä¹‰å¦‚ä¸‹ï¼š</p>
<p>é‡Œæ°ä»£æ¢åŸåˆ™(Liskov Substitution Principle, LSP)ï¼šæ‰€æœ‰å¼•ç”¨åŸºç±»ï¼ˆçˆ¶ç±»ï¼‰çš„åœ°æ–¹å¿…é¡»èƒ½é€æ˜åœ°ä½¿ç”¨å…¶å­ç±»çš„å¯¹è±¡ã€‚<br>ç®€å•ç‚¹è¯´ï¼Œä¸€ä¸ªè½¯ä»¶ç³»ç»Ÿä¸­æ‰€æœ‰ç”¨åˆ°ä¸€ä¸ªç±»çš„åœ°æ–¹éƒ½æ›¿æ¢æˆå…¶å­ç±»ï¼Œç³»ç»Ÿåº”è¯¥ä»ç„¶å¯ä»¥æ­£å¸¸å·¥ä½œã€‚è¿™ä¸ªåŸåˆ™ä¾èµ–é¢å‘å¯¹è±¡çš„ç»§æ‰¿ç‰¹æ€§å’Œå¤šæ€ç‰¹æ€§ï¼Œè¿™ä¸ªåŸåˆ™æˆ‘ä»¬æœ‰æ„æ— æ„ä¸­ä½¿ç”¨çš„å°±æ¯”è¾ƒå¤šäº†ã€‚å› ä¸ºä¸€ä¸ªä¼˜ç§€çš„ç¨‹åºå‘˜ä¸€å®šé¢å‘æŠ½è±¡ï¼ˆæ¥å£ï¼‰ç¼–ç¨‹çš„ï¼Œå¦‚æœä½ ä¸æ˜¯ï¼Œè¯´æ˜ä½ è¿˜æœ‰å¾ˆå¤§çš„è¿›æ­¥ç©ºé—´ã€‚</p>
<p>ä¾‹å¦‚æˆ‘ä»¬æœ‰å¦‚ä¸‹çš„ä»£ç ï¼Œä¸€ä¸ªå›¾å½¢çš„åŸºç±»Shap,ä»¥åŠå®ƒçš„ä¸¤ä¸ªå­ç±»Rectangle ï¼ŒTriangle,å®‰è£…é‡Œå¼æ›¿æ¢åŸåˆ™ï¼Œæ‰€æœ‰ä½¿ç”¨Shapeçš„åœ°æ–¹éƒ½å¯ä»¥å®‰å…¨çš„æ›¿æ¢æˆå…¶å­ç±»ã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JAVASCRIPT"><figure class="iseeu highlight /javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//åŸºç±»</span></span><br><span class="line">public abstract <span class="class"><span class="keyword">class</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">public abstract <span class="keyword">void</span> draw();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å­ç±»çŸ©å½¢</span></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">Rectangle</span> <span class="keyword">extends</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">@Override</span><br><span class="line">public <span class="keyword">void</span> <span class="function"><span class="title">draw</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;ç»˜åˆ¶çŸ©å½¢&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å­ç±»ä¸‰è§’å½¢</span></span><br><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">Triangle</span> <span class="keyword">extends</span> <span class="title">Shape</span> </span>&#123;</span><br><span class="line">@Override</span><br><span class="line">public <span class="keyword">void</span> <span class="function"><span class="title">draw</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;ç»˜åˆ¶ä¸‰è§’å½¢&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>å†™ä¸€ä¸ªä½¿ç”¨Shapeç±»çš„å‡½æ•°</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JAVASCRIPT"><figure class="iseeu highlight /javascript"><table><tr><td class="code"><pre><span class="line">public <span class="keyword">static</span> <span class="keyword">void</span> <span class="function"><span class="title">main</span>(<span class="params"><span class="built_in">String</span>[] args</span>)</span> &#123;</span><br><span class="line"><span class="comment">//ä½¿ç”¨Shapeçš„å­ç±»Triangle çš„å®ä¾‹æ¥æ›¿æ¢Shapeçš„å®ä¾‹ï¼Œç¨‹åºå·¥ä½œæ­£å¸¸</span></span><br><span class="line">drawShape(<span class="keyword">new</span> Triangle());</span><br><span class="line">&#125;</span><br><span class="line">private <span class="keyword">static</span> <span class="keyword">void</span> <span class="function"><span class="title">drawShape</span>(<span class="params">Shape shape</span>)</span>&#123;</span><br><span class="line">System.out.println(<span class="string">&quot;å¼€å§‹ç”»å›¾&quot;</span>);</span><br><span class="line">shape.draw();</span><br><span class="line">System.out.println(<span class="string">&quot;ç»“æŸç”»å›¾&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>è¾“å‡ºç»“æœï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">å¼€å§‹ç”»å›¾</span><br><span class="line">ç»˜åˆ¶ä¸‰è§’å½¢</span><br><span class="line">ç»“æŸç”»å›¾</span><br></pre></td></tr></table></figure></div>
<p>å¦‚ä¸Šä»£ç æ‰€ç¤ºï¼šæœ¬æ¥drawShape()å‡½æ•°éœ€è¦ä¸€ä¸ªShapeçš„å®ä¾‹ï¼Œè€Œæˆ‘ä»¬å´ä¼ ç»™ä»–ä¸€ä¸ªå…¶å­ç±»çš„å®ä¾‹ï¼Œä½†æ˜¯å®ƒæ­£å¸¸å·¥ä½œäº†ã€‚æˆ‘ä»¬ä½¿ç”¨Shapeçš„å­ç±»Triangleçš„å®ä¾‹æ¥æ›¿æ¢Shapeçš„å®ä¾‹ï¼Œç¨‹åºå·¥ä½œæ­£å¸¸ã€‚è¿™ä¸ªåŸåˆ™ä¹Ÿéå¸¸é‡è¦è€Œå¸¸ç”¨ï¼Œé¢å‘æŠ½è±¡ç¼–ç¨‹ã€‚</p>
<h4 id="4-ä¾èµ–å€’ç½®åŸåˆ™ï¼ˆDependence-Inversion-Principleï¼‰"><a href="#4-ä¾èµ–å€’ç½®åŸåˆ™ï¼ˆDependence-Inversion-Principleï¼‰" class="headerlink" title="4 ä¾èµ–å€’ç½®åŸåˆ™ï¼ˆDependence Inversion Principleï¼‰"></a>4 ä¾èµ–å€’ç½®åŸåˆ™ï¼ˆDependence Inversion Principleï¼‰</h4><p>è¿™ä¸ªåŸåˆ™çš„æå€¡è€…æ­£æ˜¯å¤§åé¼é¼çš„ Robert C. Martinï¼Œäººç§°Bobå¤§å”</p>
<p>å®šä¹‰:</p>
<p>ä¾èµ–å€’è½¬åŸåˆ™(Dependency Inversion Principle, DIP)ï¼šæŠ½è±¡ä¸åº”è¯¥ä¾èµ–äºç»†èŠ‚ï¼Œç»†èŠ‚åº”å½“ä¾èµ–äºæŠ½è±¡ã€‚æ¢è¨€ä¹‹ï¼Œè¦é’ˆå¯¹æ¥å£ç¼–ç¨‹ï¼Œè€Œä¸æ˜¯é’ˆå¯¹å®ç°ç¼–ç¨‹ã€‚</p>
<p>å…³é”®ç‚¹ï¼š</p>
<ul>
<li> é«˜å±‚æ¨¡å—ä¸åº”è¯¥ä¾èµ–ä½å±‚æ¨¡å—ï¼Œä¸¤è€…éƒ½åº”è¯¥ä¾èµ–å…¶æŠ½è±¡</li>
<li> æŠ½è±¡ä¸åº”è¯¥ä¾èµ–ç»†èŠ‚</li>
<li> ç»†èŠ‚åº”è¯¥ä¾èµ–æŠ½è±¡</li>
</ul>
<p>æŠ½è±¡ï¼šjavaä¸­çš„æŠ½è±¡ç±»æˆ–è€…æ¥å£ ï¼ˆå¦‚ä¸Šé¢ä»£ç ä¸­çš„Shape æŠ½è±¡ç±»ï¼‰ ç»†èŠ‚ï¼šjavaä¸­çš„å…·ä½“å®ç°ç±»ï¼ˆå¦‚ä¸Šé¢ä»£ç ä¸­çš„Rectangle å’ŒTriangle å®ä½“ç±»ï¼‰ é«˜å±‚æ¨¡å—ï¼šjavaä¸­çš„è°ƒç”¨ç±»ï¼ˆä¾‹å¦‚ä¸Šé¢ä»£ç ä¸­drawShape(Shape shape)å‡½æ•°çš„ç±»ï¼‰ ä½å±‚æ¨¡å—ï¼šjavaä¸­çš„å®ç°ç±»ï¼ˆç»†èŠ‚ï¼‰</p>
<p>ä¾èµ–å€’ç½®åˆå«ä¾èµ–å€’è½¬ï¼Œå…³é”®åœ¨å€’ç½®ä¸Šï¼Œå•¥å«å€’ç½®ï¼Œé‚£ä¸å€’ç½®çš„æ—¶å€™æ˜¯ä»€ä¹ˆæ ·çš„ï¼Ÿå¦‚ä¸‹é¢å›¾æ‰€ç¤º</p>
<p>æ­£å¸¸æƒ…å†µä¸‹ï¼šè°ƒç”¨ç±»ï¼ˆé«˜å±‚æ¨¡å—ï¼‰åº”è¯¥ä¾èµ–å…·ä½“å®ç°ç±»ï¼ˆä½å±‚æ¨¡å—å®ç°ç»†èŠ‚ï¼‰</p>
<p>å€’ç½®åï¼šé«˜å±‚æ¨¡å—ä¸ä½å±‚æ¨¡å—éƒ½ä¾èµ–äº†å®ç°ç±»çš„æ¥å£ï¼ˆä½å±‚æ¨¡å—çš„ç»†èŠ‚æŠ½è±¡ï¼‰ï¼Œåº•å±‚æ¨¡å—çš„ä¾èµ–ç®­å¤´å‘ä¸Šäº†ï¼Œæ‰€ä»¥å«ä¾èµ–å€’ç½®äº†ã€‚</p>
<p>ä¾‹å¦‚èœé¸Ÿç¨‹åºå‘˜ï¼ˆç‰›ç¿ èŠ±ï¼‰ä¼šè¿™ä¹ˆå†™ä»£ç </p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JAVASCRIPT"><figure class="iseeu highlight /javascript"><table><tr><td class="code"><pre><span class="line">private <span class="keyword">static</span> <span class="keyword">void</span> drawRectangle (Rectangle rectangle)&#123;        </span><br><span class="line">rectangle.draw();</span><br><span class="line">&#125;</span><br><span class="line">private <span class="keyword">static</span> <span class="keyword">void</span> drawTriangle  (Triangle triangle)&#123;        </span><br><span class="line">triangle.draw();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>è€Œè€é¸Ÿï¼ˆç‹äºŒç‹—ï¼‰åˆ™ä¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JAVASCRIPT"><figure class="iseeu highlight /javascript"><table><tr><td class="code"><pre><span class="line">private <span class="keyword">static</span> <span class="keyword">void</span> <span class="function"><span class="title">drawShape</span>(<span class="params">Shape shape</span>)</span>&#123;</span><br><span class="line">shape.draw();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>é‚£ä¹ˆèœé¸Ÿçš„ä»£ç ä¼šæœ‰ä»€ä¹ˆé—®é¢˜å‘¢ï¼Œå‡è®¾ç°åœ¨äº§å“ç»ç†è§‰å¾—çŸ©å½¢ä¸å¥½çœ‹ï¼Œè®©ç‰›ç¿ èŠ±å°†çŸ©å½¢æ¢æˆäº”è§’å½¢ï¼Œé‚£ä¹ˆç‰›ç¿ èŠ±å°±è¦åŒæ—¶ä¿®æ”¹è°ƒç”¨ç±»å’Œå¢åŠ ä¸€ä¸ªç»˜åˆ¶ç±»ï¼Œè€Œç‹äºŒç‹—çš„ä»£ç åªéœ€è¦å¢åŠ ä¸€ä¸ªäº”è§’å½¢çš„ç»˜åˆ¶ç±»ï¼Œè¿™å°±éµå¾ªäº†å¼€å…³é—­åŸåˆ™</p>
<p>æ‰€ä»¥æˆ‘ä»¬è¦å¯¹æ¥å£ç¼–ç¨‹ï¼Œä¸¾å‡ ä¸ªå…·ä½“çš„ä¾‹å­ï¼šå£°æ˜æ–¹æ³•å‚æ•°çš„ç±»å‹ï¼Œå®ä¾‹å˜é‡çš„ç±»å‹ï¼Œæ–¹æ³•çš„è¿”å›å€¼ç±»å‹ï¼Œç±»å‹å¼ºåˆ¶è½¬æ¢ç­‰ç­‰åœºæ™¯ã€‚</p>
<p>ç‰›ç¿ èŠ±çš„ä»£ç ç›´æ¥ä¾èµ–äº†å®ç°ç»†èŠ‚ï¼Œè€Œç‹äºŒç‹—çš„ä»£ç ä¾èµ–çš„æ˜¯å®ç°ç»†èŠ‚çš„æŠ½è±¡ï¼ˆä¾èµ–å€’ç½®äº†ï¼‰ã€‚åˆšå…¥é—¨æ—¶å€™æˆ‘ä»¬éƒ½æ˜¯ç‰›ç¿ èŠ±ï¼Œä½†æ˜¯å‡ å¹´åæœ‰çš„äººå˜æˆäº†ç‹äºŒç‹—ï¼Œæœ‰çš„äººä»ç„¶æ˜¯ç‰›ç¿ èŠ±ã€‚ã€‚ã€‚</p>
<p>ä¸ä¾èµ–å€’ç½®ï¼ˆDIPï¼‰ç›¸å…³çš„è¿˜æœ‰ä¾èµ–æ³¨å…¥(di- dependency injection)ï¼Œæ§åˆ¶ç¿»è½¬(Iocâ€”Inversion of Control)ï¼Œè®°ä½ä»–ä»¬ä¸æ˜¯åŒä¸€ä¸ªä¸œè¥¿ã€‚</p>
<h4 id="5-æ¥å£éš”ç¦»åŸåˆ™ï¼ˆInterface-Segregation-Principleï¼‰"><a href="#5-æ¥å£éš”ç¦»åŸåˆ™ï¼ˆInterface-Segregation-Principleï¼‰" class="headerlink" title="5 æ¥å£éš”ç¦»åŸåˆ™ï¼ˆInterface Segregation Principleï¼‰"></a>5 æ¥å£éš”ç¦»åŸåˆ™ï¼ˆInterface Segregation Principleï¼‰</h4><p>æ¥å£éš”ç¦»åŸåˆ™(Interface Segregation Principle, ISP)ï¼šä½¿ç”¨å¤šä¸ªä¸“é—¨çš„æ¥å£ï¼Œè€Œä¸ä½¿ç”¨å•ä¸€çš„æ€»æ¥å£ï¼Œå³å®¢æˆ·ç«¯ä¸åº”è¯¥ä¾èµ–é‚£äº›å®ƒä¸éœ€è¦çš„æ¥å£ã€‚<br>å…¶å®è¿™ä¸ªåŸåˆ™æ˜¯å¾ˆå®¹æ˜“ç†è§£çš„ï¼Œå°±æ˜¯è®©è°ƒç”¨è€…ä¾èµ–çš„æ¥å£å°½å¯èƒ½çš„å°ã€‚ä¾‹å¦‚äººç±»åˆ†ç”·äººå’Œå¥³äººï¼Œç”·äººå’Œå¥³äººéƒ½è¦åƒé¥­ï¼Œä½†æ˜¯åªæœ‰å¥³äººæ¯ä¸ªæœˆæ¥å¤§å§¨å¦ˆï¼Œé‚£ä¹ˆå¦‚æœä½ è®¾è®¡ä¸€ä¸ªæ¥å£é‡Œé¢é™¤äº†åƒé¥­è¿˜æœ‰æ¥å¤§å§¨å¦ˆåŒæ—¶ç»™ç”·äººå’Œå¥³äººç”¨å°±ä¸åˆé€‚äº†ã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JAVASCRIPT"><figure class="iseeu highlight /javascript"><table><tr><td class="code"><pre><span class="line">interface IHuman&#123;</span><br><span class="line"><span class="keyword">void</span> eat();</span><br><span class="line"><span class="keyword">void</span> sleep();</span><br><span class="line"><span class="keyword">void</span> laiDaYiMa();<span class="comment">//æ¥å¤§å§¨å¦ˆ</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>è¿™ä½ è®©ç”·äººæƒ…ä½•ä»¥å ªï¼Œä¸‡ä¸€æœ‰ä¸ªèœé¸Ÿç¨‹åºå‘˜æŠ½é£äº†ï¼Œç›´æ¥ç»™æŠŠæ¥å¤§å§¨å¦ˆçš„æ–¹æ³•å®ç°äº†ï¼Œé‚£åæœå°±ã€‚ã€‚ã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JAVASCRIPT"><figure class="iseeu highlight /javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">//ç”·äººç±»ä¸éœ€è¦æ¥å£ä¸­çš„laiDaYiMaæ–¹æ³•</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">man</span> <span class="title">implements</span> <span class="title">IHuman</span></span>&#123;</span><br><span class="line">@Override</span><br><span class="line">public <span class="keyword">void</span> <span class="function"><span class="title">eat</span>(<span class="params"></span>)</span> &#123;        </span><br><span class="line">&#125;</span><br><span class="line">@Override</span><br><span class="line">public <span class="keyword">void</span> <span class="function"><span class="title">laiDaYiMa</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line"><span class="comment">//è€å­ä¸æ¥å¤§å§¨å¦ˆï¼Œæ‰€ä»¥æ–¹æ³•ç½®ç©ºï¼Œå•¥ä¹Ÿä¸å¹²!</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">woman</span> <span class="title">implements</span> <span class="title">IHuman</span></span>&#123;</span><br><span class="line">@Override</span><br><span class="line">public <span class="keyword">void</span> <span class="function"><span class="title">eat</span>(<span class="params"></span>)</span> &#123;        </span><br><span class="line">&#125;</span><br><span class="line">@Override</span><br><span class="line">public <span class="keyword">void</span> <span class="function"><span class="title">laiDaYiMa</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">System.out.println(<span class="string">&quot;ç‹äºŒç‹—ï¼Œç»™è€å¨˜å€’ä¸€æ¯çƒ­æ°´&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>ä¸Šé¢çš„ä¾‹å­å°±è¿åäº†æ¥å£éš”ç¦»åŸåˆ™ï¼Œæ­£ç¡®çš„åšæ³•æ˜¯ç”³æ˜ä¸¤ä¸ªæ¥å£ï¼Œä½¿æ¥å£ä¿æŒæœ€å°</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JAVASCRIPT"><figure class="iseeu highlight /javascript"><table><tr><td class="code"><pre><span class="line">interface IHuman&#123;</span><br><span class="line"><span class="keyword">void</span> eat();</span><br><span class="line">&#125;</span><br><span class="line">interface ISpecialForWoman&#123;</span><br><span class="line"><span class="keyword">void</span> laiDaYiMa();<span class="comment">//æ¥å¤§å§¨å¦ˆ</span></span><br><span class="line">&#125;</span><br><span class="line">ç”·äººåªå®ç°IHuman,å¥³äººå®ç°IHuman å’ŒISpecialForWoman</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">man</span> <span class="title">implements</span> <span class="title">IHuman</span></span>&#123;</span><br><span class="line">@Override</span><br><span class="line">public <span class="keyword">void</span> <span class="function"><span class="title">eat</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">woman</span> <span class="title">implements</span> <span class="title">IHuman</span>,<span class="title">ISpecialForWoman</span></span>&#123;</span><br><span class="line">@Override</span><br><span class="line">public <span class="keyword">void</span> <span class="function"><span class="title">eat</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public <span class="keyword">void</span> <span class="function"><span class="title">laiDaYiMa</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;ç‹äºŒç‹—ï¼Œç»™è€å¨˜å€’ä¸€æ¯çƒ­æ°´&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<h4 id="6-è¿ªç±³ç‰¹åŸåˆ™ï¼ˆLaw-of-Demeter-åˆåLeast-Knowledge-Principleï¼‰"><a href="#6-è¿ªç±³ç‰¹åŸåˆ™ï¼ˆLaw-of-Demeter-åˆåLeast-Knowledge-Principleï¼‰" class="headerlink" title="6 è¿ªç±³ç‰¹åŸåˆ™ï¼ˆLaw of Demeter åˆåLeast Knowledge Principleï¼‰"></a>6 è¿ªç±³ç‰¹åŸåˆ™ï¼ˆLaw of Demeter åˆåLeast Knowledge Principleï¼‰</h4><p>è¿ªç±³ç‰¹æ³•åˆ™æ¥è‡ªäº1987å¹´ç¾å›½ä¸œåŒ—å¤§å­¦(Northeastern University)ä¸€ä¸ªåä¸ºâ€œDemeterâ€çš„ç ”ç©¶é¡¹ç›®ï¼Œåˆç§°æœ€å°‘çŸ¥è¯†åŸåˆ™(LeastKnowledge Principle, LKP)ï¼Œå…¶å®šä¹‰å¦‚ä¸‹ï¼š</p>
<p>è¿ªç±³ç‰¹æ³•åˆ™(Law of Demeter, LoD)ï¼šä¸€ä¸ªè½¯ä»¶å®ä½“åº”å½“å°½å¯èƒ½å°‘åœ°ä¸å…¶ä»–å®ä½“å‘ç”Ÿç›¸äº’ä½œç”¨ã€‚<br>ä¸€ä¸ªç±»åº”è¯¥å¯¹è‡ªå·±éœ€è¦è°ƒç”¨çš„ç±»çŸ¥é“å¾—æœ€å°‘ï¼Œç±»çš„å†…éƒ¨å¦‚ä½•å®ç°ã€å¦‚ä½•å¤æ‚éƒ½ä¸è°ƒç”¨è€…æˆ–è€…ä¾èµ–è€…æ²¡å…³ç³»ï¼Œè°ƒç”¨è€…æˆ–è€…ä¾èµ–è€…åªéœ€è¦çŸ¥é“ä»–éœ€è¦çš„æ–¹æ³•å³å¯ï¼Œå…¶ä»–çš„æˆ‘ä¸€æ¦‚ä¸å…³å¿ƒã€‚</p>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>ä»¥ä¸Š6å¤§åŸåˆ™å…¨éƒ¨æ˜¯ä»¥æ„å»ºçµæ´»å¯æ‰©å±•å¯ç»´æŠ¤çš„è½¯ä»¶ç³»ç»Ÿä¸ºç›®çš„çš„ï¼Œæ‰€ä»¥è¯´å®ƒçš„é‡è¦æ€§æ˜¯é«˜äºè®¾è®¡æ¨¡å¼çš„ï¼Œä¹Ÿåº”è¯¥æ˜¯ç¨‹åºå‘˜æ—¶åˆ»å°åœ¨è„‘å­é‡Œçš„ï¼Œè®¾è®¡æ¨¡å¼ä¹Ÿæ˜¯å®ƒçš„å…·ä½“å®è·µè€Œå·²ã€‚</p>
]]></content>
      <tags>
        <tag>è®¾è®¡æ¨¡å¼</tag>
        <tag>æ¶æ„è®¾è®¡</tag>
      </tags>
  </entry>
  <entry>
    <title>httprouteræºç è§£æ</title>
    <url>/2022/06/22/uncatalog/cl4pdun8r0000rsr7bninemtl/</url>
    <content><![CDATA[<hr>
<span id="more"></span>
<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><blockquote>
<p>ginæ¡†æ¶é‡‡ç”¨äº†httprouterè¿›è¡Œè·¯ç”±åŒ¹é…ï¼Œæ‰€ä»¥åºŸè¯å°‘è¯´ï¼Œè¿™ç¯‡æ–‡ç« æ¥å¸®ä½ äº†è§£ä»–çš„æºç å®ç°</p>
</blockquote>
<h3 id="æ ‘"><a href="#æ ‘" class="headerlink" title="æ ‘"></a>æ ‘</h3><p>httprouterçš„è·¯ç”±åŒ¹é…åŠŸèƒ½æ˜¯åŸºäºradix tree(å‰ç¼€æ ‘/åŸºæ•°æ ‘)è¿™ç§æ•°æ®ç»“æ„å®ç°çš„ï¼š<br><img src="/2022/06/22/uncatalog/cl4pdun8r0000rsr7bninemtl/radix_tree.png" alt="img"><br>æœ‰è¯»è€…å¯èƒ½ä¼šæœ‰ç–‘é—®ï¼šä¸ºä»€ä¹ˆä¸æŒ‰ç…§RULåˆ†éš”ç¬¦åˆ‡å‰²çš„æ¥åˆ†å‰²ï¼Œæ¯ä¸ªsegmentä½œä¸ºä¸€ä¸ªèŠ‚ç‚¹ï¼Œè€Œæ˜¯è¦ç”¨å…¬å…±å‰ç¼€æ¥åˆ†å‰²ï¼Ÿé’ˆå¯¹è¿™ä¸ªç–‘é—®ï¼Œäº†è§£æ ‘çš„å¼€å‘è€…éƒ½çŸ¥é“ï¼Œæ ‘çš„é«˜åº¦æ˜¯å½±å“æŸ¥æ‰¾æ•ˆç‡çš„é‡è¦å› ç´ ï¼Œé«˜åº¦è¶Šé«˜ï¼ŒæŸ¥æ‰¾æ•ˆç‡è¶Šä½ã€‚ä¸¤å¼ å›¾ç‰‡æ¥å¯¹æ¯”ä¸€ä¸‹:<br><img src="/2022/06/22/uncatalog/cl4pdun8r0000rsr7bninemtl/1.png" alt="img"><br><img src="/2022/06/22/uncatalog/cl4pdun8r0000rsr7bninemtl/2.png" alt="img"></p>
<h3 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h3><p>demo</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;net/http&quot;</span></span><br><span class="line">    <span class="string">&quot;log&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="string">&quot;github.com/julienschmidt/httprouter&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Index</span><span class="params">(w http.ResponseWriter, r *http.Request, _ httprouter.Params)</span></span> &#123;</span><br><span class="line">    fmt.Fprint(w, <span class="string">&quot;Welcome!\n&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Hello</span><span class="params">(w http.ResponseWriter, r *http.Request, ps httprouter.Params)</span></span> &#123;</span><br><span class="line">    fmt.Fprintf(w, <span class="string">&quot;hello, %s!\n&quot;</span>, ps.ByName(<span class="string">&quot;name&quot;</span>))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">    router := httprouter.New()</span><br><span class="line">    router.GET(<span class="string">&quot;/&quot;</span>, Index)</span><br><span class="line">    router.GET(<span class="string">&quot;/hello/:name&quot;</span>, Hello)</span><br><span class="line"></span><br><span class="line">    log.Fatal(http.ListenAndServe(<span class="string">&quot;:8080&quot;</span>, router))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>é¦–å…ˆçœ‹åˆ° httprouter.New()ï¼Œå› ä¸ºå®ƒè¿”å›ä¸€ä¸ªrouterå®ä¾‹ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">New</span><span class="params">()</span> *<span class="title">Router</span></span> &#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;Router&#123;</span><br><span class="line">		RedirectTrailingSlash:  <span class="literal">true</span>,</span><br><span class="line">		RedirectFixedPath:      <span class="literal">true</span>,</span><br><span class="line">		HandleMethodNotAllowed: <span class="literal">true</span>,</span><br><span class="line">		HandleOPTIONS:          <span class="literal">true</span>,</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Router is a http.Handler which can be used to dispatch requests to different</span></span><br><span class="line"><span class="comment">// handler functions via configurable routes</span></span><br><span class="line"><span class="keyword">type</span> Router <span class="keyword">struct</span> &#123;</span><br><span class="line">	trees <span class="keyword">map</span>[<span class="keyword">string</span>]*node</span><br><span class="line"></span><br><span class="line">	paramsPool sync.Pool</span><br><span class="line">	maxParams  <span class="keyword">uint16</span></span><br><span class="line">	SaveMatchedRoutePath <span class="keyword">bool</span></span><br><span class="line">	RedirectTrailingSlash <span class="keyword">bool</span></span><br><span class="line">	RedirectFixedPath <span class="keyword">bool</span></span><br><span class="line">	HandleMethodNotAllowed <span class="keyword">bool</span></span><br><span class="line">	HandleOPTIONS <span class="keyword">bool</span></span><br><span class="line">	GlobalOPTIONS http.Handler</span><br><span class="line">	globalAllowed <span class="keyword">string</span></span><br><span class="line">	NotFound http.Handler</span><br><span class="line">	MethodNotAllowed http.Handler</span><br><span class="line">	PanicHandler <span class="function"><span class="keyword">func</span><span class="params">(http.ResponseWriter, *http.Request, <span class="keyword">interface</span>&#123;&#125;)</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>å®ƒå®ç°äº† ServeHTTP è¿™ä¸ªå‡½æ•°ï¼Œå› æ­¤ç¬¦åˆ net/http.Handler æ¥å£ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// ServeHTTP makes the router implement the http.Handler interface.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *Router)</span> <span class="title">ServeHTTP</span><span class="params">(w http.ResponseWriter, req *http.Request)</span></span> &#123;</span><br><span class="line">	<span class="keyword">if</span> r.PanicHandler != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">defer</span> r.recv(w, req)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	path := req.URL.Path</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> root := r.trees[req.Method]; root != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> handle, ps, tsr := root.getValue(path, r.getParams); handle != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="keyword">if</span> ps != <span class="literal">nil</span> &#123;</span><br><span class="line">				handle(w, req, *ps)</span><br><span class="line">				r.putParams(ps)</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				handle(w, req, <span class="literal">nil</span>)</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>è¿™å°±æ˜¯å¤„ç†è¯·æ±‚çš„æ—¶å€™ï¼ŒæŸ¥æ‰¾è·¯ç”±æ ‘åŠhandlerçš„é‚£éƒ¨åˆ†ï¼Œroot.getValueå°±æ˜¯æŸ¥æ‰¾è·¯ç”±æ ‘çš„å…·ä½“å‡½æ•°ï¼Œä¸è¿‡ç»†èŠ‚æ­¤å¤„ä¸è¡¨ã€‚</p>
<p>æˆ‘ä»¬æ¥ä¸‹æ¥çœ‹çœ‹æ³¨å†Œè·¯ç”±çš„é‚£éƒ¨åˆ†ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// GET is a shortcut for router.Handle(http.MethodGet, path, handle)</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r *Router)</span> <span class="title">GET</span><span class="params">(path <span class="keyword">string</span>, handle Handle)</span></span> &#123;</span><br><span class="line">	r.Handle(http.MethodGet, path, handle)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·Ÿè¿› r.Handle å‡½æ•°ä¹‹åå‘ç°è°ƒç”¨äº† addRoute å‡½æ•°</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// addRoute adds a node with the given handle to the path.</span></span><br><span class="line"><span class="comment">// Not concurrency-safe!</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(n *node)</span> <span class="title">addRoute</span><span class="params">(path <span class="keyword">string</span>, handle Handle)</span></span> &#123;</span><br><span class="line">	fullPath := path</span><br><span class="line">	n.priority++</span><br><span class="line"></span><br><span class="line">	<span class="comment">// Empty tree</span></span><br><span class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(n.path) == <span class="number">0</span> &amp;&amp; <span class="built_in">len</span>(n.indices) == <span class="number">0</span> &#123;</span><br><span class="line">		n.insertChild(path, fullPath, handle)</span><br><span class="line">		n.nType = root</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">walk:</span><br><span class="line">	<span class="keyword">for</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
<p>è€Œ addRoute å‡½æ•°å°±æ˜¯å®ç°radix treeè¿™ä¸ªæ•°æ®ç»“æ„çš„å‡½æ•°äº†ï¼Œå®ƒä¼šå…ˆæ‰¾åˆ°å…±åŒçš„éƒ¨åˆ†ï¼Œç„¶åè€ƒè™‘æ˜¯å¦æŠŠè·¯ç”±åˆ‡åˆ†ä¸ºå­—èŠ‚ç‚¹ï¼Œæœ€å æŠŠhandlerå†™ä¸Šå»(è°ƒç”¨ insertChild å‡½æ•°)ã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> node <span class="keyword">struct</span> &#123;</span><br><span class="line">	path      <span class="keyword">string</span> <span class="comment">// URL</span></span><br><span class="line">	indices   <span class="keyword">string</span> <span class="comment">// å­—èŠ‚ç‚¹çš„é¦–å­—æ¯æ‹¼æˆçš„stringï¼Œé¡ºåºä¸ children ä¸€è‡´</span></span><br><span class="line">	wildChild <span class="keyword">bool</span> <span class="comment">// æ˜¯å¦æ˜¯æ³›åŒ¹é…</span></span><br><span class="line">	nType     nodeType <span class="comment">// èŠ‚ç‚¹ç±»å‹</span></span><br><span class="line">	priority  <span class="keyword">uint32</span> <span class="comment">// ä¼˜å…ˆçº§</span></span><br><span class="line">	children  []*node <span class="comment">// å­èŠ‚ç‚¹</span></span><br><span class="line">	handle    Handle <span class="comment">// å¤„ç†å‡½æ•°</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>nodeå°±æ˜¯ä¿å­˜è¿™äº›èµ„æ–™çš„radix treeçš„èŠ‚ç‚¹</p>
]]></content>
      <tags>
        <tag>æ‰‹æ’¸ä¸€ä¸ªwebæ¡†æ¶</tag>
      </tags>
  </entry>
  <entry>
    <title>The Twelve-Factor App--I.Codebase</title>
    <url>/2022/06/24/uncatalog/cl4s23b37000010r7cl0h25hd/</url>
    <content><![CDATA[<hr>
<span id="more"></span>
<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>å¦‚ä»Šï¼Œè½¯ä»¶é€šå¸¸ä¼šä½œä¸ºä¸€ç§æœåŠ¡æ¥äº¤ä»˜ï¼Œå®ƒä»¬è¢«ç§°ä¸ºç½‘ç»œåº”ç”¨ç¨‹åºï¼Œæˆ–è½¯ä»¶å³æœåŠ¡ï¼ˆSaaSï¼‰ã€‚12-Factor ä¸ºæ„å»ºå¦‚ä¸‹çš„ SaaS åº”ç”¨æä¾›äº†æ–¹æ³•è®ºï¼š</p>
<ul>
<li>ä½¿ç”¨æ ‡å‡†åŒ–æµç¨‹è‡ªåŠ¨é…ç½®ï¼Œä»è€Œä½¿æ–°çš„å¼€å‘è€…èŠ±è´¹æœ€å°‘çš„å­¦ä¹ æˆæœ¬åŠ å…¥è¿™ä¸ªé¡¹ç›®ã€‚</li>
<li>å’Œæ“ä½œç³»ç»Ÿä¹‹é—´å°½å¯èƒ½çš„åˆ’æ¸…ç•Œé™ï¼Œåœ¨å„ä¸ªç³»ç»Ÿä¸­æä¾›æœ€å¤§çš„å¯ç§»æ¤æ€§ã€‚</li>
<li>é€‚åˆéƒ¨ç½²åœ¨ç°ä»£çš„äº‘è®¡ç®—å¹³å°ï¼Œä»è€Œåœ¨æœåŠ¡å™¨å’Œç³»ç»Ÿç®¡ç†æ–¹é¢èŠ‚çœèµ„æºã€‚</li>
<li>å°†å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒçš„å·®å¼‚é™è‡³æœ€ä½ï¼Œå¹¶ä½¿ç”¨æŒç»­äº¤ä»˜å®æ–½æ•æ·å¼€å‘ã€‚</li>
<li>å¯ä»¥åœ¨å·¥å…·ã€æ¶æ„å’Œå¼€å‘æµç¨‹ä¸å‘ç”Ÿæ˜æ˜¾å˜åŒ–çš„å‰æä¸‹å®ç°æ‰©å±•ã€‚<br>è¿™å¥—ç†è®ºé€‚ç”¨äºä»»æ„è¯­è¨€å’Œåç«¯æœåŠ¡ï¼ˆæ•°æ®åº“ã€æ¶ˆæ¯é˜Ÿåˆ—ã€ç¼“å­˜ç­‰ï¼‰å¼€å‘çš„åº”ç”¨ç¨‹åºã€‚</li>
</ul>
<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>è¿™å¥—æ–¹æ³•è®ºç”±Herokuçš„è”åˆåˆ›å§‹äººAdam Wigginså‘æ˜ï¼Œåº”ç”¨åˆ°äº†æ•°ä»¥ç™¾è®¡çš„åº”ç”¨ç¨‹åºçš„å¼€å‘å’Œéƒ¨ç½²ï¼Œå¹¶é€šè¿‡ Heroku å¹³å°é—´æ¥è§è¯äº†æ•°åä¸‡åº”ç”¨ç¨‹åºçš„å¼€å‘ï¼Œè¿ä½œä»¥åŠæ‰©å±•çš„è¿‡ç¨‹ã€‚</p>
<p><code>The Twelve-Factor App</code>ç³»åˆ—æ–‡ç« ï¼Œç»¼åˆäº†Heroåº“å…³äº SaaS åº”ç”¨å‡ ä¹æ‰€æœ‰çš„ç»éªŒå’Œæ™ºæ…§ï¼Œæ˜¯å¼€å‘æ­¤ç±»åº”ç”¨çš„ç†æƒ³å®è·µæ ‡å‡†ï¼Œå¹¶ç‰¹åˆ«å…³æ³¨äºåº”ç”¨ç¨‹åºå¦‚ä½•ä¿æŒè‰¯æ€§æˆé•¿ï¼Œå¼€å‘è€…ä¹‹é—´å¦‚ä½•è¿›è¡Œæœ‰æ•ˆçš„ä»£ç åä½œï¼Œä»¥åŠå¦‚ä½• é¿å…è½¯ä»¶æ±¡æŸ“ ã€‚</p>
<blockquote>
<p>è‹±æ–‡åŸæ–‡</p>
</blockquote>
<h2 id="I-Codebase"><a href="#I-Codebase" class="headerlink" title="I. Codebase"></a>I. Codebase</h2><blockquote>
<p>One codebase tracked in revision control, many deploys</p>
</blockquote>
<p>A twelve-factor app is always tracked in a version control system, such as Git, Mercurial, or Subversion. A copy of the revision tracking database is known as a code repository, often shortened to code repo or just repo.</p>
<p>A codebase is any single repo (in a centralized revision control system like Subversion), or any set of repos who share a root commit (in a decentralized revision control system like Git).</p>
<p>One codebase maps to many deploys</p>
<p>There is always a one-to-one correlation between the codebase and the app:</p>
<ul>
<li>If there are multiple codebases, itâ€™s not an app â€“ itâ€™s a distributed system. Each component in a distributed system is an app, and each can individually comply with twelve-factor.</li>
<li>Multiple apps sharing the same code is a violation of twelve-factor. The solution here is to factor shared code into libraries which can be included through the dependency manager.<br><img src="/2022/06/24/uncatalog/cl4s23b37000010r7cl0h25hd/codebase-deploys.png" alt="imag"></li>
</ul>
<p>There is only one codebase per app, but there will be many deploys of the app. A deploy is a running instance of the app. This is typically a production site, and one or more staging sites. Additionally, every developer has a copy of the app running in their local development environment, each of which also qualifies as a deploy.</p>
<p>The codebase is the same across all deploys, although different versions may be active in each deploy. For example, a developer has some commits not yet deployed to staging; staging has some commits not yet deployed to production. But they all share the same codebase, thus making them identifiable as different deploys of the same app.  </p>
<blockquote>
<p>ä¸­æ–‡</p>
</blockquote>
<h3 id="I-åŸºå‡†ä»£ç "><a href="#I-åŸºå‡†ä»£ç " class="headerlink" title="I. åŸºå‡†ä»£ç "></a>I. åŸºå‡†ä»£ç </h3><blockquote>
<p>ä¸€ä»½åŸºå‡†ä»£ç ï¼ˆCodebaseï¼‰ï¼Œå¤šä»½éƒ¨ç½²ï¼ˆdeployï¼‰</p>
</blockquote>
<p>12-Factoråº”ç”¨(è¯‘è€…æ³¨ï¼šåº”è¯¥æ˜¯è¯´ä¸€ä¸ªä½¿ç”¨æœ¬æ–‡æ¦‚å¿µæ¥è®¾è®¡çš„åº”ç”¨ï¼Œä¸‹åŒ)é€šå¸¸ä¼šä½¿ç”¨ç‰ˆæœ¬æ§åˆ¶ç³»ç»ŸåŠ ä»¥ç®¡ç†ï¼Œå¦‚Git, Mercurial, Subversionã€‚ä¸€ä»½ç”¨æ¥è·Ÿè¸ªä»£ç æ‰€æœ‰ä¿®è®¢ç‰ˆæœ¬çš„æ•°æ®åº“è¢«ç§°ä½œ ä»£ç åº“ï¼ˆcode repository, code repo, repoï¼‰ã€‚</p>
<p>åœ¨ç±»ä¼¼ SVN è¿™æ ·çš„é›†ä¸­å¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿä¸­ï¼ŒåŸºå‡†ä»£ç  å°±æ˜¯æŒ‡æ§åˆ¶ç³»ç»Ÿä¸­çš„è¿™ä¸€ä»½ä»£ç åº“ï¼›è€Œåœ¨ Git é‚£æ ·çš„åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿä¸­ï¼ŒåŸºå‡†ä»£ç  åˆ™æ˜¯æŒ‡æœ€ä¸Šæ¸¸çš„é‚£ä»½ä»£ç åº“ã€‚</p>
<p>ä¸€ä»½ä»£ç åº“å¯¹åº”å¤šä»½éƒ¨ç½²</p>
<p>åŸºå‡†ä»£ç å’Œåº”ç”¨ä¹‹é—´æ€»æ˜¯ä¿æŒä¸€ä¸€å¯¹åº”çš„å…³ç³»ï¼š</p>
<ul>
<li>ä¸€æ—¦æœ‰å¤šä¸ªåŸºå‡†ä»£ç ï¼Œå°±ä¸èƒ½ç§°ä¸ºä¸€ä¸ªåº”ç”¨ï¼Œè€Œæ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿã€‚åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„æ¯ä¸€ä¸ªç»„ä»¶éƒ½æ˜¯ä¸€ä¸ªåº”ç”¨ï¼Œæ¯ä¸€ä¸ªåº”ç”¨å¯ä»¥åˆ†åˆ«ä½¿ç”¨ 12-Factor è¿›è¡Œå¼€å‘ã€‚</li>
<li>å¤šä¸ªåº”ç”¨å…±äº«ä¸€ä»½åŸºå‡†ä»£ç æ˜¯æœ‰æ‚–äº 12-Factor åŸåˆ™çš„ã€‚è§£å†³æ–¹æ¡ˆæ˜¯å°†å…±äº«çš„ä»£ç æ‹†åˆ†ä¸ºç‹¬ç«‹çš„ç±»åº“ï¼Œç„¶åä½¿ç”¨ ä¾èµ–ç®¡ç† ç­–ç•¥å»åŠ è½½å®ƒä»¬ã€‚<br><img src="/2022/06/24/uncatalog/cl4s23b37000010r7cl0h25hd/codebase-deploys.png" alt="imag"></li>
</ul>
<p>å°½ç®¡æ¯ä¸ªåº”ç”¨åªå¯¹åº”ä¸€ä»½åŸºå‡†ä»£ç ï¼Œä½†å¯ä»¥åŒæ—¶å­˜åœ¨å¤šä»½éƒ¨ç½²ã€‚æ¯ä»½ éƒ¨ç½² ç›¸å½“äºè¿è¡Œäº†ä¸€ä¸ªåº”ç”¨çš„å®ä¾‹ã€‚é€šå¸¸ä¼šæœ‰ä¸€ä¸ªç”Ÿäº§ç¯å¢ƒï¼Œä¸€ä¸ªæˆ–å¤šä¸ªé¢„å‘å¸ƒç¯å¢ƒã€‚æ­¤å¤–ï¼Œæ¯ä¸ªå¼€å‘äººå‘˜éƒ½ä¼šåœ¨è‡ªå·±æœ¬åœ°ç¯å¢ƒè¿è¡Œä¸€ä¸ªåº”ç”¨å®ä¾‹ï¼Œè¿™äº›éƒ½ç›¸å½“äºä¸€ä»½éƒ¨ç½²ã€‚</p>
<p>æ‰€æœ‰éƒ¨ç½²çš„åŸºå‡†ä»£ç ç›¸åŒï¼Œä½†æ¯ä»½éƒ¨ç½²å¯ä»¥ä½¿ç”¨å…¶ä¸åŒçš„ç‰ˆæœ¬ã€‚æ¯”å¦‚ï¼Œå¼€å‘äººå‘˜å¯èƒ½æœ‰ä¸€äº›æäº¤è¿˜æ²¡æœ‰åŒæ­¥è‡³é¢„å‘å¸ƒç¯å¢ƒï¼›é¢„å‘å¸ƒç¯å¢ƒä¹Ÿæœ‰ä¸€äº›æäº¤æ²¡æœ‰åŒæ­¥è‡³ç”Ÿäº§ç¯å¢ƒã€‚ä½†å®ƒä»¬éƒ½å…±äº«ä¸€ä»½åŸºå‡†ä»£ç ï¼Œæˆ‘ä»¬å°±è®¤ä¸ºå®ƒä»¬åªæ˜¯ç›¸åŒåº”ç”¨çš„ä¸åŒéƒ¨ç½²è€Œå·²</p>
]]></content>
      <tags>
        <tag>The Twelve-Factor App</tag>
      </tags>
  </entry>
  <entry>
    <title>The Twelve-Factor App--II.Dependencies</title>
    <url>/2022/06/24/uncatalog/cl4s5aedb0000yor75ersbj7b/</url>
    <content><![CDATA[<hr>
<span id="more"></span>
<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>å¦‚ä»Šï¼Œè½¯ä»¶é€šå¸¸ä¼šä½œä¸ºä¸€ç§æœåŠ¡æ¥äº¤ä»˜ï¼Œå®ƒä»¬è¢«ç§°ä¸ºç½‘ç»œåº”ç”¨ç¨‹åºï¼Œæˆ–è½¯ä»¶å³æœåŠ¡ï¼ˆSaaSï¼‰ã€‚12-Factor ä¸ºæ„å»ºå¦‚ä¸‹çš„ SaaS åº”ç”¨æä¾›äº†æ–¹æ³•è®ºï¼š</p>
<ul>
<li>ä½¿ç”¨æ ‡å‡†åŒ–æµç¨‹è‡ªåŠ¨é…ç½®ï¼Œä»è€Œä½¿æ–°çš„å¼€å‘è€…èŠ±è´¹æœ€å°‘çš„å­¦ä¹ æˆæœ¬åŠ å…¥è¿™ä¸ªé¡¹ç›®ã€‚</li>
<li>å’Œæ“ä½œç³»ç»Ÿä¹‹é—´å°½å¯èƒ½çš„åˆ’æ¸…ç•Œé™ï¼Œåœ¨å„ä¸ªç³»ç»Ÿä¸­æä¾›æœ€å¤§çš„å¯ç§»æ¤æ€§ã€‚</li>
<li>é€‚åˆéƒ¨ç½²åœ¨ç°ä»£çš„äº‘è®¡ç®—å¹³å°ï¼Œä»è€Œåœ¨æœåŠ¡å™¨å’Œç³»ç»Ÿç®¡ç†æ–¹é¢èŠ‚çœèµ„æºã€‚</li>
<li>å°†å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒçš„å·®å¼‚é™è‡³æœ€ä½ï¼Œå¹¶ä½¿ç”¨æŒç»­äº¤ä»˜å®æ–½æ•æ·å¼€å‘ã€‚</li>
<li>å¯ä»¥åœ¨å·¥å…·ã€æ¶æ„å’Œå¼€å‘æµç¨‹ä¸å‘ç”Ÿæ˜æ˜¾å˜åŒ–çš„å‰æä¸‹å®ç°æ‰©å±•ã€‚<br>è¿™å¥—ç†è®ºé€‚ç”¨äºä»»æ„è¯­è¨€å’Œåç«¯æœåŠ¡ï¼ˆæ•°æ®åº“ã€æ¶ˆæ¯é˜Ÿåˆ—ã€ç¼“å­˜ç­‰ï¼‰å¼€å‘çš„åº”ç”¨ç¨‹åºã€‚</li>
</ul>
<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>è¿™å¥—æ–¹æ³•è®ºç”±Herokuçš„è”åˆåˆ›å§‹äººAdam Wigginså‘æ˜ï¼Œåº”ç”¨åˆ°äº†æ•°ä»¥ç™¾è®¡çš„åº”ç”¨ç¨‹åºçš„å¼€å‘å’Œéƒ¨ç½²ï¼Œå¹¶é€šè¿‡ Heroku å¹³å°é—´æ¥è§è¯äº†æ•°åä¸‡åº”ç”¨ç¨‹åºçš„å¼€å‘ï¼Œè¿ä½œä»¥åŠæ‰©å±•çš„è¿‡ç¨‹ã€‚</p>
<p><code>The Twelve-Factor App</code>ç³»åˆ—æ–‡ç« ï¼Œç»¼åˆäº†Heroåº“å…³äº SaaS åº”ç”¨å‡ ä¹æ‰€æœ‰çš„ç»éªŒå’Œæ™ºæ…§ï¼Œæ˜¯å¼€å‘æ­¤ç±»åº”ç”¨çš„ç†æƒ³å®è·µæ ‡å‡†ï¼Œå¹¶ç‰¹åˆ«å…³æ³¨äºåº”ç”¨ç¨‹åºå¦‚ä½•ä¿æŒè‰¯æ€§æˆé•¿ï¼Œå¼€å‘è€…ä¹‹é—´å¦‚ä½•è¿›è¡Œæœ‰æ•ˆçš„ä»£ç åä½œï¼Œä»¥åŠå¦‚ä½• é¿å…è½¯ä»¶æ±¡æŸ“ ã€‚</p>
<blockquote>
<p>è‹±æ–‡åŸæ–‡</p>
</blockquote>
<h3 id="II-Dependencies"><a href="#II-Dependencies" class="headerlink" title="II. Dependencies"></a>II. Dependencies</h3><blockquote>
<p>Explicitly declare and isolate dependencies</p>
</blockquote>
<p>Most programming languages offer a packaging system for distributing support libraries, such as CPAN for Perl or Rubygems for Ruby. Libraries installed through a packaging system can be installed system-wide (known as â€œsite packagesâ€) or scoped into the directory containing the app (known as â€œvendoringâ€ or â€œbundlingâ€).</p>
<p>A twelve-factor app never relies on implicit existence of system-wide packages. It declares all dependencies, completely and exactly, via a dependency declaration manifest. Furthermore, it uses a dependency isolation tool during execution to ensure that no implicit dependencies â€œleak inâ€ from the surrounding system. The full and explicit dependency specification is applied uniformly to both production and development.</p>
<p>For example, Bundler for Ruby offers the Gemfile manifest format for dependency declaration and bundle exec for dependency isolation. In Python there are two separate tools for these steps â€“ Pip is used for declaration and Virtualenv for isolation. Even C has Autoconf for dependency declaration, and static linking can provide dependency isolation. No matter what the toolchain, dependency declaration and isolation must always be used together â€“ only one or the other is not sufficient to satisfy twelve-factor.</p>
<p>One benefit of explicit dependency declaration is that it simplifies setup for developers new to the app. The new developer can check out the appâ€™s codebase onto their development machine, requiring only the language runtime and dependency manager installed as prerequisites. They will be able to set up everything needed to run the appâ€™s code with a deterministic build command. For example, the build command for Ruby/Bundler is bundle install, while for Clojure/Leiningen it is lein deps.</p>
<p>Twelve-factor apps also do not rely on the implicit existence of any system tools. Examples include shelling out to ImageMagick or curl. While these tools may exist on many or even most systems, there is no guarantee that they will exist on all systems where the app may run in the future, or whether the version found on a future system will be compatible with the app. If the app needs to shell out to a system tool, that tool should be vendored into the app.</p>
<blockquote>
<p>ä¸­æ–‡</p>
</blockquote>
<h3 id="II-ä¾èµ–"><a href="#II-ä¾èµ–" class="headerlink" title="II. ä¾èµ–"></a>II. ä¾èµ–</h3><blockquote>
<p>æ˜¾å¼å£°æ˜ä¾èµ–å…³ç³»ï¼ˆ dependency ï¼‰</p>
</blockquote>
<p>å¤§å¤šæ•°ç¼–ç¨‹è¯­è¨€éƒ½ä¼šæä¾›ä¸€ä¸ªæ‰“åŒ…ç³»ç»Ÿï¼Œç”¨æ¥ä¸ºå„ä¸ªç±»åº“æä¾›æ‰“åŒ…æœåŠ¡ï¼Œå°±åƒ Perl çš„ CPAN æˆ–æ˜¯ Ruby çš„ Rubygems ã€‚é€šè¿‡æ‰“åŒ…ç³»ç»Ÿå®‰è£…çš„ç±»åº“å¯ä»¥æ˜¯ç³»ç»Ÿçº§çš„ï¼ˆç§°ä¹‹ä¸º â€œsite packagesâ€ï¼‰ï¼Œæˆ–ä»…ä¾›æŸä¸ªåº”ç”¨ç¨‹åºä½¿ç”¨ï¼Œéƒ¨ç½²åœ¨ç›¸åº”çš„ç›®å½•ä¸­ï¼ˆç§°ä¹‹ä¸º â€œvendoringâ€ æˆ– â€œbundingâ€ï¼‰ã€‚</p>
<p>12-Factorè§„åˆ™ä¸‹çš„åº”ç”¨ç¨‹åºä¸ä¼šéšå¼ä¾èµ–ç³»ç»Ÿçº§çš„ç±»åº“ã€‚ å®ƒä¸€å®šé€šè¿‡ ä¾èµ–æ¸…å• ï¼Œç¡®åˆ‡åœ°å£°æ˜æ‰€æœ‰ä¾èµ–é¡¹ã€‚æ­¤å¤–ï¼Œåœ¨è¿è¡Œè¿‡ç¨‹ä¸­é€šè¿‡ ä¾èµ–éš”ç¦» å·¥å…·æ¥ç¡®ä¿ç¨‹åºä¸ä¼šè°ƒç”¨ç³»ç»Ÿä¸­å­˜åœ¨ä½†æ¸…å•ä¸­æœªå£°æ˜çš„ä¾èµ–é¡¹ã€‚è¿™ä¸€åšæ³•ä¼šç»Ÿä¸€åº”ç”¨åˆ°ç”Ÿäº§å’Œå¼€å‘ç¯å¢ƒã€‚</p>
<p>ä¾‹å¦‚ï¼Œ Ruby çš„ Bundler ä½¿ç”¨ Gemfile ä½œä¸ºä¾èµ–é¡¹å£°æ˜æ¸…å•ï¼Œä½¿ç”¨ bundle exec æ¥è¿›è¡Œä¾èµ–éš”ç¦»ã€‚Python ä¸­åˆ™å¯åˆ†åˆ«ä½¿ç”¨ä¸¤ç§å·¥å…· â€“ Pip ç”¨ä½œä¾èµ–å£°æ˜ï¼Œ Virtualenv ç”¨ä½œä¾èµ–éš”ç¦»ã€‚ç”šè‡³ C è¯­è¨€ä¹Ÿæœ‰ç±»ä¼¼å·¥å…·ï¼Œ Autoconf ç”¨ä½œä¾èµ–å£°æ˜ï¼Œé™æ€é“¾æ¥åº“ç”¨ä½œä¾èµ–éš”ç¦»ã€‚æ— è®ºç”¨ä»€ä¹ˆå·¥å…·ï¼Œä¾èµ–å£°æ˜å’Œä¾èµ–éš”ç¦»å¿…é¡»ä¸€èµ·ä½¿ç”¨ï¼Œå¦åˆ™æ— æ³•æ»¡è¶³ 12-Factor è§„èŒƒã€‚</p>
<p>æ˜¾å¼å£°æ˜ä¾èµ–çš„ä¼˜ç‚¹ä¹‹ä¸€æ˜¯ä¸ºæ–°è¿›å¼€å‘è€…ç®€åŒ–äº†ç¯å¢ƒé…ç½®æµç¨‹ã€‚æ–°è¿›å¼€å‘è€…å¯ä»¥æ£€å‡ºåº”ç”¨ç¨‹åºçš„åŸºå‡†ä»£ç ï¼Œå®‰è£…ç¼–ç¨‹è¯­è¨€ç¯å¢ƒå’Œå®ƒå¯¹åº”çš„ä¾èµ–ç®¡ç†å·¥å…·ï¼Œåªéœ€é€šè¿‡ä¸€ä¸ª æ„å»ºå‘½ä»¤ æ¥å®‰è£…æ‰€æœ‰çš„ä¾èµ–é¡¹ï¼Œå³å¯å¼€å§‹å·¥ä½œã€‚ä¾‹å¦‚ï¼ŒRuby/Bundler ä¸‹ä½¿ç”¨ bundle installï¼Œè€Œ Clojure/Leiningen åˆ™æ˜¯ lein depsã€‚</p>
<p>12-Factor åº”ç”¨åŒæ ·ä¸ä¼šéšå¼ä¾èµ–æŸäº›ç³»ç»Ÿå·¥å…·ï¼Œå¦‚ ImageMagick æˆ–æ˜¯curlã€‚å³ä½¿è¿™äº›å·¥å…·å­˜åœ¨äºå‡ ä¹æ‰€æœ‰ç³»ç»Ÿï¼Œä½†ç»ˆç©¶æ— æ³•ä¿è¯æ‰€æœ‰æœªæ¥çš„ç³»ç»Ÿéƒ½èƒ½æ”¯æŒåº”ç”¨é¡ºåˆ©è¿è¡Œï¼Œæˆ–æ˜¯èƒ½å¤Ÿå’Œåº”ç”¨å…¼å®¹ã€‚å¦‚æœåº”ç”¨å¿…é¡»ä½¿ç”¨åˆ°æŸäº›ç³»ç»Ÿå·¥å…·ï¼Œé‚£ä¹ˆè¿™äº›å·¥å…·åº”è¯¥è¢«åŒ…å«åœ¨åº”ç”¨ä¹‹ä¸­ã€‚</p>
]]></content>
      <tags>
        <tag>The Twelve-Factor App</tag>
      </tags>
  </entry>
  <entry>
    <title>The Twelve-Factor App--III.Config</title>
    <url>/2022/06/24/uncatalog/cl4s5aede0001yor787lle01q/</url>
    <content><![CDATA[<hr>
<span id="more"></span>
<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>å¦‚ä»Šï¼Œè½¯ä»¶é€šå¸¸ä¼šä½œä¸ºä¸€ç§æœåŠ¡æ¥äº¤ä»˜ï¼Œå®ƒä»¬è¢«ç§°ä¸ºç½‘ç»œåº”ç”¨ç¨‹åºï¼Œæˆ–è½¯ä»¶å³æœåŠ¡ï¼ˆSaaSï¼‰ã€‚12-Factor ä¸ºæ„å»ºå¦‚ä¸‹çš„ SaaS åº”ç”¨æä¾›äº†æ–¹æ³•è®ºï¼š</p>
<ul>
<li>ä½¿ç”¨æ ‡å‡†åŒ–æµç¨‹è‡ªåŠ¨é…ç½®ï¼Œä»è€Œä½¿æ–°çš„å¼€å‘è€…èŠ±è´¹æœ€å°‘çš„å­¦ä¹ æˆæœ¬åŠ å…¥è¿™ä¸ªé¡¹ç›®ã€‚</li>
<li>å’Œæ“ä½œç³»ç»Ÿä¹‹é—´å°½å¯èƒ½çš„åˆ’æ¸…ç•Œé™ï¼Œåœ¨å„ä¸ªç³»ç»Ÿä¸­æä¾›æœ€å¤§çš„å¯ç§»æ¤æ€§ã€‚</li>
<li>é€‚åˆéƒ¨ç½²åœ¨ç°ä»£çš„äº‘è®¡ç®—å¹³å°ï¼Œä»è€Œåœ¨æœåŠ¡å™¨å’Œç³»ç»Ÿç®¡ç†æ–¹é¢èŠ‚çœèµ„æºã€‚</li>
<li>å°†å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒçš„å·®å¼‚é™è‡³æœ€ä½ï¼Œå¹¶ä½¿ç”¨æŒç»­äº¤ä»˜å®æ–½æ•æ·å¼€å‘ã€‚</li>
<li>å¯ä»¥åœ¨å·¥å…·ã€æ¶æ„å’Œå¼€å‘æµç¨‹ä¸å‘ç”Ÿæ˜æ˜¾å˜åŒ–çš„å‰æä¸‹å®ç°æ‰©å±•ã€‚<br>è¿™å¥—ç†è®ºé€‚ç”¨äºä»»æ„è¯­è¨€å’Œåç«¯æœåŠ¡ï¼ˆæ•°æ®åº“ã€æ¶ˆæ¯é˜Ÿåˆ—ã€ç¼“å­˜ç­‰ï¼‰å¼€å‘çš„åº”ç”¨ç¨‹åºã€‚</li>
</ul>
<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>è¿™å¥—æ–¹æ³•è®ºç”±Herokuçš„è”åˆåˆ›å§‹äººAdam Wigginså‘æ˜ï¼Œåº”ç”¨åˆ°äº†æ•°ä»¥ç™¾è®¡çš„åº”ç”¨ç¨‹åºçš„å¼€å‘å’Œéƒ¨ç½²ï¼Œå¹¶é€šè¿‡ Heroku å¹³å°é—´æ¥è§è¯äº†æ•°åä¸‡åº”ç”¨ç¨‹åºçš„å¼€å‘ï¼Œè¿ä½œä»¥åŠæ‰©å±•çš„è¿‡ç¨‹ã€‚</p>
<p><code>The Twelve-Factor App</code>ç³»åˆ—æ–‡ç« ï¼Œç»¼åˆäº†Heroåº“å…³äº SaaS åº”ç”¨å‡ ä¹æ‰€æœ‰çš„ç»éªŒå’Œæ™ºæ…§ï¼Œæ˜¯å¼€å‘æ­¤ç±»åº”ç”¨çš„ç†æƒ³å®è·µæ ‡å‡†ï¼Œå¹¶ç‰¹åˆ«å…³æ³¨äºåº”ç”¨ç¨‹åºå¦‚ä½•ä¿æŒè‰¯æ€§æˆé•¿ï¼Œå¼€å‘è€…ä¹‹é—´å¦‚ä½•è¿›è¡Œæœ‰æ•ˆçš„ä»£ç åä½œï¼Œä»¥åŠå¦‚ä½• é¿å…è½¯ä»¶æ±¡æŸ“ ã€‚</p>
<blockquote>
<p>è‹±æ–‡åŸæ–‡</p>
</blockquote>
<h3 id="III-Config"><a href="#III-Config" class="headerlink" title="III. Config"></a>III. Config</h3><blockquote>
<p>Store config in the environment</p>
</blockquote>
<p>An appâ€™s config is everything that is likely to vary between deploys (staging, production, developer environments, etc). This includes:</p>
<ul>
<li>Resource handles to the database, Memcached, and other backing services</li>
<li>Credentials to external services such as Amazon S3 or Twitter</li>
<li>Per-deploy values such as the canonical hostname for the deploy<br>Apps sometimes store config as constants in the code. This is a violation of twelve-factor, which requires strict separation of config from code. Config varies substantially across deploys, code does not.</li>
</ul>
<p>A litmus test for whether an app has all config correctly factored out of the code is whether the codebase could be made open source at any moment, without compromising any credentials.</p>
<p>Note that this definition of â€œconfigâ€ does not include internal application config, such as config/routes.rb in Rails, or how code modules are connected in Spring. This type of config does not vary between deploys, and so is best done in the code.</p>
<p>Another approach to config is the use of config files which are not checked into revision control, such as config/database.yml in Rails. This is a huge improvement over using constants which are checked into the code repo, but still has weaknesses: itâ€™s easy to mistakenly check in a config file to the repo; there is a tendency for config files to be scattered about in different places and different formats, making it hard to see and manage all the config in one place. Further, these formats tend to be language- or framework-specific.</p>
<p>The twelve-factor app stores config in environment variables (often shortened to env vars or env). Env vars are easy to change between deploys without changing any code; unlike config files, there is little chance of them being checked into the code repo accidentally; and unlike custom config files, or other config mechanisms such as Java System Properties, they are a language- and OS-agnostic standard.</p>
<p>Another aspect of config management is grouping. Sometimes apps batch config into named groups (often called â€œenvironmentsâ€) named after specific deploys, such as the development, test, and production environments in Rails. This method does not scale cleanly: as more deploys of the app are created, new environment names are necessary, such as staging or qa. As the project grows further, developers may add their own special environments like joes-staging, resulting in a combinatorial explosion of config which makes managing deploys of the app very brittle.</p>
<p>In a twelve-factor app, env vars are granular controls, each fully orthogonal to other env vars. They are never grouped together as â€œenvironmentsâ€, but instead are independently managed for each deploy. This is a model that scales up smoothly as the app naturally expands into more deploys over its lifetime.</p>
<blockquote>
<p>ä¸­æ–‡</p>
</blockquote>
<h3 id="III-é…ç½®"><a href="#III-é…ç½®" class="headerlink" title="III. é…ç½®"></a>III. é…ç½®</h3><blockquote>
<p>åœ¨ç¯å¢ƒä¸­å­˜å‚¨é…ç½®</p>
</blockquote>
<p>é€šå¸¸ï¼Œåº”ç”¨çš„ é…ç½® åœ¨ä¸åŒ éƒ¨ç½² (é¢„å‘å¸ƒã€ç”Ÿäº§ç¯å¢ƒã€å¼€å‘ç¯å¢ƒç­‰ç­‰)é—´ä¼šæœ‰å¾ˆå¤§å·®å¼‚ã€‚è¿™å…¶ä¸­åŒ…æ‹¬ï¼š</p>
<ul>
<li>æ•°æ®åº“ï¼ŒMemcachedï¼Œä»¥åŠå…¶ä»– åç«¯æœåŠ¡ çš„é…ç½®</li>
<li>ç¬¬ä¸‰æ–¹æœåŠ¡çš„è¯ä¹¦ï¼Œå¦‚ Amazon S3ã€Twitter ç­‰</li>
<li>æ¯ä»½éƒ¨ç½²ç‰¹æœ‰çš„é…ç½®ï¼Œå¦‚åŸŸåç­‰</li>
</ul>
<p>æœ‰äº›åº”ç”¨åœ¨ä»£ç ä¸­ä½¿ç”¨å¸¸é‡ä¿å­˜é…ç½®ï¼Œè¿™ä¸ 12-Factor æ‰€è¦æ±‚çš„ä»£ç å’Œé…ç½®ä¸¥æ ¼åˆ†ç¦»æ˜¾ç„¶å¤§ç›¸å¾„åº­ã€‚é…ç½®æ–‡ä»¶åœ¨å„éƒ¨ç½²é—´å­˜åœ¨å¤§å¹…å·®å¼‚ï¼Œä»£ç å´å®Œå…¨ä¸€è‡´ã€‚</p>
<p>åˆ¤æ–­ä¸€ä¸ªåº”ç”¨æ˜¯å¦æ­£ç¡®åœ°å°†é…ç½®æ’é™¤åœ¨ä»£ç ä¹‹å¤–ï¼Œä¸€ä¸ªç®€å•çš„æ–¹æ³•æ˜¯çœ‹è¯¥åº”ç”¨çš„åŸºå‡†ä»£ç æ˜¯å¦å¯ä»¥ç«‹åˆ»å¼€æºï¼Œè€Œä¸ç”¨æ‹…å¿ƒä¼šæš´éœ²ä»»ä½•æ•æ„Ÿçš„ä¿¡æ¯ã€‚</p>
<p>éœ€è¦æŒ‡å‡ºçš„æ˜¯ï¼Œè¿™é‡Œå®šä¹‰çš„â€œé…ç½®â€å¹¶ä¸åŒ…æ‹¬åº”ç”¨çš„å†…éƒ¨é…ç½®ï¼Œæ¯”å¦‚ Rails çš„ config/routes.rbï¼Œæˆ–æ˜¯ä½¿ç”¨ Spring æ—¶ ä»£ç æ¨¡å—é—´çš„ä¾èµ–æ³¨å…¥å…³ç³» ã€‚è¿™ç±»é…ç½®åœ¨ä¸åŒéƒ¨ç½²é—´ä¸å­˜åœ¨å·®å¼‚ï¼Œæ‰€ä»¥åº”è¯¥å†™å…¥ä»£ç ã€‚</p>
<p>å¦å¤–ä¸€ä¸ªè§£å†³æ–¹æ³•æ˜¯ä½¿ç”¨é…ç½®æ–‡ä»¶ï¼Œä½†ä¸æŠŠå®ƒä»¬çº³å…¥ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œå°±åƒ Rails çš„ config/database.yml ã€‚è¿™ç›¸å¯¹äºåœ¨ä»£ç ä¸­ä½¿ç”¨å¸¸é‡å·²ç»æ˜¯é•¿è¶³è¿›æ­¥ï¼Œä½†ä»ç„¶æœ‰ç¼ºç‚¹ï¼šæ€»æ˜¯ä¼šä¸å°å¿ƒå°†é…ç½®æ–‡ä»¶ç­¾å…¥äº†ä»£ç åº“ï¼›é…ç½®æ–‡ä»¶çš„å¯èƒ½ä¼šåˆ†æ•£åœ¨ä¸åŒçš„ç›®å½•ï¼Œå¹¶æœ‰ç€ä¸åŒçš„æ ¼å¼ï¼Œè¿™è®©æ‰¾å‡ºä¸€ä¸ªåœ°æ–¹æ¥ç»Ÿä¸€ç®¡ç†æ‰€æœ‰é…ç½®å˜çš„ä¸å¤ªç°å®ã€‚æ›´ç³Ÿçš„æ˜¯ï¼Œè¿™äº›æ ¼å¼é€šå¸¸æ˜¯è¯­è¨€æˆ–æ¡†æ¶ç‰¹å®šçš„ã€‚</p>
<p>12-Factoræ¨èå°†åº”ç”¨çš„é…ç½®å­˜å‚¨äº ç¯å¢ƒå˜é‡ ä¸­ï¼ˆ env vars, env ï¼‰ã€‚ç¯å¢ƒå˜é‡å¯ä»¥éå¸¸æ–¹ä¾¿åœ°åœ¨ä¸åŒçš„éƒ¨ç½²é—´åšä¿®æ”¹ï¼Œå´ä¸åŠ¨ä¸€è¡Œä»£ç ï¼›ä¸é…ç½®æ–‡ä»¶ä¸åŒï¼Œä¸å°å¿ƒæŠŠå®ƒä»¬ç­¾å…¥ä»£ç åº“çš„æ¦‚ç‡å¾®ä¹å…¶å¾®ï¼›ä¸ä¸€äº›ä¼ ç»Ÿçš„è§£å†³é…ç½®é—®é¢˜çš„æœºåˆ¶ï¼ˆæ¯”å¦‚ Java çš„å±æ€§é…ç½®æ–‡ä»¶ï¼‰ç›¸æ¯”ï¼Œç¯å¢ƒå˜é‡ä¸è¯­è¨€å’Œç³»ç»Ÿæ— å…³ã€‚</p>
<p>é…ç½®ç®¡ç†çš„å¦ä¸€ä¸ªæ–¹é¢æ˜¯åˆ†ç»„ã€‚æœ‰æ—¶åº”ç”¨ä¼šå°†é…ç½®æŒ‰ç…§ç‰¹å®šéƒ¨ç½²è¿›è¡Œåˆ†ç»„ï¼ˆæˆ–å«åšâ€œç¯å¢ƒâ€ï¼‰ï¼Œä¾‹å¦‚Railsä¸­çš„ development,test, å’Œ production ç¯å¢ƒã€‚è¿™ç§æ–¹æ³•æ— æ³•è½»æ˜“æ‰©å±•ï¼šæ›´å¤šéƒ¨ç½²æ„å‘³ç€æ›´å¤šæ–°çš„ç¯å¢ƒï¼Œä¾‹å¦‚ staging æˆ– qa ã€‚ éšç€é¡¹ç›®çš„ä¸æ–­æ·±å…¥ï¼Œå¼€å‘äººå‘˜å¯èƒ½è¿˜ä¼šæ·»åŠ ä»–ä»¬è‡ªå·±çš„ç¯å¢ƒï¼Œæ¯”å¦‚ joes-staging ï¼Œè¿™å°†å¯¼è‡´å„ç§é…ç½®ç»„åˆçš„æ¿€å¢ï¼Œä»è€Œç»™ç®¡ç†éƒ¨ç½²å¢åŠ äº†å¾ˆå¤šä¸ç¡®å®šå› ç´ ã€‚</p>
<p>12-Factor åº”ç”¨ä¸­ï¼Œç¯å¢ƒå˜é‡çš„ç²’åº¦è¦è¶³å¤Ÿå°ï¼Œä¸”ç›¸å¯¹ç‹¬ç«‹ã€‚å®ƒä»¬æ°¸è¿œä¹Ÿä¸ä¼šç»„åˆæˆä¸€ä¸ªæ‰€è°“çš„â€œç¯å¢ƒâ€ï¼Œè€Œæ˜¯ç‹¬ç«‹å­˜åœ¨äºæ¯ä¸ªéƒ¨ç½²ä¹‹ä¸­ã€‚å½“åº”ç”¨ç¨‹åºä¸æ–­æ‰©å±•ï¼Œéœ€è¦æ›´å¤šç§ç±»çš„éƒ¨ç½²æ—¶ï¼Œè¿™ç§é…ç½®ç®¡ç†æ–¹å¼èƒ½å¤Ÿåšåˆ°å¹³æ»‘è¿‡æ¸¡ã€‚</p>
]]></content>
      <tags>
        <tag>The Twelve-Factor App</tag>
      </tags>
  </entry>
  <entry>
    <title>The Twelve-Factor App--IV.Backing_services</title>
    <url>/2022/06/24/uncatalog/cl4s5aedf0003yor755fd317a/</url>
    <content><![CDATA[<hr>
<span id="more"></span>
<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>å¦‚ä»Šï¼Œè½¯ä»¶é€šå¸¸ä¼šä½œä¸ºä¸€ç§æœåŠ¡æ¥äº¤ä»˜ï¼Œå®ƒä»¬è¢«ç§°ä¸ºç½‘ç»œåº”ç”¨ç¨‹åºï¼Œæˆ–è½¯ä»¶å³æœåŠ¡ï¼ˆSaaSï¼‰ã€‚12-Factor ä¸ºæ„å»ºå¦‚ä¸‹çš„ SaaS åº”ç”¨æä¾›äº†æ–¹æ³•è®ºï¼š</p>
<ul>
<li>ä½¿ç”¨æ ‡å‡†åŒ–æµç¨‹è‡ªåŠ¨é…ç½®ï¼Œä»è€Œä½¿æ–°çš„å¼€å‘è€…èŠ±è´¹æœ€å°‘çš„å­¦ä¹ æˆæœ¬åŠ å…¥è¿™ä¸ªé¡¹ç›®ã€‚</li>
<li>å’Œæ“ä½œç³»ç»Ÿä¹‹é—´å°½å¯èƒ½çš„åˆ’æ¸…ç•Œé™ï¼Œåœ¨å„ä¸ªç³»ç»Ÿä¸­æä¾›æœ€å¤§çš„å¯ç§»æ¤æ€§ã€‚</li>
<li>é€‚åˆéƒ¨ç½²åœ¨ç°ä»£çš„äº‘è®¡ç®—å¹³å°ï¼Œä»è€Œåœ¨æœåŠ¡å™¨å’Œç³»ç»Ÿç®¡ç†æ–¹é¢èŠ‚çœèµ„æºã€‚</li>
<li>å°†å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒçš„å·®å¼‚é™è‡³æœ€ä½ï¼Œå¹¶ä½¿ç”¨æŒç»­äº¤ä»˜å®æ–½æ•æ·å¼€å‘ã€‚</li>
<li>å¯ä»¥åœ¨å·¥å…·ã€æ¶æ„å’Œå¼€å‘æµç¨‹ä¸å‘ç”Ÿæ˜æ˜¾å˜åŒ–çš„å‰æä¸‹å®ç°æ‰©å±•ã€‚<br>è¿™å¥—ç†è®ºé€‚ç”¨äºä»»æ„è¯­è¨€å’Œåç«¯æœåŠ¡ï¼ˆæ•°æ®åº“ã€æ¶ˆæ¯é˜Ÿåˆ—ã€ç¼“å­˜ç­‰ï¼‰å¼€å‘çš„åº”ç”¨ç¨‹åºã€‚</li>
</ul>
<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>è¿™å¥—æ–¹æ³•è®ºç”±Herokuçš„è”åˆåˆ›å§‹äººAdam Wigginså‘æ˜ï¼Œåº”ç”¨åˆ°äº†æ•°ä»¥ç™¾è®¡çš„åº”ç”¨ç¨‹åºçš„å¼€å‘å’Œéƒ¨ç½²ï¼Œå¹¶é€šè¿‡ Heroku å¹³å°é—´æ¥è§è¯äº†æ•°åä¸‡åº”ç”¨ç¨‹åºçš„å¼€å‘ï¼Œè¿ä½œä»¥åŠæ‰©å±•çš„è¿‡ç¨‹ã€‚</p>
<p><code>The Twelve-Factor App</code>ç³»åˆ—æ–‡ç« ï¼Œç»¼åˆäº†Heroåº“å…³äº SaaS åº”ç”¨å‡ ä¹æ‰€æœ‰çš„ç»éªŒå’Œæ™ºæ…§ï¼Œæ˜¯å¼€å‘æ­¤ç±»åº”ç”¨çš„ç†æƒ³å®è·µæ ‡å‡†ï¼Œå¹¶ç‰¹åˆ«å…³æ³¨äºåº”ç”¨ç¨‹åºå¦‚ä½•ä¿æŒè‰¯æ€§æˆé•¿ï¼Œå¼€å‘è€…ä¹‹é—´å¦‚ä½•è¿›è¡Œæœ‰æ•ˆçš„ä»£ç åä½œï¼Œä»¥åŠå¦‚ä½• é¿å…è½¯ä»¶æ±¡æŸ“ ã€‚</p>
<blockquote>
<p>è‹±æ–‡åŸæ–‡</p>
</blockquote>
<h3 id="IV-Backing-services"><a href="#IV-Backing-services" class="headerlink" title="IV. Backing services"></a>IV. Backing services</h3><blockquote>
<p>Treat backing services as attached resources</p>
</blockquote>
<p>A backing service is any service the app consumes over the network as part of its normal operation. Examples include datastores (such as MySQL or CouchDB), messaging/queueing systems (such as RabbitMQ or Beanstalkd), SMTP services for outbound email (such as Postfix), and caching systems (such as Memcached).</p>
<p>Backing services like the database are traditionally managed by the same systems administrators who deploy the appâ€™s runtime. In addition to these locally-managed services, the app may also have services provided and managed by third parties. Examples include SMTP services (such as Postmark), metrics-gathering services (such as New Relic or Loggly), binary asset services (such as Amazon S3), and even API-accessible consumer services (such as Twitter, Google Maps, or Last.fm).</p>
<p>The code for a twelve-factor app makes no distinction between local and third party services. To the app, both are attached resources, accessed via a URL or other locator/credentials stored in the config. A deploy of the twelve-factor app should be able to swap out a local MySQL database with one managed by a third party (such as Amazon RDS) without any changes to the appâ€™s code. Likewise, a local SMTP server could be swapped with a third-party SMTP service (such as Postmark) without code changes. In both cases, only the resource handle in the config needs to change.</p>
<p>Each distinct backing service is a resource. For example, a MySQL database is a resource; two MySQL databases (used for sharding at the application layer) qualify as two distinct resources. The twelve-factor app treats these databases as attached resources, which indicates their loose coupling to the deploy they are attached to.<br><img src="/2022/06/24/uncatalog/cl4s5aedf0003yor755fd317a/attached-resources.png" alt="image"><br>Resources can be attached to and detached from deploys at will. For example, if the appâ€™s database is misbehaving due to a hardware issue, the appâ€™s administrator might spin up a new database server restored from a recent backup. The current production database could be detached, and the new database attached â€“ all without any code changes.</p>
<blockquote>
<p>ä¸­æ–‡</p>
</blockquote>
<h3 id="IV-åç«¯æœåŠ¡"><a href="#IV-åç«¯æœåŠ¡" class="headerlink" title="IV. åç«¯æœåŠ¡"></a>IV. åç«¯æœåŠ¡</h3><blockquote>
<p>æŠŠåç«¯æœåŠ¡(backing services)å½“ä½œé™„åŠ èµ„æº</p>
</blockquote>
<p>åç«¯æœåŠ¡æ˜¯æŒ‡ç¨‹åºè¿è¡Œæ‰€éœ€è¦çš„é€šè¿‡ç½‘ç»œè°ƒç”¨çš„å„ç§æœåŠ¡ï¼Œå¦‚æ•°æ®åº“ï¼ˆMySQLï¼ŒCouchDBï¼‰ï¼Œæ¶ˆæ¯/é˜Ÿåˆ—ç³»ç»Ÿï¼ˆRabbitMQï¼ŒBeanstalkdï¼‰ï¼ŒSMTP é‚®ä»¶å‘é€æœåŠ¡ï¼ˆPostfixï¼‰ï¼Œä»¥åŠç¼“å­˜ç³»ç»Ÿï¼ˆMemcachedï¼‰ã€‚</p>
<p>ç±»ä¼¼æ•°æ®åº“çš„åç«¯æœåŠ¡ï¼Œé€šå¸¸ç”±éƒ¨ç½²åº”ç”¨ç¨‹åºçš„ç³»ç»Ÿç®¡ç†å‘˜ä¸€èµ·ç®¡ç†ã€‚é™¤äº†æœ¬åœ°æœåŠ¡ä¹‹å¤–ï¼Œåº”ç”¨ç¨‹åºæœ‰å¯èƒ½ä½¿ç”¨äº†ç¬¬ä¸‰æ–¹å‘å¸ƒå’Œç®¡ç†çš„æœåŠ¡ã€‚ç¤ºä¾‹åŒ…æ‹¬ SMTPï¼ˆä¾‹å¦‚ Postmarkï¼‰ï¼Œæ•°æ®æ”¶é›†æœåŠ¡ï¼ˆä¾‹å¦‚ New Relic æˆ– Logglyï¼‰ï¼Œæ•°æ®å­˜å‚¨æœåŠ¡ï¼ˆå¦‚ Amazon S3ï¼‰ï¼Œä»¥åŠä½¿ç”¨ API è®¿é—®çš„æœåŠ¡ï¼ˆä¾‹å¦‚ Twitter, Google Maps, Last.fmï¼‰ã€‚</p>
<p>12-Factor åº”ç”¨ä¸ä¼šåŒºåˆ«å¯¹å¾…æœ¬åœ°æˆ–ç¬¬ä¸‰æ–¹æœåŠ¡ã€‚ å¯¹åº”ç”¨ç¨‹åºè€Œè¨€ï¼Œä¸¤ç§éƒ½æ˜¯é™„åŠ èµ„æºï¼Œé€šè¿‡ä¸€ä¸ª url æˆ–æ˜¯å…¶ä»–å­˜å‚¨åœ¨ é…ç½® ä¸­çš„æœåŠ¡å®šä½/æœåŠ¡è¯ä¹¦æ¥è·å–æ•°æ®ã€‚12-Factor åº”ç”¨çš„ä»»æ„ éƒ¨ç½² ï¼Œéƒ½åº”è¯¥å¯ä»¥åœ¨ä¸è¿›è¡Œä»»ä½•ä»£ç æ”¹åŠ¨çš„æƒ…å†µä¸‹ï¼Œå°†æœ¬åœ° MySQL æ•°æ®åº“æ¢æˆç¬¬ä¸‰æ–¹æœåŠ¡ï¼ˆä¾‹å¦‚ Amazon RDSï¼‰ã€‚ç±»ä¼¼çš„ï¼Œæœ¬åœ° SMTP æœåŠ¡åº”è¯¥ä¹Ÿå¯ä»¥å’Œç¬¬ä¸‰æ–¹ SMTP æœåŠ¡ï¼ˆä¾‹å¦‚ Postmark ï¼‰äº’æ¢ã€‚ä¸Šè¿° 2 ä¸ªä¾‹å­ä¸­ï¼Œä»…éœ€ä¿®æ”¹é…ç½®ä¸­çš„èµ„æºåœ°å€ã€‚</p>
<p>æ¯ä¸ªä¸åŒçš„åç«¯æœåŠ¡æ˜¯ä¸€ä»½ èµ„æº ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ª MySQL æ•°æ®åº“æ˜¯ä¸€ä¸ªèµ„æºï¼Œä¸¤ä¸ª MySQL æ•°æ®åº“ï¼ˆç”¨æ¥æ•°æ®åˆ†åŒºï¼‰å°±è¢«å½“ä½œæ˜¯ 2 ä¸ªä¸åŒçš„èµ„æºã€‚12-Factor åº”ç”¨å°†è¿™äº›æ•°æ®åº“éƒ½è§†ä½œ é™„åŠ èµ„æº ï¼Œè¿™äº›èµ„æºå’Œå®ƒä»¬é™„å±çš„éƒ¨ç½²ä¿æŒæ¾è€¦åˆã€‚<br><img src="/2022/06/24/uncatalog/cl4s5aedf0003yor755fd317a/attached-resources.png" alt="image"><br>éƒ¨ç½²å¯ä»¥æŒ‰éœ€åŠ è½½æˆ–å¸è½½èµ„æºã€‚ä¾‹å¦‚ï¼Œå¦‚æœåº”ç”¨çš„æ•°æ®åº“æœåŠ¡ç”±äºç¡¬ä»¶é—®é¢˜å‡ºç°å¼‚å¸¸ï¼Œç®¡ç†å‘˜å¯ä»¥ä»æœ€è¿‘çš„å¤‡ä»½ä¸­æ¢å¤ä¸€ä¸ªæ•°æ®åº“ï¼Œå¸è½½å½“å‰çš„æ•°æ®åº“ï¼Œç„¶ååŠ è½½æ–°çš„æ•°æ®åº“ â€“ æ•´ä¸ªè¿‡ç¨‹éƒ½ä¸éœ€è¦ä¿®æ”¹ä»£ç ã€‚</p>
]]></content>
      <tags>
        <tag>The Twelve-Factor App</tag>
      </tags>
  </entry>
  <entry>
    <title>The Twelve-Factor App--IX.Disposability</title>
    <url>/2022/06/24/uncatalog/cl4s5aedi0005yor703iffxzw/</url>
    <content><![CDATA[<hr>
<span id="more"></span>
<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>å¦‚ä»Šï¼Œè½¯ä»¶é€šå¸¸ä¼šä½œä¸ºä¸€ç§æœåŠ¡æ¥äº¤ä»˜ï¼Œå®ƒä»¬è¢«ç§°ä¸ºç½‘ç»œåº”ç”¨ç¨‹åºï¼Œæˆ–è½¯ä»¶å³æœåŠ¡ï¼ˆSaaSï¼‰ã€‚12-Factor ä¸ºæ„å»ºå¦‚ä¸‹çš„ SaaS åº”ç”¨æä¾›äº†æ–¹æ³•è®ºï¼š</p>
<ul>
<li>ä½¿ç”¨æ ‡å‡†åŒ–æµç¨‹è‡ªåŠ¨é…ç½®ï¼Œä»è€Œä½¿æ–°çš„å¼€å‘è€…èŠ±è´¹æœ€å°‘çš„å­¦ä¹ æˆæœ¬åŠ å…¥è¿™ä¸ªé¡¹ç›®ã€‚</li>
<li>å’Œæ“ä½œç³»ç»Ÿä¹‹é—´å°½å¯èƒ½çš„åˆ’æ¸…ç•Œé™ï¼Œåœ¨å„ä¸ªç³»ç»Ÿä¸­æä¾›æœ€å¤§çš„å¯ç§»æ¤æ€§ã€‚</li>
<li>é€‚åˆéƒ¨ç½²åœ¨ç°ä»£çš„äº‘è®¡ç®—å¹³å°ï¼Œä»è€Œåœ¨æœåŠ¡å™¨å’Œç³»ç»Ÿç®¡ç†æ–¹é¢èŠ‚çœèµ„æºã€‚</li>
<li>å°†å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒçš„å·®å¼‚é™è‡³æœ€ä½ï¼Œå¹¶ä½¿ç”¨æŒç»­äº¤ä»˜å®æ–½æ•æ·å¼€å‘ã€‚</li>
<li>å¯ä»¥åœ¨å·¥å…·ã€æ¶æ„å’Œå¼€å‘æµç¨‹ä¸å‘ç”Ÿæ˜æ˜¾å˜åŒ–çš„å‰æä¸‹å®ç°æ‰©å±•ã€‚<br>è¿™å¥—ç†è®ºé€‚ç”¨äºä»»æ„è¯­è¨€å’Œåç«¯æœåŠ¡ï¼ˆæ•°æ®åº“ã€æ¶ˆæ¯é˜Ÿåˆ—ã€ç¼“å­˜ç­‰ï¼‰å¼€å‘çš„åº”ç”¨ç¨‹åºã€‚</li>
</ul>
<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>è¿™å¥—æ–¹æ³•è®ºç”±Herokuçš„è”åˆåˆ›å§‹äººAdam Wigginså‘æ˜ï¼Œåº”ç”¨åˆ°äº†æ•°ä»¥ç™¾è®¡çš„åº”ç”¨ç¨‹åºçš„å¼€å‘å’Œéƒ¨ç½²ï¼Œå¹¶é€šè¿‡ Heroku å¹³å°é—´æ¥è§è¯äº†æ•°åä¸‡åº”ç”¨ç¨‹åºçš„å¼€å‘ï¼Œè¿ä½œä»¥åŠæ‰©å±•çš„è¿‡ç¨‹ã€‚</p>
<p><code>The Twelve-Factor App</code>ç³»åˆ—æ–‡ç« ï¼Œç»¼åˆäº†Heroåº“å…³äº SaaS åº”ç”¨å‡ ä¹æ‰€æœ‰çš„ç»éªŒå’Œæ™ºæ…§ï¼Œæ˜¯å¼€å‘æ­¤ç±»åº”ç”¨çš„ç†æƒ³å®è·µæ ‡å‡†ï¼Œå¹¶ç‰¹åˆ«å…³æ³¨äºåº”ç”¨ç¨‹åºå¦‚ä½•ä¿æŒè‰¯æ€§æˆé•¿ï¼Œå¼€å‘è€…ä¹‹é—´å¦‚ä½•è¿›è¡Œæœ‰æ•ˆçš„ä»£ç åä½œï¼Œä»¥åŠå¦‚ä½• é¿å…è½¯ä»¶æ±¡æŸ“ ã€‚</p>
<blockquote>
<p>è‹±æ–‡åŸæ–‡</p>
</blockquote>
<h3 id="IX-Disposability"><a href="#IX-Disposability" class="headerlink" title="IX. Disposability"></a>IX. Disposability</h3><blockquote>
<p>Maximize robustness with fast startup and graceful shutdown</p>
</blockquote>
<p>The twelve-factor appâ€™s processes are disposable, meaning they can be started or stopped at a momentâ€™s notice. This facilitates fast elastic scaling, rapid deployment of code or config changes, and robustness of production deploys.</p>
<p>Processes should strive to minimize startup time. Ideally, a process takes a few seconds from the time the launch command is executed until the process is up and ready to receive requests or jobs. Short startup time provides more agility for the release process and scaling up; and it aids robustness, because the process manager can more easily move processes to new physical machines when warranted.</p>
<p>Processes shut down gracefully when they receive a SIGTERM signal from the process manager. For a web process, graceful shutdown is achieved by ceasing to listen on the service port (thereby refusing any new requests), allowing any current requests to finish, and then exiting. Implicit in this model is that HTTP requests are short (no more than a few seconds), or in the case of long polling, the client should seamlessly attempt to reconnect when the connection is lost.</p>
<p>For a worker process, graceful shutdown is achieved by returning the current job to the work queue. For example, on RabbitMQ the worker can send a NACK; on Beanstalkd, the job is returned to the queue automatically whenever a worker disconnects. Lock-based systems such as Delayed Job need to be sure to release their lock on the job record. Implicit in this model is that all jobs are reentrant, which typically is achieved by wrapping the results in a transaction, or making the operation idempotent.</p>
<p>Processes should also be robust against sudden death, in the case of a failure in the underlying hardware. While this is a much less common occurrence than a graceful shutdown with SIGTERM, it can still happen. A recommended approach is use of a robust queueing backend, such as Beanstalkd, that returns jobs to the queue when clients disconnect or time out. Either way, a twelve-factor app is architected to handle unexpected, non-graceful terminations. Crash-only design takes this concept to its logical conclusion.</p>
<blockquote>
<p>ä¸­æ–‡</p>
</blockquote>
<h3 id="IX-æ˜“å¤„ç†"><a href="#IX-æ˜“å¤„ç†" class="headerlink" title="IX. æ˜“å¤„ç†"></a>IX. æ˜“å¤„ç†</h3><blockquote>
<p>å¿«é€Ÿå¯åŠ¨å’Œä¼˜é›…ç»ˆæ­¢å¯æœ€å¤§åŒ–å¥å£®æ€§</p>
</blockquote>
<p>12-Factor åº”ç”¨çš„ è¿›ç¨‹ æ˜¯ æ˜“å¤„ç†ï¼ˆdisposableï¼‰çš„ï¼Œæ„æ€æ˜¯è¯´å®ƒä»¬å¯ä»¥ç¬é—´å¼€å¯æˆ–åœæ­¢ã€‚ è¿™æœ‰åˆ©äºå¿«é€Ÿã€å¼¹æ€§çš„ä¼¸ç¼©åº”ç”¨ï¼Œè¿…é€Ÿéƒ¨ç½²å˜åŒ–çš„ ä»£ç  æˆ– é…ç½® ï¼Œç¨³å¥çš„éƒ¨ç½²åº”ç”¨ã€‚</p>
<p>è¿›ç¨‹åº”å½“è¿½æ±‚ æœ€å°å¯åŠ¨æ—¶é—´ ã€‚ ç†æƒ³çŠ¶æ€ä¸‹ï¼Œè¿›ç¨‹ä»æ•²ä¸‹å‘½ä»¤åˆ°çœŸæ­£å¯åŠ¨å¹¶ç­‰å¾…è¯·æ±‚çš„æ—¶é—´åº”è¯¥åªéœ€å¾ˆçŸ­çš„æ—¶é—´ã€‚æ›´å°‘çš„å¯åŠ¨æ—¶é—´æä¾›äº†æ›´æ•æ·çš„ å‘å¸ƒ ä»¥åŠæ‰©å±•è¿‡ç¨‹ï¼Œæ­¤å¤–è¿˜å¢åŠ äº†å¥å£®æ€§ï¼Œå› ä¸ºè¿›ç¨‹ç®¡ç†å™¨å¯ä»¥åœ¨æˆæƒæƒ…å½¢ä¸‹å®¹æ˜“çš„å°†è¿›ç¨‹æ¬åˆ°æ–°çš„ç‰©ç†æœºå™¨ä¸Šã€‚</p>
<p>è¿›ç¨‹ ä¸€æ—¦æ¥æ”¶ ç»ˆæ­¢ä¿¡å·ï¼ˆSIGTERMï¼‰ å°±ä¼šä¼˜é›…çš„ç»ˆæ­¢ ã€‚å°±ç½‘ç»œè¿›ç¨‹è€Œè¨€ï¼Œä¼˜é›…ç»ˆæ­¢æ˜¯æŒ‡åœæ­¢ç›‘å¬æœåŠ¡çš„ç«¯å£ï¼Œå³æ‹’ç»æ‰€æœ‰æ–°çš„è¯·æ±‚ï¼Œå¹¶ç»§ç»­æ‰§è¡Œå½“å‰å·²æ¥æ”¶çš„è¯·æ±‚ï¼Œç„¶åé€€å‡ºã€‚æ­¤ç±»å‹çš„è¿›ç¨‹æ‰€éšå«çš„è¦æ±‚æ˜¯HTTPè¯·æ±‚å¤§å¤šéƒ½å¾ˆçŸ­(ä¸ä¼šè¶…è¿‡å‡ ç§’é’Ÿ)ï¼Œè€Œåœ¨é•¿æ—¶é—´è½®è¯¢ä¸­ï¼Œå®¢æˆ·ç«¯åœ¨ä¸¢å¤±è¿æ¥ååº”è¯¥é©¬ä¸Šå°è¯•é‡è¿ã€‚</p>
<p>å¯¹äº worker è¿›ç¨‹æ¥è¯´ï¼Œä¼˜é›…ç»ˆæ­¢æ˜¯æŒ‡å°†å½“å‰ä»»åŠ¡é€€å›é˜Ÿåˆ—ã€‚ä¾‹å¦‚ï¼ŒRabbitMQ ä¸­ï¼Œworker å¯ä»¥å‘é€ä¸€ä¸ªNACKä¿¡å·ã€‚ Beanstalkd ä¸­ï¼Œä»»åŠ¡ç»ˆæ­¢å¹¶é€€å›é˜Ÿåˆ—ä¼šåœ¨workeræ–­å¼€æ—¶è‡ªåŠ¨è§¦å‘ã€‚æœ‰é”æœºåˆ¶çš„ç³»ç»Ÿè¯¸å¦‚ Delayed Job åˆ™éœ€è¦ç¡®å®šé‡Šæ”¾äº†ç³»ç»Ÿèµ„æºã€‚æ­¤ç±»å‹çš„è¿›ç¨‹æ‰€éšå«çš„è¦æ±‚æ˜¯ï¼Œä»»åŠ¡éƒ½åº”è¯¥ å¯é‡å¤æ‰§è¡Œ ï¼Œ è¿™ä¸»è¦ç”±å°†ç»“æœåŒ…è£…è¿›äº‹åŠ¡æˆ–æ˜¯ä½¿é‡å¤æ“ä½œ å¹‚ç­‰ æ¥å®ç°ã€‚</p>
<p>è¿›ç¨‹è¿˜åº”å½“åœ¨é¢å¯¹çªç„¶æ­»äº¡æ—¶ä¿æŒå¥å£®ï¼Œä¾‹å¦‚åº•å±‚ç¡¬ä»¶æ•…éšœã€‚è™½ç„¶è¿™ç§æƒ…å†µæ¯”èµ·ä¼˜é›…ç»ˆæ­¢æ¥è¯´å°‘ä¹‹åˆå°‘ï¼Œä½†ç»ˆç©¶æœ‰å¯èƒ½å‘ç”Ÿã€‚ä¸€ç§æ¨èçš„æ–¹å¼æ˜¯ä½¿ç”¨ä¸€ä¸ªå¥å£®çš„åç«¯é˜Ÿåˆ—ï¼Œä¾‹å¦‚ Beanstalkd ï¼Œå®ƒå¯ä»¥åœ¨å®¢æˆ·ç«¯æ–­å¼€æˆ–è¶…æ—¶åè‡ªåŠ¨é€€å›ä»»åŠ¡ã€‚æ— è®ºå¦‚ä½•ï¼Œ12-Factor åº”ç”¨éƒ½åº”è¯¥å¯ä»¥è®¾è®¡èƒ½å¤Ÿåº”å¯¹æ„å¤–çš„ã€ä¸ä¼˜é›…çš„ç»ˆç»“ã€‚Crash-only design å°†è¿™ç§æ¦‚å¿µè½¬åŒ–ä¸º åˆä¹é€»è¾‘çš„ç†è®ºã€‚</p>
]]></content>
      <tags>
        <tag>The Twelve-Factor App</tag>
      </tags>
  </entry>
  <entry>
    <title>The Twelve-Factor App--V.Build,release,run</title>
    <url>/2022/06/24/uncatalog/cl4s5aedk0007yor7fl055pq7/</url>
    <content><![CDATA[<hr>
<span id="more"></span>
<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>å¦‚ä»Šï¼Œè½¯ä»¶é€šå¸¸ä¼šä½œä¸ºä¸€ç§æœåŠ¡æ¥äº¤ä»˜ï¼Œå®ƒä»¬è¢«ç§°ä¸ºç½‘ç»œåº”ç”¨ç¨‹åºï¼Œæˆ–è½¯ä»¶å³æœåŠ¡ï¼ˆSaaSï¼‰ã€‚12-Factor ä¸ºæ„å»ºå¦‚ä¸‹çš„ SaaS åº”ç”¨æä¾›äº†æ–¹æ³•è®ºï¼š</p>
<ul>
<li>ä½¿ç”¨æ ‡å‡†åŒ–æµç¨‹è‡ªåŠ¨é…ç½®ï¼Œä»è€Œä½¿æ–°çš„å¼€å‘è€…èŠ±è´¹æœ€å°‘çš„å­¦ä¹ æˆæœ¬åŠ å…¥è¿™ä¸ªé¡¹ç›®ã€‚</li>
<li>å’Œæ“ä½œç³»ç»Ÿä¹‹é—´å°½å¯èƒ½çš„åˆ’æ¸…ç•Œé™ï¼Œåœ¨å„ä¸ªç³»ç»Ÿä¸­æä¾›æœ€å¤§çš„å¯ç§»æ¤æ€§ã€‚</li>
<li>é€‚åˆéƒ¨ç½²åœ¨ç°ä»£çš„äº‘è®¡ç®—å¹³å°ï¼Œä»è€Œåœ¨æœåŠ¡å™¨å’Œç³»ç»Ÿç®¡ç†æ–¹é¢èŠ‚çœèµ„æºã€‚</li>
<li>å°†å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒçš„å·®å¼‚é™è‡³æœ€ä½ï¼Œå¹¶ä½¿ç”¨æŒç»­äº¤ä»˜å®æ–½æ•æ·å¼€å‘ã€‚</li>
<li>å¯ä»¥åœ¨å·¥å…·ã€æ¶æ„å’Œå¼€å‘æµç¨‹ä¸å‘ç”Ÿæ˜æ˜¾å˜åŒ–çš„å‰æä¸‹å®ç°æ‰©å±•ã€‚<br>è¿™å¥—ç†è®ºé€‚ç”¨äºä»»æ„è¯­è¨€å’Œåç«¯æœåŠ¡ï¼ˆæ•°æ®åº“ã€æ¶ˆæ¯é˜Ÿåˆ—ã€ç¼“å­˜ç­‰ï¼‰å¼€å‘çš„åº”ç”¨ç¨‹åºã€‚</li>
</ul>
<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>è¿™å¥—æ–¹æ³•è®ºç”±Herokuçš„è”åˆåˆ›å§‹äººAdam Wigginså‘æ˜ï¼Œåº”ç”¨åˆ°äº†æ•°ä»¥ç™¾è®¡çš„åº”ç”¨ç¨‹åºçš„å¼€å‘å’Œéƒ¨ç½²ï¼Œå¹¶é€šè¿‡ Heroku å¹³å°é—´æ¥è§è¯äº†æ•°åä¸‡åº”ç”¨ç¨‹åºçš„å¼€å‘ï¼Œè¿ä½œä»¥åŠæ‰©å±•çš„è¿‡ç¨‹ã€‚</p>
<p><code>The Twelve-Factor App</code>ç³»åˆ—æ–‡ç« ï¼Œç»¼åˆäº†Heroåº“å…³äº SaaS åº”ç”¨å‡ ä¹æ‰€æœ‰çš„ç»éªŒå’Œæ™ºæ…§ï¼Œæ˜¯å¼€å‘æ­¤ç±»åº”ç”¨çš„ç†æƒ³å®è·µæ ‡å‡†ï¼Œå¹¶ç‰¹åˆ«å…³æ³¨äºåº”ç”¨ç¨‹åºå¦‚ä½•ä¿æŒè‰¯æ€§æˆé•¿ï¼Œå¼€å‘è€…ä¹‹é—´å¦‚ä½•è¿›è¡Œæœ‰æ•ˆçš„ä»£ç åä½œï¼Œä»¥åŠå¦‚ä½• é¿å…è½¯ä»¶æ±¡æŸ“ ã€‚</p>
<blockquote>
<p>è‹±æ–‡åŸæ–‡</p>
</blockquote>
<h3 id="V-Build-release-run"><a href="#V-Build-release-run" class="headerlink" title="V. Build, release, run"></a>V. Build, release, run</h3><blockquote>
<p>Strictly separate build and run stages</p>
</blockquote>
<p>A codebase is transformed into a (non-development) deploy through three stages:</p>
<ul>
<li>The build stage is a transform which converts a code repo into an executable bundle known as a build. Using a version of the code at a commit specified by the deployment process, the build stage fetches vendors dependencies and compiles binaries and assets.</li>
<li>The release stage takes the build produced by the build stage and combines it with the deployâ€™s current config. The resulting release contains both the build and the config and is ready for immediate execution in the execution environment.</li>
<li>The run stage (also known as â€œruntimeâ€) runs the app in the execution environment, by launching some set of the appâ€™s processes against a selected release.<br>Code becomes a build, which is combined with config to create a release.<br><img src="/2022/06/24/uncatalog/cl4s5aedk0007yor7fl055pq7/release.png" alt="im"></li>
</ul>
<p>The twelve-factor app uses strict separation between the build, release, and run stages. For example, it is impossible to make changes to the code at runtime, since there is no way to propagate those changes back to the build stage.</p>
<p>Deployment tools typically offer release management tools, most notably the ability to roll back to a previous release. For example, the Capistrano deployment tool stores releases in a subdirectory named releases, where the current release is a symlink to the current release directory. Its rollback command makes it easy to quickly roll back to a previous release.</p>
<p>Every release should always have a unique release ID, such as a timestamp of the release (such as 2011-04-06-20:32:17) or an incrementing number (such as v100). Releases are an append-only ledger and a release cannot be mutated once it is created. Any change must create a new release.</p>
<p>Builds are initiated by the appâ€™s developers whenever new code is deployed. Runtime execution, by contrast, can happen automatically in cases such as a server reboot, or a crashed process being restarted by the process manager. Therefore, the run stage should be kept to as few moving parts as possible, since problems that prevent an app from running can cause it to break in the middle of the night when no developers are on hand. The build stage can be more complex, since errors are always in the foreground for a developer who is driving the deploy.</p>
<blockquote>
<p>ä¸­æ–‡</p>
</blockquote>
<h3 id="V-æ„å»ºï¼Œå‘å¸ƒï¼Œè¿è¡Œ"><a href="#V-æ„å»ºï¼Œå‘å¸ƒï¼Œè¿è¡Œ" class="headerlink" title="V. æ„å»ºï¼Œå‘å¸ƒï¼Œè¿è¡Œ"></a>V. æ„å»ºï¼Œå‘å¸ƒï¼Œè¿è¡Œ</h3><blockquote>
<p>ä¸¥æ ¼åˆ†ç¦»æ„å»ºå’Œè¿è¡Œ</p>
</blockquote>
<p>åŸºå‡†ä»£ç  è½¬åŒ–ä¸ºä¸€ä»½éƒ¨ç½²(éå¼€å‘ç¯å¢ƒ)éœ€è¦ä»¥ä¸‹ä¸‰ä¸ªé˜¶æ®µï¼š</p>
<ul>
<li>æ„å»ºé˜¶æ®µ æ˜¯æŒ‡å°†ä»£ç ä»“åº“è½¬åŒ–ä¸ºå¯æ‰§è¡ŒåŒ…çš„è¿‡ç¨‹ã€‚æ„å»ºæ—¶ä¼šä½¿ç”¨æŒ‡å®šç‰ˆæœ¬çš„ä»£ç ï¼Œè·å–å’Œæ‰“åŒ… ä¾èµ–é¡¹ï¼Œç¼–è¯‘æˆäºŒè¿›åˆ¶æ–‡ä»¶å’Œèµ„æºæ–‡ä»¶ã€‚</li>
<li>å‘å¸ƒé˜¶æ®µ ä¼šå°†æ„å»ºçš„ç»“æœå’Œå½“å‰éƒ¨ç½²æ‰€éœ€ é…ç½® ç›¸ç»“åˆï¼Œå¹¶èƒ½å¤Ÿç«‹åˆ»åœ¨è¿è¡Œç¯å¢ƒä¸­æŠ•å…¥ä½¿ç”¨ã€‚</li>
<li>è¿è¡Œé˜¶æ®µ ï¼ˆæˆ–è€…è¯´â€œè¿è¡Œæ—¶â€ï¼‰æ˜¯æŒ‡é’ˆå¯¹é€‰å®šçš„å‘å¸ƒç‰ˆæœ¬ï¼Œåœ¨æ‰§è¡Œç¯å¢ƒä¸­å¯åŠ¨ä¸€ç³»åˆ—åº”ç”¨ç¨‹åº è¿›ç¨‹ã€‚<br>ä»£ç è¢«æ„å»ºï¼Œç„¶åå’Œé…ç½®ç»“åˆæˆä¸ºå‘å¸ƒç‰ˆæœ¬<br><img src="/2022/06/24/uncatalog/cl4s5aedk0007yor7fl055pq7/release.png" alt="im"></li>
</ul>
<p>12-factor åº”ç”¨ä¸¥æ ¼åŒºåˆ†æ„å»ºï¼Œå‘å¸ƒï¼Œè¿è¡Œè¿™ä¸‰ä¸ªæ­¥éª¤ã€‚ ä¸¾ä¾‹æ¥è¯´ï¼Œç›´æ¥ä¿®æ”¹å¤„äºè¿è¡ŒçŠ¶æ€çš„ä»£ç æ˜¯éå¸¸ä¸å¯å–çš„åšæ³•ï¼Œå› ä¸ºè¿™äº›ä¿®æ”¹å¾ˆéš¾å†åŒæ­¥å›æ„å»ºæ­¥éª¤ã€‚</p>
<p>éƒ¨ç½²å·¥å…·é€šå¸¸éƒ½æä¾›äº†å‘å¸ƒç®¡ç†å·¥å…·ï¼Œæœ€å¼•äººæ³¨ç›®çš„åŠŸèƒ½æ˜¯é€€å›è‡³è¾ƒæ—§çš„å‘å¸ƒç‰ˆæœ¬ã€‚æ¯”å¦‚ï¼Œ Capistrano å°†æ‰€æœ‰å‘å¸ƒç‰ˆæœ¬éƒ½å­˜å‚¨åœ¨ä¸€ä¸ªå« releases çš„å­ç›®å½•ä¸­ï¼Œå½“å‰çš„åœ¨çº¿ç‰ˆæœ¬åªéœ€æ˜ å°„è‡³å¯¹åº”çš„ç›®å½•å³å¯ã€‚è¯¥å·¥å…·çš„ rollback å‘½ä»¤å¯ä»¥å¾ˆå®¹æ˜“åœ°å®ç°å›é€€ç‰ˆæœ¬çš„åŠŸèƒ½ã€‚</p>
<p>æ¯ä¸€ä¸ªå‘å¸ƒç‰ˆæœ¬å¿…é¡»å¯¹åº”ä¸€ä¸ªå”¯ä¸€çš„å‘å¸ƒ IDï¼Œä¾‹å¦‚å¯ä»¥ä½¿ç”¨å‘å¸ƒæ—¶çš„æ—¶é—´æˆ³ï¼ˆ2011-04-06-20:32:17ï¼‰ï¼Œäº¦æˆ–æ˜¯ä¸€ä¸ªå¢é•¿çš„æ•°å­—ï¼ˆv100ï¼‰ã€‚å‘å¸ƒçš„ç‰ˆæœ¬å°±åƒä¸€æœ¬åªèƒ½è¿½åŠ çš„è´¦æœ¬ï¼Œä¸€æ—¦å‘å¸ƒå°±ä¸å¯ä¿®æ”¹ï¼Œä»»ä½•çš„å˜åŠ¨éƒ½åº”è¯¥äº§ç”Ÿä¸€ä¸ªæ–°çš„å‘å¸ƒç‰ˆæœ¬ã€‚</p>
<p>æ–°çš„ä»£ç åœ¨éƒ¨ç½²ä¹‹å‰ï¼Œéœ€è¦å¼€å‘äººå‘˜è§¦å‘æ„å»ºæ“ä½œã€‚ä½†æ˜¯ï¼Œè¿è¡Œé˜¶æ®µä¸ä¸€å®šéœ€è¦äººä¸ºè§¦å‘ï¼Œè€Œæ˜¯å¯ä»¥è‡ªåŠ¨è¿›è¡Œã€‚å¦‚æœåŠ¡å™¨é‡å¯ï¼Œæˆ–æ˜¯è¿›ç¨‹ç®¡ç†å™¨é‡å¯äº†ä¸€ä¸ªå´©æºƒçš„è¿›ç¨‹ã€‚å› æ­¤ï¼Œè¿è¡Œé˜¶æ®µåº”è¯¥ä¿æŒå°½å¯èƒ½å°‘çš„æ¨¡å—ï¼Œè¿™æ ·å‡è®¾åŠå¤œå‘ç”Ÿç³»ç»Ÿæ•…éšœè€Œå¼€å‘äººå‘˜åˆæ‰è¥Ÿè§è‚˜ä¹Ÿä¸ä¼šå¼•èµ·å¤ªå¤§é—®é¢˜ã€‚æ„å»ºé˜¶æ®µæ˜¯å¯ä»¥ç›¸å¯¹å¤æ‚ä¸€äº›çš„ï¼Œå› ä¸ºé”™è¯¯ä¿¡æ¯èƒ½å¤Ÿç«‹åˆ»å±•ç¤ºåœ¨å¼€å‘äººå‘˜é¢å‰ï¼Œä»è€Œå¾—åˆ°å¦¥å–„å¤„ç†ã€‚</p>
]]></content>
      <tags>
        <tag>The Twelve-Factor App</tag>
      </tags>
  </entry>
  <entry>
    <title>The Twelve-Factor App--VI.Processes</title>
    <url>/2022/06/24/uncatalog/cl4s5aedm0009yor77lq164nz/</url>
    <content><![CDATA[<hr>
<span id="more"></span>
<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>å¦‚ä»Šï¼Œè½¯ä»¶é€šå¸¸ä¼šä½œä¸ºä¸€ç§æœåŠ¡æ¥äº¤ä»˜ï¼Œå®ƒä»¬è¢«ç§°ä¸ºç½‘ç»œåº”ç”¨ç¨‹åºï¼Œæˆ–è½¯ä»¶å³æœåŠ¡ï¼ˆSaaSï¼‰ã€‚12-Factor ä¸ºæ„å»ºå¦‚ä¸‹çš„ SaaS åº”ç”¨æä¾›äº†æ–¹æ³•è®ºï¼š</p>
<ul>
<li>ä½¿ç”¨æ ‡å‡†åŒ–æµç¨‹è‡ªåŠ¨é…ç½®ï¼Œä»è€Œä½¿æ–°çš„å¼€å‘è€…èŠ±è´¹æœ€å°‘çš„å­¦ä¹ æˆæœ¬åŠ å…¥è¿™ä¸ªé¡¹ç›®ã€‚</li>
<li>å’Œæ“ä½œç³»ç»Ÿä¹‹é—´å°½å¯èƒ½çš„åˆ’æ¸…ç•Œé™ï¼Œåœ¨å„ä¸ªç³»ç»Ÿä¸­æä¾›æœ€å¤§çš„å¯ç§»æ¤æ€§ã€‚</li>
<li>é€‚åˆéƒ¨ç½²åœ¨ç°ä»£çš„äº‘è®¡ç®—å¹³å°ï¼Œä»è€Œåœ¨æœåŠ¡å™¨å’Œç³»ç»Ÿç®¡ç†æ–¹é¢èŠ‚çœèµ„æºã€‚</li>
<li>å°†å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒçš„å·®å¼‚é™è‡³æœ€ä½ï¼Œå¹¶ä½¿ç”¨æŒç»­äº¤ä»˜å®æ–½æ•æ·å¼€å‘ã€‚</li>
<li>å¯ä»¥åœ¨å·¥å…·ã€æ¶æ„å’Œå¼€å‘æµç¨‹ä¸å‘ç”Ÿæ˜æ˜¾å˜åŒ–çš„å‰æä¸‹å®ç°æ‰©å±•ã€‚<br>è¿™å¥—ç†è®ºé€‚ç”¨äºä»»æ„è¯­è¨€å’Œåç«¯æœåŠ¡ï¼ˆæ•°æ®åº“ã€æ¶ˆæ¯é˜Ÿåˆ—ã€ç¼“å­˜ç­‰ï¼‰å¼€å‘çš„åº”ç”¨ç¨‹åºã€‚</li>
</ul>
<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>è¿™å¥—æ–¹æ³•è®ºç”±Herokuçš„è”åˆåˆ›å§‹äººAdam Wigginså‘æ˜ï¼Œåº”ç”¨åˆ°äº†æ•°ä»¥ç™¾è®¡çš„åº”ç”¨ç¨‹åºçš„å¼€å‘å’Œéƒ¨ç½²ï¼Œå¹¶é€šè¿‡ Heroku å¹³å°é—´æ¥è§è¯äº†æ•°åä¸‡åº”ç”¨ç¨‹åºçš„å¼€å‘ï¼Œè¿ä½œä»¥åŠæ‰©å±•çš„è¿‡ç¨‹ã€‚</p>
<p><code>The Twelve-Factor App</code>ç³»åˆ—æ–‡ç« ï¼Œç»¼åˆäº†Heroåº“å…³äº SaaS åº”ç”¨å‡ ä¹æ‰€æœ‰çš„ç»éªŒå’Œæ™ºæ…§ï¼Œæ˜¯å¼€å‘æ­¤ç±»åº”ç”¨çš„ç†æƒ³å®è·µæ ‡å‡†ï¼Œå¹¶ç‰¹åˆ«å…³æ³¨äºåº”ç”¨ç¨‹åºå¦‚ä½•ä¿æŒè‰¯æ€§æˆé•¿ï¼Œå¼€å‘è€…ä¹‹é—´å¦‚ä½•è¿›è¡Œæœ‰æ•ˆçš„ä»£ç åä½œï¼Œä»¥åŠå¦‚ä½• é¿å…è½¯ä»¶æ±¡æŸ“ ã€‚</p>
<blockquote>
<p>è‹±æ–‡åŸæ–‡</p>
</blockquote>
<h3 id="VI-Processes"><a href="#VI-Processes" class="headerlink" title="VI. Processes"></a>VI. Processes</h3><blockquote>
<p>Execute the app as one or more stateless processes</p>
</blockquote>
<p>The app is executed in the execution environment as one or more processes.</p>
<p>In the simplest case, the code is a stand-alone script, the execution environment is a developerâ€™s local laptop with an installed language runtime, and the process is launched via the command line (for example, python my_script.py). On the other end of the spectrum, a production deploy of a sophisticated app may use many process types, instantiated into zero or more running processes.</p>
<p>Twelve-factor processes are stateless and share-nothing. Any data that needs to persist must be stored in a stateful backing service, typically a database.</p>
<p>The memory space or filesystem of the process can be used as a brief, single-transaction cache. For example, downloading a large file, operating on it, and storing the results of the operation in the database. The twelve-factor app never assumes that anything cached in memory or on disk will be available on a future request or job â€“ with many processes of each type running, chances are high that a future request will be served by a different process. Even when running only one process, a restart (triggered by code deploy, config change, or the execution environment relocating the process to a different physical location) will usually wipe out all local (e.g., memory and filesystem) state.</p>
<p>Asset packagers like django-assetpackager use the filesystem as a cache for compiled assets. A twelve-factor app prefers to do this compiling during the build stage. Asset packagers such as Jammit and the Rails asset pipeline can be configured to package assets during the build stage.</p>
<p>Some web systems rely on â€œsticky sessionsâ€ â€“ that is, caching user session data in memory of the appâ€™s process and expecting future requests from the same visitor to be routed to the same process. Sticky sessions are a violation of twelve-factor and should never be used or relied upon. Session state data is a good candidate for a datastore that offers time-expiration, such as Memcached or Redis.</p>
<blockquote>
<p>ä¸­æ–‡</p>
</blockquote>
<h3 id="VI-è¿›ç¨‹"><a href="#VI-è¿›ç¨‹" class="headerlink" title="VI. è¿›ç¨‹"></a>VI. è¿›ç¨‹</h3><blockquote>
<p>ä»¥ä¸€ä¸ªæˆ–å¤šä¸ªæ— çŠ¶æ€è¿›ç¨‹è¿è¡Œåº”ç”¨</p>
</blockquote>
<p>è¿è¡Œç¯å¢ƒä¸­ï¼Œåº”ç”¨ç¨‹åºé€šå¸¸æ˜¯ä»¥ä¸€ä¸ªå’Œå¤šä¸ª è¿›ç¨‹ è¿è¡Œçš„ã€‚</p>
<p>æœ€ç®€å•çš„åœºæ™¯ä¸­ï¼Œä»£ç æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„è„šæœ¬ï¼Œè¿è¡Œç¯å¢ƒæ˜¯å¼€å‘äººå‘˜è‡ªå·±çš„ç¬”è®°æœ¬ç”µè„‘ï¼Œè¿›ç¨‹ç”±ä¸€æ¡å‘½ä»¤è¡Œï¼ˆä¾‹å¦‚python my_script.pyï¼‰ã€‚å¦å¤–ä¸€ä¸ªæç«¯æƒ…å†µæ˜¯ï¼Œå¤æ‚çš„åº”ç”¨å¯èƒ½ä¼šä½¿ç”¨å¾ˆå¤š è¿›ç¨‹ç±»å‹ ï¼Œä¹Ÿå°±æ˜¯é›¶ä¸ªæˆ–å¤šä¸ªè¿›ç¨‹å®ä¾‹ã€‚</p>
<p>12-Factor åº”ç”¨çš„è¿›ç¨‹å¿…é¡»æ— çŠ¶æ€ä¸” æ— å…±äº« ã€‚ ä»»ä½•éœ€è¦æŒä¹…åŒ–çš„æ•°æ®éƒ½è¦å­˜å‚¨åœ¨ åç«¯æœåŠ¡ å†…ï¼Œæ¯”å¦‚æ•°æ®åº“ã€‚</p>
<p>å†…å­˜åŒºåŸŸæˆ–ç£ç›˜ç©ºé—´å¯ä»¥ä½œä¸ºè¿›ç¨‹åœ¨åšæŸç§äº‹åŠ¡å‹æ“ä½œæ—¶çš„ç¼“å­˜ï¼Œä¾‹å¦‚ä¸‹è½½ä¸€ä¸ªå¾ˆå¤§çš„æ–‡ä»¶ï¼Œå¯¹å…¶æ“ä½œå¹¶å°†ç»“æœå†™å…¥æ•°æ®åº“çš„è¿‡ç¨‹ã€‚12-Factoråº”ç”¨æ ¹æœ¬ä¸ç”¨è€ƒè™‘è¿™äº›ç¼“å­˜çš„å†…å®¹æ˜¯ä¸æ˜¯å¯ä»¥ä¿ç•™ç»™ä¹‹åçš„è¯·æ±‚æ¥ä½¿ç”¨ï¼Œè¿™æ˜¯å› ä¸ºåº”ç”¨å¯åŠ¨äº†å¤šç§ç±»å‹çš„è¿›ç¨‹ï¼Œå°†æ¥çš„è¯·æ±‚å¤šåŠä¼šç”±å…¶ä»–è¿›ç¨‹æ¥æœåŠ¡ã€‚å³ä½¿åœ¨åªæœ‰ä¸€ä¸ªè¿›ç¨‹çš„æƒ…å½¢ä¸‹ï¼Œå…ˆå‰ä¿å­˜çš„æ•°æ®ï¼ˆå†…å­˜æˆ–æ–‡ä»¶ç³»ç»Ÿä¸­ï¼‰ä¹Ÿä¼šå› ä¸ºé‡å¯ï¼ˆå¦‚ä»£ç éƒ¨ç½²ã€é…ç½®æ›´æ”¹ã€æˆ–è¿è¡Œç¯å¢ƒå°†è¿›ç¨‹è°ƒåº¦è‡³å¦ä¸€ä¸ªç‰©ç†åŒºåŸŸæ‰§è¡Œï¼‰è€Œä¸¢å¤±ã€‚</p>
<p>æºæ–‡ä»¶æ‰“åŒ…å·¥å…·ï¼ˆJammit, django-compressorï¼‰ ä½¿ç”¨æ–‡ä»¶ç³»ç»Ÿæ¥ç¼“å­˜ç¼–è¯‘è¿‡çš„æºæ–‡ä»¶ã€‚12-Factor åº”ç”¨æ›´å€¾å‘äºåœ¨ æ„å»ºæ­¥éª¤ åšæ­¤åŠ¨ä½œâ€”â€”æ­£å¦‚ Railsèµ„æºç®¡é“ ï¼Œè€Œä¸æ˜¯åœ¨è¿è¡Œé˜¶æ®µã€‚</p>
<p>ä¸€äº›äº’è”ç½‘ç³»ç»Ÿä¾èµ–äº â€œç²˜æ€§ sessionâ€ï¼Œ è¿™æ˜¯æŒ‡å°†ç”¨æˆ· session ä¸­çš„æ•°æ®ç¼“å­˜è‡³æŸè¿›ç¨‹çš„å†…å­˜ä¸­ï¼Œå¹¶å°†åŒä¸€ç”¨æˆ·çš„åç»­è¯·æ±‚è·¯ç”±åˆ°åŒä¸€ä¸ªè¿›ç¨‹ã€‚ç²˜æ€§ session æ˜¯ 12-Factor æåŠ›åå¯¹çš„ã€‚Session ä¸­çš„æ•°æ®åº”è¯¥ä¿å­˜åœ¨è¯¸å¦‚ Memcached æˆ– Redis è¿™æ ·çš„å¸¦æœ‰è¿‡æœŸæ—¶é—´çš„ç¼“å­˜ä¸­ã€‚</p>
]]></content>
      <tags>
        <tag>The Twelve-Factor App</tag>
      </tags>
  </entry>
  <entry>
    <title>The Twelve-Factor App--VII.Port_binding</title>
    <url>/2022/06/24/uncatalog/cl4s5aedo000byor78qwog8wr/</url>
    <content><![CDATA[<hr>
<span id="more"></span>
<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>å¦‚ä»Šï¼Œè½¯ä»¶é€šå¸¸ä¼šä½œä¸ºä¸€ç§æœåŠ¡æ¥äº¤ä»˜ï¼Œå®ƒä»¬è¢«ç§°ä¸ºç½‘ç»œåº”ç”¨ç¨‹åºï¼Œæˆ–è½¯ä»¶å³æœåŠ¡ï¼ˆSaaSï¼‰ã€‚12-Factor ä¸ºæ„å»ºå¦‚ä¸‹çš„ SaaS åº”ç”¨æä¾›äº†æ–¹æ³•è®ºï¼š</p>
<ul>
<li>ä½¿ç”¨æ ‡å‡†åŒ–æµç¨‹è‡ªåŠ¨é…ç½®ï¼Œä»è€Œä½¿æ–°çš„å¼€å‘è€…èŠ±è´¹æœ€å°‘çš„å­¦ä¹ æˆæœ¬åŠ å…¥è¿™ä¸ªé¡¹ç›®ã€‚</li>
<li>å’Œæ“ä½œç³»ç»Ÿä¹‹é—´å°½å¯èƒ½çš„åˆ’æ¸…ç•Œé™ï¼Œåœ¨å„ä¸ªç³»ç»Ÿä¸­æä¾›æœ€å¤§çš„å¯ç§»æ¤æ€§ã€‚</li>
<li>é€‚åˆéƒ¨ç½²åœ¨ç°ä»£çš„äº‘è®¡ç®—å¹³å°ï¼Œä»è€Œåœ¨æœåŠ¡å™¨å’Œç³»ç»Ÿç®¡ç†æ–¹é¢èŠ‚çœèµ„æºã€‚</li>
<li>å°†å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒçš„å·®å¼‚é™è‡³æœ€ä½ï¼Œå¹¶ä½¿ç”¨æŒç»­äº¤ä»˜å®æ–½æ•æ·å¼€å‘ã€‚</li>
<li>å¯ä»¥åœ¨å·¥å…·ã€æ¶æ„å’Œå¼€å‘æµç¨‹ä¸å‘ç”Ÿæ˜æ˜¾å˜åŒ–çš„å‰æä¸‹å®ç°æ‰©å±•ã€‚<br>è¿™å¥—ç†è®ºé€‚ç”¨äºä»»æ„è¯­è¨€å’Œåç«¯æœåŠ¡ï¼ˆæ•°æ®åº“ã€æ¶ˆæ¯é˜Ÿåˆ—ã€ç¼“å­˜ç­‰ï¼‰å¼€å‘çš„åº”ç”¨ç¨‹åºã€‚</li>
</ul>
<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>è¿™å¥—æ–¹æ³•è®ºç”±Herokuçš„è”åˆåˆ›å§‹äººAdam Wigginså‘æ˜ï¼Œåº”ç”¨åˆ°äº†æ•°ä»¥ç™¾è®¡çš„åº”ç”¨ç¨‹åºçš„å¼€å‘å’Œéƒ¨ç½²ï¼Œå¹¶é€šè¿‡ Heroku å¹³å°é—´æ¥è§è¯äº†æ•°åä¸‡åº”ç”¨ç¨‹åºçš„å¼€å‘ï¼Œè¿ä½œä»¥åŠæ‰©å±•çš„è¿‡ç¨‹ã€‚</p>
<p><code>The Twelve-Factor App</code>ç³»åˆ—æ–‡ç« ï¼Œç»¼åˆäº†Heroåº“å…³äº SaaS åº”ç”¨å‡ ä¹æ‰€æœ‰çš„ç»éªŒå’Œæ™ºæ…§ï¼Œæ˜¯å¼€å‘æ­¤ç±»åº”ç”¨çš„ç†æƒ³å®è·µæ ‡å‡†ï¼Œå¹¶ç‰¹åˆ«å…³æ³¨äºåº”ç”¨ç¨‹åºå¦‚ä½•ä¿æŒè‰¯æ€§æˆé•¿ï¼Œå¼€å‘è€…ä¹‹é—´å¦‚ä½•è¿›è¡Œæœ‰æ•ˆçš„ä»£ç åä½œï¼Œä»¥åŠå¦‚ä½• é¿å…è½¯ä»¶æ±¡æŸ“ ã€‚</p>
<blockquote>
<p>è‹±æ–‡åŸæ–‡</p>
</blockquote>
<h3 id="VII-Port-binding"><a href="#VII-Port-binding" class="headerlink" title="VII. Port binding"></a>VII. Port binding</h3><blockquote>
<p>Export services via port binding</p>
</blockquote>
<p>Web apps are sometimes executed inside a webserver container. For example, PHP apps might run as a module inside Apache HTTPD, or Java apps might run inside Tomcat.</p>
<p>The twelve-factor app is completely self-contained and does not rely on runtime injection of a webserver into the execution environment to create a web-facing service. The web app exports HTTP as a service by binding to a port, and listening to requests coming in on that port.</p>
<p>In a local development environment, the developer visits a service URL like <a href="http://localhost:5000/">http://localhost:5000/</a> to access the service exported by their app. In deployment, a routing layer handles routing requests from a public-facing hostname to the port-bound web processes.</p>
<p>This is typically implemented by using dependency declaration to add a webserver library to the app, such as Tornado for Python, Thin for Ruby, or Jetty for Java and other JVM-based languages. This happens entirely in user space, that is, within the appâ€™s code. The contract with the execution environment is binding to a port to serve requests.</p>
<p>HTTP is not the only service that can be exported by port binding. Nearly any kind of server software can be run via a process binding to a port and awaiting incoming requests. Examples include ejabberd (speaking XMPP), and Redis (speaking the Redis protocol).</p>
<p>Note also that the port-binding approach means that one app can become the backing service for another app, by providing the URL to the backing app as a resource handle in the config for the consuming app.</p>
<blockquote>
<p>ä¸­æ–‡</p>
</blockquote>
<h3 id="VII-ç«¯å£ç»‘å®š"><a href="#VII-ç«¯å£ç»‘å®š" class="headerlink" title="VII. ç«¯å£ç»‘å®š"></a>VII. ç«¯å£ç»‘å®š</h3><blockquote>
<p>é€šè¿‡ç«¯å£ç»‘å®š(Port binding)æ¥æä¾›æœåŠ¡</p>
</blockquote>
<p>äº’è”ç½‘åº”ç”¨æœ‰æ—¶ä¼šè¿è¡ŒäºæœåŠ¡å™¨çš„å®¹å™¨ä¹‹ä¸­ã€‚ä¾‹å¦‚ PHP ç»å¸¸ä½œä¸º Apache HTTPD çš„ä¸€ä¸ªæ¨¡å—æ¥è¿è¡Œï¼Œæ­£å¦‚ Java è¿è¡Œäº Tomcat ã€‚</p>
<p>12-Factor åº”ç”¨å®Œå…¨è‡ªæˆ‘åŠ è½½ è€Œä¸ä¾èµ–äºä»»ä½•ç½‘ç»œæœåŠ¡å™¨å°±å¯ä»¥åˆ›å»ºä¸€ä¸ªé¢å‘ç½‘ç»œçš„æœåŠ¡ã€‚äº’è”ç½‘åº”ç”¨ é€šè¿‡ç«¯å£ç»‘å®šæ¥æä¾›æœåŠ¡ ï¼Œå¹¶ç›‘å¬å‘é€è‡³è¯¥ç«¯å£çš„è¯·æ±‚ã€‚</p>
<p>æœ¬åœ°ç¯å¢ƒä¸­ï¼Œå¼€å‘äººå‘˜é€šè¿‡ç±»ä¼¼ <a href="http://localhost:5000/">http://localhost:5000/</a> çš„åœ°å€æ¥è®¿é—®æœåŠ¡ã€‚åœ¨çº¿ä¸Šç¯å¢ƒä¸­ï¼Œè¯·æ±‚ç»Ÿä¸€å‘é€è‡³å…¬å…±åŸŸåè€Œåè·¯ç”±è‡³ç»‘å®šäº†ç«¯å£çš„ç½‘ç»œè¿›ç¨‹ã€‚</p>
<p>é€šå¸¸çš„å®ç°æ€è·¯æ˜¯ï¼Œå°†ç½‘ç»œæœåŠ¡å™¨ç±»åº“é€šè¿‡ ä¾èµ–å£°æ˜ è½½å…¥åº”ç”¨ã€‚ä¾‹å¦‚ï¼ŒPython çš„ Tornado, Ruby çš„Thin , Java ä»¥åŠå…¶ä»–åŸºäº JVM è¯­è¨€çš„ Jettyã€‚å®Œå…¨ç”± ç”¨æˆ·ç«¯ ï¼Œç¡®åˆ‡çš„è¯´åº”è¯¥æ˜¯åº”ç”¨çš„ä»£ç ï¼Œå‘èµ·è¯·æ±‚ã€‚å’Œè¿è¡Œç¯å¢ƒçº¦å®šå¥½ç»‘å®šçš„ç«¯å£å³å¯å¤„ç†è¿™äº›è¯·æ±‚ã€‚</p>
<p>HTTP å¹¶ä¸æ˜¯å”¯ä¸€ä¸€ä¸ªå¯ä»¥ç”±ç«¯å£ç»‘å®šæä¾›çš„æœåŠ¡ã€‚å…¶å®å‡ ä¹æ‰€æœ‰æœåŠ¡å™¨è½¯ä»¶éƒ½å¯ä»¥é€šè¿‡è¿›ç¨‹ç»‘å®šç«¯å£æ¥ç­‰å¾…è¯·æ±‚ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ XMPP çš„ ejabberd ï¼Œ ä»¥åŠä½¿ç”¨ Redis åè®® çš„ Redis ã€‚</p>
<p>è¿˜è¦æŒ‡å‡ºçš„æ˜¯ï¼Œç«¯å£ç»‘å®šè¿™ç§æ–¹å¼ä¹Ÿæ„å‘³ç€ä¸€ä¸ªåº”ç”¨å¯ä»¥æˆä¸ºå¦å¤–ä¸€ä¸ªåº”ç”¨çš„ åç«¯æœåŠ¡ ï¼Œè°ƒç”¨æ–¹å°†æœåŠ¡æ–¹æä¾›çš„ç›¸åº” URL å½“ä½œèµ„æºå­˜å…¥ é…ç½® ä»¥å¤‡å°†æ¥è°ƒç”¨ã€‚</p>
]]></content>
      <tags>
        <tag>The Twelve-Factor App</tag>
      </tags>
  </entry>
  <entry>
    <title>The Twelve-Factor App--VIII.Concurrency</title>
    <url>/2022/06/24/uncatalog/cl4s5aedq000dyor70ynbgtrg/</url>
    <content><![CDATA[<hr>
<span id="more"></span>
<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>å¦‚ä»Šï¼Œè½¯ä»¶é€šå¸¸ä¼šä½œä¸ºä¸€ç§æœåŠ¡æ¥äº¤ä»˜ï¼Œå®ƒä»¬è¢«ç§°ä¸ºç½‘ç»œåº”ç”¨ç¨‹åºï¼Œæˆ–è½¯ä»¶å³æœåŠ¡ï¼ˆSaaSï¼‰ã€‚12-Factor ä¸ºæ„å»ºå¦‚ä¸‹çš„ SaaS åº”ç”¨æä¾›äº†æ–¹æ³•è®ºï¼š</p>
<ul>
<li>ä½¿ç”¨æ ‡å‡†åŒ–æµç¨‹è‡ªåŠ¨é…ç½®ï¼Œä»è€Œä½¿æ–°çš„å¼€å‘è€…èŠ±è´¹æœ€å°‘çš„å­¦ä¹ æˆæœ¬åŠ å…¥è¿™ä¸ªé¡¹ç›®ã€‚</li>
<li>å’Œæ“ä½œç³»ç»Ÿä¹‹é—´å°½å¯èƒ½çš„åˆ’æ¸…ç•Œé™ï¼Œåœ¨å„ä¸ªç³»ç»Ÿä¸­æä¾›æœ€å¤§çš„å¯ç§»æ¤æ€§ã€‚</li>
<li>é€‚åˆéƒ¨ç½²åœ¨ç°ä»£çš„äº‘è®¡ç®—å¹³å°ï¼Œä»è€Œåœ¨æœåŠ¡å™¨å’Œç³»ç»Ÿç®¡ç†æ–¹é¢èŠ‚çœèµ„æºã€‚</li>
<li>å°†å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒçš„å·®å¼‚é™è‡³æœ€ä½ï¼Œå¹¶ä½¿ç”¨æŒç»­äº¤ä»˜å®æ–½æ•æ·å¼€å‘ã€‚</li>
<li>å¯ä»¥åœ¨å·¥å…·ã€æ¶æ„å’Œå¼€å‘æµç¨‹ä¸å‘ç”Ÿæ˜æ˜¾å˜åŒ–çš„å‰æä¸‹å®ç°æ‰©å±•ã€‚<br>è¿™å¥—ç†è®ºé€‚ç”¨äºä»»æ„è¯­è¨€å’Œåç«¯æœåŠ¡ï¼ˆæ•°æ®åº“ã€æ¶ˆæ¯é˜Ÿåˆ—ã€ç¼“å­˜ç­‰ï¼‰å¼€å‘çš„åº”ç”¨ç¨‹åºã€‚</li>
</ul>
<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>è¿™å¥—æ–¹æ³•è®ºç”±Herokuçš„è”åˆåˆ›å§‹äººAdam Wigginså‘æ˜ï¼Œåº”ç”¨åˆ°äº†æ•°ä»¥ç™¾è®¡çš„åº”ç”¨ç¨‹åºçš„å¼€å‘å’Œéƒ¨ç½²ï¼Œå¹¶é€šè¿‡ Heroku å¹³å°é—´æ¥è§è¯äº†æ•°åä¸‡åº”ç”¨ç¨‹åºçš„å¼€å‘ï¼Œè¿ä½œä»¥åŠæ‰©å±•çš„è¿‡ç¨‹ã€‚</p>
<p><code>The Twelve-Factor App</code>ç³»åˆ—æ–‡ç« ï¼Œç»¼åˆäº†Heroåº“å…³äº SaaS åº”ç”¨å‡ ä¹æ‰€æœ‰çš„ç»éªŒå’Œæ™ºæ…§ï¼Œæ˜¯å¼€å‘æ­¤ç±»åº”ç”¨çš„ç†æƒ³å®è·µæ ‡å‡†ï¼Œå¹¶ç‰¹åˆ«å…³æ³¨äºåº”ç”¨ç¨‹åºå¦‚ä½•ä¿æŒè‰¯æ€§æˆé•¿ï¼Œå¼€å‘è€…ä¹‹é—´å¦‚ä½•è¿›è¡Œæœ‰æ•ˆçš„ä»£ç åä½œï¼Œä»¥åŠå¦‚ä½• é¿å…è½¯ä»¶æ±¡æŸ“ ã€‚</p>
<blockquote>
<p>è‹±æ–‡åŸæ–‡</p>
</blockquote>
<h3 id="VIII-Concurrency"><a href="#VIII-Concurrency" class="headerlink" title="VIII. Concurrency"></a>VIII. Concurrency</h3><blockquote>
<p>Scale out via the process model</p>
</blockquote>
<p>Any computer program, once run, is represented by one or more processes. Web apps have taken a variety of process-execution forms. For example, PHP processes run as child processes of Apache, started on demand as needed by request volume. Java processes take the opposite approach, with the JVM providing one massive uberprocess that reserves a large block of system resources (CPU and memory) on startup, with concurrency managed internally via threads. In both cases, the running process(es) are only minimally visible to the developers of the app.</p>
<p>Scale is expressed as running processes, workload diversity is expressed as process types.</p>
<p>In the twelve-factor app, processes are a first class citizen. Processes in the twelve-factor app take strong cues from the unix process model for running service daemons. Using this model, the developer can architect their app to handle diverse workloads by assigning each type of work to a process type. For example, HTTP requests may be handled by a web process, and long-running background tasks handled by a worker process.</p>
<p>This does not exclude individual processes from handling their own internal multiplexing, via threads inside the runtime VM, or the async/evented model found in tools such as EventMachine, Twisted, or Node.js. But an individual VM can only grow so large (vertical scale), so the application must also be able to span multiple processes running on multiple physical machines.<br><img src="/2022/06/24/uncatalog/cl4s5aedq000dyor70ynbgtrg/process-types.png" alt="img"><br>The process model truly shines when it comes time to scale out. The share-nothing, horizontally partitionable nature of twelve-factor app processes means that adding more concurrency is a simple and reliable operation. The array of process types and number of processes of each type is known as the process formation.</p>
<p>Twelve-factor app processes should never daemonize or write PID files. Instead, rely on the operating systemâ€™s process manager (such as systemd, a distributed process manager on a cloud platform, or a tool like Foreman in development) to manage output streams, respond to crashed processes, and handle user-initiated restarts and shutdowns.</p>
<blockquote>
<p>ä¸­æ–‡</p>
</blockquote>
<h3 id="VIII-å¹¶å‘"><a href="#VIII-å¹¶å‘" class="headerlink" title="VIII. å¹¶å‘"></a>VIII. å¹¶å‘</h3><blockquote>
<p>é€šè¿‡è¿›ç¨‹æ¨¡å‹è¿›è¡Œæ‰©å±•</p>
</blockquote>
<p>ä»»ä½•è®¡ç®—æœºç¨‹åºï¼Œä¸€æ—¦å¯åŠ¨ï¼Œå°±ä¼šç”Ÿæˆä¸€ä¸ªæˆ–å¤šä¸ªè¿›ç¨‹ã€‚äº’è”ç½‘åº”ç”¨é‡‡ç”¨å¤šç§è¿›ç¨‹è¿è¡Œæ–¹å¼ã€‚ä¾‹å¦‚ï¼ŒPHP è¿›ç¨‹ä½œä¸º Apache çš„å­è¿›ç¨‹å­˜åœ¨ï¼Œéšè¯·æ±‚æŒ‰éœ€å¯åŠ¨ã€‚Java è¿›ç¨‹åˆ™é‡‡å–äº†ç›¸åçš„æ–¹å¼ï¼Œåœ¨ç¨‹åºå¯åŠ¨ä¹‹åˆ JVM å°±æä¾›äº†ä¸€ä¸ªè¶…çº§è¿›ç¨‹å‚¨å¤‡äº†å¤§é‡çš„ç³»ç»Ÿèµ„æº(CPU å’Œå†…å­˜)ï¼Œå¹¶é€šè¿‡å¤šçº¿ç¨‹å®ç°å†…éƒ¨çš„å¹¶å‘ç®¡ç†ã€‚ä¸Šè¿° 2 ä¸ªä¾‹å­ä¸­ï¼Œè¿›ç¨‹æ˜¯å¼€å‘äººå‘˜å¯ä»¥æ“ä½œçš„æœ€å°å•ä½ã€‚</p>
<p>æ‰©å±•è¡¨ç°ä¸ºè¿è¡Œä¸­çš„è¿›ç¨‹ï¼Œå·¥ä½œå¤šæ ·æ€§è¡¨ç°ä¸ºè¿›ç¨‹ç±»å‹ã€‚</p>
<p>åœ¨ 12-factor åº”ç”¨ä¸­ï¼Œè¿›ç¨‹æ˜¯ä¸€ç­‰å…¬æ°‘ã€‚12-Factor åº”ç”¨çš„è¿›ç¨‹ä¸»è¦å€Ÿé‰´äº unix å®ˆæŠ¤è¿›ç¨‹æ¨¡å‹ ã€‚å¼€å‘äººå‘˜å¯ä»¥è¿ç”¨è¿™ä¸ªæ¨¡å‹å»è®¾è®¡åº”ç”¨æ¶æ„ï¼Œå°†ä¸åŒçš„å·¥ä½œåˆ†é…ç»™ä¸åŒçš„ è¿›ç¨‹ç±»å‹ ã€‚ä¾‹å¦‚ï¼ŒHTTP è¯·æ±‚å¯ä»¥äº¤ç»™ web è¿›ç¨‹æ¥å¤„ç†ï¼Œè€Œå¸¸é©»çš„åå°å·¥ä½œåˆ™äº¤ç”± worker è¿›ç¨‹è´Ÿè´£ã€‚</p>
<p>è¿™å¹¶ä¸åŒ…æ‹¬ä¸ªåˆ«è¾ƒä¸ºç‰¹æ®Šçš„è¿›ç¨‹ï¼Œä¾‹å¦‚é€šè¿‡è™šæ‹Ÿæœºçš„çº¿ç¨‹å¤„ç†å¹¶å‘çš„å†…éƒ¨è¿ç®—ï¼Œæˆ–æ˜¯ä½¿ç”¨è¯¸å¦‚ EventMachine, Twisted, Node.js çš„å¼‚æ­¥/äº‹ä»¶è§¦å‘æ¨¡å‹ã€‚ä½†ä¸€å°ç‹¬ç«‹çš„è™šæ‹Ÿæœºçš„æ‰©å±•æœ‰ç“¶é¢ˆï¼ˆå‚ç›´æ‰©å±•ï¼‰ï¼Œæ‰€ä»¥åº”ç”¨ç¨‹åºå¿…é¡»å¯ä»¥åœ¨å¤šå°ç‰©ç†æœºå™¨é—´è·¨è¿›ç¨‹å·¥ä½œã€‚<br><img src="/2022/06/24/uncatalog/cl4s5aedq000dyor70ynbgtrg/process-types.png" alt="img"><br>ä¸Šè¿°è¿›ç¨‹æ¨¡å‹ä¼šåœ¨ç³»ç»Ÿæ€¥éœ€æ‰©å±•æ—¶å¤§æ”¾å¼‚å½©ã€‚ 12-Factor åº”ç”¨çš„è¿›ç¨‹æ‰€å…·å¤‡çš„æ— å…±äº«ï¼Œæ°´å¹³åˆ†åŒºçš„ç‰¹æ€§ æ„å‘³ç€æ·»åŠ å¹¶å‘ä¼šå˜å¾—ç®€å•è€Œç¨³å¦¥ã€‚è¿™äº›è¿›ç¨‹çš„ç±»å‹ä»¥åŠæ¯ä¸ªç±»å‹ä¸­è¿›ç¨‹çš„æ•°é‡å°±è¢«ç§°ä½œ è¿›ç¨‹æ„æˆ ã€‚</p>
<p>12-Factor åº”ç”¨çš„è¿›ç¨‹ ä¸éœ€è¦å®ˆæŠ¤è¿›ç¨‹ æˆ–æ˜¯å†™å…¥ PID æ–‡ä»¶ã€‚ç›¸åçš„ï¼Œåº”è¯¥å€ŸåŠ©æ“ä½œç³»ç»Ÿçš„è¿›ç¨‹ç®¡ç†å™¨(ä¾‹å¦‚ systemd ï¼Œåˆ†å¸ƒå¼çš„è¿›ç¨‹ç®¡ç†äº‘å¹³å°ï¼Œæˆ–æ˜¯ç±»ä¼¼ Foreman çš„å·¥å…·)ï¼Œæ¥ç®¡ç† è¾“å‡ºæµ ï¼Œå“åº”å´©æºƒçš„è¿›ç¨‹ï¼Œä»¥åŠå¤„ç†ç”¨æˆ·è§¦å‘çš„é‡å¯å’Œå…³é—­è¶…çº§è¿›ç¨‹çš„è¯·</p>
]]></content>
      <tags>
        <tag>The Twelve-Factor App</tag>
      </tags>
  </entry>
  <entry>
    <title>The Twelve-Factor App--X.Dev/prod_parity</title>
    <url>/2022/06/24/uncatalog/cl4s5aedr000fyor726t7b7ya/</url>
    <content><![CDATA[<hr>
<span id="more"></span>
<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>å¦‚ä»Šï¼Œè½¯ä»¶é€šå¸¸ä¼šä½œä¸ºä¸€ç§æœåŠ¡æ¥äº¤ä»˜ï¼Œå®ƒä»¬è¢«ç§°ä¸ºç½‘ç»œåº”ç”¨ç¨‹åºï¼Œæˆ–è½¯ä»¶å³æœåŠ¡ï¼ˆSaaSï¼‰ã€‚12-Factor ä¸ºæ„å»ºå¦‚ä¸‹çš„ SaaS åº”ç”¨æä¾›äº†æ–¹æ³•è®ºï¼š</p>
<ul>
<li>ä½¿ç”¨æ ‡å‡†åŒ–æµç¨‹è‡ªåŠ¨é…ç½®ï¼Œä»è€Œä½¿æ–°çš„å¼€å‘è€…èŠ±è´¹æœ€å°‘çš„å­¦ä¹ æˆæœ¬åŠ å…¥è¿™ä¸ªé¡¹ç›®ã€‚</li>
<li>å’Œæ“ä½œç³»ç»Ÿä¹‹é—´å°½å¯èƒ½çš„åˆ’æ¸…ç•Œé™ï¼Œåœ¨å„ä¸ªç³»ç»Ÿä¸­æä¾›æœ€å¤§çš„å¯ç§»æ¤æ€§ã€‚</li>
<li>é€‚åˆéƒ¨ç½²åœ¨ç°ä»£çš„äº‘è®¡ç®—å¹³å°ï¼Œä»è€Œåœ¨æœåŠ¡å™¨å’Œç³»ç»Ÿç®¡ç†æ–¹é¢èŠ‚çœèµ„æºã€‚</li>
<li>å°†å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒçš„å·®å¼‚é™è‡³æœ€ä½ï¼Œå¹¶ä½¿ç”¨æŒç»­äº¤ä»˜å®æ–½æ•æ·å¼€å‘ã€‚</li>
<li>å¯ä»¥åœ¨å·¥å…·ã€æ¶æ„å’Œå¼€å‘æµç¨‹ä¸å‘ç”Ÿæ˜æ˜¾å˜åŒ–çš„å‰æä¸‹å®ç°æ‰©å±•ã€‚<br>è¿™å¥—ç†è®ºé€‚ç”¨äºä»»æ„è¯­è¨€å’Œåç«¯æœåŠ¡ï¼ˆæ•°æ®åº“ã€æ¶ˆæ¯é˜Ÿåˆ—ã€ç¼“å­˜ç­‰ï¼‰å¼€å‘çš„åº”ç”¨ç¨‹åºã€‚</li>
</ul>
<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>è¿™å¥—æ–¹æ³•è®ºç”±Herokuçš„è”åˆåˆ›å§‹äººAdam Wigginså‘æ˜ï¼Œåº”ç”¨åˆ°äº†æ•°ä»¥ç™¾è®¡çš„åº”ç”¨ç¨‹åºçš„å¼€å‘å’Œéƒ¨ç½²ï¼Œå¹¶é€šè¿‡ Heroku å¹³å°é—´æ¥è§è¯äº†æ•°åä¸‡åº”ç”¨ç¨‹åºçš„å¼€å‘ï¼Œè¿ä½œä»¥åŠæ‰©å±•çš„è¿‡ç¨‹ã€‚</p>
<p><code>The Twelve-Factor App</code>ç³»åˆ—æ–‡ç« ï¼Œç»¼åˆäº†Heroåº“å…³äº SaaS åº”ç”¨å‡ ä¹æ‰€æœ‰çš„ç»éªŒå’Œæ™ºæ…§ï¼Œæ˜¯å¼€å‘æ­¤ç±»åº”ç”¨çš„ç†æƒ³å®è·µæ ‡å‡†ï¼Œå¹¶ç‰¹åˆ«å…³æ³¨äºåº”ç”¨ç¨‹åºå¦‚ä½•ä¿æŒè‰¯æ€§æˆé•¿ï¼Œå¼€å‘è€…ä¹‹é—´å¦‚ä½•è¿›è¡Œæœ‰æ•ˆçš„ä»£ç åä½œï¼Œä»¥åŠå¦‚ä½• é¿å…è½¯ä»¶æ±¡æŸ“ ã€‚</p>
<blockquote>
<p>è‹±æ–‡åŸæ–‡</p>
</blockquote>
<h3 id="IX-X-Dev-prod-parity"><a href="#IX-X-Dev-prod-parity" class="headerlink" title="IX. X. Dev/prod parity"></a>IX. X. Dev/prod parity</h3><blockquote>
<p>Keep development, staging, and production as similar as possible</p>
</blockquote>
<p>Historically, there have been substantial gaps between development (a developer making live edits to a local deploy of the app) and production (a running deploy of the app accessed by end users). These gaps manifest in three areas:</p>
<ul>
<li>The time gap: A developer may work on code that takes days, weeks, or even months to go into production.</li>
<li>The personnel gap: Developers write code, ops engineers deploy it.</li>
<li>The tools gap: Developers may be using a stack like Nginx, SQLite, and OS X, while the production deploy uses Apache, MySQL, and Linux.</li>
</ul>
<p>The twelve-factor app is designed for continuous deployment by keeping the gap between development and production small. Looking at the three gaps described above:</p>
<ul>
<li>Make the time gap small: a developer may write code and have it deployed hours or even just minutes later.</li>
<li>Make the personnel gap small: developers who wrote code are closely involved in deploying it and watching its behavior in production.</li>
<li>Make the tools gap small: keep development and production as similar as possible.</li>
</ul>
<p>Summarizing the above into a table:</p>
<table>
<thead>
<tr>
<th></th>
<th>Traditional app</th>
<th>Twelve-factor app</th>
</tr>
</thead>
<tbody><tr>
<td>Time between deploys</td>
<td>Weeks</td>
<td>Hours</td>
</tr>
<tr>
<td>Code authors vs code deployers</td>
<td>Different people</td>
<td>Same people</td>
</tr>
<tr>
<td>Dev vs production environments</td>
<td>Divergent</td>
<td>As similar as possible</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>Backing services, such as the appâ€™s database, queueing system, or cache, is one area where dev/prod parity is important. Many languages offer libraries which simplify access to the backing service, including adapters to different types of services. Some examples are in the table below.</p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Language</th>
<th>Library</th>
<th>Adapters</th>
</tr>
</thead>
<tbody><tr>
<td>Database</td>
<td>Ruby/Rails</td>
<td>ActiveRecord</td>
<td>MySQL, PostgreSQL, SQLite</td>
</tr>
<tr>
<td>Queue</td>
<td>Python/Django</td>
<td>Celery</td>
<td>RabbitMQ, Beanstalkd, Redis</td>
</tr>
<tr>
<td>Cache</td>
<td>Ruby/Rails</td>
<td>ActiveSupport::Cache</td>
<td>Memory, filesystem, Memcached</td>
</tr>
</tbody></table>
<p>Developers sometimes find great appeal in using a lightweight backing service in their local environments, while a more serious and robust backing service will be used in production. For example, using SQLite locally and PostgreSQL in production; or local process memory for caching in development and Memcached in production.</p>
<p>The twelve-factor developer resists the urge to use different backing services between development and production, even when adapters theoretically abstract away any differences in backing services. Differences between backing services mean that tiny incompatibilities crop up, causing code that worked and passed tests in development or staging to fail in production. These types of errors create friction that disincentivizes continuous deployment. The cost of this friction and the subsequent dampening of continuous deployment is extremely high when considered in aggregate over the lifetime of an application.</p>
<p>Lightweight local services are less compelling than they once were. Modern backing services such as Memcached, PostgreSQL, and RabbitMQ are not difficult to install and run thanks to modern packaging systems, such as Homebrew and apt-get. Alternatively, declarative provisioning tools such as Chef and Puppet combined with light-weight virtual environments such as Docker and Vagrant allow developers to run local environments which closely approximate production environments. The cost of installing and using these systems is low compared to the benefit of dev/prod parity and continuous deployment.</p>
<p>Adapters to different backing services are still useful, because they make porting to new backing services relatively painless. But all deploys of the app (developer environments, staging, production) should be using the same type and version of each of the backing services.</p>
<blockquote>
<p>ä¸­æ–‡</p>
</blockquote>
<h3 id="X-å¼€å‘ç¯å¢ƒä¸çº¿ä¸Šç¯å¢ƒç­‰ä»·"><a href="#X-å¼€å‘ç¯å¢ƒä¸çº¿ä¸Šç¯å¢ƒç­‰ä»·" class="headerlink" title="X. å¼€å‘ç¯å¢ƒä¸çº¿ä¸Šç¯å¢ƒç­‰ä»·"></a>X. å¼€å‘ç¯å¢ƒä¸çº¿ä¸Šç¯å¢ƒç­‰ä»·</h3><blockquote>
<p>å°½å¯èƒ½çš„ä¿æŒå¼€å‘ï¼Œé¢„å‘å¸ƒï¼Œçº¿ä¸Šç¯å¢ƒç›¸åŒ</p>
</blockquote>
<p>ä»ä»¥å¾€ç»éªŒæ¥çœ‹ï¼Œå¼€å‘ç¯å¢ƒï¼ˆå³å¼€å‘äººå‘˜çš„æœ¬åœ° éƒ¨ç½²ï¼‰å’Œçº¿ä¸Šç¯å¢ƒï¼ˆå¤–éƒ¨ç”¨æˆ·è®¿é—®çš„çœŸå®éƒ¨ç½²ï¼‰ä¹‹é—´å­˜åœ¨ç€å¾ˆå¤šå·®å¼‚ã€‚è¿™äº›å·®å¼‚è¡¨ç°åœ¨ä»¥ä¸‹ä¸‰ä¸ªæ–¹é¢ï¼š</p>
<ul>
<li>æ—¶é—´å·®å¼‚ï¼š å¼€å‘äººå‘˜æ­£åœ¨ç¼–å†™çš„ä»£ç å¯èƒ½éœ€è¦å‡ å¤©ï¼Œå‡ å‘¨ï¼Œç”šè‡³å‡ ä¸ªæœˆæ‰ä¼šä¸Šçº¿ã€‚</li>
<li>äººå‘˜å·®å¼‚ï¼š å¼€å‘äººå‘˜ç¼–å†™ä»£ç ï¼Œè¿ç»´äººå‘˜éƒ¨ç½²ä»£ç ã€‚</li>
<li>å·¥å…·å·®å¼‚ï¼š å¼€å‘äººå‘˜æˆ–è®¸ä½¿ç”¨ Nginxï¼ŒSQLiteï¼ŒOS Xï¼Œè€Œçº¿ä¸Šç¯å¢ƒä½¿ç”¨ Apacheï¼ŒMySQL ä»¥åŠ Linuxã€‚</li>
</ul>
<p>12-Factor åº”ç”¨æƒ³è¦åšåˆ° æŒç»­éƒ¨ç½² å°±å¿…é¡»ç¼©å°æœ¬åœ°ä¸çº¿ä¸Šå·®å¼‚ã€‚ å†å›å¤´çœ‹ä¸Šé¢æ‰€æè¿°çš„ä¸‰ä¸ªå·®å¼‚:</p>
<ul>
<li>ç¼©å°æ—¶é—´å·®å¼‚ï¼šå¼€å‘äººå‘˜å¯ä»¥å‡ å°æ—¶ï¼Œç”šè‡³å‡ åˆ†é’Ÿå°±éƒ¨ç½²ä»£ç ã€‚</li>
<li>ç¼©å°äººå‘˜å·®å¼‚ï¼šå¼€å‘äººå‘˜ä¸åªè¦ç¼–å†™ä»£ç ï¼Œæ›´åº”è¯¥å¯†åˆ‡å‚ä¸éƒ¨ç½²è¿‡ç¨‹ä»¥åŠä»£ç åœ¨çº¿ä¸Šçš„è¡¨ç°ã€‚</li>
<li>ç¼©å°å·¥å…·å·®å¼‚ï¼šå°½é‡ä¿è¯å¼€å‘ç¯å¢ƒä»¥åŠçº¿ä¸Šç¯å¢ƒçš„ä¸€è‡´æ€§ã€‚</li>
</ul>
<p>å°†ä¸Šè¿°æ€»ç»“å˜ä¸ºä¸€ä¸ªè¡¨æ ¼å¦‚ä¸‹ï¼š</p>
<table>
<thead>
<tr>
<th></th>
<th>ä¼ ç»Ÿåº”ç”¨</th>
<th>12-Factor åº”ç”¨</th>
</tr>
</thead>
<tbody><tr>
<td>æ¯æ¬¡éƒ¨ç½²é—´éš”</td>
<td>æ•°å‘¨</td>
<td>å‡ å°æ—¶</td>
</tr>
<tr>
<td>å¼€å‘äººå‘˜ vs è¿ç»´äººå‘˜</td>
<td>ä¸åŒçš„äºº</td>
<td>ç›¸åŒçš„äºº</td>
</tr>
<tr>
<td>å¼€å‘ç¯å¢ƒ vs çº¿ä¸Šç¯å¢ƒ</td>
<td>ä¸åŒ</td>
<td>å°½é‡æ¥è¿‘</td>
</tr>
</tbody></table>
<p>åç«¯æœåŠ¡ æ˜¯ä¿æŒå¼€å‘ä¸çº¿ä¸Šç­‰ä»·çš„é‡è¦éƒ¨åˆ†ï¼Œä¾‹å¦‚æ•°æ®åº“ï¼Œé˜Ÿåˆ—ç³»ç»Ÿï¼Œä»¥åŠç¼“å­˜ã€‚è®¸å¤šè¯­è¨€éƒ½æä¾›äº†ç®€åŒ–è·å–åç«¯æœåŠ¡çš„ç±»åº“ï¼Œä¾‹å¦‚ä¸åŒç±»å‹æœåŠ¡çš„ é€‚é…å™¨ ã€‚ä¸‹åˆ—è¡¨æ ¼æä¾›äº†ä¸€äº›ä¾‹å­ã€‚</p>
<table>
<thead>
<tr>
<th>ç±»å‹</th>
<th>è¯­è¨€</th>
<th>ç±»åº“</th>
<th>é€‚é…å™¨</th>
</tr>
</thead>
<tbody><tr>
<td>æ•°æ®åº“</td>
<td>Ruby/Rails</td>
<td>ActiveRecord</td>
<td>MySQL, PostgreSQL, SQLite</td>
</tr>
<tr>
<td>é˜Ÿåˆ—</td>
<td>Python/Django</td>
<td>Celery</td>
<td>RabbitMQ, Beanstalkd, Redis</td>
</tr>
<tr>
<td>ç¼“å­˜</td>
<td>Ruby/Rails</td>
<td>ActiveSupport::Cache</td>
<td>Memory, filesystem, Memcached</td>
</tr>
</tbody></table>
<p>å¼€å‘äººå‘˜æœ‰æ—¶ä¼šè§‰å¾—åœ¨æœ¬åœ°ç¯å¢ƒä¸­ä½¿ç”¨è½»é‡çš„åç«¯æœåŠ¡å…·æœ‰å¾ˆå¼ºçš„å¸å¼•åŠ›ï¼Œè€Œé‚£äº›æ›´é‡é‡çº§çš„å¥å£®çš„åç«¯æœåŠ¡åº”è¯¥ä½¿ç”¨åœ¨ç”Ÿäº§ç¯å¢ƒã€‚ä¾‹å¦‚ï¼Œæœ¬åœ°ä½¿ç”¨ SQLite çº¿ä¸Šä½¿ç”¨ PostgreSQLï¼›åˆå¦‚æœ¬åœ°ç¼“å­˜åœ¨è¿›ç¨‹å†…å­˜ä¸­è€Œçº¿ä¸Šå­˜å…¥ Memcachedã€‚</p>
<p>12-Factor åº”ç”¨çš„å¼€å‘äººå‘˜åº”è¯¥åå¯¹åœ¨ä¸åŒç¯å¢ƒé—´ä½¿ç”¨ä¸åŒçš„åç«¯æœåŠ¡ ï¼Œå³ä½¿é€‚é…å™¨å·²ç»å¯ä»¥å‡ ä¹æ¶ˆé™¤ä½¿ç”¨ä¸Šçš„å·®å¼‚ã€‚è¿™æ˜¯å› ä¸ºï¼Œä¸åŒçš„åç«¯æœåŠ¡æ„å‘³ç€ä¼šçªç„¶å‡ºç°çš„ä¸å…¼å®¹ï¼Œä»è€Œå¯¼è‡´æµ‹è¯•ã€é¢„å‘å¸ƒéƒ½æ­£å¸¸çš„ä»£ç åœ¨çº¿ä¸Šå‡ºç°é—®é¢˜ã€‚è¿™äº›é”™è¯¯ä¼šç»™æŒç»­éƒ¨ç½²å¸¦æ¥é˜»åŠ›ã€‚ä»åº”ç”¨ç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸæ¥çœ‹ï¼Œæ¶ˆé™¤è¿™ç§é˜»åŠ›éœ€è¦èŠ±è´¹å¾ˆå¤§çš„ä»£ä»·ã€‚</p>
<p>ä¸æ­¤åŒæ—¶ï¼Œè½»é‡çš„æœ¬åœ°æœåŠ¡ä¹Ÿä¸åƒä»¥å‰é‚£æ ·å¼•äººæ³¨ç›®ã€‚å€ŸåŠ©äºHomebrewï¼Œapt-getç­‰ç°ä»£çš„æ‰“åŒ…ç³»ç»Ÿï¼Œè¯¸å¦‚Memcachedã€PostgreSQLã€RabbitMQ ç­‰åç«¯æœåŠ¡çš„å®‰è£…ä¸è¿è¡Œä¹Ÿå¹¶ä¸å¤æ‚ã€‚æ­¤å¤–ï¼Œä½¿ç”¨ç±»ä¼¼ Chef å’Œ Puppet çš„å£°æ˜å¼é…ç½®å·¥å…·ï¼Œç»“åˆåƒ Vagrant è¿™æ ·è½»é‡çš„è™šæ‹Ÿç¯å¢ƒå°±å¯ä»¥ä½¿å¾—å¼€å‘äººå‘˜çš„æœ¬åœ°ç¯å¢ƒä¸çº¿ä¸Šç¯å¢ƒæ— é™æ¥è¿‘ã€‚ä¸åŒæ­¥ç¯å¢ƒå’ŒæŒç»­éƒ¨ç½²æ‰€å¸¦æ¥çš„ç›Šå¤„ç›¸æ¯”ï¼Œå®‰è£…è¿™äº›ç³»ç»Ÿæ˜¾ç„¶æ˜¯å€¼å¾—çš„ã€‚</p>
<p>ä¸åŒåç«¯æœåŠ¡çš„é€‚é…å™¨ä»ç„¶æ˜¯æœ‰ç”¨çš„ï¼Œå› ä¸ºå®ƒä»¬å¯ä»¥ä½¿ç§»æ¤åç«¯æœåŠ¡å˜å¾—ç®€å•ã€‚ä½†åº”ç”¨çš„æ‰€æœ‰éƒ¨ç½²ï¼Œè¿™å…¶ä¸­åŒ…æ‹¬å¼€å‘ã€é¢„å‘å¸ƒä»¥åŠçº¿ä¸Šç¯å¢ƒï¼Œéƒ½åº”è¯¥ä½¿ç”¨åŒä¸€ä¸ªåç«¯æœåŠ¡çš„ç›¸åŒç‰ˆæœ¬ã€‚</p>
]]></content>
      <tags>
        <tag>The Twelve-Factor App</tag>
      </tags>
  </entry>
  <entry>
    <title>The Twelve-Factor App--XI.Logs</title>
    <url>/2022/06/24/uncatalog/cl4s5aedu000hyor72kq5660y/</url>
    <content><![CDATA[<hr>
<span id="more"></span>
<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>å¦‚ä»Šï¼Œè½¯ä»¶é€šå¸¸ä¼šä½œä¸ºä¸€ç§æœåŠ¡æ¥äº¤ä»˜ï¼Œå®ƒä»¬è¢«ç§°ä¸ºç½‘ç»œåº”ç”¨ç¨‹åºï¼Œæˆ–è½¯ä»¶å³æœåŠ¡ï¼ˆSaaSï¼‰ã€‚12-Factor ä¸ºæ„å»ºå¦‚ä¸‹çš„ SaaS åº”ç”¨æä¾›äº†æ–¹æ³•è®ºï¼š</p>
<ul>
<li>ä½¿ç”¨æ ‡å‡†åŒ–æµç¨‹è‡ªåŠ¨é…ç½®ï¼Œä»è€Œä½¿æ–°çš„å¼€å‘è€…èŠ±è´¹æœ€å°‘çš„å­¦ä¹ æˆæœ¬åŠ å…¥è¿™ä¸ªé¡¹ç›®ã€‚</li>
<li>å’Œæ“ä½œç³»ç»Ÿä¹‹é—´å°½å¯èƒ½çš„åˆ’æ¸…ç•Œé™ï¼Œåœ¨å„ä¸ªç³»ç»Ÿä¸­æä¾›æœ€å¤§çš„å¯ç§»æ¤æ€§ã€‚</li>
<li>é€‚åˆéƒ¨ç½²åœ¨ç°ä»£çš„äº‘è®¡ç®—å¹³å°ï¼Œä»è€Œåœ¨æœåŠ¡å™¨å’Œç³»ç»Ÿç®¡ç†æ–¹é¢èŠ‚çœèµ„æºã€‚</li>
<li>å°†å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒçš„å·®å¼‚é™è‡³æœ€ä½ï¼Œå¹¶ä½¿ç”¨æŒç»­äº¤ä»˜å®æ–½æ•æ·å¼€å‘ã€‚</li>
<li>å¯ä»¥åœ¨å·¥å…·ã€æ¶æ„å’Œå¼€å‘æµç¨‹ä¸å‘ç”Ÿæ˜æ˜¾å˜åŒ–çš„å‰æä¸‹å®ç°æ‰©å±•ã€‚<br>è¿™å¥—ç†è®ºé€‚ç”¨äºä»»æ„è¯­è¨€å’Œåç«¯æœåŠ¡ï¼ˆæ•°æ®åº“ã€æ¶ˆæ¯é˜Ÿåˆ—ã€ç¼“å­˜ç­‰ï¼‰å¼€å‘çš„åº”ç”¨ç¨‹åºã€‚</li>
</ul>
<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>è¿™å¥—æ–¹æ³•è®ºç”±Herokuçš„è”åˆåˆ›å§‹äººAdam Wigginså‘æ˜ï¼Œåº”ç”¨åˆ°äº†æ•°ä»¥ç™¾è®¡çš„åº”ç”¨ç¨‹åºçš„å¼€å‘å’Œéƒ¨ç½²ï¼Œå¹¶é€šè¿‡ Heroku å¹³å°é—´æ¥è§è¯äº†æ•°åä¸‡åº”ç”¨ç¨‹åºçš„å¼€å‘ï¼Œè¿ä½œä»¥åŠæ‰©å±•çš„è¿‡ç¨‹ã€‚</p>
<p><code>The Twelve-Factor App</code>ç³»åˆ—æ–‡ç« ï¼Œç»¼åˆäº†Heroåº“å…³äº SaaS åº”ç”¨å‡ ä¹æ‰€æœ‰çš„ç»éªŒå’Œæ™ºæ…§ï¼Œæ˜¯å¼€å‘æ­¤ç±»åº”ç”¨çš„ç†æƒ³å®è·µæ ‡å‡†ï¼Œå¹¶ç‰¹åˆ«å…³æ³¨äºåº”ç”¨ç¨‹åºå¦‚ä½•ä¿æŒè‰¯æ€§æˆé•¿ï¼Œå¼€å‘è€…ä¹‹é—´å¦‚ä½•è¿›è¡Œæœ‰æ•ˆçš„ä»£ç åä½œï¼Œä»¥åŠå¦‚ä½• é¿å…è½¯ä»¶æ±¡æŸ“ ã€‚</p>
<blockquote>
<p>è‹±æ–‡åŸæ–‡</p>
</blockquote>
<h3 id="XI-Logs"><a href="#XI-Logs" class="headerlink" title="XI. Logs"></a>XI. Logs</h3><blockquote>
<p>Treat logs as event streams</p>
</blockquote>
<p>Logs provide visibility into the behavior of a running app. In server-based environments they are commonly written to a file on disk (a â€œlogfileâ€); but this is only an output format.</p>
<p>Logs are the stream of aggregated, time-ordered events collected from the output streams of all running processes and backing services. Logs in their raw form are typically a text format with one event per line (though backtraces from exceptions may span multiple lines). Logs have no fixed beginning or end, but flow continuously as long as the app is operating.</p>
<p>A twelve-factor app never concerns itself with routing or storage of its output stream. It should not attempt to write to or manage logfiles. Instead, each running process writes its event stream, unbuffered, to stdout. During local development, the developer will view this stream in the foreground of their terminal to observe the appâ€™s behavior.</p>
<p>In staging or production deploys, each processâ€™ stream will be captured by the execution environment, collated together with all other streams from the app, and routed to one or more final destinations for viewing and long-term archival. These archival destinations are not visible to or configurable by the app, and instead are completely managed by the execution environment. Open-source log routers (such as Logplex and Fluentd) are available for this purpose.</p>
<p>The event stream for an app can be routed to a file, or watched via realtime tail in a terminal. Most significantly, the stream can be sent to a log indexing and analysis system such as Splunk, or a general-purpose data warehousing system such as Hadoop/Hive. These systems allow for great power and flexibility for introspecting an appâ€™s behavior over time, including:</p>
<ul>
<li>Finding specific events in the past.</li>
<li>Large-scale graphing of trends (such as requests per minute).</li>
<li>Active alerting according to user-defined heuristics (such as an alert when the quantity of errors per minute exceeds a certain threshold).</li>
</ul>
<blockquote>
<p>ä¸­æ–‡</p>
</blockquote>
<h3 id="XI-æ—¥å¿—"><a href="#XI-æ—¥å¿—" class="headerlink" title="XI. æ—¥å¿—"></a>XI. æ—¥å¿—</h3><blockquote>
<p>æŠŠæ—¥å¿—å½“ä½œäº‹ä»¶æµ</p>
</blockquote>
<p>æ—¥å¿— ä½¿å¾—åº”ç”¨ç¨‹åºè¿è¡Œçš„åŠ¨ä½œå˜å¾—é€æ˜ã€‚åœ¨åŸºäºæœåŠ¡å™¨çš„ç¯å¢ƒä¸­ï¼Œæ—¥å¿—é€šå¸¸è¢«å†™åœ¨ç¡¬ç›˜çš„ä¸€ä¸ªæ–‡ä»¶é‡Œï¼Œä½†è¿™åªæ˜¯ä¸€ç§è¾“å‡ºæ ¼å¼ã€‚</p>
<p>æ—¥å¿—åº”è¯¥æ˜¯ äº‹ä»¶æµ çš„æ±‡æ€»ï¼Œå°†æ‰€æœ‰è¿è¡Œä¸­è¿›ç¨‹å’Œåç«¯æœåŠ¡çš„è¾“å‡ºæµæŒ‰ç…§æ—¶é—´é¡ºåºæ”¶é›†èµ·æ¥ã€‚å°½ç®¡åœ¨å›æº¯é—®é¢˜æ—¶å¯èƒ½éœ€è¦çœ‹å¾ˆå¤šè¡Œï¼Œæ—¥å¿—æœ€åŸå§‹çš„æ ¼å¼ç¡®å®æ˜¯ä¸€ä¸ªäº‹ä»¶ä¸€è¡Œã€‚æ—¥å¿—æ²¡æœ‰ç¡®å®šå¼€å§‹å’Œç»“æŸï¼Œä½†éšç€åº”ç”¨åœ¨è¿è¡Œä¼šæŒç»­çš„å¢åŠ ã€‚</p>
<p>12-factoråº”ç”¨æœ¬èº«ä»ä¸è€ƒè™‘å­˜å‚¨è‡ªå·±çš„è¾“å‡ºæµã€‚ ä¸åº”è¯¥è¯•å›¾å»å†™æˆ–è€…ç®¡ç†æ—¥å¿—æ–‡ä»¶ã€‚ç›¸åï¼Œæ¯ä¸€ä¸ªè¿è¡Œçš„è¿›ç¨‹éƒ½ä¼šç›´æ¥çš„æ ‡å‡†è¾“å‡ºï¼ˆstdoutï¼‰äº‹ä»¶æµã€‚å¼€å‘ç¯å¢ƒä¸­ï¼Œå¼€å‘äººå‘˜å¯ä»¥é€šè¿‡è¿™äº›æ•°æ®æµï¼Œå®æ—¶åœ¨ç»ˆç«¯çœ‹åˆ°åº”ç”¨çš„æ´»åŠ¨ã€‚</p>
<p>åœ¨é¢„å‘å¸ƒæˆ–çº¿ä¸Šéƒ¨ç½²ä¸­ï¼Œæ¯ä¸ªè¿›ç¨‹çš„è¾“å‡ºæµç”±è¿è¡Œç¯å¢ƒæˆªè·ï¼Œå¹¶å°†å…¶ä»–è¾“å‡ºæµæ•´ç†åœ¨ä¸€èµ·ï¼Œç„¶åä¸€å¹¶å‘é€ç»™ä¸€ä¸ªæˆ–å¤šä¸ªæœ€ç»ˆçš„å¤„ç†ç¨‹åºï¼Œç”¨äºæŸ¥çœ‹æˆ–æ˜¯é•¿æœŸå­˜æ¡£ã€‚è¿™äº›å­˜æ¡£è·¯å¾„å¯¹äºåº”ç”¨æ¥è¯´ä¸å¯è§ä¹Ÿä¸å¯é…ç½®ï¼Œè€Œæ˜¯å®Œå…¨äº¤ç»™ç¨‹åºçš„è¿è¡Œç¯å¢ƒç®¡ç†ã€‚ç±»ä¼¼ Logplex å’Œ Fluentd çš„å¼€æºå·¥å…·å¯ä»¥è¾¾åˆ°è¿™ä¸ªç›®çš„ã€‚</p>
<p>è¿™äº›äº‹ä»¶æµå¯ä»¥è¾“å‡ºè‡³æ–‡ä»¶ï¼Œæˆ–è€…åœ¨ç»ˆç«¯å®æ—¶è§‚å¯Ÿã€‚æœ€é‡è¦çš„ï¼Œè¾“å‡ºæµå¯ä»¥å‘é€åˆ° Splunk è¿™æ ·çš„æ—¥å¿—ç´¢å¼•åŠåˆ†æç³»ç»Ÿï¼Œæˆ– Hadoop/Hive è¿™æ ·çš„é€šç”¨æ•°æ®å­˜å‚¨ç³»ç»Ÿã€‚è¿™äº›ç³»ç»Ÿä¸ºæŸ¥çœ‹åº”ç”¨çš„å†å²æ´»åŠ¨æä¾›äº†å¼ºå¤§è€Œçµæ´»çš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬ï¼š</p>
<ul>
<li>æ‰¾å‡ºè¿‡å»ä¸€æ®µæ—¶é—´ç‰¹æ®Šçš„äº‹ä»¶ã€‚</li>
<li>å›¾å½¢åŒ–ä¸€ä¸ªå¤§è§„æ¨¡çš„è¶‹åŠ¿ï¼Œæ¯”å¦‚æ¯åˆ†é’Ÿçš„è¯·æ±‚é‡ã€‚</li>
<li>æ ¹æ®ç”¨æˆ·å®šä¹‰çš„æ¡ä»¶å®æ—¶è§¦å‘è­¦æŠ¥ï¼Œæ¯”å¦‚æ¯åˆ†é’Ÿçš„æŠ¥é”™è¶…è¿‡æŸä¸ªè­¦æˆ’çº¿ã€‚</li>
</ul>
]]></content>
      <tags>
        <tag>The Twelve-Factor App</tag>
      </tags>
  </entry>
  <entry>
    <title>The Twelve-Factor App--XII.Admin_processes</title>
    <url>/2022/06/24/uncatalog/cl4s5aedw000jyor73nwic37r/</url>
    <content><![CDATA[<hr>
<span id="more"></span>
<h2 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h2><p>å¦‚ä»Šï¼Œè½¯ä»¶é€šå¸¸ä¼šä½œä¸ºä¸€ç§æœåŠ¡æ¥äº¤ä»˜ï¼Œå®ƒä»¬è¢«ç§°ä¸ºç½‘ç»œåº”ç”¨ç¨‹åºï¼Œæˆ–è½¯ä»¶å³æœåŠ¡ï¼ˆSaaSï¼‰ã€‚12-Factor ä¸ºæ„å»ºå¦‚ä¸‹çš„ SaaS åº”ç”¨æä¾›äº†æ–¹æ³•è®ºï¼š</p>
<ul>
<li>ä½¿ç”¨æ ‡å‡†åŒ–æµç¨‹è‡ªåŠ¨é…ç½®ï¼Œä»è€Œä½¿æ–°çš„å¼€å‘è€…èŠ±è´¹æœ€å°‘çš„å­¦ä¹ æˆæœ¬åŠ å…¥è¿™ä¸ªé¡¹ç›®ã€‚</li>
<li>å’Œæ“ä½œç³»ç»Ÿä¹‹é—´å°½å¯èƒ½çš„åˆ’æ¸…ç•Œé™ï¼Œåœ¨å„ä¸ªç³»ç»Ÿä¸­æä¾›æœ€å¤§çš„å¯ç§»æ¤æ€§ã€‚</li>
<li>é€‚åˆéƒ¨ç½²åœ¨ç°ä»£çš„äº‘è®¡ç®—å¹³å°ï¼Œä»è€Œåœ¨æœåŠ¡å™¨å’Œç³»ç»Ÿç®¡ç†æ–¹é¢èŠ‚çœèµ„æºã€‚</li>
<li>å°†å¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒçš„å·®å¼‚é™è‡³æœ€ä½ï¼Œå¹¶ä½¿ç”¨æŒç»­äº¤ä»˜å®æ–½æ•æ·å¼€å‘ã€‚</li>
<li>å¯ä»¥åœ¨å·¥å…·ã€æ¶æ„å’Œå¼€å‘æµç¨‹ä¸å‘ç”Ÿæ˜æ˜¾å˜åŒ–çš„å‰æä¸‹å®ç°æ‰©å±•ã€‚<br>è¿™å¥—ç†è®ºé€‚ç”¨äºä»»æ„è¯­è¨€å’Œåç«¯æœåŠ¡ï¼ˆæ•°æ®åº“ã€æ¶ˆæ¯é˜Ÿåˆ—ã€ç¼“å­˜ç­‰ï¼‰å¼€å‘çš„åº”ç”¨ç¨‹åºã€‚</li>
</ul>
<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>è¿™å¥—æ–¹æ³•è®ºç”±Herokuçš„è”åˆåˆ›å§‹äººAdam Wigginså‘æ˜ï¼Œåº”ç”¨åˆ°äº†æ•°ä»¥ç™¾è®¡çš„åº”ç”¨ç¨‹åºçš„å¼€å‘å’Œéƒ¨ç½²ï¼Œå¹¶é€šè¿‡ Heroku å¹³å°é—´æ¥è§è¯äº†æ•°åä¸‡åº”ç”¨ç¨‹åºçš„å¼€å‘ï¼Œè¿ä½œä»¥åŠæ‰©å±•çš„è¿‡ç¨‹ã€‚</p>
<p><code>The Twelve-Factor App</code>ç³»åˆ—æ–‡ç« ï¼Œç»¼åˆäº†Heroåº“å…³äº SaaS åº”ç”¨å‡ ä¹æ‰€æœ‰çš„ç»éªŒå’Œæ™ºæ…§ï¼Œæ˜¯å¼€å‘æ­¤ç±»åº”ç”¨çš„ç†æƒ³å®è·µæ ‡å‡†ï¼Œå¹¶ç‰¹åˆ«å…³æ³¨äºåº”ç”¨ç¨‹åºå¦‚ä½•ä¿æŒè‰¯æ€§æˆé•¿ï¼Œå¼€å‘è€…ä¹‹é—´å¦‚ä½•è¿›è¡Œæœ‰æ•ˆçš„ä»£ç åä½œï¼Œä»¥åŠå¦‚ä½• é¿å…è½¯ä»¶æ±¡æŸ“ ã€‚</p>
<blockquote>
<p>è‹±æ–‡åŸæ–‡</p>
</blockquote>
<h3 id="XII-Admin-processes"><a href="#XII-Admin-processes" class="headerlink" title="XII. Admin processes"></a>XII. Admin processes</h3><blockquote>
<p>Run admin/management tasks as one-off processes</p>
</blockquote>
<p>The process formation is the array of processes that are used to do the appâ€™s regular business (such as handling web requests) as it runs. Separately, developers will often wish to do one-off administrative or maintenance tasks for the app, such as:</p>
<ul>
<li>Running database migrations (e.g. manage.py migrate in Django, rake db:migrate in Rails).</li>
<li>Running a console (also known as a REPL shell) to run arbitrary code or inspect the appâ€™s models against the live database. Most languages provide a REPL by running the interpreter without any arguments (e.g. python or perl) or in some cases have a separate command (e.g. irb for Ruby, rails console for Rails).</li>
<li>Running one-time scripts committed into the appâ€™s repo (e.g. php scripts/fix_bad_records.php).</li>
</ul>
<p>One-off admin processes should be run in an identical environment as the regular long-running processes of the app. They run against a release, using the same codebase and config as any process run against that release. Admin code must ship with application code to avoid synchronization issues.</p>
<p>The same dependency isolation techniques should be used on all process types. For example, if the Ruby web process uses the command bundle exec thin start, then a database migration should use bundle exec rake db:migrate. Likewise, a Python program using Virtualenv should use the vendored bin/python for running both the Tornado webserver and any manage.py admin processes.</p>
<p>Twelve-factor strongly favors languages which provide a REPL shell out of the box, and which make it easy to run one-off scripts. In a local deploy, developers invoke one-off admin processes by a direct shell command inside the appâ€™s checkout directory. In a production deploy, developers can use ssh or other remote command execution mechanism provided by that deployâ€™s execution environment to run such a process.</p>
<blockquote>
<p>ä¸­æ–‡</p>
</blockquote>
<h3 id="XII-ç®¡ç†è¿›ç¨‹"><a href="#XII-ç®¡ç†è¿›ç¨‹" class="headerlink" title="XII. ç®¡ç†è¿›ç¨‹"></a>XII. ç®¡ç†è¿›ç¨‹</h3><blockquote>
<p>åå°ç®¡ç†ä»»åŠ¡å½“ä½œä¸€æ¬¡æ€§è¿›ç¨‹è¿è¡Œ</p>
</blockquote>
<p>è¿›ç¨‹æ„æˆï¼ˆprocess formationï¼‰æ˜¯æŒ‡ç”¨æ¥å¤„ç†åº”ç”¨çš„å¸¸è§„ä¸šåŠ¡ï¼ˆæ¯”å¦‚å¤„ç† web è¯·æ±‚ï¼‰çš„ä¸€ç»„è¿›ç¨‹ã€‚ä¸æ­¤ä¸åŒï¼Œå¼€å‘äººå‘˜ç»å¸¸å¸Œæœ›æ‰§è¡Œä¸€äº›ç®¡ç†æˆ–ç»´æŠ¤åº”ç”¨çš„ä¸€æ¬¡æ€§ä»»åŠ¡ï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li>è¿è¡Œæ•°æ®ç§»æ¤ï¼ˆDjango ä¸­çš„ manage.py migrate, Rails ä¸­çš„ rake db:migrateï¼‰ã€‚</li>
<li>è¿è¡Œä¸€ä¸ªæ§åˆ¶å°ï¼ˆä¹Ÿè¢«ç§°ä¸º REPL shellï¼‰ï¼Œæ¥æ‰§è¡Œä¸€äº›ä»£ç æˆ–æ˜¯é’ˆå¯¹çº¿ä¸Šæ•°æ®åº“åšä¸€äº›æ£€æŸ¥ã€‚å¤§å¤šæ•°è¯­è¨€éƒ½é€šè¿‡è§£é‡Šå™¨æä¾›äº†ä¸€ä¸ª REPL å·¥å…·ï¼ˆpython æˆ– perlï¼‰ ï¼Œæˆ–æ˜¯å…¶ä»–å‘½ä»¤ï¼ˆRuby ä½¿ç”¨ irb, Rails ä½¿ç”¨ rails consoleï¼‰ã€‚</li>
<li>è¿è¡Œä¸€äº›æäº¤åˆ°ä»£ç ä»“åº“çš„ä¸€æ¬¡æ€§è„šæœ¬ã€‚</li>
</ul>
<p>ä¸€æ¬¡æ€§ç®¡ç†è¿›ç¨‹åº”è¯¥å’Œæ­£å¸¸çš„ å¸¸é©»è¿›ç¨‹ ä½¿ç”¨åŒæ ·çš„ç¯å¢ƒã€‚è¿™äº›ç®¡ç†è¿›ç¨‹å’Œä»»ä½•å…¶ä»–çš„è¿›ç¨‹ä¸€æ ·ä½¿ç”¨ç›¸åŒçš„ ä»£ç  å’Œ é…ç½® ï¼ŒåŸºäºæŸä¸ª å‘å¸ƒç‰ˆæœ¬ è¿è¡Œã€‚åå°ç®¡ç†ä»£ç åº”è¯¥éšå…¶ä»–åº”ç”¨ç¨‹åºä»£ç ä¸€èµ·å‘å¸ƒï¼Œä»è€Œé¿å…åŒæ­¥é—®é¢˜ã€‚</p>
<p>æ‰€æœ‰è¿›ç¨‹ç±»å‹åº”è¯¥ä½¿ç”¨åŒæ ·çš„ ä¾èµ–éš”ç¦» æŠ€æœ¯ã€‚ä¾‹å¦‚ï¼Œå¦‚æœRubyçš„webè¿›ç¨‹ä½¿ç”¨äº†å‘½ä»¤ bundle exec thin start ï¼Œé‚£ä¹ˆæ•°æ®åº“ç§»æ¤åº”ä½¿ç”¨ bundle exec rake db:migrate ã€‚åŒæ ·çš„ï¼Œå¦‚æœä¸€ä¸ª Python ç¨‹åºä½¿ç”¨äº† Virtualenvï¼Œåˆ™éœ€è¦åœ¨è¿è¡Œ Tornado Web æœåŠ¡å™¨å’Œä»»ä½• manage.py ç®¡ç†è¿›ç¨‹æ—¶å¼•å…¥ bin/python ã€‚</p>
<p>12-factor å°¤å…¶é’çé‚£äº›æä¾›äº† REPL shell çš„è¯­è¨€ï¼Œå› ä¸ºé‚£ä¼šè®©è¿è¡Œä¸€æ¬¡æ€§è„šæœ¬å˜å¾—ç®€å•ã€‚åœ¨æœ¬åœ°éƒ¨ç½²ä¸­ï¼Œå¼€å‘äººå‘˜ç›´æ¥åœ¨å‘½ä»¤è¡Œä½¿ç”¨ shell å‘½ä»¤è°ƒç”¨ä¸€æ¬¡æ€§ç®¡ç†è¿›ç¨‹ã€‚åœ¨çº¿ä¸Šéƒ¨ç½²ä¸­ï¼Œå¼€å‘äººå‘˜ä¾æ—§å¯ä»¥ä½¿ç”¨sshæˆ–æ˜¯è¿è¡Œç¯å¢ƒæä¾›çš„å…¶ä»–æœºåˆ¶æ¥è¿è¡Œè¿™æ ·çš„è¿›ç¨‹ã€‚</p>
]]></content>
      <tags>
        <tag>The Twelve-Factor App</tag>
      </tags>
  </entry>
  <entry>
    <title>Goç¼–ç¨‹æ¨¡å¼ä¹‹--å‡½æ•°å¼é€‰é¡¹æ¨¡å¼</title>
    <url>/2022/07/01/uncatalog/cl53og7mv0000xwr74g9n8mtt/</url>
    <content><![CDATA[<hr>
<span id="more"></span>
<p>Goç¼–ç¨‹æ¨¡å¼ä¹‹â€“å‡½æ•°å¼é€‰é¡¹æ¨¡å¼</p>
<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>åœ¨é˜…è¯»grpcå’Œgormæºç çš„æ—¶å€™ï¼Œå‘ç°äº†ä¸€ä¸ªæ¯”è¾ƒæœ‰æ„æ€çš„è®¾è®¡ï¼š</p>
<blockquote>
<p>grpc: ServerOption</p>
</blockquote>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// A ServerOption sets options such as credentials, codec and keepalive parameters, etc.</span></span><br><span class="line"><span class="keyword">type</span> ServerOption <span class="keyword">interface</span> &#123;</span><br><span class="line">apply(*serverOptions)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// NewServer creates a gRPC server which has no service registered and has not</span></span><br><span class="line"><span class="comment">// started to accept requests yet.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewServer</span><span class="params">(opt ...ServerOption)</span> *<span class="title">Server</span></span> &#123;</span><br><span class="line">	opts := defaultServerOptions</span><br><span class="line">	<span class="keyword">for</span> _, o := <span class="keyword">range</span> opt &#123;</span><br><span class="line">		o.apply(&amp;opts)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="comment">// çœç•¥ ...</span></span><br><span class="line">	s := &amp;Server&#123;&#125;</span><br><span class="line">	<span class="keyword">return</span> s</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>gorm: Option</p>
</blockquote>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Option gorm option interface</span></span><br><span class="line"><span class="keyword">type</span> Option <span class="keyword">interface</span> &#123;</span><br><span class="line">Apply(*Config) error</span><br><span class="line">AfterInitialize(*DB) error</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Open initialize db session based on dialector</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Open</span><span class="params">(dialector Dialector, opts ...Option)</span> <span class="params">(db *DB, err error)</span></span> &#123;</span><br><span class="line">        config := &amp;Config&#123;&#125;</span><br><span class="line">        <span class="comment">// çœç•¥...</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> _, opt := <span class="keyword">range</span> opts &#123;</span><br><span class="line">        <span class="keyword">if</span> opt != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> applyErr := opt.Apply(config); applyErr != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>, applyErr</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// çœç•¥...</span></span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>è®¾è®¡ä¸Šçš„å…±åŒç‚¹è¿˜æ˜¯å¾ˆæ˜æ˜¾çš„ï¼Œæ¥ä¸‹æ¥å°†ä»å®è·µå‡ºå‘ï¼Œå‰–æä¸€ä¸‹è¿™ç§è®¾è®¡çš„ç²¾å¦™ä¹‹å¤„ã€‚</p>
<h2 id="å‡½æ•°å¼é€‰é¡¹æ¨¡å¼"><a href="#å‡½æ•°å¼é€‰é¡¹æ¨¡å¼" class="headerlink" title="å‡½æ•°å¼é€‰é¡¹æ¨¡å¼"></a>å‡½æ•°å¼é€‰é¡¹æ¨¡å¼</h2><p>Go è¯­è¨€æ²¡æœ‰æ„é€ å‡½æ•°ï¼Œä¸€èˆ¬é€šè¿‡å®šä¹‰ New å‡½æ•°æ¥å……å½“æ„é€ å‡½æ•°ã€‚ç„¶è€Œï¼Œå¦‚æœç»“æ„æœ‰è¾ƒå¤šå­—æ®µï¼Œè¦åˆå§‹åŒ–è¿™äº›å­—æ®µï¼Œæœ‰å¾ˆå¤šç§æ–¹å¼ï¼Œä½†æœ‰ä¸€ç§æ–¹å¼è®¤ä¸ºæ˜¯æœ€å¥½çš„ï¼Œè¿™å°±æ˜¯å‡½æ•°å¼é€‰é¡¹æ¨¡å¼ï¼ˆFunctional Options Patternï¼‰ã€‚</p>
<p>å‡½æ•°å¼é€‰é¡¹æ¨¡å¼æ˜¯ä¸€ç§åœ¨ Go ä¸­æ„é€ ç»“æ„ä½“çš„æ¨¡å¼ï¼Œå®ƒé€šè¿‡è®¾è®¡ä¸€ç»„éå¸¸æœ‰è¡¨ç°åŠ›å’Œçµæ´»çš„ API æ¥å¸®åŠ©é…ç½®å’Œåˆå§‹åŒ–ç»“æ„ä½“ã€‚</p>
<p>åœ¨ Uber çš„ Go è¯­è¨€è§„èŒƒä¸­æåˆ°äº†è¯¥æ¨¡å¼ï¼š</p>
<blockquote>
<p>Functional options æ˜¯ä¸€ç§æ¨¡å¼ï¼Œåœ¨è¯¥æ¨¡å¼ä¸­ï¼Œä½ å¯ä»¥å£°æ˜ä¸€ä¸ªä¸é€æ˜çš„ Option ç±»å‹ï¼Œè¯¥ç±»å‹åœ¨æŸäº›å†…éƒ¨ç»“æ„ä¸­è®°å½•ä¿¡æ¯ã€‚ä½ æ¥å—è¿™äº›å¯å˜æ•°é‡çš„é€‰é¡¹ï¼Œå¹¶æ ¹æ®å†…éƒ¨ç»“æ„ä¸Šçš„é€‰é¡¹è®°å½•çš„å®Œæ•´ä¿¡æ¯è¿›è¡Œæ“ä½œã€‚å°†æ­¤æ¨¡å¼ç”¨äºæ„é€ å‡½æ•°å’Œå…¶ä»–å…¬å…± API ä¸­çš„å¯é€‰å‚æ•°ï¼Œä½ é¢„è®¡è¿™äº›å‚æ•°éœ€è¦æ‰©å±•ï¼Œå°¤å…¶æ˜¯åœ¨è¿™äº›å‡½æ•°ä¸Šå·²ç»æœ‰ä¸‰ä¸ªæˆ–æ›´å¤šå‚æ•°çš„æƒ…å†µä¸‹ã€‚</p>
</blockquote>
<h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><p>ä¸ºäº†æ›´å¥½çš„ç†è§£è¯¥æ¨¡å¼ï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥è®²è§£ã€‚</p>
<p>å®šä¹‰ä¸€ä¸ª Server ç»“æ„ä½“ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Server <span class="keyword">struct</span>&#123;</span><br><span class="line">  host <span class="keyword">string</span></span><br><span class="line">  port <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">New</span><span class="params">(host <span class="keyword">string</span>, port <span class="keyword">int</span>)</span> *<span class="title">Server</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &amp;Server&#123;host, port&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *Server)</span> <span class="title">Start</span><span class="params">()</span> <span class="title">error</span></span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>å¦‚ä½•ä½¿ç”¨å‘¢ï¼Ÿ</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;log&quot;</span></span><br><span class="line">  <span class="string">&quot;server&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  svr := New(<span class="string">&quot;localhost&quot;</span>, <span class="number">1234</span>)</span><br><span class="line">  <span class="keyword">if</span> err := svr.Start(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">    log.Fatal(err)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>ä½†å¦‚æœè¦æ‰©å±• Server çš„é…ç½®é€‰é¡¹ï¼Œå¦‚ä½•åšï¼Ÿé€šå¸¸æœ‰ä¸‰ç§åšæ³•ï¼š</p>
<ul>
<li>ä¸ºæ¯ä¸ªä¸åŒçš„é…ç½®é€‰é¡¹å£°æ˜ä¸€ä¸ªæ–°çš„æ„é€ å‡½æ•°</li>
<li>å®šä¹‰ä¸€ä¸ªæ–°çš„ Config ç»“æ„ä½“æ¥ä¿å­˜é…ç½®ä¿¡æ¯</li>
<li>ä½¿ç”¨ Functional Option Pattern</li>
</ul>
<h4 id="åšæ³•-1ï¼šä¸ºæ¯ä¸ªä¸åŒçš„é…ç½®é€‰é¡¹å£°æ˜ä¸€ä¸ªæ–°çš„æ„é€ å‡½æ•°"><a href="#åšæ³•-1ï¼šä¸ºæ¯ä¸ªä¸åŒçš„é…ç½®é€‰é¡¹å£°æ˜ä¸€ä¸ªæ–°çš„æ„é€ å‡½æ•°" class="headerlink" title="åšæ³• 1ï¼šä¸ºæ¯ä¸ªä¸åŒçš„é…ç½®é€‰é¡¹å£°æ˜ä¸€ä¸ªæ–°çš„æ„é€ å‡½æ•°"></a>åšæ³• 1ï¼šä¸ºæ¯ä¸ªä¸åŒçš„é…ç½®é€‰é¡¹å£°æ˜ä¸€ä¸ªæ–°çš„æ„é€ å‡½æ•°</h4><p>è¿™ç§åšæ³•æ˜¯ä¸ºä¸åŒé€‰é¡¹å®šä¹‰ä¸“æœ‰çš„æ„é€ å‡½æ•°ã€‚å‡å¦‚ä¸Šé¢çš„ Server å¢åŠ äº†ä¸¤ä¸ªå­—æ®µï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Server <span class="keyword">struct</span>&#123;</span><br><span class="line">  host <span class="keyword">string</span></span><br><span class="line">  port <span class="keyword">int</span></span><br><span class="line">  timeout time.Duration</span><br><span class="line">  maxConn <span class="keyword">int</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œhost å’Œ port æ˜¯å¿…é¡»çš„å­—æ®µï¼Œè€Œ timeout å’Œ maxConn æ˜¯å¯é€‰çš„ï¼Œæ‰€ä»¥ï¼Œå¯ä»¥ä¿ç•™åŸæ¥çš„æ„é€ å‡½æ•°ï¼Œè€Œè¿™ä¸¤ä¸ªå­—æ®µç»™é»˜è®¤å€¼ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">New</span><span class="params">(host <span class="keyword">string</span>, port <span class="keyword">int</span>)</span> *<span class="title">Server</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &amp;Server&#123;host, port, time.Minute, <span class="number">100</span>&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>ç„¶åé’ˆå¯¹ timeout å’Œ maxConn é¢å¤–æä¾›ä¸¤ä¸ªæ„é€ å‡½æ•°ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewWithTimeout</span><span class="params">(host <span class="keyword">string</span>, port <span class="keyword">int</span>, timeout time.Duration)</span> *<span class="title">Server</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &amp;Server&#123;host, port, timeout&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewWithTimeoutAndMaxConn</span><span class="params">(host <span class="keyword">string</span>, port <span class="keyword">int</span>, timeout time.Duration, maxConn <span class="keyword">int</span>)</span> *<span class="title">Server</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &amp;Server&#123;host, port, timeout, maxConn&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>è¿™ç§æ–¹å¼é…ç½®è¾ƒå°‘ä¸”ä¸å¤ªä¼šå˜åŒ–çš„æƒ…å†µï¼Œå¦åˆ™æ¯æ¬¡ä½ éœ€è¦ä¸ºæ–°é…ç½®åˆ›å»ºæ–°çš„æ„é€ å‡½æ•°ã€‚åœ¨ Go è¯­è¨€æ ‡å‡†åº“ä¸­ï¼Œæœ‰è¿™ç§æ–¹å¼çš„åº”ç”¨ã€‚æ¯”å¦‚ net åŒ…ä¸­çš„ Dial å’Œ DialTimeoutï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Dial</span><span class="params">(network, address <span class="keyword">string</span>)</span> <span class="params">(Conn, error)</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">DialTimeout</span><span class="params">(network, address <span class="keyword">string</span>, timeout time.Duration)</span> <span class="params">(Conn, error)</span></span></span><br></pre></td></tr></table></figure></div>
<h4 id="åšæ³•-2ï¼šä½¿ç”¨ä¸“é—¨çš„é…ç½®ç»“æ„ä½“"><a href="#åšæ³•-2ï¼šä½¿ç”¨ä¸“é—¨çš„é…ç½®ç»“æ„ä½“" class="headerlink" title="åšæ³• 2ï¼šä½¿ç”¨ä¸“é—¨çš„é…ç½®ç»“æ„ä½“"></a>åšæ³• 2ï¼šä½¿ç”¨ä¸“é—¨çš„é…ç½®ç»“æ„ä½“</h4><p>è¿™ç§æ–¹å¼ä¹Ÿæ˜¯å¾ˆå¸¸è§çš„ï¼Œç‰¹åˆ«æ˜¯å½“é…ç½®é€‰é¡¹å¾ˆå¤šæ—¶ã€‚é€šå¸¸å¯ä»¥åˆ›å»ºä¸€ä¸ª Config ç»“æ„ä½“ï¼Œå…¶ä¸­åŒ…å« Server çš„æ‰€æœ‰é…ç½®é€‰é¡¹ã€‚è¿™ç§åšæ³•ï¼Œå³ä½¿å°†æ¥å¢åŠ æ›´å¤šé…ç½®é€‰é¡¹ï¼Œä¹Ÿå¯ä»¥è½»æ¾çš„å®Œæˆæ‰©å±•ï¼Œä¸ä¼šç ´å Server çš„ APIã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Server <span class="keyword">struct</span>&#123;</span><br><span class="line">  cfg Config</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Config <span class="keyword">struct</span> &#123;</span><br><span class="line">  Host <span class="keyword">string</span></span><br><span class="line">  Port <span class="keyword">int</span></span><br><span class="line">  Timeout time.Duration</span><br><span class="line">  MaxConn <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">New</span><span class="params">(cfg Config)</span> *<span class="title">Server</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> &amp;Server&#123;cfg&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>åœ¨ä½¿ç”¨æ—¶ï¼Œéœ€è¦å…ˆæ„é€  Config å®ä¾‹ï¼Œå¯¹è¿™ä¸ªå®ä¾‹ï¼Œåˆå›åˆ°äº†å‰é¢ Server çš„é—®é¢˜ä¸Šï¼Œå› ä¸ºå¢åŠ æˆ–åˆ é™¤é€‰é¡¹ï¼Œéœ€è¦å¯¹ Config æœ‰è¾ƒå¤§çš„ä¿®æ”¹ã€‚å¦‚æœå°† Config ä¸­çš„å­—æ®µæ”¹ä¸ºç§æœ‰ï¼Œå¯èƒ½éœ€è¦å®šä¹‰ Config çš„æ„é€ å‡½æ•°ã€‚</p>
<h4 id="åšæ³•-3ï¼šä½¿ç”¨-Functional-Option-Pattern"><a href="#åšæ³•-3ï¼šä½¿ç”¨-Functional-Option-Pattern" class="headerlink" title="åšæ³• 3ï¼šä½¿ç”¨ Functional Option Pattern"></a>åšæ³• 3ï¼šä½¿ç”¨ Functional Option Pattern</h4><p>ä¸€ä¸ªæ›´å¥½çš„è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨ Functional Option Patternã€‚</p>
<p>åœ¨è¿™ä¸ªæ¨¡å¼ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ª Option å‡½æ•°ç±»å‹ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Option <span class="function"><span class="keyword">func</span><span class="params">(*Server)</span></span></span><br></pre></td></tr></table></figure></div>
<p>Option ç±»å‹æ˜¯ä¸€ä¸ªå‡½æ•°ç±»å‹ï¼Œå®ƒæ¥æ”¶ä¸€ä¸ªå‚æ•°ï¼š*Serverã€‚ç„¶åï¼ŒServer çš„æ„é€ å‡½æ•°æ¥æ”¶ä¸€ä¸ª Option ç±»å‹çš„ä¸å®šå‚æ•°ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">New</span><span class="params">(options ...Option)</span> *<span class="title">Server</span></span> &#123;</span><br><span class="line">  svr := &amp;Server&#123;&#125;</span><br><span class="line">  <span class="keyword">for</span> _, f := <span class="keyword">range</span> options &#123;</span><br><span class="line">    f(svr)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> svr</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>é‚£é€‰é¡¹å¦‚ä½•èµ·ä½œç”¨ï¼Ÿéœ€è¦å®šä¹‰ä¸€ç³»åˆ—ç›¸å…³è¿”å› Option çš„å‡½æ•°ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithHost</span><span class="params">(host <span class="keyword">string</span>)</span> <span class="title">Option</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(s *Server)</span></span> &#123;</span><br><span class="line">    s.host = host</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithPort</span><span class="params">(port <span class="keyword">int</span>)</span> <span class="title">Option</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(s *Server)</span></span> &#123;</span><br><span class="line">    s.port = port</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithTimeout</span><span class="params">(timeout time.Duration)</span> <span class="title">Option</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(s *Server)</span></span> &#123;</span><br><span class="line">    s.timeout = timeout</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithMaxConn</span><span class="params">(maxConn <span class="keyword">int</span>)</span> <span class="title">Option</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function"><span class="keyword">func</span><span class="params">(s *Server)</span></span> &#123;</span><br><span class="line">    s.maxConn = maxConn</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>é’ˆå¯¹è¿™ç§æ¨¡å¼ï¼Œå®¢æˆ·ç«¯ç±»ä¼¼è¿™ä¹ˆä½¿ç”¨ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">  <span class="string">&quot;log&quot;</span></span><br><span class="line">  </span><br><span class="line">  <span class="string">&quot;server&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  svr := New(</span><br><span class="line">    WithHost(<span class="string">&quot;localhost&quot;</span>),</span><br><span class="line">    WithPort(<span class="number">8080</span>),</span><br><span class="line">    WithTimeout(time.Minute),</span><br><span class="line">    WithMaxConn(<span class="number">120</span>),</span><br><span class="line">  )</span><br><span class="line">  <span class="keyword">if</span> err := svr.Start(); err != <span class="literal">nil</span> &#123;</span><br><span class="line">    log.Fatal(err)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>å°†æ¥å¢åŠ é€‰é¡¹ï¼Œåªéœ€è¦å¢åŠ å¯¹åº”çš„ WithXXX å‡½æ•°å³å¯ã€‚</p>
<p>è¿™ç§æ¨¡å¼ï¼Œåœ¨ç¬¬ä¸‰æ–¹åº“ä¸­ä½¿ç”¨æŒºå¤šï¼Œæ¯”å¦‚ github.com/gocolly/collyï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> Collector &#123;</span><br><span class="line">  <span class="comment">// çœç•¥...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewCollector</span><span class="params">(options ...CollectorOption)</span> *<span class="title">Collector</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šä¹‰äº†ä¸€ç³»åˆ— CollectorOpiton</span></span><br><span class="line"><span class="keyword">type</span> CollectorOption&#123;</span><br><span class="line">  <span class="comment">// çœç•¥...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">AllowURLRevisit</span><span class="params">()</span> <span class="title">CollectorOption</span></span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">AllowedDomains</span><span class="params">(domains ...<span class="keyword">string</span>)</span> <span class="title">CollectorOption</span></span></span><br><span class="line">...</span><br></pre></td></tr></table></figure></div>
<p>ä¸è¿‡ Uber çš„ Go è¯­è¨€ç¼–ç¨‹è§„èŒƒä¸­æåˆ°è¯¥æ¨¡å¼æ—¶ï¼Œå»ºè®®å®šä¹‰ä¸€ä¸ª Option æ¥å£ï¼Œè€Œä¸æ˜¯ Option å‡½æ•°ç±»å‹ã€‚è¯¥ Option æ¥å£æœ‰ä¸€ä¸ªæœªå¯¼å‡ºçš„æ–¹æ³•ï¼Œç„¶åé€šè¿‡ä¸€ä¸ªæœªå¯¼å‡ºçš„ options ç»“æ„æ¥è®°å½•å„é€‰é¡¹ã€‚</p>
<p>Uber çš„è¿™ä¸ªä¾‹å­èƒ½çœ‹æ‡‚å—ï¼Ÿ</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">type</span> options <span class="keyword">struct</span> &#123;</span><br><span class="line">  cache  <span class="keyword">bool</span></span><br><span class="line">  logger *zap.Logger</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> Option <span class="keyword">interface</span> &#123;</span><br><span class="line">  apply(*options)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> cacheOption <span class="keyword">bool</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c cacheOption)</span> <span class="title">apply</span><span class="params">(opts *options)</span></span> &#123;</span><br><span class="line">  opts.cache = <span class="keyword">bool</span>(c)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithCache</span><span class="params">(c <span class="keyword">bool</span>)</span> <span class="title">Option</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> cacheOption(c)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> loggerOption <span class="keyword">struct</span> &#123;</span><br><span class="line">  Log *zap.Logger</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(l loggerOption)</span> <span class="title">apply</span><span class="params">(opts *options)</span></span> &#123;</span><br><span class="line">  opts.logger = l.Log</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">WithLogger</span><span class="params">(log *zap.Logger)</span> <span class="title">Option</span></span> &#123;</span><br><span class="line">  <span class="keyword">return</span> loggerOption&#123;Log: log&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Open creates a connection.</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">Open</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">  addr <span class="keyword">string</span>,</span></span></span><br><span class="line"><span class="function"><span class="params">  opts ...Option,</span></span></span><br><span class="line"><span class="function"><span class="params">)</span> <span class="params">(*Connection, error)</span></span> &#123;</span><br><span class="line">  options := options&#123;</span><br><span class="line">    cache:  defaultCache,</span><br><span class="line">    logger: zap.NewNop(),</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> _, o := <span class="keyword">range</span> opts &#123;</span><br><span class="line">    o.apply(&amp;options)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<h2 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h2><p>åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œå½“ä½ è¦å¤„ç†çš„é€‰é¡¹æ¯”è¾ƒå¤šï¼Œæˆ–è€…å¤„ç†ä¸åŒæ¥æºçš„é€‰é¡¹ï¼ˆæ¥è‡ªæ–‡ä»¶ã€æ¥è‡ªç¯å¢ƒå˜é‡ç­‰ï¼‰æ—¶ï¼Œå¯ä»¥è€ƒè™‘è¯•è¯•å‡½æ•°å¼é€‰é¡¹æ¨¡å¼ã€‚</p>
<p>æ³¨æ„ï¼Œåœ¨å®é™…å·¥ä½œä¸­ï¼Œæˆ‘ä»¬ä¸åº”è¯¥æ•™æ¡çš„åº”ç”¨ä¸Šé¢çš„æ¨¡å¼ï¼Œå°±åƒ Uber ä¸­çš„ä¾‹å­ï¼ŒOpen å‡½æ•°å¹¶éåªæ¥å—ä¸€ä¸ª Option ä¸å®šå‚æ•°ï¼Œå› ä¸º addr å‚æ•°æ˜¯å¿…é¡»çš„ã€‚å› æ­¤ï¼Œå‡½æ•°å¼é€‰é¡¹æ¨¡å¼æ›´å¤šåº”è¯¥åº”ç”¨åœ¨é‚£äº›é…ç½®è¾ƒå¤šï¼Œä¸”æœ‰å¯é€‰å‚æ•°çš„æƒ…å†µã€‚</p>
]]></content>
      <tags>
        <tag>golang</tag>
      </tags>
  </entry>
  <entry>
    <title>æ¶æ„è®¾è®¡é‚£äº›äº‹å„¿--ç¼“å­˜é‚£äº›äº‹å„¿(ä¸€)ï¼Œç¼“å­˜çš„å‰ä¸–ä»Šç”Ÿ</title>
    <url>/2022/07/04/uncatalog/cl56he3gx000050r72rv69xlr/</url>
    <content><![CDATA[<hr>
<span id="more"></span>
<blockquote>
<p>ç›®å‰å„ç§ç±»å‹çš„ç¼“å­˜éƒ½æ´»è·ƒåœ¨æˆåƒä¸Šä¸‡çš„åº”ç”¨æœåŠ¡ä¸­ï¼Œè¿˜æ²¡æœ‰ä¸€ç§ç¼“å­˜æ–¹æ¡ˆå¯ä»¥è§£å†³ä¸€åˆ‡çš„ä¸šåŠ¡åœºæ™¯æˆ–æ•°æ®ç±»å‹ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®è‡ªèº«çš„ç‰¹æ®Šåœºæ™¯å’ŒèƒŒæ™¯ï¼Œé€‰æ‹©æœ€é€‚åˆçš„ç¼“å­˜æ–¹æ¡ˆã€‚ç¼“å­˜çš„ä½¿ç”¨æ˜¯ç¨‹åºå‘˜ã€æ¶æ„å¸ˆçš„å¿…å¤‡æŠ€èƒ½ï¼Œå¥½çš„ç¨‹åºå‘˜èƒ½æ ¹æ®æ•°æ®ç±»å‹ã€ä¸šåŠ¡åœºæ™¯æ¥å‡†ç¡®åˆ¤æ–­ä½¿ç”¨ä½•ç§ç±»å‹çš„ç¼“å­˜ï¼Œå¦‚ä½•ä½¿ç”¨è¿™ç§ç¼“å­˜ï¼Œä»¥æœ€å°çš„æˆæœ¬æœ€å¿«çš„æ•ˆç‡è¾¾åˆ°æœ€ä¼˜çš„ç›®çš„ã€‚ </p>
</blockquote>
<p>ã€Šæ¶æ„è®¾è®¡é‚£äº›äº‹å„¿â€“ç¼“å­˜é‚£äº›äº‹å„¿ã€‹ç³»åˆ—å…±åˆ†å…­ç« ï¼š</p>
<ul>
<li><a href="https://bugkillerpro.github.io/2022/07/04/uncatalog/cl56he3gx000050r72rv69xlr/">æ¶æ„è®¾è®¡é‚£äº›äº‹å„¿â€“ç¼“å­˜é‚£äº›äº‹å„¿(ä¸€)ï¼Œç¼“å­˜çš„å‰ä¸–ä»Šç”Ÿ</a></li>
<li><a href="https://bugkillerpro.github.io/2022/07/04/uncatalog/cl58235qb0001ikr7dxwr0zu2/">æ¶æ„è®¾è®¡é‚£äº›äº‹å„¿â€“ç¼“å­˜é‚£äº›äº‹å„¿(äºŒ)ï¼Œç¼“å­˜è®¾è®¡æ¨¡å¼</a></li>
<li><a href="https://bugkillerpro.github.io/2022/07/04/uncatalog/cl58235q80000ikr72lnvg3qt/">æ¶æ„è®¾è®¡é‚£äº›äº‹å„¿â€“ç¼“å­˜é‚£äº›äº‹å„¿(ä¸‰)ï¼Œç¼“å­˜æ€§èƒ½å’Œä¸€è‡´æ€§çš„æœ€ä½³å®è·µ</a></li>
<li><a href="https://bugkillerpro.github.io/2022/07/12/uncatalog/cl5hl5x3l00000wr734tl8oua/">æ¶æ„è®¾è®¡é‚£äº›äº‹å„¿â€“ç¼“å­˜é‚£äº›äº‹å„¿(å››)ï¼Œç¼“å­˜ç©¿é€ã€ ç¼“å­˜é›ªå´© å’Œ ç¼“å­˜å‡»ç©¿</a></li>
<li><a href="https://bugkillerpro.github.io/2022/07/12/uncatalog/cl5hm81oo00000wr786z6dmjl/">æ¶æ„è®¾è®¡é‚£äº›äº‹å„¿â€“ç¼“å­˜é‚£äº›äº‹å„¿(äº”)ï¼Œå¸ƒéš†è¿‡æ»¤å™¨è¯¦è§£</a></li>
<li><a href>æ¶æ„è®¾è®¡é‚£äº›äº‹å„¿â€“ç¼“å­˜é‚£äº›äº‹å„¿(å…­)ï¼Œredis</a></li>
</ul>
<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä¸€èˆ¬è€Œè¨€ï¼Œç°åœ¨äº’è”ç½‘åº”ç”¨ï¼ˆç½‘ç«™æˆ–Appï¼‰çš„æ•´ä½“æµç¨‹ï¼Œå¯ä»¥æ¦‚æ‹¬å¦‚å›¾1æ‰€ç¤ºï¼Œç”¨æˆ·è¯·æ±‚ä»ç•Œé¢ï¼ˆæµè§ˆå™¨æˆ–Appç•Œé¢ï¼‰åˆ°ç½‘ç»œè½¬å‘ã€åº”ç”¨æœåŠ¡å†åˆ°å­˜å‚¨ï¼ˆæ•°æ®åº“æˆ–æ–‡ä»¶ç³»ç»Ÿï¼‰ï¼Œç„¶åè¿”å›åˆ°ç•Œé¢å‘ˆç°å†…å®¹ã€‚éšç€äº’è”ç½‘çš„æ™®åŠï¼Œå†…å®¹ä¿¡æ¯è¶Šæ¥è¶Šå¤æ‚ï¼Œç”¨æˆ·æ•°å’Œè®¿é—®é‡è¶Šæ¥è¶Šå¤§ï¼Œæˆ‘ä»¬çš„åº”ç”¨éœ€è¦æ”¯æ’‘æ›´å¤šçš„å¹¶å‘é‡ï¼ŒåŒæ—¶æˆ‘ä»¬çš„åº”ç”¨æœåŠ¡å™¨å’Œæ•°æ®åº“æœåŠ¡å™¨æ‰€åšçš„è®¡ç®—ä¹Ÿè¶Šæ¥è¶Šå¤šã€‚ä½†æ˜¯å¾€å¾€æˆ‘ä»¬çš„åº”ç”¨æœåŠ¡å™¨èµ„æºæ˜¯æœ‰é™çš„ï¼Œä¸”æŠ€æœ¯å˜é©æ˜¯ç¼“æ…¢çš„ï¼Œæ•°æ®åº“æ¯ç§’èƒ½æ¥å—çš„è¯·æ±‚æ¬¡æ•°ä¹Ÿæ˜¯æœ‰é™çš„ï¼ˆæˆ–è€…æ–‡ä»¶çš„è¯»å†™ä¹Ÿæ˜¯æœ‰é™çš„ï¼‰ï¼Œå¦‚ä½•èƒ½å¤Ÿæœ‰æ•ˆåˆ©ç”¨æœ‰é™çš„èµ„æºæ¥æä¾›å°½å¯èƒ½å¤§çš„ååé‡ï¼Ÿä¸€ä¸ªæœ‰æ•ˆçš„åŠæ³•å°±æ˜¯å¼•å…¥ç¼“å­˜ï¼Œæ‰“ç ´æ ‡å‡†æµç¨‹ï¼Œæ¯ä¸ªç¯èŠ‚ä¸­è¯·æ±‚å¯ä»¥ä»ç¼“å­˜ä¸­ç›´æ¥è·å–ç›®æ ‡æ•°æ®å¹¶è¿”å›ï¼Œä»è€Œå‡å°‘è®¡ç®—é‡ï¼Œæœ‰æ•ˆæå‡å“åº”é€Ÿåº¦ï¼Œè®©æœ‰é™çš„èµ„æºæœåŠ¡æ›´å¤šçš„ç”¨æˆ·ã€‚å¦‚å›¾1æ‰€ç¤ºï¼Œç¼“å­˜çš„ä½¿ç”¨å¯ä»¥å‡ºç°åœ¨1ï½4çš„å„ä¸ªç¯èŠ‚ä¸­ï¼Œæ¯ä¸ªç¯èŠ‚çš„ç¼“å­˜æ–¹æ¡ˆä¸ä½¿ç”¨å„æœ‰ç‰¹ç‚¹ã€‚<br>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œç¼“å­˜çš„ä½¿ç”¨å¯ä»¥å‡ºç°åœ¨1ï½4çš„å„ä¸ªç¯èŠ‚ä¸­ï¼Œæ¯ä¸ªç¯èŠ‚çš„ç¼“å­˜æ–¹æ¡ˆä¸ä½¿ç”¨å„æœ‰ç‰¹ç‚¹ã€‚<br><img src="/2022/07/04/uncatalog/cl56he3gx000050r72rv69xlr/v2-9838f98ea50f9f143b2d56eed6dac717_b.png" alt="ima"></p>
<h2 id="ç¼“å­˜"><a href="#ç¼“å­˜" class="headerlink" title="ç¼“å­˜"></a>ç¼“å­˜</h2><h3 id="1-ç¼“å­˜ç‰¹å¾"><a href="#1-ç¼“å­˜ç‰¹å¾" class="headerlink" title="1.ç¼“å­˜ç‰¹å¾"></a>1.ç¼“å­˜ç‰¹å¾</h3><p>ç¼“å­˜ä¹Ÿæ˜¯ä¸€ä¸ªæ•°æ®æ¨¡å‹å¯¹è±¡ï¼Œé‚£ä¹ˆå¿…ç„¶æœ‰å®ƒçš„ä¸€äº›ç‰¹å¾ï¼š</p>
<h4 id="1-1-å‘½ä¸­ç‡"><a href="#1-1-å‘½ä¸­ç‡" class="headerlink" title="1.1 å‘½ä¸­ç‡"></a>1.1 å‘½ä¸­ç‡</h4><p>å‘½ä¸­ç‡=è¿”å›æ­£ç¡®ç»“æœæ•°/è¯·æ±‚ç¼“å­˜æ¬¡æ•°ï¼Œå‘½ä¸­ç‡é—®é¢˜æ˜¯ç¼“å­˜ä¸­çš„ä¸€ä¸ªéå¸¸é‡è¦çš„é—®é¢˜ï¼Œå®ƒæ˜¯è¡¡é‡ç¼“å­˜æœ‰æ•ˆæ€§çš„é‡è¦æŒ‡æ ‡ã€‚å‘½ä¸­ç‡è¶Šé«˜ï¼Œè¡¨æ˜ç¼“å­˜çš„ä½¿ç”¨ç‡è¶Šé«˜ã€‚</p>
<h4 id="1-2-æœ€å¤§å…ƒç´ ï¼ˆæˆ–æœ€å¤§ç©ºé—´ï¼‰"><a href="#1-2-æœ€å¤§å…ƒç´ ï¼ˆæˆ–æœ€å¤§ç©ºé—´ï¼‰" class="headerlink" title="1.2 æœ€å¤§å…ƒç´ ï¼ˆæˆ–æœ€å¤§ç©ºé—´ï¼‰"></a>1.2 æœ€å¤§å…ƒç´ ï¼ˆæˆ–æœ€å¤§ç©ºé—´ï¼‰</h4><p>ç¼“å­˜ä¸­å¯ä»¥å­˜æ”¾çš„æœ€å¤§å…ƒç´ çš„æ•°é‡ï¼Œä¸€æ—¦ç¼“å­˜ä¸­å…ƒç´ æ•°é‡è¶…è¿‡è¿™ä¸ªå€¼ï¼ˆæˆ–è€…ç¼“å­˜æ•°æ®æ‰€å ç©ºé—´è¶…è¿‡å…¶æœ€å¤§æ”¯æŒç©ºé—´ï¼‰ï¼Œé‚£ä¹ˆå°†ä¼šè§¦å‘ç¼“å­˜å¯åŠ¨æ¸…ç©ºç­–ç•¥æ ¹æ®ä¸åŒçš„åœºæ™¯åˆç†çš„è®¾ç½®æœ€å¤§å…ƒç´ å€¼å¾€å¾€å¯ä»¥ä¸€å®šç¨‹åº¦ä¸Šæé«˜ç¼“å­˜çš„å‘½ä¸­ç‡ï¼Œä»è€Œæ›´æœ‰æ•ˆçš„æ—¶å€™ç¼“å­˜ã€‚</p>
<h4 id="1-3-æ¸…ç©ºç­–ç•¥"><a href="#1-3-æ¸…ç©ºç­–ç•¥" class="headerlink" title="1.3 æ¸…ç©ºç­–ç•¥"></a>1.3 æ¸…ç©ºç­–ç•¥</h4><p>å¦‚ä¸Šæè¿°ï¼Œç¼“å­˜çš„å­˜å‚¨ç©ºé—´æœ‰é™åˆ¶ï¼Œå½“ç¼“å­˜ç©ºé—´è¢«ç”¨æ»¡æ—¶ï¼Œå¦‚ä½•ä¿è¯åœ¨ç¨³å®šæœåŠ¡çš„åŒæ—¶æœ‰æ•ˆæå‡å‘½ä¸­ç‡ï¼Ÿè¿™å°±ç”±ç¼“å­˜æ¸…ç©ºç­–ç•¥æ¥å¤„ç†ï¼Œè®¾è®¡é€‚åˆè‡ªèº«æ•°æ®ç‰¹å¾çš„æ¸…ç©ºç­–ç•¥èƒ½æœ‰æ•ˆæå‡å‘½ä¸­ç‡ã€‚å¸¸è§çš„ä¸€èˆ¬ç­–ç•¥æœ‰ï¼š</p>
<ul>
<li>FIFO(first in first out) å…ˆè¿›å…ˆå‡ºç­–ç•¥ï¼Œæœ€å…ˆè¿›å…¥ç¼“å­˜çš„æ•°æ®åœ¨ç¼“å­˜ç©ºé—´ä¸å¤Ÿçš„æƒ…å†µä¸‹ï¼ˆè¶…å‡ºæœ€å¤§å…ƒç´ é™åˆ¶ï¼‰ä¼šè¢«ä¼˜å…ˆè¢«æ¸…é™¤æ‰ï¼Œä»¥è…¾å‡ºæ–°çš„ç©ºé—´æ¥å—æ–°çš„æ•°æ®ã€‚ç­–ç•¥ç®—æ³•ä¸»è¦æ¯”è¾ƒç¼“å­˜å…ƒç´ çš„åˆ›å»ºæ—¶é—´ã€‚åœ¨æ•°æ®å®æ•ˆæ€§è¦æ±‚åœºæ™¯ä¸‹å¯é€‰æ‹©è¯¥ç±»ç­–ç•¥ï¼Œä¼˜å…ˆä¿éšœæœ€æ–°æ•°æ®å¯ç”¨ã€‚ </li>
<li>LFU(less frequently used)æœ€å°‘ä½¿ç”¨ç­–ç•¥ï¼Œæ— è®ºæ˜¯å¦è¿‡æœŸï¼Œæ ¹æ®å…ƒç´ çš„è¢«ä½¿ç”¨æ¬¡æ•°åˆ¤æ–­ï¼Œæ¸…é™¤ä½¿ç”¨æ¬¡æ•°è¾ƒå°‘çš„å…ƒç´ é‡Šæ”¾ç©ºé—´ã€‚ç­–ç•¥ç®—æ³•ä¸»è¦æ¯”è¾ƒå…ƒç´ çš„hitCountï¼ˆå‘½ä¸­æ¬¡æ•°ï¼‰ã€‚åœ¨ä¿è¯é«˜é¢‘æ•°æ®æœ‰æ•ˆæ€§åœºæ™¯ä¸‹ï¼Œå¯é€‰æ‹©è¿™ç±»ç­–ç•¥ã€‚</li>
<li>LRU(least recently used)æœ€è¿‘æœ€å°‘ä½¿ç”¨ç­–ç•¥ï¼Œæ— è®ºæ˜¯å¦è¿‡æœŸï¼Œæ ¹æ®å…ƒç´ æœ€åä¸€æ¬¡è¢«ä½¿ç”¨çš„æ—¶é—´æˆ³ï¼Œæ¸…é™¤æœ€è¿œä½¿ç”¨æ—¶é—´æˆ³çš„å…ƒç´ é‡Šæ”¾ç©ºé—´ã€‚ç­–ç•¥ç®—æ³•ä¸»è¦æ¯”è¾ƒå…ƒç´ æœ€è¿‘ä¸€æ¬¡è¢«getä½¿ç”¨æ—¶é—´ã€‚åœ¨çƒ­ç‚¹æ•°æ®åœºæ™¯ä¸‹è¾ƒé€‚ç”¨ï¼Œä¼˜å…ˆä¿è¯çƒ­ç‚¹æ•°æ®çš„æœ‰æ•ˆæ€§ã€‚</li>
</ul>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€äº›ç®€å•ç­–ç•¥æ¯”å¦‚ï¼š</p>
<ul>
<li>æ ¹æ®è¿‡æœŸæ—¶é—´åˆ¤æ–­ï¼Œæ¸…ç†è¿‡æœŸæ—¶é—´æœ€é•¿çš„å…ƒç´ ï¼›</li>
<li>æ ¹æ®è¿‡æœŸæ—¶é—´åˆ¤æ–­ï¼Œæ¸…ç†æœ€è¿‘è¦è¿‡æœŸçš„å…ƒç´ ï¼›</li>
<li>éšæœºæ¸…ç†ï¼›</li>
<li>æ ¹æ®å…³é”®å­—ï¼ˆæˆ–å…ƒç´ å†…å®¹ï¼‰é•¿çŸ­æ¸…ç†ç­‰ã€‚</li>
</ul>
<h4 id="1-4-ç¼“å­˜ä»‹è´¨"><a href="#1-4-ç¼“å­˜ä»‹è´¨" class="headerlink" title="1.4 ç¼“å­˜ä»‹è´¨"></a>1.4 ç¼“å­˜ä»‹è´¨</h4><p>è™½ç„¶ä»ç¡¬ä»¶ä»‹è´¨ä¸Šæ¥çœ‹ï¼Œæ— éå°±æ˜¯å†…å­˜å’Œç¡¬ç›˜ä¸¤ç§ï¼Œä½†ä»æŠ€æœ¯ä¸Šï¼Œå¯ä»¥åˆ†æˆå†…å­˜ã€ç¡¬ç›˜æ–‡ä»¶ã€æ•°æ®åº“ã€‚</p>
<ul>
<li>å†…å­˜ï¼šå°†ç¼“å­˜å­˜å‚¨äºå†…å­˜ä¸­æ˜¯æœ€å¿«çš„é€‰æ‹©ï¼Œæ— éœ€é¢å¤–çš„I/Oå¼€é”€ï¼Œä½†æ˜¯å†…å­˜çš„ç¼ºç‚¹æ˜¯æ²¡æœ‰æŒä¹…åŒ–è½åœ°ç‰©ç†ç£ç›˜ï¼Œä¸€æ—¦åº”ç”¨å¼‚å¸¸break downè€Œé‡æ–°å¯åŠ¨ï¼Œæ•°æ®å¾ˆéš¾æˆ–è€…æ— æ³•å¤åŸã€‚</li>
<li>ç¡¬ç›˜ï¼šä¸€èˆ¬æ¥è¯´ï¼Œå¾ˆå¤šç¼“å­˜æ¡†æ¶ä¼šç»“åˆä½¿ç”¨å†…å­˜å’Œç¡¬ç›˜ï¼Œåœ¨å†…å­˜åˆ†é…ç©ºé—´æ»¡äº†æˆ–æ˜¯åœ¨å¼‚å¸¸çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥è¢«åŠ¨æˆ–ä¸»åŠ¨çš„å°†å†…å­˜ç©ºé—´æ•°æ®æŒä¹…åŒ–åˆ°ç¡¬ç›˜ä¸­ï¼Œè¾¾åˆ°é‡Šæ”¾ç©ºé—´æˆ–å¤‡ä»½æ•°æ®çš„ç›®çš„ã€‚</li>
<li>æ•°æ®åº“ï¼šå‰é¢æœ‰æåˆ°ï¼Œå¢åŠ ç¼“å­˜çš„ç­–ç•¥çš„ç›®çš„ä¹‹ä¸€å°±æ˜¯ä¸ºäº†å‡å°‘æ•°æ®åº“çš„I/Oå‹åŠ›ã€‚ç°åœ¨ä½¿ç”¨æ•°æ®åº“åšç¼“å­˜ä»‹è´¨æ˜¯ä¸æ˜¯åˆå›åˆ°äº†è€é—®é¢˜ä¸Šäº†ï¼Ÿå…¶å®ï¼Œæ•°æ®åº“ä¹Ÿæœ‰å¾ˆå¤šç§ç±»å‹ï¼Œåƒé‚£äº›ä¸æ”¯æŒSQLï¼Œåªæ˜¯ç®€å•çš„key-valueå­˜å‚¨ç»“æ„çš„ç‰¹æ®Šæ•°æ®åº“ï¼ˆå¦‚BerkeleyDBå’ŒRedisï¼‰ï¼Œå“åº”é€Ÿåº¦å’Œååé‡éƒ½è¿œè¿œé«˜äºæˆ‘ä»¬å¸¸ç”¨çš„å…³ç³»å‹æ•°æ®åº“ç­‰ã€‚</li>
</ul>
<h4 id="1-5-ç¼“å­˜åˆ†ç±»å’Œåº”ç”¨åœºæ™¯"><a href="#1-5-ç¼“å­˜åˆ†ç±»å’Œåº”ç”¨åœºæ™¯" class="headerlink" title="1.5 ç¼“å­˜åˆ†ç±»å’Œåº”ç”¨åœºæ™¯"></a>1.5 ç¼“å­˜åˆ†ç±»å’Œåº”ç”¨åœºæ™¯</h4><p>ç¼“å­˜æœ‰å„ç±»ç‰¹å¾ï¼Œè€Œä¸”æœ‰ä¸åŒä»‹è´¨çš„åŒºåˆ«ï¼Œé‚£ä¹ˆå®é™…å·¥ç¨‹ä¸­æˆ‘ä»¬æ€ä¹ˆå»å¯¹ç¼“å­˜åˆ†ç±»å‘¢ï¼Ÿåœ¨ç›®å‰çš„åº”ç”¨æœåŠ¡æ¡†æ¶ä¸­ï¼Œæ¯”è¾ƒå¸¸è§çš„ï¼Œæ—¶æ ¹æ®ç¼“å­˜ä¸åº”ç”¨çš„è€¦åˆåº¦ï¼Œåˆ†ä¸ºlocal cacheï¼ˆæœ¬åœ°ç¼“å­˜ï¼‰å’Œremote cacheï¼ˆåˆ†å¸ƒå¼ç¼“å­˜ï¼‰ï¼š</p>
<ul>
<li>æœ¬åœ°ç¼“å­˜ï¼šæŒ‡çš„æ˜¯åœ¨åº”ç”¨ä¸­çš„ç¼“å­˜ç»„ä»¶ï¼Œå…¶æœ€å¤§çš„ä¼˜ç‚¹æ˜¯åº”ç”¨å’Œcacheæ˜¯åœ¨åŒä¸€ä¸ªè¿›ç¨‹å†…éƒ¨ï¼Œè¯·æ±‚ç¼“å­˜éå¸¸å¿«é€Ÿï¼Œæ²¡æœ‰è¿‡å¤šçš„ç½‘ç»œå¼€é”€ç­‰ï¼Œåœ¨å•åº”ç”¨ä¸éœ€è¦é›†ç¾¤æ”¯æŒæˆ–è€…é›†ç¾¤æƒ…å†µä¸‹å„èŠ‚ç‚¹æ— éœ€äº’ç›¸é€šçŸ¥çš„åœºæ™¯ä¸‹ä½¿ç”¨æœ¬åœ°ç¼“å­˜è¾ƒåˆé€‚ï¼›åŒæ—¶ï¼Œå®ƒçš„ç¼ºç‚¹ä¹Ÿæ˜¯åº”ä¸ºç¼“å­˜è·Ÿåº”ç”¨ç¨‹åºè€¦åˆï¼Œå¤šä¸ªåº”ç”¨ç¨‹åºæ— æ³•ç›´æ¥çš„å…±äº«ç¼“å­˜ï¼Œå„åº”ç”¨æˆ–é›†ç¾¤çš„å„èŠ‚ç‚¹éƒ½éœ€è¦ç»´æŠ¤è‡ªå·±çš„å•ç‹¬ç¼“å­˜ï¼Œå¯¹å†…å­˜æ˜¯ä¸€ç§æµªè´¹ã€‚</li>
<li>åˆ†å¸ƒå¼ç¼“å­˜ï¼šæŒ‡çš„æ˜¯ä¸åº”ç”¨åˆ†ç¦»çš„ç¼“å­˜ç»„ä»¶æˆ–æœåŠ¡ï¼Œå…¶æœ€å¤§çš„ä¼˜ç‚¹æ˜¯è‡ªèº«å°±æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„åº”ç”¨ï¼Œä¸æœ¬åœ°åº”ç”¨éš”ç¦»ï¼Œå¤šä¸ªåº”ç”¨å¯ç›´æ¥çš„å…±äº«ç¼“å­˜ã€‚</li>
</ul>
<h5 id="1-5-1-æœ¬åœ°ç¼“å­˜"><a href="#1-5-1-æœ¬åœ°ç¼“å­˜" class="headerlink" title="1.5.1 æœ¬åœ°ç¼“å­˜"></a>1.5.1 æœ¬åœ°ç¼“å­˜</h5><p>ç¼–ç¨‹ç›´æ¥å®ç°ç¼“å­˜<br>ä¸ªåˆ«åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬åªéœ€è¦ç®€å•çš„ç¼“å­˜æ•°æ®çš„åŠŸèƒ½ï¼Œè€Œæ— éœ€å…³æ³¨æ›´å¤šå­˜å–ã€æ¸…ç©ºç­–ç•¥ç­‰æ·±å…¥çš„ç‰¹æ€§æ—¶ï¼Œç›´æ¥ç¼–ç¨‹å®ç°ç¼“å­˜åˆ™æ˜¯æœ€ä¾¿æ·å’Œé«˜æ•ˆçš„ã€‚<br>a. æˆå‘˜å˜é‡æˆ–å±€éƒ¨å˜é‡å®ç°</p>
<p>ç®€å•ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JAVASCRIPT"><figure class="iseeu highlight /javascript"><table><tr><td class="code"><pre><span class="line">public <span class="keyword">void</span> <span class="function"><span class="title">UseLocalCache</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">     <span class="comment">//ä¸€ä¸ªæœ¬åœ°çš„ç¼“å­˜å˜é‡</span></span><br><span class="line">     <span class="built_in">Map</span>&lt;<span class="built_in">String</span>, <span class="built_in">Object</span>&gt; localCacheStoreMap = <span class="keyword">new</span> HashMap&lt;<span class="built_in">String</span>, <span class="built_in">Object</span>&gt;();</span><br><span class="line">    </span><br><span class="line">     List&lt;<span class="built_in">Object</span>&gt; infosList = <span class="built_in">this</span>.getInfoList();</span><br><span class="line">    <span class="keyword">for</span>(<span class="built_in">Object</span> item:infosList)&#123;</span><br><span class="line">        <span class="keyword">if</span>(localCacheStoreMap.containsKey(item))&#123; <span class="comment">//ç¼“å­˜å‘½ä¸­ ä½¿ç”¨ç¼“å­˜æ•°æ®</span></span><br><span class="line">            <span class="comment">// todo</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; <span class="comment">// ç¼“å­˜æœªå‘½ä¸­  IOè·å–æ•°æ®ï¼Œç»“æœå­˜å…¥ç¼“å­˜</span></span><br><span class="line">            <span class="built_in">Object</span> valueObject = <span class="built_in">this</span>.getInfoFromDB();</span><br><span class="line">            localCacheStoreMap.put(valueObject.toString(), valueObject);</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ç¤ºä¾‹</span></span><br><span class="line">private List&lt;<span class="built_in">Object</span>&gt; <span class="function"><span class="title">getInfoList</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> ArrayList&lt;<span class="built_in">Object</span>&gt;();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ç¤ºä¾‹æ•°æ®åº“IOè·å–</span></span><br><span class="line">private <span class="built_in">Object</span> <span class="function"><span class="title">getInfoFromDB</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Object</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>ä»¥å±€éƒ¨å˜é‡mapç»“æ„ç¼“å­˜éƒ¨åˆ†ä¸šåŠ¡æ•°æ®ï¼Œå‡å°‘é¢‘ç¹çš„é‡å¤æ•°æ®åº“I/Oæ“ä½œã€‚ç¼ºç‚¹ä»…é™äºç±»çš„è‡ªèº«ä½œç”¨åŸŸå†…ï¼Œç±»é—´æ— æ³•å…±äº«ç¼“å­˜ã€‚<br>b. é™æ€å˜é‡å®ç°</p>
<p>æœ€å¸¸ç”¨çš„å•ä¾‹å®ç°é™æ€èµ„æºç¼“å­˜ï¼Œä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JAVASCRIPT"><figure class="iseeu highlight /javascript"><table><tr><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">class</span> <span class="title">CityUtils</span> </span>&#123;</span><br><span class="line">      private <span class="keyword">static</span> final HttpClient httpClient = ServerHolder.createClientWithPool(); </span><br><span class="line">      private <span class="keyword">static</span> <span class="built_in">Map</span>&lt;Integer, <span class="built_in">String</span>&gt; cityIdNameMap = <span class="keyword">new</span> HashMap&lt;Integer, <span class="built_in">String</span>&gt;();</span><br><span class="line">      private <span class="keyword">static</span> <span class="built_in">Map</span>&lt;Integer, <span class="built_in">String</span>&gt; districtIdNameMap = <span class="keyword">new</span> HashMap&lt;Integer, <span class="built_in">String</span>&gt;();</span><br><span class="line"></span><br><span class="line">  <span class="keyword">static</span> &#123;</span><br><span class="line">    HttpGet get = <span class="keyword">new</span> HttpGet(<span class="string">&quot;http://gis-in.sankuai.com/api/location/city/all&quot;</span>);</span><br><span class="line">    BaseAuthorizationUtils.generateAuthAndDateHeader(get,</span><br><span class="line">            BaseAuthorizationUtils.CLIENT_TO_REQUEST_MDC,</span><br><span class="line">            BaseAuthorizationUtils.SECRET_TO_REQUEST_MDC);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="built_in">String</span> resultStr = httpClient.execute(get, <span class="keyword">new</span> BasicResponseHandler());</span><br><span class="line">        JSONObject resultJo = <span class="keyword">new</span> JSONObject(resultStr);</span><br><span class="line">        JSONArray dataJa = resultJo.getJSONArray(<span class="string">&quot;data&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (int i = <span class="number">0</span>; i &lt; dataJa.length(); i++) &#123;</span><br><span class="line">            JSONObject itemJo = dataJa.getJSONObject(i);</span><br><span class="line">            cityIdNameMap.put(itemJo.getInt(<span class="string">&quot;id&quot;</span>), itemJo.getString(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;Init City List Error!&quot;</span>, e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">    HttpGet get = <span class="keyword">new</span> HttpGet(<span class="string">&quot;http://gis-in.sankuai.com/api/location/district/all&quot;</span>);</span><br><span class="line">    BaseAuthorizationUtils.generateAuthAndDateHeader(get,</span><br><span class="line">            BaseAuthorizationUtils.CLIENT_TO_REQUEST_MDC,</span><br><span class="line">            BaseAuthorizationUtils.SECRET_TO_REQUEST_MDC);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="built_in">String</span> resultStr = httpClient.execute(get, <span class="keyword">new</span> BasicResponseHandler());</span><br><span class="line">        JSONObject resultJo = <span class="keyword">new</span> JSONObject(resultStr);</span><br><span class="line">        JSONArray dataJa = resultJo.getJSONArray(<span class="string">&quot;data&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (int i = <span class="number">0</span>; i &lt; dataJa.length(); i++) &#123;</span><br><span class="line">            JSONObject itemJo = dataJa.getJSONObject(i);</span><br><span class="line">            districtIdNameMap.put(itemJo.getInt(<span class="string">&quot;id&quot;</span>), itemJo.getString(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;Init District List Error!&quot;</span>, e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">static</span> <span class="built_in">String</span> <span class="function"><span class="title">getCityName</span>(<span class="params">int cityId</span>)</span> &#123;</span><br><span class="line">      <span class="built_in">String</span> name = cityIdNameMap.get(cityId);</span><br><span class="line">      <span class="keyword">if</span> (name == <span class="literal">null</span>) &#123;</span><br><span class="line">        name = <span class="string">&quot;æœªçŸ¥&quot;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">       <span class="keyword">return</span> name;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">    public <span class="keyword">static</span> <span class="built_in">String</span> <span class="function"><span class="title">getDistrictName</span>(<span class="params">int districtId</span>)</span> &#123;</span><br><span class="line">      <span class="built_in">String</span> name = districtIdNameMap.get(districtId);</span><br><span class="line">       <span class="keyword">if</span> (name == <span class="literal">null</span>) &#123;</span><br><span class="line">         name = <span class="string">&quot;æœªçŸ¥&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">       <span class="keyword">return</span> name;</span><br><span class="line">     &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure></div>
<p>O2Oä¸šåŠ¡ä¸­å¸¸ç”¨çš„åŸå¸‚åŸºç¡€åŸºæœ¬ä¿¡æ¯åˆ¤æ–­ï¼Œé€šè¿‡é™æ€å˜é‡ä¸€æ¬¡è·å–ç¼“å­˜å†…å­˜ä¸­ï¼Œå‡å°‘é¢‘ç¹çš„I/Oè¯»å–ï¼Œé™æ€å˜é‡å®ç°ç±»é—´å¯å…±äº«ï¼Œè¿›ç¨‹å†…å¯å…±äº«ï¼Œç¼“å­˜çš„å®æ—¶æ€§ç¨å·®ã€‚</p>
<p>ä¸ºäº†è§£å†³æœ¬åœ°ç¼“å­˜æ•°æ®çš„å®æ—¶æ€§é—®é¢˜ï¼Œç›®å‰å¤§é‡ä½¿ç”¨çš„æ˜¯ç»“åˆZooKeeperçš„è‡ªåŠ¨å‘ç°æœºåˆ¶ï¼Œå®æ—¶å˜æ›´æœ¬åœ°é™æ€å˜é‡ç¼“å­˜ï¼š</p>
<p>ç¾å›¢å†…éƒ¨çš„åŸºç¡€é…ç½®ç»„ä»¶MtConfigï¼Œé‡‡ç”¨çš„å°±æ˜¯ç±»ä¼¼åŸç†ï¼Œä½¿ç”¨é™æ€å˜é‡ç¼“å­˜ï¼Œç»“åˆZooKeeperçš„ç»Ÿä¸€ç®¡ç†ï¼Œåšåˆ°è‡ªåŠ¨åŠ¨æ€æ›´æ–°ç¼“å­˜ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="/2022/07/04/uncatalog/cl56he3gx000050r72rv69xlr/ef639c8f.png" alt="im"></p>
<blockquote>
<p>è¿™ç±»ç¼“å­˜å®ç°ï¼Œä¼˜ç‚¹æ˜¯èƒ½ç›´æ¥åœ¨heapåŒºå†…è¯»å†™ï¼Œæœ€å¿«ä¹Ÿæœ€æ–¹ä¾¿ï¼›ç¼ºç‚¹åŒæ ·æ˜¯å—heapåŒºåŸŸå½±å“ï¼Œç¼“å­˜çš„æ•°æ®é‡éå¸¸æœ‰é™ï¼ŒåŒæ—¶ç¼“å­˜æ—¶é—´å—GCå½±å“ã€‚ä¸»è¦æ»¡è¶³å•æœºåœºæ™¯ä¸‹çš„å°æ•°æ®é‡ç¼“å­˜éœ€æ±‚ï¼ŒåŒæ—¶å¯¹ç¼“å­˜æ•°æ®çš„å˜æ›´æ— éœ€å¤ªæ•æ„Ÿæ„ŸçŸ¥ï¼Œå¦‚ä¸Šä¸€èˆ¬é…ç½®ç®¡ç†ã€åŸºç¡€é™æ€æ•°æ®ç­‰åœºæ™¯ã€‚</p>
</blockquote>
<h5 id="1-5-1-1-Ehcache"><a href="#1-5-1-1-Ehcache" class="headerlink" title="1.5.1.1 Ehcache"></a>1.5.1.1 Ehcache</h5><p>Ehcacheæ˜¯ç°åœ¨æœ€æµè¡Œçš„çº¯Javaå¼€æºç¼“å­˜æ¡†æ¶ï¼Œé…ç½®ç®€å•ã€ç»“æ„æ¸…æ™°ã€åŠŸèƒ½å¼ºå¤§ï¼Œæ˜¯ä¸€ä¸ªéå¸¸è½»é‡çº§çš„ç¼“å­˜å®ç°ï¼Œæˆ‘ä»¬å¸¸ç”¨çš„Hibernateé‡Œé¢å°±é›†æˆäº†ç›¸å…³ç¼“å­˜åŠŸèƒ½ã€‚<br><img src="/2022/07/04/uncatalog/cl56he3gx000050r72rv69xlr/b810d158.png" alt="img"></p>
<p>æ•´ä½“ä¸Šçœ‹ï¼ŒEhcacheçš„ä½¿ç”¨è¿˜æ˜¯ç›¸å¯¹ç®€å•ä¾¿æ·çš„ï¼Œæä¾›äº†å®Œæ•´çš„å„ç±»APIæ¥å£ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè™½ç„¶Ehcacheæ”¯æŒç£ç›˜çš„æŒä¹…åŒ–ï¼Œä½†æ˜¯ç”±äºå­˜åœ¨ä¸¤çº§ç¼“å­˜ä»‹è´¨ï¼Œåœ¨ä¸€çº§å†…å­˜ä¸­çš„ç¼“å­˜ï¼Œå¦‚æœæ²¡æœ‰ä¸»åŠ¨çš„åˆ·å…¥ç£ç›˜æŒä¹…åŒ–çš„è¯ï¼Œåœ¨åº”ç”¨å¼‚å¸¸downæœºç­‰æƒ…å½¢ä¸‹ï¼Œä¾ç„¶ä¼šå‡ºç°ç¼“å­˜æ•°æ®ä¸¢å¤±ï¼Œä¸ºæ­¤å¯ä»¥æ ¹æ®éœ€è¦å°†ç¼“å­˜åˆ·åˆ°ç£ç›˜ï¼Œå°†ç¼“å­˜æ¡ç›®åˆ·åˆ°ç£ç›˜çš„æ“ä½œå¯ä»¥é€šè¿‡cache.flush()æ–¹æ³•æ¥æ‰§è¡Œï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¯¹äºå¯¹è±¡çš„ç£ç›˜å†™å…¥ï¼Œå‰ææ˜¯è¦å°†å¯¹è±¡è¿›è¡Œåºåˆ—åŒ–</p>
<h5 id="1-5-1-2-Guava-Cache"><a href="#1-5-1-2-Guava-Cache" class="headerlink" title="1.5.1.2 Guava Cache"></a>1.5.1.2 Guava Cache</h5><p>Guava Cacheæ˜¯Googleå¼€æºçš„Javaé‡ç”¨å·¥å…·é›†åº“Guavaé‡Œçš„ä¸€æ¬¾ç¼“å­˜å·¥å…·ï¼Œå…¶ä¸»è¦å®ç°çš„ç¼“å­˜åŠŸèƒ½æœ‰ï¼š</p>
<ul>
<li>è‡ªåŠ¨å°†entryèŠ‚ç‚¹åŠ è½½è¿›ç¼“å­˜ç»“æ„ä¸­ï¼›</li>
<li>å½“ç¼“å­˜çš„æ•°æ®è¶…è¿‡è®¾ç½®çš„æœ€å¤§å€¼æ—¶ï¼Œä½¿ç”¨LRUç®—æ³•ç§»é™¤ï¼›</li>
<li>å…·å¤‡æ ¹æ®entryèŠ‚ç‚¹ä¸Šæ¬¡è¢«è®¿é—®æˆ–è€…å†™å…¥æ—¶é—´è®¡ç®—å®ƒçš„è¿‡æœŸæœºåˆ¶ï¼›</li>
<li>ç¼“å­˜çš„keyè¢«å°è£…åœ¨WeakReferenceå¼•ç”¨å†…ï¼›</li>
<li>ç¼“å­˜çš„Valueè¢«å°è£…åœ¨WeakReferenceæˆ–SoftReferenceå¼•ç”¨å†…ï¼›</li>
<li>ç»Ÿè®¡ç¼“å­˜ä½¿ç”¨è¿‡ç¨‹ä¸­å‘½ä¸­ç‡ã€å¼‚å¸¸ç‡ã€æœªå‘½ä¸­ç‡ç­‰ç»Ÿè®¡æ•°æ®ã€‚<br>Guava Cacheçš„æ¶æ„è®¾è®¡çµæ„Ÿæ¥æºäºConcurrentHashMapï¼Œæˆ‘ä»¬å‰é¢ä¹Ÿæåˆ°è¿‡ï¼Œç®€å•åœºæ™¯ä¸‹å¯ä»¥è‡ªè¡Œç¼–ç é€šè¿‡hashmapæ¥åšå°‘é‡æ•°æ®çš„ç¼“å­˜ï¼Œä½†æ˜¯ï¼Œå¦‚æœç»“æœå¯èƒ½éšæ—¶é—´æ”¹å˜æˆ–è€…æ˜¯å¸Œæœ›å­˜å‚¨çš„æ•°æ®ç©ºé—´å¯æ§çš„è¯ï¼Œè‡ªå·±å®ç°è¿™ç§æ•°æ®ç»“æ„è¿˜æ˜¯æœ‰å¿…è¦çš„ã€‚</li>
</ul>
<p>Guava Cacheç»§æ‰¿äº†ConcurrentHashMapçš„æ€è·¯ï¼Œä½¿ç”¨å¤šä¸ªsegmentsæ–¹å¼çš„ç»†ç²’åº¦é”ï¼Œåœ¨ä¿è¯çº¿ç¨‹å®‰å…¨çš„åŒæ—¶ï¼Œæ”¯æŒé«˜å¹¶å‘åœºæ™¯éœ€æ±‚ã€‚Cacheç±»ä¼¼äºMapï¼Œå®ƒæ˜¯å­˜å‚¨é”®å€¼å¯¹çš„é›†åˆï¼Œä¸åŒçš„æ˜¯å®ƒè¿˜éœ€è¦å¤„ç†evictã€expireã€dynamic loadç­‰ç®—æ³•é€»è¾‘ï¼Œéœ€è¦ä¸€äº›é¢å¤–ä¿¡æ¯æ¥å®ç°è¿™äº›æ“ä½œã€‚å¯¹æ­¤ï¼Œæ ¹æ®é¢å‘å¯¹è±¡æ€æƒ³ï¼Œéœ€è¦åšæ–¹æ³•ä¸æ•°æ®çš„å…³è”å°è£…ã€‚å¦‚å›¾5æ‰€ç¤ºcacheçš„å†…å­˜æ•°æ®æ¨¡å‹ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œä½¿ç”¨ReferenceEntryæ¥å£æ¥å°è£…ä¸€ä¸ªé”®å€¼å¯¹ï¼Œè€Œç”¨ValueReferenceæ¥å°è£…Valueå€¼ï¼Œä¹‹æ‰€ä»¥ç”¨Referenceå‘½ä»¤ï¼Œæ˜¯å› ä¸ºCacheè¦æ”¯æŒWeakReference Keyå’ŒSoftReferenceã€WeakReference valueã€‚<br>æ€»ä½“æ¥çœ‹ï¼ŒGuava CacheåŸºäºConcurrentHashMapçš„ä¼˜ç§€è®¾è®¡å€Ÿé‰´ï¼Œåœ¨é«˜å¹¶å‘åœºæ™¯æ”¯æŒå’Œçº¿ç¨‹å®‰å…¨ä¸Šéƒ½æœ‰ç›¸åº”çš„æ”¹è¿›ç­–ç•¥ï¼Œä½¿ç”¨Referenceå¼•ç”¨å‘½ä»¤ï¼Œæå‡é«˜å¹¶å‘ä¸‹çš„æ•°æ®â€¦â€¦è®¿é—®é€Ÿåº¦å¹¶ä¿æŒäº†GCçš„å¯å›æ”¶ï¼Œæœ‰æ•ˆèŠ‚çœç©ºé—´ï¼›åŒæ—¶ï¼Œwriteé“¾å’Œaccessé“¾çš„è®¾è®¡ï¼Œèƒ½æ›´çµæ´»ã€é«˜æ•ˆçš„å®ç°å¤šç§ç±»å‹çš„ç¼“å­˜æ¸…ç†ç­–ç•¥ï¼ŒåŒ…æ‹¬åŸºäºå®¹é‡çš„æ¸…ç†ã€åŸºäºæ—¶é—´çš„æ¸…ç†ã€åŸºäºå¼•ç”¨çš„æ¸…ç†ç­‰ï¼›ç¼–ç¨‹å¼çš„buildç”Ÿæˆå™¨ç®¡ç†ï¼Œè®©ä½¿ç”¨è€…æœ‰æ›´å¤šçš„è‡ªç”±åº¦ï¼Œèƒ½å¤Ÿæ ¹æ®ä¸åŒåœºæ™¯è®¾ç½®åˆé€‚çš„æ¨¡å¼</p>
<h5 id="1-5-2-åˆ†å¸ƒå¼ç¼“å­˜"><a href="#1-5-2-åˆ†å¸ƒå¼ç¼“å­˜" class="headerlink" title="1.5.2 åˆ†å¸ƒå¼ç¼“å­˜"></a>1.5.2 åˆ†å¸ƒå¼ç¼“å­˜</h5><h5 id="1-5-2-1-memcachedç¼“å­˜"><a href="#1-5-2-1-memcachedç¼“å­˜" class="headerlink" title="1.5.2.1 memcachedç¼“å­˜"></a>1.5.2.1 memcachedç¼“å­˜</h5><p>memcachedæ˜¯åº”ç”¨è¾ƒå¹¿çš„å¼€æºåˆ†å¸ƒå¼ç¼“å­˜äº§å“ä¹‹ä¸€ï¼Œå®ƒæœ¬èº«å…¶å®ä¸æä¾›åˆ†å¸ƒå¼è§£å†³æ–¹æ¡ˆã€‚åœ¨æœåŠ¡ç«¯ï¼Œmemcachedé›†ç¾¤ç¯å¢ƒå®é™…å°±æ˜¯ä¸€ä¸ªä¸ªmemcachedæœåŠ¡å™¨çš„å †ç§¯ï¼Œç¯å¢ƒæ­å»ºè¾ƒä¸ºç®€å•ï¼›cacheçš„åˆ†å¸ƒå¼ä¸»è¦æ˜¯åœ¨å®¢æˆ·ç«¯å®ç°ï¼Œé€šè¿‡å®¢æˆ·ç«¯çš„è·¯ç”±å¤„ç†æ¥è¾¾åˆ°åˆ†å¸ƒå¼è§£å†³æ–¹æ¡ˆçš„ç›®çš„ã€‚å®¢æˆ·ç«¯åšè·¯ç”±çš„åŸç†éå¸¸ç®€å•ï¼Œåº”ç”¨æœåŠ¡å™¨åœ¨æ¯æ¬¡å­˜å–æŸkeyçš„valueæ—¶ï¼Œé€šè¿‡æŸç§ç®—æ³•æŠŠkeyæ˜ å°„åˆ°æŸå°memcachedæœåŠ¡å™¨nodeAä¸Šï¼Œå› æ­¤è¿™ä¸ªkeyæ‰€æœ‰æ“ä½œéƒ½åœ¨nodeAä¸Šï¼Œç»“æ„å›¾å¦‚ä¸‹å›¾æ‰€ç¤º<br><img src="/2022/07/04/uncatalog/cl56he3gx000050r72rv69xlr/2c71fc19.png" alt="im"><br>memcachedå®¢æˆ·ç«¯è·¯ç”±å›¾<br><img src="/2022/07/04/uncatalog/cl56he3gx000050r72rv69xlr/9a76052b.png" alt="img"><br>memcachedä¸€è‡´æ€§hashç¤ºä¾‹å›¾<br>memcachedå®¢æˆ·ç«¯é‡‡ç”¨ä¸€è‡´æ€§hashç®—æ³•ä½œä¸ºè·¯ç”±ç­–ç•¥ï¼Œå¦‚å›¾7ï¼Œç›¸å¯¹äºä¸€èˆ¬hashï¼ˆå¦‚ç®€å•å–æ¨¡ï¼‰çš„ç®—æ³•ï¼Œä¸€è‡´æ€§hashç®—æ³•é™¤äº†è®¡ç®—keyçš„hashå€¼å¤–ï¼Œè¿˜ä¼šè®¡ç®—æ¯ä¸ªserverå¯¹åº”çš„hashå€¼ï¼Œç„¶åå°†è¿™äº›hashå€¼æ˜ å°„åˆ°ä¸€ä¸ªæœ‰é™çš„å€¼åŸŸä¸Šï¼ˆæ¯”å¦‚0~2^32ï¼‰ã€‚é€šè¿‡å¯»æ‰¾hashå€¼å¤§äºhash(key)çš„æœ€å°serverä½œä¸ºå­˜å‚¨è¯¥keyæ•°æ®çš„ç›®æ ‡serverã€‚å¦‚æœæ‰¾ä¸åˆ°ï¼Œåˆ™ç›´æ¥æŠŠå…·æœ‰æœ€å°hashå€¼çš„serverä½œä¸ºç›®æ ‡serverã€‚åŒæ—¶ï¼Œä¸€å®šç¨‹åº¦ä¸Šï¼Œè§£å†³äº†æ‰©å®¹é—®é¢˜ï¼Œå¢åŠ æˆ–åˆ é™¤å•ä¸ªèŠ‚ç‚¹ï¼Œå¯¹äºæ•´ä¸ªé›†ç¾¤æ¥è¯´ï¼Œä¸ä¼šæœ‰å¤§çš„å½±å“ã€‚æœ€è¿‘ç‰ˆæœ¬ï¼Œå¢åŠ äº†è™šæ‹ŸèŠ‚ç‚¹çš„è®¾è®¡ï¼Œè¿›ä¸€æ­¥æå‡äº†å¯ç”¨æ€§ã€‚<br>memcachedæ˜¯ä¸€ä¸ªé«˜æ•ˆçš„åˆ†å¸ƒå¼å†…å­˜cacheï¼Œäº†è§£memcachedçš„å†…å­˜ç®¡ç†æœºåˆ¶ï¼Œæ‰èƒ½æ›´å¥½çš„æŒæ¡memcachedï¼Œè®©æˆ‘ä»¬å¯ä»¥é’ˆå¯¹æˆ‘ä»¬æ•°æ®ç‰¹ç‚¹è¿›è¡Œè°ƒä¼˜ï¼Œè®©å…¶æ›´å¥½çš„ä¸ºæˆ‘æ‰€ç”¨ã€‚æˆ‘ä»¬çŸ¥é“memcachedä»…æ”¯æŒåŸºç¡€çš„key-valueé”®å€¼å¯¹ç±»å‹æ•°æ®å­˜å‚¨ã€‚åœ¨memcachedå†…å­˜ç»“æ„ä¸­æœ‰ä¸¤ä¸ªéå¸¸é‡è¦çš„æ¦‚å¿µï¼šslabå’Œchunkã€‚å¦‚å›¾ä¸‹å›¾æ‰€ç¤º:<br><img src="/2022/07/04/uncatalog/cl56he3gx000050r72rv69xlr/8552dd28.png" alt="img"><br>slabæ˜¯ä¸€ä¸ªå†…å­˜å—ï¼Œå®ƒæ˜¯memcachedä¸€æ¬¡ç”³è¯·å†…å­˜çš„æœ€å°å•ä½ã€‚åœ¨å¯åŠ¨memcachedçš„æ—¶å€™ä¸€èˆ¬ä¼šä½¿ç”¨å‚æ•°-mæŒ‡å®šå…¶å¯ç”¨å†…å­˜ï¼Œä½†æ˜¯å¹¶ä¸æ˜¯åœ¨å¯åŠ¨çš„é‚£ä¸€åˆ»æ‰€æœ‰çš„å†…å­˜å°±å…¨éƒ¨åˆ†é…å‡ºå»äº†ï¼Œåªæœ‰åœ¨éœ€è¦çš„æ—¶å€™æ‰ä¼šå»ç”³è¯·ï¼Œè€Œä¸”æ¯æ¬¡ç”³è¯·ä¸€å®šæ˜¯ä¸€ä¸ªslabã€‚Slabçš„å¤§å°å›ºå®šä¸º1Mï¼ˆ1048576 Byteï¼‰ï¼Œä¸€ä¸ªslabç”±è‹¥å¹²ä¸ªå¤§å°ç›¸ç­‰çš„chunkç»„æˆã€‚æ¯ä¸ªchunkä¸­éƒ½ä¿å­˜äº†ä¸€ä¸ªitemç»“æ„ä½“ã€ä¸€å¯¹keyå’Œvalueã€‚</p>
<p>è™½ç„¶åœ¨åŒä¸€ä¸ªslabä¸­chunkçš„å¤§å°ç›¸ç­‰çš„ï¼Œä½†æ˜¯åœ¨ä¸åŒçš„slabä¸­chunkçš„å¤§å°å¹¶ä¸ä¸€å®šç›¸ç­‰ï¼Œåœ¨memcachedä¸­æŒ‰ç…§chunkçš„å¤§å°ä¸åŒï¼Œå¯ä»¥æŠŠslabåˆ†ä¸ºå¾ˆå¤šç§ç±»ï¼ˆclassï¼‰ï¼Œé»˜è®¤æƒ…å†µä¸‹memcachedæŠŠslabåˆ†ä¸º40ç±»ï¼ˆclass1ï½class40ï¼‰ï¼Œåœ¨class 1ä¸­ï¼Œchunkçš„å¤§å°ä¸º80å­—èŠ‚ï¼Œç”±äºä¸€ä¸ªslabçš„å¤§å°æ˜¯å›ºå®šçš„1048576å­—èŠ‚ï¼ˆ1Mï¼‰ï¼Œå› æ­¤åœ¨class1ä¸­æœ€å¤šå¯ä»¥æœ‰13107ä¸ªchunkï¼ˆä¹Ÿå°±æ˜¯è¿™ä¸ªslabèƒ½å­˜æœ€å¤š13107ä¸ªå°äº80å­—èŠ‚çš„key-valueæ•°æ®ï¼‰ã€‚</p>
<p>memcachedå†…å­˜ç®¡ç†é‡‡å–é¢„åˆ†é…ã€åˆ†ç»„ç®¡ç†çš„æ–¹å¼ï¼Œåˆ†ç»„ç®¡ç†å°±æ˜¯æˆ‘ä»¬ä¸Šé¢æåˆ°çš„slab classï¼ŒæŒ‰ç…§chunkçš„å¤§å°slabè¢«åˆ†ä¸ºå¾ˆå¤šç§ç±»ã€‚å†…å­˜é¢„åˆ†é…è¿‡ç¨‹æ˜¯æ€æ ·çš„å‘¢ï¼Ÿå‘memcachedæ·»åŠ ä¸€ä¸ªitemæ—¶å€™ï¼Œmemcachedé¦–å…ˆä¼šæ ¹æ®itemçš„å¤§å°ï¼Œæ¥é€‰æ‹©æœ€åˆé€‚çš„slab classï¼šä¾‹å¦‚itemçš„å¤§å°ä¸º190å­—èŠ‚ï¼Œé»˜è®¤æƒ…å†µä¸‹class 4çš„chunkå¤§å°ä¸º160å­—èŠ‚æ˜¾ç„¶ä¸åˆé€‚ï¼Œclass 5çš„chunkå¤§å°ä¸º200å­—èŠ‚ï¼Œå¤§äº190å­—èŠ‚ï¼Œå› æ­¤è¯¥itemå°†æ”¾åœ¨class 5ä¸­ï¼ˆæ˜¾ç„¶è¿™é‡Œä¼šæœ‰10å­—èŠ‚çš„æµªè´¹æ˜¯ä¸å¯é¿å…çš„ï¼‰ï¼Œè®¡ç®—å¥½æ‰€è¦æ”¾å…¥çš„chunkä¹‹åï¼Œmemcachedä¼šå»æ£€æŸ¥è¯¥ç±»å¤§å°çš„chunkè¿˜æœ‰æ²¡æœ‰ç©ºé—²çš„ï¼Œå¦‚æœæ²¡æœ‰ï¼Œå°†ä¼šç”³è¯·1Mï¼ˆ1ä¸ªslabï¼‰çš„ç©ºé—´å¹¶åˆ’åˆ†ä¸ºè¯¥ç§ç±»chunkã€‚ä¾‹å¦‚æˆ‘ä»¬ç¬¬ä¸€æ¬¡å‘memcachedä¸­æ”¾å…¥ä¸€ä¸ª190å­—èŠ‚çš„itemæ—¶ï¼Œmemcachedä¼šäº§ç”Ÿä¸€ä¸ªslab class 2ï¼ˆä¹Ÿå«ä¸€ä¸ªpageï¼‰ï¼Œå¹¶ä¼šç”¨å»ä¸€ä¸ªchunkï¼Œå‰©ä½™5241ä¸ªchunkä¾›ä¸‹æ¬¡æœ‰é€‚åˆå¤§å°itemæ—¶ä½¿ç”¨ï¼Œå½“æˆ‘ä»¬ç”¨å®Œè¿™æ‰€æœ‰çš„5242ä¸ªchunkä¹‹åï¼Œä¸‹æ¬¡å†æœ‰ä¸€ä¸ªåœ¨160ï½200å­—èŠ‚ä¹‹é—´çš„itemæ·»åŠ è¿›æ¥æ—¶ï¼Œmemcachedä¼šå†æ¬¡äº§ç”Ÿä¸€ä¸ªclass 5çš„slabï¼ˆè¿™æ ·å°±å­˜åœ¨äº†2ä¸ªpagesï¼‰ã€‚</p>
<p>æ€»ç»“æ¥çœ‹ï¼Œmemcachedå†…å­˜ç®¡ç†éœ€è¦æ³¨æ„çš„å‡ ä¸ªæ–¹é¢ï¼š</p>
<ul>
<li>chunkæ˜¯åœ¨pageé‡Œé¢åˆ’åˆ†çš„ï¼Œè€Œpageå›ºå®šä¸º1mï¼Œæ‰€ä»¥chunkæœ€å¤§ä¸èƒ½è¶…è¿‡1mã€‚</li>
<li>chunkå®é™…å ç”¨å†…å­˜è¦åŠ 48Bï¼Œå› ä¸ºchunkæ•°æ®ç»“æ„æœ¬èº«éœ€è¦å ç”¨48Bã€‚</li>
<li>å¦‚æœç”¨æˆ·æ•°æ®å¤§äº1mï¼Œåˆ™memcachedä¼šå°†å…¶åˆ‡å‰²ï¼Œæ”¾åˆ°å¤šä¸ªchunkå†…ã€‚</li>
<li>å·²åˆ†é…å‡ºå»çš„pageä¸èƒ½å›æ”¶ã€‚</li>
</ul>
<p>å¯¹äºkey-valueä¿¡æ¯ï¼Œæœ€å¥½ä¸è¦è¶…è¿‡1mçš„å¤§å°ï¼›åŒæ—¶ä¿¡æ¯é•¿åº¦æœ€å¥½ç›¸å¯¹æ˜¯æ¯”è¾ƒå‡è¡¡ç¨³å®šçš„ï¼Œè¿™æ ·èƒ½å¤Ÿä¿éšœæœ€å¤§é™åº¦çš„ä½¿ç”¨å†…å­˜ï¼›åŒæ—¶ï¼Œmemcachedé‡‡ç”¨çš„LRUæ¸…ç†ç­–ç•¥ï¼Œåˆç†ç”šè‡³è¿‡æœŸæ—¶é—´ï¼Œæé«˜å‘½ä¸­ç‡ã€‚<br>æ— ç‰¹æ®Šåœºæ™¯ä¸‹ï¼Œkey-valueèƒ½æ»¡è¶³éœ€æ±‚çš„å‰æä¸‹ï¼Œä½¿ç”¨memcachedåˆ†å¸ƒå¼é›†ç¾¤æ˜¯è¾ƒå¥½çš„é€‰æ‹©ï¼Œæ­å»ºä¸æ“ä½œä½¿ç”¨éƒ½æ¯”è¾ƒç®€å•ï¼›åˆ†å¸ƒå¼é›†ç¾¤åœ¨å•ç‚¹æ•…éšœæ—¶ï¼Œåªå½±å“å°éƒ¨åˆ†æ•°æ®å¼‚å¸¸ï¼Œç›®å‰è¿˜å¯ä»¥é€šè¿‡Magentç¼“å­˜ä»£ç†æ¨¡å¼ï¼Œåšå•ç‚¹å¤‡ä»½ï¼Œæå‡é«˜å¯ç”¨ï¼›æ•´ä¸ªç¼“å­˜éƒ½æ˜¯åŸºäºå†…å­˜çš„ï¼Œå› æ­¤å“åº”æ—¶é—´æ˜¯å¾ˆå¿«ï¼Œä¸éœ€è¦é¢å¤–çš„åºåˆ—åŒ–ã€ååºåˆ—åŒ–çš„ç¨‹åºï¼Œä½†åŒæ—¶ç”±äºåŸºäºå†…å­˜ï¼Œæ•°æ®æ²¡æœ‰æŒä¹…åŒ–ï¼Œé›†ç¾¤æ•…éšœé‡å¯æ•°æ®æ— æ³•æ¢å¤ã€‚é«˜ç‰ˆæœ¬çš„memcachedå·²ç»æ”¯æŒCASæ¨¡å¼çš„åŸå­æ“ä½œï¼Œå¯ä»¥ä½æˆæœ¬çš„è§£å†³å¹¶å‘æ§åˆ¶é—®é¢˜ã€‚</p>
<h5 id="1-5-2-2-Redisç¼“å­˜"><a href="#1-5-2-2-Redisç¼“å­˜" class="headerlink" title="1.5.2.2 Redisç¼“å­˜"></a>1.5.2.2 Redisç¼“å­˜</h5><p>Redisæ˜¯ä¸€ä¸ªè¿œç¨‹å†…å­˜æ•°æ®åº“ï¼ˆéå…³ç³»å‹æ•°æ®åº“ï¼‰ï¼Œæ€§èƒ½å¼ºåŠ²ï¼Œå…·æœ‰å¤åˆ¶ç‰¹æ€§ä»¥åŠè§£å†³é—®é¢˜è€Œç”Ÿçš„ç‹¬ä¸€æ— äºŒçš„æ•°æ®æ¨¡å‹ã€‚å®ƒå¯ä»¥å­˜å‚¨é”®å€¼å¯¹ä¸5ç§ä¸åŒç±»å‹çš„å€¼ä¹‹é—´çš„æ˜ å°„ï¼Œå¯ä»¥å°†å­˜å‚¨åœ¨å†…å­˜çš„é”®å€¼å¯¹æ•°æ®æŒä¹…åŒ–åˆ°ç¡¬ç›˜ï¼Œå¯ä»¥ä½¿ç”¨å¤åˆ¶ç‰¹æ€§æ¥æ‰©å±•è¯»æ€§èƒ½ï¼Œè¿˜å¯ä»¥ä½¿ç”¨å®¢æˆ·ç«¯åˆ†ç‰‡æ¥æ‰©å±•å†™æ€§èƒ½ã€‚<br><img src="/2022/07/04/uncatalog/cl56he3gx000050r72rv69xlr/58db8aae.png" alt="img"><br>ä¸Šå›¾ï¼ŒRediså†…éƒ¨ä½¿ç”¨ä¸€ä¸ªredisObjectå¯¹è±¡æ¥æ ‡è¯†æ‰€æœ‰çš„keyå’Œvalueæ•°æ®ï¼ŒredisObjectæœ€ä¸»è¦çš„ä¿¡æ¯å¦‚å›¾æ‰€ç¤ºï¼štypeä»£è¡¨ä¸€ä¸ªvalueå¯¹è±¡å…·ä½“æ˜¯ä½•ç§æ•°æ®ç±»å‹ï¼Œencodingæ˜¯ä¸åŒæ•°æ®ç±»å‹åœ¨Rediså†…éƒ¨çš„å­˜å‚¨æ–¹å¼ï¼Œæ¯”å¦‚â€”â€”type=stringä»£è¡¨valueå­˜å‚¨çš„æ˜¯ä¸€ä¸ªæ™®é€šå­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆå¯¹åº”çš„encodingå¯ä»¥æ˜¯rawæˆ–æ˜¯intï¼Œå¦‚æœæ˜¯intåˆ™ä»£è¡¨ä¸–ç•ŒRediså†…éƒ¨æ˜¯æŒ‰æ•°å€¼ç±»å‹å­˜å‚¨å’Œè¡¨ç¤ºè¿™ä¸ªå­—ç¬¦ä¸²ã€‚</p>
<p>ä¸Šå›¾å·¦è¾¹çš„rawåˆ—ä¸ºå¯¹è±¡çš„ç¼–ç æ–¹å¼ï¼šå­—ç¬¦ä¸²å¯ä»¥è¢«ç¼–ç ä¸ºrawï¼ˆä¸€èˆ¬å­—ç¬¦ä¸²ï¼‰æˆ–Rintï¼ˆä¸ºäº†èŠ‚çº¦å†…å­˜ï¼ŒRedisä¼šå°†å­—ç¬¦ä¸²è¡¨ç¤ºçš„64ä½æœ‰ç¬¦å·æ•´æ•°ç¼–ç ä¸ºæ•´æ•°æ¥è¿›è¡Œå‚¨å­˜ï¼‰ï¼›åˆ—è¡¨å¯ä»¥è¢«ç¼–ç ä¸ºziplistæˆ–linkedlistï¼Œziplistæ˜¯ä¸ºèŠ‚çº¦å¤§å°è¾ƒå°çš„åˆ—è¡¨ç©ºé—´è€Œä½œçš„ç‰¹æ®Šè¡¨ç¤ºï¼›é›†åˆå¯ä»¥è¢«ç¼–ç ä¸ºintsetæˆ–è€…hashtableï¼Œintsetæ˜¯åªå‚¨å­˜æ•°å­—çš„å°é›†åˆçš„ç‰¹æ®Šè¡¨ç¤ºï¼›hashè¡¨å¯ä»¥ç¼–ç ä¸ºzipmapæˆ–è€…hashtableï¼Œzipmapæ˜¯å°hashè¡¨çš„ç‰¹æ®Šè¡¨ç¤ºï¼›æœ‰åºé›†åˆå¯ä»¥è¢«ç¼–ç ä¸ºziplistæˆ–è€…skiplistæ ¼å¼ï¼Œziplistç”¨äºè¡¨ç¤ºå°çš„æœ‰åºé›†åˆï¼Œè€Œskipliståˆ™ç”¨äºè¡¨ç¤ºä»»ä½•å¤§å°çš„æœ‰åºé›†åˆã€‚</p>
<p>ä»ç½‘ç»œI/Oæ¨¡å‹ä¸Šçœ‹ï¼ŒRedisä½¿ç”¨å•çº¿ç¨‹çš„I/Oå¤ç”¨æ¨¡å‹ï¼Œè‡ªå·±å°è£…äº†ä¸€ä¸ªç®€å•çš„AeEventäº‹ä»¶å¤„ç†æ¡†æ¶ï¼Œä¸»è¦å®ç°äº†epollã€kqueueå’Œselectã€‚å¯¹äºå•çº¯åªæœ‰I/Oæ“ä½œæ¥è¯´ï¼Œå•çº¿ç¨‹å¯ä»¥å°†é€Ÿåº¦ä¼˜åŠ¿å‘æŒ¥åˆ°æœ€å¤§ï¼Œä½†æ˜¯Redisä¹Ÿæä¾›äº†ä¸€äº›ç®€å•çš„è®¡ç®—åŠŸèƒ½ï¼Œæ¯”å¦‚æ’åºã€èšåˆç­‰ï¼Œå¯¹äºè¿™äº›æ“ä½œï¼Œå•çº¿ç¨‹æ¨¡å‹å®é™…ä¼šä¸¥é‡å½±å“æ•´ä½“ååé‡ï¼ŒCPUè®¡ç®—è¿‡ç¨‹ä¸­ï¼Œæ•´ä¸ªI/Oè°ƒåº¦éƒ½æ˜¯è¢«é˜»å¡ä½çš„ï¼Œåœ¨è¿™äº›ç‰¹æ®Šåœºæ™¯çš„ä½¿ç”¨ä¸­ï¼Œéœ€è¦é¢å¤–çš„è€ƒè™‘ã€‚ç›¸è¾ƒäºmemcachedçš„é¢„åˆ†é…å†…å­˜ç®¡ç†ï¼ŒRedisä½¿ç”¨ç°åœºç”³è¯·å†…å­˜çš„æ–¹å¼æ¥å­˜å‚¨æ•°æ®ï¼Œå¹¶ä¸”å¾ˆå°‘ä½¿ç”¨free-listç­‰æ–¹å¼æ¥ä¼˜åŒ–å†…å­˜åˆ†é…ï¼Œä¼šåœ¨ä¸€å®šç¨‹åº¦ä¸Šå­˜åœ¨å†…å­˜ç¢ç‰‡ã€‚Redisè·Ÿæ®å­˜å‚¨å‘½ä»¤å‚æ•°ï¼Œä¼šæŠŠå¸¦è¿‡æœŸæ—¶é—´çš„æ•°æ®å•ç‹¬å­˜æ”¾åœ¨ä¸€èµ·ï¼Œå¹¶æŠŠå®ƒä»¬ç§°ä¸ºä¸´æ—¶æ•°æ®ï¼Œéä¸´æ—¶æ•°æ®æ˜¯æ°¸è¿œä¸ä¼šè¢«å‰”é™¤çš„ï¼Œå³ä¾¿ç‰©ç†å†…å­˜ä¸å¤Ÿï¼Œå¯¼è‡´swapä¹Ÿä¸ä¼šå‰”é™¤ä»»ä½•éä¸´æ—¶æ•°æ®ï¼ˆä½†ä¼šå°è¯•å‰”é™¤éƒ¨åˆ†ä¸´æ—¶æ•°æ®ï¼‰ã€‚</p>
<p>æˆ‘ä»¬æè¿°Redisä¸ºå†…å­˜æ•°æ®åº“ï¼Œä½œä¸ºç¼“å­˜æœåŠ¡ï¼Œå¤§é‡ä½¿ç”¨å†…å­˜é—´çš„æ•°æ®å¿«é€Ÿè¯»å†™ï¼Œæ”¯æŒé«˜å¹¶å‘å¤§ååï¼›è€Œä½œä¸ºæ•°æ®åº“ï¼Œåˆ™æ˜¯æŒ‡Rediså¯¹ç¼“å­˜çš„æŒä¹…åŒ–æ”¯æŒã€‚Redisç”±äºæ”¯æŒäº†éå¸¸ä¸°å¯Œçš„å†…å­˜æ•°æ®åº“ç»“æ„ç±»å‹ï¼Œå¦‚ä½•æŠŠè¿™äº›å¤æ‚çš„å†…å­˜ç»„ç»‡æ–¹å¼æŒä¹…åŒ–åˆ°ç£ç›˜ä¸Šï¼ŸRedisçš„æŒä¹…åŒ–ä¸ä¼ ç»Ÿæ•°æ®åº“çš„æ–¹å¼å·®å¼‚è¾ƒå¤§ï¼ŒRedisä¸€å…±æ”¯æŒå››ç§æŒä¹…åŒ–æ–¹å¼ï¼Œä¸»è¦ä½¿ç”¨çš„ä¸¤ç§ï¼š</p>
<ul>
<li>1.å®šæ—¶å¿«ç…§æ–¹å¼(snapshot)ï¼šè¯¥æŒä¹…åŒ–æ–¹å¼å®é™…æ˜¯åœ¨Rediså†…éƒ¨ä¸€ä¸ªå®šæ—¶å™¨äº‹ä»¶ï¼Œæ¯éš”å›ºå®šæ—¶é—´å»æ£€æŸ¥å½“å‰æ•°æ®å‘ç”Ÿçš„æ”¹å˜æ¬¡æ•°ä¸æ—¶é—´æ˜¯å¦æ»¡è¶³é…ç½®çš„æŒä¹…åŒ–è§¦å‘çš„æ¡ä»¶ï¼Œå¦‚æœæ»¡è¶³åˆ™é€šè¿‡æ“ä½œç³»ç»Ÿforkè°ƒç”¨æ¥åˆ›å»ºå‡ºä¸€ä¸ªå­è¿›ç¨‹ï¼Œè¿™ä¸ªå­è¿›ç¨‹é»˜è®¤ä¼šä¸çˆ¶è¿›ç¨‹å…±äº«ç›¸åŒçš„åœ°å€ç©ºé—´ï¼Œè¿™æ—¶å°±å¯ä»¥é€šè¿‡å­è¿›ç¨‹æ¥éå†æ•´ä¸ªå†…å­˜æ¥è¿›è¡Œå­˜å‚¨æ“ä½œï¼Œè€Œä¸»è¿›ç¨‹åˆ™ä»ç„¶å¯ä»¥æä¾›æœåŠ¡ï¼Œå½“æœ‰å†™å…¥æ—¶ç”±æ“ä½œç³»ç»ŸæŒ‰ç…§å†…å­˜é¡µï¼ˆpageï¼‰ä¸ºå•ä½æ¥è¿›è¡Œcopy-on-writeä¿è¯çˆ¶å­è¿›ç¨‹ä¹‹é—´ä¸ä¼šäº’ç›¸å½±å“ã€‚å®ƒçš„ç¼ºç‚¹æ˜¯å¿«ç…§åªæ˜¯ä»£è¡¨ä¸€æ®µæ—¶é—´å†…çš„å†…å­˜æ˜ åƒï¼Œæ‰€ä»¥ç³»ç»Ÿé‡å¯ä¼šä¸¢å¤±ä¸Šæ¬¡å¿«ç…§ä¸é‡å¯ä¹‹é—´æ‰€æœ‰çš„æ•°æ®ã€‚ </li>
<li>2.åŸºäºè¯­å¥è¿½åŠ æ–‡ä»¶çš„æ–¹å¼(aof)ï¼šaofæ–¹å¼å®é™…ç±»ä¼¼MySQlçš„åŸºäºè¯­å¥çš„binlogæ–¹å¼ï¼Œå³æ¯æ¡ä¼šä½¿Rediså†…å­˜æ•°æ®å‘ç”Ÿæ”¹å˜çš„å‘½ä»¤éƒ½ä¼šè¿½åŠ åˆ°ä¸€ä¸ªlogæ–‡ä»¶ä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªlogæ–‡ä»¶å°±æ˜¯Redisçš„æŒä¹…åŒ–æ•°æ®ã€‚</li>
</ul>
<p>aofçš„æ–¹å¼çš„ä¸»è¦ç¼ºç‚¹æ˜¯è¿½åŠ logæ–‡ä»¶å¯èƒ½å¯¼è‡´ä½“ç§¯è¿‡å¤§ï¼Œå½“ç³»ç»Ÿé‡å¯æ¢å¤æ•°æ®æ—¶å¦‚æœæ˜¯aofçš„æ–¹å¼åˆ™åŠ è½½æ•°æ®ä¼šéå¸¸æ…¢ï¼Œå‡ åGçš„æ•°æ®å¯èƒ½éœ€è¦å‡ å°æ—¶æ‰èƒ½åŠ è½½å®Œï¼Œå½“ç„¶è¿™ä¸ªè€—æ—¶å¹¶ä¸æ˜¯å› ä¸ºç£ç›˜æ–‡ä»¶è¯»å–é€Ÿåº¦æ…¢ï¼Œè€Œæ˜¯ç”±äºè¯»å–çš„æ‰€æœ‰å‘½ä»¤éƒ½è¦åœ¨å†…å­˜ä¸­æ‰§è¡Œä¸€éã€‚å¦å¤–ç”±äºæ¯æ¡å‘½ä»¤éƒ½è¦å†™logï¼Œæ‰€ä»¥ä½¿ç”¨aofçš„æ–¹å¼ï¼ŒRedisçš„è¯»å†™æ€§èƒ½ä¹Ÿä¼šæœ‰æ‰€ä¸‹é™ã€‚<br>Redisçš„æŒä¹…åŒ–ä½¿ç”¨äº†Buffer I/Oï¼Œæ‰€è°“Buffer I/Oæ˜¯æŒ‡Rediså¯¹æŒä¹…åŒ–æ–‡ä»¶çš„å†™å…¥å’Œè¯»å–æ“ä½œéƒ½ä¼šä½¿ç”¨ç‰©ç†å†…å­˜çš„Page Cacheï¼Œè€Œå¤§å¤šæ•°æ•°æ®åº“ç³»ç»Ÿä¼šä½¿ç”¨Direct I/Oæ¥ç»•è¿‡è¿™å±‚Page Cacheå¹¶è‡ªè¡Œç»´æŠ¤ä¸€ä¸ªæ•°æ®çš„Cacheã€‚è€Œå½“Redisçš„æŒä¹…åŒ–æ–‡ä»¶è¿‡å¤§ï¼ˆå°¤å…¶æ˜¯å¿«ç…§æ–‡ä»¶ï¼‰ï¼Œå¹¶å¯¹å…¶è¿›è¡Œè¯»å†™æ—¶ï¼Œç£ç›˜æ–‡ä»¶ä¸­çš„æ•°æ®éƒ½ä¼šè¢«åŠ è½½åˆ°ç‰©ç†å†…å­˜ä¸­ä½œä¸ºæ“ä½œç³»ç»Ÿå¯¹è¯¥æ–‡ä»¶çš„ä¸€å±‚Cacheï¼Œè€Œè¿™å±‚Cacheçš„æ•°æ®ä¸Rediså†…å­˜ä¸­ç®¡ç†çš„æ•°æ®å®é™…æ˜¯é‡å¤å­˜å‚¨çš„ã€‚è™½ç„¶å†…æ ¸åœ¨ç‰©ç†å†…å­˜ç´§å¼ æ—¶ä¼šåšPage Cacheçš„å‰”é™¤å·¥ä½œï¼Œä½†å†…æ ¸å¾ˆå¯èƒ½è®¤ä¸ºæŸå—Page Cacheæ›´é‡è¦ï¼Œè€Œè®©ä½ çš„è¿›ç¨‹å¼€å§‹Swapï¼Œè¿™æ—¶ä½ çš„ç³»ç»Ÿå°±ä¼šå¼€å§‹å‡ºç°ä¸ç¨³å®šæˆ–è€…å´©æºƒäº†ï¼Œå› æ­¤åœ¨æŒä¹…åŒ–é…ç½®åï¼Œé’ˆå¯¹å†…å­˜ä½¿ç”¨éœ€è¦å®æ—¶ç›‘æ§è§‚å¯Ÿã€‚</p>
<p>ä¸memcachedå®¢æˆ·ç«¯æ”¯æŒåˆ†å¸ƒå¼æ–¹æ¡ˆä¸åŒï¼ŒRedisæ›´å€¾å‘äºåœ¨æœåŠ¡ç«¯æ„å»ºåˆ†å¸ƒå¼å­˜å‚¨,å¦‚ä¸‹å›¾<br><img src="/2022/07/04/uncatalog/cl56he3gx000050r72rv69xlr/0941f7e1.png" alt="img"><br><img src="/2022/07/04/uncatalog/cl56he3gx000050r72rv69xlr/ce564c30.png" alt="img"><br>Redis Clusteræ˜¯ä¸€ä¸ªå®ç°äº†åˆ†å¸ƒå¼ä¸”å…è®¸å•ç‚¹æ•…éšœçš„Redisé«˜çº§ç‰ˆæœ¬ï¼Œå®ƒæ²¡æœ‰ä¸­å¿ƒèŠ‚ç‚¹ï¼Œå…·æœ‰çº¿æ€§å¯ä¼¸ç¼©çš„åŠŸèƒ½ã€‚å¦‚ä¸Šå›¾ï¼Œå…¶ä¸­èŠ‚ç‚¹ä¸èŠ‚ç‚¹ä¹‹é—´é€šè¿‡äºŒè¿›åˆ¶åè®®è¿›è¡Œé€šä¿¡ï¼ŒèŠ‚ç‚¹ä¸å®¢æˆ·ç«¯ä¹‹é—´é€šè¿‡asciiåè®®è¿›è¡Œé€šä¿¡ã€‚åœ¨æ•°æ®çš„æ”¾ç½®ç­–ç•¥ä¸Šï¼ŒRedis Clusterå°†æ•´ä¸ªkeyçš„æ•°å€¼åŸŸåˆ†æˆ4096ä¸ªhashæ§½ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¸Šå¯ä»¥å­˜å‚¨ä¸€ä¸ªæˆ–å¤šä¸ªhashæ§½ï¼Œä¹Ÿå°±æ˜¯è¯´å½“å‰Redis Clusteræ”¯æŒçš„æœ€å¤§èŠ‚ç‚¹æ•°å°±æ˜¯4096ã€‚Redis Clusterä½¿ç”¨çš„åˆ†å¸ƒå¼ç®—æ³•ä¹Ÿå¾ˆç®€å•ï¼šcrc16( key ) % HASH_SLOTS_NUMBERã€‚</p>
<p>ä¸ªäººæ€»ç»“äº†ä»¥ä¸‹å¤šç§Webåº”ç”¨åœºæ™¯ï¼Œåœ¨è¿™äº›åœºæ™¯ä¸‹å¯ä»¥å……åˆ†çš„åˆ©ç”¨Redisçš„ç‰¹æ€§ï¼Œå¤§å¤§æé«˜æ•ˆç‡ã€‚</p>
<ul>
<li>åœ¨ä¸»é¡µä¸­æ˜¾ç¤ºæœ€æ–°çš„é¡¹ç›®åˆ—è¡¨ï¼šRedisä½¿ç”¨çš„æ˜¯å¸¸é©»å†…å­˜çš„ç¼“å­˜ï¼Œé€Ÿåº¦éå¸¸å¿«ã€‚LPUSHç”¨æ¥æ’å…¥ä¸€ä¸ªå†…å®¹IDï¼Œä½œä¸ºå…³é”®å­—å­˜å‚¨åœ¨åˆ—è¡¨å¤´éƒ¨ã€‚LTRIMç”¨æ¥é™åˆ¶åˆ—è¡¨ä¸­çš„é¡¹ç›®æ•°æœ€å¤šä¸º5000ã€‚å¦‚æœç”¨æˆ·éœ€è¦çš„æ£€ç´¢çš„æ•°æ®é‡è¶…è¶Šè¿™ä¸ªç¼“å­˜å®¹é‡ï¼Œè¿™æ—¶æ‰éœ€è¦æŠŠè¯·æ±‚å‘é€åˆ°æ•°æ®åº“ã€‚</li>
<li>åˆ é™¤å’Œè¿‡æ»¤ï¼šå¦‚æœä¸€ç¯‡æ–‡ç« è¢«åˆ é™¤ï¼Œå¯ä»¥ä½¿ç”¨LREMä»ç¼“å­˜ä¸­å½»åº•æ¸…é™¤æ‰ã€‚</li>
<li>æ’è¡Œæ¦œåŠç›¸å…³é—®é¢˜ï¼šæ’è¡Œæ¦œï¼ˆleader boardï¼‰æŒ‰ç…§å¾—åˆ†è¿›è¡Œæ’åºã€‚ZADDå‘½ä»¤å¯ä»¥ç›´æ¥å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œè€ŒZREVRANGEå‘½ä»¤å¯ä»¥ç”¨æ¥æŒ‰ç…§å¾—åˆ†æ¥è·å–å‰100åçš„ç”¨æˆ·ï¼ŒZRANKå¯ä»¥ç”¨æ¥è·å–ç”¨æˆ·æ’åï¼Œéå¸¸ç›´æ¥è€Œä¸”æ“ä½œå®¹æ˜“ã€‚</li>
<li>æŒ‰ç…§ç”¨æˆ·æŠ•ç¥¨å’Œæ—¶é—´æ’åºï¼šæ’è¡Œæ¦œï¼Œå¾—åˆ†ä¼šéšç€æ—¶é—´å˜åŒ–ã€‚LPUSHå’ŒLTRIMå‘½ä»¤ç»“åˆè¿ç”¨ï¼ŒæŠŠæ–‡ç« æ·»åŠ åˆ°ä¸€ä¸ªåˆ—è¡¨ä¸­ã€‚ä¸€é¡¹åå°ä»»åŠ¡ç”¨æ¥è·å–åˆ—è¡¨ï¼Œå¹¶é‡æ–°è®¡ç®—åˆ—è¡¨çš„æ’åºï¼ŒZADDå‘½ä»¤ç”¨æ¥æŒ‰ç…§æ–°çš„é¡ºåºå¡«å……ç”Ÿæˆåˆ—è¡¨ã€‚åˆ—è¡¨å¯ä»¥å®ç°éå¸¸å¿«é€Ÿçš„æ£€ç´¢ï¼Œå³ä½¿æ˜¯è´Ÿè½½å¾ˆé‡çš„ç«™ç‚¹ã€‚</li>
<li>è¿‡æœŸé¡¹ç›®å¤„ç†ï¼šä½¿ç”¨Unixæ—¶é—´ä½œä¸ºå…³é”®å­—ï¼Œç”¨æ¥ä¿æŒåˆ—è¡¨èƒ½å¤ŸæŒ‰æ—¶é—´æ’åºã€‚å¯¹current_timeå’Œtime_to_liveè¿›è¡Œæ£€ç´¢ï¼Œå®ŒæˆæŸ¥æ‰¾è¿‡æœŸé¡¹ç›®çš„è‰°å·¨ä»»åŠ¡ã€‚å¦ä¸€é¡¹åå°ä»»åŠ¡ä½¿ç”¨ZRANGEâ€¦WITHSCORESè¿›è¡ŒæŸ¥è¯¢ï¼Œåˆ é™¤è¿‡æœŸçš„æ¡ç›®ã€‚</li>
<li>è®¡æ•°ï¼šè¿›è¡Œå„ç§æ•°æ®ç»Ÿè®¡çš„ç”¨é€”æ˜¯éå¸¸å¹¿æ³›çš„ï¼Œæ¯”å¦‚æƒ³çŸ¥é“ä»€ä¹ˆæ—¶å€™å°é”ä¸€ä¸ªIPåœ°å€ã€‚INCRBYå‘½ä»¤è®©è¿™äº›å˜å¾—å¾ˆå®¹æ˜“ï¼Œé€šè¿‡åŸå­é€’å¢ä¿æŒè®¡æ•°ï¼›GETSETç”¨æ¥é‡ç½®è®¡æ•°å™¨ï¼›è¿‡æœŸå±æ€§ç”¨æ¥ç¡®è®¤ä¸€ä¸ªå…³é”®å­—ä»€ä¹ˆæ—¶å€™åº”è¯¥åˆ é™¤ã€‚</li>
<li>ç‰¹å®šæ—¶é—´å†…çš„ç‰¹å®šé¡¹ç›®ï¼šè¿™æ˜¯ç‰¹å®šè®¿é—®è€…çš„é—®é¢˜ï¼Œå¯ä»¥é€šè¿‡ç»™æ¯æ¬¡é¡µé¢æµè§ˆä½¿ç”¨SADDå‘½ä»¤æ¥è§£å†³ã€‚SADDä¸ä¼šå°†å·²ç»å­˜åœ¨çš„æˆå‘˜æ·»åŠ åˆ°ä¸€ä¸ªé›†åˆã€‚</li>
<li>Pub/Subï¼šåœ¨æ›´æ–°ä¸­ä¿æŒç”¨æˆ·å¯¹æ•°æ®çš„æ˜ å°„æ˜¯ç³»ç»Ÿä¸­çš„ä¸€ä¸ªæ™®éä»»åŠ¡ã€‚Redisçš„pub/subåŠŸèƒ½ä½¿ç”¨äº†SUBSCRIBEã€UNSUBSCRIBEå’ŒPUBLISHå‘½ä»¤ï¼Œè®©è¿™ä¸ªå˜å¾—æ›´åŠ å®¹æ˜“ã€‚</li>
<li>é˜Ÿåˆ—ï¼šåœ¨å½“å‰çš„ç¼–ç¨‹ä¸­é˜Ÿåˆ—éšå¤„å¯è§ã€‚é™¤äº†pushå’Œpopç±»å‹çš„å‘½ä»¤ä¹‹å¤–ï¼ŒRedisè¿˜æœ‰é˜»å¡é˜Ÿåˆ—çš„å‘½ä»¤ï¼Œèƒ½å¤Ÿè®©ä¸€ä¸ªç¨‹åºåœ¨æ‰§è¡Œæ—¶è¢«å¦ä¸€ä¸ªç¨‹åºæ·»åŠ åˆ°é˜Ÿåˆ—ã€‚</li>
</ul>
]]></content>
      <tags>
        <tag>æ¶æ„è®¾è®¡é‚£äº›äº‹å„¿</tag>
      </tags>
  </entry>
  <entry>
    <title>æ¶æ„è®¾è®¡é‚£äº›äº‹å„¿--ç¼“å­˜é‚£äº›äº‹å„¿(ä¸‰)ï¼Œç¼“å­˜æ€§èƒ½å’Œä¸€è‡´æ€§çš„æœ€ä½³å®è·µ</title>
    <url>/2022/07/04/uncatalog/cl58235q80000ikr72lnvg3qt/</url>
    <content><![CDATA[<hr>
<span id="more"></span>
<blockquote>
<p>ç›®å‰å„ç§ç±»å‹çš„ç¼“å­˜éƒ½æ´»è·ƒåœ¨æˆåƒä¸Šä¸‡çš„åº”ç”¨æœåŠ¡ä¸­ï¼Œè¿˜æ²¡æœ‰ä¸€ç§ç¼“å­˜æ–¹æ¡ˆå¯ä»¥è§£å†³ä¸€åˆ‡çš„ä¸šåŠ¡åœºæ™¯æˆ–æ•°æ®ç±»å‹ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®è‡ªèº«çš„ç‰¹æ®Šåœºæ™¯å’ŒèƒŒæ™¯ï¼Œé€‰æ‹©æœ€é€‚åˆçš„ç¼“å­˜æ–¹æ¡ˆã€‚ç¼“å­˜çš„ä½¿ç”¨æ˜¯ç¨‹åºå‘˜ã€æ¶æ„å¸ˆçš„å¿…å¤‡æŠ€èƒ½ï¼Œå¥½çš„ç¨‹åºå‘˜èƒ½æ ¹æ®æ•°æ®ç±»å‹ã€ä¸šåŠ¡åœºæ™¯æ¥å‡†ç¡®åˆ¤æ–­ä½¿ç”¨ä½•ç§ç±»å‹çš„ç¼“å­˜ï¼Œå¦‚ä½•ä½¿ç”¨è¿™ç§ç¼“å­˜ï¼Œä»¥æœ€å°çš„æˆæœ¬æœ€å¿«çš„æ•ˆç‡è¾¾åˆ°æœ€ä¼˜çš„ç›®çš„ã€‚</p>
</blockquote>
<p>ã€Šæ¶æ„è®¾è®¡é‚£äº›äº‹å„¿â€“ç¼“å­˜é‚£äº›äº‹å„¿ã€‹ç³»åˆ—å…±åˆ†å…­ç« ï¼š</p>
<ul>
<li><a href="https://bugkillerpro.github.io/2022/07/04/uncatalog/cl56he3gx000050r72rv69xlr/">æ¶æ„è®¾è®¡é‚£äº›äº‹å„¿â€“ç¼“å­˜é‚£äº›äº‹å„¿(ä¸€)ï¼Œç¼“å­˜çš„å‰ä¸–ä»Šç”Ÿ</a></li>
<li><a href="https://bugkillerpro.github.io/2022/07/04/uncatalog/cl58235qb0001ikr7dxwr0zu2/">æ¶æ„è®¾è®¡é‚£äº›äº‹å„¿â€“ç¼“å­˜é‚£äº›äº‹å„¿(äºŒ)ï¼Œç¼“å­˜è®¾è®¡æ¨¡å¼</a></li>
<li><a href="https://bugkillerpro.github.io/2022/07/04/uncatalog/cl58235q80000ikr72lnvg3qt/">æ¶æ„è®¾è®¡é‚£äº›äº‹å„¿â€“ç¼“å­˜é‚£äº›äº‹å„¿(ä¸‰)ï¼Œç¼“å­˜æ€§èƒ½å’Œä¸€è‡´æ€§çš„æœ€ä½³å®è·µ</a></li>
<li><a href="https://bugkillerpro.github.io/2022/07/12/uncatalog/cl5hl5x3l00000wr734tl8oua/">æ¶æ„è®¾è®¡é‚£äº›äº‹å„¿â€“ç¼“å­˜é‚£äº›äº‹å„¿(å››)ï¼Œç¼“å­˜ç©¿é€ã€ ç¼“å­˜é›ªå´© å’Œ ç¼“å­˜å‡»ç©¿</a></li>
<li><a href="https://bugkillerpro.github.io/2022/07/12/uncatalog/cl5hm81oo00000wr786z6dmjl/">æ¶æ„è®¾è®¡é‚£äº›äº‹å„¿â€“ç¼“å­˜é‚£äº›äº‹å„¿(äº”)ï¼Œå¸ƒéš†è¿‡æ»¤å™¨è¯¦è§£</a></li>
<li><a href>æ¶æ„è®¾è®¡é‚£äº›äº‹å„¿â€“ç¼“å­˜é‚£äº›äº‹å„¿(å…­)ï¼Œredis</a></li>
</ul>
<p>å½“ç³»ç»Ÿå†³å®šå¼•å…¥ç¼“å­˜æ–¹æ¡ˆçš„æ—¶å€™ï¼Œç¼“å­˜å’Œæ•°æ®åº“çš„ä¸€è‡´æ€§ï¼Œä¾¿ä¼šæˆä¸ºä¸€ä¸ªæ— æ³•å›é¿çš„é—®é¢˜ã€‚<br>å¾ˆå¤šäººå¯¹è¿™ä¸ªé—®é¢˜ï¼Œæœ‰å¾ˆå¤šç–‘æƒ‘ï¼š</p>
<ul>
<li>åˆ°åº•æ˜¯æ›´æ–°ç¼“å­˜è¿˜æ˜¯åˆ ç¼“å­˜ï¼Ÿ</li>
<li>åˆ°åº•é€‰æ‹©å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜ï¼Œè¿˜æ˜¯å…ˆåˆ é™¤ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“ï¼Ÿ</li>
<li>ä¸ºä»€ä¹ˆè¦å¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—ä¿è¯ä¸€è‡´æ€§ï¼Ÿ</li>
<li>å»¶è¿ŸåŒåˆ ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Ÿåˆ°åº•è¦ä¸è¦ç”¨ï¼Ÿ</li>
<li>â€¦</li>
</ul>
<p>æ¥ä¸‹æ¥å°†ä»æ ¹æºä¸Šè¯¦ç»†è§£å†³è¿™äº›ç–‘æƒ‘<br><img src="/2022/07/04/uncatalog/cl58235q80000ikr72lnvg3qt/640.png" alt="img"></p>
<h2 id="å¼•å…¥ç¼“å­˜æé«˜æ€§èƒ½"><a href="#å¼•å…¥ç¼“å­˜æé«˜æ€§èƒ½" class="headerlink" title="å¼•å…¥ç¼“å­˜æé«˜æ€§èƒ½"></a>å¼•å…¥ç¼“å­˜æé«˜æ€§èƒ½</h2><p>æˆ‘ä»¬ä»æœ€ç®€å•çš„åœºæ™¯å¼€å§‹è®²èµ·ã€‚</p>
<p>å¦‚æœä½ çš„ä¸šåŠ¡å¤„äºèµ·æ­¥é˜¶æ®µï¼Œæµé‡éå¸¸å°ï¼Œé‚£æ— è®ºæ˜¯è¯»è¯·æ±‚è¿˜æ˜¯å†™è¯·æ±‚ï¼Œç›´æ¥æ“ä½œæ•°æ®åº“å³å¯ï¼Œè¿™æ—¶ä½ çš„æ¶æ„æ¨¡å‹æ˜¯è¿™æ ·çš„ï¼š<br><img src="/2022/07/04/uncatalog/cl58235q80000ikr72lnvg3qt/640.jpg" alt="img"><br>ä½†éšç€ä¸šåŠ¡é‡çš„å¢é•¿ï¼Œä½ çš„é¡¹ç›®è¯·æ±‚é‡è¶Šæ¥è¶Šå¤§ï¼Œè¿™æ—¶å¦‚æœæ¯æ¬¡éƒ½ä»æ•°æ®åº“ä¸­è¯»æ•°æ®ï¼Œé‚£è‚¯å®šä¼šæœ‰æ€§èƒ½é—®é¢˜ã€‚</p>
<p>è¿™ä¸ªé˜¶æ®µé€šå¸¸çš„åšæ³•æ˜¯ï¼Œå¼•å…¥ã€Œç¼“å­˜ã€æ¥æé«˜è¯»æ€§èƒ½ï¼Œæ¶æ„æ¨¡å‹å°±å˜æˆäº†è¿™æ ·ï¼š<br><img src="/2022/07/04/uncatalog/cl58235q80000ikr72lnvg3qt/6401.jpg" alt="img"><br>å½“ä¸‹ä¼˜ç§€çš„ç¼“å­˜ä¸­é—´ä»¶ï¼Œå½“å± Redis è«å±ï¼Œå®ƒä¸ä»…æ€§èƒ½éå¸¸é«˜ï¼Œè¿˜æä¾›äº†å¾ˆå¤šå‹å¥½çš„æ•°æ®ç±»å‹ï¼Œå¯ä»¥å¾ˆå¥½åœ°æ»¡è¶³æˆ‘ä»¬çš„ä¸šåŠ¡éœ€æ±‚ã€‚</p>
<p>ä½†å¼•å…¥ç¼“å­˜ä¹‹åï¼Œä½ å°±ä¼šé¢ä¸´ä¸€ä¸ªé—®é¢˜ï¼šä¹‹å‰æ•°æ®åªå­˜åœ¨æ•°æ®åº“ä¸­ï¼Œç°åœ¨è¦æ”¾åˆ°ç¼“å­˜ä¸­è¯»å–ï¼Œå…·ä½“è¦æ€ä¹ˆå­˜å‘¢ï¼Ÿ</p>
<p>æœ€ç®€å•ç›´æ¥çš„æ–¹æ¡ˆæ˜¯ã€Œå…¨é‡æ•°æ®åˆ·åˆ°ç¼“å­˜ä¸­ã€ï¼š</p>
<ul>
<li>æ•°æ®åº“çš„æ•°æ®ï¼Œå…¨é‡åˆ·å…¥ç¼“å­˜ï¼ˆä¸è®¾ç½®å¤±æ•ˆæ—¶é—´ï¼‰</li>
<li>å†™è¯·æ±‚åªæ›´æ–°æ•°æ®åº“ï¼Œä¸æ›´æ–°ç¼“å­˜</li>
<li>å¯åŠ¨ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œå®šæ—¶æŠŠæ•°æ®åº“çš„æ•°æ®ï¼Œæ›´æ–°åˆ°ç¼“å­˜ä¸­</li>
</ul>
<p><img src="/2022/07/04/uncatalog/cl58235q80000ikr72lnvg3qt/6402.jpg" alt="img"></p>
<p>è¿™ä¸ªæ–¹æ¡ˆçš„ä¼˜ç‚¹æ˜¯ï¼Œæ‰€æœ‰è¯»è¯·æ±‚éƒ½å¯ä»¥ç›´æ¥ã€Œå‘½ä¸­ã€ç¼“å­˜ï¼Œä¸éœ€è¦å†æŸ¥æ•°æ®åº“ï¼Œæ€§èƒ½éå¸¸é«˜ã€‚</p>
<p>ä½†ç¼ºç‚¹ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œæœ‰ 2 ä¸ªé—®é¢˜ï¼š</p>
<ul>
<li>ç¼“å­˜åˆ©ç”¨ç‡ä½ï¼šä¸ç»å¸¸è®¿é—®çš„æ•°æ®ï¼Œè¿˜ä¸€ç›´ç•™åœ¨ç¼“å­˜ä¸­</li>
<li>æ•°æ®ä¸ä¸€è‡´ï¼šå› ä¸ºæ˜¯ã€Œå®šæ—¶ã€åˆ·æ–°ç¼“å­˜ï¼Œç¼“å­˜å’Œæ•°æ®åº“å­˜åœ¨ä¸ä¸€è‡´ï¼ˆå–å†³äºå®šæ—¶ä»»åŠ¡çš„æ‰§è¡Œé¢‘ç‡ï¼‰</li>
</ul>
<p>æ‰€ä»¥ï¼Œè¿™ç§æ–¹æ¡ˆä¸€èˆ¬æ›´é€‚åˆä¸šåŠ¡ã€Œä½“é‡å°ã€ï¼Œä¸”å¯¹æ•°æ®ä¸€è‡´æ€§è¦æ±‚ä¸é«˜çš„ä¸šåŠ¡åœºæ™¯ã€‚</p>
<p>é‚£å¦‚æœæˆ‘ä»¬çš„ä¸šåŠ¡ä½“é‡å¾ˆå¤§ï¼Œæ€ä¹ˆè§£å†³è¿™ 2 ä¸ªé—®é¢˜å‘¢ï¼Ÿ</p>
<h2 id="ç¼“å­˜åˆ©ç”¨ç‡å’Œä¸€è‡´æ€§é—®é¢˜"><a href="#ç¼“å­˜åˆ©ç”¨ç‡å’Œä¸€è‡´æ€§é—®é¢˜" class="headerlink" title="ç¼“å­˜åˆ©ç”¨ç‡å’Œä¸€è‡´æ€§é—®é¢˜"></a>ç¼“å­˜åˆ©ç”¨ç‡å’Œä¸€è‡´æ€§é—®é¢˜</h2><p>å…ˆæ¥çœ‹ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚ä½•æé«˜ç¼“å­˜åˆ©ç”¨ç‡ï¼Ÿ</p>
<p>æƒ³è¦ç¼“å­˜åˆ©ç”¨ç‡ã€Œæœ€å¤§åŒ–ã€ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“æƒ³åˆ°çš„æ–¹æ¡ˆæ˜¯ï¼Œç¼“å­˜ä¸­åªä¿ç•™æœ€è¿‘è®¿é—®çš„ã€Œçƒ­æ•°æ®ã€ã€‚ä½†å…·ä½“è¦æ€ä¹ˆåšå‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬å¯ä»¥è¿™æ ·ä¼˜åŒ–ï¼š</p>
<ul>
<li>å†™è¯·æ±‚ä¾æ—§åªå†™æ•°æ®åº“</li>
<li>è¯»è¯·æ±‚å…ˆè¯»ç¼“å­˜ï¼Œå¦‚æœç¼“å­˜ä¸å­˜åœ¨ï¼Œåˆ™ä»æ•°æ®åº“è¯»å–ï¼Œå¹¶é‡å»ºç¼“å­˜</li>
<li>åŒæ—¶ï¼Œå†™å…¥ç¼“å­˜ä¸­çš„æ•°æ®ï¼Œéƒ½è®¾ç½®å¤±æ•ˆæ—¶é—´</li>
</ul>
<p><img src="/2022/07/04/uncatalog/cl58235q80000ikr72lnvg3qt/6403.jpg" alt="img"></p>
<p>è¿™æ ·ä¸€æ¥ï¼Œç¼“å­˜ä¸­ä¸ç»å¸¸è®¿é—®çš„æ•°æ®ï¼Œéšç€æ—¶é—´çš„æ¨ç§»ï¼Œéƒ½ä¼šé€æ¸ã€Œè¿‡æœŸã€æ·˜æ±°æ‰ï¼Œæœ€ç»ˆç¼“å­˜ä¸­ä¿ç•™çš„ï¼Œéƒ½æ˜¯ç»å¸¸è¢«è®¿é—®çš„ã€Œçƒ­æ•°æ®ã€ï¼Œç¼“å­˜åˆ©ç”¨ç‡å¾—ä»¥æœ€å¤§åŒ–ã€‚</p>
<p>å†æ¥çœ‹æ•°æ®ä¸€è‡´æ€§é—®é¢˜ã€‚</p>
<p>è¦æƒ³ä¿è¯ç¼“å­˜å’Œæ•°æ®åº“ã€Œå®æ—¶ã€ä¸€è‡´ï¼Œé‚£å°±ä¸èƒ½å†ç”¨å®šæ—¶ä»»åŠ¡åˆ·æ–°ç¼“å­˜äº†ã€‚</p>
<p>æ‰€ä»¥ï¼Œå½“æ•°æ®å‘ç”Ÿæ›´æ–°æ—¶ï¼Œæˆ‘ä»¬ä¸ä»…è¦æ“ä½œæ•°æ®åº“ï¼Œè¿˜è¦ä¸€å¹¶æ“ä½œç¼“å­˜ã€‚å…·ä½“æ“ä½œå°±æ˜¯ï¼Œä¿®æ”¹ä¸€æ¡æ•°æ®æ—¶ï¼Œä¸ä»…è¦æ›´æ–°æ•°æ®åº“ï¼Œä¹Ÿè¦è¿å¸¦ç¼“å­˜ä¸€èµ·æ›´æ–°ã€‚</p>
<p>ä½†æ•°æ®åº“å’Œç¼“å­˜éƒ½æ›´æ–°ï¼Œåˆå­˜åœ¨å…ˆåé—®é¢˜ï¼Œé‚£å¯¹åº”çš„æ–¹æ¡ˆå°±æœ‰ 2 ä¸ªï¼š</p>
<ul>
<li>å…ˆæ›´æ–°ç¼“å­˜ï¼Œåæ›´æ–°æ•°æ®åº“</li>
<li>å…ˆæ›´æ–°æ•°æ®åº“ï¼Œåæ›´æ–°ç¼“å­˜<br>å“ªä¸ªæ–¹æ¡ˆæ›´å¥½å‘¢ï¼Ÿ</li>
</ul>
<p>å…ˆä¸è€ƒè™‘å¹¶å‘é—®é¢˜ï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œæ— è®ºè°å…ˆè°åï¼Œéƒ½å¯ä»¥è®©ä¸¤è€…ä¿æŒä¸€è‡´ï¼Œä½†ç°åœ¨æˆ‘ä»¬éœ€è¦é‡ç‚¹è€ƒè™‘ã€Œå¼‚å¸¸ã€æƒ…å†µã€‚</p>
<p>å› ä¸ºæ“ä½œåˆ†ä¸ºä¸¤æ­¥ï¼Œé‚£ä¹ˆå°±å¾ˆæœ‰å¯èƒ½å­˜åœ¨ã€Œç¬¬ä¸€æ­¥æˆåŠŸã€ç¬¬äºŒæ­¥å¤±è´¥ã€çš„æƒ…å†µå‘ç”Ÿã€‚</p>
<p>è¿™ 2 ç§æ–¹æ¡ˆæˆ‘ä»¬ä¸€ä¸ªä¸ªæ¥åˆ†æã€‚</p>
<h3 id="1-å…ˆæ›´æ–°ç¼“å­˜ï¼Œåæ›´æ–°æ•°æ®åº“"><a href="#1-å…ˆæ›´æ–°ç¼“å­˜ï¼Œåæ›´æ–°æ•°æ®åº“" class="headerlink" title="1) å…ˆæ›´æ–°ç¼“å­˜ï¼Œåæ›´æ–°æ•°æ®åº“"></a>1) å…ˆæ›´æ–°ç¼“å­˜ï¼Œåæ›´æ–°æ•°æ®åº“</h3><p>å¦‚æœç¼“å­˜æ›´æ–°æˆåŠŸäº†ï¼Œä½†æ•°æ®åº“æ›´æ–°å¤±è´¥ï¼Œé‚£ä¹ˆæ­¤æ—¶ç¼“å­˜ä¸­æ˜¯æœ€æ–°å€¼ï¼Œä½†æ•°æ®åº“ä¸­æ˜¯ã€Œæ—§å€¼ã€ã€‚</p>
<p>è™½ç„¶æ­¤æ—¶è¯»è¯·æ±‚å¯ä»¥å‘½ä¸­ç¼“å­˜ï¼Œæ‹¿åˆ°æ­£ç¡®çš„å€¼ï¼Œä½†æ˜¯ï¼Œä¸€æ—¦ç¼“å­˜ã€Œå¤±æ•ˆã€ï¼Œå°±ä¼šä»æ•°æ®åº“ä¸­è¯»å–åˆ°ã€Œæ—§å€¼ã€ï¼Œé‡å»ºç¼“å­˜ä¹Ÿæ˜¯è¿™ä¸ªæ—§å€¼ã€‚</p>
<p>è¿™æ—¶ç”¨æˆ·ä¼šå‘ç°è‡ªå·±ä¹‹å‰ä¿®æ”¹çš„æ•°æ®åˆã€Œå˜å›å»ã€äº†ï¼Œå¯¹ä¸šåŠ¡é€ æˆå½±å“ã€‚</p>
<h3 id="2-å…ˆæ›´æ–°æ•°æ®åº“ï¼Œåæ›´æ–°ç¼“å­˜"><a href="#2-å…ˆæ›´æ–°æ•°æ®åº“ï¼Œåæ›´æ–°ç¼“å­˜" class="headerlink" title="2) å…ˆæ›´æ–°æ•°æ®åº“ï¼Œåæ›´æ–°ç¼“å­˜"></a>2) å…ˆæ›´æ–°æ•°æ®åº“ï¼Œåæ›´æ–°ç¼“å­˜</h3><p>å¦‚æœæ•°æ®åº“æ›´æ–°æˆåŠŸäº†ï¼Œä½†ç¼“å­˜æ›´æ–°å¤±è´¥ï¼Œé‚£ä¹ˆæ­¤æ—¶æ•°æ®åº“ä¸­æ˜¯æœ€æ–°å€¼ï¼Œç¼“å­˜ä¸­æ˜¯ã€Œæ—§å€¼ã€ã€‚</p>
<p>ä¹‹åçš„è¯»è¯·æ±‚è¯»åˆ°çš„éƒ½æ˜¯æ—§æ•°æ®ï¼Œåªæœ‰å½“ç¼“å­˜ã€Œå¤±æ•ˆã€åï¼Œæ‰èƒ½ä»æ•°æ®åº“ä¸­å¾—åˆ°æ­£ç¡®çš„å€¼ã€‚</p>
<p>è¿™æ—¶ç”¨æˆ·ä¼šå‘ç°ï¼Œè‡ªå·±åˆšåˆšä¿®æ”¹äº†æ•°æ®ï¼Œä½†å´çœ‹ä¸åˆ°å˜æ›´ï¼Œä¸€æ®µæ—¶é—´è¿‡åï¼Œæ•°æ®æ‰å˜æ›´è¿‡æ¥ï¼Œå¯¹ä¸šåŠ¡ä¹Ÿä¼šæœ‰å½±å“ã€‚</p>
<p>å¯è§ï¼Œæ— è®ºè°å…ˆè°åï¼Œä½†å‡¡åè€…å‘ç”Ÿå¼‚å¸¸ï¼Œå°±ä¼šå¯¹ä¸šåŠ¡é€ æˆå½±å“ã€‚é‚£æ€ä¹ˆè§£å†³è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿ</p>
<p>åˆ«æ€¥ï¼Œåé¢æˆ‘ä¼šè¯¦ç»†ç»™å‡ºå¯¹åº”çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<p>æˆ‘ä»¬ç»§ç»­åˆ†æï¼Œé™¤äº†æ“ä½œå¤±è´¥é—®é¢˜ï¼Œè¿˜æœ‰ä»€ä¹ˆåœºæ™¯ä¼šå½±å“æ•°æ®ä¸€è‡´æ€§ï¼Ÿ</p>
<p>è¿™é‡Œæˆ‘ä»¬è¿˜éœ€è¦é‡ç‚¹å…³æ³¨ï¼šå¹¶å‘é—®é¢˜ã€‚</p>
<h2 id="å¹¶å‘å¼•å‘çš„ä¸€è‡´æ€§é—®é¢˜"><a href="#å¹¶å‘å¼•å‘çš„ä¸€è‡´æ€§é—®é¢˜" class="headerlink" title="å¹¶å‘å¼•å‘çš„ä¸€è‡´æ€§é—®é¢˜"></a>å¹¶å‘å¼•å‘çš„ä¸€è‡´æ€§é—®é¢˜</h2><p>å‡è®¾æˆ‘ä»¬é‡‡ç”¨ã€Œå…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†æ›´æ–°ç¼“å­˜ã€çš„æ–¹æ¡ˆï¼Œå¹¶ä¸”ä¸¤æ­¥éƒ½å¯ä»¥ã€ŒæˆåŠŸæ‰§è¡Œã€çš„å‰æä¸‹ï¼Œå¦‚æœå­˜åœ¨å¹¶å‘ï¼Œæƒ…å†µä¼šæ˜¯æ€æ ·çš„å‘¢ï¼Ÿ</p>
<p>æœ‰çº¿ç¨‹ A å’Œçº¿ç¨‹ B ä¸¤ä¸ªçº¿ç¨‹ï¼Œéœ€è¦æ›´æ–°ã€ŒåŒä¸€æ¡ã€æ•°æ®ï¼Œä¼šå‘ç”Ÿè¿™æ ·çš„åœºæ™¯ï¼š</p>
<ol>
<li>çº¿ç¨‹ A æ›´æ–°æ•°æ®åº“ï¼ˆX = 1ï¼‰</li>
<li>çº¿ç¨‹ B æ›´æ–°æ•°æ®åº“ï¼ˆX = 2ï¼‰</li>
<li>çº¿ç¨‹ B æ›´æ–°ç¼“å­˜ï¼ˆX = 2ï¼‰</li>
<li>çº¿ç¨‹ A æ›´æ–°ç¼“å­˜ï¼ˆX = 1ï¼‰<br>æœ€ç»ˆ X çš„å€¼åœ¨ç¼“å­˜ä¸­æ˜¯ 1ï¼Œåœ¨æ•°æ®åº“ä¸­æ˜¯ 2ï¼Œå‘ç”Ÿä¸ä¸€è‡´ã€‚</li>
</ol>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼ŒA è™½ç„¶å…ˆäº B å‘ç”Ÿï¼Œä½† B æ“ä½œæ•°æ®åº“å’Œç¼“å­˜çš„æ—¶é—´ï¼Œå´è¦æ¯” A çš„æ—¶é—´çŸ­ï¼Œæ‰§è¡Œæ—¶åºå‘ç”Ÿã€Œé”™ä¹±ã€ï¼Œæœ€ç»ˆè¿™æ¡æ•°æ®ç»“æœæ˜¯ä¸ç¬¦åˆé¢„æœŸçš„ã€‚</p>
<blockquote>
<p>åŒæ ·åœ°ï¼Œé‡‡ç”¨ã€Œå…ˆæ›´æ–°ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“ã€çš„æ–¹æ¡ˆï¼Œä¹Ÿä¼šæœ‰ç±»ä¼¼é—®é¢˜ï¼Œè¿™é‡Œä¸å†è¯¦è¿°ã€‚</p>
</blockquote>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬ä»ã€Œç¼“å­˜åˆ©ç”¨ç‡ã€çš„è§’åº¦æ¥è¯„ä¼°è¿™ä¸ªæ–¹æ¡ˆï¼Œä¹Ÿæ˜¯ä¸å¤ªæ¨èçš„ã€‚</p>
<p>è¿™æ˜¯å› ä¸ºæ¯æ¬¡æ•°æ®å‘ç”Ÿå˜æ›´ï¼Œéƒ½ã€Œæ— è„‘ã€æ›´æ–°ç¼“å­˜ï¼Œä½†æ˜¯ç¼“å­˜ä¸­çš„æ•°æ®ä¸ä¸€å®šä¼šè¢«ã€Œé©¬ä¸Šè¯»å–ã€ï¼Œè¿™å°±ä¼šå¯¼è‡´ç¼“å­˜ä¸­å¯èƒ½å­˜æ”¾äº†å¾ˆå¤šä¸å¸¸è®¿é—®çš„æ•°æ®ï¼Œæµªè´¹ç¼“å­˜èµ„æºã€‚</p>
<p>è€Œä¸”å¾ˆå¤šæƒ…å†µä¸‹ï¼Œå†™åˆ°ç¼“å­˜ä¸­çš„å€¼ï¼Œå¹¶ä¸æ˜¯ä¸æ•°æ®åº“ä¸­çš„å€¼ä¸€ä¸€å¯¹åº”çš„ï¼Œå¾ˆæœ‰å¯èƒ½æ˜¯å…ˆæŸ¥è¯¢æ•°æ®åº“ï¼Œå†ç»è¿‡ä¸€ç³»åˆ—ã€Œè®¡ç®—ã€å¾—å‡ºä¸€ä¸ªå€¼ï¼Œæ‰æŠŠè¿™ä¸ªå€¼æ‰å†™åˆ°ç¼“å­˜ä¸­ã€‚</p>
<p>ç”±æ­¤å¯è§ï¼Œè¿™ç§ã€Œæ›´æ–°æ•°æ®åº“ + æ›´æ–°ç¼“å­˜ã€çš„æ–¹æ¡ˆï¼Œä¸ä»…ç¼“å­˜åˆ©ç”¨ç‡ä¸é«˜ï¼Œè¿˜ä¼šé€ æˆæœºå™¨æ€§èƒ½çš„æµªè´¹ã€‚</p>
<p>æ‰€ä»¥æ­¤æ—¶æˆ‘ä»¬éœ€è¦è€ƒè™‘å¦å¤–ä¸€ç§æ–¹æ¡ˆï¼šåˆ é™¤ç¼“å­˜ã€‚</p>
<h2 id="åˆ é™¤ç¼“å­˜å¯ä»¥ä¿è¯ä¸€è‡´æ€§å—ï¼Ÿ"><a href="#åˆ é™¤ç¼“å­˜å¯ä»¥ä¿è¯ä¸€è‡´æ€§å—ï¼Ÿ" class="headerlink" title="åˆ é™¤ç¼“å­˜å¯ä»¥ä¿è¯ä¸€è‡´æ€§å—ï¼Ÿ"></a>åˆ é™¤ç¼“å­˜å¯ä»¥ä¿è¯ä¸€è‡´æ€§å—ï¼Ÿ</h2><p>åˆ é™¤ç¼“å­˜å¯¹åº”çš„æ–¹æ¡ˆä¹Ÿæœ‰ 2 ç§ï¼š</p>
<ol>
<li>å…ˆåˆ é™¤ç¼“å­˜ï¼Œåæ›´æ–°æ•°æ®åº“</li>
<li>å…ˆæ›´æ–°æ•°æ®åº“ï¼Œååˆ é™¤ç¼“å­˜<br>ç»è¿‡å‰é¢çš„åˆ†ææˆ‘ä»¬å·²ç»å¾—çŸ¥ï¼Œä½†å‡¡ã€Œç¬¬äºŒæ­¥ã€æ“ä½œå¤±è´¥ï¼Œéƒ½ä¼šå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚</li>
</ol>
<p>è¿™é‡Œæˆ‘ä¸å†è¯¦è¿°å…·ä½“åœºæ™¯ï¼Œä½ å¯ä»¥æŒ‰ç…§å‰é¢çš„æ€è·¯æ¨æ¼”ä¸€ä¸‹ï¼Œå°±å¯ä»¥çœ‹åˆ°ä¾æ—§å­˜åœ¨æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µã€‚</p>
<p>è¿™é‡Œæˆ‘ä»¬é‡ç‚¹æ¥çœ‹ã€Œå¹¶å‘ã€é—®é¢˜</p>
<h3 id="1-å…ˆåˆ é™¤ç¼“å­˜ï¼Œåæ›´æ–°æ•°æ®åº“"><a href="#1-å…ˆåˆ é™¤ç¼“å­˜ï¼Œåæ›´æ–°æ•°æ®åº“" class="headerlink" title="1) å…ˆåˆ é™¤ç¼“å­˜ï¼Œåæ›´æ–°æ•°æ®åº“"></a>1) å…ˆåˆ é™¤ç¼“å­˜ï¼Œåæ›´æ–°æ•°æ®åº“</h3><p>å¦‚æœæœ‰ 2 ä¸ªçº¿ç¨‹è¦å¹¶å‘ã€Œè¯»å†™ã€æ•°æ®ï¼Œå¯èƒ½ä¼šå‘ç”Ÿä»¥ä¸‹åœºæ™¯ï¼š</p>
<ol>
<li>çº¿ç¨‹ A è¦æ›´æ–° X = 2ï¼ˆåŸå€¼ X = 1ï¼‰</li>
<li>çº¿ç¨‹ A å…ˆåˆ é™¤ç¼“å­˜</li>
<li>çº¿ç¨‹ B è¯»ç¼“å­˜ï¼Œå‘ç°ä¸å­˜åœ¨ï¼Œä»æ•°æ®åº“ä¸­è¯»å–åˆ°æ—§å€¼ï¼ˆX = 1ï¼‰</li>
<li>çº¿ç¨‹ A å°†æ–°å€¼å†™å…¥æ•°æ®åº“ï¼ˆX = 2ï¼‰</li>
<li>çº¿ç¨‹ B å°†æ—§å€¼å†™å…¥ç¼“å­˜ï¼ˆX = 1ï¼‰<br>æœ€ç»ˆ X çš„å€¼åœ¨ç¼“å­˜ä¸­æ˜¯ 1ï¼ˆæ—§å€¼ï¼‰ï¼Œåœ¨æ•°æ®åº“ä¸­æ˜¯ 2ï¼ˆæ–°å€¼ï¼‰ï¼Œå‘ç”Ÿä¸ä¸€è‡´ã€‚</li>
</ol>
<p>å¯è§ï¼Œå…ˆåˆ é™¤ç¼“å­˜ï¼Œåæ›´æ–°æ•°æ®åº“ï¼Œå½“å‘ç”Ÿã€Œè¯»+å†™ã€å¹¶å‘æ—¶ï¼Œè¿˜æ˜¯å­˜åœ¨æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µã€‚</p>
<h3 id="2-å…ˆæ›´æ–°æ•°æ®åº“ï¼Œååˆ é™¤ç¼“å­˜"><a href="#2-å…ˆæ›´æ–°æ•°æ®åº“ï¼Œååˆ é™¤ç¼“å­˜" class="headerlink" title="2) å…ˆæ›´æ–°æ•°æ®åº“ï¼Œååˆ é™¤ç¼“å­˜"></a>2) å…ˆæ›´æ–°æ•°æ®åº“ï¼Œååˆ é™¤ç¼“å­˜</h3><p>ä¾æ—§æ˜¯ 2 ä¸ªçº¿ç¨‹å¹¶å‘ã€Œè¯»å†™ã€æ•°æ®ï¼š</p>
<ol>
<li>ç¼“å­˜ä¸­ X ä¸å­˜åœ¨ï¼ˆæ•°æ®åº“ X = 1ï¼‰</li>
<li>çº¿ç¨‹ A è¯»å–æ•°æ®åº“ï¼Œå¾—åˆ°æ—§å€¼ï¼ˆX = 1ï¼‰</li>
<li>çº¿ç¨‹ B æ›´æ–°æ•°æ®åº“ï¼ˆX = 2)</li>
<li>çº¿ç¨‹ B åˆ é™¤ç¼“å­˜</li>
<li>çº¿ç¨‹ A å°†æ—§å€¼å†™å…¥ç¼“å­˜ï¼ˆX = 1ï¼‰<br>æœ€ç»ˆ X çš„å€¼åœ¨ç¼“å­˜ä¸­æ˜¯ 1ï¼ˆæ—§å€¼ï¼‰ï¼Œåœ¨æ•°æ®åº“ä¸­æ˜¯ 2ï¼ˆæ–°å€¼ï¼‰ï¼Œä¹Ÿå‘ç”Ÿä¸ä¸€è‡´ã€‚</li>
</ol>
<p>è¿™ç§æƒ…å†µã€Œç†è®ºã€æ¥è¯´æ˜¯å¯èƒ½å‘ç”Ÿçš„ï¼Œä½†å®é™…çœŸçš„æœ‰å¯èƒ½å‘ç”Ÿå—ï¼Ÿ</p>
<p>å…¶å®æ¦‚ç‡ã€Œå¾ˆä½ã€ï¼Œè¿™æ˜¯å› ä¸ºå®ƒå¿…é¡»æ»¡è¶³ 3 ä¸ªæ¡ä»¶ï¼š</p>
<ol>
<li>ç¼“å­˜åˆšå¥½å·²å¤±æ•ˆ</li>
<li>è¯»è¯·æ±‚ + å†™è¯·æ±‚å¹¶å‘</li>
<li>æ›´æ–°æ•°æ®åº“ + åˆ é™¤ç¼“å­˜çš„æ—¶é—´ï¼ˆæ­¥éª¤ 3-4ï¼‰ï¼Œè¦æ¯”è¯»æ•°æ®åº“ + å†™ç¼“å­˜æ—¶é—´çŸ­ï¼ˆæ­¥éª¤ 2 å’Œ 5ï¼‰<br>ä»”ç»†æƒ³ä¸€ä¸‹ï¼Œæ¡ä»¶ 3 å‘ç”Ÿçš„æ¦‚ç‡å…¶å®æ˜¯éå¸¸ä½çš„ã€‚</li>
</ol>
<p>å› ä¸ºå†™æ•°æ®åº“ä¸€èˆ¬ä¼šå…ˆã€ŒåŠ é”ã€ï¼Œæ‰€ä»¥å†™æ•°æ®åº“ï¼Œé€šå¸¸æ˜¯è¦æ¯”è¯»æ•°æ®åº“çš„æ—¶é—´æ›´é•¿çš„ã€‚</p>
<p>è¿™ä¹ˆæ¥çœ‹ï¼Œã€Œå…ˆæ›´æ–°æ•°æ®åº“ + å†åˆ é™¤ç¼“å­˜ã€çš„æ–¹æ¡ˆï¼Œæ˜¯å¯ä»¥ä¿è¯æ•°æ®ä¸€è‡´æ€§çš„ã€‚</p>
<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬åº”è¯¥é‡‡ç”¨è¿™ç§æ–¹æ¡ˆï¼Œæ¥æ“ä½œæ•°æ®åº“å’Œç¼“å­˜ã€‚</p>
<p>å¥½ï¼Œè§£å†³äº†å¹¶å‘é—®é¢˜ï¼Œæˆ‘ä»¬ç»§ç»­æ¥çœ‹å‰é¢é—ç•™çš„ï¼Œç¬¬äºŒæ­¥æ‰§è¡Œã€Œå¤±è´¥ã€å¯¼è‡´æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚</p>
<h2 id="å¦‚ä½•ä¿è¯ä¸¤æ­¥éƒ½æ‰§è¡ŒæˆåŠŸï¼Ÿ"><a href="#å¦‚ä½•ä¿è¯ä¸¤æ­¥éƒ½æ‰§è¡ŒæˆåŠŸï¼Ÿ" class="headerlink" title="å¦‚ä½•ä¿è¯ä¸¤æ­¥éƒ½æ‰§è¡ŒæˆåŠŸï¼Ÿ"></a>å¦‚ä½•ä¿è¯ä¸¤æ­¥éƒ½æ‰§è¡ŒæˆåŠŸï¼Ÿ</h2><p>å‰é¢æˆ‘ä»¬åˆ†æåˆ°ï¼Œæ— è®ºæ˜¯æ›´æ–°ç¼“å­˜è¿˜æ˜¯åˆ é™¤ç¼“å­˜ï¼Œåªè¦ç¬¬äºŒæ­¥å‘ç”Ÿå¤±è´¥ï¼Œé‚£ä¹ˆå°±ä¼šå¯¼è‡´æ•°æ®åº“å’Œç¼“å­˜ä¸ä¸€è‡´ã€‚</p>
<p>ä¿è¯ç¬¬äºŒæ­¥æˆåŠŸæ‰§è¡Œï¼Œå°±æ˜¯è§£å†³é—®é¢˜çš„å…³é”®ã€‚</p>
<p>æƒ³ä¸€ä¸‹ï¼Œç¨‹åºåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿå¼‚å¸¸ï¼Œæœ€ç®€å•çš„è§£å†³åŠæ³•æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>ç­”æ¡ˆæ˜¯ï¼šé‡è¯•ã€‚</p>
<p>æ˜¯çš„ï¼Œå…¶å®è¿™é‡Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è¿™æ ·åšã€‚</p>
<p>æ— è®ºæ˜¯å…ˆæ“ä½œç¼“å­˜ï¼Œè¿˜æ˜¯å…ˆæ“ä½œæ•°æ®åº“ï¼Œä½†å‡¡åè€…æ‰§è¡Œå¤±è´¥äº†ï¼Œæˆ‘ä»¬å°±å¯ä»¥å‘èµ·é‡è¯•ï¼Œå°½å¯èƒ½åœ°å»åšã€Œè¡¥å¿ã€ã€‚</p>
<p>é‚£è¿™æ˜¯ä¸æ˜¯æ„å‘³ç€ï¼Œåªè¦æ‰§è¡Œå¤±è´¥ï¼Œæˆ‘ä»¬ã€Œæ— è„‘é‡è¯•ã€å°±å¯ä»¥äº†å‘¢ï¼Ÿ</p>
<p>ç­”æ¡ˆæ˜¯å¦å®šçš„ã€‚ç°å®æƒ…å†µå¾€å¾€æ²¡æœ‰æƒ³çš„è¿™ä¹ˆç®€å•ï¼Œå¤±è´¥åç«‹å³é‡è¯•çš„é—®é¢˜åœ¨äºï¼š</p>
<ul>
<li>ç«‹å³é‡è¯•å¾ˆå¤§æ¦‚ç‡ã€Œè¿˜ä¼šå¤±è´¥ã€</li>
<li>ã€Œé‡è¯•æ¬¡æ•°ã€è®¾ç½®å¤šå°‘æ‰åˆç†ï¼Ÿ</li>
<li>é‡è¯•ä¼šä¸€ç›´ã€Œå ç”¨ã€è¿™ä¸ªçº¿ç¨‹èµ„æºï¼Œæ— æ³•æœåŠ¡å…¶å®ƒå®¢æˆ·ç«¯è¯·æ±‚<br>çœ‹åˆ°äº†ä¹ˆï¼Œè™½ç„¶æˆ‘ä»¬æƒ³é€šè¿‡é‡è¯•çš„æ–¹å¼è§£å†³é—®é¢˜ï¼Œä½†è¿™ç§ã€ŒåŒæ­¥ã€é‡è¯•çš„æ–¹æ¡ˆä¾æ—§ä¸ä¸¥è°¨ã€‚</li>
</ul>
<p>é‚£æ›´å¥½çš„æ–¹æ¡ˆåº”è¯¥æ€ä¹ˆåšï¼Ÿ</p>
<p>ç­”æ¡ˆæ˜¯ï¼šå¼‚æ­¥é‡è¯•ã€‚ä»€ä¹ˆæ˜¯å¼‚æ­¥é‡è¯•ï¼Ÿ</p>
<p>å…¶å®å°±æ˜¯æŠŠé‡è¯•è¯·æ±‚å†™åˆ°ã€Œæ¶ˆæ¯é˜Ÿåˆ—ã€ä¸­ï¼Œç„¶åç”±ä¸“é—¨çš„æ¶ˆè´¹è€…æ¥é‡è¯•ï¼Œç›´åˆ°æˆåŠŸã€‚</p>
<p>æˆ–è€…æ›´ç›´æ¥çš„åšæ³•ï¼Œä¸ºäº†é¿å…ç¬¬äºŒæ­¥æ‰§è¡Œå¤±è´¥ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ“ä½œç¼“å­˜è¿™ä¸€æ­¥ï¼Œç›´æ¥æ”¾åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œç”±æ¶ˆè´¹è€…æ¥æ“ä½œç¼“å­˜ã€‚</p>
<p>åˆ°è¿™é‡Œä½ å¯èƒ½ä¼šé—®ï¼Œå†™æ¶ˆæ¯é˜Ÿåˆ—ä¹Ÿæœ‰å¯èƒ½ä¼šå¤±è´¥å•Šï¼Ÿè€Œä¸”ï¼Œå¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—ï¼Œè¿™åˆå¢åŠ äº†æ›´å¤šçš„ç»´æŠ¤æˆæœ¬ï¼Œè¿™æ ·åšå€¼å¾—å—ï¼Ÿ<br>è¿™ä¸ªé—®é¢˜å¾ˆå¥½ï¼Œä½†æˆ‘ä»¬æ€è€ƒè¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼šå¦‚æœåœ¨æ‰§è¡Œå¤±è´¥çš„çº¿ç¨‹ä¸­ä¸€ç›´é‡è¯•ï¼Œè¿˜æ²¡ç­‰æ‰§è¡ŒæˆåŠŸï¼Œæ­¤æ—¶å¦‚æœé¡¹ç›®ã€Œé‡å¯ã€äº†ï¼Œé‚£è¿™æ¬¡é‡è¯•è¯·æ±‚ä¹Ÿå°±ã€Œä¸¢å¤±ã€äº†ï¼Œé‚£è¿™æ¡æ•°æ®å°±ä¸€ç›´ä¸ä¸€è‡´äº†ã€‚</p>
<p>æ‰€ä»¥ï¼Œè¿™é‡Œæˆ‘ä»¬å¿…é¡»æŠŠé‡è¯•æˆ–ç¬¬äºŒæ­¥æ“ä½œæ”¾åˆ°å¦ä¸€ä¸ªã€ŒæœåŠ¡ã€ä¸­ï¼Œè¿™ä¸ªæœåŠ¡ç”¨ã€Œæ¶ˆæ¯é˜Ÿåˆ—ã€æœ€ä¸ºåˆé€‚ã€‚è¿™æ˜¯å› ä¸ºæ¶ˆæ¯é˜Ÿåˆ—çš„ç‰¹æ€§ï¼Œæ­£å¥½ç¬¦åˆæˆ‘ä»¬çš„éœ€æ±‚ï¼š</p>
<ul>
<li><p>æ¶ˆæ¯é˜Ÿåˆ—ä¿è¯å¯é æ€§ï¼šå†™åˆ°é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ï¼ŒæˆåŠŸæ¶ˆè´¹ä¹‹å‰ä¸ä¼šä¸¢å¤±ï¼ˆé‡å¯é¡¹ç›®ä¹Ÿä¸æ‹…å¿ƒï¼‰</p>
</li>
<li><p>æ¶ˆæ¯é˜Ÿåˆ—ä¿è¯æ¶ˆæ¯æˆåŠŸæŠ•é€’ï¼šä¸‹æ¸¸ä»é˜Ÿåˆ—æ‹‰å–æ¶ˆæ¯ï¼ŒæˆåŠŸæ¶ˆè´¹åæ‰ä¼šåˆ é™¤æ¶ˆæ¯ï¼Œå¦åˆ™è¿˜ä¼šç»§ç»­æŠ•é€’æ¶ˆæ¯ç»™æ¶ˆè´¹è€…ï¼ˆç¬¦åˆæˆ‘ä»¬é‡è¯•çš„åœºæ™¯ï¼‰<br>è‡³äºå†™é˜Ÿåˆ—å¤±è´¥å’Œæ¶ˆæ¯é˜Ÿåˆ—çš„ç»´æŠ¤æˆæœ¬é—®é¢˜ï¼š</p>
</li>
<li><p>å†™é˜Ÿåˆ—å¤±è´¥ï¼šæ“ä½œç¼“å­˜å’Œå†™æ¶ˆæ¯é˜Ÿåˆ—ï¼Œã€ŒåŒæ—¶å¤±è´¥ã€çš„æ¦‚ç‡å…¶å®æ˜¯å¾ˆå°çš„</p>
</li>
<li><p>ç»´æŠ¤æˆæœ¬ï¼šæˆ‘ä»¬é¡¹ç›®ä¸­ä¸€èˆ¬éƒ½ä¼šç”¨åˆ°æ¶ˆæ¯é˜Ÿåˆ—ï¼Œç»´æŠ¤æˆæœ¬å¹¶æ²¡æœ‰æ–°å¢å¾ˆå¤š<br>æ‰€ä»¥ï¼Œå¼•å…¥æ¶ˆæ¯é˜Ÿåˆ—æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ˜¯æ¯”è¾ƒåˆé€‚çš„ã€‚è¿™æ—¶æ¶æ„æ¨¡å‹å°±å˜æˆäº†è¿™æ ·ï¼š</p>
</li>
</ul>
<p><img src="/2022/07/04/uncatalog/cl58235q80000ikr72lnvg3qt/6404.jpg" alt="img"></p>
<p>é‚£å¦‚æœä½ ç¡®å®ä¸æƒ³åœ¨åº”ç”¨ä¸­å»å†™æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ˜¯å¦æœ‰æ›´ç®€å•çš„æ–¹æ¡ˆï¼ŒåŒæ—¶åˆå¯ä»¥ä¿è¯ä¸€è‡´æ€§å‘¢ï¼Ÿ</p>
<p>æ–¹æ¡ˆè¿˜æ˜¯æœ‰çš„ï¼Œè¿™å°±æ˜¯è¿‘å‡ å¹´æ¯”è¾ƒæµè¡Œçš„è§£å†³æ–¹æ¡ˆï¼šè®¢é˜…æ•°æ®åº“å˜æ›´æ—¥å¿—ï¼Œå†æ“ä½œç¼“å­˜ã€‚</p>
<p>å…·ä½“æ¥è®²å°±æ˜¯ï¼Œæˆ‘ä»¬çš„ä¸šåŠ¡åº”ç”¨åœ¨ä¿®æ”¹æ•°æ®æ—¶ï¼Œã€Œåªéœ€ã€ä¿®æ”¹æ•°æ®åº“ï¼Œæ— éœ€æ“ä½œç¼“å­˜ã€‚</p>
<p>é‚£ä»€ä¹ˆæ—¶å€™æ“ä½œç¼“å­˜å‘¢ï¼Ÿè¿™å°±å’Œæ•°æ®åº“çš„ã€Œå˜æ›´æ—¥å¿—ã€æœ‰å…³äº†ã€‚</p>
<p>æ‹¿ MySQL ä¸¾ä¾‹ï¼Œå½“ä¸€æ¡æ•°æ®å‘ç”Ÿä¿®æ”¹æ—¶ï¼ŒMySQL å°±ä¼šäº§ç”Ÿä¸€æ¡å˜æ›´æ—¥å¿—ï¼ˆBinlogï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥è®¢é˜…è¿™ä¸ªæ—¥å¿—ï¼Œæ‹¿åˆ°å…·ä½“æ“ä½œçš„æ•°æ®ï¼Œç„¶åå†æ ¹æ®è¿™æ¡æ•°æ®ï¼Œå»åˆ é™¤å¯¹åº”çš„ç¼“å­˜ã€‚</p>
<p><img src="/2022/07/04/uncatalog/cl58235q80000ikr72lnvg3qt/6405.jpg" alt="img"></p>
<p>è®¢é˜…å˜æ›´æ—¥å¿—ï¼Œç›®å‰ä¹Ÿæœ‰äº†æ¯”è¾ƒæˆç†Ÿçš„å¼€æºä¸­é—´ä»¶ï¼Œä¾‹å¦‚é˜¿é‡Œçš„ canalï¼Œä½¿ç”¨è¿™ç§æ–¹æ¡ˆçš„ä¼˜ç‚¹åœ¨äºï¼š</p>
<ul>
<li>æ— éœ€è€ƒè™‘å†™æ¶ˆæ¯é˜Ÿåˆ—å¤±è´¥æƒ…å†µï¼šåªè¦å†™ MySQL æˆåŠŸï¼ŒBinlog è‚¯å®šä¼šæœ‰</li>
<li>è‡ªåŠ¨æŠ•é€’åˆ°ä¸‹æ¸¸é˜Ÿåˆ—ï¼šcanal è‡ªåŠ¨æŠŠæ•°æ®åº“å˜æ›´æ—¥å¿—ã€ŒæŠ•é€’ã€ç»™ä¸‹æ¸¸çš„æ¶ˆæ¯é˜Ÿåˆ—<br>å½“ç„¶ï¼Œä¸æ­¤åŒæ—¶ï¼Œæˆ‘ä»¬éœ€è¦æŠ•å…¥ç²¾åŠ›å»ç»´æŠ¤ canal çš„é«˜å¯ç”¨å’Œç¨³å®šæ€§ã€‚</li>
</ul>
<blockquote>
<p>å¦‚æœä½ æœ‰ç•™æ„è§‚å¯Ÿå¾ˆå¤šæ•°æ®åº“çš„ç‰¹æ€§ï¼Œå°±ä¼šå‘ç°å…¶å®å¾ˆå¤šæ•°æ®åº“éƒ½é€æ¸å¼€å§‹æä¾›ã€Œè®¢é˜…å˜æ›´æ—¥å¿—ã€çš„åŠŸèƒ½äº†ï¼Œç›¸ä¿¡ä¸è¿œçš„å°†æ¥ï¼Œæˆ‘ä»¬å°±ä¸ç”¨é€šè¿‡ä¸­é—´ä»¶æ¥æ‹‰å–æ—¥å¿—ï¼Œè‡ªå·±å†™ç¨‹åºå°±å¯ä»¥è®¢é˜…å˜æ›´æ—¥å¿—äº†ï¼Œè¿™æ ·å¯ä»¥è¿›ä¸€æ­¥ç®€åŒ–æµç¨‹ã€‚</p>
</blockquote>
<p>è‡³æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºç»“è®ºï¼Œæƒ³è¦ä¿è¯æ•°æ®åº“å’Œç¼“å­˜ä¸€è‡´æ€§ï¼Œæ¨èé‡‡ç”¨ã€Œå…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜ã€æ–¹æ¡ˆï¼Œå¹¶é…åˆã€Œæ¶ˆæ¯é˜Ÿåˆ—ã€æˆ–ã€Œè®¢é˜…å˜æ›´æ—¥å¿—ã€çš„æ–¹å¼æ¥åšã€‚</p>
<h2 id="ä¸»ä»åº“å»¶è¿Ÿå’Œå»¶è¿ŸåŒåˆ é—®é¢˜"><a href="#ä¸»ä»åº“å»¶è¿Ÿå’Œå»¶è¿ŸåŒåˆ é—®é¢˜" class="headerlink" title="ä¸»ä»åº“å»¶è¿Ÿå’Œå»¶è¿ŸåŒåˆ é—®é¢˜"></a>ä¸»ä»åº“å»¶è¿Ÿå’Œå»¶è¿ŸåŒåˆ é—®é¢˜</h2><p>åˆ°è¿™é‡Œï¼Œè¿˜æœ‰ 2 ä¸ªé—®é¢˜ï¼Œæ˜¯æˆ‘ä»¬æ²¡æœ‰é‡ç‚¹åˆ†æè¿‡çš„ã€‚</p>
<p>ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œè¿˜è®°å¾—å‰é¢è®²åˆ°çš„ã€Œå…ˆåˆ é™¤ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“ã€æ–¹æ¡ˆï¼Œå¯¼è‡´ä¸ä¸€è‡´çš„åœºæ™¯ä¹ˆï¼Ÿ</p>
<p>è¿™é‡Œæˆ‘å†æŠŠä¾‹å­æ‹¿è¿‡æ¥è®©ä½ å¤ä¹ ä¸€ä¸‹ï¼š</p>
<p>2 ä¸ªçº¿ç¨‹è¦å¹¶å‘ã€Œè¯»å†™ã€æ•°æ®ï¼Œå¯èƒ½ä¼šå‘ç”Ÿä»¥ä¸‹åœºæ™¯ï¼š</p>
<ol>
<li>çº¿ç¨‹ A è¦æ›´æ–° X = 2ï¼ˆåŸå€¼ X = 1ï¼‰</li>
<li>çº¿ç¨‹ A å…ˆåˆ é™¤ç¼“å­˜</li>
<li>çº¿ç¨‹ B è¯»ç¼“å­˜ï¼Œå‘ç°ä¸å­˜åœ¨ï¼Œä»æ•°æ®åº“ä¸­è¯»å–åˆ°æ—§å€¼ï¼ˆX = 1ï¼‰</li>
<li>çº¿ç¨‹ A å°†æ–°å€¼å†™å…¥æ•°æ®åº“ï¼ˆX = 2ï¼‰</li>
<li>çº¿ç¨‹ B å°†æ—§å€¼å†™å…¥ç¼“å­˜ï¼ˆX = 1ï¼‰<br>æœ€ç»ˆ X çš„å€¼åœ¨ç¼“å­˜ä¸­æ˜¯ 1ï¼ˆæ—§å€¼ï¼‰ï¼Œåœ¨æ•°æ®åº“ä¸­æ˜¯ 2ï¼ˆæ–°å€¼ï¼‰ï¼Œå‘ç”Ÿä¸ä¸€è‡´ã€‚</li>
</ol>
<p>ç¬¬äºŒä¸ªé—®é¢˜ï¼šæ˜¯å…³äºã€Œè¯»å†™åˆ†ç¦» + ä¸»ä»å¤åˆ¶å»¶è¿Ÿã€æƒ…å†µä¸‹ï¼Œç¼“å­˜å’Œæ•°æ®åº“ä¸€è‡´æ€§çš„é—®é¢˜ã€‚</p>
<p>åœ¨ã€Œå…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜ã€æ–¹æ¡ˆä¸‹ï¼Œã€Œè¯»å†™åˆ†ç¦» + ä¸»ä»åº“å»¶è¿Ÿã€å…¶å®ä¹Ÿä¼šå¯¼è‡´ä¸ä¸€è‡´ï¼š</p>
<ol>
<li>çº¿ç¨‹ A æ›´æ–°ä¸»åº“ X = 2ï¼ˆåŸå€¼ X = 1ï¼‰</li>
<li>çº¿ç¨‹ A åˆ é™¤ç¼“å­˜</li>
<li>çº¿ç¨‹ B æŸ¥è¯¢ç¼“å­˜ï¼Œæ²¡æœ‰å‘½ä¸­ï¼ŒæŸ¥è¯¢ã€Œä»åº“ã€å¾—åˆ°æ—§å€¼ï¼ˆä»åº“ X = 1ï¼‰</li>
<li>ä»åº“ã€ŒåŒæ­¥ã€å®Œæˆï¼ˆä¸»ä»åº“ X = 2ï¼‰</li>
<li>çº¿ç¨‹ B å°†ã€Œæ—§å€¼ã€å†™å…¥ç¼“å­˜ï¼ˆX = 1ï¼‰<br>æœ€ç»ˆ X çš„å€¼åœ¨ç¼“å­˜ä¸­æ˜¯ 1ï¼ˆæ—§å€¼ï¼‰ï¼Œåœ¨ä¸»ä»åº“ä¸­æ˜¯ 2ï¼ˆæ–°å€¼ï¼‰ï¼Œä¹Ÿå‘ç”Ÿä¸ä¸€è‡´ã€‚</li>
</ol>
<p>çœ‹åˆ°äº†ä¹ˆï¼Ÿè¿™ 2 ä¸ªé—®é¢˜çš„æ ¸å¿ƒåœ¨äºï¼šç¼“å­˜éƒ½è¢«å›ç§äº†ã€Œæ—§å€¼ã€ã€‚</p>
<p>é‚£æ€ä¹ˆè§£å†³è¿™ç±»é—®é¢˜å‘¢ï¼Ÿ</p>
<p>æœ€æœ‰æ•ˆçš„åŠæ³•å°±æ˜¯ï¼ŒæŠŠç¼“å­˜åˆ æ‰ã€‚</p>
<p>ä½†æ˜¯ï¼Œä¸èƒ½ç«‹å³åˆ ï¼Œè€Œæ˜¯éœ€è¦ã€Œå»¶è¿Ÿåˆ ã€ï¼Œè¿™å°±æ˜¯ä¸šç•Œç»™å‡ºçš„æ–¹æ¡ˆï¼šç¼“å­˜å»¶è¿ŸåŒåˆ ç­–ç•¥ã€‚</p>
<p>æŒ‰ç…§å»¶æ—¶åŒåˆ ç­–ç•¥ï¼Œè¿™ 2 ä¸ªé—®é¢˜çš„è§£å†³æ–¹æ¡ˆæ˜¯è¿™æ ·çš„ï¼š</p>
<p>è§£å†³ç¬¬ä¸€ä¸ªé—®é¢˜ï¼šåœ¨çº¿ç¨‹ A åˆ é™¤ç¼“å­˜ã€æ›´æ–°å®Œæ•°æ®åº“ä¹‹åï¼Œå…ˆã€Œä¼‘çœ ä¸€ä¼šã€ï¼Œå†ã€Œåˆ é™¤ã€ä¸€æ¬¡ç¼“å­˜ã€‚</p>
<p>è§£å†³ç¬¬äºŒä¸ªé—®é¢˜ï¼šçº¿ç¨‹ A å¯ä»¥ç”Ÿæˆä¸€æ¡ã€Œå»¶æ—¶æ¶ˆæ¯ã€ï¼Œå†™åˆ°æ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œæ¶ˆè´¹è€…å»¶æ—¶ã€Œåˆ é™¤ã€ç¼“å­˜ã€‚</p>
<p>è¿™ä¸¤ä¸ªæ–¹æ¡ˆçš„ç›®çš„ï¼Œéƒ½æ˜¯ä¸ºäº†æŠŠç¼“å­˜æ¸…æ‰ï¼Œè¿™æ ·ä¸€æ¥ï¼Œä¸‹æ¬¡å°±å¯ä»¥ä»æ•°æ®åº“è¯»å–åˆ°æœ€æ–°å€¼ï¼Œå†™å…¥ç¼“å­˜ã€‚</p>
<p>ä½†é—®é¢˜æ¥äº†ï¼Œè¿™ä¸ªã€Œå»¶è¿Ÿåˆ é™¤ã€ç¼“å­˜ï¼Œå»¶è¿Ÿæ—¶é—´åˆ°åº•è®¾ç½®è¦å¤šä¹…å‘¢ï¼Ÿ</p>
<ul>
<li>é—®é¢˜1ï¼šå»¶è¿Ÿæ—¶é—´è¦å¤§äºã€Œä¸»ä»å¤åˆ¶ã€çš„å»¶è¿Ÿæ—¶é—´</li>
<li>é—®é¢˜2ï¼šå»¶è¿Ÿæ—¶é—´è¦å¤§äºçº¿ç¨‹ B è¯»å–æ•°æ®åº“ + å†™å…¥ç¼“å­˜çš„æ—¶é—´<br>ä½†æ˜¯ï¼Œè¿™ä¸ªæ—¶é—´åœ¨åˆ†å¸ƒå¼å’Œé«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œå…¶å®æ˜¯å¾ˆéš¾è¯„ä¼°çš„ã€‚</li>
</ul>
<p>å¾ˆå¤šæ—¶å€™ï¼Œæˆ‘ä»¬éƒ½æ˜¯å‡­å€Ÿç»éªŒå¤§è‡´ä¼°ç®—è¿™ä¸ªå»¶è¿Ÿæ—¶é—´ï¼Œä¾‹å¦‚å»¶è¿Ÿ 1-5sï¼Œåªèƒ½å°½å¯èƒ½åœ°é™ä½ä¸ä¸€è‡´çš„æ¦‚ç‡ã€‚</p>
<p>æ‰€ä»¥ä½ çœ‹ï¼Œé‡‡ç”¨è¿™ç§æ–¹æ¡ˆï¼Œä¹Ÿåªæ˜¯å°½å¯èƒ½ä¿è¯ä¸€è‡´æ€§è€Œå·²ï¼Œæç«¯æƒ…å†µä¸‹ï¼Œè¿˜æ˜¯æœ‰å¯èƒ½å‘ç”Ÿä¸ä¸€è‡´ã€‚</p>
<p>æ‰€ä»¥å®é™…ä½¿ç”¨ä¸­ï¼Œæˆ‘è¿˜æ˜¯å»ºè®®ä½ é‡‡ç”¨ã€Œå…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜ã€çš„æ–¹æ¡ˆï¼ŒåŒæ—¶ï¼Œè¦å°½å¯èƒ½åœ°ä¿è¯ã€Œä¸»ä»å¤åˆ¶ã€ä¸è¦æœ‰å¤ªå¤§å»¶è¿Ÿï¼Œé™ä½å‡ºé—®é¢˜çš„æ¦‚ç‡ã€‚</p>
<h2 id="å¯ä»¥åšåˆ°å¼ºä¸€è‡´å—ï¼Ÿ"><a href="#å¯ä»¥åšåˆ°å¼ºä¸€è‡´å—ï¼Ÿ" class="headerlink" title="å¯ä»¥åšåˆ°å¼ºä¸€è‡´å—ï¼Ÿ"></a>å¯ä»¥åšåˆ°å¼ºä¸€è‡´å—ï¼Ÿ</h2><p>çœ‹åˆ°è¿™é‡Œä½ å¯èƒ½ä¼šæƒ³ï¼Œè¿™äº›æ–¹æ¡ˆè¿˜æ˜¯ä¸å¤Ÿå®Œç¾ï¼Œæˆ‘å°±æƒ³è®©ç¼“å­˜å’Œæ•°æ®åº“ã€Œå¼ºä¸€è‡´ã€ï¼Œåˆ°åº•èƒ½ä¸èƒ½åšåˆ°å‘¢ï¼Ÿ</p>
<p>å…¶å®å¾ˆéš¾ã€‚</p>
<p>è¦æƒ³åšåˆ°å¼ºä¸€è‡´ï¼Œæœ€å¸¸è§çš„æ–¹æ¡ˆæ˜¯ 2PCã€3PCã€Paxosã€Raft è¿™ç±»ä¸€è‡´æ€§åè®®ï¼Œä½†å®ƒä»¬çš„æ€§èƒ½å¾€å¾€æ¯”è¾ƒå·®ï¼Œè€Œä¸”è¿™äº›æ–¹æ¡ˆä¹Ÿæ¯”è¾ƒå¤æ‚ï¼Œè¿˜è¦è€ƒè™‘å„ç§å®¹é”™é—®é¢˜ã€‚</p>
<p>ç›¸åï¼Œè¿™æ—¶æˆ‘ä»¬æ¢ä¸ªè§’åº¦æ€è€ƒä¸€ä¸‹ï¼Œæˆ‘ä»¬å¼•å…¥ç¼“å­˜çš„ç›®çš„æ˜¯ä»€ä¹ˆï¼Ÿ</p>
<p>æ²¡é”™ï¼Œæ€§èƒ½ã€‚</p>
<p>ä¸€æ—¦æˆ‘ä»¬å†³å®šä½¿ç”¨ç¼“å­˜ï¼Œé‚£å¿…ç„¶è¦é¢ä¸´ä¸€è‡´æ€§é—®é¢˜ã€‚æ€§èƒ½å’Œä¸€è‡´æ€§å°±åƒå¤©å¹³çš„ä¸¤ç«¯ï¼Œæ— æ³•åšåˆ°éƒ½æ»¡è¶³è¦æ±‚ã€‚</p>
<p>è€Œä¸”ï¼Œå°±æ‹¿æˆ‘ä»¬å‰é¢è®²åˆ°çš„æ–¹æ¡ˆæ¥è¯´ï¼Œå½“æ“ä½œæ•°æ®åº“å’Œç¼“å­˜å®Œæˆä¹‹å‰ï¼Œåªè¦æœ‰å…¶å®ƒè¯·æ±‚å¯ä»¥è¿›æ¥ï¼Œéƒ½æœ‰å¯èƒ½æŸ¥åˆ°ã€Œä¸­é—´çŠ¶æ€ã€çš„æ•°æ®ã€‚</p>
<p>æ‰€ä»¥å¦‚æœéè¦è¿½æ±‚å¼ºä¸€è‡´ï¼Œé‚£å¿…é¡»è¦æ±‚æ‰€æœ‰æ›´æ–°æ“ä½œå®Œæˆä¹‹å‰æœŸé—´ï¼Œä¸èƒ½æœ‰ã€Œä»»ä½•è¯·æ±‚ã€è¿›æ¥ã€‚</p>
<p>è™½ç„¶æˆ‘ä»¬å¯ä»¥é€šè¿‡åŠ ã€Œåˆ†å¸ƒé”ã€çš„æ–¹å¼æ¥å®ç°ï¼Œä½†æˆ‘ä»¬è¦ä»˜å‡ºçš„ä»£ä»·ï¼Œå¾ˆå¯èƒ½ä¼šè¶…è¿‡å¼•å…¥ç¼“å­˜å¸¦æ¥çš„æ€§èƒ½æå‡ã€‚</p>
<p>æ‰€ä»¥ï¼Œæ—¢ç„¶å†³å®šä½¿ç”¨ç¼“å­˜ï¼Œå°±å¿…é¡»å®¹å¿ã€Œä¸€è‡´æ€§ã€é—®é¢˜ï¼Œæˆ‘ä»¬åªèƒ½å°½å¯èƒ½åœ°å»é™ä½é—®é¢˜å‡ºç°çš„æ¦‚ç‡ã€‚</p>
<p>åŒæ—¶æˆ‘ä»¬ä¹Ÿè¦çŸ¥é“ï¼Œç¼“å­˜éƒ½æ˜¯æœ‰ã€Œå¤±æ•ˆæ—¶é—´ã€çš„ï¼Œå°±ç®—åœ¨è¿™æœŸé—´å­˜åœ¨çŸ­æœŸä¸ä¸€è‡´ï¼Œæˆ‘ä»¬ä¾æ—§æœ‰å¤±æ•ˆæ—¶é—´æ¥å…œåº•ï¼Œè¿™æ ·ä¹Ÿèƒ½è¾¾åˆ°æœ€ç»ˆä¸€è‡´ã€‚</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å¥½äº†ï¼Œæ€»ç»“ä¸€ä¸‹è¿™ç¯‡æ–‡ç« çš„é‡ç‚¹ã€‚</p>
<p>1ã€æƒ³è¦æé«˜åº”ç”¨çš„æ€§èƒ½ï¼Œå¯ä»¥å¼•å…¥ã€Œç¼“å­˜ã€æ¥è§£å†³</p>
<p>2ã€å¼•å…¥ç¼“å­˜åï¼Œéœ€è¦è€ƒè™‘ç¼“å­˜å’Œæ•°æ®åº“ä¸€è‡´æ€§é—®é¢˜ï¼Œå¯é€‰çš„æ–¹æ¡ˆæœ‰ï¼šã€Œæ›´æ–°æ•°æ®åº“ + æ›´æ–°ç¼“å­˜ã€ã€ã€Œæ›´æ–°æ•°æ®åº“ + åˆ é™¤ç¼“å­˜ã€</p>
<p>3ã€æ›´æ–°æ•°æ®åº“ + æ›´æ–°ç¼“å­˜æ–¹æ¡ˆï¼Œåœ¨ã€Œå¹¶å‘ã€åœºæ™¯ä¸‹æ— æ³•ä¿è¯ç¼“å­˜å’Œæ•°æ®ä¸€è‡´æ€§ï¼Œä¸”å­˜åœ¨ã€Œç¼“å­˜èµ„æºæµªè´¹ã€å’Œã€Œæœºå™¨æ€§èƒ½æµªè´¹ã€çš„æƒ…å†µå‘ç”Ÿ</p>
<p>4ã€åœ¨æ›´æ–°æ•°æ®åº“ + åˆ é™¤ç¼“å­˜çš„æ–¹æ¡ˆä¸­ï¼Œã€Œå…ˆåˆ é™¤ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“ã€åœ¨ã€Œå¹¶å‘ã€åœºæ™¯ä¸‹ä¾æ—§æœ‰æ•°æ®ä¸ä¸€è‡´é—®é¢˜ï¼Œè§£å†³æ–¹æ¡ˆæ˜¯ã€Œå»¶è¿ŸåŒåˆ ã€ï¼Œä½†è¿™ä¸ªå»¶è¿Ÿæ—¶é—´å¾ˆéš¾è¯„ä¼°ï¼Œæ‰€ä»¥æ¨èç”¨ã€Œå…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜ã€çš„æ–¹æ¡ˆ</p>
<p>5ã€åœ¨ã€Œå…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜ã€æ–¹æ¡ˆä¸‹ï¼Œä¸ºäº†ä¿è¯ä¸¤æ­¥éƒ½æˆåŠŸæ‰§è¡Œï¼Œéœ€é…åˆã€Œæ¶ˆæ¯é˜Ÿåˆ—ã€æˆ–ã€Œè®¢é˜…å˜æ›´æ—¥å¿—ã€çš„æ–¹æ¡ˆæ¥åšï¼Œæœ¬è´¨æ˜¯é€šè¿‡ã€Œé‡è¯•ã€çš„æ–¹å¼ä¿è¯æ•°æ®ä¸€è‡´æ€§</p>
<p>6ã€åœ¨ã€Œå…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜ã€æ–¹æ¡ˆä¸‹ï¼Œã€Œè¯»å†™åˆ†ç¦» + ä¸»ä»åº“å»¶è¿Ÿã€ä¹Ÿä¼šå¯¼è‡´ç¼“å­˜å’Œæ•°æ®åº“ä¸ä¸€è‡´ï¼Œç¼“è§£æ­¤é—®é¢˜çš„æ–¹æ¡ˆæ˜¯ã€Œå»¶è¿ŸåŒåˆ ã€ï¼Œå‡­å€Ÿç»éªŒå‘é€ã€Œå»¶è¿Ÿæ¶ˆæ¯ã€åˆ°é˜Ÿåˆ—ä¸­ï¼Œå»¶è¿Ÿåˆ é™¤ç¼“å­˜ï¼ŒåŒæ—¶ä¹Ÿè¦æ§åˆ¶ä¸»ä»åº“å»¶è¿Ÿï¼Œå°½å¯èƒ½é™ä½ä¸ä¸€è‡´å‘ç”Ÿçš„æ¦‚ç‡</p>
<h2 id="åè®°"><a href="#åè®°" class="headerlink" title="åè®°"></a>åè®°</h2><p>æœ¬ä»¥ä¸ºè¿™ä¸ªè€ç”Ÿå¸¸è°ˆçš„è¯é¢˜ï¼Œå†™èµ·æ¥å¾ˆå¥½å†™ï¼Œæ²¡æƒ³åˆ°åœ¨å†™çš„è¿‡ç¨‹ä¸­ï¼Œè¿˜æ˜¯æŒ–åˆ°äº†å¾ˆå¤šä¹‹å‰æ²¡æœ‰æ·±åº¦æ€è€ƒè¿‡çš„ç»†èŠ‚ã€‚</p>
<p>åœ¨è¿™é‡Œæˆ‘ä¹Ÿåˆ†äº« 4 ç‚¹å¿ƒå¾—ç»™ä½ ï¼š</p>
<p>1ã€æ€§èƒ½å’Œä¸€è‡´æ€§ä¸èƒ½åŒæ—¶æ»¡è¶³ï¼Œä¸ºäº†æ€§èƒ½è€ƒè™‘ï¼Œé€šå¸¸ä¼šé‡‡ç”¨ã€Œæœ€ç»ˆä¸€è‡´æ€§ã€çš„æ–¹æ¡ˆ</p>
<p>2ã€æŒæ¡ç¼“å­˜å’Œæ•°æ®åº“ä¸€è‡´æ€§é—®é¢˜ï¼Œæ ¸å¿ƒé—®é¢˜æœ‰ 3 ç‚¹ï¼šç¼“å­˜åˆ©ç”¨ç‡ã€å¹¶å‘ã€ç¼“å­˜ + æ•°æ®åº“ä¸€èµ·æˆåŠŸé—®é¢˜</p>
<p>3ã€å¤±è´¥åœºæ™¯ä¸‹è¦ä¿è¯ä¸€è‡´æ€§ï¼Œå¸¸è§æ‰‹æ®µå°±æ˜¯ã€Œé‡è¯•ã€ï¼ŒåŒæ­¥é‡è¯•ä¼šå½±å“ååé‡ï¼Œæ‰€ä»¥é€šå¸¸ä¼šé‡‡ç”¨å¼‚æ­¥é‡è¯•çš„æ–¹æ¡ˆ</p>
<p>4ã€è®¢é˜…å˜æ›´æ—¥å¿—çš„æ€æƒ³ï¼Œæœ¬è´¨æ˜¯æŠŠæƒå¨æ•°æ®æºï¼ˆä¾‹å¦‚ MySQLï¼‰å½“åš leader ä¸»æœ¬ï¼Œè®©å…¶å®ƒå¼‚è´¨ç³»ç»Ÿï¼ˆä¾‹å¦‚ Redis / Elasticsearchï¼‰æˆä¸ºå®ƒçš„ follower å‰¯æœ¬ï¼Œé€šè¿‡åŒæ­¥å˜æ›´æ—¥å¿—çš„æ–¹å¼ï¼Œä¿è¯ leader å’Œ follower ä¹‹é—´ä¿æŒä¸€è‡´</p>
<p>å¾ˆå¤šä¸€è‡´æ€§é—®é¢˜ï¼Œéƒ½ä¼šé‡‡ç”¨è¿™äº›æ–¹æ¡ˆæ¥è§£å†³ï¼Œå¸Œæœ›æˆ‘çš„è¿™äº›å¿ƒå¾—å¯¹ä½ æœ‰æ‰€å¯å‘ã€‚</p>
]]></content>
      <tags>
        <tag>æ¶æ„è®¾è®¡é‚£äº›äº‹å„¿</tag>
      </tags>
  </entry>
  <entry>
    <title>æ¶æ„è®¾è®¡é‚£äº›äº‹å„¿--ç¼“å­˜é‚£äº›äº‹å„¿(äºŒ)ï¼Œç¼“å­˜è®¾è®¡æ¨¡å¼()</title>
    <url>/2022/07/04/uncatalog/cl58235qb0001ikr7dxwr0zu2/</url>
    <content><![CDATA[<hr>
<span id="more"></span>
<blockquote>
<p>ç›®å‰å„ç§ç±»å‹çš„ç¼“å­˜éƒ½æ´»è·ƒåœ¨æˆåƒä¸Šä¸‡çš„åº”ç”¨æœåŠ¡ä¸­ï¼Œè¿˜æ²¡æœ‰ä¸€ç§ç¼“å­˜æ–¹æ¡ˆå¯ä»¥è§£å†³ä¸€åˆ‡çš„ä¸šåŠ¡åœºæ™¯æˆ–æ•°æ®ç±»å‹ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®è‡ªèº«çš„ç‰¹æ®Šåœºæ™¯å’ŒèƒŒæ™¯ï¼Œé€‰æ‹©æœ€é€‚åˆçš„ç¼“å­˜æ–¹æ¡ˆã€‚ç¼“å­˜çš„ä½¿ç”¨æ˜¯ç¨‹åºå‘˜ã€æ¶æ„å¸ˆçš„å¿…å¤‡æŠ€èƒ½ï¼Œå¥½çš„ç¨‹åºå‘˜èƒ½æ ¹æ®æ•°æ®ç±»å‹ã€ä¸šåŠ¡åœºæ™¯æ¥å‡†ç¡®åˆ¤æ–­ä½¿ç”¨ä½•ç§ç±»å‹çš„ç¼“å­˜ï¼Œå¦‚ä½•ä½¿ç”¨è¿™ç§ç¼“å­˜ï¼Œä»¥æœ€å°çš„æˆæœ¬æœ€å¿«çš„æ•ˆç‡è¾¾åˆ°æœ€ä¼˜çš„ç›®çš„ã€‚</p>
</blockquote>
<p>ã€Šæ¶æ„è®¾è®¡é‚£äº›äº‹å„¿â€“ç¼“å­˜é‚£äº›äº‹å„¿ã€‹ç³»åˆ—å…±åˆ†å…­ç« ï¼š</p>
<ul>
<li><a href="https://bugkillerpro.github.io/2022/07/04/uncatalog/cl56he3gx000050r72rv69xlr/">æ¶æ„è®¾è®¡é‚£äº›äº‹å„¿â€“ç¼“å­˜é‚£äº›äº‹å„¿(ä¸€)ï¼Œç¼“å­˜çš„å‰ä¸–ä»Šç”Ÿ</a></li>
<li><a href="https://bugkillerpro.github.io/2022/07/04/uncatalog/cl58235qb0001ikr7dxwr0zu2/">æ¶æ„è®¾è®¡é‚£äº›äº‹å„¿â€“ç¼“å­˜é‚£äº›äº‹å„¿(äºŒ)ï¼Œç¼“å­˜è®¾è®¡æ¨¡å¼</a></li>
<li><a href="https://bugkillerpro.github.io/2022/07/04/uncatalog/cl58235q80000ikr72lnvg3qt/">æ¶æ„è®¾è®¡é‚£äº›äº‹å„¿â€“ç¼“å­˜é‚£äº›äº‹å„¿(ä¸‰)ï¼Œç¼“å­˜æ€§èƒ½å’Œä¸€è‡´æ€§çš„æœ€ä½³å®è·µ</a></li>
<li><a href="https://bugkillerpro.github.io/2022/07/12/uncatalog/cl5hl5x3l00000wr734tl8oua/">æ¶æ„è®¾è®¡é‚£äº›äº‹å„¿â€“ç¼“å­˜é‚£äº›äº‹å„¿(å››)ï¼Œç¼“å­˜ç©¿é€ã€ ç¼“å­˜é›ªå´© å’Œ ç¼“å­˜å‡»ç©¿</a></li>
<li><a href="https://bugkillerpro.github.io/2022/07/12/uncatalog/cl5hm81oo00000wr786z6dmjl/">æ¶æ„è®¾è®¡é‚£äº›äº‹å„¿â€“ç¼“å­˜é‚£äº›äº‹å„¿(äº”)ï¼Œå¸ƒéš†è¿‡æ»¤å™¨è¯¦è§£</a></li>
<li><a href>æ¶æ„è®¾è®¡é‚£äº›äº‹å„¿â€“ç¼“å­˜é‚£äº›äº‹å„¿(å…­)ï¼Œredis</a></li>
</ul>
<h2 id="ç¼“å­˜è®¾è®¡çš„å‡ ç§å¸¸è§æ¨¡å¼"><a href="#ç¼“å­˜è®¾è®¡çš„å‡ ç§å¸¸è§æ¨¡å¼" class="headerlink" title="ç¼“å­˜è®¾è®¡çš„å‡ ç§å¸¸è§æ¨¡å¼"></a>ç¼“å­˜è®¾è®¡çš„å‡ ç§å¸¸è§æ¨¡å¼</h2><h3 id="1ï¼ŒCache-Aside"><a href="#1ï¼ŒCache-Aside" class="headerlink" title="1ï¼ŒCache-Aside"></a>1ï¼ŒCache-Aside</h3><ul>
<li>è¯»æ“ä½œï¼šåº”ç”¨å…ˆå»æŸ¥è¯¢ç¼“å­˜ï¼Œå‘½ä¸­åˆ™è¿”å›ï¼›æ²¡å‘½ä¸­åº”ç”¨åˆ™ä¼šå»æ•°æ®åº“è¯»å–æ•°æ®ï¼Œå†™å…¥ç¼“å­˜åè¿”å›ã€‚</li>
<li>å†™æ“ä½œï¼šåº”ç”¨å…ˆæ›´æ–°æ•°æ®åº“å†åˆ é™¤ç¼“å­˜ï¼Œç„¶åè¿”å›ã€‚<br>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ç§æ¨¡å¼ä¸‹ï¼Œç¼“å­˜åªæœ‰å†™å…¥ä¸åˆ é™¤è€Œæ²¡æœ‰ä¿®æ”¹æ“ä½œã€‚<br>é€‚ç”¨åœºæ™¯ï¼šè¯»å¤šå†™å°‘ã€‚<br>å­˜åœ¨çš„é—®é¢˜ï¼šå¤šçº¿ç¨‹ä¸‹æ˜“å‡ºç°æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚</li>
</ul>
<h3 id="2ï¼ŒRead-Write-Through"><a href="#2ï¼ŒRead-Write-Through" class="headerlink" title="2ï¼ŒRead/Write-Through"></a>2ï¼ŒRead/Write-Through</h3><p>æ ¸å¿ƒæ€æƒ³ï¼šåº”ç”¨éœ€è¦æ“ä½œæ•°æ®æ—¶åªä¸ç¼“å­˜ç»„ä»¶è¿›è¡Œäº¤äº’ï¼›ç¼“å­˜é‡Œçš„æ•°æ®ä¸ä¼šè¿‡æœŸã€‚</p>
<ul>
<li>Read-Throughï¼Œåº”ç”¨æŸ¥è¯¢ç¼“å­˜æ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨åˆ™è¿”å›ï¼›ä¸å­˜åœ¨åˆ™ç”±ç¼“å­˜ç»„ä»¶å»æ•°æ®åº“åŠ è½½æ•°æ®ã€‚</li>
<li>Write-Throughï¼Œå…ˆæŸ¥è¯¢è¦å†™å…¥çš„æ•°æ®åœ¨ç¼“å­˜æ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨åˆ™å…ˆæ›´æ–°ç¼“å­˜ç„¶åå†æ›´æ–°æ•°æ®åº“æœ€åè¿”å›ï¼›å¦‚æœè¦å†™å…¥çš„æ•°æ®åœ¨ç¼“å­˜ä¸å­˜åœ¨ï¼Œæœ‰ä¸¤å¯¹åº”ç­–ç•¥ï¼šä¸€ç§æ˜¯å…ˆå°†æ•°æ®å†™å…¥ç¼“å­˜ï¼Œç„¶åç”±ç¼“å­˜ç»„ä»¶å°†æ•°æ®åŒæ­¥æ›´æ–°åˆ°æ•°æ®åº“ï¼›å¦ä¸€ç§ç­–ç•¥æ˜¯ä¸å†™ç¼“å­˜ç›´æ¥å°†æ•°æ®å†™å…¥æ•°æ®åº“ã€‚<br>é€‚ç”¨åœºæ™¯ï¼šè¯»å¤šå†™å°‘ã€‚<br>å­˜åœ¨çš„é—®é¢˜ï¼š<br>å› ä¸ºåº”ç”¨æ“ä½œæ•°æ®æ—¶åªä¸ç¼“å­˜ç»„ä»¶äº¤äº’ï¼Œç›¸å¯¹äºCache-Asideè€Œè¨€æ•°æ®ä¸ä¸€è‡´çš„æ¦‚ç‡è¦ä½ä¸€äº›ã€‚<br>å› ä¸ºæ­¤æ¨¡å¼ä¸‹ç¼“å­˜æ²¡æœ‰è¿‡æœŸæ—¶é—´ï¼Œæ‰€ä»¥ç¼“å­˜çš„ä½¿ç”¨é‡ä¼šéå¸¸å¤§ã€‚</li>
</ul>
<h3 id="3ï¼ŒWrite-Back"><a href="#3ï¼ŒWrite-Back" class="headerlink" title="3ï¼ŒWrite-Back"></a>3ï¼ŒWrite-Back</h3><p>Write-Backä¹Ÿç§°Write-Behindï¼Œè¿™ç§æ¨¡å¼æ˜¯æ‰¿æ¥Write-Throughçš„ï¼Œåœ¨å¯¹æ•°æ®è¿›è¡Œæ•°æ®æŒä¹…åŒ–å­˜å‚¨å›å†™æ—¶ä¸€èˆ¬é‡‡ç”¨å¼‚æ­¥å›å†™ï¼Œä¹Ÿå¯ä»¥é—´éš”ä¸€å®šæ—¶é—´åæ‰¹é‡å›å†™<br><img src="/2022/07/04/uncatalog/cl58235qb0001ikr7dxwr0zu2/20200806194359875.png" alt="img"><br>é€‚ç”¨åœºæ™¯ï¼šè¯»å°‘å†™å¤š<br>å­˜åœ¨çš„é—®é¢˜ï¼šå¼‚æ­¥æˆ–é—´éš”ä¸€å®šæ—¶é—´çš„æ‰¹é‡å›å†™ä¼šå¯¼è‡´æ•°æ®å»¶è¿Ÿæˆ–æ•°æ®ä¸¢å¤±çš„æƒ…å½¢å‡ºç°ã€‚</p>
<p>è¿™é‡Œåªæ˜¯ä»‹ç»äº†å¸¸è§çš„ç¼“å­˜æ¨¡å¼é‡Œçš„ä¸€äº›åŸºæœ¬æƒ…å†µï¼Œæ‰€è®¨è®ºçš„ç¼“å­˜æ¨¡å¼éƒ½å­˜å„è‡ªçš„é—®é¢˜ï¼Œéœ€è¦æˆ‘ä»¬æ ¹æ®è‡ªå·±çš„ä¸šåŠ¡åœºæ™¯æ¥é€‰ç”¨é€‚åˆè‡ªå·±çš„æ¨¡å¼ã€‚å½“ç„¶æ•°æ®ä¸¢å¤±ã€çƒ­ç‚¹æ•°æ®ã€ç¼“å­˜ç©¿é€ã€ç¼“å­˜é¢„çƒ­ç­‰è¿™äº›é—®é¢˜æ˜¯åœ¨ä½¿ç”¨ç¼“å­˜æ—¶éƒ½å¿…é¡»è€ƒè™‘çš„ã€‚å¦å¤–æ•°æ®æ¨¡å‹ä¹Ÿæ˜¯éœ€è¦æ³¨æ„çš„ï¼Œåœ¨Cache-Asideä¸‹ç¼“å­˜é‡Œçš„æ•°æ®æ¨¡å‹å¯ä»¥ä¸æ•°æ®åº“æ•°æ®æ¨¡å‹ä¸ä¸€è‡´ï¼Œè€ŒRead/Write-Throughæ¨¡å¼ä¸‹äºŒè€…çš„æ•°æ®æ¨¡å‹ä¸€èˆ¬æ˜¯éœ€è¦ç›¸åŒçš„ã€‚</p>
]]></content>
      <tags>
        <tag>æ¶æ„è®¾è®¡é‚£äº›äº‹å„¿</tag>
      </tags>
  </entry>
  <entry>
    <title>æ¶æ„è®¾è®¡é‚£äº›äº‹å„¿--ç¼“å­˜é‚£äº›äº‹å„¿(å››)ï¼Œç¼“å­˜ç©¿é€ã€ ç¼“å­˜é›ªå´© å’Œ ç¼“å­˜å‡»ç©¿</title>
    <url>/2022/07/12/uncatalog/cl5hl5x3l00000wr734tl8oua/</url>
    <content><![CDATA[<hr>
<span id="more"></span>
<blockquote>
<p>ç›®å‰å„ç§ç±»å‹çš„ç¼“å­˜éƒ½æ´»è·ƒåœ¨æˆåƒä¸Šä¸‡çš„åº”ç”¨æœåŠ¡ä¸­ï¼Œè¿˜æ²¡æœ‰ä¸€ç§ç¼“å­˜æ–¹æ¡ˆå¯ä»¥è§£å†³ä¸€åˆ‡çš„ä¸šåŠ¡åœºæ™¯æˆ–æ•°æ®ç±»å‹ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®è‡ªèº«çš„ç‰¹æ®Šåœºæ™¯å’ŒèƒŒæ™¯ï¼Œé€‰æ‹©æœ€é€‚åˆçš„ç¼“å­˜æ–¹æ¡ˆã€‚ç¼“å­˜çš„ä½¿ç”¨æ˜¯ç¨‹åºå‘˜ã€æ¶æ„å¸ˆçš„å¿…å¤‡æŠ€èƒ½ï¼Œå¥½çš„ç¨‹åºå‘˜èƒ½æ ¹æ®æ•°æ®ç±»å‹ã€ä¸šåŠ¡åœºæ™¯æ¥å‡†ç¡®åˆ¤æ–­ä½¿ç”¨ä½•ç§ç±»å‹çš„ç¼“å­˜ï¼Œå¦‚ä½•ä½¿ç”¨è¿™ç§ç¼“å­˜ï¼Œä»¥æœ€å°çš„æˆæœ¬æœ€å¿«çš„æ•ˆç‡è¾¾åˆ°æœ€ä¼˜çš„ç›®çš„ã€‚</p>
</blockquote>
<p>ã€Šæ¶æ„è®¾è®¡é‚£äº›äº‹å„¿â€“ç¼“å­˜é‚£äº›äº‹å„¿ã€‹ç³»åˆ—å…±åˆ†å…­ç« ï¼š</p>
<ul>
<li><a href="https://bugkillerpro.github.io/2022/07/04/uncatalog/cl56he3gx000050r72rv69xlr/">æ¶æ„è®¾è®¡é‚£äº›äº‹å„¿â€“ç¼“å­˜é‚£äº›äº‹å„¿(ä¸€)ï¼Œç¼“å­˜çš„å‰ä¸–ä»Šç”Ÿ</a></li>
<li><a href="https://bugkillerpro.github.io/2022/07/04/uncatalog/cl58235qb0001ikr7dxwr0zu2/">æ¶æ„è®¾è®¡é‚£äº›äº‹å„¿â€“ç¼“å­˜é‚£äº›äº‹å„¿(äºŒ)ï¼Œç¼“å­˜è®¾è®¡æ¨¡å¼</a></li>
<li><a href="https://bugkillerpro.github.io/2022/07/04/uncatalog/cl58235q80000ikr72lnvg3qt/">æ¶æ„è®¾è®¡é‚£äº›äº‹å„¿â€“ç¼“å­˜é‚£äº›äº‹å„¿(ä¸‰)ï¼Œç¼“å­˜æ€§èƒ½å’Œä¸€è‡´æ€§çš„æœ€ä½³å®è·µ</a></li>
<li><a href="https://bugkillerpro.github.io/2022/07/12/uncatalog/cl5hl5x3l00000wr734tl8oua/">æ¶æ„è®¾è®¡é‚£äº›äº‹å„¿â€“ç¼“å­˜é‚£äº›äº‹å„¿(å››)ï¼Œç¼“å­˜ç©¿é€ã€ ç¼“å­˜é›ªå´© å’Œ ç¼“å­˜å‡»ç©¿</a></li>
<li><a href="https://bugkillerpro.github.io/2022/07/12/uncatalog/cl5hm81oo00000wr786z6dmjl/">æ¶æ„è®¾è®¡é‚£äº›äº‹å„¿â€“ç¼“å­˜é‚£äº›äº‹å„¿(äº”)ï¼Œå¸ƒéš†è¿‡æ»¤å™¨è¯¦è§£</a></li>
<li><a href>æ¶æ„è®¾è®¡é‚£äº›äº‹å„¿â€“ç¼“å­˜é‚£äº›äº‹å„¿(å…­)ï¼Œredis</a></li>
</ul>
<h2 id="ç¼“å­˜ç©¿é€ã€-ç¼“å­˜é›ªå´©-å’Œ-ç¼“å­˜å‡»ç©¿"><a href="#ç¼“å­˜ç©¿é€ã€-ç¼“å­˜é›ªå´©-å’Œ-ç¼“å­˜å‡»ç©¿" class="headerlink" title="ç¼“å­˜ç©¿é€ã€ ç¼“å­˜é›ªå´© å’Œ ç¼“å­˜å‡»ç©¿"></a>ç¼“å­˜ç©¿é€ã€ ç¼“å­˜é›ªå´© å’Œ ç¼“å­˜å‡»ç©¿</h2><blockquote>
<p>åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œä¼šå› ä¸ºå¾ˆå¤šçš„åŸå› é€ æˆè®¿é—®è¯·æ±‚ç»•è¿‡äº†ç¼“å­˜ï¼Œéƒ½éœ€è¦è®¿é—®æ•°æ®åº“æŒä¹…å±‚ï¼Œè™½ç„¶å¯¹Redsiç¼“å­˜æœåŠ¡å™¨ä¸ä¼šé€ æˆå½±å“ï¼Œä½†æ˜¯æ•°æ®åº“çš„è´Ÿè½½å°±ä¼šå¢å¤§ï¼Œä½¿ç¼“å­˜çš„ä½œç”¨é™ä½</p>
</blockquote>
<h3 id="ç¼“å­˜ç©¿é€"><a href="#ç¼“å­˜ç©¿é€" class="headerlink" title="ç¼“å­˜ç©¿é€"></a>ç¼“å­˜ç©¿é€</h3><p>ç¼“å­˜ç©¿é€æ˜¯æŒ‡æŸ¥è¯¢ä¸€ä¸ªæ ¹æœ¬ä¸å­˜åœ¨çš„æ•°æ®ï¼Œç¼“å­˜å±‚å’ŒæŒä¹…å±‚éƒ½ä¸ä¼šå‘½ä¸­ã€‚åœ¨æ—¥å¸¸å·¥ä½œä¸­å‡ºäºå®¹é”™çš„è€ƒè™‘ï¼Œå¦‚æœä»æŒä¹…å±‚æŸ¥ä¸åˆ°æ•°æ®åˆ™ä¸å†™å…¥ç¼“å­˜å±‚ï¼Œç¼“å­˜ç©¿é€å°†å¯¼è‡´ä¸å­˜åœ¨çš„æ•°æ®æ¯æ¬¡è¯·æ±‚éƒ½è¦åˆ°æŒä¹…å±‚å»æŸ¥è¯¢ï¼Œå¤±å»äº†ç¼“å­˜ä¿æŠ¤åç«¯æŒä¹…çš„æ„ä¹‰</p>
<p>ç¼“å­˜ç©¿é€ç¤ºæ„å›¾ï¼š<br><img src="/2022/07/12/uncatalog/cl5hl5x3l00000wr734tl8oua/1.png" alt="img"><br>ç¼“å­˜ç©¿é€é—®é¢˜å¯èƒ½ä¼šä½¿åç«¯å­˜å‚¨è´Ÿè½½åŠ å¤§ï¼Œç”±äºå¾ˆå¤šåç«¯æŒä¹…å±‚ä¸å…·å¤‡é«˜å¹¶å‘æ€§ï¼Œç”šè‡³å¯èƒ½é€ æˆåç«¯å­˜å‚¨å®•æœºã€‚é€šå¸¸å¯ä»¥åœ¨ç¨‹åºä¸­ç»Ÿè®¡æ€»è°ƒç”¨æ•°ã€ç¼“å­˜å±‚å‘½ä¸­æ•°ã€å¦‚æœåŒä¸€ä¸ªKeyçš„ç¼“å­˜å‘½ä¸­ç‡å¾ˆä½ï¼Œå¯èƒ½å°±æ˜¯å‡ºç°äº†ç¼“å­˜ç©¿é€é—®é¢˜ã€‚<br>é€ æˆç¼“å­˜ç©¿é€çš„åŸºæœ¬åŸå› æœ‰ä¸¤ä¸ª:</p>
<ul>
<li>ç¬¬ä¸€ï¼Œè‡ªèº«ä¸šåŠ¡ä»£ç æˆ–è€…æ•°æ®å‡ºç°é—®é¢˜ï¼ˆä¾‹å¦‚ï¼šset å’Œ get çš„keyä¸ä¸€è‡´ï¼‰ </li>
<li>ç¬¬äºŒï¼Œä¸€äº›æ¶æ„æ”»å‡»ã€çˆ¬è™«ç­‰é€ æˆå¤§é‡ç©ºå‘½ä¸­ï¼ˆçˆ¬å–çº¿ä¸Šå•†åŸå•†å“æ•°æ®ï¼Œè¶…å¤§å¾ªç¯é€’å¢å•†å“çš„IDï¼‰</li>
</ul>
<h4 id="è§£å†³æ–¹æ¡ˆï¼š"><a href="#è§£å†³æ–¹æ¡ˆï¼š" class="headerlink" title="è§£å†³æ–¹æ¡ˆï¼š"></a>è§£å†³æ–¹æ¡ˆï¼š</h4><ol>
<li><p>ç¼“å­˜ç©ºå¯¹è±¡</p>
<pre><code>ç¼“å­˜ç©ºå¯¹è±¡ï¼šæ˜¯æŒ‡åœ¨æŒä¹…å±‚æ²¡æœ‰å‘½ä¸­çš„æƒ…å†µä¸‹ï¼Œå¯¹keyè¿›è¡Œset ï¼ˆkey,nullï¼‰

ç¼“å­˜ç©ºå¯¹è±¡ä¼šæœ‰ä¸¤ä¸ªé—®é¢˜ï¼šç¬¬ä¸€ï¼Œvalueä¸ºnull ä¸ä»£è¡¨ä¸å ç”¨å†…å­˜ç©ºé—´ï¼Œç©ºå€¼åšäº†ç¼“å­˜ï¼Œæ„å‘³ç€ç¼“å­˜å±‚ä¸­å­˜äº†æ›´å¤šçš„é”®ï¼Œéœ€è¦æ›´å¤šçš„å†…å­˜ç©ºé—´ï¼Œæ¯”è¾ƒæœ‰æ•ˆçš„æ–¹æ³•æ˜¯é’ˆå¯¹è¿™ç±»æ•°æ®è®¾ç½®ä¸€ä¸ªè¾ƒçŸ­çš„è¿‡æœŸæ—¶é—´ï¼Œè®©å…¶è‡ªåŠ¨å‰”é™¤ã€‚ç¬¬äºŒï¼Œç¼“å­˜å±‚å’Œå­˜å‚¨å±‚çš„æ•°æ®ä¼šæœ‰ä¸€æ®µæ—¶é—´çª—å£çš„ä¸ä¸€è‡´ï¼Œå¯èƒ½ä¼šå¯¹ä¸šåŠ¡æœ‰ä¸€å®šå½±å“ã€‚ä¾‹å¦‚è¿‡æœŸæ—¶é—´è®¾ç½®ä¸º5åˆ†é’Ÿï¼Œå¦‚æœæ­¤æ—¶å­˜å‚¨å±‚æ·»åŠ äº†è¿™ä¸ªæ•°æ®ï¼Œé‚£æ­¤æ®µæ—¶é—´å°±ä¼šå‡ºç°ç¼“å­˜å±‚å’Œå­˜å‚¨å±‚æ•°æ®çš„ä¸ä¸€è‡´ï¼Œæ­¤æ—¶å¯ä»¥åˆ©ç”¨æ¶ˆæ¯ç³»ç»Ÿæˆ–è€…å…¶ä»–æ–¹å¼æ¸…é™¤æ‰ç¼“å­˜å±‚ä¸­çš„ç©ºå¯¹è±¡
</code></pre>
</li>
<li><p>å¸ƒéš†è¿‡æ»¤å™¨æ‹¦æˆª(è¯¦è§<a href="https://hexo.io/">å¸ƒéš†è¿‡æ»¤å™¨</a>)</p>
<pre><code> åœ¨è®¿é—®ç¼“å­˜å±‚å’Œå­˜å‚¨å±‚ä¹‹å‰ï¼Œå°†å­˜åœ¨çš„keyç”¨å¸ƒéš†è¿‡æ»¤å™¨æå‰ä¿å­˜èµ·æ¥ï¼Œåšç¬¬ä¸€å±‚æ‹¦æˆªï¼Œå½“æ”¶åˆ°ä¸€ä¸ªå¯¹keyè¯·æ±‚æ—¶å…ˆç”¨å¸ƒéš†è¿‡æ»¤å™¨éªŒè¯æ˜¯keyå¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨åœ¨è¿›å…¥ç¼“å­˜å±‚ã€å­˜å‚¨å±‚ã€‚å¯ä»¥ä½¿ç”¨bitmapåšå¸ƒéš†è¿‡æ»¤å™¨ã€‚è¿™ç§æ–¹æ³•é€‚ç”¨äºæ•°æ®å‘½ä¸­ä¸é«˜ã€æ•°æ®ç›¸å¯¹å›ºå®šã€å®æ—¶æ€§ä½çš„åº”ç”¨åœºæ™¯ï¼Œä»£ç ç»´æŠ¤è¾ƒä¸ºå¤æ‚ï¼Œä½†æ˜¯ç¼“å­˜ç©ºé—´å ç”¨å°‘ã€‚

 å¸ƒéš†è¿‡æ»¤å™¨å®é™…ä¸Šæ˜¯ä¸€ä¸ªå¾ˆé•¿çš„äºŒè¿›åˆ¶å‘é‡å’Œä¸€ç³»åˆ—éšæœºæ˜ å°„å‡½æ•°ã€‚å¸ƒéš†è¿‡æ»¤å™¨å¯ä»¥ç”¨äºæ£€ç´¢ä¸€ä¸ªå…ƒç´ æ˜¯å¦åœ¨ä¸€ä¸ªé›†åˆä¸­ã€‚å®ƒçš„ä¼˜ç‚¹æ˜¯ç©ºé—´æ•ˆç‡å’ŒæŸ¥è¯¢æ—¶é—´éƒ½è¿œè¿œè¶…è¿‡ä¸€èˆ¬çš„ç®—æ³•ï¼Œç¼ºç‚¹æ˜¯æœ‰ä¸€å®šçš„è¯¯è¯†åˆ«ç‡å’Œåˆ é™¤å›°éš¾ã€‚
</code></pre>
</li>
</ol>
<p>æ–¹æ¡ˆå¯¹æ¯”:<br><img src="/2022/07/12/uncatalog/cl5hl5x3l00000wr734tl8oua/2.png" alt="img"></p>
<h3 id="ç¼“å­˜é›ªå´©"><a href="#ç¼“å­˜é›ªå´©" class="headerlink" title="ç¼“å­˜é›ªå´©"></a>ç¼“å­˜é›ªå´©</h3><p>ç”±äºç¼“å­˜å±‚æ‰¿è½½ç€å¤§é‡è¯·æ±‚ï¼Œæœ‰æ•ˆåœ°ä¿æŠ¤äº†å­˜å‚¨å±‚ï¼Œä½†æ˜¯å¦‚æœç¼“å­˜å±‚ç”±äºæŸäº›åŸå› ä¸å¯ç”¨ï¼ˆå®•æœºï¼‰æˆ–è€…å¤§é‡ç¼“å­˜ç”±äºè¶…æ—¶æ—¶é—´ç›¸åŒåœ¨åŒä¸€æ—¶é—´æ®µå¤±æ•ˆï¼ˆå¤§æ‰¹keyå¤±æ•ˆ/çƒ­ç‚¹æ•°æ®å¤±æ•ˆï¼‰ï¼Œå¤§é‡è¯·æ±‚ç›´æ¥åˆ°è¾¾å­˜å‚¨å±‚ï¼Œå­˜å‚¨å±‚å‹åŠ›è¿‡å¤§å¯¼è‡´ç³»ç»Ÿé›ªå´©ã€‚</p>
<h4 id="è§£å†³æ–¹æ¡ˆï¼š-1"><a href="#è§£å†³æ–¹æ¡ˆï¼š-1" class="headerlink" title="è§£å†³æ–¹æ¡ˆï¼š"></a>è§£å†³æ–¹æ¡ˆï¼š</h4><ul>
<li>å¯ä»¥æŠŠç¼“å­˜å±‚è®¾è®¡æˆé«˜å¯ç”¨çš„ï¼Œå³ä½¿ä¸ªåˆ«èŠ‚ç‚¹ã€ä¸ªåˆ«æœºå™¨ã€ç”šè‡³æ˜¯æœºæˆ¿å®•æ‰ï¼Œä¾ç„¶å¯ä»¥æä¾›æœåŠ¡ã€‚åˆ©ç”¨sentinelæˆ–clusterå®ç°ã€‚</li>
<li>é‡‡ç”¨å¤šçº§ç¼“å­˜ï¼Œæœ¬åœ°è¿›ç¨‹ä½œä¸ºä¸€çº§ç¼“å­˜ï¼Œredisä½œä¸ºäºŒçº§ç¼“å­˜ï¼Œä¸åŒçº§åˆ«çš„ç¼“å­˜è®¾ç½®çš„è¶…æ—¶æ—¶é—´ä¸åŒï¼Œå³ä½¿æŸçº§ç¼“å­˜è¿‡æœŸäº†ï¼Œä¹Ÿæœ‰å…¶ä»–çº§åˆ«ç¼“å­˜å…œåº•</li>
<li>ç¼“å­˜çš„è¿‡æœŸæ—¶é—´ç”¨éšæœºå€¼ï¼Œå°½é‡è®©ä¸åŒçš„keyçš„è¿‡æœŸæ—¶é—´ä¸åŒï¼ˆä¾‹å¦‚ï¼šå®šæ—¶ä»»åŠ¡æ–°å»ºå¤§æ‰¹é‡keyï¼Œè®¾ç½®çš„è¿‡æœŸæ—¶é—´ç›¸åŒï¼‰</li>
</ul>
<h3 id="ç¼“å­˜å‡»ç©¿"><a href="#ç¼“å­˜å‡»ç©¿" class="headerlink" title="ç¼“å­˜å‡»ç©¿"></a>ç¼“å­˜å‡»ç©¿</h3><p>ç³»ç»Ÿä¸­å­˜åœ¨ä»¥ä¸‹ä¸¤ä¸ªé—®é¢˜æ—¶éœ€è¦å¼•èµ·æ³¨æ„ï¼š</p>
<p>å½“å‰keyæ˜¯ä¸€ä¸ªçƒ­ç‚¹keyï¼ˆä¾‹å¦‚ä¸€ä¸ªç§’æ€æ´»åŠ¨ï¼‰ï¼Œå¹¶å‘é‡éå¸¸å¤§ã€‚<br>é‡å»ºç¼“å­˜ä¸èƒ½åœ¨çŸ­æ—¶é—´å®Œæˆï¼Œå¯èƒ½æ˜¯ä¸€ä¸ªå¤æ‚è®¡ç®—ï¼Œä¾‹å¦‚å¤æ‚çš„SQLã€å¤šæ¬¡IOã€å¤šä¸ªä¾èµ–ç­‰ã€‚<br>åœ¨ç¼“å­˜å¤±æ•ˆçš„ç¬é—´ï¼Œæœ‰å¤§é‡çº¿ç¨‹æ¥é‡å»ºç¼“å­˜ï¼Œé€ æˆåç«¯è´Ÿè½½åŠ å¤§ï¼Œç”šè‡³å¯èƒ½ä¼šè®©åº”ç”¨å´©æºƒã€‚</p>
<h4 id="è§£å†³æ–¹æ¡ˆï¼š-2"><a href="#è§£å†³æ–¹æ¡ˆï¼š-2" class="headerlink" title="è§£å†³æ–¹æ¡ˆï¼š"></a>è§£å†³æ–¹æ¡ˆï¼š</h4><ol>
<li><p>åˆ†å¸ƒå¼äº’æ–¥é”</p>
<p>åªå…è®¸ä¸€ä¸ªçº¿ç¨‹é‡å»ºç¼“å­˜ï¼Œå…¶ä»–çº¿ç¨‹ç­‰å¾…é‡å»ºç¼“å­˜çš„çº¿ç¨‹æ‰§è¡Œå®Œï¼Œé‡æ–°ä»ç¼“å­˜è·å–æ•°æ®å³å¯ã€‚set(key,value,timeout)</p>
</li>
</ol>
<p><img src="/2022/07/12/uncatalog/cl5hl5x3l00000wr734tl8oua/3.png" alt="img"></p>
<ol start="2">
<li>æ°¸ä¸è¿‡æœŸ</li>
</ol>
<ul>
<li>ä»ç¼“å­˜å±‚é¢æ¥çœ‹ï¼Œç¡®å®æ²¡æœ‰è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç°çƒ­ç‚¹keyè¿‡æœŸåäº§ç”Ÿçš„é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯â€œç‰©ç†â€ä¸è¿‡æœŸã€‚</li>
<li>ä»åŠŸèƒ½å±‚é¢æ¥çœ‹ï¼Œä¸ºæ¯ä¸ªvalueè®¾ç½®ä¸€ä¸ªé€»è¾‘è¿‡æœŸæ—¶é—´ï¼Œå½“å‘ç°è¶…è¿‡é€»è¾‘è¿‡æœŸæ—¶é—´åï¼Œä¼šä½¿ç”¨å•ç‹¬çš„çº¿ç¨‹å»æ›´æ–°ç¼“</li>
</ul>
<p><img src="/2022/07/12/uncatalog/cl5hl5x3l00000wr734tl8oua/4.png" alt="img"><br>ä¸¤ç§æ–¹æ¡ˆå¯¹æ¯”ï¼š</p>
<p>åˆ†å¸ƒå¼äº’æ–¥é”ï¼šè¿™ç§æ–¹æ¡ˆæ€è·¯æ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯å­˜åœ¨ä¸€å®šçš„éšæ‚£ï¼Œå¦‚æœåœ¨æŸ¥è¯¢æ•°æ®åº“ + å’Œ é‡å»ºç¼“å­˜ï¼ˆkeyå¤±æ•ˆåè¿›è¡Œäº†å¤§é‡çš„è®¡ç®—ï¼‰æ—¶é—´è¿‡é•¿ï¼Œä¹Ÿå¯èƒ½ä¼šå­˜åœ¨æ­»é”å’Œçº¿ç¨‹æ± é˜»å¡çš„é£é™©ï¼Œé«˜å¹¶å‘æƒ…æ™¯ä¸‹ååé‡ä¼šå¤§å¤§é™ä½ï¼ä½†æ˜¯è¿™ç§æ–¹æ³•èƒ½å¤Ÿè¾ƒå¥½åœ°é™ä½åç«¯å­˜å‚¨è´Ÿè½½ï¼Œå¹¶åœ¨ä¸€è‡´æ€§ä¸Šåšå¾—æ¯”è¾ƒå¥½ã€‚</p>
<p>â€œæ°¸è¿œä¸è¿‡æœŸâ€ï¼šè¿™ç§æ–¹æ¡ˆç”±äºæ²¡æœ‰è®¾ç½®çœŸæ­£çš„è¿‡æœŸæ—¶é—´ï¼Œå®é™…ä¸Šå·²ç»ä¸å­˜åœ¨çƒ­ç‚¹keyäº§ç”Ÿçš„ä¸€ç³»åˆ—å±å®³ï¼Œä½†æ˜¯ä¼šå­˜åœ¨æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µï¼ŒåŒæ—¶ä»£ç å¤æ‚åº¦ä¼šå¢å¤§ã€‚</p>
]]></content>
      <tags>
        <tag>æ¶æ„è®¾è®¡é‚£äº›äº‹å„¿</tag>
      </tags>
  </entry>
  <entry>
    <title>æ¶æ„è®¾è®¡é‚£äº›äº‹å„¿--ç¼“å­˜é‚£äº›äº‹å„¿(äº”)ï¼Œå¸ƒéš†è¿‡æ»¤å™¨è¯¦è§£</title>
    <url>/2022/07/12/uncatalog/cl5hm81oo00000wr786z6dmjl/</url>
    <content><![CDATA[<hr>
<span id="more"></span>
<blockquote>
<p>ç›®å‰å„ç§ç±»å‹çš„ç¼“å­˜éƒ½æ´»è·ƒåœ¨æˆåƒä¸Šä¸‡çš„åº”ç”¨æœåŠ¡ä¸­ï¼Œè¿˜æ²¡æœ‰ä¸€ç§ç¼“å­˜æ–¹æ¡ˆå¯ä»¥è§£å†³ä¸€åˆ‡çš„ä¸šåŠ¡åœºæ™¯æˆ–æ•°æ®ç±»å‹ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®è‡ªèº«çš„ç‰¹æ®Šåœºæ™¯å’ŒèƒŒæ™¯ï¼Œé€‰æ‹©æœ€é€‚åˆçš„ç¼“å­˜æ–¹æ¡ˆã€‚ç¼“å­˜çš„ä½¿ç”¨æ˜¯ç¨‹åºå‘˜ã€æ¶æ„å¸ˆçš„å¿…å¤‡æŠ€èƒ½ï¼Œå¥½çš„ç¨‹åºå‘˜èƒ½æ ¹æ®æ•°æ®ç±»å‹ã€ä¸šåŠ¡åœºæ™¯æ¥å‡†ç¡®åˆ¤æ–­ä½¿ç”¨ä½•ç§ç±»å‹çš„ç¼“å­˜ï¼Œå¦‚ä½•ä½¿ç”¨è¿™ç§ç¼“å­˜ï¼Œä»¥æœ€å°çš„æˆæœ¬æœ€å¿«çš„æ•ˆç‡è¾¾åˆ°æœ€ä¼˜çš„ç›®çš„ã€‚</p>
</blockquote>
<p>ã€Šæ¶æ„è®¾è®¡é‚£äº›äº‹å„¿â€“ç¼“å­˜é‚£äº›äº‹å„¿ã€‹ç³»åˆ—å…±åˆ†å…­ç« ï¼š</p>
<ul>
<li><a href="https://bugkillerpro.github.io/2022/07/04/uncatalog/cl56he3gx000050r72rv69xlr/">æ¶æ„è®¾è®¡é‚£äº›äº‹å„¿â€“ç¼“å­˜é‚£äº›äº‹å„¿(ä¸€)ï¼Œç¼“å­˜çš„å‰ä¸–ä»Šç”Ÿ</a></li>
<li><a href="https://bugkillerpro.github.io/2022/07/04/uncatalog/cl58235qb0001ikr7dxwr0zu2/">æ¶æ„è®¾è®¡é‚£äº›äº‹å„¿â€“ç¼“å­˜é‚£äº›äº‹å„¿(äºŒ)ï¼Œç¼“å­˜è®¾è®¡æ¨¡å¼</a></li>
<li><a href="https://bugkillerpro.github.io/2022/07/04/uncatalog/cl58235q80000ikr72lnvg3qt/">æ¶æ„è®¾è®¡é‚£äº›äº‹å„¿â€“ç¼“å­˜é‚£äº›äº‹å„¿(ä¸‰)ï¼Œç¼“å­˜æ€§èƒ½å’Œä¸€è‡´æ€§çš„æœ€ä½³å®è·µ</a></li>
<li><a href="https://bugkillerpro.github.io/2022/07/12/uncatalog/cl5hl5x3l00000wr734tl8oua/">æ¶æ„è®¾è®¡é‚£äº›äº‹å„¿â€“ç¼“å­˜é‚£äº›äº‹å„¿(å››)ï¼Œç¼“å­˜ç©¿é€ã€ ç¼“å­˜é›ªå´© å’Œ ç¼“å­˜å‡»ç©¿</a></li>
<li><a href="https://bugkillerpro.github.io/2022/07/12/uncatalog/cl5hm81oo00000wr786z6dmjl/">æ¶æ„è®¾è®¡é‚£äº›äº‹å„¿â€“ç¼“å­˜é‚£äº›äº‹å„¿(äº”)ï¼Œå¸ƒéš†è¿‡æ»¤å™¨è¯¦è§£</a></li>
<li><a href>æ¶æ„è®¾è®¡é‚£äº›äº‹å„¿â€“ç¼“å­˜é‚£äº›äº‹å„¿(å…­)ï¼Œredis</a></li>
</ul>
<h2 id="å¸ƒéš†è¿‡æ»¤å™¨"><a href="#å¸ƒéš†è¿‡æ»¤å™¨" class="headerlink" title="å¸ƒéš†è¿‡æ»¤å™¨"></a>å¸ƒéš†è¿‡æ»¤å™¨</h2><p>æœ¬è´¨ä¸Šå¸ƒéš†è¿‡æ»¤å™¨(Bloom Filter)æ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œæ¯”è¾ƒå·§å¦™çš„æ¦‚ç‡å‹æ•°æ®ç»“æ„ï¼ˆprobabilistic data structureï¼‰ï¼Œç‰¹ç‚¹æ˜¯é«˜æ•ˆåœ°æ’å…¥å’ŒæŸ¥è¯¢ï¼Œå¯ä»¥ç”¨æ¥å‘Šè¯‰ä½  æŸæ ·ä¸œè¥¿ä¸€å®šä¸å­˜åœ¨æˆ–è€…å¯èƒ½å­˜åœ¨ã€‚</p>
<p>ç›¸æ¯”äºä¼ ç»Ÿçš„ Listã€Setã€Map ç­‰æ•°æ®ç»“æ„ï¼Œå®ƒæ›´é«˜æ•ˆã€å ç”¨ç©ºé—´æ›´å°‘ï¼Œä½†æ˜¯ç¼ºç‚¹æ˜¯å…¶è¿”å›çš„ç»“æœæ˜¯æ¦‚ç‡æ€§çš„ï¼Œè€Œä¸æ˜¯ç¡®åˆ‡çš„ã€‚</p>
<p>å¯ä»¥ä¸€å¥è¯æ€»ç»“ï¼š</p>
<ul>
<li>å¦‚æœBloom Filterå‘Šè¯‰ä½ æŸä¸ªæ•°æ®ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆå®ƒä¸€å®šä¸å­˜åœ¨ã€‚</li>
<li>å¦‚æœBloom Filterå‘Šè¯‰ä½ æŸä¸ªæ•°æ®å­˜åœ¨ï¼Œé‚£ä¹ˆå®ƒä¸ä¸€å®šå­˜åœ¨ã€‚</li>
</ul>
<p>ç„¶åä½ å¯èƒ½è¦é—®äº†ï¼Œä»–éƒ½ä¸ä¸€å®šå­˜åœ¨äº†ï¼Œé‚£å®ƒæœ‰ä»€ä¹ˆç”¨ã€‚å®ƒè™½ç„¶ä¸ä¿è¯100%å­˜åœ¨ï¼Œä½†æ˜¯è¿™ä¸ªè¯¯åˆ¤ç‡å´æ˜¯å¯ä»¥æ§åˆ¶çš„ï¼Œä¸€èˆ¬æ ¹æ®åœºæ™¯ä½ å¯ä»¥è®¾ç½®ä¸€ä¸ªå¯ä»¥æ¥å—çš„é”™è¯¯ç‡ï¼Œæ¯”å¦‚ 0.0001(ä¸‡åˆ†ä¹‹ä¸€)ï¼Œ0.00001(åä¸‡åˆ†ä¹‹ä¸€)ã€‚åœ¨å¾ˆå¤šåœºæ™¯ä¸‹ï¼Œè¿™ä¸ªæ¦‚ç‡æ˜¯å¯ä»¥æ¥å—çš„ã€‚åœ¨è¿™äº›åœºæ™¯ä¸‹ï¼Œå®ƒå°±æœ‰ç”¨æ­¦ä¹‹åœ°äº†ã€‚</p>
<p>è€Œå®ƒçš„ä¼˜ç‚¹éå¸¸æ˜æ˜¾ï¼Œå°±æ˜¯æå°‘çš„ç©ºé—´å ç”¨ï¼Œä¸€èˆ¬æ¯”æ­£å¸¸å­˜æ‰€æœ‰æ•°æ®å¯ä»¥èŠ‚çœ90%å·¦å³ä»¥ä¸Šçš„å†…å­˜ã€‚</p>
<p>å¦‚æœæœ‰äººå¯¹å…·ä½“çš„è¯¯åˆ¤ç‡æ€ä¹ˆç”¨æ•°å­¦å…¬å¼æ¨ç®—å‡ºæ¥çš„ç®—æ³•æ„Ÿå…´è¶£ã€‚ä¸‹é¢çš„è¯¦è§£éƒ¨åˆ†ä¼šç»™å‡ºæ¨å¯¼çš„é“¾æ¥ã€‚</p>
<h2 id="å®é™…åœºæ™¯"><a href="#å®é™…åœºæ™¯" class="headerlink" title="å®é™…åœºæ™¯"></a>å®é™…åœºæ™¯</h2><p>æ ¹æ®å®é™…åœºæ™¯æ¥è®©å¤§å®¶äº†è§£ä¸€ä¸‹åœ¨ä»€ä¹ˆåœºæ™¯ä¸‹éœ€è¦å¸ƒéš†è¿‡æ»¤å™¨ï¼Œå®ƒåˆè§£å†³äº†ä»€ä¹ˆé—®é¢˜ã€‚</p>
<p>æˆ‘ä»¬æœ‰ä¸€ä¸ªéœ€æ±‚ï¼Œæ˜¯åˆ¤æ–­ä»»æ„çš„ä¸¤ä¸ªuseridæœ‰æ²¡æœ‰èŠè¿‡å¤©ã€‚å³(useridA, useridB)æ˜¯å¦èŠè¿‡å¤©ï¼Œæ¥å†³å®šå‰ç«¯åœºæ™¯æ˜¯å¦å±•ç¤ºå¯¹æ–¹çš„usernameã€‚æˆ‘ä»¬æœ€åˆçš„è®¾è®¡æ˜¯æ”¾åœ¨Redisé‡Œé¢ï¼Œå­˜æ”¾çš„æ ¼å¼æ˜¯ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="TEXT"><figure class="iseeu highlight /text"><table><tr><td class="code"><pre><span class="line">Redis String</span><br><span class="line">Key: &#123;prefix&#125;&#123;useridA&#125;,&#123;useridB&#125;</span><br><span class="line">Value: &quot;1&quot;</span><br></pre></td></tr></table></figure></div>
<p>æˆ‘ä»¬çš„Useridæ˜¯int32çš„é€’å¢å€¼ï¼Œç°åœ¨å·²ç»æœ‰10ä½æ•´æ•°ã€‚ï¼ˆeg: 1212341234ï¼‰ã€‚æ‰€ä»¥è¿™ä¸ªkeyè‡³å°‘æœ‰22å­—èŠ‚ã€‚</p>
<p>ä½†æ˜¯æœ€ç»ˆç»Ÿè®¡å‡ºæ¥ï¼Œæˆ‘ä»¬çš„useridèŠå¤©çš„å”¯ä¸€Keyï¼š(useridA, useridB) æœ‰4 Billion(40äº¿)çš„æ•°æ®ã€‚</p>
<p>ä¹Ÿå°±æ˜¯æˆ‘ä»¬è‡³å°‘éœ€è¦å­˜40äº¿çš„æ•°æ®åˆ°Redisã€‚</p>
<h3 id="å†…å­˜é¢„ä¼°"><a href="#å†…å­˜é¢„ä¼°" class="headerlink" title="å†…å­˜é¢„ä¼°"></a>å†…å­˜é¢„ä¼°</h3><p>Redisä½¿ç”¨SDSçš„æ•°æ®ç»“æ„æ¥å‚¨å­˜å­—ç¬¦ä¸²ã€‚æ ¼å¼ç®€åŒ–åå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="/2022/07/12/uncatalog/cl5hm81oo00000wr786z6dmjl/1.png" alt="img"></p>
<ul>
<li>Keyå ç”¨å‚¨å­˜ç©ºé—´ï¼šKey(22)+SDS(9)=31;</li>
<li>Valueå ç”¨å‚¨å­˜ç©ºé—´ï¼šValue(1)+SDS(9)+redisObject(16)=26;</li>
</ul>
<p>æ€»å†…å­˜å ç”¨ï¼š(31+26) * 4 billion = 228Gã€‚</p>
<p>æˆ‘ä»¬é¢„ä¼°æœªæ¥è¿˜æœ‰10å€çš„å¢é•¿ç©ºé—´ï¼Œé‚£å°±æ˜¯2.28Tã€‚</p>
<p>å½“ç„¶è¿™åªæ˜¯ç²—ç•¥çš„ä¼°è®¡ï¼ŒRedisæœ‰æ›´åŠ å¤æ‚è¯¦ç»†çš„è§„åˆ™æ¥ä¼˜åŒ–å†…å­˜å ç”¨ã€‚<br>æˆ‘è‡ªå·±å°è¯•è¿‡æ’å…¥ä¸€ç™¾ä¸‡çš„æ•°æ®åˆ°Redisï¼Œå®é™…å†…å­˜å ç”¨è·Ÿæˆ‘çš„è®¡ç®—å…¬å¼å·®ä¸å¤šã€‚<br>æ‰€ä»¥è¿™ä¸ªå†…å­˜å ç”¨æ˜¯éå¸¸å¤¸å¼ çš„ï¼Œæˆ‘ä»¬éœ€è¦ç”¨æŠ€æœ¯æ–¹æ¡ˆæ¥ä¼˜åŒ–è¿™ä¸ªå†…å­˜å ç”¨ã€‚</p>
<p>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±éœ€è¦è§£å†³å†…å­˜çš„å ç”¨è¿‡å¤šçš„é—®é¢˜ï¼Œå¸ƒéš†è¿‡æ»¤å™¨(Bloom Filter)é—ªè€€ç™»åœºã€‚</p>
<h2 id="å¸ƒéš†è¿‡æ»¤å™¨è¯¦è§£"><a href="#å¸ƒéš†è¿‡æ»¤å™¨è¯¦è§£" class="headerlink" title="å¸ƒéš†è¿‡æ»¤å™¨è¯¦è§£"></a>å¸ƒéš†è¿‡æ»¤å™¨è¯¦è§£</h2><p>å¸ƒéš†è¿‡æ»¤å™¨å®é™…ä¸Šæ˜¯ä¸€ä¸ªå¾ˆé•¿çš„äºŒè¿›åˆ¶å‘é‡å’Œä¸€ç³»åˆ—éšæœºæ˜ å°„å‡½æ•°ï¼ŒäºŒè¿›åˆ¶å¤§å®¶åº”è¯¥éƒ½æ¸…æ¥šï¼Œå­˜å‚¨çš„æ•°æ®ä¸æ˜¯0å°±æ˜¯1ï¼Œé»˜è®¤æ˜¯0ã€‚</p>
<p>ä¸»è¦ç”¨äºåˆ¤æ–­ä¸€ä¸ªå…ƒç´ æ˜¯å¦åœ¨ä¸€ä¸ªé›†åˆä¸­ï¼Œ0ä»£è¡¨ä¸å­˜åœ¨æŸä¸ªæ•°æ®ï¼Œ1ä»£è¡¨å­˜åœ¨æŸä¸ªæ•°æ®ã€‚å¸ƒéš†è¿‡æ»¤å™¨ä½¿ç”¨kä¸ªhashå‡½æ•°ï¼Œæ¯ä¸ªå“ˆå¸Œå‡½æ•°æ˜ å°„åˆ°Bitä½çš„æŸä¸€ä½ï¼Œè¿™æ ·å½“kä¸ªä½éƒ½ä¸º1çš„æ—¶å€™ï¼Œæˆ‘ä»¬è®¤ä¸ºè¿™ä¸ªå…ƒç´ å­˜åœ¨ã€‚å¦‚å›¾æ‰€ç¤ºï¼š<br><img src="/2022/07/12/uncatalog/cl5hm81oo00000wr786z6dmjl/2.png" alt="img"></p>
<h3 id="ä½¿ç”¨æµç¨‹"><a href="#ä½¿ç”¨æµç¨‹" class="headerlink" title="ä½¿ç”¨æµç¨‹"></a>ä½¿ç”¨æµç¨‹</h3><h4 id="1ï¼ŒSetæµç¨‹"><a href="#1ï¼ŒSetæµç¨‹" class="headerlink" title="1ï¼ŒSetæµç¨‹"></a>1ï¼ŒSetæµç¨‹</h4><p>1.è®¾ç½®Kä¸ªhashå‡½æ•°. (f1, f2, f3, â€¦ fk).<br>2.å¯¹æ•°æ® (eg: golang) è¿›è¡Œhashï¼Œå¾—åˆ°kä¸ªå€¼. (2,6,11, â€¦)<br>3.åœ¨Bit ArrayæŒ‡å®šçš„ä½ç½®è®¾ç½®ä¸º1.</p>
<h4 id="2ï¼ŒCheckæµç¨‹"><a href="#2ï¼ŒCheckæµç¨‹" class="headerlink" title="2ï¼ŒCheckæµç¨‹"></a>2ï¼ŒCheckæµç¨‹</h4><p>1.ä½¿ç”¨Kä¸ªhashå‡½æ•°å¾—åˆ°Kä¸ªå€¼ã€‚<br>2.åœ¨Bit Arrayä¸Šå„ä¸ªä½ç½®æŸ¥çœ‹å¯¹åº”çš„å€¼æ˜¯å¦ä¸º1.<br>3.ä»»ä½•ä¸€ä¸ªå€¼ä¸º0ï¼Œåˆ™æ­¤å…ƒç´ ä¸å­˜åœ¨ã€‚<br>4.æ‰€æœ‰çš„å€¼éƒ½ä¸º0ï¼Œåˆ™æˆ‘ä»¬è®¤ä¸ºæ­¤å…ƒç´ å­˜åœ¨ã€‚</p>
<h3 id="å¸ƒéš†è¿‡æ»¤å™¨è®¡ç®—å™¨"><a href="#å¸ƒéš†è¿‡æ»¤å™¨è®¡ç®—å™¨" class="headerlink" title="å¸ƒéš†è¿‡æ»¤å™¨è®¡ç®—å™¨"></a>å¸ƒéš†è¿‡æ»¤å™¨è®¡ç®—å™¨</h3><p>æˆ‘ä»¬é¦–å…ˆå®šä¹‰ä»¥ä¸‹å¸ƒéš†è¿‡æ»¤å™¨çš„ç›¸å…³å˜é‡ã€‚</p>
<ul>
<li>n: æ€»çš„æ•°æ®é‡çš„æ•°é‡å¤§å°ã€‚</li>
<li>p: è¯¯åˆ¤ç‡çš„å¤§å° (0.01 means 1%)</li>
<li>k: hashå‡½æ•°çš„æ•°é‡</li>
<li>m: éœ€è¦çš„Bitæ•°ç»„çš„Bitsç©ºé—´é‡ã€‚</li>
</ul>
<p>æˆ‘ä»¬å¯ä»¥æŠŠ n,p ä½œä¸ºè¾“å…¥ï¼Œå°±å¯ä»¥å¾—åˆ° k, m ä½œä¸ºè¾“å‡ºã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨ n,p,k ä½œä¸ºè¾“å…¥ï¼Œå¯ä»¥å¾—åˆ° m ä½œä¸ºè¾“å‡ºã€‚</p>
<p>è¿™é‡Œæ˜¯åœ¨çº¿å¸ƒéš†è¿‡æ»¤å™¨è®¡ç®—å™¨ (å¸ƒéš†è¿‡æ»¤å™¨è®¡ç®—å™¨)[<a href="https://hur.st/bloomfilter/">https://hur.st/bloomfilter/</a> ]</p>
<p>ä¸‹å›¾æ˜¯æˆ‘è®¡ç®—å‡ºæ¥çš„å€¼ã€‚<br><img src="/2022/07/12/uncatalog/cl5hm81oo00000wr786z6dmjl/3.png" alt="img"><br>å¯ä»¥å¯¹æ¯”æœ€åˆçš„è®¾è®¡æ–¹æ¡ˆï¼Œ4 Billionçš„æ•°æ®ï¼Œ 0.001çš„é”™è¯¯ç‡ã€‚åªéœ€è¦7GBçš„å†…å­˜ã€‚7/228=3%ï¼Œ å·®ä¸å¤šèŠ‚çœäº†97çš„å†…å­˜ç©ºé—´ã€‚</p>
<h4 id="è¯¯åˆ¤ç‡"><a href="#è¯¯åˆ¤ç‡" class="headerlink" title="è¯¯åˆ¤ç‡"></a>è¯¯åˆ¤ç‡</h4><p>ä½ å¯èƒ½ä¼šå¥½å¥‡ï¼Œè¯¯åˆ¤ç‡æ˜¯ä»€ä¹ˆã€‚å› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯hashæ˜ å°„ã€‚ä¸åŒçš„æ•°æ®ç»è¿‡ä¸åŒçš„hashå‡½æ•°æ˜¯æœ‰å‡ ç‡æ˜ å°„åˆ°åŒä¸€ä¸ªä½ç½®çš„ã€‚ä¾‹å¦‚ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="TEXT"><figure class="iseeu highlight /text"><table><tr><td class="code"><pre><span class="line">f1(golang)=2, f2(golang)=6, f3(golang)=11</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">f1(python)=6</span><br><span class="line">f2(java)=11</span><br><span class="line">f3(cpp)=2</span><br></pre></td></tr></table></figure></div>

<p>å½“æˆ‘ä»¬æŠŠ python, jave, cpp æ’å…¥åˆ°Bit Arrayåï¼Œä½ç½®(2,6,11)çš„å€¼éƒ½ä¸º1ã€‚<br>è¿™ä¸ªæ—¶å€™æˆ‘ä»¬æ£€æŸ¥ golang æ˜¯å¦å­˜åœ¨ï¼Œç”±äºè¿™å‡ ä¸ªä½ç½®çš„å€¼éƒ½ä¸º1ï¼Œ æ‰€ä»¥ç³»ç»Ÿä¼šå‘Šè¯‰æˆ‘ä»¬ golang å­˜åœ¨ã€‚<br>å®é™…ä¸Šæˆ‘ä»¬å¹¶æ²¡æœ‰æ’å…¥ golangï¼Œ è¿™å°±äº§ç”Ÿäº†è¯¯åˆ¤ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬å›åˆ°æœ€åˆçš„å®šä¹‰ï¼š<br>æœ¬è´¨ä¸Šå¸ƒéš†è¿‡æ»¤å™¨æ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œæ¯”è¾ƒå·§å¦™çš„æ¦‚ç‡å‹æ•°æ®ç»“æ„ï¼ˆprobabilistic data structureï¼‰ï¼Œç‰¹ç‚¹æ˜¯é«˜æ•ˆåœ°æ’å…¥å’ŒæŸ¥è¯¢ï¼Œå¯ä»¥ç”¨æ¥å‘Šè¯‰ä½  æŸæ ·ä¸œè¥¿ä¸€å®šä¸å­˜åœ¨æˆ–è€…å¯èƒ½å­˜åœ¨ã€‚</p>
<ul>
<li>å¦‚æœå¸ƒéš†è¿‡æ»¤å™¨å‘Šè¯‰ä½ ä¸ªæ•°æ®ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆå®ƒä¸€å®šä¸å­˜åœ¨ã€‚</li>
<li>å¦‚æœå¸ƒéš†è¿‡æ»¤å™¨å‘Šè¯‰ä½ æŸä¸ªæ•°æ®å­˜åœ¨ï¼Œé‚£ä¹ˆå®ƒå¯èƒ½å­˜åœ¨ã€‚ï¼ˆä¹Ÿå¯èƒ½ä¸å­˜åœ¨ï¼Œè¯¯åˆ¤ï¼‰</li>
</ul>
<h2 id="å¸ƒéš†è¿‡æ»¤å™¨å®ç°"><a href="#å¸ƒéš†è¿‡æ»¤å™¨å®ç°" class="headerlink" title="å¸ƒéš†è¿‡æ»¤å™¨å®ç°"></a>å¸ƒéš†è¿‡æ»¤å™¨å®ç°</h2><h3 id="1-Rediså†…å®ç°"><a href="#1-Rediså†…å®ç°" class="headerlink" title="1,Rediså†…å®ç°"></a>1,Rediså†…å®ç°</h3><p>Redisåœ¨4.0ç‰ˆæœ¬æ¨å‡ºäº† module çš„å½¢å¼ï¼Œå¯ä»¥å°† module ä½œä¸ºæ’ä»¶é¢å¤–å®ç°Redisçš„ä¸€äº›åŠŸèƒ½ã€‚å®˜ç½‘æ¨èäº†ä¸€ä¸ª RedisBloom[2] ä½œä¸º Redis å¸ƒéš†è¿‡æ»¤å™¨çš„ Moduleã€‚å®ƒä¸»è¦ä½¿ç”¨çš„å‘½ä»¤åŒ…å«ä¸¤ä¸ªå‘½ä»¤:</p>
<ul>
<li>1.bff.add key value //æ·»åŠ æŸä¸ªvalue</li>
<li>2.bff.exists key value //åˆ¤æ–­æŸä¸ªvalueæ˜¯å¦å­˜åœ¨ã€‚<h4 id="1-1-RedisBloom-å®‰è£…"><a href="#1-1-RedisBloom-å®‰è£…" class="headerlink" title="1.1 RedisBloom å®‰è£…"></a>1.1 RedisBloom å®‰è£…</h4>Redisä¸æ˜¯é»˜è®¤å°±æœ‰ï¼Œéœ€è¦å®‰è£…moduleæ‰å¯ä»¥ä½¿ç”¨å…¶å‘½ä»¤ã€‚æœªå®‰è£…ä¹‹å‰æç¤ºï¼š<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; bf.add bloom_key bloom_value</span><br><span class="line">(error) ERR unknown command `bf.add`, with args beginning with: `bloom_key`, `bloom_value`,</span><br></pre></td></tr></table></figure></div>
å¯ä»¥ä½¿ç”¨dockerå®‰è£…ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æºç å®‰è£…ï¼šè¿™é‡Œåªå±•ç¤ºä¸€ä¸‹dockerå®‰è£…å¹¶æµ‹è¯•ç®€å•æŒ‡ä»¤ï¼Œæœ‰éœ€è¦æºç å®‰è£…çš„å¯ä»¥ç½‘ä¸ŠæŸ¥çœ‹æ•™ç¨‹ã€‚</li>
</ul>
<p>1.æ‹‰é•œåƒ<br>2.dockerè¿è¡Œredisbloom<br>3.è¿›å…¥docker<br>4.æ‰§è¡Œredis-cli</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">docker pull redislabs/rebloom:latest</span><br><span class="line">docker run -p 6379:6379 --name redis-redisbloom redislabs/rebloom:latest</span><br><span class="line">docker exec -it redis-redisbloom bash</span><br><span class="line"><span class="meta">#</span><span class="bash"> redis-cli</span></span><br><span class="line">127.0.0.1:6379&gt; bf.add bloom_key bloom_value</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; bf.exists bloom_key bloom_value</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; bf.exists bloom_key bloom_other</span><br><span class="line">(integer) 0</span><br></pre></td></tr></table></figure></div>
<p>Redisçš„Bloom Filterå†…éƒ¨ä½¿ç”¨Redisçš„Bitmapæ¥å®ç°ã€‚<br>BitmapåŸºäºæœ€å°çš„å•ä½bitè¿›è¡Œå­˜å‚¨ï¼Œæ‰€ä»¥éå¸¸çœç©ºé—´ã€‚<br>redisä¸­bitæ˜ å°„è¢«é™åˆ¶åœ¨512MBä¹‹å†…ã€‚<br>æœ‰å…´è¶£å¯ä»¥çœ‹ä¸€ä¸‹Redisçš„å®˜æ–¹æ–‡æ¡£ã€‚<a href="https://redislabs.com/redis-best-practices/bloom-filter-pattern/">Redis BloomFilter</a></p>
<h4 id="1-2-goæ“ä½œRedisBloom"><a href="#1-2-goæ“ä½œRedisBloom" class="headerlink" title="1.2 goæ“ä½œRedisBloom"></a>1.2 goæ“ä½œRedisBloom</h4><p> è¯¦è§<a href="https://redis.uptrace.dev/guide/bloom-cuckoo-count-min-top-k.html#bloom-and-cuckoo">Go Redis</a> ã€<br> <a href="https://github.com/go-redis/redis/tree/master/example/redis-bloom">github</a></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="GO"><figure class="iseeu highlight /go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">bloomFilter</span><span class="params">(ctx context.Context, rdb *redis.Client)</span></span> &#123;</span><br><span class="line">	inserted, err := rdb.Do(ctx, <span class="string">&quot;BF.ADD&quot;</span>, <span class="string">&quot;bf_key&quot;</span>, <span class="string">&quot;item0&quot;</span>).Bool()</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> inserted &#123;</span><br><span class="line">		fmt.Println(<span class="string">&quot;item0 was inserted&quot;</span>)</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> _, item := <span class="keyword">range</span> []<span class="keyword">string</span>&#123;<span class="string">&quot;item0&quot;</span>, <span class="string">&quot;item1&quot;</span>&#125; &#123;</span><br><span class="line">		exists, err := rdb.Do(ctx, <span class="string">&quot;BF.EXISTS&quot;</span>, <span class="string">&quot;bf_key&quot;</span>, item).Bool()</span><br><span class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">			<span class="built_in">panic</span>(err)</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> exists &#123;</span><br><span class="line">			fmt.Printf(<span class="string">&quot;%s does exist\n&quot;</span>, item)</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			fmt.Printf(<span class="string">&quot;%s does not exist\n&quot;</span>, item)</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<h3 id="2-goç¼–ç å®ç°å¸ƒéš†è¿‡æ»¤å™¨"><a href="#2-goç¼–ç å®ç°å¸ƒéš†è¿‡æ»¤å™¨" class="headerlink" title="2,goç¼–ç å®ç°å¸ƒéš†è¿‡æ»¤å™¨"></a>2,goç¼–ç å®ç°å¸ƒéš†è¿‡æ»¤å™¨</h3><p>ç”±äºRedisçš„Bloom Filterå¹¶éRedisåŸç”Ÿè‡ªå¸¦çš„åŠŸèƒ½ï¼Œéœ€è¦å®‰è£…moduleæ‰èƒ½ä½¿ç”¨ï¼Œå¾ˆå¤šæ—¶å€™ç”Ÿäº§ç¯å¢ƒä½¿ç”¨çš„äº‘æœåŠ¡å¹¶ä¸ä¸€å®šå®Œç¾æ”¯æŒï¼Œæ‰€ä»¥éœ€è¦ä¸€ä¸ªè‡ªå·±å®ç°çš„å¸ƒéš†è¿‡æ»¤å™¨ï¼Œåœ¨è¿™é‡Œå°±ä¸é‡å¤é€ è½®å­äº†ï¼Œè¯¦è§å¼€ç®±å³ç”¨çš„<a href="https://github.com/bits-and-blooms/bloom">bloom</a>ï¼Œéå¸¸æ–¹ä¾¿ã€‚</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><h3 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h3><ul>
<li>å¸ƒéš†è¿‡æ»¤å™¨å‘Šè¯‰æˆ‘ä»¬ä¸€ä¸ªå…ƒç´ æ˜¯å¦åœ¨ä¸€ä¸ªé›†åˆé‡Œ</li>
<li>å¸ƒéš†è¿‡æ»¤å™¨éå¸¸çœå†…å­˜ç©ºé—´<h3 id="ç¼ºç‚¹"><a href="#ç¼ºç‚¹" class="headerlink" title="ç¼ºç‚¹"></a>ç¼ºç‚¹</h3></li>
<li>ä¸æ”¯æŒåˆ é™¤ å› ä¸ºå¸ƒéš†è¿‡æ»¤å™¨æ˜¯é€šè¿‡å¤šä¸ªå“ˆå¸Œå‡½æ•°æŠŠæ•°æ®æ˜ å°„åˆ°å¤šä¸ªbitä¸­ï¼Œé‚£ä¹ˆä¸åŒçš„valueå¯èƒ½æ˜ å°„åˆ°å…¶ä¸­ç›¸åŒçš„bitä¸­ï¼Œæ‰€ä»¥å¦‚æœåˆ é™¤æŸä¸€ä¸ªvalueï¼Œä¼šå½±å“æ‰€æœ‰å…¶ä»–æ˜ å°„åˆ°åŒæ ·çš„bitä¸­çš„valueã€‚</li>
<li>è¯¯åˆ¤ç‡ ç”±äºæ˜¯hashæ˜ å°„ï¼Œæ‰€ä»¥å¤šä¸ªvalueå¯èƒ½æ˜ å°„åˆ°åŒæ ·çš„bitä½ä¸­ï¼Œå¯ä»¥é€šè¿‡å¢å¤§hashçš„æ•°é‡æ¥å‡å°‘è¯¯åˆ¤ç‡ï¼Œä½†æ˜¯æ— æ³•å®Œå…¨é¿å…ã€‚</li>
<li>å¦‚æœæ€»çš„å…ƒç´ æ•°é‡å¤§äºæœ€åˆé¢„ä¼°çš„æ€»å…ƒç´ æ•°é‡ï¼Œè¯¯åˆ¤ç‡å°±ä¼šå‡é«˜ï¼Œéœ€è¦é‡æ–°æ‰©å®¹å¹¶åˆå§‹åŒ–å¸ƒéš†è¿‡æ»¤å™¨ã€‚</li>
</ul>
]]></content>
      <tags>
        <tag>æ¶æ„è®¾è®¡é‚£äº›äº‹å„¿</tag>
      </tags>
  </entry>
  <entry>
    <title>æ¶æ„è®¾è®¡é‚£äº›äº‹å„¿--ç¼“å­˜é‚£äº›äº‹å„¿(å…­)ï¼Œredis</title>
    <url>/2022/07/12/uncatalog/cl5hsfpv60000m4r706d63234/</url>
    <content><![CDATA[<hr>
<span id="more"></span>
<blockquote>
<p>ç›®å‰å„ç§ç±»å‹çš„ç¼“å­˜éƒ½æ´»è·ƒåœ¨æˆåƒä¸Šä¸‡çš„åº”ç”¨æœåŠ¡ä¸­ï¼Œè¿˜æ²¡æœ‰ä¸€ç§ç¼“å­˜æ–¹æ¡ˆå¯ä»¥è§£å†³ä¸€åˆ‡çš„ä¸šåŠ¡åœºæ™¯æˆ–æ•°æ®ç±»å‹ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®è‡ªèº«çš„ç‰¹æ®Šåœºæ™¯å’ŒèƒŒæ™¯ï¼Œé€‰æ‹©æœ€é€‚åˆçš„ç¼“å­˜æ–¹æ¡ˆã€‚ç¼“å­˜çš„ä½¿ç”¨æ˜¯ç¨‹åºå‘˜ã€æ¶æ„å¸ˆçš„å¿…å¤‡æŠ€èƒ½ï¼Œå¥½çš„ç¨‹åºå‘˜èƒ½æ ¹æ®æ•°æ®ç±»å‹ã€ä¸šåŠ¡åœºæ™¯æ¥å‡†ç¡®åˆ¤æ–­ä½¿ç”¨ä½•ç§ç±»å‹çš„ç¼“å­˜ï¼Œå¦‚ä½•ä½¿ç”¨è¿™ç§ç¼“å­˜ï¼Œä»¥æœ€å°çš„æˆæœ¬æœ€å¿«çš„æ•ˆç‡è¾¾åˆ°æœ€ä¼˜çš„ç›®çš„ã€‚</p>
</blockquote>
<p>ã€Šæ¶æ„è®¾è®¡é‚£äº›äº‹å„¿â€“ç¼“å­˜é‚£äº›äº‹å„¿ã€‹ç³»åˆ—å…±åˆ†å…­ç« ï¼š</p>
<ul>
<li><a href="https://bugkillerpro.github.io/2022/07/04/uncatalog/cl56he3gx000050r72rv69xlr/">æ¶æ„è®¾è®¡é‚£äº›äº‹å„¿â€“ç¼“å­˜é‚£äº›äº‹å„¿(ä¸€)ï¼Œç¼“å­˜çš„å‰ä¸–ä»Šç”Ÿ</a></li>
<li><a href="https://bugkillerpro.github.io/2022/07/04/uncatalog/cl58235qb0001ikr7dxwr0zu2/">æ¶æ„è®¾è®¡é‚£äº›äº‹å„¿â€“ç¼“å­˜é‚£äº›äº‹å„¿(äºŒ)ï¼Œç¼“å­˜è®¾è®¡æ¨¡å¼</a></li>
<li><a href="https://bugkillerpro.github.io/2022/07/04/uncatalog/cl58235q80000ikr72lnvg3qt/">æ¶æ„è®¾è®¡é‚£äº›äº‹å„¿â€“ç¼“å­˜é‚£äº›äº‹å„¿(ä¸‰)ï¼Œç¼“å­˜æ€§èƒ½å’Œä¸€è‡´æ€§çš„æœ€ä½³å®è·µ</a></li>
<li><a href="https://bugkillerpro.github.io/2022/07/12/uncatalog/cl5hl5x3l00000wr734tl8oua/">æ¶æ„è®¾è®¡é‚£äº›äº‹å„¿â€“ç¼“å­˜é‚£äº›äº‹å„¿(å››)ï¼Œç¼“å­˜ç©¿é€ã€ ç¼“å­˜é›ªå´© å’Œ ç¼“å­˜å‡»ç©¿</a></li>
<li><a href="https://bugkillerpro.github.io/2022/07/12/uncatalog/cl5hm81oo00000wr786z6dmjl/">æ¶æ„è®¾è®¡é‚£äº›äº‹å„¿â€“ç¼“å­˜é‚£äº›äº‹å„¿(äº”)ï¼Œå¸ƒéš†è¿‡æ»¤å™¨è¯¦è§£</a></li>
<li><a href>æ¶æ„è®¾è®¡é‚£äº›äº‹å„¿â€“ç¼“å­˜é‚£äº›äº‹å„¿(å…­)ï¼Œredis</a></li>
</ul>
<h2 id="First-of-all"><a href="#First-of-all" class="headerlink" title="First of all"></a>First of all</h2><p> å½“æˆ‘ä»¬æƒ³è¦å…¨é¢æ— è¯¯çš„äº†è§£ä¸€ä¸ªå·¥å…·çš„æ—¶å€™ï¼Œå¼ºçƒˆå»ºè®®ç›´æ¥å»è¯»å®˜æ–¹æ–‡æ¡£ï¼Œredisä¹Ÿä¸ä¾‹å¤–</p>
<ul>
<li><a href="https://redis.io/">reidså®˜æ–¹æ–‡æ¡£</a></li>
<li><a href="https://redis.uptrace.dev/">go redis</a></li>
</ul>
<h2 id="ç›®å½•"><a href="#ç›®å½•" class="headerlink" title="ç›®å½•"></a>ç›®å½•</h2><ul>
<li><p><a href="#Redis%E4%BB%8B%E7%BB%8D">è·³åˆ° Redis ä»‹ç»</a></p>
<ul>
<li><a href="#Redis%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F">Redis æ˜¯ä»€ä¹ˆï¼Ÿ</a></li>
<li><a href="#Redis%E7%89%B9%E6%80%A7">Redis ç‰¹æ€§</a></li>
<li><a href="#Redis%E5%85%B8%E5%9E%8B%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF">Redis å…¸å‹ä½¿ç”¨åœºæ™¯</a></li>
<li><a href="#Redis%E9%AB%98%E5%B9%B6%E5%8F%91%E5%8E%9F%E7%90%86">Redis é«˜å¹¶å‘åŸç†</a></li>
<li><a href="#Redis%E5%AE%89%E8%A3%85%E3%80%81%E5%90%AF%E5%8A%A8">Redis å®‰è£…ã€å¯åŠ¨</a></li>
<li>[redis conf é…ç½®æ–‡ä»¶](#redis confé…ç½®æ–‡ä»¶)</li>
</ul>
</li>
<li><p><a href="#Redis%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E5%91%BD%E4%BB%A4%E4%BD%BF%E7%94%A8">Redis æ•°æ®ç»“æ„ä¸å‘½ä»¤ä½¿ç”¨</a></p>
<ul>
<li><a href="#%E9%80%9A%E7%94%A8%E5%85%A8%E5%B1%80%E5%91%BD%E4%BB%A4">é€šç”¨å…¨å±€å‘½ä»¤</a></li>
<li><a href="#%E5%B8%B8%E7%94%A8%E5%85%A8%E5%B1%80%E5%91%BD%E4%BB%A4">å¸¸ç”¨å…¨å±€å‘½ä»¤</a></li>
<li><a href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%BD%BF%E7%94%A8">å­—ç¬¦ä¸²ä½¿ç”¨</a></li>
<li><a href="#%E5%93%88%E5%B8%8Chash">å“ˆå¸Œ hash</a></li>
<li><a href="#%E5%88%97%E8%A1%A8%EF%BC%88lists%EF%BC%89">åˆ—è¡¨ï¼ˆlistsï¼‰</a></li>
<li><a href="#set%E9%9B%86%E5%90%88%E5%92%8Czset%E6%9C%89%E5%BA%8F%E9%9B%86%E5%90%88">set é›†åˆå’Œ zset æœ‰åºé›†åˆ</a></li>
</ul>
</li>
<li><p><a href="#%E5%B0%8F%E5%8A%9F%E8%83%BD%E5%A4%A7%E7%94%A8%E5%A4%84">å°åŠŸèƒ½å¤§ç”¨å¤„</a></p>
<ul>
<li><a href="#%E6%85%A2%E6%9F%A5%E8%AF%A2%E5%88%86%E6%9E%90">æ…¢æŸ¥è¯¢åˆ†æ</a></li>
<li><a href="#Pipeline%EF%BC%88%E6%B5%81%E6%B0%B4%E7%BA%BF%EF%BC%89%E6%9C%BA%E5%88%B6">Pipelineï¼ˆæµæ°´çº¿ï¼‰æœºåˆ¶</a></li>
<li><a href="#%E4%BA%8B%E5%8A%A1%E4%B8%8ELua">äº‹åŠ¡ä¸ Lua</a></li>
<li><a href="#Bitmaps">Bitmaps</a></li>
<li><a href="#HyperLogLog">HyperLogLog</a></li>
<li><a href="#%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85">å‘å¸ƒè®¢é˜…</a></li>
<li><a href="#GEO">GEO</a></li>
</ul>
</li>
<li><p><a href="#Redis%E5%AE%A2%E6%88%B7%E7%AB%AF">Redis å®¢æˆ·ç«¯</a></p>
</li>
<li><p><a href="#%E6%8C%81%E4%B9%85%E5%8C%96%E3%80%81%E4%B8%BB%E4%BB%8E%E5%90%8C%E6%AD%A5%E4%B8%8E%E7%BC%93%E5%AD%98%E8%AE%BE%E8%AE%A1">æŒä¹…åŒ–ã€ä¸»ä»åŒæ­¥ä¸ç¼“å­˜è®¾è®¡</a></p>
<ul>
<li><a href="#%E6%8C%81%E4%B9%85%E5%8C%96">æŒä¹…åŒ–</a></li>
<li><a href="#%E4%B8%BB%E4%BB%8E%E5%90%8C%E6%AD%A5">ä¸»ä»åŒæ­¥</a></li>
<li><a href="#%E7%BC%93%E5%AD%98">ç¼“å­˜</a></li>
</ul>
</li>
<li><p><a href="#%E7%9F%A5%E8%AF%86%E6%8B%93%E5%B1%95">çŸ¥è¯†æ‹“å±•</a></p>
<ul>
<li><a href="#%E7%BC%93%E5%AD%98%E4%B8%8E%E6%95%B0%E6%8D%AE%E5%BA%93%E5%90%8C%E6%AD%A5%E7%AD%96%E7%95%A5">ç¼“å­˜ä¸æ•°æ®åº“åŒæ­¥ç­–ç•¥</a></li>
<li><a href="#%E5%88%86%E5%B8%83%E5%BC%8F%E9%94%81">åˆ†å¸ƒå¼é”</a></li>
<li><a href="#%E5%85%B3%E4%BA%8E%E9%9B%86%E7%BE%A4">å…³äºé›†ç¾¤</a></li>
</ul>
</li>
</ul>
<p id="Redisä»‹ç»"></p>   

<h2 id="Redis-ä»‹ç»"><a href="#Redis-ä»‹ç»" class="headerlink" title="Redis ä»‹ç»"></a>Redis ä»‹ç»</h2><p id="Redisæ˜¯ä»€ä¹ˆï¼Ÿ"></p>  

<h3 id="Redis-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#Redis-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="Redis æ˜¯ä»€ä¹ˆï¼Ÿ"></a>Redis æ˜¯ä»€ä¹ˆï¼Ÿ</h3><ul>
<li>Redis æ˜¯ä¸€ä¸ªå¼€æºï¼ˆBSD è®¸å¯ï¼‰çš„ï¼Œå†…å­˜ä¸­çš„æ•°æ®ç»“æ„å­˜å‚¨ç³»ç»Ÿï¼Œå®ƒå¯ä»¥ç”¨ä½œæ•°æ®åº“ã€ç¼“å­˜å’Œæ¶ˆæ¯ä¸­é—´ä»¶ï¼›</li>
<li>Redis æ”¯æŒå¤šç§ç±»å‹çš„æ•°æ®ç»“æ„ï¼Œå¦‚ å­—ç¬¦ä¸²ï¼ˆstringsï¼‰ï¼Œæ•£åˆ—ï¼ˆhashesï¼‰ï¼Œ åˆ—è¡¨ï¼ˆlistsï¼‰ï¼Œ é›†åˆï¼ˆsetsï¼‰ï¼Œ æœ‰åºé›†åˆï¼ˆsorted setsï¼‰ ï¼ŒèŒƒå›´æŸ¥è¯¢ï¼Œ bitmapsï¼Œ hyperloglogs å’Œ åœ°ç†ç©ºé—´ï¼ˆgeospatialï¼‰ ç´¢å¼•åŠå¾„æŸ¥è¯¢ï¼›</li>
<li>Redis å†…ç½®äº†å¤åˆ¶ï¼ˆreplicationï¼‰ï¼ŒLUA è„šæœ¬ï¼ˆLua scriptingï¼‰ï¼ŒLRU é©±åŠ¨äº‹ä»¶ï¼ˆLRU evictionï¼‰ï¼Œäº‹åŠ¡ï¼ˆtransactionsï¼‰å’Œä¸åŒçº§åˆ«çš„ ç£ç›˜æŒä¹…åŒ–ï¼ˆpersistenceï¼‰ï¼›</li>
<li>Redis é€šè¿‡ å“¨å…µï¼ˆSentinelï¼‰ å’Œè‡ªåŠ¨åˆ†åŒºï¼ˆClusterï¼‰æä¾›é«˜å¯ç”¨æ€§ï¼ˆhigh availabilityï¼‰ã€‚</li>
</ul>
<p id="Redisç‰¹æ€§ï¼Ÿ"></p>  

<h3 id="Redis-ç‰¹æ€§"><a href="#Redis-ç‰¹æ€§" class="headerlink" title="Redis ç‰¹æ€§"></a>Redis ç‰¹æ€§</h3><p>é€Ÿåº¦å¿«</p>
<ul>
<li>å•èŠ‚ç‚¹è¯»110000æ¬¡/sï¼Œå†™81000æ¬¡/s</li>
<li>æ•°æ®å­˜æ”¾å†…å­˜ä¸­</li>
<li>ç”¨ C è¯­è¨€å®ç°ï¼Œç¦»æ“ä½œç³»ç»Ÿæ›´è¿‘</li>
<li>å•çº¿ç¨‹æ¶æ„ï¼Œ6.0 å¼€å§‹æ”¯æŒå¤šçº¿ç¨‹ï¼ˆCPUã€IO è¯»å†™è´Ÿè·ï¼‰<br>æŒä¹…åŒ–</li>
<li>æ•°æ®çš„æ›´æ–°å°†å¼‚æ­¥åœ°ä¿å­˜åˆ°ç¡¬ç›˜ï¼ˆRDB å’Œ AOFï¼‰<br>å¤šç§æ•°æ®ç»“æ„ - ä¸ä»…ä»…æ”¯æŒç®€å•çš„ key-value ç±»å‹æ•°æ®ï¼Œè¿˜æ”¯æŒï¼šå­—ç¬¦ä¸²ã€hashã€åˆ—è¡¨ã€é›†åˆã€æœ‰åºé›†åˆï¼Œ</li>
</ul>
<p>æ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€</p>
<p>åŠŸèƒ½ä¸°å¯Œ</p>
<ul>
<li>HyperLogLogã€GEOã€å‘å¸ƒè®¢é˜…ã€Luaè„šæœ¬ã€äº‹åŠ¡ã€Pipelineã€Bitmapsï¼Œkey è¿‡æœŸ</li>
</ul>
<p>ç®€å•ç¨³å®š</p>
<ul>
<li>æºç å°‘ã€å•çº¿ç¨‹æ¨¡å‹</li>
</ul>
<p>ä¸»ä»å¤åˆ¶</p>
<p>Redis æ”¯æŒæ•°æ®çš„å¤‡ä»½ï¼ˆmaster-slaveï¼‰ä¸é›†ç¾¤ï¼ˆåˆ†ç‰‡å­˜å‚¨ï¼‰ï¼Œä»¥åŠæ‹¥æœ‰å“¨å…µç›‘æ§æœºåˆ¶ã€‚</p>
<p>Redis çš„æ‰€æœ‰æ“ä½œéƒ½æ˜¯åŸå­æ€§çš„ï¼ŒåŒæ—¶ Redis è¿˜æ”¯æŒå¯¹å‡ ä¸ªæ“ä½œåˆå¹¶åçš„åŸå­æ€§æ‰§è¡Œã€‚</p>
<p id="Rediså…¸å‹ä½¿ç”¨åœºæ™¯"></p>  

<h3 id="Redis-å…¸å‹ä½¿ç”¨åœºæ™¯"><a href="#Redis-å…¸å‹ä½¿ç”¨åœºæ™¯" class="headerlink" title="Redis å…¸å‹ä½¿ç”¨åœºæ™¯"></a>Redis å…¸å‹ä½¿ç”¨åœºæ™¯</h3><p>ç¼“å­˜<br><img src="/2022/07/12/uncatalog/cl5hsfpv60000m4r706d63234/1.png" alt="img"><br>è®¡æ•°å™¨<br><img src="/2022/07/12/uncatalog/cl5hsfpv60000m4r706d63234/2.png" alt="img"><br>æ¶ˆæ¯é˜Ÿåˆ—<br><img src="/2022/07/12/uncatalog/cl5hsfpv60000m4r706d63234/3.png" alt="img"><br>æ’è¡Œæ¦œ<br><img src="/2022/07/12/uncatalog/cl5hsfpv60000m4r706d63234/4.png" alt="img"><br>ç¤¾äº¤ç½‘ç»œ:<br><img src="/2022/07/12/uncatalog/cl5hsfpv60000m4r706d63234/5.png" alt="img"></p>
<h3 id="Redis-é«˜å¹¶å‘åŸç†"><a href="#Redis-é«˜å¹¶å‘åŸç†" class="headerlink" title="Redis é«˜å¹¶å‘åŸç†"></a>Redis é«˜å¹¶å‘åŸç†</h3><ul>
<li>Redis æ˜¯çº¯å†…å­˜æ•°æ®åº“ï¼Œä¸€èˆ¬éƒ½æ˜¯ç®€å•çš„å­˜å–æ“ä½œï¼Œçº¿ç¨‹å ç”¨çš„æ—¶é—´å¾ˆå¤šï¼Œæ—¶é—´çš„èŠ±è´¹ä¸»è¦é›†ä¸­åœ¨ IO ä¸Šï¼Œæ‰€ä»¥è¯»å–é€Ÿåº¦å¿«</li>
<li>Redis ä½¿ç”¨çš„æ˜¯IO å¤šè·¯å¤ç”¨ï¼Œä½¿ç”¨äº†å•çº¿ç¨‹æ¥è½®è¯¢æè¿°ç¬¦ï¼Œå°†æ•°æ®åº“çš„å¼€ã€å…³ã€è¯»ã€å†™éƒ½è½¬æ¢æˆäº†äº‹ä»¶ï¼Œå‡å°‘äº†çº¿ç¨‹åˆ‡æ¢æ—¶ä¸Šä¸‹æ–‡çš„åˆ‡æ¢å’Œç«äº‰ã€‚</li>
<li>Redis é‡‡ç”¨äº†å•çº¿ç¨‹çš„æ¨¡å‹ï¼Œä¿è¯äº†æ¯ä¸ªæ“ä½œçš„åŸå­æ€§ï¼Œä¹Ÿå‡å°‘äº†çº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œç«äº‰ã€‚</li>
<li>Redis å­˜å‚¨ç»“æ„å¤šæ ·åŒ–ï¼Œä¸åŒçš„æ•°æ®ç»“æ„å¯¹æ•°æ®å­˜å‚¨è¿›è¡Œäº†ä¼˜åŒ–ï¼Œå¦‚å‹ç¼©è¡¨ï¼Œå¯¹çŸ­æ•°æ®è¿›è¡Œå‹ç¼©å­˜å‚¨ï¼Œå†å¦‚ï¼Œè·³è¡¨ï¼Œä½¿ç”¨æœ‰åºçš„æ•°æ®ç»“æ„åŠ å¿«è¯»å–çš„é€Ÿåº¦ã€‚</li>
<li>Redis é‡‡ç”¨è‡ªå·±å®ç°çš„äº‹ä»¶åˆ†ç¦»å™¨ï¼Œæ•ˆç‡æ¯”è¾ƒé«˜ï¼Œå†…éƒ¨é‡‡ç”¨éé˜»å¡çš„æ‰§è¡Œæ–¹å¼ï¼Œååèƒ½åŠ›æ¯”è¾ƒå¤§ã€‚</li>
</ul>
<p>(Redisæ€§èƒ½å¾ˆå¿«çš„åŸå› <br>1ï¼‰åŸºäºå†…å­˜æ“ä½œï¼ŒRedisçš„æ‰€æœ‰æ•°æ®éƒ½å­˜åœ¨å†…å­˜ä¸­ï¼Œå› æ­¤æ‰€æœ‰çš„è¿ç®—éƒ½æ˜¯å†…å­˜çº§åˆ«çš„ï¼Œæ‰€ä»¥ä»–çš„æ€§èƒ½æ¯”è¾ƒé«˜ã€‚<br>2ï¼‰æ•°æ®ç»“æ„ç®€å•ï¼šRedisçš„æ•°æ®ç»“æ„éƒ½æ˜¯ä¸“é—¨è®¾è®¡çš„ï¼Œè€Œè¿™äº›ç®€å•çš„æ•°æ®ç»“æ„çš„æŸ¥æ‰¾å’Œæ“ä½œçš„æ—¶é—´å¤§éƒ¨åˆ†å¤æ‚åº¦éƒ½æ˜¯Oï¼ˆ1ï¼‰ï¼Œå› æ­¤æ€§èƒ½æ¯”è¾ƒå¼ºï¼Œå¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰å†™è¿‡çš„è¿™ç¯‡æ–‡ç« ã€‚æ·±å…¥ç†è§£redisâ€”â€”redisç»å…¸äº”ç§æ•°æ®ç±»å‹åŠåº•å±‚å®ç°<br>3ï¼‰å¤šè·¯å¤ç”¨å’Œéé˜»å¡I/Oï¼ŒRedisä½¿ç”¨I/Oå¤šè·¯å¤ç”¨æ¥ç›‘å¬å¤šä¸ªsocketé“¾æ¥å®¢æˆ·ç«¯ï¼Œè¿™æ ·å°±å¯ä»¥ä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹é“¾æ¥æ¥å¤„ç†å¤šä¸ªè¯·æ±‚ï¼Œå‡å°‘çº¿ç¨‹åˆ‡æ¢å¸¦æ¥çš„å¼€é”€ï¼ŒåŒæ—¶ä¹Ÿé¿å…äº†I/Oé˜»å¡æ“ä½œã€‚<br>4ï¼‰ä¸»çº¿ç¨‹ä¸ºå•çº¿ç¨‹ï¼Œé¿å…ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå› ä¸ºæ˜¯å•çº¿ç¨‹æ¨¡å‹ï¼Œå› æ­¤é¿å…äº†ä¸å¿…è¦çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œå¤šçº¿ç¨‹ç«äº‰ï¼ˆæ¯”å¦‚é”ï¼‰ï¼Œè¿™å°±çœå»äº†å¤šçº¿ç¨‹åˆ‡æ¢å¸¦æ¥çš„æ—¶é—´å’Œæ€§èƒ½ä¸Šçš„æ¶ˆè€—ï¼Œè€Œä¸”å•çº¿ç¨‹ä¸ä¼šå¯¼è‡´æ­»é”é—®é¢˜çš„å‘ç”Ÿã€‚)</p>
<h3 id="redis-å®‰è£…"><a href="#redis-å®‰è£…" class="headerlink" title="redis å®‰è£…"></a>redis å®‰è£…</h3><p><a href="https://www.cnblogs.com/hunanzp/p/12304622.html">å‚è€ƒé“¾æ¥</a></p>
<h2 id="Redis-æ•°æ®ç»“æ„ä¸å‘½ä»¤ä½¿ç”¨"><a href="#Redis-æ•°æ®ç»“æ„ä¸å‘½ä»¤ä½¿ç”¨" class="headerlink" title="Redis æ•°æ®ç»“æ„ä¸å‘½ä»¤ä½¿ç”¨"></a>Redis æ•°æ®ç»“æ„ä¸å‘½ä»¤ä½¿ç”¨</h2><p>Redis çš„æ•°æ®ç»“æ„æœ‰ï¼šstring(å­—ç¬¦ä¸²)ã€hash(å“ˆå¸Œ)ã€list(åˆ—è¡¨)ã€set(é›†åˆ)ã€zset(æœ‰åºé›† åˆ)ã€‚ä½†è¿™äº›åªæ˜¯ Redis å¯¹å¤–çš„æ•°æ®ç»“æ„ï¼Œå®é™…ä¸Šæ¯ç§æ•°æ®ç»“æ„éƒ½æœ‰è‡ªå·±åº•å±‚çš„å†…éƒ¨ç¼–ç å®ç°ï¼Œè€Œä¸”æ˜¯å¤šç§å®ç°ï¼Œ è¿™æ · Redis ä¼šåœ¨åˆé€‚çš„åœºæ™¯é€‰æ‹©åˆé€‚çš„å†…éƒ¨ç¼–ç ã€‚<br><img src="/2022/07/12/uncatalog/cl5hsfpv60000m4r706d63234/640.jpg" alt="img"><br>å¯ä»¥çœ‹åˆ°æ¯ç§æ•°æ®ç»“æ„éƒ½æœ‰ä¸¤ç§ä»¥ä¸Šçš„å†…éƒ¨ç¼–ç å®ç°ï¼Œä¾‹å¦‚ list æ•°æ®ç»“ æ„åŒ…å«äº† linkedlist å’Œ ziplist ä¸¤ç§å†…éƒ¨ç¼–ç ã€‚åŒæ—¶ï¼Œæœ‰äº›å†…éƒ¨ç¼–ç ï¼Œä¾‹å¦‚ ziplistï¼Œ å¯ä»¥ä½œä¸ºå¤šç§å¤–éƒ¨æ•°æ®ç»“æ„çš„å†…éƒ¨å®ç°ï¼Œå¯ä»¥é€šè¿‡ object encoding å‘½ä»¤æŸ¥è¯¢å†…éƒ¨ç¼–ç ã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">object encoding xxx  # xxx ä¸ºé”®å</span><br></pre></td></tr></table></figure></div>
<p>Redis æ‰€æœ‰çš„æ•°æ®ç»“æ„éƒ½æ˜¯ä»¥å”¯ä¸€çš„ key å­—ç¬¦ä¸²ä½œä¸ºåç§°ï¼Œç„¶åé€šè¿‡è¿™ä¸ªå”¯ä¸€ key å€¼æ¥è·å–ç›¸åº”çš„ value æ•°æ®ã€‚ä¸åŒç±»å‹çš„æ•°æ®ç»“ æ„çš„å·®å¼‚å°±åœ¨äº value çš„ç»“æ„ä¸ä¸€æ ·ã€‚</p>
<h3 id="é€šç”¨å…¨å±€å‘½ä»¤"><a href="#é€šç”¨å…¨å±€å‘½ä»¤" class="headerlink" title="é€šç”¨å…¨å±€å‘½ä»¤"></a>é€šç”¨å…¨å±€å‘½ä»¤</h3><h4 id="å¸¸ç”¨å…¨å±€å‘½ä»¤"><a href="#å¸¸ç”¨å…¨å±€å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å…¨å±€å‘½ä»¤"></a>å¸¸ç”¨å…¨å±€å‘½ä»¤</h4><ul>
<li>keysï¼šæŸ¥çœ‹æ‰€æœ‰é”®</li>
<li>dbsizeï¼šé”®æ€»æ•°</li>
<li>exists keyï¼šæ£€æŸ¥é”®æ˜¯å¦å­˜åœ¨</li>
<li>del key [key â€¦]ï¼šåˆ é™¤é”®</li>
<li>expire key secondsï¼šé”®è¿‡æœŸ</li>
<li>ttl key: é€šè¿‡ ttl å‘½ä»¤è§‚å¯Ÿé”®é”®çš„å‰©ä½™è¿‡æœŸæ—¶é—´</li>
<li>type keyï¼šé”®çš„æ•°æ®ç»“æ„ç±»å‹<br><img src="/2022/07/12/uncatalog/cl5hsfpv60000m4r706d63234/6401.jpg" alt="img"><br><img src="/2022/07/12/uncatalog/cl5hsfpv60000m4r706d63234/6402.jpg" alt="img"><br>æ ¹æ®ä¸Šé¢çš„å‘½ä»¤è§£é‡Šï¼Œå¤§å®¶åº”è¯¥æ¯”è¾ƒå®¹æ˜“çœ‹æ‡‚æˆªå›¾é‡Œé¢çš„æ‰€æœ‰å‘½ä»¤å«ä¹‰ï¼Œè¿™é‡Œå°±ä¸è¿‡å¤šè§£é‡Šäº†ã€‚</li>
</ul>
<h3 id="å­—ç¬¦ä¸²ä½¿ç”¨"><a href="#å­—ç¬¦ä¸²ä½¿ç”¨" class="headerlink" title="å­—ç¬¦ä¸²ä½¿ç”¨"></a>å­—ç¬¦ä¸²ä½¿ç”¨</h3><p>å­—ç¬¦ä¸² string æ˜¯ Redis æœ€ç®€å•çš„æ•°æ®ç»“æ„ã€‚Redis çš„å­—ç¬¦ä¸²æ˜¯åŠ¨æ€å­—ç¬¦ä¸²ï¼Œæ˜¯å¯ä»¥ä¿®æ”¹çš„å­—ç¬¦ä¸²ï¼Œå†…éƒ¨ç»“æ„å®ç°ä¸Šç±»ä¼¼äº Java çš„ ArrayListï¼Œé‡‡ç”¨é¢„åˆ†é…å†—ä½™ç©ºé—´çš„æ–¹å¼æ¥å‡å°‘å†…å­˜çš„é¢‘ç¹åˆ†é…ã€‚</p>
<p>å­—ç¬¦ä¸²ç»“æ„ä½¿ç”¨éå¸¸å¹¿æ³›ï¼Œä¸€ä¸ªå¸¸è§çš„ç”¨é€”å°±æ˜¯ç¼“å­˜ç”¨æˆ·ä¿¡æ¯ã€‚æˆ‘ä»¬å°†ç”¨æˆ·ä¿¡æ¯ç»“æ„ä½“ ä½¿ç”¨ JSON åºåˆ—åŒ–æˆå­—ç¬¦ä¸²ï¼Œç„¶åå°†åºåˆ—åŒ–åçš„å­—ç¬¦ä¸²å¡è¿› Redis æ¥ç¼“å­˜ã€‚åŒæ ·ï¼Œå–ç”¨æˆ· ä¿¡æ¯ä¼šç»è¿‡ä¸€æ¬¡ååºåˆ—åŒ–çš„è¿‡ç¨‹ã€‚</p>
<h4 id="å¸¸ç”¨å­—ç¬¦ä¸²å‘½ä»¤"><a href="#å¸¸ç”¨å­—ç¬¦ä¸²å‘½ä»¤" class="headerlink" title="å¸¸ç”¨å­—ç¬¦ä¸²å‘½ä»¤"></a>å¸¸ç”¨å­—ç¬¦ä¸²å‘½ä»¤</h4><ul>
<li><p>set key value [ex seconds][px milliseconds] [nx|xx]: è®¾ç½®å€¼ï¼Œè¿”å› ok è¡¨ç¤ºæˆåŠŸ</p>
<ul>
<li>ex seconds:ä¸ºé”®è®¾ç½®ç§’çº§è¿‡æœŸæ—¶é—´ã€‚</li>
<li>px milliseconds:ä¸ºé”®è®¾ç½®æ¯«ç§’çº§è¿‡æœŸæ—¶é—´ã€‚</li>
<li>nx:é”®å¿…é¡»ä¸å­˜åœ¨ï¼Œæ‰å¯ä»¥è®¾ç½®æˆåŠŸï¼Œç”¨äºæ·»åŠ ã€‚å¯å•ç‹¬ç”¨ setnx å‘½ä»¤æ›¿ä»£</li>
<li>xx:ä¸ nx ç›¸åï¼Œé”®å¿…é¡»å­˜åœ¨ï¼Œæ‰å¯ä»¥è®¾ç½®æˆåŠŸï¼Œç”¨äºæ›´æ–°ã€‚å¯å•ç‹¬ç”¨ setxx å‘½ä»¤æ›¿ä»£</li>
</ul>
</li>
<li><p>get keyï¼šè·å–å€¼</p>
</li>
<li><p>mset key value [key value â€¦]ï¼šæ‰¹é‡è®¾ç½®å€¼ï¼Œæ‰¹é‡æ“ä½œå‘½ä»¤å¯ä»¥æœ‰æ•ˆæé«˜ä¸šåŠ¡å¤„ç†æ•ˆç‡</p>
</li>
<li><p>mget key [key â€¦]ï¼šæ‰¹é‡è·å–å€¼ï¼Œæ‰¹é‡æ“ä½œå‘½ä»¤å¯ä»¥æœ‰æ•ˆæé«˜ä¸šåŠ¡å¤„ç†æ•ˆç‡</p>
</li>
<li><p>incr keyï¼šè®¡æ•°ï¼Œè¿”å›ç»“æœåˆ† 3 ç§æƒ…å†µï¼š</p>
<ul>
<li>å€¼ä¸æ˜¯æ•´æ•°ï¼Œè¿”å›é”™è¯¯ã€‚</li>
<li>å€¼æ˜¯æ•´æ•°ï¼Œè¿”å›è‡ªå¢åçš„ç»“æœã€‚</li>
<li>é”®ä¸å­˜åœ¨ï¼ŒæŒ‰ç…§å€¼ä¸º 0 è‡ªå¢ï¼Œè¿”å›ç»“æœä¸º 1ã€‚</li>
</ul>
</li>
<li><p>decr(è‡ªå‡)ã€incrby(è‡ªå¢æŒ‡å®šæ•°å­—)ã€ decrby(è‡ªå‡æŒ‡å®šæ•°å­—)</p>
<p><img src="/2022/07/12/uncatalog/cl5hsfpv60000m4r706d63234/6403.jpg" alt="img"><br><img src="/2022/07/12/uncatalog/cl5hsfpv60000m4r706d63234/6404.jpg" alt="img"></p>
</li>
</ul>
<p>æ ¹æ®ä¸Šé¢çš„å‘½ä»¤è§£é‡Šï¼Œå¤§å®¶åº”è¯¥æ¯”è¾ƒå®¹æ˜“çœ‹æ‡‚æˆªå›¾é‡Œé¢çš„æ‰€æœ‰å‘½ä»¤å«ä¹‰ï¼Œè¿™é‡Œå°±ä¸è¿‡å¤šè§£é‡Šäº†ã€‚</p>
<h3 id="å­—ç¬¦ä¸²ä½¿ç”¨åœºæ™¯"><a href="#å­—ç¬¦ä¸²ä½¿ç”¨åœºæ™¯" class="headerlink" title="å­—ç¬¦ä¸²ä½¿ç”¨åœºæ™¯"></a>å­—ç¬¦ä¸²ä½¿ç”¨åœºæ™¯</h3><ul>
<li>ç¼“å­˜æ•°æ®ï¼Œæé«˜æŸ¥è¯¢æ€§èƒ½ã€‚æ¯”å¦‚å­˜å‚¨ç™»å½•ç”¨æˆ·ä¿¡æ¯ã€ç”µå•†ä¸­å­˜å‚¨å•†å“ä¿¡æ¯</li>
<li>å¯ä»¥åšè®¡æ•°å™¨ï¼ˆæƒ³çŸ¥é“ä»€ä¹ˆæ—¶å€™å°é”ä¸€ä¸ª IP åœ°å€(è®¿é—®è¶…è¿‡å‡ æ¬¡)ï¼‰,çŸ­ä¿¡é™æµ</li>
<li>å…±äº« Sessionï¼Œä¾‹å¦‚ï¼šä¸€ä¸ªåˆ†å¸ƒå¼ Web æœåŠ¡å°†ç”¨æˆ·çš„ Session ä¿¡æ¯(ä¾‹å¦‚ç”¨æˆ·ç™»å½•ä¿¡æ¯)ä¿å­˜åœ¨å„è‡ªæœåŠ¡å™¨ä¸­ï¼Œè¿™æ ·ä¼šé€ æˆä¸€ä¸ªé—®é¢˜ï¼Œå‡ºäºè´Ÿè½½å‡è¡¡çš„è€ƒè™‘ï¼Œåˆ†å¸ƒå¼æœåŠ¡ä¼šå°†ç”¨æˆ·çš„è®¿é—®å‡è¡¡åˆ°ä¸åŒæœåŠ¡å™¨ä¸Šï¼Œç”¨æˆ·åˆ·æ–°ä¸€æ¬¡è®¿é—®å¯ èƒ½ä¼šå‘ç°éœ€è¦é‡æ–°ç™»å½•ï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨ Redis å°†ç”¨æˆ·çš„ Session è¿›è¡Œé›†ä¸­ç®¡ç†ï¼Œåœ¨è¿™ç§æ¨¡å¼ä¸‹åªè¦ä¿è¯ Redis æ˜¯é«˜å¯ç”¨å’Œæ‰©å±•æ€§çš„ï¼Œæ¯æ¬¡ç”¨æˆ· æ›´æ–°æˆ–è€…æŸ¥è¯¢ç™»å½•ä¿¡æ¯éƒ½ç›´æ¥ä» Redis ä¸­é›†ä¸­è·å–ï¼Œå¦‚å›¾ï¼š</li>
</ul>
<p><img src="/2022/07/12/uncatalog/cl5hsfpv60000m4r706d63234/6405.jpg" alt="img"><br><img src="/2022/07/12/uncatalog/cl5hsfpv60000m4r706d63234/6406.jpg" alt="img"></p>
<h3 id="å“ˆå¸Œ-hash"><a href="#å“ˆå¸Œ-hash" class="headerlink" title="å“ˆå¸Œ hash"></a>å“ˆå¸Œ hash</h3><p>å“ˆå¸Œç›¸å½“äº Java ä¸­çš„ HashMapï¼Œä»¥åŠ Js ä¸­çš„ Mapï¼Œå†…éƒ¨æ˜¯æ— åºå­—å…¸ã€‚å®ç°åŸç†è·Ÿ HashMap ä¸€è‡´ã€‚ä¸€ä¸ªå“ˆå¸Œè¡¨æœ‰å¤šä¸ªèŠ‚ç‚¹ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¿å­˜ä¸€ä¸ªé”®å€¼å¯¹ã€‚</p>
<p>ä¸ Java ä¸­çš„ HashMap ä¸åŒçš„æ˜¯ï¼Œrehash çš„æ–¹å¼ä¸ä¸€æ ·ï¼Œå› ä¸º Java çš„ HashMap åœ¨å­—å…¸å¾ˆå¤§æ—¶ï¼Œrehash æ˜¯ä¸ªè€—æ—¶çš„æ“ä½œï¼Œéœ€è¦ä¸€æ¬¡æ€§å…¨éƒ¨ rehashã€‚</p>
<p>Redis ä¸ºäº†é«˜æ€§èƒ½ï¼Œä¸èƒ½å µå¡æœåŠ¡ï¼Œæ‰€ä»¥é‡‡ç”¨äº†æ¸è¿›å¼ rehash ç­–ç•¥ã€‚</p>
<p>æ¸è¿›å¼ rehash ä¼šåœ¨ rehash çš„åŒæ—¶ï¼Œä¿ç•™æ–°æ—§ä¸¤ä¸ª hash ç»“æ„ï¼ŒæŸ¥è¯¢æ—¶ä¼šåŒæ—¶æŸ¥è¯¢ä¸¤ä¸ª hash ç»“æ„ï¼Œç„¶ååœ¨åç»­çš„å®šæ—¶ä»»åŠ¡ä¸­ä»¥åŠ hash æ“ä½œæŒ‡ä»¤ä¸­ï¼Œå¾ªåºæ¸è¿›åœ°å°†æ—§ hash çš„å†…å®¹ä¸€ç‚¹ç‚¹è¿ç§»åˆ°æ–°çš„ hash ç»“æ„ä¸­ã€‚å½“æ¬è¿å®Œæˆäº†ï¼Œå°±ä¼šä½¿ç”¨æ–°çš„ hash ç»“æ„å–è€Œä»£ä¹‹ã€‚</p>
<p>å½“ hash ç§»é™¤äº†æœ€åä¸€ä¸ªå…ƒç´ ä¹‹åï¼Œè¯¥æ•°æ®ç»“æ„è‡ªåŠ¨è¢«åˆ é™¤ï¼Œå†…å­˜è¢«å›æ”¶ã€‚</p>
<h4 id="å¸¸ç”¨å“ˆå¸Œå‘½ä»¤"><a href="#å¸¸ç”¨å“ˆå¸Œå‘½ä»¤" class="headerlink" title="å¸¸ç”¨å“ˆå¸Œå‘½ä»¤"></a>å¸¸ç”¨å“ˆå¸Œå‘½ä»¤</h4><ul>
<li>hset key field valueï¼šè®¾ç½®å€¼</li>
<li>hget key fieldï¼šè·å–å€¼</li>
<li>hdel key field [field â€¦]ï¼šåˆ é™¤ field</li>
<li>hlen keyï¼šè®¡ç®— field ä¸ªæ•°</li>
<li>hmset key field value [field value â€¦]ï¼šæ‰¹é‡è®¾ç½® field-value</li>
<li>hmget key field [field â€¦]ï¼šæ‰¹é‡è·å– field-value</li>
<li>hexists key fieldï¼šåˆ¤æ–­ field æ˜¯å¦å­˜åœ¨</li>
<li>hkeys keyï¼šè·å–æ‰€æœ‰ field</li>
<li>hvals keyï¼šè·å–æ‰€æœ‰ value</li>
<li>hgetall keyï¼šè·å–æ‰€æœ‰çš„ field-value</li>
<li>incrbyfloat å’Œ hincrbyfloat:å°±åƒ incrby å’Œ incrbyfloat å‘½ä»¤ä¸€æ ·ï¼Œä½†æ˜¯å®ƒä»¬çš„ä½œ ç”¨åŸŸæ˜¯ filed</li>
</ul>
<p><img src="/2022/07/12/uncatalog/cl5hsfpv60000m4r706d63234/6407.jpg" alt="img"><br><img src="/2022/07/12/uncatalog/cl5hsfpv60000m4r706d63234/6408.jpg" alt="img"><br>æ ¹æ®ä¸Šé¢çš„å‘½ä»¤è§£é‡Šï¼Œå¤§å®¶åº”è¯¥æ¯”è¾ƒå®¹æ˜“çœ‹æ‡‚æˆªå›¾é‡Œé¢çš„æ‰€æœ‰å‘½ä»¤å«ä¹‰ï¼Œè¿™é‡ŒåŒæ ·ä¸è¿‡å¤šè§£é‡Šäº†</p>
<h4 id="å“ˆå¸Œä½¿ç”¨åœºæ™¯"><a href="#å“ˆå¸Œä½¿ç”¨åœºæ™¯" class="headerlink" title="å“ˆå¸Œä½¿ç”¨åœºæ™¯"></a>å“ˆå¸Œä½¿ç”¨åœºæ™¯</h4><ul>
<li>Hash ä¹Ÿå¯ä»¥åŒäºå¯¹è±¡å­˜å‚¨ï¼Œæ¯”å¦‚å­˜å‚¨ç”¨æˆ·ä¿¡æ¯ï¼Œä¸å­—ç¬¦ä¸²ä¸ä¸€æ ·çš„æ˜¯ï¼Œå­—ç¬¦ä¸²æ˜¯éœ€è¦å°†å¯¹è±¡è¿›è¡Œåºåˆ—åŒ–ï¼ˆæ¯”å¦‚ json åºåˆ—åŒ–ï¼‰ä¹‹åæ‰èƒ½ä¿å­˜ï¼Œè€Œ Hash åˆ™å¯ä»¥è®²ç”¨æˆ·å¯¹è±¡çš„æ¯ä¸ªå­—æ®µå•ç‹¬å­˜å‚¨ï¼Œè¿™æ ·å°±èƒ½èŠ‚çœåºåˆ—åŒ–å’Œååºåˆ—çš„æ—¶é—´ã€‚å¦‚ä¸‹ï¼š<br><img src="/2022/07/12/uncatalog/cl5hsfpv60000m4r706d63234/640.gif" alt="img"></li>
<li>æ­¤å¤–è¿˜å¯ä»¥ä¿å­˜ç”¨æˆ·çš„è´­ä¹°è®°å½•ï¼Œæ¯”å¦‚ key ä¸ºç”¨æˆ· idï¼Œfield ä¸ºå•†å“ i dï¼Œvalue ä¸ºå•†å“æ•°é‡ã€‚åŒæ ·è¿˜å¯ä»¥ç”¨äºè´­ç‰©è½¦æ•°æ®çš„å­˜å‚¨ï¼Œæ¯”å¦‚ key ä¸ºç”¨æˆ· idï¼Œfield ä¸ºå•†å“ idï¼Œvalue ä¸ºè´­ä¹°æ•°é‡ç­‰ç­‰:<br><img src="/2022/07/12/uncatalog/cl5hsfpv60000m4r706d63234/6409.jpg" alt="img"></li>
</ul>
<h3 id="åˆ—è¡¨ï¼ˆlistsï¼‰"><a href="#åˆ—è¡¨ï¼ˆlistsï¼‰" class="headerlink" title="åˆ—è¡¨ï¼ˆlistsï¼‰"></a>åˆ—è¡¨ï¼ˆlistsï¼‰</h3><p>Redis ä¸­çš„ lists ç›¸å½“äº Java ä¸­çš„ LinkedListï¼Œå®ç°åŸç†æ˜¯ä¸€ä¸ªåŒå‘é“¾è¡¨ï¼ˆå…¶åº•å±‚æ˜¯ä¸€ä¸ªå¿«é€Ÿåˆ—è¡¨ï¼‰ï¼Œå³å¯ä»¥æ”¯æŒåå‘æŸ¥æ‰¾å’Œéå†ï¼Œæ›´æ–¹ä¾¿æ“ä½œã€‚æ’å…¥å’Œåˆ é™¤æ“ä½œéå¸¸å¿«ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(1)ï¼Œä½†æ˜¯ç´¢å¼•å®šä½å¾ˆæ…¢ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(n)ã€‚<br><img src="/2022/07/12/uncatalog/cl5hsfpv60000m4r706d63234/6401.gif" alt="img"></p>
<h4 id="å¸¸ç”¨åˆ—è¡¨å‘½ä»¤"><a href="#å¸¸ç”¨åˆ—è¡¨å‘½ä»¤" class="headerlink" title="å¸¸ç”¨åˆ—è¡¨å‘½ä»¤"></a>å¸¸ç”¨åˆ—è¡¨å‘½ä»¤</h4><ul>
<li><p>rpush key value [value â€¦]ï¼šä»å³è¾¹æ’å…¥å…ƒç´ </p>
</li>
<li><p>lpush key value [value â€¦]ï¼šä»å·¦è¾¹æ’å…¥å…ƒç´ </p>
</li>
<li><p>linsert key before|after pivot valueï¼šå‘æŸä¸ªå…ƒç´ å‰æˆ–è€…åæ’å…¥å…ƒç´ </p>
</li>
<li><p>lrange key start endï¼šè·å–æŒ‡å®šèŒƒå›´å†…çš„å…ƒç´ åˆ—è¡¨ï¼Œlrange key 0 -1å¯ä»¥ä»å·¦åˆ°å³è·å–åˆ—è¡¨çš„æ‰€æœ‰å…ƒç´ </p>
</li>
<li><p>lindex key indexï¼šè·å–åˆ—è¡¨æŒ‡å®šç´¢å¼•ä¸‹æ ‡çš„å…ƒç´ </p>
</li>
<li><p>llen keyï¼šè·å–åˆ—è¡¨é•¿åº¦</p>
</li>
<li><p>lpop keyï¼šä»åˆ—è¡¨å·¦ä¾§å¼¹å‡ºå…ƒç´ </p>
</li>
<li><p>rpop keyï¼šä»åˆ—è¡¨å³ä¾§å¼¹å‡º</p>
</li>
<li><p>lrem key count valueï¼šåˆ é™¤æŒ‡å®šå…ƒç´ ï¼Œlrem å‘½ä»¤ä¼šä»åˆ—è¡¨ä¸­æ‰¾åˆ°ç­‰äº value çš„å…ƒç´ è¿›è¡Œåˆ é™¤ï¼Œæ ¹æ® count çš„ä¸åŒ åˆ†ä¸ºä¸‰ç§æƒ…å†µ:</p>
<ul>
<li>count&gt;0ï¼Œä»å·¦åˆ°å³ï¼Œåˆ é™¤æœ€å¤š count ä¸ªå…ƒç´ ã€‚ </li>
<li>count&lt;0ï¼Œä»å³åˆ°å·¦ï¼Œåˆ é™¤æœ€å¤š count ç»å¯¹å€¼ä¸ªå…ƒç´ ã€‚</li>
<li>count=0ï¼Œåˆ é™¤æ‰€æœ‰ã€‚</li>
</ul>
</li>
<li><p>ltrim key start endï¼šæŒ‰ç…§ç´¢å¼•èŒƒå›´ä¿®å‰ªåˆ—è¡¨</p>
</li>
<li><p>lset key index newValueï¼šä¿®æ”¹æŒ‡å®šç´¢å¼•ä¸‹æ ‡çš„å…ƒç´ </p>
</li>
<li><p>blpop key [key â€¦] timeout å’Œ brpop key [key â€¦] timeoutï¼šé˜»å¡å¼å¼¹å‡º<br><img src="/2022/07/12/uncatalog/cl5hsfpv60000m4r706d63234/64010.jpg" alt="img"><br><img src="/2022/07/12/uncatalog/cl5hsfpv60000m4r706d63234/64011.jpg" alt="img"><br><img src="/2022/07/12/uncatalog/cl5hsfpv60000m4r706d63234/64012.jpg" alt="img"><br><img src="/2022/07/12/uncatalog/cl5hsfpv60000m4r706d63234/64013.jpg" alt="img"><br><img src="/2022/07/12/uncatalog/cl5hsfpv60000m4r706d63234/64014.jpg" alt="img"></p>
</li>
</ul>
<p>æ ¹æ®ä¸Šé¢çš„å‘½ä»¤è§£é‡Šï¼Œå¤§å®¶åº”è¯¥æ¯”è¾ƒå®¹æ˜“çœ‹æ‡‚æˆªå›¾é‡Œé¢çš„æ‰€æœ‰å‘½ä»¤å«ä¹‰ï¼Œè¿™é‡ŒåŒæ ·ä¸è¿‡å¤šè§£é‡Šäº†</p>
<h4 id="åˆ—è¡¨ä½¿ç”¨åœºæ™¯"><a href="#åˆ—è¡¨ä½¿ç”¨åœºæ™¯" class="headerlink" title="åˆ—è¡¨ä½¿ç”¨åœºæ™¯"></a>åˆ—è¡¨ä½¿ç”¨åœºæ™¯</h4><ul>
<li>çƒ­é”€æ¦œï¼Œæ–‡ç« åˆ—è¡¨</li>
<li>å®ç°å·¥ä½œé˜Ÿåˆ—ï¼ˆåˆ©ç”¨ lists çš„ push æ“ä½œï¼Œå°†ä»»åŠ¡å­˜åœ¨ lists ä¸­ï¼Œç„¶åå·¥ä½œçº¿ç¨‹å†ç”¨ pop æ“ä½œå°†ä»»åŠ¡å–å‡ºè¿›è¡Œæ‰§è¡Œ ï¼‰ï¼Œä¾‹å¦‚æ¶ˆæ¯é˜Ÿåˆ—</li>
<li>æœ€æ–°åˆ—è¡¨ï¼Œæ¯”å¦‚æœ€æ–°è¯„è®º</li>
</ul>
<h4 id="ä½¿ç”¨å‚è€ƒï¼š"><a href="#ä½¿ç”¨å‚è€ƒï¼š" class="headerlink" title="ä½¿ç”¨å‚è€ƒï¼š"></a>ä½¿ç”¨å‚è€ƒï¼š</h4><ul>
<li>lpush+lpop=Stack(æ ˆ)</li>
<li>lpush+rpop=Queue(é˜Ÿåˆ—)</li>
<li>lpsh+ltrim=Capped Collection(æœ‰é™é›†åˆ)</li>
<li>lpush+brpop=Message Queue(æ¶ˆæ¯é˜Ÿåˆ—)</li>
</ul>
<h3 id="set-é›†åˆå’Œ-zset-æœ‰åºé›†åˆ"><a href="#set-é›†åˆå’Œ-zset-æœ‰åºé›†åˆ" class="headerlink" title="set é›†åˆå’Œ zset æœ‰åºé›†åˆ"></a>set é›†åˆå’Œ zset æœ‰åºé›†åˆ</h3><p>Redis çš„é›†åˆç›¸å½“äº Java è¯­è¨€é‡Œé¢çš„ HashSet å’Œ JS é‡Œé¢çš„ Setï¼Œå®ƒå†…éƒ¨çš„é”®å€¼å¯¹æ˜¯æ— åºçš„å”¯ä¸€çš„ã€‚Set é›†åˆä¸­æœ€åä¸€ä¸ª value è¢«ç§»é™¤åï¼Œæ•°æ®ç»“æ„è‡ªåŠ¨åˆ é™¤ï¼Œå†…å­˜è¢«å›æ”¶ã€‚</p>
<p>zset å¯èƒ½æ˜¯ Redis æä¾›çš„æœ€ä¸ºç‰¹è‰²çš„æ•°æ®ç»“æ„ï¼Œå®ƒä¹Ÿæ˜¯åœ¨é¢è¯•ä¸­é¢è¯•å®˜æœ€çˆ±é—®çš„æ•°æ®ç»“æ„ã€‚å®ƒç±»ä¼¼äº Java çš„ SortedSet å’Œ HashMap çš„ç»“åˆä½“ï¼Œä¸€æ–¹é¢å®ƒæ˜¯ä¸€ä¸ª setï¼Œä¿è¯äº†å†…éƒ¨ value çš„å”¯ä¸€æ€§ï¼Œå¦ä¸€æ–¹é¢å®ƒå¯ä»¥ç»™æ¯ä¸ª value èµ‹äºˆä¸€ä¸ª scoreï¼Œä»£è¡¨è¿™ä¸ª value çš„æ’åºæƒé‡ã€‚å®ƒçš„å†…éƒ¨å®ç°ç”¨çš„æ˜¯ä¸€ç§å«ç€ã€Œè·³è·ƒåˆ—è¡¨ã€(åé¢ä¼šç®€å•ä»‹ç»)çš„æ•°æ®ç»“æ„ã€‚</p>
<h4 id="å¸¸ç”¨é›†åˆå‘½ä»¤"><a href="#å¸¸ç”¨é›†åˆå‘½ä»¤" class="headerlink" title="å¸¸ç”¨é›†åˆå‘½ä»¤"></a>å¸¸ç”¨é›†åˆå‘½ä»¤</h4><ul>
<li>sadd key element [element â€¦]ï¼šæ·»åŠ å…ƒç´ ï¼Œè¿”å›ç»“æœä¸ºæ·»åŠ æˆåŠŸçš„å…ƒç´ ä¸ªæ•°</li>
<li>srem key element [element â€¦]ï¼šåˆ é™¤å…ƒç´ ï¼Œè¿”å›ç»“æœä¸ºæˆåŠŸåˆ é™¤å…ƒç´ ä¸ªæ•°</li>
<li>smembers keyï¼šè·å–æ‰€æœ‰å…ƒç´ </li>
<li>sismember key elementï¼šåˆ¤æ–­å…ƒç´ æ˜¯å¦åœ¨é›†åˆä¸­ï¼Œå¦‚æœç»™å®šå…ƒç´  element åœ¨é›†åˆå†…è¿”å› 1ï¼Œåä¹‹è¿”å› 0</li>
<li>scard keyï¼šè®¡ç®—å…ƒç´ ä¸ªæ•°ï¼Œscard çš„æ—¶é—´å¤æ‚åº¦ä¸º O(1)ï¼Œå®ƒä¸ä¼šéå†é›†åˆæ‰€æœ‰å…ƒç´ </li>
<li>spop keyï¼šä»é›†åˆéšæœºå¼¹å‡ºå…ƒç´ ï¼Œä» 3.2 ç‰ˆæœ¬å¼€å§‹ï¼Œspop ä¹Ÿæ”¯æŒ[count]å‚æ•°ã€‚</li>
<li>srandmember key [count]ï¼šéšæœºä»é›†åˆè¿”å›æŒ‡å®šä¸ªæ•°å…ƒç´ ï¼Œ[count]æ˜¯å¯é€‰å‚æ•°ï¼Œå¦‚æœä¸å†™é»˜è®¤ä¸º 1</li>
<li>sinter key [key â€¦]ï¼šæ±‚å¤šä¸ªé›†åˆçš„äº¤é›†</li>
<li>suinon key [key â€¦]ï¼šæ±‚å¤šä¸ªé›†åˆçš„å¹¶é›†</li>
<li>sdiff key [key â€¦]ï¼šæ±‚å¤šä¸ªé›†åˆçš„å·®é›†</li>
</ul>
<p><img src="/2022/07/12/uncatalog/cl5hsfpv60000m4r706d63234/64015.jpg" alt="img"></p>
<h4 id="å¸¸ç”¨æœ‰åºé›†åˆå‘½ä»¤"><a href="#å¸¸ç”¨æœ‰åºé›†åˆå‘½ä»¤" class="headerlink" title="å¸¸ç”¨æœ‰åºé›†åˆå‘½ä»¤"></a>å¸¸ç”¨æœ‰åºé›†åˆå‘½ä»¤</h4><ul>
<li><p>zadd key score member [score member â€¦]ï¼šæ·»åŠ æˆå‘˜ï¼Œè¿”å›ç»“æœä»£è¡¨æˆåŠŸæ·»åŠ æˆå‘˜çš„ä¸ªæ•°ã€‚Redis3.2 ä¸º zadd å‘½ä»¤æ·»åŠ äº† nxã€xxã€chã€incr å››ä¸ªé€‰é¡¹:</p>
<ul>
<li>nx:member å¿…é¡»ä¸å­˜åœ¨ï¼Œæ‰å¯ä»¥è®¾ç½®æˆåŠŸï¼Œç”¨äºæ·»åŠ </li>
<li>xx:member å¿…é¡»å­˜åœ¨ï¼Œæ‰å¯ä»¥è®¾ç½®æˆåŠŸï¼Œç”¨äºæ›´æ–°</li>
<li>ch:è¿”å›æ­¤æ¬¡æ“ä½œåï¼Œæœ‰åºé›†åˆå…ƒç´ å’Œåˆ†æ•°å‘ç”Ÿå˜åŒ–çš„ä¸ªæ•°</li>
<li>incr:å¯¹ score åšå¢åŠ ï¼Œç›¸å½“äºåé¢ä»‹ç»çš„ zincrby</li>
</ul>
</li>
<li><p>zcard keyï¼šè®¡ç®—æˆå‘˜ä¸ªæ•°</p>
</li>
<li><p>zscore key memberï¼šè®¡ç®—æŸä¸ªæˆå‘˜çš„åˆ†æ•°</p>
</li>
<li><p>zrank key member å’Œ zrevrank key memberï¼šè®¡ç®—æˆå‘˜çš„æ’åï¼Œzrank æ˜¯ä»åˆ†æ•°ä»ä½åˆ°é«˜è¿”å›æ’åï¼Œzrevrank åä¹‹</p>
</li>
<li><p>zrem key member [member â€¦]ï¼šåˆ é™¤æˆå‘˜</p>
</li>
<li><p>zincrby key increment memberï¼šå¢åŠ æˆå‘˜çš„åˆ†æ•°</p>
</li>
<li><p>zrange key start end [withscores] å’Œ zrevrange key start end [withscores]ï¼šè¿”å›æŒ‡å®šæ’åèŒƒå›´çš„æˆå‘˜ï¼Œzrange æ˜¯ä»ä½åˆ°é«˜è¿”å›ï¼Œzrevrange åä¹‹ã€‚</p>
</li>
<li><p>zrangebyscore key min max [withscores][limit offset count] å’Œ zrevrangebyscore key max min [withscores][limit offset count] è¿”å›æŒ‡å®šåˆ†æ•°èŒƒå›´çš„æˆå‘˜ï¼Œå…¶ä¸­ zrangebyscore æŒ‰ç…§åˆ†æ•°ä»ä½åˆ°é«˜è¿”å›ï¼Œzrevrangebyscore åä¹‹</p>
</li>
<li><p>zcount key min maxï¼šè¿”å›æŒ‡å®šåˆ†æ•°èŒƒå›´æˆå‘˜ä¸ªæ•°</p>
</li>
<li><p>zremrangebyrank key start endï¼šåˆ é™¤æŒ‡å®šæ’åå†…çš„å‡åºå…ƒç´ </p>
</li>
<li><p>zremrangebyscore key min maxï¼šåˆ é™¤æŒ‡å®šåˆ†æ•°èŒƒå›´çš„æˆå‘˜</p>
</li>
<li><p>zinterstore å’Œ zunionstore å‘½ä»¤æ±‚é›†åˆçš„äº¤é›†å’Œå¹¶é›†ï¼Œå¯ç”¨å‚æ•°æ¯”è¾ƒå¤šï¼Œå¯ç”¨åˆ°å†æŸ¥æ–‡æ¡£</p>
</li>
</ul>
<p>æœ‰åºé›†åˆç›¸æ¯”é›†åˆæä¾›äº†æ’åºå­—æ®µï¼Œä½†æ˜¯ä¹Ÿäº§ç”Ÿäº†ä»£ä»·ï¼Œzadd çš„æ—¶é—´ å¤æ‚åº¦ä¸º O(log(n))ï¼Œsadd çš„æ—¶é—´å¤æ‚åº¦ä¸º O(1)ã€‚</p>
<p><img src="/2022/07/12/uncatalog/cl5hsfpv60000m4r706d63234/64016.jpg" alt="img"></p>
<h4 id="é›†åˆå’Œæœ‰åºé›†åˆä½¿ç”¨åœºæ™¯"><a href="#é›†åˆå’Œæœ‰åºé›†åˆä½¿ç”¨åœºæ™¯" class="headerlink" title="é›†åˆå’Œæœ‰åºé›†åˆä½¿ç”¨åœºæ™¯"></a>é›†åˆå’Œæœ‰åºé›†åˆä½¿ç”¨åœºæ™¯</h4><ul>
<li>ç»™ç”¨æˆ·æ·»åŠ æ ‡ç­¾</li>
<li>ç»™æ ‡ç­¾æ·»åŠ ç”¨æˆ·</li>
<li>æ ¹æ®æŸä¸ªæƒé‡è¿›è¡Œæ’åºçš„é˜Ÿåˆ—çš„åœºæ™¯ï¼Œæ¯”å¦‚æ¸¸æˆç§¯åˆ†æ’è¡Œæ¦œï¼Œè®¾ç½®ä¼˜å…ˆçº§çš„ä»»åŠ¡åˆ—è¡¨ï¼Œå­¦ç”Ÿæˆç»©è¡¨ç­‰</li>
</ul>
<p><img src="/2022/07/12/uncatalog/cl5hsfpv60000m4r706d63234/6402.gif" alt="img"></p>
<h4 id="å…³äºè·³è·ƒåˆ—è¡¨"><a href="#å…³äºè·³è·ƒåˆ—è¡¨" class="headerlink" title="å…³äºè·³è·ƒåˆ—è¡¨"></a>å…³äºè·³è·ƒåˆ—è¡¨</h4><p>è·³è·ƒåˆ—è¡¨å°±æ˜¯ä¸€ç§å±‚çº§åˆ¶ï¼Œæœ€ä¸‹é¢ä¸€å±‚æ‰€æœ‰çš„å…ƒç´ éƒ½ä¼šä¸²èµ·æ¥ã€‚ç„¶åæ¯éš”å‡ ä¸ªå…ƒç´ æŒ‘é€‰å‡ºä¸€ä¸ªä»£è¡¨æ¥ï¼Œå†å°†è¿™å‡ ä¸ªä»£è¡¨ä½¿ç”¨å¦å¤–ä¸€çº§æŒ‡é’ˆä¸²èµ·æ¥ã€‚ç„¶ååœ¨è¿™äº›ä»£è¡¨é‡Œå†æŒ‘å‡ºäºŒçº§ä»£è¡¨ï¼Œå†ä¸²èµ·æ¥ã€‚æœ€ç»ˆå°±å½¢æˆäº†é‡‘å­—å¡”ç»“æ„ï¼Œå¦‚å›¾ï¼š<br><img src="/2022/07/12/uncatalog/cl5hsfpv60000m4r706d63234/64017.jpg" alt="img"><br><a href="https://www.jianshu.com/p/09c3b0835ba6">è·³è¡¨å‚è€ƒ</a></p>
<h4 id="åˆ—è¡¨ã€é›†åˆå’Œæœ‰åºé›†åˆå¼‚åŒ"><a href="#åˆ—è¡¨ã€é›†åˆå’Œæœ‰åºé›†åˆå¼‚åŒ" class="headerlink" title="åˆ—è¡¨ã€é›†åˆå’Œæœ‰åºé›†åˆå¼‚åŒ"></a>åˆ—è¡¨ã€é›†åˆå’Œæœ‰åºé›†åˆå¼‚åŒ</h4><p><img src="/2022/07/12/uncatalog/cl5hsfpv60000m4r706d63234/64018.jpg" alt="img"></p>
<h2 id="å°åŠŸèƒ½å¤§ç”¨å¤„"><a href="#å°åŠŸèƒ½å¤§ç”¨å¤„" class="headerlink" title="å°åŠŸèƒ½å¤§ç”¨å¤„"></a>å°åŠŸèƒ½å¤§ç”¨å¤„</h2><h3 id="æ…¢æŸ¥è¯¢åˆ†æ"><a href="#æ…¢æŸ¥è¯¢åˆ†æ" class="headerlink" title="æ…¢æŸ¥è¯¢åˆ†æ"></a>æ…¢æŸ¥è¯¢åˆ†æ</h3><p>è®¸å¤šå­˜å‚¨ç³»ç»Ÿï¼ˆä¾‹å¦‚ MySQLï¼‰æä¾›æ…¢æŸ¥è¯¢æ—¥å¿—å¸®åŠ©å¼€å‘å’Œè¿ç»´äººå‘˜å®šä½ç³»ç»Ÿå­˜åœ¨çš„æ…¢æ“ä½œã€‚</p>
<p>æ‰€è°“æ…¢æŸ¥è¯¢æ—¥å¿—å°±æ˜¯ç³»ç»Ÿåœ¨å‘½ä»¤æ‰§è¡Œå‰åè®¡ç®—æ¯æ¡å‘½ä»¤çš„æ‰§è¡Œæ—¶é—´ï¼Œå½“è¶…è¿‡é¢„è®¾é˜ˆå€¼ï¼Œå°±å°†è¿™æ¡å‘½ä»¤çš„ç›¸å…³ä¿¡æ¯ï¼ˆä¾‹å¦‚ï¼šå‘ç”Ÿæ—¶é—´ï¼Œè€—æ—¶ï¼Œå‘½ä»¤çš„è¯¦ç»†ä¿¡æ¯ï¼‰è®°å½•ä¸‹æ¥ï¼ŒRedis ä¹Ÿæä¾›äº†ç±»ä¼¼çš„åŠŸèƒ½ã€‚è¿™é‡Œå¯ä»¥é¡ºå¸¦äº†è§£ä¸€ä¸‹ Redis å®¢æˆ·ç«¯æ‰§è¡Œä¸€æ¡å‘½ä»¤çš„è¿‡ç¨‹ï¼Œåˆ†ä¸ºå¦‚ä¸‹ 4 ä¸ªéƒ¨åˆ†ï¼š</p>
<p><img src="/2022/07/12/uncatalog/cl5hsfpv60000m4r706d63234/64019.jpg" alt="img"></p>
<p>å¯¹äºæ…¢æŸ¥è¯¢åŠŸèƒ½ï¼Œéœ€è¦æ˜ç¡® 3 ä»¶äº‹ï¼š</p>
<p>1ã€é¢„è®¾é˜ˆå€¼æ€ä¹ˆè®¾ç½®ï¼Ÿ</p>
<p>åœ¨ redis é…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹é…ç½® â€˜slowlog-log-slower-thanâ€™ çš„å€¼ï¼Œå•ä½æ˜¯å¾®å¦™ï¼ˆ1 ç§’ = 1000 æ¯«ç§’ = 1000000 å¾®ç§’ï¼‰ï¼Œé»˜è®¤æ˜¯ 10000 å¾®ç§’ï¼Œå¦‚æœæŠŠ slowlog-log-slower-than è®¾ç½®ä¸º 0ï¼Œå°†ä¼šè®°å½•æ‰€æœ‰å‘½ä»¤åˆ°æ—¥å¿—ä¸­ã€‚å¦‚æœæŠŠ slowlog-log-slower-than è®¾ç½®å°äº 0ï¼Œå°†ä¼šä¸è®°å½•ä»»ä½•å‘½ä»¤åˆ°æ—¥å¿—ä¸­ã€‚</p>
<p>2ã€æ…¢æŸ¥è¯¢è®°å½•å­˜æ”¾åœ¨å“ªï¼Ÿ</p>
<p>åœ¨ redis é…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹é…ç½® â€˜slowlog-max-lenâ€™ çš„å€¼ã€‚slowlog-max-len çš„ä½œç”¨æ˜¯æŒ‡å®šæ…¢æŸ¥è¯¢æ—¥å¿—æœ€å¤šå­˜å‚¨çš„æ¡æ•°ã€‚å®é™…ä¸Šï¼ŒRedis ä½¿ç”¨äº†ä¸€ä¸ªåˆ—è¡¨å­˜æ”¾æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œslowlog-max-len å°±æ˜¯è¿™ä¸ªåˆ—è¡¨çš„æœ€å¤§é•¿åº¦ã€‚å½“ä¸€ä¸ªæ–°çš„å‘½ä»¤æ»¡è¶³æ»¡è¶³æ…¢æŸ¥è¯¢æ¡ä»¶æ—¶ï¼Œè¢«æ’å…¥è¿™ä¸ªåˆ—è¡¨ä¸­ã€‚å½“æ…¢æŸ¥è¯¢æ—¥å¿—åˆ—è¡¨å·²ç»è¾¾åˆ°æœ€å¤§é•¿åº¦æ—¶ï¼Œæœ€æ—©æ’å…¥çš„é‚£æ¡å‘½ä»¤å°†è¢«ä»åˆ—è¡¨ä¸­ç§»å‡ºã€‚æ¯”å¦‚ï¼Œslowlog-max-len è¢«è®¾ç½®ä¸º 10ï¼Œå½“æœ‰ç¬¬ 11 æ¡å‘½ä»¤æ’å…¥æ—¶ï¼Œåœ¨åˆ—è¡¨ä¸­çš„ç¬¬ 1 æ¡å‘½ä»¤å…ˆè¢«ç§»å‡ºï¼Œç„¶åå†æŠŠç¬¬ 11 æ¡å‘½ä»¤æ”¾å…¥åˆ—è¡¨ã€‚</p>
<p>è®°å½•æ…¢æŸ¥è¯¢æŒ‡ Redis ä¼šå¯¹é•¿å‘½ä»¤è¿›è¡Œæˆªæ–­ï¼Œä¸ä¼šå¤§é‡å ç”¨å¤§é‡å†…å­˜ã€‚åœ¨å®é™…çš„ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œä¸ºäº†å‡ç¼“æ…¢æŸ¥è¯¢è¢«ç§»å‡ºçš„å¯èƒ½å’Œæ›´æ–¹ä¾¿åœ°å®šä½æ…¢æŸ¥è¯¢ï¼Œå»ºè®®å°†æ…¢æŸ¥è¯¢æ—¥å¿—çš„é•¿åº¦è°ƒæ•´çš„å¤§ä¸€äº›ã€‚æ¯”å¦‚å¯ä»¥è®¾ç½®ä¸º 1000 ä»¥ä¸Šã€‚</p>
<p>é™¤äº†å»é…ç½®æ–‡ä»¶ä¸­ä¿®æ”¹ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ config set å‘½ä»¤åŠ¨æ€ä¿®æ”¹é…ç½®</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> config <span class="built_in">set</span> slowlog-log-slower-than 1000</span></span><br><span class="line">OK</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> config <span class="built_in">set</span> slowlog-max-len 1200</span></span><br><span class="line">OK</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> config rewrite</span></span><br><span class="line">OK</span><br></pre></td></tr></table></figure></div>

<p>3ã€å¦‚ä½•è·å–æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Ÿ</p>
<p>å¯ä»¥ä½¿ç”¨ slowlog get å‘½ä»¤è·å–æ…¢æŸ¥è¯¢æ—¥å¿—ï¼Œåœ¨ slowlog get åé¢è¿˜å¯ä»¥åŠ ä¸€ä¸ªæ•°å­—ï¼Œç”¨äºæŒ‡å®šè·å–æ…¢æŸ¥è¯¢æ—¥å¿—çš„æ¡æ•°ï¼Œæ¯”å¦‚ï¼Œè·å– 2 æ¡æ…¢æŸ¥è¯¢æ—¥å¿—ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">&gt;</span><span class="bash"> slowlog get 3</span></span><br><span class="line">1) 1) (integer) 6107</span><br><span class="line">   2) (integer) 1616398930</span><br><span class="line">   3) (integer) 3109</span><br><span class="line">   4) 1) &quot;config&quot;</span><br><span class="line">      2) &quot;rewrite&quot;</span><br><span class="line">2) 1) (integer) 6106</span><br><span class="line">   2) (integer) 1613701788</span><br><span class="line">   3) (integer) 36004</span><br><span class="line">   4) 1) &quot;flushall&quot;</span><br></pre></td></tr></table></figure></div>

<p>å¯ä»¥çœ‹å‡ºæ¯ä¸€æ¡æ…¢æŸ¥è¯¢æ—¥å¿—éƒ½æœ‰ 4 ä¸ªå±æ€§ç»„æˆï¼š</p>
<p> 1,å”¯ä¸€æ ‡è¯† ID<br> 2,å‘½ä»¤æ‰§è¡Œçš„æ—¶é—´æˆ³<br> 3,å‘½ä»¤æ‰§è¡Œæ—¶é•¿<br> 4,æ‰§è¡Œçš„å‘½åå’Œå‚æ•°<br>æ­¤å¤–ï¼Œå¯ä»¥é€šè¿‡ slowlog len å‘½ä»¤è·å–æ…¢æŸ¥è¯¢æ—¥å¿—çš„é•¿åº¦ï¼›é€šè¿‡ slowlog reset å‘½ä»¤æ¸…ç†æ…¢æŸ¥è¯¢æ—¥å¿—ã€‚</p>
<h3 id="Pipelineï¼ˆæµæ°´çº¿ï¼‰æœºåˆ¶"><a href="#Pipelineï¼ˆæµæ°´çº¿ï¼‰æœºåˆ¶" class="headerlink" title="Pipelineï¼ˆæµæ°´çº¿ï¼‰æœºåˆ¶"></a>Pipelineï¼ˆæµæ°´çº¿ï¼‰æœºåˆ¶</h3><p>Redis æä¾›äº†æ‰¹é‡æ“ä½œå‘½ä»¤ï¼ˆä¾‹å¦‚ mgetã€mset ç­‰ï¼‰ï¼Œæœ‰æ•ˆåœ°èŠ‚çº¦ RTTã€‚ä½†å¤§éƒ¨åˆ†å‘½ä»¤æ˜¯ä¸æ”¯æŒæ‰¹é‡æ“ä½œçš„ï¼Œä¾‹å¦‚è¦æ‰§è¡Œ n æ¬¡ hgetall å‘½ä»¤ï¼Œå¹¶æ²¡æœ‰ mhgetall å‘½ä»¤å­˜åœ¨ï¼Œéœ€è¦æ¶ˆè€— n æ¬¡ RTTã€‚</p>
<p>Redis çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å¯èƒ½éƒ¨ç½²åœ¨ä¸åŒçš„æœºå™¨ä¸Šã€‚ä¾‹å¦‚å®¢æˆ·ç«¯åœ¨åŒ—äº¬ï¼ŒRedis æœåŠ¡ç«¯åœ¨ä¸Šæµ·ï¼Œä¸¤åœ°ç›´çº¿è·ç¦»çº¦ä¸º 1300 å…¬é‡Œï¼Œé‚£ä¹ˆ 1 æ¬¡ RTT æ—¶é—´ = 1300Ã—2/(300000Ã—2/3) = 13 æ¯«ç§’ï¼ˆå…‰åœ¨çœŸç©ºä¸­ ä¼ è¾“é€Ÿåº¦ä¸ºæ¯ç§’ 30 ä¸‡å…¬é‡Œï¼Œè¿™é‡Œå‡è®¾å…‰çº¤ä¸ºå…‰é€Ÿçš„ 2/3ï¼‰ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯åœ¨ 1 ç§’ å†…å¤§çº¦åªèƒ½æ‰§è¡Œ 80 æ¬¡å·¦å³çš„å‘½ä»¤ï¼Œè¿™ä¸ªå’Œ Redis çš„é«˜å¹¶å‘é«˜ååç‰¹æ€§èƒŒé“è€Œé©°ã€‚</p>
<p>Pipelineï¼ˆæµæ°´çº¿ï¼‰æœºåˆ¶èƒ½æ”¹å–„ä¸Šé¢è¿™ç±»é—®é¢˜ï¼Œå®ƒèƒ½å°†ä¸€ç»„ Redis å‘½ä»¤è¿› è¡Œç»„è£…ï¼Œé€šè¿‡ä¸€æ¬¡ RTT ä¼ è¾“ç»™ Redisï¼Œå†å°†è¿™ç»„ Redis å‘½ä»¤çš„æ‰§è¡Œç»“æœæŒ‰é¡ºåºè¿”å›ç»™å®¢æˆ·ç«¯ã€‚</p>
<p>ä¸ä½¿ç”¨ Pipeline çš„å‘½ä»¤æ‰§è¡Œæµç¨‹ï¼š</p>
<p><img src="/2022/07/12/uncatalog/cl5hsfpv60000m4r706d63234/64020.jpg" alt="img"><br>ä½¿ç”¨ Pipeline çš„å‘½ä»¤æ‰§è¡Œæµç¨‹ï¼š<br><img src="/2022/07/12/uncatalog/cl5hsfpv60000m4r706d63234/64021.jpg" alt="img"><br>Redis çš„æµæ°´çº¿æ˜¯ä¸€ç§é€šä¿¡åè®®ï¼Œæ²¡æœ‰åŠæ³•é€šè¿‡å®¢æˆ·ç«¯æ¼”ç¤ºç»™å¤§å®¶ï¼Œè¿™é‡Œä»¥ Jedis ä¸ºä¾‹ï¼Œé€šè¿‡ Java API æˆ–è€…ä½¿ç”¨ Spring æ“ä½œå®ƒï¼ˆä»£ç æ¥æºäºäº’è”ç½‘ï¼‰ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JAVASCRIPT"><figure class="iseeu highlight /javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æµ‹è¯•Redisæµæ°´çº¿</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author <span class="variable">liu</span></span></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">publicclass TestPipelined &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä½¿ç”¨Java APIæµ‹è¯•æµæ°´çº¿çš„æ€§èƒ½</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    @SuppressWarnings(&#123; <span class="string">&quot;unused&quot;</span>, <span class="string">&quot;resource&quot;</span> &#125;)</span><br><span class="line">    @Test</span><br><span class="line">    public <span class="keyword">void</span> <span class="function"><span class="title">testPipelinedByJavaAPI</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        JedisPoolConfig jedisPoolConfig = <span class="keyword">new</span> JedisPoolConfig();</span><br><span class="line">        jedisPoolConfig.setMaxIdle(<span class="number">20</span>);</span><br><span class="line">        jedisPoolConfig.setMaxTotal(<span class="number">10</span>);</span><br><span class="line">        jedisPoolConfig.setMaxWaitMillis(<span class="number">20000</span>);</span><br><span class="line"></span><br><span class="line">        JedisPool jedisPool = <span class="keyword">new</span> JedisPool(jedisPoolConfig,<span class="string">&quot;localhost&quot;</span>,<span class="number">6379</span>);</span><br><span class="line">        Jedis jedis = jedisPool.getResource();</span><br><span class="line">        long start = System.currentTimeMillis();</span><br><span class="line">        <span class="comment">// å¼€å¯æµæ°´çº¿</span></span><br><span class="line">        Pipeline pipeline = jedis.pipelined();</span><br><span class="line">        <span class="comment">// æµ‹è¯•10wæ¡æ•°æ®è¯»å†™</span></span><br><span class="line">        <span class="keyword">for</span>(int i = <span class="number">0</span>; i &lt; <span class="number">100000</span>; i++) &#123;</span><br><span class="line">            int j = i + <span class="number">1</span>;</span><br><span class="line">            pipeline.set(<span class="string">&quot;key&quot;</span> + j, <span class="string">&quot;value&quot;</span> + j);</span><br><span class="line">            pipeline.get(<span class="string">&quot;key&quot;</span> + j);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// åªæ‰§è¡ŒåŒæ­¥ä½†ä¸è¿”å›ç»“æœ</span></span><br><span class="line">        <span class="comment">//pipeline.sync();</span></span><br><span class="line">        <span class="comment">// ä»¥listçš„å½¢å¼è¿”å›æ‰§è¡Œè¿‡çš„å‘½ä»¤çš„ç»“æœ</span></span><br><span class="line">        List&lt;<span class="built_in">Object</span>&gt; result = pipeline.syncAndReturnAll();</span><br><span class="line">        long end = System.currentTimeMillis();</span><br><span class="line">        <span class="comment">// è®¡ç®—è€—æ—¶</span></span><br><span class="line">        System.out.println(<span class="string">&quot;è€—æ—¶&quot;</span> + (end - start) + <span class="string">&quot;æ¯«ç§’&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * ä½¿ç”¨RedisTemplateæµ‹è¯•æµæ°´çº¿</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    @SuppressWarnings(&#123; <span class="string">&quot;resource&quot;</span>, <span class="string">&quot;rawtypes&quot;</span>, <span class="string">&quot;unchecked&quot;</span>, <span class="string">&quot;unused&quot;</span> &#125;)</span><br><span class="line">    @Test</span><br><span class="line">    public <span class="keyword">void</span> <span class="function"><span class="title">testPipelineBySpring</span>(<span class="params"></span>)</span> &#123;</span><br><span class="line">        ApplicationContext applicationContext = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;spring.xml&quot;</span>);</span><br><span class="line">        RedisTemplate rt = (RedisTemplate)applicationContext.getBean(<span class="string">&quot;redisTemplate&quot;</span>);</span><br><span class="line">        SessionCallback callback = (SessionCallback)(RedisOperations ops)-&gt;&#123;</span><br><span class="line">            <span class="keyword">for</span>(int i = <span class="number">0</span>; i &lt; <span class="number">100000</span>; i++) &#123;</span><br><span class="line">                int j = i + <span class="number">1</span>;</span><br><span class="line">                ops.boundValueOps(<span class="string">&quot;key&quot;</span> + j).set(<span class="string">&quot;value&quot;</span> + j);</span><br><span class="line">                ops.boundValueOps(<span class="string">&quot;key&quot;</span> + j).get();</span><br><span class="line">            &#125;</span><br><span class="line">            returnnull;</span><br><span class="line">        &#125;;</span><br><span class="line">        long start = System.currentTimeMillis();</span><br><span class="line">        <span class="comment">// æ‰§è¡ŒRedisçš„æµæ°´çº¿å‘½ä»¤</span></span><br><span class="line">        List result = rt.executePipelined(callback);</span><br><span class="line">        long end = System.currentTimeMillis();</span><br><span class="line">        System.out.println(end - start);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>ç½‘ä¸Šå†™çš„æµ‹è¯•ç»“æœä¸ºï¼šä½¿ç”¨ Java API è€—æ—¶åœ¨ 550ms åˆ° 700ms ä¹‹é—´ï¼Œä¹Ÿå°±æ˜¯ä¸åˆ° 1s å°±å®Œæˆäº† 10 ä¸‡æ¬¡è¯»å†™ï¼Œä½¿ç”¨ Spring è€—æ—¶åœ¨ 1100ms åˆ° 1300ms ä¹‹é—´ã€‚è¿™ä¸ªä¸ä¹‹å‰ä¸€æ¡ä¸€æ¡å‘½ä»¤ä½¿ç”¨ï¼Œ1s å†…å°±å‘é€å‡ åå‡ ç™¾æ¡ï¼ˆå®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯è·ç¦»å¯¼è‡´ï¼‰å‘½ä»¤çš„å·®è·ä¸æ˜¯ä¸€èˆ¬çš„å¤§äº†ã€‚</p>
<p>æ³¨æ„ï¼Œè¿™é‡Œåªæ˜¯ä¸ºäº†æµ‹è¯•æ€§èƒ½è€Œå·²ï¼Œå½“ä½ è¦æ‰§è¡Œå¾ˆå¤šçš„å‘½ä»¤å¹¶è¿”å›ç»“æœçš„æ—¶å€™ï¼Œéœ€è¦è€ƒè™‘ List å¯¹è±¡çš„å¤§å°ï¼Œå› ä¸ºå®ƒä¼šâ€œåƒæ‰â€æœåŠ¡å™¨ä¸Šè®¸å¤šçš„å†…å­˜ç©ºé—´ï¼Œä¸¥é‡æ—¶ä¼šå¯¼è‡´å†…å­˜ä¸è¶³ï¼Œå¼•å‘ JVM æº¢å‡ºå¼‚å¸¸ï¼Œæ‰€ä»¥åœ¨å·¥ä½œç¯å¢ƒä¸­ï¼Œæ˜¯éœ€è¦è¯»è€…è‡ªå·±å»è¯„ä¼°çš„ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨è¿­ä»£çš„æ–¹å¼å»å¤„ç†ã€‚</p>
<h3 id="äº‹åŠ¡ä¸-Lua"><a href="#äº‹åŠ¡ä¸-Lua" class="headerlink" title="äº‹åŠ¡ä¸ Lua"></a>äº‹åŠ¡ä¸ Lua</h3><h4 id="multi-å’Œ-exec-å‘½ä»¤"><a href="#multi-å’Œ-exec-å‘½ä»¤" class="headerlink" title="multi å’Œ exec å‘½ä»¤"></a>multi å’Œ exec å‘½ä»¤</h4><p>å¾ˆå¤šæƒ…å†µä¸‹æˆ‘ä»¬éœ€è¦ä¸€æ¬¡æ‰§è¡Œä¸æ­¢ä¸€ä¸ªå‘½ä»¤ï¼Œè€Œä¸”éœ€è¦å…¶åŒæ—¶æˆåŠŸæˆ–è€…å¤±è´¥ã€‚ä¸ºäº†ä¿è¯å¤šæ¡å‘½ä»¤ç»„åˆçš„åŸå­æ€§ï¼ŒRedis æä¾›äº†ç®€å•çš„äº‹åŠ¡åŠŸèƒ½ä»¥åŠé›†æˆ Lua è„šæœ¬æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<p>Redis æä¾›äº†ç®€å•çš„äº‹åŠ¡åŠŸèƒ½ï¼Œå°†ä¸€ç»„éœ€è¦ä¸€èµ·æ‰§è¡Œçš„å‘½ä»¤æ”¾åˆ° multi å’Œ exec ä¸¤ä¸ªå‘½ä»¤ä¹‹é—´ã€‚Multi å‘½ä»¤ä»£è¡¨äº‹åŠ¡å¼€å§‹ï¼Œexec å‘½ä»¤ä»£è¡¨äº‹åŠ¡ç»“æŸï¼Œå®ƒä»¬ä¹‹é—´çš„å‘½ä»¤æ˜¯åŸå­é¡ºåºæ‰§è¡Œçš„ã€‚ä½¿ç”¨æ¡ˆä¾‹ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; multi</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; SET msg &quot;hello chrootliu&quot;</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; GET msg</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; EXEC</span><br><span class="line">1) OK</span><br><span class="line">1) hello chrootliu</span><br></pre></td></tr></table></figure></div>

<p>Redis æä¾›äº†ç®€å•çš„äº‹åŠ¡ï¼Œä¹‹æ‰€ä»¥è¯´å®ƒç®€å•ï¼Œä¸»è¦æ˜¯å› ä¸ºå®ƒä¸æ”¯æŒäº‹åŠ¡ä¸­çš„å›æ»šç‰¹æ€§ï¼ŒåŒæ—¶æ— æ³•å®ç°å‘½ä»¤ä¹‹é—´çš„é€»è¾‘å…³ç³»è®¡ç®—ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š</p>
<p> 1,ä¸å¤Ÿæ»¡è¶³åŸå­æ€§ã€‚ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå…¶ä»–äº‹åŠ¡æˆ– client æ˜¯å¯ä»¥å¯¹ç›¸åº”çš„ key è¿›è¡Œä¿®æ”¹çš„ï¼ˆå¹¶å‘æƒ…å†µä¸‹ï¼Œä¾‹å¦‚ç”µå•†å¸¸è§çš„è¶…å–é—®é¢˜ï¼‰ï¼Œæƒ³è¦é¿å…è¿™æ ·çš„å¹¶å‘æ€§é—®é¢˜å°±éœ€è¦ä½¿ç”¨ WATCH å‘½ä»¤ï¼Œä½†æ˜¯é€šå¸¸æ¥è¯´ï¼Œå¿…é¡»ç»è¿‡ä»”ç»†è€ƒè™‘æ‰èƒ½å†³å®šç©¶ç«Ÿéœ€è¦å¯¹å“ªäº› key è¿›è¡Œ WATCH åŠ é”ã€‚ç„¶è€Œï¼Œé¢å¤–çš„ WATCH ä¼šå¢åŠ äº‹åŠ¡å¤±è´¥çš„å¯èƒ½ï¼Œè€Œç¼ºå°‘å¿…è¦çš„ WATCH åˆä¼šè®©æˆ‘ä»¬çš„ç¨‹åºäº§ç”Ÿç«äº‰æ¡ä»¶ã€‚<br> 2,åæ‰§è¡Œçš„å‘½ä»¤æ— æ³•ä¾èµ–å…ˆæ‰§è¡Œå‘½ä»¤çš„ç»“æœã€‚ç”±äºäº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤éƒ½æ˜¯äº’ç›¸ç‹¬ç«‹çš„ï¼Œåœ¨é‡åˆ° exec å‘½ä»¤ä¹‹å‰å¹¶æ²¡æœ‰çœŸæ­£çš„æ‰§è¡Œï¼Œæ‰€ä»¥æˆ‘ä»¬æ— æ³•åœ¨äº‹åŠ¡ä¸­çš„å‘½ä»¤ä¸­ä½¿ç”¨å‰é¢å‘½ä»¤çš„æŸ¥è¯¢ç»“æœã€‚æˆ‘ä»¬å”¯ä¸€å¯ä»¥åšçš„å°±æ˜¯é€šè¿‡ watch ä¿è¯åœ¨æˆ‘ä»¬è¿›è¡Œä¿®æ”¹æ—¶ï¼Œå¦‚æœå…¶å®ƒäº‹åŠ¡åˆšå¥½è¿›è¡Œäº†ä¿®æ”¹ï¼Œåˆ™æˆ‘ä»¬çš„ä¿®æ”¹åœæ­¢ï¼Œç„¶ååº”ç”¨å±‚åšç›¸åº”çš„å¤„ç†ã€‚<br> 3,äº‹åŠ¡ä¸­çš„æ¯æ¡å‘½ä»¤éƒ½ä¼šä¸ Redis æœåŠ¡å™¨è¿›è¡Œç½‘ç»œäº¤äº’ã€‚Redis äº‹åŠ¡å¼€å¯ä¹‹åï¼Œæ¯æ‰§è¡Œä¸€ä¸ªæ“ä½œè¿”å›çš„éƒ½æ˜¯ queuedï¼Œè¿™é‡Œå°±æ¶‰åŠåˆ°å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ç«¯çš„å¤šæ¬¡äº¤äº’ï¼Œæ˜æ˜æ˜¯éœ€è¦ä¸€æ¬¡æ‰¹é‡æ‰§è¡Œçš„ n æ¡å‘½ä»¤ï¼Œè¿˜éœ€è¦é€šè¿‡å¤šæ¬¡ç½‘ç»œäº¤äº’ï¼Œæ˜¾ç„¶éå¸¸æµªè´¹ï¼ˆè¿™ä¸ªå°±æ˜¯ä¸ºä»€ä¹ˆä¼šæœ‰ pipeline çš„åŸå› ï¼Œå‡å°‘ RTT çš„æ—¶é—´ï¼‰ã€‚</p>
<h4 id="Redis-äº‹åŠ¡ç¼ºé™·çš„è§£å†³-â€“-Lua"><a href="#Redis-äº‹åŠ¡ç¼ºé™·çš„è§£å†³-â€“-Lua" class="headerlink" title="Redis äº‹åŠ¡ç¼ºé™·çš„è§£å†³ â€“ Lua"></a>Redis äº‹åŠ¡ç¼ºé™·çš„è§£å†³ â€“ Lua</h4><p>Lua æ˜¯ä¸€ä¸ªå°å·§çš„è„šæœ¬è¯­è¨€ï¼Œç”¨æ ‡å‡† C ç¼–å†™ï¼Œå‡ ä¹åœ¨æ‰€æœ‰æ“ä½œç³»ç»Ÿå’Œå¹³å°ä¸Šéƒ½å¯ä»¥ç¼–è¯‘è¿è¡Œã€‚ä¸€ä¸ªå®Œæ•´çš„ Lua è§£é‡Šå™¨ä¸è¿‡ 200kï¼Œåœ¨ç›®å‰æ‰€æœ‰è„šæœ¬å¼•æ“ä¸­ï¼ŒLua çš„é€Ÿåº¦æ˜¯æœ€å¿«çš„ï¼Œè¿™ä¸€åˆ‡éƒ½å†³å®šäº† Lua æ˜¯ä½œä¸ºåµŒå…¥å¼è„šæœ¬çš„æœ€ä½³é€‰æ‹©ã€‚</p>
<p>Redis 2.6 ç‰ˆæœ¬ä¹‹åå†…åµŒäº†ä¸€ä¸ª Lua è§£é‡Šå™¨ï¼Œå¯ä»¥ç”¨äºä¸€äº›ç®€å•çš„äº‹åŠ¡ä¸é€»è¾‘è¿ç®—ï¼Œä¹Ÿå¯å¸®åŠ©å¼€å‘è€…å®šåˆ¶è‡ªå·±çš„ Redis å‘½ä»¤ï¼ˆä¾‹å¦‚ï¼šä¸€æ¬¡æ€§çš„æ‰§è¡Œå¤æ‚çš„æ“ä½œï¼Œå’Œå¸¦æœ‰é€»è¾‘åˆ¤æ–­çš„æ“ä½œï¼‰ï¼Œåœ¨è¿™ä¹‹å‰ï¼Œå¿…é¡»ä¿®æ”¹æºç ã€‚</p>
<p>åœ¨ Redis ä¸­æ‰§è¡Œ Lua è„šæœ¬æœ‰ä¸¤ç§æ–¹æ³•ï¼ševal å’Œ evalshaï¼Œè¿™é‡Œä»¥ eval åšä¸ºæ¡ˆä¾‹ä»‹ç»ï¼š<br>eval è¯­æ³•ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">eval script numkeys key [key ...] arg [arg ...]</span><br></pre></td></tr></table></figure></div>
<p>å…¶ä¸­ï¼š</p>
<ul>
<li>script ä¸€æ®µ Lua è„šæœ¬æˆ– Lua è„šæœ¬æ–‡ä»¶æ‰€åœ¨è·¯å¾„åŠæ–‡ä»¶å</li>
<li>numkeys Lua è„šæœ¬å¯¹åº”å‚æ•°æ•°é‡</li>
<li>key [key â€¦] Lua ä¸­é€šè¿‡å…¨å±€å˜é‡ KEYS æ•°ç»„å­˜å‚¨çš„ä¼ å…¥å‚æ•°</li>
<li>arg [arg â€¦] Lua ä¸­é€šè¿‡å…¨å±€å˜é‡ ARGV æ•°ç»„å­˜å‚¨çš„ä¼ å…¥é™„åŠ å‚æ•°</li>
</ul>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">EVAL &quot;return &#123;KEYS[1],KEYS[2],ARGV[1],ARGV[2]&#125;&quot; 2 key1 key2 first second</span><br><span class="line">1) &quot;key1&quot;</span><br><span class="line">2) &quot;key2&quot;</span><br><span class="line">3) &quot;first&quot;</span><br><span class="line">4) &quot;second&quot;</span><br></pre></td></tr></table></figure></div>

<p>Lua æ‰§è¡Œæµç¨‹å›¾:<br><img src="/2022/07/12/uncatalog/cl5hsfpv60000m4r706d63234/64022.jpg" alt="img"></p>
<h4 id="SCRIPT-LOAD-ä¸-EVALSHA-å‘½ä»¤"><a href="#SCRIPT-LOAD-ä¸-EVALSHA-å‘½ä»¤" class="headerlink" title="SCRIPT LOAD ä¸ EVALSHA å‘½ä»¤"></a>SCRIPT LOAD ä¸ EVALSHA å‘½ä»¤</h4><p>å¯¹äºä¸ç«‹å³æ‰§è¡Œçš„ Lua è„šæœ¬ï¼Œæˆ–éœ€è¦é‡ç”¨çš„ Lua è„šæœ¬ï¼Œå¯ä»¥é€šè¿‡ SCRIPT LOAD æå‰è½½å…¥ Lua è„šæœ¬ï¼Œè¿™ä¸ªå‘½ä»¤ä¼šç«‹å³è¿”å›å¯¹åº”çš„ SHA1 æ ¡éªŒç </p>
<p>å½“éœ€è¦æ‰§è¡Œå‡½æ•°æ—¶ï¼Œé€šè¿‡ EVALSHA è°ƒç”¨ SCRIPT LOAD è¿”å›çš„ SHA1 å³å¯</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">SCRIPT LOAD &quot;return &#123;KEYS[1],KEYS[2],ARGV[1],ARGV[2]&#125;&quot;</span><br><span class="line">&quot;232fd51614574cf0867b83d384a5e898cfd24e5a&quot;</span><br><span class="line"></span><br><span class="line">EVALSHA &quot;232fd51614574cf0867b83d384a5e898cfd24e5a&quot; 2 key1 key2 first second</span><br><span class="line">1) &quot;key1&quot;</span><br><span class="line">2) &quot;key2&quot;</span><br><span class="line">3) &quot;first&quot;</span><br><span class="line">4) &quot;second&quot;</span><br></pre></td></tr></table></figure></div>
<h4 id="é€šè¿‡-Lua-è„šæœ¬æ‰§è¡Œ-Redis-å‘½ä»¤"><a href="#é€šè¿‡-Lua-è„šæœ¬æ‰§è¡Œ-Redis-å‘½ä»¤" class="headerlink" title="é€šè¿‡ Lua è„šæœ¬æ‰§è¡Œ Redis å‘½ä»¤"></a>é€šè¿‡ Lua è„šæœ¬æ‰§è¡Œ Redis å‘½ä»¤</h4><p>åœ¨ Lua è„šæœ¬ä¸­ï¼Œåªè¦ä½¿ç”¨ redis.call() æˆ– redis.pcall() ä¼ å…¥ Redis å‘½ä»¤å°±å¯ä»¥ç›´æ¥æ‰§è¡Œï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">eval &quot;return redis.call(&#x27;set&#x27;,KEYS[1],&#x27;bar&#x27;)&quot; 1 foo     --ç­‰åŒäºåœ¨æœåŠ¡ç«¯æ‰§è¡Œ set foo bar</span><br></pre></td></tr></table></figure></div>
<p>æ¡ˆä¾‹ï¼Œä½¿ç”¨ Lua è„šæœ¬å®ç°è®¿é—®é¢‘ç‡é™åˆ¶ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">--</span><br><span class="line">-- KEYS[1] è¦é™åˆ¶çš„ip</span><br><span class="line">-- ARGV[1] é™åˆ¶çš„è®¿é—®æ¬¡æ•°</span><br><span class="line">-- ARGV[2] é™åˆ¶çš„æ—¶é—´</span><br><span class="line">--</span><br><span class="line"></span><br><span class="line">local key = &quot;rate.limit:&quot; .. KEYS[1]</span><br><span class="line">local limit = tonumber(ARGV[1])</span><br><span class="line">local expire_time = ARGV[2]</span><br><span class="line"></span><br><span class="line">local is_exists = redis.call(&quot;EXISTS&quot;, key)</span><br><span class="line">if is_exists == 1then</span><br><span class="line">    if redis.call(&quot;INCR&quot;, key) &gt; limit then</span><br><span class="line">        return0</span><br><span class="line">    else</span><br><span class="line">        return1</span><br><span class="line">    end</span><br><span class="line">else</span><br><span class="line">    redis.call(&quot;SET&quot;, key, 1)</span><br><span class="line">    redis.call(&quot;EXPIRE&quot;, key, expire_time)</span><br><span class="line">    return1</span><br><span class="line">end</span><br></pre></td></tr></table></figure></div>

<p>ä½¿ç”¨æ–¹æ³•ï¼Œé€šè¿‡ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">eval(file_get_contents(storage_path(&quot;limit.lua&quot;)), 3, &quot;127.0.0.1&quot;, &quot;3&quot;, &quot;100&quot;);</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
<p>redis çš„äº‹åŠ¡ä¸ Luaï¼Œå°±å…ˆä»‹ç»åˆ°è¿™é‡Œäº†ï¼Œæ›´å¤šçš„ç”¨æ³•å¤§å®¶è¯·æŸ¥çœ‹ Lua å®˜æ–¹æ–‡æ¡£</p>
<h3 id="Bitmaps"><a href="#Bitmaps" class="headerlink" title="Bitmaps"></a>Bitmaps</h3><p>è®¸å¤šå¼€å‘è¯­è¨€éƒ½æä¾›äº†æ“ä½œä½çš„åŠŸèƒ½ï¼Œåˆç†åœ°ä½¿ç”¨ä½èƒ½å¤Ÿæœ‰æ•ˆåœ°æé«˜å†…å­˜ä½¿ç”¨ç‡å’Œå¼€å‘æ•ˆç‡ã€‚Redis æä¾›äº† Bitmaps è¿™ä¸ªâ€œæ•°æ®ç»“æ„â€å¯ä»¥å®ç°å¯¹ä½çš„æ“ä½œã€‚æŠŠæ•°æ®ç»“æ„åŠ ä¸Šå¼•å·ä¸»è¦å› ä¸ºï¼š</p>
<ul>
<li>Bitmaps æœ¬èº«ä¸æ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œå®é™…ä¸Šå®ƒå°±æ˜¯å­—ç¬¦ä¸²ï¼Œä½†æ˜¯å®ƒå¯ä»¥å¯¹å­—ç¬¦ä¸²çš„ä½è¿›è¡Œæ“ä½œã€‚</li>
<li>Bitmaps å•ç‹¬æä¾›äº†ä¸€å¥—å‘½ä»¤ï¼Œæ‰€ä»¥åœ¨ Redis ä¸­ä½¿ç”¨ Bitmaps å’Œä½¿ç”¨å­—ç¬¦ä¸²çš„æ–¹æ³•ä¸å¤ªç›¸åŒã€‚å¯ä»¥æŠŠ Bitmaps æƒ³è±¡æˆä¸€ä¸ªä»¥ä½ä¸ºå•ä½çš„æ•°ç»„ï¼Œæ•°ç»„çš„æ¯ä¸ªå•å…ƒåªèƒ½å­˜å‚¨ 0 å’Œ 1ï¼Œæ•°ç»„çš„ä¸‹æ ‡åœ¨ Bitmaps ä¸­å«åšåç§»é‡ã€‚<br>åœ¨æˆ‘ä»¬å¹³æ—¶å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä¼šæœ‰ä¸€äº› bool å‹æ•°æ®éœ€è¦å­˜å–ï¼Œæ¯”å¦‚ç”¨æˆ·ä¸€å¹´çš„ç­¾åˆ°è®°å½•ï¼Œ ç­¾äº†æ˜¯ 1ï¼Œæ²¡ç­¾æ˜¯ 0ï¼Œè¦è®°å½• 365 å¤©ã€‚å¦‚æœä½¿ç”¨æ™®é€šçš„ key/valueï¼Œæ¯ä¸ªç”¨æˆ·è¦è®°å½• 365 ä¸ªï¼Œå½“ç”¨æˆ·ä¸Šäº¿çš„æ—¶å€™ï¼Œéœ€è¦çš„å­˜å‚¨ç©ºé—´æ˜¯æƒŠäººçš„ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒRedis æä¾›äº†ä½å›¾æ•°æ®ç»“æ„ï¼Œè¿™æ ·æ¯å¤©çš„ç­¾åˆ°è®°å½•åªå æ®ä¸€ä¸ªä½ï¼Œ 365 å¤©å°±æ˜¯ 365 ä¸ªä½ï¼Œ46 ä¸ªå­—èŠ‚ (ä¸€ä¸ªç¨é•¿ä¸€ç‚¹çš„å­—ç¬¦ä¸²) å°±å¯ä»¥å®Œå…¨å®¹çº³ä¸‹ï¼Œè¿™å°±å¤§å¤§èŠ‚çº¦äº†å­˜å‚¨ç©ºé—´ã€‚</li>
</ul>
<p>è¯­æ³•ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">setbit key offset value  # è®¾ç½®æˆ–è€…æ¸…ç©º key çš„ value(å­—ç¬¦ä¸²)åœ¨ offset å¤„çš„ bit å€¼</span><br><span class="line">getbit key offset  # è¿”å› key å¯¹åº”çš„ string åœ¨ offset å¤„çš„ bit å€¼</span><br><span class="line">bitcount key [start end] # start end èŒƒå›´å†…è¢«è®¾ç½®ä¸º1çš„æ•°é‡ï¼Œä¸ä¼ é€’ start end é»˜è®¤å…¨èŒƒå›´</span><br></pre></td></tr></table></figure></div>
<p>ä½¿ç”¨æ¡ˆä¾‹ï¼Œç»Ÿè®¡ç”¨æˆ·ç™»å½•ï¼ˆæ´»è·ƒï¼‰æƒ…å†µ</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; setbit userLogin:2021-04-10 66666 1 #userId=66666çš„ç”¨æˆ·ç™»å½•ï¼Œè¿™æ˜¯ä»Šå¤©ç™»å½•çš„ç¬¬ä¸€ä¸ªç”¨æˆ·ã€‚</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; setbit userLogin:2021-04-10 999999 1 #userId=999999çš„ç”¨æˆ·ç™»å½•ï¼Œè¿™æ˜¯ä»Šå¤©ç¬¬äºŒä¸ªç™»å½•ã€çš„ç”¨æˆ·ã€‚</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; setbit userLogin:2021-04-10 3333 1</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; setbit userLogin:2021-04-10 8888 1</span><br><span class="line">(integer) 0</span><br><span class="line">127.0.0.1:6379&gt; setbit userLogin:2021-04-10 100000 1</span><br><span class="line">(integer) 0</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; getbit userLogin:2021-04-10 66666</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; getbit userLogin:2021-04-10 55555</span><br><span class="line">(integer)</span><br><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; bitcount userLogin:2021-04-10</span><br><span class="line">(integer) 5</span><br></pre></td></tr></table></figure></div>

<p>ç”±äº bit æ•°ç»„çš„æ¯ä¸ªä½ç½®åªèƒ½å­˜å‚¨ 0 æˆ–è€… 1 è¿™ä¸¤ä¸ªçŠ¶æ€ï¼›æ‰€ä»¥å¯¹äºå®é™…ç”Ÿæ´»ä¸­ï¼Œå¤„ç†ä¸¤ä¸ªçŠ¶æ€çš„ä¸šåŠ¡åœºæ™¯å°±å¯ä»¥è€ƒè™‘ä½¿ç”¨ bitmapsã€‚å¦‚ç”¨æˆ·ç™»å½•/æœªç™»å½•ï¼Œç­¾åˆ°/æœªç­¾åˆ°ï¼Œå…³æ³¨/æœªå…³æ³¨ï¼Œæ‰“å¡/æœªæ‰“å¡ç­‰ã€‚åŒæ—¶ bitmap è¿˜é€šè¿‡äº†ç›¸å…³çš„ç»Ÿè®¡æ–¹æ³•è¿›è¡Œå¿«é€Ÿç»Ÿè®¡ã€‚</p>
<h3 id="HyperLogLog"><a href="#HyperLogLog" class="headerlink" title="HyperLogLog"></a>HyperLogLog</h3><p>HyperLogLog å¹¶ä¸æ˜¯ä¸€ç§æ–°çš„æ•°æ®ç»“æ„ï¼ˆå®é™…ç±»å‹ä¸ºå­—ç¬¦ä¸²ç±»å‹ï¼‰ï¼Œè€Œ æ˜¯ä¸€ç§åŸºæ•°ç®—æ³•ï¼Œé€šè¿‡ HyperLogLog å¯ä»¥åˆ©ç”¨æå°çš„å†…å­˜ç©ºé—´å®Œæˆç‹¬ç«‹æ€»æ•°çš„ç»Ÿè®¡ï¼Œæ•°æ®é›†å¯ä»¥æ˜¯ IPã€Emailã€ID ç­‰ã€‚</p>
<p>HyperLogLog æä¾›äº† 3 ä¸ªå‘½ä»¤ï¼špfaddã€pfcountã€pfmergeã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ç”¨äºå‘ HyperLogLog æ·»åŠ å…ƒç´ </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¦‚æœ HyperLogLog ä¼°è®¡çš„è¿‘ä¼¼åŸºæ•°åœ¨ PFADD å‘½ä»¤æ‰§è¡Œä¹‹åå‡ºç°äº†å˜åŒ–ï¼Œ é‚£ä¹ˆå‘½ä»¤è¿”å› 1 ï¼Œ å¦åˆ™è¿”å› 0</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¦‚æœå‘½ä»¤æ‰§è¡Œæ—¶ç»™å®šçš„é”®ä¸å­˜åœ¨ï¼Œ é‚£ä¹ˆç¨‹åºå°†å…ˆåˆ›å»ºä¸€ä¸ªç©ºçš„ HyperLogLog ç»“æ„ï¼Œ ç„¶åå†æ‰§è¡Œå‘½ä»¤</span></span><br><span class="line">pfadd key value1 [value2 value3]</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> PFCOUNT å‘½ä»¤ä¼šç»™å‡º HyperLogLog åŒ…å«çš„è¿‘ä¼¼åŸºæ•°</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> åœ¨è®¡ç®—å‡ºåŸºæ•°åï¼Œ PFCOUNT ä¼šå°†å€¼å­˜å‚¨åœ¨ HyperLogLog ä¸­è¿›è¡Œç¼“å­˜ï¼ŒçŸ¥é“ä¸‹æ¬¡ PFADD æ‰§è¡ŒæˆåŠŸå‰ï¼Œå°±éƒ½ä¸éœ€è¦å†æ¬¡è¿›è¡ŒåŸºæ•°çš„è®¡ç®—ã€‚</span></span><br><span class="line">pfcount key</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> PFMERGE å°†å¤šä¸ª HyperLogLog åˆå¹¶ä¸ºä¸€ä¸ª HyperLogLog ï¼Œ åˆå¹¶åçš„ HyperLogLog çš„åŸºæ•°æ¥è¿‘äºæ‰€æœ‰è¾“å…¥ HyperLogLog çš„å¹¶é›†åŸºæ•°ã€‚</span></span><br><span class="line">pfmerge destkey key1 key2 [...keyn]</span><br><span class="line">127.0.0.1:6379&gt; pfadd totaluv user1</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; pfcount totaluv</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; pfadd totaluv user2</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; pfcount totaluv</span><br><span class="line">(integer) 2</span><br><span class="line">127.0.0.1:6379&gt; pfadd totaluv user3</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; pfcount totaluv</span><br><span class="line">(integer) 3</span><br><span class="line">127.0.0.1:6379&gt; pfadd totaluv user4</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; pfcount totaluv</span><br><span class="line">(integer) 4</span><br><span class="line">127.0.0.1:6379&gt; pfadd totaluv user5</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; pfcount totaluv</span><br><span class="line">(integer) 5</span><br><span class="line">127.0.0.1:6379&gt; pfadd totaluv user6 user7 user8 user9 user10</span><br><span class="line">(integer) 1</span><br><span class="line">127.0.0.1:6379&gt; pfcount totaluv</span><br><span class="line">(integer) 10</span><br></pre></td></tr></table></figure></div>

<p>HyperLogLog å†…å­˜å ç”¨é‡éå¸¸å°ï¼Œä½†æ˜¯å­˜åœ¨é”™è¯¯ç‡ï¼Œå¼€å‘è€…åœ¨è¿›è¡Œæ•°æ® 229 ç»“æ„é€‰å‹æ—¶åªéœ€è¦ç¡®è®¤å¦‚ä¸‹ä¸¤æ¡å³å¯ï¼š</p>
<p> 1,åªä¸ºäº†è®¡ç®—ç‹¬ç«‹æ€»æ•°ï¼Œä¸éœ€è¦è·å–å•æ¡æ•°æ®ã€‚<br> 2,å¯ä»¥å®¹å¿ä¸€å®šè¯¯å·®ç‡ï¼Œæ¯•ç«Ÿ HyperLogLog åœ¨å†…å­˜çš„å ç”¨é‡ä¸Šæœ‰å¾ˆå¤§çš„ä¼˜åŠ¿ã€‚</p>
<p>ä¾‹å¦‚ï¼šå¦‚æœä½ è´Ÿè´£å¼€å‘ç»´æŠ¤ä¸€ä¸ªå¤§å‹çš„ç½‘ç«™ï¼Œæœ‰ä¸€å¤©è€æ¿æ‰¾äº§å“ç»ç†è¦ç½‘ç«™æ¯ä¸ªç½‘é¡µæ¯å¤©çš„ UV æ•°æ®ï¼Œç„¶åè®©ä½ æ¥å¼€å‘è¿™ä¸ªç»Ÿè®¡æ¨¡å—ï¼Œä½ ä¼šå¦‚ä½•å®ç°?</p>
<p>å¦‚æœç»Ÿè®¡ PV é‚£éå¸¸å¥½åŠï¼Œç»™æ¯ä¸ªç½‘é¡µä¸€ä¸ªç‹¬ç«‹çš„ Redis è®¡æ•°å™¨å°±å¯ä»¥äº†ï¼Œè¿™ä¸ªè®¡æ•°å™¨ çš„ key åç¼€åŠ ä¸Šå½“å¤©çš„æ—¥æœŸã€‚è¿™æ ·æ¥ä¸€ä¸ªè¯·æ±‚ï¼Œincrby ä¸€æ¬¡ï¼Œæœ€ç»ˆå°±å¯ä»¥ç»Ÿè®¡å‡ºæ‰€æœ‰çš„ PV æ•°æ®ã€‚</p>
<p>ä½†æ˜¯ UV ä¸ä¸€æ ·ï¼Œå®ƒè¦å»é‡ï¼ŒåŒä¸€ä¸ªç”¨æˆ·ä¸€å¤©ä¹‹å†…çš„å¤šæ¬¡è®¿é—®è¯·æ±‚åªèƒ½è®¡æ•°ä¸€æ¬¡ã€‚è¿™å°± è¦æ±‚æ¯ä¸€ä¸ªç½‘é¡µè¯·æ±‚éƒ½éœ€è¦å¸¦ä¸Šç”¨æˆ·çš„ IDï¼Œæ— è®ºæ˜¯ç™»å½•ç”¨æˆ·è¿˜æ˜¯æœªç™»å½•ç”¨æˆ·éƒ½éœ€è¦ä¸€ä¸ªå”¯ä¸€ ID æ¥æ ‡è¯†ã€‚</p>
<p>ä½ ä¹Ÿè®¸å·²ç»æƒ³åˆ°äº†ä¸€ä¸ªç®€å•çš„æ–¹æ¡ˆï¼Œé‚£å°±æ˜¯ä¸ºæ¯ä¸€ä¸ªé¡µé¢ä¸€ä¸ªç‹¬ç«‹çš„ set é›†åˆæ¥å­˜å‚¨æ‰€ æœ‰å½“å¤©è®¿é—®è¿‡æ­¤é¡µé¢çš„ç”¨æˆ· IDã€‚å½“ä¸€ä¸ªè¯·æ±‚è¿‡æ¥æ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨ sadd å°†ç”¨æˆ· ID å¡è¿›å»å°±å¯ ä»¥äº†ã€‚é€šè¿‡ scard å¯ä»¥å–å‡ºè¿™ä¸ªé›†åˆçš„å¤§å°ï¼Œè¿™ä¸ªæ•°å­—å°±æ˜¯è¿™ä¸ªé¡µé¢çš„ UV æ•°æ®ã€‚æ²¡é”™ï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„æ–¹æ¡ˆã€‚</p>
<p>ä½†æ˜¯ï¼Œå¦‚æœä½ çš„é¡µé¢è®¿é—®é‡éå¸¸å¤§ï¼Œæ¯”å¦‚ä¸€ä¸ªçˆ†æ¬¾é¡µé¢å‡ åƒä¸‡çš„ UVï¼Œä½ éœ€è¦ä¸€ä¸ªå¾ˆå¤§ çš„ set é›†åˆæ¥ç»Ÿè®¡ï¼Œè¿™å°±éå¸¸æµªè´¹ç©ºé—´ã€‚å¦‚æœè¿™æ ·çš„é¡µé¢å¾ˆå¤šï¼Œé‚£æ‰€éœ€è¦çš„å­˜å‚¨ç©ºé—´æ˜¯æƒŠäºº çš„ã€‚ä¸ºè¿™æ ·ä¸€ä¸ªå»é‡åŠŸèƒ½å°±è€—è´¹è¿™æ ·å¤šçš„å­˜å‚¨ç©ºé—´ï¼Œå€¼å¾—ä¹ˆ?å…¶å®è€æ¿éœ€è¦çš„æ•°æ®åˆä¸éœ€è¦ å¤ªç²¾ç¡®ï¼Œ105w å’Œ 106w è¿™ä¸¤ä¸ªæ•°å­—å¯¹äºè€æ¿ä»¬æ¥è¯´å¹¶æ²¡æœ‰å¤šå¤§åŒºåˆ«ï¼ŒSoï¼Œæœ‰æ²¡æœ‰æ›´å¥½çš„è§£ å†³æ–¹æ¡ˆå‘¢?</p>
<p>Redis æä¾›äº† HyperLogLog æ•°æ®ç»“æ„å°±æ˜¯ç”¨æ¥è§£å†³ è¿™ç§ç»Ÿè®¡é—®é¢˜çš„ã€‚HyperLogLog æä¾›ä¸ç²¾ç¡®çš„å»é‡è®¡æ•°æ–¹æ¡ˆï¼Œè™½ç„¶ä¸ç²¾ç¡®ä½†æ˜¯ä¹Ÿä¸æ˜¯éå¸¸ä¸ç²¾ç¡®ï¼Œæ ‡å‡†è¯¯å·®æ˜¯ 0.81%ï¼Œè¿™æ ·çš„ç²¾ç¡®åº¦å·²ç»å¯ä»¥æ»¡è¶³ä¸Šé¢çš„ UV ç»Ÿè®¡éœ€æ±‚äº†ã€‚</p>
<p>å¯¹äºä¸Šé¢çš„åœºæ™¯ï¼ŒåŒå­¦ä»¬å¯èƒ½æœ‰ç–‘é—®ï¼Œæˆ‘æˆ–è®¸åŒæ ·å¯ä»¥ä½¿ç”¨ HashMapã€BitMap å’Œ HyperLogLog æ¥è§£å†³ã€‚å¯¹äºè¿™ä¸‰ç§è§£å†³æ–¹æ¡ˆï¼Œè¿™è¾¹åšä¸‹å¯¹æ¯”ï¼š</p>
<ul>
<li>HashMapï¼šç®—æ³•ç®€å•ï¼Œç»Ÿè®¡ç²¾åº¦é«˜ï¼Œå¯¹äºå°‘é‡æ•°æ®å»ºè®®ä½¿ç”¨ï¼Œä½†æ˜¯å¯¹äºå¤§é‡çš„æ•°æ®ä¼šå ç”¨å¾ˆå¤§å†…å­˜ç©ºé—´ï¼›</li>
<li>BitMapï¼šä½å›¾ç®—æ³•ï¼Œå…·ä½“å†…å®¹å¯ä»¥å‚è€ƒæˆ‘çš„è¿™ç¯‡æ–‡ç« ï¼Œç»Ÿè®¡ç²¾åº¦é«˜ï¼Œè™½ç„¶å†…å­˜å ç”¨è¦æ¯” HashMap å°‘ï¼Œä½†æ˜¯å¯¹äºå¤§é‡æ•°æ®è¿˜æ˜¯ä¼šå ç”¨è¾ƒå¤§å†…å­˜ï¼›</li>
<li>HyperLogLogï¼šå­˜åœ¨ä¸€å®šè¯¯å·®ï¼Œå ç”¨å†…å­˜å°‘ï¼Œç¨³å®šå ç”¨ 12k å·¦å³å†…å­˜ï¼Œå¯ä»¥ç»Ÿè®¡ 2^64 ä¸ªå…ƒç´ ï¼Œå¯¹äºä¸Šé¢ä¸¾ä¾‹çš„åº”ç”¨åœºæ™¯ï¼Œå»ºè®®ä½¿ç”¨ã€‚</li>
</ul>
<h3 id="å‘å¸ƒè®¢é˜…"><a href="#å‘å¸ƒè®¢é˜…" class="headerlink" title="å‘å¸ƒè®¢é˜…"></a>å‘å¸ƒè®¢é˜…</h3><p>Redis æä¾›äº†åŸºäºâ€œå‘å¸ƒ/è®¢é˜…â€æ¨¡å¼çš„æ¶ˆæ¯æœºåˆ¶ï¼Œæ­¤ç§æ¨¡å¼ä¸‹ï¼Œæ¶ˆæ¯å‘å¸ƒè€…å’Œè®¢é˜…è€…ä¸è¿›è¡Œç›´æ¥é€šä¿¡ï¼Œå‘å¸ƒè€…å®¢æˆ·ç«¯å‘æŒ‡å®šçš„é¢‘é“ï¼ˆchannelï¼‰å‘å¸ƒæ¶ˆ æ¯ï¼Œè®¢é˜…è¯¥é¢‘é“çš„æ¯ä¸ªå®¢æˆ·ç«¯éƒ½å¯ä»¥æ”¶åˆ°è¯¥æ¶ˆæ¯ï¼š</p>
<p><img src="/2022/07/12/uncatalog/cl5hsfpv60000m4r706d63234/64022.jpg" alt="img"></p>
<p>ä¸»è¦å¯¹åº”çš„ Redis å‘½ä»¤ä¸º:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">subscribe channel [channel ...] # è®¢é˜…ä¸€ä¸ªæˆ–å¤šä¸ªé¢‘é“</span><br><span class="line">unsubscribe channel # é€€è®¢æŒ‡å®šé¢‘é“</span><br><span class="line">publish channel message # å‘é€æ¶ˆæ¯</span><br><span class="line">psubscribe pattern # è®¢é˜…æŒ‡å®šæ¨¡å¼</span><br><span class="line">punsubscribe pattern # é€€è®¢æŒ‡å®šæ¨¡å¼</span><br></pre></td></tr></table></figure></div>
<p>ä½¿ç”¨æ¡ˆä¾‹ï¼š</p>
<p>æ‰“å¼€ä¸€ä¸ª Redis å®¢æˆ·ç«¯ï¼Œå¦‚å‘ TestChanne è¯´ä¸€å£° hello:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">127.0.0.1:6379&gt; publish TestChanne hello</span><br><span class="line">(integer) 1 # è¿”å›çš„æ˜¯æ¥æ”¶è¿™æ¡æ¶ˆæ¯çš„è®¢é˜…è€…æ•°é‡</span><br></pre></td></tr></table></figure></div>
<p>è¿™æ ·æ¶ˆæ¯å°±å‘å‡ºå»äº†ã€‚å‘å‡ºå»çš„æ¶ˆæ¯ä¸ä¼šè¢«æŒä¹…åŒ–ï¼Œä¹Ÿå°±æ˜¯æœ‰å®¢æˆ·ç«¯è®¢é˜… TestChanne ååªèƒ½æ¥æ”¶åˆ°åç»­å‘å¸ƒåˆ°è¯¥é¢‘é“çš„æ¶ˆæ¯ï¼Œä¹‹å‰çš„å°±æ¥æ”¶ä¸åˆ°äº†ã€‚</p>
<p>æ‰“å¼€å¦ä¸€ Redis ä¸ªå®¢æˆ·ç«¯ï¼Œè¿™é‡Œå‡è®¾å‘é€æ¶ˆæ¯ä¹‹å‰å°±æ‰“å¼€å¹¶ä¸”è®¢é˜…äº† TestChanne é¢‘é“ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; subscribe TestChanne # æ‰§è¡Œä¸Šé¢å‘½ä»¤å®¢æˆ·ç«¯ä¼šè¿›å…¥è®¢é˜…çŠ¶æ€</span><br><span class="line">Reading messages... (press Ctrl-C to quit)</span><br><span class="line">1) &quot;subscribe&quot; // æ¶ˆæ¯ç±»å‹</span><br><span class="line">2) &quot;TestChanne&quot; // é¢‘é“</span><br><span class="line">3) &quot;hello&quot; // æ¶ˆæ¯å†…å®¹</span><br></pre></td></tr></table></figure></div>

<p>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨ Redis å‘å¸ƒè®¢é˜…åŠŸèƒ½ï¼Œå®ç°çš„ç®€å• MQ åŠŸèƒ½ï¼Œå®ç°ä¸Šä¸‹æ¸¸çš„è§£è€¦ã€‚ä¸è¿‡éœ€è¦æ³¨æ„äº†ï¼Œç”±äº Redis å‘å¸ƒçš„æ¶ˆæ¯ä¸ä¼šè¢«æŒä¹…åŒ–ï¼Œè¿™å°±ä¼šå¯¼è‡´æ–°è®¢é˜…çš„å®¢æˆ·ç«¯å°†ä¸ä¼šæ”¶åˆ°å†å²æ¶ˆæ¯ã€‚æ‰€ä»¥ï¼Œå¦‚æœå½“å‰çš„ä¸šåŠ¡åœºæ™¯ä¸èƒ½å®¹å¿è¿™äº›ç¼ºç‚¹ï¼Œé‚£è¿˜æ˜¯ç”¨ä¸“ä¸š MQ å§ã€‚</p>
<h3 id="GEO"><a href="#GEO" class="headerlink" title="GEO"></a>GEO</h3><p>Redis3.2 ç‰ˆæœ¬æä¾›äº† GEOï¼ˆåœ°ç†ä¿¡æ¯å®šä½ï¼‰åŠŸèƒ½ï¼Œæ”¯æŒå­˜å‚¨åœ°ç†ä½ç½®ä¿¡ æ¯ç”¨æ¥å®ç°è¯¸å¦‚é™„è¿‘ä½ç½®ã€æ‘‡ä¸€æ‘‡è¿™ç±»ä¾èµ–äºåœ°ç†ä½ç½®ä¿¡æ¯çš„åŠŸèƒ½ï¼Œå¯¹äºéœ€ è¦å®ç°è¿™äº›åŠŸèƒ½çš„å¼€å‘è€…æ¥è¯´æ˜¯ä¸€å¤§ç¦éŸ³ã€‚GEO åŠŸèƒ½æ˜¯ Redis çš„å¦ä¸€ä½ä½œè€… Matt Stancliff å€Ÿé‰´ NoSQL æ•°æ®åº“ Ardb å®ç°çš„ï¼ŒArdb çš„ä½œè€…æ¥è‡ªä¸­å›½ï¼Œå®ƒæä¾›äº†ä¼˜ç§€çš„ GEO åŠŸèƒ½ã€‚</p>
<p>Redis GEO ç›¸å…³çš„å‘½ä»¤å¦‚ä¸‹ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æ·»åŠ ä¸€ä¸ªç©ºé—´å…ƒç´ ,longitudeã€latitudeã€memberåˆ†åˆ«æ˜¯è¯¥åœ°ç†ä½ç½®çš„ç»åº¦ã€çº¬åº¦ã€æˆå‘˜</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> è¿™é‡Œçš„æˆå‘˜å°±æ˜¯æŒ‡ä»£å…·ä½“çš„ä¸šåŠ¡æ•°æ®ï¼Œæ¯”å¦‚è¯´ç”¨æˆ·çš„IDç­‰</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> éœ€è¦æ³¨æ„çš„æ˜¯Redisçš„çº¬åº¦æœ‰æ•ˆèŒƒå›´ä¸æ˜¯[-90,90]è€Œæ˜¯[-85,85]</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¦‚æœåœ¨æ·»åŠ ä¸€ä¸ªç©ºé—´å…ƒç´ æ—¶ï¼Œè¿™ä¸ªå…ƒç´ ä¸­çš„menberå·²ç»å­˜åœ¨keyä¸­ï¼Œé‚£ä¹ˆGEOADDå‘½ä»¤ä¼šè¿”å›0,ç›¸å½“äºæ›´æ–°äº†è¿™ä¸ªmenberçš„ä½ç½®ä¿¡æ¯</span></span><br><span class="line">GEOADD key longitude latitude member [longitude latitude member]</span><br><span class="line"><span class="meta">#</span><span class="bash"> ç”¨äºæ·»åŠ åŸå¸‚çš„åæ ‡ä¿¡æ¯</span></span><br><span class="line">geoadd cities:locations 117.12 39.08 tianjin 114.29 38.02 shijiazhuang 118.01 39.38 tangshan 115.29 38.51 baoding</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> è·å–åœ°ç†ä½ç½®ä¿¡æ¯</span></span><br><span class="line">geopos key member [member ...]</span><br><span class="line"><span class="meta">#</span><span class="bash"> è·å–å¤©æ´¥çš„åæ ‡</span></span><br><span class="line">geopos cities:locations tianjin</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> è·å–ä¸¤ä¸ªåæ ‡ä¹‹é—´çš„è·ç¦»</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> unitä»£è¡¨å•ä½ï¼Œæœ‰4ä¸ªå•ä½å€¼</span></span><br><span class="line">  - m (meter) ä»£è¡¨ç±³</span><br><span class="line">  - km ï¼ˆkilometerï¼‰ä»£è¡¨åƒç±³</span><br><span class="line">  - mi ï¼ˆmilesï¼‰ä»£è¡¨è‹±é‡Œ</span><br><span class="line">  - ft ï¼ˆftï¼‰ä»£è¡¨å°º</span><br><span class="line">geodist key member1 member2 [unit]</span><br><span class="line"><span class="meta">#</span><span class="bash"> è·å–å¤©æ´¥å’Œä¿å®šä¹‹é—´çš„è·ç¦»</span></span><br><span class="line">GEODIST cities:locations tianjin baoding km</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> è·å–æŒ‡å®šä½ç½®èŒƒå›´å†…çš„åœ°ç†ä¿¡æ¯ä½ç½®é›†åˆï¼Œæ­¤å‘½ä»¤å¯ä»¥ç”¨äºå®ç°é™„è¿‘çš„äººçš„åŠŸèƒ½</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> georadiuså’Œgeoradiusbymemberä¸¤ä¸ªå‘½ä»¤çš„ä½œç”¨æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯ä»¥ä¸€ä¸ªåœ°ç†ä½ç½®ä¸ºä¸­å¿ƒç®—å‡ºæŒ‡å®šåŠå¾„å†…çš„å…¶ä»–åœ°ç†ä¿¡æ¯ä½ç½®ï¼Œä¸åŒçš„æ˜¯georadiuså‘½ä»¤çš„ä¸­å¿ƒä½ç½®ç»™å‡ºäº†å…·ä½“çš„ç»çº¬åº¦ï¼Œgeoradiusbymemberåªéœ€ç»™å‡ºæˆå‘˜å³å¯ã€‚å…¶ä¸­radiusm|km|ft|miæ˜¯å¿…éœ€å‚æ•°ï¼ŒæŒ‡å®šäº†åŠå¾„ï¼ˆå¸¦å•ä½ï¼‰ï¼Œè¿™ä¸¤ä¸ªå‘½ä»¤æœ‰å¾ˆå¤šå¯é€‰å‚æ•°ï¼Œå‚æ•°å«ä¹‰å¦‚ä¸‹ï¼š</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> - withcoordï¼šè¿”å›ç»“æœä¸­åŒ…å«ç»çº¬åº¦ã€‚</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> - withdistï¼šè¿”å›ç»“æœä¸­åŒ…å«ç¦»ä¸­å¿ƒèŠ‚ç‚¹ä½ç½®çš„è·ç¦»ã€‚</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> - withhashï¼šè¿”å›ç»“æœä¸­åŒ…å«geohashï¼Œæœ‰å…³geohashåé¢ä»‹ç»ã€‚</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> - COUNT countï¼šæŒ‡å®šè¿”å›ç»“æœçš„æ•°é‡ã€‚</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> - asc|descï¼šè¿”å›ç»“æœæŒ‰ç…§ç¦»ä¸­å¿ƒèŠ‚ç‚¹çš„è·ç¦»åšå‡åºæˆ–è€…é™åºã€‚</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> - store keyï¼šå°†è¿”å›ç»“æœçš„åœ°ç†ä½ç½®ä¿¡æ¯ä¿å­˜åˆ°æŒ‡å®šé”®ã€‚</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> - storedist keyï¼šå°†è¿”å›ç»“æœç¦»ä¸­å¿ƒèŠ‚ç‚¹çš„è·ç¦»ä¿å­˜åˆ°æŒ‡å®šé”®ã€‚</span></span><br><span class="line">georadius key longitude latitude radiusm|km|ft|mi [withcoord] [withdist] [withhash] [COUNT count] [asc|desc] [store key] [storedist key]</span><br><span class="line"></span><br><span class="line">georadiusbymember key member radiusm|km|ft|mi [withcoord] [withdist] [withhash] [COUNT count] [asc|desc] [store key] [storedist key]</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> è·å–geo <span class="built_in">hash</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Redisä½¿ç”¨geohashå°†äºŒç»´ç»çº¬åº¦è½¬æ¢ä¸ºä¸€ç»´å­—ç¬¦ä¸²ï¼Œgeohashæœ‰å¦‚ä¸‹ç‰¹ç‚¹ï¼š</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> - GEOçš„æ•°æ®ç±»å‹ä¸ºzsetï¼ŒRediså°†æ‰€æœ‰åœ°ç†ä½ç½®ä¿¡æ¯çš„geohashå­˜æ”¾åœ¨zsetä¸­ã€‚</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> - å­—ç¬¦ä¸²è¶Šé•¿ï¼Œè¡¨ç¤ºçš„ä½ç½®æ›´ç²¾ç¡®ï¼Œè¡¨3-8ç»™å‡ºäº†å­—ç¬¦ä¸²é•¿åº¦å¯¹åº”çš„ç²¾åº¦ï¼Œä¾‹å¦‚geohashé•¿åº¦ä¸º9æ—¶ï¼Œç²¾åº¦åœ¨2ç±³å·¦å³ã€‚é•¿åº¦å’Œç²¾åº¦çš„å¯¹åº”å…³ç³»ï¼Œè¯·å‚è€ƒï¼šhttps://easyreadfs.nosdn.127.net/9F42_CKRFsfc8SUALbHKog==/8796093023252281390</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> - ä¸¤ä¸ªå­—ç¬¦ä¸²è¶Šç›¸ä¼¼ï¼Œå®ƒä»¬ä¹‹é—´çš„è·ç¦»è¶Šè¿‘ï¼ŒRedisåˆ©ç”¨å­—ç¬¦ä¸²å‰ç¼€åŒ¹é…ç®—æ³•å®ç°ç›¸å…³çš„å‘½ä»¤ã€‚</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> - geohashç¼–ç å’Œç»çº¬åº¦æ˜¯å¯ä»¥ç›¸äº’è½¬æ¢çš„ã€‚</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> - Redisæ­£æ˜¯ä½¿ç”¨æœ‰åºé›†åˆå¹¶ç»“åˆgeohashçš„ç‰¹æ€§å®ç°äº†GEOçš„è‹¥å¹²å‘½ä»¤ã€‚</span></span><br><span class="line">geohash key member [member ...]</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆ é™¤æ“ä½œï¼ŒGEOæ²¡æœ‰æä¾›åˆ é™¤æˆå‘˜çš„å‘½ä»¤ï¼Œä½†æ˜¯å› ä¸ºGEOçš„åº•å±‚å®ç°æ˜¯zsetï¼Œæ‰€ä»¥å¯ä»¥å€Ÿç”¨zremå‘½ä»¤å®ç°å¯¹åœ°ç†ä½ç½®ä¿¡æ¯çš„åˆ é™¤ã€‚</span></span><br><span class="line">zrem key member</span><br></pre></td></tr></table></figure></div>

<p>ä½¿ç”¨æ¡ˆä¾‹ï¼Œä¾‹å¦‚å’‹éƒ¨é—¨æ˜¯åšç›´æ’­çš„ï¼Œé‚£ç›´æ’­ä¸šåŠ¡ä¸€èˆ¬ä¼šæœ‰ä¸€ä¸ªâ€œé™„è¿‘çš„ç›´æ’­â€åŠŸèƒ½ï¼Œè¿™é‡Œå°±å¯ä»¥è€ƒè™‘ç”¨ Redis çš„ GEO æŠ€æœ¯æ¥å®Œæˆè¿™ä¸ªåŠŸèƒ½ã€‚</p>
<p>æ•°æ®æ“ä½œä¸»è¦æœ‰ä¸¤ä¸ªï¼šä¸€æ˜¯ä¸»æ’­å¼€æ’­çš„æ—¶å€™å†™å…¥ä¸»æ’­ Id çš„ç»çº¬åº¦ï¼ŒäºŒæ˜¯ä¸»æ’­å…³æ’­çš„æ—¶å€™åˆ é™¤ä¸»æ’­ Id å…ƒç´ ã€‚è¿™æ ·å°±ç»´æŠ¤äº†ä¸€ä¸ªå…·æœ‰ä½ç½®ä¿¡æ¯çš„åœ¨çº¿ä¸»æ’­é›†åˆæä¾›ç»™çº¿ä¸Šæ£€ç´¢ã€‚</p>
<p>å¤§å®¶å…·ä½“ä½¿ç”¨çš„æ—¶å€™ï¼Œå¯ä»¥å»äº†è§£ä¸€ä¸‹ Redis GEO åŸç†ï¼Œä¸»è¦ç”¨åˆ°äº†ç©ºé—´ç´¢å¼•çš„ç®—æ³• GEOHASH çš„ç›¸å…³çŸ¥è¯†ï¼Œé’ˆå¯¹ç´¢å¼•æˆ‘ä»¬æ—¥å¸¸æ‰€è§éƒ½æ˜¯ä¸€ç»´çš„å­—ç¬¦ï¼Œé‚£ä¹ˆå¦‚ä½•å¯¹ä¸‰ç»´ç©ºé—´é‡Œé¢çš„åæ ‡ç‚¹å»ºç«‹ç´¢å¼•å‘¢ï¼Œç›´æ¥ç‚¹å°±æ˜¯ä¸‰ç»´å˜äºŒç»´ï¼ŒäºŒç»´å˜ä¸€ç»´ã€‚è¿™é‡Œå°±ä¸å†è¯¦ç»†é˜è¿°äº†ã€‚</p>
<h3 id="Redis-å®¢æˆ·ç«¯"><a href="#Redis-å®¢æˆ·ç«¯" class="headerlink" title="Redis å®¢æˆ·ç«¯"></a>Redis å®¢æˆ·ç«¯</h3><p>ä¸»æµç¼–ç¨‹è¯­è¨€éƒ½æœ‰å¯¹åº”çš„å¸¸ç”¨ Redis å®¢æˆ·ç«¯ï¼Œä¾‹å¦‚ï¼š</p>
<p>go -&gt; go redis<br>java -&gt; Jedis<br>python -&gt; redis-py<br>node -&gt; ioredis<br>å…·ä½“ä½¿ç”¨è¯­æ³•ï¼Œå¤§å®¶å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦æŸ¥æ‰¾å¯¹åº”çš„å®˜æ–¹æ–‡æ¡£ï¼š</p>
<p>Jedis æ–‡æ¡£ï¼š<a href="https://github.com/redis/jedis">https://github.com/redis/jedis</a></p>
<p>redis-py æ–‡æ¡£ï¼š<a href="https://github.com/redis/redis-py">https://github.com/redis/redis-py</a></p>
<p>ioredis æ–‡æ¡£ï¼š<a href="https://github.com/luin/ioredis">https://github.com/luin/ioredis</a><br>go redis æ–‡æ¡£ï¼š<a href="https://redis.uptrace.dev/">https://redis.uptrace.dev/</a></p>
<h2 id="æŒä¹…åŒ–ã€ä¸»ä»åŒæ­¥ä¸ç¼“å­˜è®¾è®¡"><a href="#æŒä¹…åŒ–ã€ä¸»ä»åŒæ­¥ä¸ç¼“å­˜è®¾è®¡" class="headerlink" title="æŒä¹…åŒ–ã€ä¸»ä»åŒæ­¥ä¸ç¼“å­˜è®¾è®¡"></a>æŒä¹…åŒ–ã€ä¸»ä»åŒæ­¥ä¸ç¼“å­˜è®¾è®¡</h2><h3 id="æŒä¹…åŒ–"><a href="#æŒä¹…åŒ–" class="headerlink" title="æŒä¹…åŒ–"></a>æŒä¹…åŒ–</h3><p>Redis æ”¯æŒ RDB å’Œ AOF ä¸¤ç§æŒä¹…åŒ–æœºåˆ¶ï¼ŒæŒä¹…åŒ–åŠŸèƒ½æœ‰æ•ˆåœ°é¿å…å› è¿›ç¨‹ é€€å‡ºé€ æˆçš„æ•°æ®ä¸¢å¤±é—®é¢˜ï¼Œå½“ä¸‹æ¬¡é‡å¯æ—¶åˆ©ç”¨ä¹‹å‰æŒä¹…åŒ–çš„æ–‡ä»¶å³å¯å®ç°æ•°æ®æ¢å¤ã€‚</p>
<ul>
<li>RDB æ˜¯ä¸€æ¬¡å…¨é‡å¤‡ä»½ï¼ŒAOF æ—¥å¿—æ˜¯è¿ç»­çš„å¢é‡å¤‡ä»½ï¼Œ RDB æ˜¯å†…å­˜æ•°æ®çš„äºŒè¿›åˆ¶åºåˆ—åŒ–å½¢å¼ï¼Œåœ¨å­˜å‚¨ä¸Šéå¸¸ç´§å‡‘ï¼Œè€Œ AOF æ—¥å¿—è®°å½•çš„æ˜¯å†…å­˜æ•°æ®ä¿®æ”¹çš„æŒ‡ä»¤è®°å½•æ–‡æœ¬ã€‚</li>
<li>AOF ä»¥ç‹¬ç«‹æ—¥å¿—çš„æ–¹å¼è®°å½•æ¯æ¬¡å†™å‘½ä»¤ï¼Œ é‡å¯æ—¶å†é‡æ–°æ‰§è¡Œ AOF æ–‡ä»¶ä¸­çš„å‘½ä»¤è¾¾åˆ°æ¢å¤æ•°æ®çš„ç›®çš„ã€‚AOF çš„ä¸»è¦ä½œç”¨ æ˜¯è§£å†³äº†æ•°æ®æŒä¹…åŒ–çš„å®æ—¶æ€§ï¼Œç›®å‰å·²ç»æ˜¯ Redis æŒä¹…åŒ–çš„ä¸»æµæ–¹å¼ã€‚</li>
</ul>
<p>AOF æ—¥å¿—åœ¨é•¿æœŸçš„è¿è¡Œè¿‡ç¨‹ä¸­ä¼šå˜çš„æ— æ¯”åºå¤§ï¼Œæ•°æ®åº“é‡å¯æ—¶éœ€è¦åŠ è½½ AOF æ—¥å¿—è¿›è¡ŒæŒ‡ä»¤é‡æ”¾ï¼Œè¿™ä¸ªæ—¶é—´å°±ä¼šæ— æ¯”æ¼«é•¿ã€‚æ‰€ä»¥éœ€è¦å®šæœŸè¿›è¡Œ AOF é‡å†™ï¼Œç»™ AOF æ—¥å¿—è¿›è¡Œç˜¦èº«ã€‚</p>
<h4 id="RDB"><a href="#RDB" class="headerlink" title="RDB"></a>RDB</h4><p>æˆ‘ä»¬çŸ¥é“ Redis æ˜¯å•çº¿ç¨‹ç¨‹åºï¼Œè¿™ä¸ªçº¿ç¨‹è¦åŒæ—¶è´Ÿè´£å¤šä¸ªå®¢æˆ·ç«¯å¥—æ¥å­—çš„å¹¶å‘è¯»å†™æ“ä½œå’Œå†…å­˜æ•°æ®ç»“æ„çš„é€»è¾‘è¯»å†™ã€‚</p>
<p>åœ¨æœåŠ¡çº¿ä¸Šè¯·æ±‚çš„åŒæ—¶ï¼ŒRedis è¿˜éœ€è¦è¿›è¡Œå†…å­˜ RDBï¼Œå†…å­˜ RDB è¦æ±‚ Redis å¿…é¡»è¿›è¡Œæ–‡ä»¶ IO æ“ä½œï¼Œå¯æ–‡ä»¶ IO æ“ä½œæ˜¯ä¸èƒ½ä½¿ç”¨å¤šè·¯å¤ç”¨ APIã€‚è¿™æ„å‘³ç€å•çº¿ç¨‹åŒæ—¶åœ¨æœåŠ¡çº¿ä¸Šçš„è¯·æ±‚è¿˜è¦è¿›è¡Œæ–‡ä»¶ IO æ“ä½œï¼Œæ–‡ä»¶ IO æ“ä½œä¼šä¸¥é‡æ‹–å®æœåŠ¡å™¨è¯·æ±‚çš„æ€§èƒ½ã€‚è¿˜æœ‰ä¸ªé‡è¦çš„é—®é¢˜æ˜¯ä¸ºäº†ä¸é˜»å¡çº¿ä¸Šçš„ä¸šåŠ¡ï¼Œå°±éœ€è¦è¾¹æŒä¹…åŒ–è¾¹å“åº”å®¢æˆ·ç«¯è¯·æ±‚ã€‚æŒä¹…åŒ–çš„åŒæ—¶ï¼Œå†…å­˜æ•°æ®ç»“æ„è¿˜åœ¨æ”¹å˜ï¼Œæ¯”å¦‚ä¸€ä¸ªå¤§å‹çš„ hash å­—å…¸æ­£åœ¨æŒä¹…åŒ–ï¼Œç»“æœä¸€ä¸ªè¯·æ±‚è¿‡æ¥æŠŠå®ƒç»™åˆ æ‰äº†ï¼Œè¿˜æ²¡æŒä¹…åŒ–å®Œå‘¢ï¼Œè¿™å¯æ€ä¹ˆåŠ?</p>
<p>é‚£è¯¥æ€ä¹ˆåŠå‘¢? Redis ä½¿ç”¨æ“ä½œç³»ç»Ÿçš„å¤šè¿›ç¨‹ COW(Copy On Write) æœºåˆ¶æ¥å®ç° RDB æŒä¹…åŒ–ï¼Œä»¥ä¸‹ä¸º RDB å¤‡ä»½æµç¨‹ï¼š<br><img src="/2022/07/12/uncatalog/cl5hsfpv60000m4r706d63234/64024.jpg" alt="img"><br>1ï¼Œæ‰§è¡Œ bgsave å‘½ä»¤ï¼ŒRedis çˆ¶è¿›ç¨‹åˆ¤æ–­å½“å‰æ˜¯å¦å­˜åœ¨æ­£åœ¨æ‰§è¡Œçš„å­è¿› ç¨‹ï¼Œå¦‚ RDB/AOF å­è¿›ç¨‹ï¼Œå¦‚æœå­˜åœ¨ bgsave å‘½ä»¤ç›´æ¥è¿”å›ã€‚<br>2ï¼Œçˆ¶è¿›ç¨‹æ‰§è¡Œ fork æ“ä½œåˆ›å»ºå­è¿›ç¨‹ï¼Œfork æ“ä½œè¿‡ç¨‹ä¸­çˆ¶è¿›ç¨‹ä¼šé˜»å¡ï¼Œé€š è¿‡ info stats å‘½ä»¤æŸ¥çœ‹ latest_fork_usec é€‰é¡¹ï¼Œå¯ä»¥è·å–æœ€è¿‘ä¸€ä¸ª fork æ“ä½œçš„è€— æ—¶ï¼Œå•ä½ä¸ºå¾®ç§’ã€‚<br>3ï¼Œçˆ¶è¿›ç¨‹ fork å®Œæˆåï¼Œbgsave å‘½ä»¤è¿”å› â€œBackground saving startedâ€ ä¿¡æ¯ å¹¶ä¸å†é˜»å¡çˆ¶è¿›ç¨‹ï¼Œå¯ä»¥ç»§ç»­å“åº”å…¶ä»–å‘½ä»¤ã€‚<br>4ï¼Œå­è¿›ç¨‹åˆ›å»º RDB æ–‡ä»¶ï¼Œæ ¹æ®çˆ¶è¿›ç¨‹å†…å­˜ç”Ÿæˆä¸´æ—¶å¿«ç…§æ–‡ä»¶ï¼Œå®Œæˆå å¯¹åŸæœ‰æ–‡ä»¶è¿›è¡ŒåŸå­æ›¿æ¢ã€‚æ‰§è¡Œ lastsave å‘½ä»¤å¯ä»¥è·å–æœ€åä¸€æ¬¡ç”Ÿæˆ RDB çš„ æ—¶é—´ï¼Œå¯¹åº” info ç»Ÿè®¡çš„ rdb_last_save_time é€‰é¡¹ã€‚<br>5ï¼Œè¿›ç¨‹å‘é€ä¿¡å·ç»™çˆ¶è¿›ç¨‹è¡¨ç¤ºå®Œæˆï¼Œçˆ¶è¿›ç¨‹æ›´æ–°ç»Ÿè®¡ä¿¡æ¯ï¼Œå…·ä½“è§ info Persistence ä¸‹çš„ rdb_* ç›¸å…³é€‰é¡¹</p>
<h4 id="AOF"><a href="#AOF" class="headerlink" title="AOF"></a>AOF</h4><p>AOF æ—¥å¿—å­˜å‚¨çš„æ˜¯ Redis æœåŠ¡å™¨çš„é¡ºåºæŒ‡ä»¤åºåˆ—ï¼ŒAOF æ—¥å¿—åªè®°å½•å¯¹å†…å­˜è¿›è¡Œä¿®æ”¹çš„ æŒ‡ä»¤è®°å½•ã€‚</p>
<p>å‡è®¾ AOF æ—¥å¿—è®°å½•äº†è‡ª Redis å®ä¾‹åˆ›å»ºä»¥æ¥æ‰€æœ‰çš„ä¿®æ”¹æ€§æŒ‡ä»¤åºåˆ—ï¼Œé‚£ä¹ˆå°±å¯ä»¥é€šè¿‡ å¯¹ä¸€ä¸ªç©ºçš„ Redis å®ä¾‹é¡ºåºæ‰§è¡Œæ‰€æœ‰çš„æŒ‡ä»¤ï¼Œä¹Ÿå°±æ˜¯ã€Œé‡æ”¾ã€ï¼Œæ¥æ¢å¤ Redis å½“å‰å®ä¾‹çš„å†… å­˜æ•°æ®ç»“æ„çš„çŠ¶æ€ã€‚</p>
<p>Redis ä¼šåœ¨æ”¶åˆ°å®¢æˆ·ç«¯ä¿®æ”¹æŒ‡ä»¤åï¼Œå…ˆè¿›è¡Œå‚æ•°æ ¡éªŒï¼Œå¦‚æœæ²¡é—®é¢˜ï¼Œå°±ç«‹å³å°†è¯¥æŒ‡ä»¤æ–‡æœ¬å­˜å‚¨åˆ° AOF æ—¥å¿—ä¸­ï¼Œä¹Ÿå°±æ˜¯å…ˆå­˜åˆ°ç£ç›˜ï¼Œç„¶åå†æ‰§è¡ŒæŒ‡ä»¤ã€‚è¿™æ ·å³ä½¿é‡åˆ°çªå‘å®•æœºï¼Œå·²ç»å­˜å‚¨åˆ° AOF æ—¥å¿—çš„æŒ‡ä»¤è¿›è¡Œé‡æ”¾ä¸€ä¸‹å°±å¯ä»¥æ¢å¤åˆ°å®•æœºå‰çš„çŠ¶æ€ã€‚é€šè¿‡ appendfsync å‚æ•°å¯ä»¥æ§åˆ¶å®æ—¶/ç§’çº§æŒä¹…åŒ– ã€‚</p>
<p>AOF æµç¨‹:</p>
<p><img src="/2022/07/12/uncatalog/cl5hsfpv60000m4r706d63234/64025.jpg" alt="img"></p>
<p> 1ï¼Œæ‰€æœ‰çš„å†™å…¥å‘½ä»¤ä¼šè¿½åŠ åˆ° aof_buf(ç¼“å†²åŒº)ä¸­ã€‚<br> 2ï¼ŒAOF ç¼“å†²åŒºæ ¹æ®å¯¹åº”çš„ç­–ç•¥å‘ç¡¬ç›˜åšåŒæ­¥æ“ä½œã€‚<br> 3ï¼Œéšç€ AOF æ–‡ä»¶è¶Šæ¥è¶Šå¤§ï¼Œéœ€è¦å®šæœŸå¯¹ AOF æ–‡ä»¶è¿›è¡Œé‡å†™ï¼Œè¾¾åˆ°å‹ç¼©çš„ç›®çš„ã€‚<br> 4ï¼Œå½“ Redis æœåŠ¡å™¨é‡å¯æ—¶ï¼Œå¯ä»¥åŠ è½½ AOF æ–‡ä»¶è¿›è¡Œæ•°æ®æ¢å¤ã€‚</p>
<p>Redis åœ¨é•¿æœŸè¿è¡Œçš„è¿‡ç¨‹ä¸­ï¼ŒAOF çš„æ—¥å¿—ä¼šè¶Šå˜è¶Šé•¿ã€‚å¦‚æœå®ä¾‹å®•æœºé‡å¯ï¼Œé‡æ”¾æ•´ä¸ª AOF æ—¥å¿—ä¼šéå¸¸è€—æ—¶ï¼Œå¯¼è‡´é•¿æ—¶é—´ Redis æ— æ³•å¯¹å¤–æä¾›æœåŠ¡ã€‚æ‰€ä»¥éœ€è¦å¯¹ AOF æ—¥å¿—ç˜¦èº«ã€‚</p>
<p>Redis æä¾›äº† bgrewriteaof æŒ‡ä»¤ç”¨äºå¯¹ AOF æ—¥å¿—è¿›è¡Œç˜¦èº«ã€‚å…¶åŸç†å°±æ˜¯å¼€è¾Ÿä¸€ä¸ªå­è¿›ç¨‹å¯¹å†…å­˜è¿›è¡Œéå†è½¬æ¢æˆä¸€ç³»åˆ— Redis çš„æ“ä½œæŒ‡ä»¤ï¼Œåºåˆ—åŒ–åˆ°ä¸€ä¸ªæ–°çš„ AOF æ—¥å¿—æ–‡ä»¶ä¸­ã€‚åºåˆ—åŒ–å®Œæ¯•åå†å°†æ“ä½œæœŸé—´å‘ç”Ÿçš„å¢é‡ AOF æ—¥å¿—è¿½åŠ åˆ°è¿™ä¸ªæ–°çš„ AOF æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œè¿½åŠ å®Œæ¯•åå°±ç«‹å³æ›¿ä»£æ—§çš„ AOF æ—¥å¿—æ–‡ä»¶äº†ï¼Œç˜¦èº«å·¥ä½œå°±å®Œæˆäº†ã€‚</p>
<p>AOF ç˜¦èº«é‡å†™æµç¨‹ï¼š</p>
<p><img src="/2022/07/12/uncatalog/cl5hsfpv60000m4r706d63234/64026.jpg" alt="img"></p>
<p>AOF é‡å†™å¯ä»¥é€šè¿‡ auto-aof-rewrite-min-siz e å’Œ auto-aof-rewrite- percentage å‚æ•°æ§åˆ¶è‡ªåŠ¨è§¦å‘ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ bgrewriteaof å‘½ä»¤æ‰‹åŠ¨è§¦å‘ã€‚</p>
<p>å­è¿›ç¨‹æ‰§è¡ŒæœŸé—´ä½¿ç”¨ copy-on-write æœºåˆ¶ä¸çˆ¶è¿›ç¨‹å…±äº«å†…å­˜ï¼Œé¿å…å†… å­˜æ¶ˆè€—ç¿»å€ã€‚AOF é‡å†™æœŸé—´è¿˜éœ€è¦ç»´æŠ¤é‡å†™ç¼“å†²åŒºï¼Œä¿å­˜æ–°çš„å†™å…¥å‘½ä»¤é¿å… æ•°æ®ä¸¢å¤±ã€‚</p>
<p>å•æœºä¸‹éƒ¨ç½²å¤šä¸ªå®ä¾‹æ—¶ï¼Œä¸ºäº†é˜²æ­¢å‡ºç°å¤šä¸ªå­è¿›ç¨‹æ‰§è¡Œé‡å†™æ“ä½œï¼Œ å»ºè®®åšéš”ç¦»æ§åˆ¶ï¼Œé¿å… CPU å’Œ IO èµ„æºç«äº‰ã€‚</p>
<h4 id="Redis-4-0-æ··åˆæŒä¹…åŒ–"><a href="#Redis-4-0-æ··åˆæŒä¹…åŒ–" class="headerlink" title="Redis 4.0 æ··åˆæŒä¹…åŒ–"></a>Redis 4.0 æ··åˆæŒä¹…åŒ–</h4><p>é‡å¯ Redis æ—¶ï¼Œæˆ‘ä»¬å¾ˆå°‘ä½¿ç”¨ RDB æ¥æ¢å¤å†…å­˜çŠ¶æ€ï¼Œå› ä¸ºä¼šä¸¢å¤±å¤§é‡æ•°æ®ã€‚æˆ‘ä»¬é€šå¸¸ ä½¿ç”¨ AOF æ—¥å¿—é‡æ”¾ï¼Œä½†æ˜¯é‡æ”¾ AOF æ—¥å¿—æ€§èƒ½ç›¸å¯¹ rdb æ¥è¯´è¦æ…¢å¾ˆå¤šï¼Œè¿™æ ·åœ¨ Redis å® ä¾‹å¾ˆå¤§çš„æƒ…å†µä¸‹ï¼Œå¯åŠ¨éœ€è¦èŠ±è´¹å¾ˆé•¿çš„æ—¶é—´ã€‚</p>
<p>Redis 4.0 ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¸¦æ¥äº†ä¸€ä¸ªæ–°çš„æŒä¹…åŒ–é€‰é¡¹â€”â€”æ··åˆæŒä¹…åŒ–ã€‚å°† RDB æ–‡ ä»¶çš„å†…å®¹å’Œå¢é‡çš„ AOF æ—¥å¿—æ–‡ä»¶å­˜åœ¨ä¸€èµ·ã€‚è¿™é‡Œçš„ AOF æ—¥å¿—ä¸å†æ˜¯å…¨é‡çš„æ—¥å¿—ï¼Œè€Œæ˜¯è‡ª æŒä¹…åŒ–å¼€å§‹åˆ°æŒä¹…åŒ–ç»“æŸçš„è¿™æ®µæ—¶é—´å‘ç”Ÿçš„å¢é‡ AOF æ—¥å¿—ï¼Œé€šå¸¸è¿™éƒ¨åˆ† AOF æ—¥å¿—å¾ˆå°ã€‚</p>
<p>äºæ˜¯åœ¨ Redis é‡å¯çš„æ—¶å€™ï¼Œå¯ä»¥å…ˆåŠ è½½ RDB çš„å†…å®¹ï¼Œç„¶åå†é‡æ”¾å¢é‡ AOF æ—¥å¿—å°±å¯ ä»¥å®Œå…¨æ›¿ä»£ä¹‹å‰çš„ AOF å…¨é‡æ–‡ä»¶é‡æ”¾ï¼Œé‡å¯æ•ˆç‡å› æ­¤å¤§å¹…å¾—åˆ°æå‡ã€‚<br><img src="/2022/07/12/uncatalog/cl5hsfpv60000m4r706d63234/64027.jpg" alt="img"></p>
<h2 id="ä¸»ä»åŒæ­¥â€”ç®€å•äº†è§£"><a href="#ä¸»ä»åŒæ­¥â€”ç®€å•äº†è§£" class="headerlink" title="ä¸»ä»åŒæ­¥â€”ç®€å•äº†è§£"></a>ä¸»ä»åŒæ­¥â€”ç®€å•äº†è§£</h2><p>å¾ˆå¤šä¼ä¸šéƒ½æ²¡æœ‰ä½¿ç”¨åˆ° Redis çš„é›†ç¾¤ï¼Œä½†æ˜¯è‡³å°‘éƒ½åšäº†ä¸»ä»ã€‚æœ‰äº†ä¸»ä»ï¼Œå½“ master æŒ‚ æ‰çš„æ—¶å€™ï¼Œè¿ç»´è®©ä»åº“è¿‡æ¥æ¥ç®¡ï¼ŒæœåŠ¡å°±å¯ä»¥ç»§ç»­ï¼Œå¦åˆ™ master éœ€è¦ç»è¿‡æ•°æ®æ¢å¤å’Œé‡å¯çš„è¿‡ç¨‹ï¼Œè¿™å°±å¯èƒ½ä¼šæ‹–å¾ˆé•¿çš„æ—¶é—´ï¼Œå½±å“çº¿ä¸Šä¸šåŠ¡çš„æŒç»­æœåŠ¡ã€‚</p>
<p>Redis é€šè¿‡ä¸»ä»åŒæ­¥åŠŸèƒ½å®ç°ä¸»èŠ‚ç‚¹çš„å¤šä¸ªå‰¯æœ¬ã€‚ä»èŠ‚ç‚¹å¯çµæ´»åœ°é€šè¿‡ slaveof å‘½ä»¤å»ºç«‹æˆ–æ–­å¼€åŒæ­¥æµç¨‹ã€‚åŒæ­¥å¤åˆ¶åˆ†ä¸ºï¼šå…¨é‡å¤åˆ¶å’Œéƒ¨åˆ†å¢é‡å¤åˆ¶ä¸»ä»èŠ‚ç‚¹ä¹‹é—´ç»´æŠ¤å¿ƒè·³å’Œåç§»é‡æ£€æŸ¥æœºåˆ¶ï¼Œä¿è¯ä¸»ä»èŠ‚ç‚¹é€šä¿¡æ­£å¸¸å’Œæ•°æ®ä¸€è‡´ã€‚</p>
<p>Redis ä¸ºäº†ä¿è¯é«˜æ€§èƒ½å¤åˆ¶è¿‡ç¨‹æ˜¯å¼‚æ­¥çš„ï¼Œå†™å‘½ä»¤å¤„ç†å®Œåç›´æ¥è¿”å›ç»™å®¢æˆ·ç«¯ï¼Œä¸ç­‰å¾…ä»èŠ‚ç‚¹å¤åˆ¶å®Œæˆã€‚å› æ­¤ä»èŠ‚ç‚¹æ•°æ®é›†ä¼šæœ‰å»¶è¿Ÿæƒ…å†µã€‚å³å½“ä½¿ç”¨ä»èŠ‚ç‚¹ç”¨äºè¯»å†™åˆ†ç¦»æ—¶ä¼šå­˜åœ¨æ•°æ®å»¶è¿Ÿã€è¿‡æœŸæ•°æ®ã€ä»èŠ‚ç‚¹å¯ç”¨æ€§ç­‰é—®é¢˜ï¼Œéœ€è¦æ ¹æ®è‡ªèº«ä¸šåŠ¡æå‰ä½œå‡ºè§„é¿ã€‚</p>
<p>æ³¨æ„ï¼šåœ¨è¿ç»´è¿‡ç¨‹ä¸­ï¼Œä¸»èŠ‚ç‚¹å­˜åœ¨å¤šä¸ªä»èŠ‚ç‚¹æˆ–è€…ä¸€å°æœºå™¨ä¸Šéƒ¨ç½²å¤§é‡ä¸»èŠ‚ç‚¹çš„æƒ…å†µä¸‹ï¼Œä¼šæœ‰å¤åˆ¶é£æš´çš„é£é™©ã€‚</p>
<h3 id="Redis-Sentinel-å“¨å…µ"><a href="#Redis-Sentinel-å“¨å…µ" class="headerlink" title="Redis Sentinel(å“¨å…µ)"></a>Redis Sentinel(å“¨å…µ)</h3><p>ä¸»ä»å¤åˆ¶æ˜¯ Redis åˆ†å¸ƒå¼çš„åŸºç¡€ï¼ŒRedis çš„é«˜å¯ç”¨ç¦»å¼€äº†ä¸»ä»å¤åˆ¶å°†æ— ä»è¿›è¡Œã€‚åé¢çš„æˆ‘ä»¬ä¼šè®²åˆ° Redis çš„é›†ç¾¤æ¨¡å¼ï¼Œé›†ç¾¤æ¨¡å¼éƒ½ä¾èµ–äºæœ¬èŠ‚æ‰€è®²çš„ä¸»ä»å¤åˆ¶ã€‚</p>
<p>ä¸è¿‡å¤åˆ¶åŠŸèƒ½ä¹Ÿä¸æ˜¯å¿…é¡»çš„ï¼Œå¦‚æœä½ å°† Redis åªç”¨æ¥åšç¼“å­˜ï¼Œä¹Ÿå°±æ— éœ€è¦ä»åº“åšå¤‡ä»½ï¼ŒæŒ‚æ‰äº†é‡æ–°å¯åŠ¨ä¸€ä¸‹å°±è¡Œã€‚ä½†æ˜¯åªè¦ä½ ä½¿ç”¨äº† Redis çš„æŒä¹…åŒ– åŠŸèƒ½ï¼Œå°±å¿…é¡»è®¤çœŸå¯¹å¾…ä¸»ä»å¤åˆ¶ï¼Œå®ƒæ˜¯ç³»ç»Ÿæ•°æ®å®‰å…¨çš„åŸºç¡€ä¿éšœã€‚</p>
<p>ä¸¾ä¾‹ï¼šå¦‚æœä¸»èŠ‚ç‚¹å‡Œæ™¨ 3 ç‚¹çªå‘å®•æœºæ€ä¹ˆåŠ?å°±åç­‰è¿ç»´ä»åºŠä¸Šçˆ¬èµ·æ¥ï¼Œç„¶åæ‰‹å·¥è¿›è¡Œä»ä¸»åˆ‡æ¢ï¼Œå†é€šçŸ¥æ‰€æœ‰çš„ç¨‹ åºæŠŠåœ°å€ç»Ÿç»Ÿæ”¹ä¸€éé‡æ–°ä¸Šçº¿ä¹ˆ?æ¯«æ— ç–‘é—®ï¼Œè¿™æ ·çš„äººå·¥è¿ç»´æ•ˆç‡å¤ªä½ï¼Œäº‹æ•…å‘ç”Ÿæ—¶ä¼°è®¡å¾— è‡³å°‘ 1 ä¸ªå°æ—¶æ‰èƒ½ç¼“è¿‡æ¥ã€‚</p>
<p>Sentinel è´Ÿè´£æŒç»­ç›‘æ§ä¸»ä»èŠ‚ç‚¹çš„å¥åº·ï¼Œå½“ä¸»èŠ‚ç‚¹æŒ‚æ‰æ—¶ï¼Œè‡ªåŠ¨é€‰æ‹©ä¸€ä¸ªæœ€ä¼˜çš„ä»èŠ‚ç‚¹åˆ‡æ¢ä¸ºä¸»èŠ‚ç‚¹ã€‚å®¢æˆ·ç«¯æ¥è¿æ¥é›†ç¾¤æ—¶ï¼Œä¼šé¦–å…ˆè¿æ¥ sentinelï¼Œé€šè¿‡ sentinel æ¥æŸ¥è¯¢ä¸»èŠ‚ç‚¹çš„åœ°å€ï¼Œ ç„¶åå†å»è¿æ¥ä¸»èŠ‚ç‚¹è¿›è¡Œæ•°æ®äº¤äº’ã€‚å½“ä¸»èŠ‚ç‚¹å‘ç”Ÿæ•…éšœæ—¶ï¼Œå®¢æˆ·ç«¯ä¼šé‡æ–°å‘ sentinel è¦åœ°å€ï¼Œsentinel ä¼šå°†æœ€æ–°çš„ä¸»èŠ‚ç‚¹åœ°å€å‘Šè¯‰å®¢æˆ·ç«¯ã€‚å¦‚æ­¤åº”ç”¨ç¨‹åºå°†æ— éœ€é‡å¯å³å¯è‡ªåŠ¨å®ŒæˆèŠ‚ç‚¹åˆ‡æ¢ã€‚å¦‚å›¾</p>
<p><img src="/2022/07/12/uncatalog/cl5hsfpv60000m4r706d63234/64028.jpg" alt="img"><br><img src="/2022/07/12/uncatalog/cl5hsfpv60000m4r706d63234/64029.jpg" alt="img"></p>
<h3 id="æ¶ˆæ¯ä¸¢å¤±"><a href="#æ¶ˆæ¯ä¸¢å¤±" class="headerlink" title="æ¶ˆæ¯ä¸¢å¤±"></a>æ¶ˆæ¯ä¸¢å¤±</h3><p>Redis ä¸»ä»é‡‡ç”¨å¼‚æ­¥å¤åˆ¶ï¼Œæ„å‘³ç€å½“ä¸»èŠ‚ç‚¹æŒ‚æ‰æ—¶ï¼Œä»èŠ‚ç‚¹å¯èƒ½æ²¡æœ‰æ”¶åˆ°å…¨éƒ¨çš„åŒæ­¥æ¶ˆæ¯ï¼Œè¿™éƒ¨åˆ†æœªåŒæ­¥çš„æ¶ˆæ¯å°±ä¸¢å¤±äº†ã€‚å¦‚æœä¸»ä»å»¶è¿Ÿç‰¹åˆ«å¤§ï¼Œé‚£ä¹ˆä¸¢å¤±çš„æ•°æ®å°±å¯èƒ½ä¼šç‰¹åˆ« å¤šã€‚Sentinel æ— æ³•ä¿è¯æ¶ˆæ¯å®Œå…¨ä¸ä¸¢å¤±ï¼Œä½†æ˜¯ä¹Ÿå°½å¯èƒ½ä¿è¯æ¶ˆæ¯å°‘ä¸¢å¤±ã€‚å®ƒæœ‰ä¸¤ä¸ªé€‰é¡¹å¯ä»¥ é™åˆ¶ä¸»ä»å»¶è¿Ÿè¿‡å¤§ï¼š</p>
<ul>
<li>min-slaves-to-write 1</li>
<li>min-slaves-max-lag 10<br>ç¬¬ä¸€ä¸ªå‚æ•°è¡¨ç¤ºä¸»èŠ‚ç‚¹å¿…é¡»è‡³å°‘æœ‰ä¸€ä¸ªä»èŠ‚ç‚¹åœ¨è¿›è¡Œæ­£å¸¸å¤åˆ¶ï¼Œå¦åˆ™å°±åœæ­¢å¯¹å¤–å†™æœåŠ¡ï¼Œä¸§å¤±å¯ç”¨æ€§ã€‚</li>
</ul>
<p>ä½•ä¸ºæ­£å¸¸å¤åˆ¶ï¼Œä½•ä¸ºå¼‚å¸¸å¤åˆ¶?è¿™ä¸ªå°±æ˜¯ç”±ç¬¬äºŒä¸ªå‚æ•°æ§åˆ¶çš„ï¼Œå®ƒçš„å•ä½æ˜¯ç§’ï¼Œè¡¨ç¤ºå¦‚æœ 10s æ²¡æœ‰æ”¶åˆ°ä»èŠ‚ç‚¹çš„åé¦ˆï¼Œå°±æ„å‘³ç€ä»èŠ‚ç‚¹åŒæ­¥ä¸æ­£å¸¸ï¼Œè¦ä¹ˆç½‘ç»œæ–­å¼€äº†ï¼Œè¦ä¹ˆä¸€ç›´æ²¡æœ‰ç»™åé¦ˆã€‚</p>
<h3 id="Redis-æœ€ç»ˆä¸€è‡´"><a href="#Redis-æœ€ç»ˆä¸€è‡´" class="headerlink" title="Redis æœ€ç»ˆä¸€è‡´"></a>Redis æœ€ç»ˆä¸€è‡´</h3><p>Redis çš„ä¸»ä»æ•°æ®æ˜¯å¼‚æ­¥åŒæ­¥çš„ï¼Œæ‰€ä»¥åˆ†å¸ƒå¼çš„ Redis ç³»ç»Ÿå¹¶ä¸æ»¡è¶³ã€Œä¸€è‡´æ€§ã€è¦æ±‚ã€‚å½“å®¢æˆ·ç«¯åœ¨ Redis çš„ä¸»èŠ‚ç‚¹ä¿®æ”¹äº†æ•°æ®åï¼Œç«‹å³è¿”å›ï¼Œå³ä½¿åœ¨ä¸»ä»ç½‘ç»œæ–­å¼€çš„æƒ…å†µä¸‹ï¼Œä¸»èŠ‚ ç‚¹ä¾æ—§å¯ä»¥æ­£å¸¸å¯¹å¤–æä¾›ä¿®æ”¹æœåŠ¡ï¼Œæ‰€ä»¥ Redis æ»¡è¶³ã€Œå¯ç”¨æ€§ã€ã€‚</p>
<p>Redis ä¿è¯ã€Œæœ€ç»ˆä¸€è‡´æ€§ã€ï¼Œä»èŠ‚ç‚¹ä¼šåŠªåŠ›è¿½èµ¶ä¸»èŠ‚ç‚¹ï¼Œæœ€ç»ˆä»èŠ‚ç‚¹çš„çŠ¶æ€ä¼šå’Œä¸»èŠ‚ç‚¹ çš„çŠ¶æ€å°†ä¿æŒä¸€è‡´ã€‚å¦‚æœç½‘ç»œæ–­å¼€äº†ï¼Œä¸»ä»èŠ‚ç‚¹çš„æ•°æ®å°†ä¼šå‡ºç°å¤§é‡ä¸ä¸€è‡´ï¼Œä¸€æ—¦ç½‘ç»œæ¢ å¤ï¼Œä»èŠ‚ç‚¹ä¼šé‡‡ç”¨å¤šç§ç­–ç•¥åŠªåŠ›è¿½èµ¶ä¸Šè½åçš„æ•°æ®ï¼Œç»§ç»­å°½åŠ›ä¿æŒå’Œä¸»èŠ‚ç‚¹ä¸€è‡´ã€‚</p>
<h2 id="ç¼“å­˜"><a href="#ç¼“å­˜" class="headerlink" title="ç¼“å­˜"></a>ç¼“å­˜</h2><p>ç¼“å­˜çš„æ”¶ç›Šä¸æˆæœ¬<br>æ”¶ç›Šï¼š</p>
<ul>
<li>åŠ é€Ÿè¯»å†™ï¼šCPU L1/L2/L3 Cacheã€æµè§ˆå™¨ç¼“å­˜ç­‰ã€‚å› ä¸ºç¼“å­˜é€šå¸¸éƒ½æ˜¯å…¨å†…å­˜çš„ï¼ˆä¾‹å¦‚ Redisã€Memcacheï¼‰ï¼Œè€Œ å­˜å‚¨å±‚é€šå¸¸è¯»å†™æ€§èƒ½ä¸å¤Ÿå¼ºæ‚ï¼ˆä¾‹å¦‚ MySQLï¼‰ï¼Œé€šè¿‡ç¼“å­˜çš„ä½¿ç”¨å¯ä»¥æœ‰æ•ˆ åœ°åŠ é€Ÿè¯»å†™ï¼Œä¼˜åŒ–ç”¨æˆ·ä½“éªŒã€‚</li>
<li>é™ä½åç«¯è´Ÿè½½ï¼šå¸®åŠ©åç«¯å‡å°‘è®¿é—®é‡å’Œå¤æ‚è®¡ç®—ï¼Œåœ¨å¾ˆå¤§ç¨‹åº¦é™ä½äº†åç«¯çš„è´Ÿè½½ã€‚æˆæœ¬ï¼š</li>
<li>æ•°æ®ä¸ä¸€è‡´ï¼šç¼“å­˜å±‚å’Œæ•°æ®å±‚æœ‰æ—¶é—´çª—å£ä¸ä¸€è‡´ï¼Œå’Œæ›´æ–°ç­–ç•¥æœ‰å…³ã€‚</li>
<li>ä»£ç ç»´æŠ¤æˆæœ¬ï¼šåŠ å…¥ç¼“å­˜åï¼Œéœ€è¦åŒæ—¶å¤„ç†ç¼“å­˜å±‚å’Œå­˜å‚¨å±‚çš„é€»è¾‘ï¼Œ å¢å¤§äº†å¼€å‘è€…ç»´æŠ¤ä»£ç çš„æˆæœ¬ã€‚</li>
<li>è¿ç»´æˆæœ¬ï¼šä»¥ Redis Cluster ä¸ºä¾‹ï¼ŒåŠ å…¥åæ— å½¢ä¸­å¢åŠ äº†è¿ç»´æˆæœ¬ã€‚ä½¿ç”¨åœºæ™¯ï¼š</li>
<li>é™ä½åç«¯è´Ÿè½½ï¼šå¯¹é«˜æ¶ˆè€—çš„ SQLï¼šjoin ç»“æœé›†/åˆ†ç»„ç»Ÿè®¡ç»“æœç¼“å­˜ã€‚</li>
<li>åŠ é€Ÿè¯·æ±‚å“åº”ï¼šåˆ©ç”¨ Redis/Memcache ä¼˜åŒ– IO å“åº”æ—¶é—´ã€‚</li>
<li>å¤§é‡å†™åˆå¹¶ä¸ºæ‰¹é‡å†™ï¼šæ¯”å¦‚è®¡æ•°å™¨å…ˆ Redis ç´¯åŠ å†æ‰¹é‡å†™å…¥ DBã€‚<br>ç¼“å­˜æ›´æ–°ç­–ç•¥â€”ç®—æ³•å‰”é™¤</li>
<li>LRUï¼šLeast Recently Usedï¼Œæœ€è¿‘æœ€å°‘ä½¿ç”¨ã€‚</li>
<li>LFUï¼šLeast Frequently Usedï¼Œæœ€ä¸ç»å¸¸ä½¿ç”¨ã€‚</li>
<li>FIFOï¼šFirst In First Outï¼Œå…ˆè¿›å…ˆå‡ºã€‚<br>ä½¿ç”¨åœºæ™¯ï¼šå‰”é™¤ç®—æ³•é€šå¸¸ç”¨äºç¼“å­˜ä½¿ç”¨é‡è¶…è¿‡äº†é¢„è®¾çš„æœ€å¤§å€¼æ—¶å€™ï¼Œå¦‚ä½•å¯¹ç°æœ‰çš„æ•°æ®è¿›è¡Œå‰”é™¤ã€‚ä¾‹å¦‚ Redis ä½¿ç”¨ maxmemory-policy è¿™ä¸ªé…ç½®ä½œä¸ºå†…å­˜æœ€å¤§å€¼åå¯¹äºæ•°æ®çš„å‰”é™¤ç­–ç•¥ã€‚</li>
</ul>
<p>ä¸€è‡´æ€§ï¼šè¦æ¸…ç†å“ªäº›æ•°æ®æ˜¯ç”±å…·ä½“ç®—æ³•å†³å®šï¼Œå¼€å‘äººå‘˜åªèƒ½å†³å®šä½¿ç”¨å“ªç§ç®—æ³•ï¼Œæ‰€ä»¥æ•°æ®çš„ä¸€è‡´æ€§æ˜¯æœ€å·®çš„ã€‚</p>
<p>ç»´æŠ¤æˆæœ¬ï¼šç®—æ³•ä¸éœ€è¦å¼€å‘äººå‘˜è‡ªå·±æ¥å®ç°ï¼Œé€šå¸¸åªéœ€è¦é…ç½®æœ€å¤§ maxmemory å’Œå¯¹åº”çš„ç­–ç•¥å³å¯ã€‚</p>
<h4 id="ç¼“å­˜æ›´æ–°ç­–ç•¥â€”è¶…æ—¶å‰”é™¤"><a href="#ç¼“å­˜æ›´æ–°ç­–ç•¥â€”è¶…æ—¶å‰”é™¤" class="headerlink" title="ç¼“å­˜æ›´æ–°ç­–ç•¥â€”è¶…æ—¶å‰”é™¤"></a>ç¼“å­˜æ›´æ–°ç­–ç•¥â€”è¶…æ—¶å‰”é™¤</h4><p>ä½¿ç”¨åœºæ™¯ï¼šè¶…æ—¶å‰”é™¤é€šè¿‡ç»™ç¼“å­˜æ•°æ®è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œè®©å…¶åœ¨è¿‡æœŸæ—¶é—´åè‡ªåŠ¨åˆ é™¤ï¼Œä¾‹å¦‚ Redis æä¾›çš„ expire å‘½ä»¤ã€‚å¦‚æœä¸šåŠ¡å¯ä»¥å®¹å¿ä¸€æ®µæ—¶é—´å†…ï¼Œç¼“å­˜å±‚æ•°æ®å’Œå­˜å‚¨å±‚æ•°æ®ä¸ä¸€è‡´ï¼Œé‚£ä¹ˆå¯ä»¥ä¸ºå…¶è®¾ç½®è¿‡æœŸæ—¶é—´ã€‚åœ¨æ•°æ®è¿‡æœŸåï¼Œå†ä»çœŸå®æ•°æ®æºè·å–æ•°æ®ï¼Œé‡æ–°æ”¾åˆ°ç¼“å­˜å¹¶è®¾ç½®è¿‡æœŸæ—¶é—´ã€‚</p>
<p>ä¸€è‡´æ€§ï¼šä¸€æ®µæ—¶é—´çª—å£å†…ï¼ˆå–å†³äºè¿‡æœŸæ—¶é—´é•¿çŸ­ï¼‰å­˜åœ¨ä¸€è‡´æ€§é—®é¢˜ï¼Œå³ç¼“å­˜æ•°æ®å’ŒçœŸå®æ•°æ®æºçš„æ•°æ®ä¸ä¸€è‡´ã€‚</p>
<p>ç»´æŠ¤æˆæœ¬ï¼šç»´æŠ¤æˆæœ¬ä¸æ˜¯å¾ˆé«˜ï¼Œåªéœ€è®¾ç½® expire è¿‡æœŸæ—¶é—´å³å¯ï¼Œå½“ç„¶å‰ææ˜¯åº”ç”¨æ–¹å…è®¸è¿™æ®µæ—¶é—´å¯èƒ½å‘ç”Ÿçš„æ•°æ®ä¸ä¸€è‡´ã€‚</p>
<h4 id="ç¼“å­˜æ›´æ–°ç­–ç•¥â€”ä¸»åŠ¨æ›´æ–°"><a href="#ç¼“å­˜æ›´æ–°ç­–ç•¥â€”ä¸»åŠ¨æ›´æ–°" class="headerlink" title="ç¼“å­˜æ›´æ–°ç­–ç•¥â€”ä¸»åŠ¨æ›´æ–°"></a>ç¼“å­˜æ›´æ–°ç­–ç•¥â€”ä¸»åŠ¨æ›´æ–°</h4><p>ä½¿ç”¨åœºæ™¯ï¼šåº”ç”¨æ–¹å¯¹äºæ•°æ®çš„ä¸€è‡´æ€§è¦æ±‚é«˜ï¼Œéœ€è¦åœ¨çœŸå®æ•°æ®æ›´æ–°åï¼Œ ç«‹å³æ›´æ–°ç¼“å­˜æ•°æ®ã€‚ä¾‹å¦‚å¯ä»¥åˆ©ç”¨æ¶ˆæ¯ç³»ç»Ÿæˆ–è€…å…¶ä»–æ–¹å¼é€šçŸ¥ç¼“å­˜æ›´æ–°ã€‚</p>
<p>ä¸€è‡´æ€§ï¼šä¸€è‡´æ€§æœ€é«˜ï¼Œä½†å¦‚æœä¸»åŠ¨æ›´æ–°å‘ç”Ÿäº†é—®é¢˜ï¼Œé‚£ä¹ˆè¿™æ¡æ•°æ®å¾ˆå¯èƒ½å¾ˆé•¿æ—¶é—´ä¸ä¼šæ›´æ–°ï¼Œæ‰€ä»¥å»ºè®®ç»“åˆè¶…æ—¶å‰”é™¤ä¸€èµ·ä½¿ç”¨æ•ˆæœä¼šæ›´å¥½ã€‚</p>
<p>ç»´æŠ¤æˆæœ¬ï¼šç»´æŠ¤æˆæœ¬ä¼šæ¯”è¾ƒé«˜ï¼Œå¼€å‘è€…éœ€è¦è‡ªå·±æ¥å®Œæˆæ›´æ–°ï¼Œå¹¶ä¿è¯æ›´æ–°æ“ä½œçš„æ­£ç¡®æ€§ã€‚</p>
<h4 id="ç¼“å­˜æ›´æ–°ç­–ç•¥â€”æ€»ç»“"><a href="#ç¼“å­˜æ›´æ–°ç­–ç•¥â€”æ€»ç»“" class="headerlink" title="ç¼“å­˜æ›´æ–°ç­–ç•¥â€”æ€»ç»“"></a>ç¼“å­˜æ›´æ–°ç­–ç•¥â€”æ€»ç»“</h4><p><img src="/2022/07/12/uncatalog/cl5hsfpv60000m4r706d63234/64030.jpg" alt="img"></p>
<p>ä½ä¸€è‡´æ€§ä¸šåŠ¡ï¼šå»ºè®®é…ç½®æœ€å¤§å†…å­˜å’Œæ·˜æ±°ç­–ç•¥çš„æ–¹å¼ä½¿ç”¨ã€‚</p>
<p>é«˜ä¸€è‡´æ€§ä¸šåŠ¡ï¼šå¯ä»¥ç»“åˆä½¿ç”¨è¶…æ—¶å‰”é™¤å’Œä¸»åŠ¨æ›´æ–°ï¼Œè¿™æ ·å³ä½¿ä¸»åŠ¨æ›´æ–°å‡ºäº†é—®é¢˜ï¼Œä¹Ÿèƒ½ä¿è¯æ•°æ®è¿‡æœŸæ—¶é—´ååˆ é™¤è„æ•°æ®ã€‚</p>
<h4 id="ç¼“å­˜å¯èƒ½ä¼šé‡åˆ°çš„é—®é¢˜"><a href="#ç¼“å­˜å¯èƒ½ä¼šé‡åˆ°çš„é—®é¢˜" class="headerlink" title="ç¼“å­˜å¯èƒ½ä¼šé‡åˆ°çš„é—®é¢˜"></a>ç¼“å­˜å¯èƒ½ä¼šé‡åˆ°çš„é—®é¢˜</h4><p>ç¼“å­˜ç©¿é€ï¼šæŒ‡æŸ¥è¯¢ä¸€ä¸ªä¸€å®šä¸å­˜åœ¨çš„æ•°æ®ï¼Œç”±äºç¼“å­˜æ˜¯ä¸å‘½ä¸­æ—¶è¢«åŠ¨å†™çš„ï¼Œå¹¶ä¸”å‡ºäºå®¹é”™è€ƒè™‘ï¼Œå¦‚æœä»å­˜å‚¨å±‚æŸ¥ä¸åˆ°æ•°æ®åˆ™ä¸å†™å…¥ç¼“å­˜ï¼Œè¿™å°†å¯¼è‡´è¿™ä¸ªä¸å­˜åœ¨çš„æ•°æ®æ¯æ¬¡è¯·æ±‚éƒ½è¦åˆ°å­˜å‚¨å±‚å»æŸ¥è¯¢ï¼Œå¤±å»äº†ç¼“å­˜çš„æ„ä¹‰ã€‚åœ¨æµé‡å¤§æ—¶ï¼Œå¯èƒ½ DB å°±æŒ‚æ‰äº†ï¼Œè¦æ˜¯æœ‰äººåˆ©ç”¨ä¸å­˜åœ¨çš„ key é¢‘ç¹æ”»å‡»æˆ‘ä»¬çš„åº”ç”¨ï¼Œè¿™å°±æ˜¯æ¼æ´ã€‚è§£å†³æ–¹æ³•ï¼š</p>
<ul>
<li>å¸ƒéš†è¿‡æ»¤å™¨ï¼Œå°†æ‰€æœ‰å¯èƒ½å­˜åœ¨çš„æ•°æ®å“ˆå¸Œåˆ°ä¸€ä¸ªè¶³å¤Ÿå¤§çš„ bitmap ä¸­ï¼Œä¸€ä¸ªä¸€å®šä¸å­˜åœ¨çš„æ•°æ®ä¼šè¢« è¿™ä¸ª bitmap æ‹¦æˆªæ‰ï¼Œä»è€Œé¿å…äº†å¯¹åº•å±‚å­˜å‚¨ç³»ç»Ÿçš„æŸ¥è¯¢å‹åŠ›ã€‚</li>
<li>å¦å¤–ä¹Ÿæœ‰ä¸€ä¸ªæ›´ä¸ºç®€å•ç²—æš´çš„æ–¹æ³•ï¼ˆæˆ‘ä»¬é‡‡ç”¨çš„å°±æ˜¯è¿™ç§ï¼‰ï¼Œå¦‚æœä¸€ä¸ªæŸ¥è¯¢è¿”å›çš„æ•°æ®ä¸ºç©ºï¼ˆä¸ç®¡æ˜¯æ•° æ®ä¸å­˜åœ¨ï¼Œè¿˜æ˜¯ç³»ç»Ÿæ•…éšœï¼‰ï¼Œæˆ‘ä»¬ä»ç„¶æŠŠè¿™ä¸ªç©ºç»“æœè¿›è¡Œç¼“å­˜ï¼Œä½†å®ƒçš„è¿‡æœŸæ—¶é—´ä¼šå¾ˆçŸ­ï¼Œæœ€é•¿ä¸è¶…è¿‡äº”åˆ†é’Ÿã€‚<br>ç¼“å­˜é›ªå´©ï¼šæŒ‡åœ¨æˆ‘ä»¬è®¾ç½®ç¼“å­˜æ—¶é‡‡ç”¨äº†ç›¸åŒçš„è¿‡æœŸæ—¶é—´ï¼Œå¯¼è‡´ç¼“å­˜åœ¨æŸä¸€æ—¶åˆ»åŒæ—¶å¤±æ•ˆï¼Œè¯·æ±‚å…¨éƒ¨è½¬å‘åˆ° DBï¼ŒDB ç¬æ—¶å‹åŠ›è¿‡é‡é›ªå´©ã€‚è§£å†³æ–¹æ³•ï¼šæˆ‘ä»¬å¯ä»¥åœ¨åŸæœ‰çš„å¤±æ•ˆæ—¶é—´åŸºç¡€ä¸Šå¢åŠ ä¸€ä¸ªéšæœºå€¼ï¼Œæ¯”å¦‚ 1-5 åˆ†é’Ÿéšæœºï¼Œè¿™æ ·æ¯ä¸€ä¸ªç¼“å­˜çš„è¿‡æœŸæ—¶é—´çš„é‡å¤ç‡å°±ä¼šé™ä½ï¼Œå°±å¾ˆéš¾å¼•å‘é›†ä½“å¤±æ•ˆçš„äº‹ä»¶ã€‚</li>
</ul>
<p>ç¼“å­˜å‡»ç©¿ï¼šå¯¹äºä¸€äº›è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„ keyï¼Œå¦‚æœè¿™äº› key å¯èƒ½ä¼šåœ¨æŸäº›æ—¶é—´ç‚¹è¢«è¶…é«˜å¹¶å‘åœ°è®¿é—®ï¼Œæ˜¯ä¸€ç§éå¸¸â€œçƒ­ç‚¹â€çš„æ•°æ®ã€‚è¿™ä¸ªæ—¶å€™ï¼Œéœ€è¦è€ƒè™‘ä¸€ä¸ªé—®é¢˜ï¼šç¼“å­˜è¢«â€œå‡»ç©¿â€çš„é—®é¢˜ï¼Œè¿™ä¸ªå’Œç¼“å­˜é›ªå´©çš„åŒºåˆ«åœ¨äºè¿™é‡Œé’ˆå¯¹æŸä¸€ key ç¼“å­˜ï¼Œå‰è€…åˆ™æ˜¯å¾ˆå¤š keyã€‚ç¼“å­˜åœ¨æŸä¸ªæ—¶é—´ç‚¹è¿‡æœŸçš„æ—¶å€™ï¼Œæ°å¥½åœ¨è¿™ä¸ªæ—¶é—´ç‚¹å¯¹è¿™ä¸ª Key æœ‰å¤§é‡çš„å¹¶å‘è¯·æ±‚è¿‡æ¥ï¼Œè¿™äº›è¯·æ±‚å‘ç°ç¼“å­˜è¿‡æœŸä¸€èˆ¬éƒ½ä¼šä»åç«¯ DB åŠ è½½æ•°æ®å¹¶å›è®¾åˆ°ç¼“å­˜ï¼Œè¿™ä¸ªæ—¶å€™å¤§å¹¶å‘çš„è¯·æ±‚å¯èƒ½ä¼šç¬é—´æŠŠåç«¯ DB å‹å®ã€‚è§£å†³æ–¹æ³•ï¼šäº’æ–¥é”ã€æ°¸è¿œä¸è¿‡æœŸè®¾ç½®ã€èµ„æºä¿æŠ¤ç­‰ç­‰ã€‚</p>
<p>ç¼“å­˜æ— åº•æ´é—®é¢˜ï¼šFacebook çš„å·¥ä½œäººå‘˜ååº” 2010 å¹´å·²è¾¾åˆ° 3000 ä¸ª memcached èŠ‚ç‚¹ï¼Œå‚¨å­˜æ•°åƒ G çš„ç¼“å­˜ã€‚ä»–ä»¬å‘ç°ä¸€ä¸ªé—®é¢˜â€“ memcached çš„è¿æ¥æ•ˆç‡ä¸‹é™äº†ï¼Œäºæ˜¯æ·»åŠ  memcached èŠ‚ç‚¹ï¼Œæ·»åŠ å®Œä¹‹åï¼Œå¹¶æ²¡æœ‰å¥½è½¬ã€‚ç§°ä¸ºâ€œæ— åº•æ´â€ç°è±¡ã€‚åŸå› ï¼šå®¢æˆ·ç«¯ä¸€æ¬¡æ‰¹é‡æ“ä½œä¼šæ¶‰åŠå¤šæ¬¡ç½‘ç»œæ“ä½œï¼Œä¹Ÿå°±æ„å‘³ç€æ‰¹é‡æ“ä½œä¼šéšç€å®ä¾‹çš„å¢å¤šï¼Œè€—æ—¶ä¼šä¸æ–­å¢å¤§ã€‚æœåŠ¡ç«¯ç½‘ç»œè¿æ¥æ¬¡æ•°å˜å¤šï¼Œå¯¹å®ä¾‹çš„æ€§èƒ½ä¹Ÿæœ‰ä¸€å®šå½±å“ã€‚å³ï¼šæ›´å¤šçš„æœºå™¨ä¸ä»£è¡¨æ›´å¤šçš„æ€§èƒ½ï¼Œæ‰€è°“â€œæ— åº•æ´â€å°±æ˜¯è¯´æŠ•å…¥è¶Šå¤šä¸ä¸€å®šäº§å‡ºè¶Šå¤šã€‚è§£å†³æ–¹æ¡ˆæœ‰ï¼šä¸²è¡Œ mgetã€ä¸²è¡Œ IOã€å¹¶è¡Œ IOã€Hash tag å®ç°ç­‰ï¼Œæ›´å¤šè¯·çœ‹ï¼šç¼“å­˜æ— åº•æ´é—®é¢˜ï¼ˆ<a href="http://ifeve.com/redis-multiget-hole/%EF%BC%89">http://ifeve.com/redis-multiget-hole/ï¼‰</a></p>
<h2 id="çŸ¥è¯†æ‹“å±•"><a href="#çŸ¥è¯†æ‹“å±•" class="headerlink" title="çŸ¥è¯†æ‹“å±•"></a>çŸ¥è¯†æ‹“å±•</h2><h3 id="ç¼“å­˜ä¸æ•°æ®åº“åŒæ­¥ç­–ç•¥ï¼ˆå¦‚ä½•ä¿è¯ç¼“å­˜-Redis-ä¸æ•°æ®åº“-MySQL-çš„ä¸€è‡´æ€§ï¼Ÿï¼‰"><a href="#ç¼“å­˜ä¸æ•°æ®åº“åŒæ­¥ç­–ç•¥ï¼ˆå¦‚ä½•ä¿è¯ç¼“å­˜-Redis-ä¸æ•°æ®åº“-MySQL-çš„ä¸€è‡´æ€§ï¼Ÿï¼‰" class="headerlink" title="ç¼“å­˜ä¸æ•°æ®åº“åŒæ­¥ç­–ç•¥ï¼ˆå¦‚ä½•ä¿è¯ç¼“å­˜(Redis)ä¸æ•°æ®åº“(MySQL)çš„ä¸€è‡´æ€§ï¼Ÿï¼‰"></a>ç¼“å­˜ä¸æ•°æ®åº“åŒæ­¥ç­–ç•¥ï¼ˆå¦‚ä½•ä¿è¯ç¼“å­˜(Redis)ä¸æ•°æ®åº“(MySQL)çš„ä¸€è‡´æ€§ï¼Ÿï¼‰</h3><p>å¯¹äºçƒ­ç‚¹æ•°æ®ï¼ˆç»å¸¸è¢«æŸ¥è¯¢ï¼Œä½†ä¸ç»å¸¸è¢«ä¿®æ”¹çš„æ•°æ®ï¼‰ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šå°†å…¶æ”¾å…¥ Redis ç¼“å­˜ä¸­ï¼Œä»¥å¢åŠ æŸ¥è¯¢æ•ˆç‡ï¼Œä½†éœ€è¦ä¿è¯ä» Redis ä¸­è¯»å–çš„æ•°æ®ä¸æ•°æ®åº“ä¸­å­˜å‚¨çš„æ•°æ®æœ€ç»ˆæ˜¯ä¸€è‡´çš„ï¼Œè¿™å°±æ˜¯ç»å…¸çš„ç¼“å­˜ä¸æ•°æ®åº“åŒæ­¥é—®é¢˜ã€‚</p>
<p>é‚£ä¹ˆï¼Œå¦‚ä½•ä¿è¯ç¼“å­˜(Redis)ä¸æ•°æ®åº“(MySQL)çš„ä¸€è‡´æ€§å‘¢ï¼Ÿæ ¹æ®ç¼“å­˜æ˜¯åˆ é™¤è¿˜æ˜¯æ›´æ–°ï¼Œä»¥åŠæ“ä½œé¡ºåºå¤§æ¦‚æ˜¯å¯ä»¥åˆ†ä¸ºä¸‹é¢å››ç§æƒ…å†µï¼š</p>
<ul>
<li>å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†æ›´æ–°ç¼“å­˜ </li>
<li>å…ˆæ›´æ–°ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“</li>
<li>å…ˆåˆ é™¤ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“</li>
<li>å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜<br>åˆ é™¤ç¼“å­˜å¯¹æ¯”æ›´æ–°ç¼“å­˜</li>
<li>åˆ é™¤ç¼“å­˜: æ•°æ®åªä¼šå†™å…¥æ•°æ®åº“ï¼Œä¸ä¼šå†™å…¥ç¼“å­˜ï¼Œåªä¼šåˆ é™¤ç¼“å­˜</li>
<li>æ›´æ–°ç¼“å­˜: æ•°æ®ä¸ä½†å†™å…¥æ•°æ®åº“ï¼Œè¿˜ä¼šå†™å…¥ç¼“å­˜<br>åˆ é™¤ç¼“å­˜</li>
<li>ä¼˜ç‚¹ï¼šæ“ä½œç®€å•ï¼Œæ— è®ºæ›´æ–°æ“ä½œæ˜¯å¦å¤æ‚ï¼Œç›´æ¥åˆ é™¤ï¼Œå¹¶ä¸”èƒ½é˜²æ­¢æ›´æ–°å‡ºç°çš„çº¿ç¨‹å®‰å…¨é—®é¢˜</li>
<li>ç¼ºç‚¹ï¼šåˆ é™¤åï¼Œä¸‹ä¸€æ¬¡æŸ¥è¯¢æ— æ³•åœ¨ cache ä¸­æŸ¥åˆ°ï¼Œä¼šæœ‰ä¸€æ¬¡ Cache Missï¼Œè¿™æ—¶éœ€è¦é‡æ–°è¯»å–æ•°æ®åº“ï¼Œé«˜å¹¶å‘ä¸‹å¯èƒ½ä¼šå‡ºç°ä¸Šé¢è¯´çš„ç¼“å­˜é—®é¢˜</li>
</ul>
<p>æ›´æ–°ç¼“å­˜</p>
<ul>
<li><p>ä¼˜ç‚¹ï¼šå‘½ä¸­ç‡é«˜ï¼Œç›´æ¥æ›´æ–°ç¼“å­˜ï¼Œä¸ä¼šæœ‰ Cache Miss çš„æƒ…å†µ</p>
</li>
<li><p>ç¼ºç‚¹ï¼šæ›´æ–°ç¼“å­˜æ¶ˆè€—è¾ƒå¤§ï¼Œå°¤å…¶åœ¨å¤æ‚çš„æ“ä½œæµç¨‹ä¸­<br>é‚£åˆ°åº•æ˜¯é€‰æ‹©æ›´æ–°ç¼“å­˜è¿˜æ˜¯åˆ é™¤ç¼“å­˜å‘¢ï¼Œä¸»è¦å–å†³äºæ›´æ–°ç¼“å­˜çš„å¤æ‚åº¦</p>
</li>
<li><p>æ›´æ–°ç¼“å­˜çš„ä»£ä»·å¾ˆå°ï¼Œæ­¤æ—¶æˆ‘ä»¬åº”è¯¥æ›´å€¾å‘äºæ›´æ–°ç¼“å­˜ï¼Œä»¥ä¿è¯æ›´é«˜çš„ç¼“å­˜å‘½ä¸­ç‡</p>
</li>
<li><p>æ›´æ–°ç¼“å­˜çš„ä»£ä»·å¾ˆå¤§ï¼Œæ­¤æ—¶æˆ‘ä»¬åº”è¯¥æ›´å€¾å‘äºåˆ é™¤ç¼“å­˜<br>ä¾‹å¦‚ï¼šåªæ˜¯ç®€å•çš„æ›´æ–°ä¸€ä¸‹ç”¨æˆ·ç§¯åˆ†ï¼Œåªæ“ä½œä¸€ä¸ªå­—æ®µï¼Œé‚£å°±å¯ä»¥é‡‡ç”¨æ›´æ–°ç¼“å­˜ï¼Œè¿˜æœ‰ç±»ä¼¼ç§’æ€ä¸‹å•†å“åº“å­˜æ•°é‡è¿™ç§å¹¶å‘ä¸‹æŸ¥è¯¢é¢‘ç¹çš„æ•°æ®ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æ›´æ–°ç¼“å­˜ï¼Œä¸è¿‡ä¹Ÿè¦æ³¨æ„çº¿ç¨‹å®‰å…¨çš„é—®é¢˜ï¼Œé˜²æ­¢äº§ç”Ÿè„æ•°æ®ã€‚ä½†æ˜¯å½“æ›´æ–°æ“ä½œçš„é€»è¾‘è¾ƒå¤æ‚æ—¶ï¼Œéœ€è¦æ¶‰åŠåˆ°å…¶å®ƒæ•°æ®ï¼Œå¦‚ç”¨æˆ·è´­ä¹°å•†å“ä»˜æ¬¾æ—¶ï¼Œéœ€è¦è€ƒè™‘æ‰“æŠ˜ã€ä¼˜æƒ åˆ¸ã€çº¢åŒ…ç­‰å¤šç§å› ç´ ï¼Œè¿™æ ·éœ€è¦ç¼“å­˜ä¸æ•°æ®åº“è¿›è¡Œå¤šæ¬¡äº¤äº’ï¼Œå°†æ‰“æŠ˜ç­‰ä¿¡æ¯ä¼ å…¥ç¼“å­˜ï¼Œå†ä¸ç¼“å­˜ä¸­çš„å…¶å®ƒå€¼è¿›è¡Œè®¡ç®—æ‰èƒ½å¾—åˆ°æœ€ç»ˆç»“æœï¼Œæ­¤æ—¶æ›´æ–°ç¼“å­˜çš„æ¶ˆè€—è¦å¤§äºç›´æ¥æ·˜æ±°ç¼“å­˜ã€‚</p>
</li>
</ul>
<p>æ‰€ä»¥è¿˜æ˜¯è¦æ ¹æ®ä¸šåŠ¡åœºæ™¯æ¥è¿›è¡Œé€‰æ‹©ï¼Œä¸è¿‡å¤§éƒ¨åˆ†åœºæ™¯ä¸‹åˆ é™¤ç¼“å­˜æ“ä½œç®€å•ï¼Œå¹¶ä¸”å¸¦æ¥çš„å‰¯ä½œç”¨åªæ˜¯å¢åŠ äº†ä¸€æ¬¡ Cache Missï¼Œå»ºè®®ä½œä¸ºé€šç”¨çš„å¤„ç†æ–¹å¼ã€‚</p>
<h3 id="å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†æ›´æ–°ç¼“å­˜"><a href="#å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†æ›´æ–°ç¼“å­˜" class="headerlink" title="å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†æ›´æ–°ç¼“å­˜"></a>å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†æ›´æ–°ç¼“å­˜</h3><p>è¿™ç§æ–¹å¼å°±é€‚åˆæ›´æ–°ç¼“å­˜çš„ä»£ä»·å¾ˆå°çš„æ•°æ®ï¼Œä¾‹å¦‚ä¸Šé¢è¯´çš„ç”¨æˆ·ç§¯åˆ†ï¼Œåº“å­˜æ•°é‡è¿™ç±»æ•°æ®ï¼ŒåŒæ ·è¿˜æ˜¯è¦æ³¨æ„çº¿ç¨‹å®‰å…¨çš„é—®é¢˜ã€‚</p>
<h4 id="çº¿ç¨‹å®‰å…¨è§’åº¦"><a href="#çº¿ç¨‹å®‰å…¨è§’åº¦" class="headerlink" title="çº¿ç¨‹å®‰å…¨è§’åº¦"></a>çº¿ç¨‹å®‰å…¨è§’åº¦</h4><p>åŒæ—¶æœ‰è¯·æ±‚ A å’Œè¯·æ±‚ B è¿›è¡Œæ›´æ–°æ“ä½œï¼Œé‚£ä¹ˆä¼šå‡ºç°</p>
<p> 1ï¼Œçº¿ç¨‹ A æ›´æ–°äº†æ•°æ®åº“<br> 2ï¼Œçº¿ç¨‹ B æ›´æ–°äº†æ•°æ®åº“<br> 3ï¼Œçº¿ç¨‹ B æ›´æ–°äº†ç¼“å­˜<br> 4ï¼Œçº¿ç¨‹ A æ›´æ–°äº†ç¼“å­˜<br>è¿™å°±å‡ºç°è¯·æ±‚ A æ›´æ–°ç¼“å­˜åº”è¯¥æ¯”è¯·æ±‚ B æ›´æ–°ç¼“å­˜æ—©æ‰å¯¹ï¼Œä½†æ˜¯å› ä¸ºç½‘ç»œç­‰åŸå› ï¼ŒB å´æ¯” A æ›´æ—©æ›´æ–°äº†ç¼“å­˜ï¼Œè¿™å°±å¯¼è‡´äº†è„æ•°æ®ã€‚</p>
<h4 id="ä¸šåŠ¡åœºæ™¯è§’åº¦"><a href="#ä¸šåŠ¡åœºæ™¯è§’åº¦" class="headerlink" title="ä¸šåŠ¡åœºæ™¯è§’åº¦"></a>ä¸šåŠ¡åœºæ™¯è§’åº¦</h4><p>æœ‰å¦‚ä¸‹ä¸¤ç§ä¸é€‚åˆåœºæ™¯ï¼š</p>
<p> 1ï¼Œå¦‚æœä½ æ˜¯ä¸€ä¸ªå†™æ•°æ®åº“åœºæ™¯æ¯”è¾ƒå¤šï¼Œè€Œè¯»æ•°æ®åœºæ™¯æ¯”è¾ƒå°‘çš„ä¸šåŠ¡éœ€æ±‚ï¼Œé‡‡ç”¨è¿™ç§æ–¹æ¡ˆå°±ä¼šå¯¼è‡´ï¼Œæ•°æ®å‹æ ¹è¿˜æ²¡è¯»åˆ°ï¼Œç¼“å­˜å°±è¢«é¢‘ç¹çš„æ›´æ–°ï¼Œæµªè´¹æ€§èƒ½<br> 2ï¼Œå¦‚æœä½ å†™å…¥æ•°æ®åº“çš„å€¼ï¼Œå¹¶ä¸æ˜¯ç›´æ¥å†™å…¥ç¼“å­˜çš„ï¼Œè€Œæ˜¯è¦ç»è¿‡ä¸€ç³»åˆ—å¤æ‚çš„è®¡ç®—å†å†™å…¥ç¼“å­˜ã€‚é‚£ä¹ˆï¼Œæ¯æ¬¡å†™å…¥æ•°æ®åº“åï¼Œéƒ½å†æ¬¡è®¡ç®—å†™å…¥ç¼“å­˜çš„å€¼ï¼Œæ— ç–‘æ˜¯ä¹Ÿæµªè´¹æ€§èƒ½çš„</p>
<h3 id="å…ˆæ›´æ–°ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“"><a href="#å…ˆæ›´æ–°ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“" class="headerlink" title="å…ˆæ›´æ–°ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“"></a>å…ˆæ›´æ–°ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“</h3><p>è¿™ç§æƒ…å†µåº”è¯¥æ˜¯å’Œç¬¬ä¸€ç§æƒ…å†µä¸€æ ·ä¼šå­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜çš„ï¼Œä½†æ˜¯è¿™ç§æƒ…å†µæ˜¯æœ‰äººä½¿ç”¨è¿‡çš„ï¼Œæ ¹æ®ä¹¦ç±ã€Šæ·˜å®æŠ€æœ¯è¿™åå¹´ã€‹é‡Œï¼Œå¤šéš†æŠŠå•†å“è¯¦æƒ…é¡µæ”¾å…¥ç¼“å­˜ï¼Œé‡‡å–çš„æ­£æ˜¯å…ˆæ›´æ–°ç¼“å­˜ï¼Œå†å°†ç¼“å­˜ä¸­çš„æ•°æ®å¼‚æ­¥æ›´æ–°åˆ°æ•°æ®åº“è¿™ç§æ–¹å¼ï¼Œæœ‰å…´è¶£äº†è§£çš„å¯ä»¥æŸ¥çœ‹è¿™ç¯‡åšå®¢: <a href="https://www.cnblogs.com/rjzheng/p/9240611.html">https://www.cnblogs.com/rjzheng/p/9240611.html</a></p>
<p>è¿˜æœ‰ç°åœ¨äº’è”ç½‘å¸¸è§çš„ç‚¹èµåŠŸèƒ½ï¼Œä¹Ÿå¯ä»¥é‡‡ç”¨è¿™ç§æ–¹å¼ï¼Œæœ‰å…´è¶£äº†è§£çš„å¯ä»¥æŸ¥çœ‹è¿™ç¯‡æ–‡ç« : <a href="https://juejin.im/post/5bdc257e6fb9a049ba410098">https://juejin.im/post/5bdc257e6fb9a049ba410098</a></p>
<h3 id="å…ˆåˆ é™¤ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“"><a href="#å…ˆåˆ é™¤ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“" class="headerlink" title="å…ˆåˆ é™¤ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“"></a>å…ˆåˆ é™¤ç¼“å­˜ï¼Œå†æ›´æ–°æ•°æ®åº“</h3><p>ç®€å•çš„æƒ³ä¸€ä¸‹ï¼Œå¥½åƒè¿™ç§æ–¹å¼ä¸é”™ï¼Œå°±ç®—æ˜¯ç¬¬ä¸€æ­¥åˆ é™¤ç¼“å­˜æˆåŠŸï¼Œç¬¬äºŒæ­¥å†™æ•°æ®åº“å¤±è´¥ï¼Œåˆ™åªä¼šå¼•å‘ä¸€æ¬¡ Cache Missï¼Œå¯¹æ•°æ®æ²¡æœ‰å½±å“ï¼Œå…¶å®ä»”ç»†ä¸€æƒ³å¹¶å‘ä¸‹ä¹Ÿå¾ˆå®¹æ˜“å¯¼è‡´äº†è„æ•°æ®ï¼Œä¾‹å¦‚</p>
<p> 1ï¼Œè¯·æ±‚ A è¿›è¡Œå†™æ“ä½œï¼Œåˆ é™¤ç¼“å­˜<br> 2ï¼Œè¯·æ±‚ B æŸ¥è¯¢å‘ç°ç¼“å­˜ä¸å­˜åœ¨<br> 3ï¼Œè¯·æ±‚ B å»æ•°æ®åº“æŸ¥è¯¢å¾—åˆ°æ—§å€¼<br> 4ï¼Œè¯·æ±‚ B å°†æ—§å€¼å†™å…¥ç¼“å­˜<br> 5ï¼Œè¯·æ±‚ A å°†æ–°å€¼å†™å…¥æ•°æ®åº“<br>é‚£æ€ä¹ˆè§£å†³å‘¢ï¼Œå…ˆçœ‹ç¬¬å››ç§æƒ…å†µï¼ˆå…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜ï¼‰ï¼Œåé¢å†ç»Ÿä¸€è¯´ç¬¬ä¸‰ç§å’Œç¬¬å››ç§çš„è§£å†³æ–¹æ¡ˆã€‚</p>
<h3 id="å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜"><a href="#å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜" class="headerlink" title="å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜"></a>å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜</h3><p>å…ˆè¯´ä¸€ä¸‹ï¼Œå›½å¤–æœ‰äººæå‡ºäº†ä¸€ä¸ªç¼“å­˜æ›´æ–°å¥—è·¯ï¼Œåä¸º Cache-Aside Patternï¼š<a href="https://docs.microsoft.com/en-us/azure/architecture/patterns/cache-aside">https://docs.microsoft.com/en-us/azure/architecture/patterns/cache-aside</a></p>
<ul>
<li>å¤±æ•ˆï¼šåº”ç”¨ç¨‹åºå…ˆä» cache å–æ•°æ®ï¼Œæ²¡æœ‰å¾—åˆ°ï¼Œåˆ™ä»æ•°æ®åº“ä¸­å–æ•°æ®ï¼ŒæˆåŠŸåï¼Œæ”¾åˆ°ç¼“å­˜ä¸­</li>
<li>å‘½ä¸­ï¼šåº”ç”¨ç¨‹åºä» cache ä¸­å–æ•°æ®ï¼Œæ¸ é“åè¿”å›</li>
<li>æ›´æ–°ï¼šå…ˆæŠŠæ•°æ®å­˜åˆ°æ•°æ®åº“ä¸­ï¼ŒæˆåŠŸåå†è®©ç¼“å­˜å¤±æ•ˆ<br>æ›´æ–°æ“ä½œå°±æ˜¯å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜ï¼›è¯»å–æ“ä½œå…ˆä»ç¼“å­˜å–æ•°æ®ï¼Œæ²¡æœ‰ï¼Œåˆ™ä»æ•°æ®åº“ä¸­å–æ•°æ®ï¼ŒæˆåŠŸåï¼Œæ”¾åˆ°ç¼“å­˜ä¸­ï¼›è¿™æ˜¯æ ‡å‡†çš„è®¾è®¡æ–¹æ¡ˆï¼ŒåŒ…æ‹¬ Facebook çš„è®ºæ–‡ Scaling Memcache at Facebookï¼šchrome-extension://ikhdkkncnoglghljlkmcimlnlhkeamad/pdf-viewer/web/viewer.html? file=https%3A%2F%2F<a href="http://www.usenix.org%2Fsystem%2Ffiles%2Fconference%2Fnsdi13%2Fnsdi13-final170_update.pdf">www.usenix.org%2Fsystem%2Ffiles%2Fconference%2Fnsdi13%2Fnsdi13-final170_update.pdf</a> ä¹Ÿä½¿ç”¨äº†è¿™ä¸ªç­–ç•¥ã€‚</li>
</ul>
<p>ä¸ºä»€ä¹ˆä»–ä»¬éƒ½ç”¨è¿™ç§æ–¹å¼å‘¢ï¼Œè¿™ç§æƒ…å†µä¸å­˜åœ¨å¹¶å‘é—®é¢˜ä¹ˆ?</p>
<p>ç­”æ¡ˆæ˜¯ä¹Ÿå­˜åœ¨ï¼Œä½†æ˜¯å‡ºç°æ¦‚ç‡æ¯”ç¬¬ä¸‰ç§ä½ï¼Œä¾‹å¦‚ï¼š</p>
<p> 1ï¼Œè¯·æ±‚ç¼“å­˜åˆšå¥½å¤±æ•ˆ<br> 2ï¼Œè¯·æ±‚ A æŸ¥è¯¢æ•°æ®åº“ï¼Œå¾—ä¸€ä¸ªæ—§å€¼<br> 3ï¼Œè¯·æ±‚ B å°†æ–°å€¼å†™å…¥æ•°æ®åº“<br> 4ï¼Œè¯·æ±‚ B åˆ é™¤ç¼“å­˜<br> 5ï¼Œè¯·æ±‚ A å°†æŸ¥åˆ°çš„æ—§å€¼å†™å…¥ç¼“å­˜<br>è¿™æ ·å°±å‡ºç°è„æ•°æ®äº†ï¼Œç„¶è€Œï¼Œå®é™…ä¸Šå‡ºç°çš„æ¦‚ç‡å¯èƒ½éå¸¸ä½ï¼Œå› ä¸ºè¿™ä¸ªæ¡ä»¶éœ€è¦å‘ç”Ÿåœ¨è¯»ç¼“å­˜æ—¶ç¼“å­˜å¤±æ•ˆï¼Œè€Œä¸”å¹¶å‘ç€æœ‰ä¸€ä¸ªå†™æ“ä½œã€‚è€Œå®é™…ä¸Šæ•°æ®åº“çš„å†™æ“ä½œä¼šæ¯”è¯»æ“ä½œæ…¢å¾—å¤šï¼Œè€Œä¸”è¿˜è¦é”è¡¨ï¼Œè€Œè¯»æ“ä½œå¿…éœ€åœ¨å†™æ“ä½œå‰è¿›å…¥æ•°æ®åº“æ“ä½œï¼Œè€Œåˆè¦æ™šäºå†™æ“ä½œåˆ é™¤ç¼“å­˜ï¼Œæ‰€æœ‰çš„è¿™äº›æ¡ä»¶éƒ½å…·å¤‡çš„æ¦‚ç‡åŸºæœ¬å¹¶ä¸å¤§ï¼Œä½†æ˜¯è¿˜æ˜¯ä¼šæœ‰å‡ºç°çš„æ¦‚ç‡ã€‚</p>
<p>å¹¶ä¸”å‡å¦‚ç¬¬ä¸€æ­¥å†™æ•°æ®åº“æˆåŠŸï¼Œç¬¬äºŒæ­¥åˆ é™¤ç¼“å­˜å¤±è´¥ï¼Œè¿™æ ·ä¹Ÿå¯¼è‡´è„æ•°æ®ï¼Œè¯·çœ‹è§£å†³æ–¹æ¡ˆã€‚</p>
<h3 id="æ–¹æ¡ˆä¸‰å››è„æ•°æ®è§£å†³æ–¹æ¡ˆ"><a href="#æ–¹æ¡ˆä¸‰å››è„æ•°æ®è§£å†³æ–¹æ¡ˆ" class="headerlink" title="æ–¹æ¡ˆä¸‰å››è„æ•°æ®è§£å†³æ–¹æ¡ˆ"></a>æ–¹æ¡ˆä¸‰å››è„æ•°æ®è§£å†³æ–¹æ¡ˆ</h3><p>é‚£æ€ä¹ˆè§£å†³å‘¢ï¼Œå¯ä»¥é‡‡ç”¨å»¶æ—¶åŒåˆ ç­–ç•¥(ç¼“å­˜åŒæ·˜æ±°æ³•)ï¼Œå¯ä»¥å°†å‰é¢æ‰€é€ æˆçš„ç¼“å­˜è„æ•°æ®ï¼Œå†æ¬¡åˆ é™¤ï¼š</p>
<p> 1ï¼Œå…ˆåˆ é™¤(æ·˜æ±°)ç¼“å­˜<br> 2ï¼Œå†å†™æ•°æ®åº“ï¼ˆè¿™ä¸¤æ­¥å’ŒåŸæ¥ä¸€æ ·ï¼‰<br> 3ï¼Œä¼‘çœ  1 ç§’ï¼Œå†æ¬¡åˆ é™¤(æ·˜æ±°)ç¼“å­˜<br>æˆ–è€…æ˜¯ï¼š</p>
<p> 1ï¼Œå…ˆå†™æ•°æ®åº“<br> 2ï¼Œå†åˆ é™¤(æ·˜æ±°)ç¼“å­˜ï¼ˆè¿™ä¸¤æ­¥å’ŒåŸæ¥ä¸€æ ·ï¼‰<br> 3ï¼Œä¼‘çœ  1 ç§’ï¼Œå†æ¬¡åˆ é™¤(æ·˜æ±°)ç¼“å­˜<br>è¿™ä¸ª 1 ç§’åº”è¯¥çœ‹ä½ çš„ä¸šåŠ¡åœºæ™¯ï¼Œåº”è¯¥è‡ªè¡Œè¯„ä¼°è‡ªå·±çš„é¡¹ç›®çš„è¯»æ•°æ®ä¸šåŠ¡é€»è¾‘çš„è€—æ—¶ï¼Œç„¶åå†™æ•°æ®çš„ä¼‘çœ æ—¶é—´åˆ™åœ¨è¯»æ•°æ®ä¸šåŠ¡é€»è¾‘çš„è€—æ—¶åŸºç¡€ä¸Šï¼ŒåŠ å‡ ç™¾æ¯«ç§’å³å¯ï¼Œè¿™ä¹ˆåšç¡®ä¿è¯»è¯·æ±‚ç»“æŸï¼Œå†™è¯·æ±‚å¯ä»¥åˆ é™¤è¯»è¯·æ±‚é€ æˆçš„ç¼“å­˜è„æ•°æ®ã€‚</p>
<p>å¦‚æœä½ ç”¨äº† MySql çš„è¯»å†™åˆ†ç¦»æ¶æ„æ€ä¹ˆåŠï¼Ÿï¼Œä¾‹å¦‚ï¼š</p>
<p> 1ï¼Œè¯·æ±‚ A è¿›è¡Œå†™æ“ä½œï¼Œåˆ é™¤ç¼“å­˜<br> 2ï¼Œè¯·æ±‚ A å°†æ•°æ®å†™å…¥æ•°æ®åº“äº†ï¼Œ(æˆ–è€…æ˜¯å…ˆæ›´æ–°æ•°æ®åº“ï¼Œååˆ é™¤ç¼“å­˜)<br> 3ï¼Œè¯·æ±‚ B æŸ¥è¯¢ç¼“å­˜å‘ç°ï¼Œç¼“å­˜æ²¡æœ‰å€¼<br> 4ï¼Œè¯·æ±‚ B å»ä»åº“æŸ¥è¯¢ï¼Œè¿™æ—¶ï¼Œè¿˜æ²¡æœ‰å®Œæˆä¸»ä»åŒæ­¥ï¼Œå› æ­¤æŸ¥è¯¢åˆ°çš„æ˜¯æ—§å€¼<br> 5ï¼Œè¯·æ±‚ B å°†æ—§å€¼å†™å…¥ç¼“å­˜<br> 6ï¼Œæ•°æ®åº“å®Œæˆä¸»ä»åŒæ­¥ï¼Œä»åº“å˜ä¸ºæ–°å€¼<br>è¿™ç§æƒ…æ™¯ï¼Œå°±æ˜¯æ•°æ®ä¸ä¸€è‡´çš„åŸå› ï¼Œè¿˜æ˜¯é‡‡ç”¨å»¶æ—¶åŒåˆ ç­–ç•¥(ç¼“å­˜åŒæ·˜æ±°æ³•)ï¼Œåªæ˜¯ï¼Œä¼‘çœ æ—¶é—´ä¿®æ”¹ä¸ºåœ¨ä¸»ä»åŒæ­¥çš„å»¶æ—¶æ—¶é—´åŸºç¡€ä¸Šï¼ŒåŠ å‡ ç™¾æ¯«ç§’<br> å¹¶ä¸”ä¸ºäº†æ€§èƒ½æ›´å¿«ï¼Œå¯ä»¥æŠŠç¬¬äºŒæ¬¡åˆ é™¤ç¼“å­˜å¯ä»¥åšæˆå¼‚æ­¥çš„ï¼Œè¿™æ ·ä¸ä¼šé˜»å¡è¯·æ±‚äº†ï¼Œå¦‚æœå†ä¸¥è°¨ç‚¹ï¼Œé˜²æ­¢ç¬¬äºŒæ¬¡åˆ é™¤ç¼“å­˜å¤±è´¥ï¼Œè¿™ä¸ªå¼‚æ­¥åˆ é™¤ç¼“å­˜å¯ä»¥åŠ ä¸Šé‡è¯•æœºåˆ¶ï¼Œå¤±è´¥ä¸€ç›´é‡è¯•ï¼Œç›´åˆ°æˆåŠŸã€‚</p>
<p>è¿™é‡Œç»™å‡ºä¸¤ç§é‡è¯•æœºåˆ¶å‚è€ƒ</p>
<h4 id="æ–¹æ¡ˆä¸€"><a href="#æ–¹æ¡ˆä¸€" class="headerlink" title="æ–¹æ¡ˆä¸€"></a>æ–¹æ¡ˆä¸€</h4><p> 1ï¼Œæ›´æ–°æ•°æ®åº“æ•°æ®<br> 2ï¼Œç¼“å­˜å› ä¸ºç§ç§é—®é¢˜åˆ é™¤å¤±è´¥<br> 3ï¼Œå°†éœ€è¦åˆ é™¤çš„ key å‘é€è‡³æ¶ˆæ¯é˜Ÿåˆ—<br> 4ï¼Œè‡ªå·±æ¶ˆè´¹æ¶ˆæ¯ï¼Œè·å¾—éœ€è¦åˆ é™¤çš„ key<br> 5ï¼Œç»§ç»­é‡è¯•åˆ é™¤æ“ä½œï¼Œç›´åˆ°æˆåŠŸ</p>
<p><img src="/2022/07/12/uncatalog/cl5hsfpv60000m4r706d63234/64031.jpg" alt="img"><br>ç„¶è€Œï¼Œè¯¥æ–¹æ¡ˆæœ‰ä¸€ä¸ªç¼ºç‚¹ï¼Œå¯¹ä¸šåŠ¡çº¿ä»£ç é€ æˆå¤§é‡çš„ä¾µå…¥ï¼Œäºæ˜¯æœ‰äº†æ–¹æ¡ˆäºŒï¼Œå¯åŠ¨ä¸€ä¸ªè®¢é˜…ç¨‹åºå»è®¢é˜…æ•°æ®åº“çš„ Binlogï¼Œè·å¾—éœ€è¦æ“ä½œçš„æ•°æ®ã€‚åœ¨åº”ç”¨ç¨‹åºä¸­ï¼Œå¦èµ·ä¸€æ®µç¨‹åºï¼Œè·å¾—è¿™ä¸ªè®¢é˜…ç¨‹åºä¼ æ¥çš„ä¿¡æ¯ï¼Œè¿›è¡Œåˆ é™¤ç¼“å­˜æ“ä½œ</p>
<h4 id="æ–¹æ¡ˆäºŒï¼š"><a href="#æ–¹æ¡ˆäºŒï¼š" class="headerlink" title="æ–¹æ¡ˆäºŒï¼š"></a>æ–¹æ¡ˆäºŒï¼š</h4><p> 1,æ›´æ–°æ•°æ®åº“æ•°æ®<br> 2,æ•°æ®åº“ä¼šå°†æ“ä½œä¿¡æ¯å†™å…¥ binlog æ—¥å¿—å½“ä¸­<br> 3,è®¢é˜…ç¨‹åºæå–å‡ºæ‰€éœ€è¦çš„æ•°æ®ä»¥åŠ key<br> 4,å¦èµ·ä¸€æ®µéä¸šåŠ¡ä»£ç ï¼Œè·å¾—è¯¥ä¿¡æ¯<br> 5,å°è¯•åˆ é™¤ç¼“å­˜æ“ä½œï¼Œå‘ç°åˆ é™¤å¤±è´¥<br> 6,å°†è¿™äº›ä¿¡æ¯å‘é€è‡³æ¶ˆæ¯é˜Ÿåˆ—<br> 7,é‡æ–°ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­è·å¾—è¯¥æ•°æ®ï¼Œé‡è¯•æ“ä½œ</p>
<p><img src="/2022/07/12/uncatalog/cl5hsfpv60000m4r706d63234/64032.jpg" alt="img"></p>
<p>ä¸Šè¿°çš„è®¢é˜… Binlog ç¨‹åºåœ¨ MySql ä¸­æœ‰ç°æˆçš„ä¸­é—´ä»¶å« Canalï¼Œå¯ä»¥å®Œæˆè®¢é˜… Binlog æ—¥å¿—çš„åŠŸèƒ½ï¼Œå¦å¤–ï¼Œé‡è¯•æœºåˆ¶ï¼Œè¿™é‡Œé‡‡ç”¨çš„æ˜¯æ¶ˆæ¯é˜Ÿåˆ—çš„æ–¹å¼ã€‚å¦‚æœå¯¹ä¸€è‡´æ€§è¦æ±‚ä¸æ˜¯å¾ˆé«˜ï¼Œç›´æ¥åœ¨ç¨‹åºä¸­å¦èµ·ä¸€ä¸ªçº¿ç¨‹ï¼Œæ¯éš”ä¸€æ®µæ—¶é—´å»é‡è¯•å³å¯ï¼Œè¿™äº›å¤§å®¶å¯ä»¥çµæ´»è‡ªç”±å‘æŒ¥ï¼Œåªæ˜¯æä¾›ä¸€ä¸ªæ€è·¯ã€‚</p>
<p>æ€»ç»“ï¼š å¤§éƒ¨åˆ†åº”è¯¥ä½¿ç”¨çš„éƒ½æ˜¯ç¬¬ä¸‰ç§æˆ–ç¬¬å››ç§æ–¹å¼ï¼Œå¦‚æœéƒ½æ˜¯é‡‡ç”¨å»¶æ—¶åŒåˆ ç­–ç•¥(ç¼“å­˜åŒæ·˜æ±°æ³•)ï¼Œå¯èƒ½åŒºåˆ«ä¸ä¼šå¾ˆå¤§ï¼Œä¸è¿‡ç¬¬å››ç§æ–¹å¼å‡ºç°è„æ•°æ®æ¦‚ç‡æ˜¯æ›´å°ç‚¹ï¼Œæ›´å¤šçš„è¯è¿˜æ˜¯è¦ç»“åˆè‡ªèº«ä¸šåŠ¡åœºæ™¯ä½¿ç”¨ï¼Œçµæ´»å˜é€šã€‚</p>
<h2 id="åˆ†å¸ƒå¼é”"><a href="#åˆ†å¸ƒå¼é”" class="headerlink" title="åˆ†å¸ƒå¼é”"></a>åˆ†å¸ƒå¼é”</h2><p>ä¾‹å¦‚ä¸€ä¸ªæ“ä½œè¦ä¿®æ”¹ç”¨æˆ·çš„çŠ¶æ€ï¼Œä¿®æ”¹çŠ¶æ€éœ€è¦å…ˆè¯»å‡ºç”¨æˆ·çš„çŠ¶æ€ï¼Œåœ¨å†…å­˜é‡Œè¿›è¡Œä¿® æ”¹ï¼Œæ”¹å®Œäº†å†å­˜å›å»ã€‚å¦‚æœè¿™æ ·çš„æ“ä½œåŒæ—¶è¿›è¡Œäº†ï¼Œå°±ä¼šå‡ºç°å¹¶å‘é—®é¢˜ï¼Œå› ä¸ºè¯»å–å’Œä¿å­˜çŠ¶ æ€è¿™ä¸¤ä¸ªæ“ä½œä¸æ˜¯åŸå­çš„ã€‚ï¼ˆWiki è§£é‡Šï¼šæ‰€è°“åŸå­æ“ä½œæ˜¯æŒ‡ä¸ä¼šè¢«çº¿ç¨‹è°ƒåº¦æœºåˆ¶æ‰“æ–­çš„æ“ä½œï¼›è¿™ç§æ“ä½œä¸€æ—¦å¼€å§‹ï¼Œå°±ä¸€ç›´è¿è¡Œåˆ°ç»“æŸï¼Œä¸­é—´ä¸ä¼šæœ‰ä»»ä½• context switch çº¿ç¨‹åˆ‡æ¢ã€‚ï¼‰å¦‚å›¾ï¼š</p>
<p><img src="/2022/07/12/uncatalog/cl5hsfpv60000m4r706d63234/64033.jpg" alt="img"><br>è¿™ä¸ªæ—¶å€™å°±è¦ä½¿ç”¨åˆ°åˆ†å¸ƒå¼é”æ¥é™åˆ¶ç¨‹åºçš„å¹¶å‘æ‰§è¡Œã€‚</p>
<p>åˆ†å¸ƒå¼é”æœ¬è´¨ä¸Šè¦å®ç°çš„ç›®æ ‡å°±æ˜¯åœ¨ Redis é‡Œé¢å ä¸€ä¸ªâ€œèŒ…å‘â€ï¼Œå½“åˆ«çš„è¿›ç¨‹ä¹Ÿè¦æ¥å  æ—¶ï¼Œå‘ç°å·²ç»æœ‰äººè¹²åœ¨é‚£é‡Œäº†ï¼Œå°±åªå¥½æ”¾å¼ƒæˆ–è€…ç¨åå†è¯•ã€‚å å‘ä¸€èˆ¬æ˜¯ä½¿ç”¨ setnx(set if not exists) æŒ‡ä»¤ï¼Œåªå…è®¸è¢«ä¸€ä¸ªå®¢æˆ·ç«¯å å‘ã€‚å…ˆæ¥å…ˆå ï¼Œ ç”¨ å®Œäº†ï¼Œå†è°ƒç”¨ del æŒ‡ä»¤é‡Šæ”¾èŒ…å‘ã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">setnx lock:codehole true</span><br><span class="line">OK</span><br><span class="line"> ... do something critical ...</span><br><span class="line">del lock:codehole</span><br><span class="line">(integer) 1</span><br></pre></td></tr></table></figure></div>
<p>ä½†æ˜¯æœ‰ä¸ªé—®é¢˜ï¼Œå¦‚æœé€»è¾‘æ‰§è¡Œåˆ°ä¸­é—´å‡ºç°å¼‚å¸¸äº†ï¼Œå¯èƒ½ä¼šå¯¼è‡´ del æŒ‡ä»¤æ²¡æœ‰è¢«è°ƒç”¨ï¼Œè¿™æ · å°±ä¼šé™·å…¥æ­»é”ï¼Œé”æ°¸è¿œå¾—ä¸åˆ°é‡Šæ”¾ã€‚äºæ˜¯æˆ‘ä»¬åœ¨æ‹¿åˆ°é”ä¹‹åï¼Œå†ç»™é”åŠ ä¸Šä¸€ä¸ªè¿‡æœŸæ—¶é—´ï¼Œæ¯”å¦‚ 5sï¼Œè¿™æ ·å³ä½¿ä¸­é—´å‡ºç°å¼‚å¸¸ä¹Ÿ å¯ä»¥ä¿è¯ 5 ç§’ä¹‹åé”ä¼šè‡ªåŠ¨é‡Šæ”¾ã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">setnx lock:codehole true</span><br><span class="line">OK</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> expire lock:codehole 5 ...</span></span><br><span class="line">do something critical ...</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> del lock:codehole</span></span><br><span class="line"> (integer) 1</span><br></pre></td></tr></table></figure></div>
<p>å¦‚æœåœ¨ setnx å’Œ expire ä¹‹é—´æœåŠ¡å™¨è¿›ç¨‹çªç„¶æŒ‚æ‰äº†ï¼Œå¯èƒ½æ˜¯å› ä¸ºæœºå™¨æ‰ç”µæˆ–è€…æ˜¯è¢«äººä¸ºæ€æ‰çš„ï¼Œå°±ä¼šå¯¼è‡´ expire å¾—ä¸åˆ°æ‰§è¡Œï¼Œä¹Ÿä¼šé€ æˆæ­»é”ã€‚</p>
<p>è¿™ç§é—®é¢˜çš„æ ¹æºå°±åœ¨äº setnx å’Œ expire æ˜¯ä¸¤æ¡æŒ‡ä»¤è€Œä¸æ˜¯åŸå­æŒ‡ä»¤ã€‚å¦‚æœè¿™ä¸¤æ¡æŒ‡ä»¤å¯ ä»¥ä¸€èµ·æ‰§è¡Œå°±ä¸ä¼šå‡ºç°é—®é¢˜ã€‚ä¹Ÿè®¸ä½ ä¼šæƒ³åˆ°ç”¨ Redis äº‹åŠ¡æ¥è§£å†³ã€‚ä½†æ˜¯è¿™é‡Œä¸è¡Œï¼Œå› ä¸º expire æ˜¯ä¾èµ–äº setnx çš„æ‰§è¡Œç»“æœçš„ï¼Œå¦‚æœ setnx æ²¡æŠ¢åˆ°é”ï¼Œexpire æ˜¯ä¸åº”è¯¥æ‰§è¡Œçš„ã€‚äº‹åŠ¡é‡Œæ²¡æœ‰ if else åˆ†æ”¯é€»è¾‘ï¼Œäº‹åŠ¡çš„ç‰¹ç‚¹æ˜¯ä¸€å£æ°”æ‰§è¡Œï¼Œè¦ä¹ˆå…¨éƒ¨æ‰§è¡Œè¦ä¹ˆä¸€ä¸ªéƒ½ä¸æ‰§è¡Œã€‚</p>
<p>Redis 2.8 ç‰ˆæœ¬ä¸­ä½œè€…åŠ å…¥äº† set æŒ‡ä»¤çš„æ‰©å±•å‚æ•°ï¼Œä½¿å¾— setnx å’Œ expire æŒ‡ä»¤å¯ä»¥ä¸€èµ·æ‰§è¡Œï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">set lock:codehole trueex 5 nx</span><br><span class="line">OK</span><br><span class="line">... do something critical ...</span><br><span class="line">del lock:codehole</span><br></pre></td></tr></table></figure></div>
<p>ä¸Šé¢è¿™ä¸ªæŒ‡ä»¤å°±æ˜¯ setnx å’Œ expire ç»„åˆåœ¨ä¸€èµ·çš„åŸå­æŒ‡ä»¤ï¼Œå®ƒå°±æ˜¯åˆ†å¸ƒå¼é”çš„å¥¥ä¹‰æ‰€åœ¨ã€‚</p>
<h3 id="åˆ†å¸ƒå¼é”å­˜åœ¨çš„é—®é¢˜"><a href="#åˆ†å¸ƒå¼é”å­˜åœ¨çš„é—®é¢˜" class="headerlink" title="åˆ†å¸ƒå¼é”å­˜åœ¨çš„é—®é¢˜"></a>åˆ†å¸ƒå¼é”å­˜åœ¨çš„é—®é¢˜</h3><p>è¶…æ—¶é—®é¢˜ï¼šå¦‚æœåœ¨åŠ é”å’Œé‡Šæ”¾é”ä¹‹é—´çš„é€»è¾‘æ‰§è¡Œçš„å¤ªé•¿ï¼Œä»¥è‡³äºè¶…å‡ºäº†é”çš„è¶…æ—¶é™åˆ¶ï¼Œå°±ä¼šå‡ºç°é—®é¢˜ã€‚å› ä¸ºè¿™æ—¶å€™é”è¿‡æœŸäº†ï¼Œç¬¬äºŒä¸ªçº¿ç¨‹é‡æ–°æŒæœ‰äº†è¿™æŠŠé”ï¼Œä½†æ˜¯ç´§æ¥ç€ç¬¬ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œäº†ä¸šåŠ¡é€»è¾‘ï¼Œå°±æŠŠé”ç»™é‡Šæ”¾äº†ï¼Œç¬¬ä¸‰ä¸ªçº¿ç¨‹å°±ä¼šåœ¨ç¬¬äºŒä¸ªçº¿ç¨‹é€»è¾‘æ‰§è¡Œå®Œä¹‹é—´æ‹¿åˆ°äº†é”ã€‚</p>
<p>å•èŠ‚ç‚¹çš„åˆ†å¸ƒå¼é”é—®é¢˜ï¼šåœ¨å• Matste çš„ä¸»ä» Matster-Slave Redis ç³»ç»Ÿä¸­ï¼Œæ­£å¸¸æƒ…å†µä¸‹ Client å‘ Master è·å–é”ä¹‹ååŒæ­¥ç»™ Slaveï¼Œå¦‚æœ Client è·å–é”æˆåŠŸä¹‹å Master èŠ‚ç‚¹æŒ‚æ‰ï¼Œå¹¶ä¸”æœªå°†è¯¥é”åŒæ­¥åˆ° Slaveï¼Œä¹‹ååœ¨ Sentinel çš„å¸®åŠ©ä¸‹ Slave å‡çº§ä¸º Master ä½†æ˜¯å¹¶æ²¡æœ‰ä¹‹å‰æœªåŒæ­¥çš„é”çš„ä¿¡æ¯ï¼Œæ­¤æ—¶å¦‚æœæœ‰æ–°çš„ Client è¦åœ¨æ–° Master è·å–é”ï¼Œé‚£ä¹ˆå°†å¯èƒ½å‡ºç°ä¸¤ä¸ª Client æŒæœ‰åŒä¸€æŠŠé”çš„é—®é¢˜ï¼Œæ¥çœ‹ä¸ªå›¾æ¥æƒ³ä¸‹è¿™ä¸ªè¿‡ç¨‹ï¼š</p>
<p><img src="/2022/07/12/uncatalog/cl5hsfpv60000m4r706d63234/64034.jpg" alt="img"><br>æ‰€ä»¥ï¼Œä¸ºäº†ä¿è¯è‡ªå·±çš„é”åªèƒ½è‡ªå·±é‡Šæ”¾éœ€è¦å¢åŠ å”¯ä¸€æ€§çš„æ ¡éªŒï¼Œç»¼ä¸ŠåŸºäºå• Redis èŠ‚ç‚¹çš„è·å–é”å’Œé‡Šæ”¾é”çš„ç®€å•è¿‡ç¨‹å¦‚ä¸‹:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">// è·å–é” unique_valueä½œä¸ºå”¯ä¸€æ€§çš„æ ¡éªŒ</span><br><span class="line">SET resource_name unique_value NX PX 30000</span><br><span class="line"></span><br><span class="line">// é‡Šæ”¾é” æ¯”è¾ƒunique_valueæ˜¯å¦ç›¸ç­‰ é¿å…è¯¯é‡Šæ”¾</span><br><span class="line">if redis.call(&quot;get&quot;,KEYS[1]) == ARGV[1] then</span><br><span class="line">    return redis.call(&quot;del&quot;,KEYS[1])</span><br><span class="line">else</span><br><span class="line">    return 0</span><br><span class="line">end</span><br></pre></td></tr></table></figure></div>
<h3 id="å…³äºåˆ†å¸ƒå¼é”çš„-Redlock-ç®—æ³•"><a href="#å…³äºåˆ†å¸ƒå¼é”çš„-Redlock-ç®—æ³•" class="headerlink" title="å…³äºåˆ†å¸ƒå¼é”çš„ Redlock ç®—æ³•"></a>å…³äºåˆ†å¸ƒå¼é”çš„ Redlock ç®—æ³•</h3><p>Redis æ€§èƒ½å¥½å¹¶ä¸”å®ç°æ–¹ä¾¿ï¼Œä½†æ˜¯å•èŠ‚ç‚¹çš„åˆ†å¸ƒå¼é”åœ¨æ•…éšœè¿ç§»æ—¶äº§ç”Ÿå®‰å…¨é—®é¢˜ï¼ŒRedlock ç®—æ³•æ˜¯ Redis çš„ä½œè€… Antirez æå‡ºçš„é›†ç¾¤æ¨¡å¼åˆ†å¸ƒå¼é”ï¼ŒåŸºäº N ä¸ªå®Œå…¨ç‹¬ç«‹çš„ Redis èŠ‚ç‚¹å®ç°åˆ†å¸ƒå¼é”çš„é«˜å¯ç”¨ã€‚</p>
<p>åœ¨ Redis çš„åˆ†å¸ƒå¼ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬å‡è®¾æœ‰ N ä¸ªå®Œå…¨äº’ç›¸ç‹¬ç«‹çš„ Redis èŠ‚ç‚¹ï¼Œåœ¨ N ä¸ª Redis å®ä¾‹ä¸Šä½¿ç”¨ä¸åœ¨ Redis å•å®ä¾‹ä¸‹ç›¸åŒæ–¹æ³•è·å–é”å’Œé‡Šæ”¾é”ã€‚</p>
<p>ç°åœ¨å‡è®¾æœ‰ 5 ä¸ª Redis ä¸»èŠ‚ç‚¹(å¤§äº 3 çš„å¥‡æ•°ä¸ª)ï¼Œè¿™æ ·åŸºæœ¬ä¿è¯ä»–ä»¬ä¸ä¼šåŒæ—¶éƒ½å®•æ‰ï¼Œè·å–é”å’Œé‡Šæ”¾é”çš„è¿‡ç¨‹ä¸­ï¼Œå®¢æˆ·ç«¯ä¼šæ‰§è¡Œä»¥ä¸‹æ“ä½œ:</p>
<p> 1,è·å–å½“å‰ Unix æ—¶é—´ï¼Œä»¥æ¯«ç§’ä¸ºå•ä½<br> 2,ä¾æ¬¡å°è¯•ä» 5 ä¸ªå®ä¾‹ï¼Œä½¿ç”¨ç›¸åŒçš„ key å’Œå…·æœ‰å”¯ä¸€æ€§çš„ value è·å–é” å½“å‘ Redis è¯·æ±‚è·å–é”æ—¶ï¼Œå®¢æˆ·ç«¯åº”è¯¥è®¾ç½®ä¸€ä¸ªç½‘ç»œè¿æ¥å’Œå“åº”è¶…æ—¶æ—¶é—´ï¼Œè¿™ä¸ªè¶…æ—¶æ—¶é—´åº”è¯¥å°äºé”çš„å¤±æ•ˆæ—¶é—´ï¼Œè¿™æ ·å¯ä»¥é¿å…å®¢æˆ·ç«¯æ­»ç­‰<br> 3,å®¢æˆ·ç«¯ä½¿ç”¨å½“å‰æ—¶é—´å‡å»å¼€å§‹è·å–é”æ—¶é—´å°±å¾—åˆ°è·å–é”ä½¿ç”¨çš„æ—¶é—´ã€‚å½“ä¸”ä»…å½“ä»åŠæ•°ä»¥ä¸Šçš„ Redis èŠ‚ç‚¹å–åˆ°é”ï¼Œå¹¶ä¸”ä½¿ç”¨çš„æ—¶é—´å°äºé”å¤±æ•ˆæ—¶é—´æ—¶ï¼Œé”æ‰ç®—è·å–æˆåŠŸ<br> 4,å¦‚æœå–åˆ°äº†é”ï¼Œkey çš„çœŸæ­£æœ‰æ•ˆæ—¶é—´ç­‰äºæœ‰æ•ˆæ—¶é—´å‡å»è·å–é”æ‰€ä½¿ç”¨çš„æ—¶é—´ï¼Œè¿™ä¸ªå¾ˆé‡è¦<br> 5,å¦‚æœå› ä¸ºæŸäº›åŸå› ï¼Œè·å–é”å¤±è´¥ï¼ˆæ²¡æœ‰åœ¨åŠæ•°ä»¥ä¸Šå®ä¾‹å–åˆ°é”æˆ–è€…å–é”æ—¶é—´å·²ç»è¶…è¿‡äº†æœ‰æ•ˆæ—¶é—´ï¼‰ï¼Œå®¢æˆ·ç«¯åº”è¯¥åœ¨æ‰€æœ‰çš„ Redis å®ä¾‹ä¸Šè¿›è¡Œè§£é”ï¼Œæ— è®º Redis å®ä¾‹æ˜¯å¦åŠ é”æˆåŠŸï¼Œå› ä¸ºå¯èƒ½æœåŠ¡ç«¯å“åº”æ¶ˆæ¯ä¸¢å¤±äº†ä½†æ˜¯å®é™…æˆåŠŸäº†ï¼Œæ¯•ç«Ÿå¤šé‡Šæ”¾ä¸€æ¬¡ä¹Ÿä¸ä¼šæœ‰é—®é¢˜</p>
<h2 id="å…³äºé›†ç¾¤"><a href="#å…³äºé›†ç¾¤" class="headerlink" title="å…³äºé›†ç¾¤"></a>å…³äºé›†ç¾¤</h2><p>åœ¨å¤§æ•°æ®é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œå•ä¸ª Redis å®ä¾‹å¾€å¾€ä¼šæ˜¾å¾—æ‰è¥Ÿè§è‚˜ã€‚é¦–å…ˆä½“ç°åœ¨å†…å­˜ä¸Šï¼Œå•ä¸ª Redis çš„å†…å­˜ä¸å®œè¿‡å¤§ï¼Œå†…å­˜å¤ªå¤§ä¼šå¯¼è‡´ rdb æ–‡ä»¶è¿‡å¤§ï¼Œè¿›ä¸€æ­¥å¯¼è‡´ä¸»ä»åŒæ­¥æ—¶å…¨é‡åŒæ­¥æ—¶é—´è¿‡é•¿ï¼Œåœ¨å®ä¾‹é‡å¯æ¢å¤æ—¶ä¹Ÿä¼šæ¶ˆè€—å¾ˆé•¿çš„æ•°æ®åŠ è½½æ—¶é—´ï¼Œç‰¹åˆ«æ˜¯åœ¨äº‘ç¯å¢ƒä¸‹ï¼Œå•ä¸ªå®ä¾‹å†…å­˜å¾€å¾€éƒ½æ˜¯å—é™çš„ã€‚å…¶æ¬¡ä½“ç°åœ¨ CPU çš„åˆ©ç”¨ç‡ä¸Šï¼Œå•ä¸ª Redis å®ä¾‹åªèƒ½åˆ©ç”¨å•ä¸ªæ ¸å¿ƒï¼Œè¿™å•ä¸ªæ ¸å¿ƒè¦å®Œæˆæµ·é‡æ•°æ®çš„å­˜å–å’Œç®¡ç†å·¥ä½œå‹åŠ›ä¼šéå¸¸å¤§ã€‚æ‰€ä»¥å­•è‚²è€Œç”Ÿäº† Redis é›†ç¾¤ï¼Œé›†ç¾¤æ–¹æ¡ˆä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p>
<ul>
<li><p>Sentinelï¼šSentinelï¼ˆå“¨å…µï¼‰æ¨¡å¼ï¼ŒåŸºäºä¸»ä»å¤åˆ¶æ¨¡å¼ï¼Œåªæ˜¯å¼•å…¥äº†å“¨å…µæ¥ç›‘æ§ä¸è‡ªåŠ¨å¤„ç†æ•…éšœ</p>
</li>
<li><p>Codisï¼šCodis æ˜¯ Redis é›†ç¾¤æ–¹æ¡ˆä¹‹ä¸€ï¼Œä»¤æˆ‘ä»¬æ„Ÿåˆ°éª„å‚²çš„æ˜¯ï¼Œå®ƒæ˜¯ä¸­å›½äººå¼€å‘å¹¶å¼€æºçš„ï¼Œæ¥è‡ªå‰è±Œè±†èšä¸­é—´ä»¶å›¢é˜Ÿã€‚</p>
</li>
<li><p>Clusterï¼šRedis Cluster æ˜¯ Redis çš„äº²å„¿å­ï¼Œå®ƒæ˜¯ Redis ä½œè€…è‡ªå·±æä¾›çš„ Redis é›†ç¾¤åŒ–æ–¹æ¡ˆã€‚</p>
</li>
</ul>
<p>æ„Ÿè°¢é˜…è¯»ï¼Œéƒ¨åˆ†å›¾ç‰‡æ¥æºäºäº’è”ç½‘ï¼Œæš‚æœªå¤‡æ³¨æ¥æºï½</p>
]]></content>
      <tags>
        <tag>æ¶æ„è®¾è®¡é‚£äº›äº‹å„¿</tag>
      </tags>
  </entry>
  <entry>
    <title>æ¶æ„è®¾è®¡é‚£äº›äº‹å„¿--CAPå’ŒBASEç†è®º</title>
    <url>/2022/07/14/uncatalog/cl5kwnmjs0000f8r7dj6j1eib/</url>
    <content><![CDATA[<hr>
<span id="more"></span>
<blockquote>
<p>åˆ†å¸ƒå¼ç³»ç»Ÿï¼ˆdistributed systemï¼‰æ­£å˜å¾—è¶Šæ¥è¶Šé‡è¦ï¼Œå¤§å‹ç½‘ç«™å‡ ä¹éƒ½æ˜¯åˆ†å¸ƒå¼çš„ã€‚åˆ†å¸ƒå¼ç³»ç»Ÿçš„æœ€å¤§éš¾ç‚¹ï¼Œå°±æ˜¯å„ä¸ªèŠ‚ç‚¹çš„çŠ¶æ€å¦‚ä½•åŒæ­¥ã€‚CAP å®šç†æ˜¯è¿™æ–¹é¢çš„åŸºæœ¬å®šç†ï¼Œä¹Ÿæ˜¯ç†è§£åˆ†å¸ƒå¼ç³»ç»Ÿçš„èµ·ç‚¹ã€‚</p>
</blockquote>
<p>æœ¬æ–‡ä»‹ç»è¯¥å®šç†ã€‚å®ƒå…¶å®å¾ˆå¥½æ‡‚ï¼Œè€Œä¸”æ˜¯æ˜¾è€Œæ˜“è§çš„ã€‚ä¸‹é¢çš„å†…å®¹ä¸»è¦å‚è€ƒäº† Michael Whittaker çš„<a href="https://mwhittaker.github.io/blog/an_illustrated_proof_of_the_cap_theorem/">æ–‡ç« </a>ã€‚</p>
<h2 id="ä¸€ã€åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸‰ä¸ªæŒ‡æ ‡"><a href="#ä¸€ã€åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸‰ä¸ªæŒ‡æ ‡" class="headerlink" title="ä¸€ã€åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸‰ä¸ªæŒ‡æ ‡"></a>ä¸€ã€åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸‰ä¸ªæŒ‡æ ‡</h2><p><img src="/2022/07/14/uncatalog/cl5kwnmjs0000f8r7dj6j1eib/bg2018071607.jpg" alt="img"><br>1998å¹´ï¼ŒåŠ å·å¤§å­¦çš„è®¡ç®—æœºç§‘å­¦å®¶ Eric Brewer æå‡ºï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿæœ‰ä¸‰ä¸ªæŒ‡æ ‡ã€‚</p>
<ul>
<li>Consistency</li>
<li>Availability</li>
<li>Partition tolerance<br>å®ƒä»¬çš„ç¬¬ä¸€ä¸ªå­—æ¯åˆ†åˆ«æ˜¯ Cã€Aã€Pã€‚</li>
</ul>
<p>Eric Brewer è¯´ï¼Œè¿™ä¸‰ä¸ªæŒ‡æ ‡ä¸å¯èƒ½åŒæ—¶åšåˆ°ã€‚è¿™ä¸ªç»“è®ºå°±å«åš CAP å®šç†</p>
<h2 id="äºŒã€Partition-tolerance"><a href="#äºŒã€Partition-tolerance" class="headerlink" title="äºŒã€Partition tolerance"></a>äºŒã€Partition tolerance</h2><p>å…ˆçœ‹ Partition toleranceï¼Œä¸­æ–‡å«åšâ€åˆ†åŒºå®¹é”™â€ã€‚</p>
<p>å¤§å¤šæ•°åˆ†å¸ƒå¼ç³»ç»Ÿéƒ½åˆ†å¸ƒåœ¨å¤šä¸ªå­ç½‘ç»œã€‚æ¯ä¸ªå­ç½‘ç»œå°±å«åšä¸€ä¸ªåŒºï¼ˆpartitionï¼‰ã€‚åˆ†åŒºå®¹é”™çš„æ„æ€æ˜¯ï¼ŒåŒºé—´é€šä¿¡å¯èƒ½å¤±è´¥ã€‚æ¯”å¦‚ï¼Œä¸€å°æœåŠ¡å™¨æ”¾åœ¨ä¸­å›½ï¼Œå¦ä¸€å°æœåŠ¡å™¨æ”¾åœ¨ç¾å›½ï¼Œè¿™å°±æ˜¯ä¸¤ä¸ªåŒºï¼Œå®ƒä»¬ä¹‹é—´å¯èƒ½æ— æ³•é€šä¿¡ã€‚<br><img src="/2022/07/14/uncatalog/cl5kwnmjs0000f8r7dj6j1eib/bg2018071601.png" alt="img"><br>ä¸Šå›¾ä¸­ï¼ŒG1 å’Œ G2 æ˜¯ä¸¤å°è·¨åŒºçš„æœåŠ¡å™¨ã€‚G1 å‘ G2 å‘é€ä¸€æ¡æ¶ˆæ¯ï¼ŒG2 å¯èƒ½æ— æ³•æ”¶åˆ°ã€‚ç³»ç»Ÿè®¾è®¡çš„æ—¶å€™ï¼Œå¿…é¡»è€ƒè™‘åˆ°è¿™ç§æƒ…å†µã€‚</p>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œåˆ†åŒºå®¹é”™æ— æ³•é¿å…ï¼Œå› æ­¤å¯ä»¥è®¤ä¸º CAP çš„ P æ€»æ˜¯æˆç«‹ã€‚CAP å®šç†å‘Šè¯‰æˆ‘ä»¬ï¼Œå‰©ä¸‹çš„ C å’Œ A æ— æ³•åŒæ—¶åšåˆ°ã€‚</p>
<h2 id="ä¸‰ã€Consistency"><a href="#ä¸‰ã€Consistency" class="headerlink" title="ä¸‰ã€Consistency"></a>ä¸‰ã€Consistency</h2><p>Consistency ä¸­æ–‡å«åšâ€ä¸€è‡´æ€§â€ã€‚æ„æ€æ˜¯ï¼Œå†™æ“ä½œä¹‹åçš„è¯»æ“ä½œï¼Œå¿…é¡»è¿”å›è¯¥å€¼ã€‚ä¸¾ä¾‹æ¥è¯´ï¼ŒæŸæ¡è®°å½•æ˜¯ v0ï¼Œç”¨æˆ·å‘ G1 å‘èµ·ä¸€ä¸ªå†™æ“ä½œï¼Œå°†å…¶æ”¹ä¸º v1ã€‚<br><img src="/2022/07/14/uncatalog/cl5kwnmjs0000f8r7dj6j1eib/bg2018071602.png" alt="img"><br>æ¥ä¸‹æ¥ï¼Œç”¨æˆ·çš„è¯»æ“ä½œå°±ä¼šå¾—åˆ° v1ã€‚è¿™å°±å«ä¸€è‡´æ€§ã€‚<br><img src="/2022/07/14/uncatalog/cl5kwnmjs0000f8r7dj6j1eib/bg2018071603.png" alt="img"><br>é—®é¢˜æ˜¯ï¼Œç”¨æˆ·æœ‰å¯èƒ½å‘ G2 å‘èµ·è¯»æ“ä½œï¼Œç”±äº G2 çš„å€¼æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œå› æ­¤è¿”å›çš„æ˜¯ v0ã€‚G1 å’Œ G2 è¯»æ“ä½œçš„ç»“æœä¸ä¸€è‡´ï¼Œè¿™å°±ä¸æ»¡è¶³ä¸€è‡´æ€§äº†ã€‚<br><img src="/2022/07/14/uncatalog/cl5kwnmjs0000f8r7dj6j1eib/bg2018071604.png" alt="img"><br>ä¸ºäº†è®© G2 ä¹Ÿèƒ½å˜ä¸º v1ï¼Œå°±è¦åœ¨ G1 å†™æ“ä½œçš„æ—¶å€™ï¼Œè®© G1 å‘ G2 å‘é€ä¸€æ¡æ¶ˆæ¯ï¼Œè¦æ±‚ G2 ä¹Ÿæ”¹æˆ v1ã€‚<br><img src="/2022/07/14/uncatalog/cl5kwnmjs0000f8r7dj6j1eib/bg2018071605.png" alt="img"><br>è¿™æ ·çš„è¯ï¼Œç”¨æˆ·å‘ G2 å‘èµ·è¯»æ“ä½œï¼Œä¹Ÿèƒ½å¾—åˆ° v1ã€‚<br><img src="/2022/07/14/uncatalog/cl5kwnmjs0000f8r7dj6j1eib/bg2018071606.png" alt="img"></p>
<h2 id="å››ã€Availability"><a href="#å››ã€Availability" class="headerlink" title="å››ã€Availability"></a>å››ã€Availability</h2><p>Availability ä¸­æ–‡å«åšâ€å¯ç”¨æ€§â€ï¼Œæ„æ€æ˜¯åªè¦æ”¶åˆ°ç”¨æˆ·çš„è¯·æ±‚ï¼ŒæœåŠ¡å™¨å°±å¿…é¡»ç»™å‡ºå›åº”ã€‚</p>
<p>ç”¨æˆ·å¯ä»¥é€‰æ‹©å‘ G1 æˆ– G2 å‘èµ·è¯»æ“ä½œã€‚ä¸ç®¡æ˜¯å“ªå°æœåŠ¡å™¨ï¼Œåªè¦æ”¶åˆ°è¯·æ±‚ï¼Œå°±å¿…é¡»å‘Šè¯‰ç”¨æˆ·ï¼Œåˆ°åº•æ˜¯ v0 è¿˜æ˜¯ v1ï¼Œå¦åˆ™å°±ä¸æ»¡è¶³å¯ç”¨æ€§ã€‚</p>
<h2 id="äº”ã€Consistency-å’Œ-Availability-çš„çŸ›ç›¾"><a href="#äº”ã€Consistency-å’Œ-Availability-çš„çŸ›ç›¾" class="headerlink" title="äº”ã€Consistency å’Œ Availability çš„çŸ›ç›¾"></a>äº”ã€Consistency å’Œ Availability çš„çŸ›ç›¾</h2><p>ä¸€è‡´æ€§å’Œå¯ç”¨æ€§ï¼Œä¸ºä»€ä¹ˆä¸å¯èƒ½åŒæ—¶æˆç«‹ï¼Ÿç­”æ¡ˆå¾ˆç®€å•ï¼Œå› ä¸ºå¯èƒ½é€šä¿¡å¤±è´¥ï¼ˆå³å‡ºç°åˆ†åŒºå®¹é”™ï¼‰ã€‚</p>
<p>å¦‚æœä¿è¯ G2 çš„ä¸€è‡´æ€§ï¼Œé‚£ä¹ˆ G1 å¿…é¡»åœ¨å†™æ“ä½œæ—¶ï¼Œé”å®š G2 çš„è¯»æ“ä½œå’Œå†™æ“ä½œã€‚åªæœ‰æ•°æ®åŒæ­¥åï¼Œæ‰èƒ½é‡æ–°å¼€æ”¾è¯»å†™ã€‚é”å®šæœŸé—´ï¼ŒG2 ä¸èƒ½è¯»å†™ï¼Œæ²¡æœ‰å¯ç”¨æ€§ä¸ã€‚</p>
<p>å¦‚æœä¿è¯ G2 çš„å¯ç”¨æ€§ï¼Œé‚£ä¹ˆåŠ¿å¿…ä¸èƒ½é”å®š G2ï¼Œæ‰€ä»¥ä¸€è‡´æ€§ä¸æˆç«‹ã€‚</p>
<p>ç»¼ä¸Šæ‰€è¿°ï¼ŒG2 æ— æ³•åŒæ—¶åšåˆ°ä¸€è‡´æ€§å’Œå¯ç”¨æ€§ã€‚ç³»ç»Ÿè®¾è®¡æ—¶åªèƒ½é€‰æ‹©ä¸€ä¸ªç›®æ ‡ã€‚å¦‚æœè¿½æ±‚ä¸€è‡´æ€§ï¼Œé‚£ä¹ˆæ— æ³•ä¿è¯æ‰€æœ‰èŠ‚ç‚¹çš„å¯ç”¨æ€§ï¼›å¦‚æœè¿½æ±‚æ‰€æœ‰èŠ‚ç‚¹çš„å¯ç”¨æ€§ï¼Œé‚£å°±æ²¡æ³•åšåˆ°ä¸€è‡´æ€§ã€‚</p>
<h2 id="CAPæƒè¡¡"><a href="#CAPæƒè¡¡" class="headerlink" title="CAPæƒè¡¡"></a>CAPæƒè¡¡</h2><p>é€šè¿‡CAPç†è®ºåŠå‰é¢çš„è¯æ˜ï¼Œæˆ‘ä»¬çŸ¥é“æ— æ³•åŒæ—¶æ»¡è¶³ä¸€è‡´æ€§ã€å¯ç”¨æ€§å’Œåˆ†åŒºå®¹é”™æ€§è¿™ä¸‰ä¸ªç‰¹æ€§ï¼Œé‚£è¦èˆå¼ƒå“ªä¸ªå‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬åˆ†ä¸‰ç§æƒ…å†µæ¥é˜è¿°ä¸€ä¸‹ã€‚</p>
<h3 id="CA-without-P"><a href="#CA-without-P" class="headerlink" title="CA without P"></a>CA without P</h3><p>è¿™ç§æƒ…å†µåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å‡ ä¹æ˜¯ä¸å­˜åœ¨çš„ã€‚é¦–å…ˆåœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ï¼Œç½‘ç»œåˆ†åŒºæ˜¯ä¸€ä¸ªè‡ªç„¶çš„äº‹å®ã€‚å› ä¸ºåˆ†åŒºæ˜¯å¿…ç„¶çš„ï¼Œæ‰€ä»¥å¦‚æœèˆå¼ƒPï¼Œæ„å‘³ç€è¦èˆå¼ƒåˆ†å¸ƒå¼ç³»ç»Ÿã€‚é‚£ä¹Ÿå°±æ²¡æœ‰å¿…è¦å†è®¨è®ºCAPç†è®ºäº†ã€‚è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆåœ¨å‰é¢çš„CAPè¯æ˜ä¸­ï¼Œæˆ‘ä»¬ä»¥ç³»ç»Ÿæ»¡è¶³Pä¸ºå‰æè®ºè¿°äº†æ— æ³•åŒæ—¶æ»¡è¶³Cå’ŒAã€‚</p>
<p>æ¯”å¦‚æˆ‘ä»¬ç†ŸçŸ¥çš„å…³ç³»å‹æ•°æ®åº“ï¼Œå¦‚My Sqlå’ŒOracleå°±æ˜¯ä¿è¯äº†å¯ç”¨æ€§å’Œæ•°æ®ä¸€è‡´æ€§ï¼Œä½†æ˜¯ä»–å¹¶ä¸æ˜¯ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿã€‚ä¸€æ—¦å…³ç³»å‹æ•°æ®åº“è¦è€ƒè™‘ä¸»å¤‡åŒæ­¥ã€é›†ç¾¤éƒ¨ç½²ç­‰å°±å¿…é¡»è¦æŠŠPä¹Ÿè€ƒè™‘è¿›æ¥ã€‚</p>
<p>å…¶å®ï¼Œåœ¨CAPç†è®ºä¸­ã€‚Cï¼ŒAï¼ŒPä¸‰è€…å¹¶ä¸æ˜¯å¹³ç­‰çš„ï¼ŒCAPä¹‹çˆ¶åœ¨ã€ŠSpannerï¼ŒçœŸæ—¶ï¼ŒCAPç†è®ºã€‹ä¸€æ–‡ä¸­å†™åˆ°ï¼š</p>
<p>å¦‚æœè¯´SpannerçœŸæœ‰ä»€ä¹ˆç‰¹åˆ«ä¹‹å¤„ï¼Œé‚£å°±æ˜¯è°·æ­Œçš„å¹¿åŸŸç½‘ã€‚Googleé€šè¿‡å»ºç«‹ç§æœ‰ç½‘ç»œä»¥åŠå¼ºå¤§çš„ç½‘ç»œå·¥ç¨‹èƒ½åŠ›æ¥ä¿è¯Pï¼Œåœ¨å¤šå¹´è¿è¥æ”¹è¿›çš„åŸºç¡€ä¸Šï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­å¯ä»¥æœ€å¤§ç¨‹åº¦çš„å‡å°‘åˆ†åŒºå‘ç”Ÿï¼Œä»è€Œå®ç°é«˜å¯ç”¨æ€§ã€‚</p>
<p>ä»Googleçš„ç»éªŒä¸­å¯ä»¥å¾—åˆ°çš„ç»“è®ºæ˜¯ï¼Œæ— æ³•é€šè¿‡é™ä½CAæ¥æå‡Pã€‚è¦æƒ³æå‡ç³»ç»Ÿçš„åˆ†åŒºå®¹é”™æ€§ï¼Œéœ€è¦é€šè¿‡æå‡åŸºç¡€è®¾æ–½çš„ç¨³å®šæ€§æ¥ä¿éšœã€‚</p>
<p>æ‰€ä»¥ï¼Œå¯¹äºä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿæ¥è¯´ã€‚Pæ˜¯ä¸€ä¸ªåŸºæœ¬è¦æ±‚ï¼ŒCAPä¸‰è€…ä¸­ï¼Œåªèƒ½åœ¨CAä¸¤è€…ä¹‹é—´åšæƒè¡¡ï¼Œå¹¶ä¸”è¦æƒ³å°½åŠæ³•æå‡Pã€‚</p>
<h3 id="CP-without-A"><a href="#CP-without-A" class="headerlink" title="CP without A"></a>CP without A</h3><p>å¦‚æœä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¸è¦æ±‚å¼ºçš„å¯ç”¨æ€§ï¼Œå³å®¹è®¸ç³»ç»Ÿåœæœºæˆ–è€…é•¿æ—¶é—´æ— å“åº”çš„è¯ï¼Œå°±å¯ä»¥åœ¨CAPä¸‰è€…ä¸­ä¿éšœCPè€Œèˆå¼ƒAã€‚</p>
<p>ä¸€ä¸ªä¿è¯äº†CPè€Œä¸€ä¸ªèˆå¼ƒäº†Açš„åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œä¸€æ—¦å‘ç”Ÿç½‘ç»œæ•…éšœæˆ–è€…æ¶ˆæ¯ä¸¢å¤±ç­‰æƒ…å†µï¼Œå°±è¦ç‰ºç‰²ç”¨æˆ·çš„ä½“éªŒï¼Œç­‰å¾…æ‰€æœ‰æ•°æ®å…¨éƒ¨ä¸€è‡´äº†ä¹‹åå†è®©ç”¨æˆ·è®¿é—®ç³»ç»Ÿã€‚</p>
<p>è®¾è®¡æˆCPçš„ç³»ç»Ÿå…¶å®ä¹Ÿä¸å°‘ï¼Œå…¶ä¸­æœ€å…¸å‹çš„å°±æ˜¯å¾ˆå¤šåˆ†å¸ƒå¼æ•°æ®åº“ï¼Œä»–ä»¬éƒ½æ˜¯è®¾è®¡æˆCPçš„ã€‚åœ¨å‘ç”Ÿæç«¯æƒ…å†µæ—¶ï¼Œä¼˜å…ˆä¿è¯æ•°æ®çš„å¼ºä¸€è‡´æ€§ï¼Œä»£ä»·å°±æ˜¯èˆå¼ƒç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚å¦‚Redisã€HBaseç­‰ï¼Œè¿˜æœ‰åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å¸¸ç”¨çš„Zookeeperä¹Ÿæ˜¯åœ¨CAPä¸‰è€…ä¹‹ä¸­é€‰æ‹©ä¼˜å…ˆä¿è¯CPçš„ã€‚</p>
<p>æ— è®ºæ˜¯åƒRedisã€HBaseè¿™ç§åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿï¼Œè¿˜æ˜¯åƒZookeeperè¿™ç§åˆ†å¸ƒå¼åè°ƒç»„ä»¶ã€‚æ•°æ®çš„ä¸€è‡´æ€§æ˜¯ä»–ä»¬æœ€æœ€åŸºæœ¬çš„è¦æ±‚ã€‚ä¸€ä¸ªè¿æ•°æ®ä¸€è‡´æ€§éƒ½ä¿è¯ä¸äº†çš„åˆ†å¸ƒå¼å­˜å‚¨è¦ä»–æœ‰ä½•ç”¨ï¼Ÿ</p>
<p>åœ¨æˆ‘çš„Zookeeperä»‹ç»ï¼ˆäºŒï¼‰â€”â€”Zookeeperæ¦‚è¿°ä¸€æ–‡ä¸­å…¶å®ä»‹ç»è¿‡zkå…³äºCAPçš„æ€è€ƒï¼Œè¿™é‡Œå†ç®€å•å›é¡¾ä¸€ä¸‹ï¼š</p>
<p>ZooKeeperæ˜¯ä¸ªCPï¼ˆä¸€è‡´æ€§+åˆ†åŒºå®¹é”™æ€§ï¼‰çš„ï¼Œå³ä»»ä½•æ—¶åˆ»å¯¹ZooKeeperçš„è®¿é—®è¯·æ±‚èƒ½å¾—åˆ°ä¸€è‡´çš„æ•°æ®ç»“æœï¼ŒåŒæ—¶ç³»ç»Ÿå¯¹ç½‘ç»œåˆ†å‰²å…·å¤‡å®¹é”™æ€§ã€‚ä½†æ˜¯å®ƒä¸èƒ½ä¿è¯æ¯æ¬¡æœåŠ¡è¯·æ±‚çš„å¯ç”¨æ€§ï¼Œä¹Ÿå°±æ˜¯åœ¨æç«¯ç¯å¢ƒä¸‹ï¼ŒZooKeeperå¯èƒ½ä¼šä¸¢å¼ƒä¸€äº›è¯·æ±‚ï¼Œæ¶ˆè´¹è€…ç¨‹åºéœ€è¦é‡æ–°è¯·æ±‚æ‰èƒ½è·å¾—ç»“æœã€‚ZooKeeperæ˜¯åˆ†å¸ƒå¼åè°ƒæœåŠ¡ï¼Œå®ƒçš„èŒè´£æ˜¯ä¿è¯æ•°æ®åœ¨å…¶ç®¡è¾–ä¸‹çš„æ‰€æœ‰æœåŠ¡ä¹‹é—´ä¿æŒåŒæ­¥ã€ä¸€è‡´ã€‚æ‰€ä»¥å°±ä¸éš¾ç†è§£ä¸ºä»€ä¹ˆZooKeeperè¢«è®¾è®¡æˆCPè€Œä¸æ˜¯APç‰¹æ€§çš„äº†ã€‚</p>
<h3 id="AP-wihtout-C"><a href="#AP-wihtout-C" class="headerlink" title="AP wihtout C"></a>AP wihtout C</h3><p>è¦é«˜å¯ç”¨å¹¶å…è®¸åˆ†åŒºï¼Œåˆ™éœ€æ”¾å¼ƒä¸€è‡´æ€§ã€‚ä¸€æ—¦ç½‘ç»œé—®é¢˜å‘ç”Ÿï¼ŒèŠ‚ç‚¹ä¹‹é—´å¯èƒ½ä¼šå¤±å»è”ç³»ã€‚ä¸ºäº†ä¿è¯é«˜å¯ç”¨ï¼Œéœ€è¦åœ¨ç”¨æˆ·è®¿é—®æ—¶å¯ä»¥é©¬ä¸Šå¾—åˆ°è¿”å›ï¼Œåˆ™æ¯ä¸ªèŠ‚ç‚¹åªèƒ½ç”¨æœ¬åœ°æ•°æ®æä¾›æœåŠ¡ï¼Œè€Œè¿™æ ·ä¼šå¯¼è‡´å…¨å±€æ•°æ®çš„ä¸ä¸€è‡´æ€§ã€‚</p>
<p>è¿™ç§èˆå¼ƒå¼ºä¸€è‡´æ€§è€Œä¿è¯ç³»ç»Ÿçš„åˆ†åŒºå®¹é”™æ€§å’Œå¯ç”¨æ€§çš„åœºæ™¯å’Œæ¡ˆä¾‹éå¸¸å¤šã€‚å‰é¢æˆ‘ä»¬ä»‹ç»å¯ç”¨æ€§çš„æ—¶å€™è¯´åˆ°è¿‡ï¼Œå¾ˆå¤šç³»ç»Ÿåœ¨å¯ç”¨æ€§æ–¹é¢ä¼šåšå¾ˆå¤šäº‹æƒ…æ¥ä¿è¯ç³»ç»Ÿçš„å…¨å¹´å¯ç”¨æ€§å¯ä»¥è¾¾åˆ°Nä¸ª9ï¼Œæ‰€ä»¥ï¼Œå¯¹äºå¾ˆå¤šä¸šåŠ¡ç³»ç»Ÿæ¥è¯´ï¼Œæ¯”å¦‚æ·˜å®çš„è´­ç‰©ï¼Œ12306çš„ä¹°ç¥¨ã€‚éƒ½æ˜¯åœ¨å¯ç”¨æ€§å’Œä¸€è‡´æ€§ä¹‹é—´èˆå¼ƒäº†ä¸€è‡´æ€§è€Œé€‰æ‹©å¯ç”¨æ€§ã€‚</p>
<p>ä½ åœ¨12306ä¹°ç¥¨çš„æ—¶å€™è‚¯å®šé‡åˆ°è¿‡è¿™ç§åœºæ™¯ï¼Œå½“ä½ è´­ä¹°çš„æ—¶å€™æç¤ºä½ æ˜¯æœ‰ç¥¨çš„ï¼ˆä½†æ˜¯å¯èƒ½å®é™…å·²ç»æ²¡ç¥¨äº†ï¼‰ï¼Œä½ ä¹Ÿæ­£å¸¸çš„å»è¾“å…¥éªŒè¯ç ï¼Œä¸‹å•äº†ã€‚ä½†æ˜¯è¿‡äº†ä¸€ä¼šç³»ç»Ÿæç¤ºä½ ä¸‹å•å¤±è´¥ï¼Œä½™ç¥¨ä¸è¶³ã€‚è¿™å…¶å®å°±æ˜¯å…ˆåœ¨å¯ç”¨æ€§æ–¹é¢ä¿è¯ç³»ç»Ÿå¯ä»¥æ­£å¸¸çš„æœåŠ¡ï¼Œç„¶ååœ¨æ•°æ®çš„ä¸€è‡´æ€§æ–¹é¢åšäº†äº›ç‰ºç‰²ï¼Œä¼šå½±å“ä¸€äº›ç”¨æˆ·ä½“éªŒï¼Œä½†æ˜¯ä¹Ÿä¸è‡³äºé€ æˆç”¨æˆ·æµç¨‹çš„ä¸¥é‡é˜»å¡ã€‚</p>
<p>ä½†æ˜¯ï¼Œæˆ‘ä»¬è¯´å¾ˆå¤šç½‘ç«™ç‰ºç‰²äº†ä¸€è‡´æ€§ï¼Œé€‰æ‹©äº†å¯ç”¨æ€§ï¼Œè¿™å…¶å®ä¹Ÿä¸å‡†ç¡®çš„ã€‚å°±æ¯”å¦‚ä¸Šé¢çš„ä¹°ç¥¨çš„ä¾‹å­ï¼Œå…¶å®èˆå¼ƒçš„åªæ˜¯å¼ºä¸€è‡´æ€§ã€‚é€€è€Œæ±‚å…¶æ¬¡ä¿è¯äº†æœ€ç»ˆä¸€è‡´æ€§ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè™½ç„¶ä¸‹å•çš„ç¬é—´ï¼Œå…³äºè½¦ç¥¨çš„åº“å­˜å¯èƒ½å­˜åœ¨æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µï¼Œä½†æ˜¯è¿‡äº†ä¸€æ®µæ—¶é—´ï¼Œè¿˜æ˜¯è¦ä¿è¯æœ€ç»ˆä¸€è‡´æ€§çš„ã€‚</p>
<p>å¯¹äºå¤šæ•°å¤§å‹äº’è”ç½‘åº”ç”¨çš„åœºæ™¯ï¼Œä¸»æœºä¼—å¤šã€éƒ¨ç½²åˆ†æ•£ï¼Œè€Œä¸”ç°åœ¨çš„é›†ç¾¤è§„æ¨¡è¶Šæ¥è¶Šå¤§ï¼Œæ‰€ä»¥èŠ‚ç‚¹æ•…éšœã€ç½‘ç»œæ•…éšœæ˜¯å¸¸æ€ï¼Œè€Œä¸”è¦ä¿è¯æœåŠ¡å¯ç”¨æ€§è¾¾åˆ°Nä¸ª9ï¼Œå³ä¿è¯På’ŒAï¼Œèˆå¼ƒCï¼ˆé€€è€Œæ±‚å…¶æ¬¡ä¿è¯æœ€ç»ˆä¸€è‡´æ€§ï¼‰ã€‚è™½ç„¶æŸäº›åœ°æ–¹ä¼šå½±å“å®¢æˆ·ä½“éªŒï¼Œä½†æ²¡è¾¾åˆ°é€ æˆç”¨æˆ·æµç¨‹çš„ä¸¥é‡ç¨‹åº¦ã€‚</p>
<h3 id="é€‚åˆçš„æ‰æ˜¯æœ€å¥½çš„"><a href="#é€‚åˆçš„æ‰æ˜¯æœ€å¥½çš„" class="headerlink" title="é€‚åˆçš„æ‰æ˜¯æœ€å¥½çš„"></a>é€‚åˆçš„æ‰æ˜¯æœ€å¥½çš„</h3><p>ä¸Šé¢ä»‹ç»äº†å¦‚ä½•CAPä¸­æƒè¡¡åŠå–èˆä»¥åŠå…¸å‹çš„æ¡ˆä¾‹ã€‚å­°ä¼˜å­°ç•¥ï¼Œæ²¡æœ‰å®šè®ºï¼Œåªèƒ½æ ¹æ®åœºæ™¯å®šå¤ºï¼Œé€‚åˆçš„æ‰æ˜¯æœ€å¥½çš„ã€‚</p>
<p>å¯¹äºæ¶‰åŠåˆ°é’±è´¢è¿™æ ·ä¸èƒ½æœ‰ä¸€ä¸è®©æ­¥çš„åœºæ™¯ï¼ŒCå¿…é¡»ä¿è¯ã€‚ç½‘ç»œå‘ç”Ÿæ•…éšœå®å¯åœæ­¢æœåŠ¡ï¼Œè¿™æ˜¯ä¿è¯CPï¼Œèˆå¼ƒAã€‚æ¯”å¦‚å‰å‡ å¹´æ”¯ä»˜å®å…‰ç¼†è¢«æŒ–æ–­çš„äº‹ä»¶ï¼Œåœ¨ç½‘ç»œå‡ºç°æ•…éšœçš„æ—¶å€™ï¼Œæ”¯ä»˜å®å°±åœ¨å¯ç”¨æ€§å’Œæ•°æ®ä¸€è‡´æ€§ä¹‹é—´é€‰æ‹©äº†æ•°æ®ä¸€è‡´æ€§ï¼Œç”¨æˆ·æ„Ÿå—åˆ°çš„æ˜¯æ”¯ä»˜å®ç³»ç»Ÿé•¿æ—¶é—´å®•æœºï¼Œä½†æ˜¯å…¶å®èƒŒåæ˜¯æ— æ•°çš„å·¥ç¨‹å¸ˆåœ¨æ¢å¤æ•°æ®ï¼Œä¿è¯æ•°æ•°æ®çš„ä¸€è‡´æ€§ã€‚</p>
<p>å¯¹äºå…¶ä»–åœºæ™¯ï¼Œæ¯”è¾ƒæ™®éçš„åšæ³•æ˜¯é€‰æ‹©å¯ç”¨æ€§å’Œåˆ†åŒºå®¹é”™æ€§ï¼Œèˆå¼ƒå¼ºä¸€è‡´æ€§ï¼Œé€€è€Œæ±‚å…¶æ¬¡ä½¿ç”¨æœ€ç»ˆä¸€è‡´æ€§æ¥ä¿è¯æ•°æ®çš„å®‰å…¨ã€‚è¿™å…¶å®æ˜¯åˆ†å¸ƒå¼é¢†åŸŸçš„å¦å¤–ä¸€ä¸ªç†è®ºâ€”â€”BASEç†è®ºã€‚</p>
<h2 id="Baseç†è®º"><a href="#Baseç†è®º" class="headerlink" title="Baseç†è®º"></a>Baseç†è®º</h2><p>Baseç†è®ºæ˜¯Basically Availableï¼ˆåŸºæœ¬å¯ç”¨ï¼‰ã€Soft stateï¼ˆè½¯çŠ¶æ€ï¼‰ã€Eventually consistentï¼ˆæœ€ç»ˆä¸€è‡´æ€§ï¼‰çš„ç¼©å†™ï¼›å®ƒåŸºäºCAPå®šç†é€æ­¥æ¼”åŒ–æ¥çš„ï¼Œå®ƒæ˜¯CAPä¸­ä¸€è‡´æ€§å’Œå¯ç”¨æ€§æƒè¡¡çš„ç»“æœï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯å³ä½¿ç³»ç»Ÿæ— æ³•è¾¾åˆ°å¼ºä¸€è‡´æ€§ï¼Œå¯ä»¥æ ¹æ®åº”ç”¨è‡ªèº«çš„ä¸šåŠ¡ç‰¹ç‚¹ï¼Œé‡‡ç”¨é€‚å½“çš„æ–¹å¼æ¥ä½¿ç³»ç»Ÿè¾¾åˆ°æœ€ç»ˆä¸€è‡´æ€§ã€‚</p>
<h3 id="åŸºæœ¬å¯ç”¨ï¼ˆBasically-Availableï¼‰"><a href="#åŸºæœ¬å¯ç”¨ï¼ˆBasically-Availableï¼‰" class="headerlink" title="åŸºæœ¬å¯ç”¨ï¼ˆBasically Availableï¼‰"></a>åŸºæœ¬å¯ç”¨ï¼ˆBasically Availableï¼‰</h3><p>åŸºæœ¬å¯ç”¨æ˜¯æŒ‡å½“åˆ†å¸ƒå¼ç³»ç»Ÿå‘ç”Ÿæ•…éšœçš„æ—¶å€™ï¼Œå…è®¸æŸå¤±éƒ¨åˆ†å¯ç”¨æ€§ã€‚å¸¸è§çš„æœ‰ä»¥ä¸‹å‡ ç§æƒ…å†µï¼š</p>
<ul>
<li>å“åº”æ—¶é—´ä¸Šçš„æŸå¤±ï¼šæ­£å¸¸æƒ…å†µä¸‹ï¼Œä¸€ä¸ªåœ¨çº¿æœç´¢å¼•æ“éœ€è¦å†0.5ç§’ä¹‹å†…è¿”å›ç»™ç”¨æˆ·å“åº”çš„æŸ¥è¯¢ç»“æœï¼Œä½†ç”±äºå‡ºç°æ•…éšœï¼ŒæŸ¥è¯¢ç»“æœçš„å“åº”æ—¶é—´å¢åŠ åˆ°äº†1~2ç§’ã€‚</li>
<li>åŠŸèƒ½ä¸Šçš„æŸå¤±ï¼šé€šå¸¸çš„åšæ³•æ˜¯é™çº§æœåŠ¡ï¼Œå¦‚å¯¹äºå±•ç¤ºä¸€äº›æœ‰åºå…ƒç´ çš„é¡µé¢ï¼Œä½†éƒ¨åˆ†ç»„ä»¶å‡ºç°æ•…éšœæ—¶ï¼Œè¿™ä¸ªæ—¶å€™å¯ä¸å±•ç¤ºæœ‰åºå…ƒç´ ï¼Œé™çº§ä¸ºæ— åºå…ƒç´ åˆ—è¡¨ã€‚</li>
</ul>
<h3 id="è½¯çŠ¶æ€"><a href="#è½¯çŠ¶æ€" class="headerlink" title="è½¯çŠ¶æ€"></a>è½¯çŠ¶æ€</h3><p>è½¯çŠ¶æ€æ˜¯æŒ‡å…è®¸ç³»ç»Ÿä¸­çš„æ•°æ®å­˜åœ¨ä¸­é—´çŠ¶æ€ï¼Œå¹¶è®¤ä¸ºè¯¥ä¸­é—´çŠ¶æ€çš„å­˜åœ¨ä¸å½±å“ç³»ç»Ÿçš„æ•´ä½“å¯ç”¨æ€§ï¼Œå³å…è®¸ç³»ç»Ÿä¸åŒèŠ‚ç‚¹çš„æ•°æ®å‰¯æœ¬ä¹‹é—´è¿›è¡Œæ•°æ®åŒæ­¥çš„è¿‡ç¨‹ä¸­å­˜åœ¨å»¶æ—¶ã€‚</p>
<h3 id="æœ€ç»ˆä¸€è‡´æ€§"><a href="#æœ€ç»ˆä¸€è‡´æ€§" class="headerlink" title="æœ€ç»ˆä¸€è‡´æ€§"></a>æœ€ç»ˆä¸€è‡´æ€§</h3><p>æœ€ç»ˆä¸€è‡´æ€§å¼ºè°ƒçš„æ˜¯ç³»ç»Ÿæ‰€æœ‰çš„æ•°æ®å‰¯æœ¬ï¼Œåœ¨ç»è¿‡ä¸€æ®µæ—¶é—´çš„åŒæ­¥åï¼Œæœ€ç»ˆèƒ½å¤Ÿè¾¾åˆ°ä¸€ä¸ªä¸€è‡´çš„çŠ¶æ€ã€‚å› æ­¤ï¼Œæœ€ç»ˆä¸€è‡´æ€§çš„æœ¬è´¨æ˜¯éœ€è¦ç³»ç»Ÿä¿è¯æœ€ç»ˆæ•°æ®èƒ½å¤Ÿè¾¾åˆ°ä¸€è‡´ï¼Œè€Œä¸éœ€è¦å®æ—¶ä¿è¯ç³»ç»Ÿæ•°æ®çš„å¼ºä¸€è‡´æ€§ã€‚</p>
<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>CAP æ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿè®¾è®¡ç†è®ºï¼ŒBASE æ˜¯ CAP ç†è®ºä¸­ AP æ–¹æ¡ˆçš„å»¶ä¼¸ï¼ŒACID æ˜¯æ•°æ®åº“äº‹åŠ¡å®Œæ•´æ€§çš„ç†è®ºã€‚</p>
<p>CAPç†è®ºä¸¥æ ¼æ¥è®²ä¸æ˜¯ä¸‰é€‰äºŒï¼Œè€Œæ˜¯CPã€APäºŒé€‰ä¸€ï¼Œå› ä¸ºé€šå¸¸Pï¼ˆåˆ†åŒºå®¹é”™æ€§ï¼‰æ˜¯å¿…é¡»å¾—åˆ°ä¿è¯çš„ã€‚</p>
<p>BASEç†è®ºé¢å‘çš„æ˜¯å¤§å‹é«˜å¯ç”¨ã€å¯æ‰©å±•çš„åˆ†å¸ƒå¼ç³»ç»Ÿã€‚ä¸ä¼ ç»ŸACIDç‰¹æ€§ç›¸åï¼Œä¸æ˜¯å¼ºä¸€è‡´æ€§æ¨¡å‹ï¼ŒBASEæå‡ºé€šè¿‡ç‰ºç‰²å¼ºä¸€è‡´æ€§æ¥è·å¾—å¯ç”¨æ€§ï¼Œå¹¶å…è®¸æ•°æ®ä¸€æ®µæ—¶é—´å†…çš„ä¸ä¸€è‡´ï¼Œä½†æ˜¯æœ€ç»ˆéœ€è¦è¾¾åˆ°ä¸€è‡´çŠ¶æ€ã€‚</p>
]]></content>
      <tags>
        <tag>æ¶æ„è®¾è®¡é‚£äº›äº‹å„¿</tag>
      </tags>
  </entry>
  <entry>
    <title>æ¶æ„è®¾è®¡é‚£äº›äº‹å„¿--ç™»å½•è®¤è¯é‚£äº›äº‹å„¿(ä¸€)ï¼ŒOAuth 2.0</title>
    <url>/2022/07/18/uncatalog/cl5qed6p700001cr78iu9hcbm/</url>
    <content><![CDATA[<hr>
<span id="more"></span>
<blockquote>
<p>OAuth 2.0 æ˜¯ç›®å‰æœ€æµè¡Œçš„æˆæƒæœºåˆ¶ï¼Œç”¨æ¥æˆæƒç¬¬ä¸‰æ–¹åº”ç”¨ï¼Œè·å–ç”¨æˆ·æ•°æ®ã€‚ è¿™ä¸ªæ ‡å‡†æ¯”è¾ƒæŠ½è±¡ï¼Œä½¿ç”¨äº†å¾ˆå¤šæœ¯è¯­ï¼Œåˆå­¦è€…ä¸å®¹æ˜“ç†è§£ã€‚å…¶å®è¯´èµ·æ¥å¹¶ä¸å¤æ‚ï¼Œä¸‹é¢æˆ‘å°±é€šè¿‡ä¸€ä¸ªç®€å•çš„ç±»æ¯”ï¼Œå¸®åŠ©å¤§å®¶è½»æ¾ç†è§£ï¼ŒOAuth 2.0 åˆ°åº•æ˜¯ä»€ä¹ˆã€‚</p>
</blockquote>
<h2 id="ä¸€ã€å¿«é€’å‘˜é—®é¢˜"><a href="#ä¸€ã€å¿«é€’å‘˜é—®é¢˜" class="headerlink" title="ä¸€ã€å¿«é€’å‘˜é—®é¢˜"></a>ä¸€ã€å¿«é€’å‘˜é—®é¢˜</h2><p>æˆ‘ä½åœ¨ä¸€ä¸ªå¤§å‹çš„å±…æ°‘å°åŒºã€‚</p>
<p><img src="/2022/07/18/uncatalog/cl5qed6p700001cr78iu9hcbm/bg2019040401.jpg" alt="img"><br>å°åŒºæœ‰é—¨ç¦ç³»ç»Ÿã€‚<br><img src="/2022/07/18/uncatalog/cl5qed6p700001cr78iu9hcbm/bg2019040402.jpg" alt="IMG"><br>è¿›å…¥çš„æ—¶å€™éœ€è¦è¾“å…¥å¯†ç ã€‚</p>
<p><img src="/2022/07/18/uncatalog/cl5qed6p700001cr78iu9hcbm/bg2019040403.jpg" alt="img"><br>æˆ‘ç»å¸¸ç½‘è´­å’Œå¤–å–ï¼Œæ¯å¤©éƒ½æœ‰å¿«é€’å‘˜æ¥é€è´§ã€‚æˆ‘å¿…é¡»æ‰¾åˆ°ä¸€ä¸ªåŠæ³•ï¼Œè®©å¿«é€’å‘˜é€šè¿‡é—¨ç¦ç³»ç»Ÿï¼Œè¿›å…¥å°åŒºã€‚</p>
<p><img src="/2022/07/18/uncatalog/cl5qed6p700001cr78iu9hcbm/bg2019040404.jpg" alt="img"><br>å¦‚æœæˆ‘æŠŠè‡ªå·±çš„å¯†ç ï¼Œå‘Šè¯‰å¿«é€’å‘˜ï¼Œä»–å°±æ‹¥æœ‰äº†ä¸æˆ‘åŒæ ·çš„æƒé™ï¼Œè¿™æ ·å¥½åƒä¸å¤ªåˆé€‚ã€‚ä¸‡ä¸€æˆ‘æƒ³å–æ¶ˆä»–è¿›å…¥å°åŒºçš„æƒåŠ›ï¼Œä¹Ÿå¾ˆéº»çƒ¦ï¼Œæˆ‘è‡ªå·±çš„å¯†ç ä¹Ÿå¾—è·Ÿç€æ”¹äº†ï¼Œè¿˜å¾—é€šçŸ¥å…¶ä»–çš„å¿«é€’å‘˜ã€‚</p>
<p>æœ‰æ²¡æœ‰ä¸€ç§åŠæ³•ï¼Œè®©å¿«é€’å‘˜èƒ½å¤Ÿè‡ªç”±è¿›å…¥å°åŒºï¼Œåˆä¸å¿…çŸ¥é“å°åŒºå±…æ°‘çš„å¯†ç ï¼Œè€Œä¸”ä»–çš„å”¯ä¸€æƒé™å°±æ˜¯é€è´§ï¼Œå…¶ä»–éœ€è¦å¯†ç çš„åœºåˆï¼Œä»–éƒ½æ²¡æœ‰æƒé™ï¼Ÿ</p>
<h2 id="äºŒã€æˆæƒæœºåˆ¶çš„è®¾è®¡"><a href="#äºŒã€æˆæƒæœºåˆ¶çš„è®¾è®¡" class="headerlink" title="äºŒã€æˆæƒæœºåˆ¶çš„è®¾è®¡"></a>äºŒã€æˆæƒæœºåˆ¶çš„è®¾è®¡</h2><p>äºæ˜¯ï¼Œæˆ‘è®¾è®¡äº†ä¸€å¥—æˆæƒæœºåˆ¶ã€‚</p>
<p>ç¬¬ä¸€æ­¥ï¼Œé—¨ç¦ç³»ç»Ÿçš„å¯†ç è¾“å…¥å™¨ä¸‹é¢ï¼Œå¢åŠ ä¸€ä¸ªæŒ‰é’®ï¼Œå«åšâ€è·å–æˆæƒâ€ã€‚å¿«é€’å‘˜éœ€è¦é¦–å…ˆæŒ‰è¿™ä¸ªæŒ‰é’®ï¼Œå»ç”³è¯·æˆæƒã€‚</p>
<p>ç¬¬äºŒæ­¥ï¼Œä»–æŒ‰ä¸‹æŒ‰é’®ä»¥åï¼Œå±‹ä¸»ï¼ˆä¹Ÿå°±æ˜¯æˆ‘ï¼‰çš„æ‰‹æœºå°±ä¼šè·³å‡ºå¯¹è¯æ¡†ï¼šæœ‰äººæ­£åœ¨è¦æ±‚æˆæƒã€‚ç³»ç»Ÿè¿˜ä¼šæ˜¾ç¤ºè¯¥å¿«é€’å‘˜çš„å§“åã€å·¥å·å’Œæ‰€å±çš„å¿«é€’å…¬å¸ã€‚</p>
<p>æˆ‘ç¡®è®¤è¯·æ±‚å±å®ï¼Œå°±ç‚¹å‡»æŒ‰é’®ï¼Œå‘Šè¯‰é—¨ç¦ç³»ç»Ÿï¼Œæˆ‘åŒæ„ç»™äºˆä»–è¿›å…¥å°åŒºçš„æˆæƒã€‚</p>
<p>ç¬¬ä¸‰æ­¥ï¼Œé—¨ç¦ç³»ç»Ÿå¾—åˆ°æˆ‘çš„ç¡®è®¤ä»¥åï¼Œå‘å¿«é€’å‘˜æ˜¾ç¤ºä¸€ä¸ªè¿›å…¥å°åŒºçš„ä»¤ç‰Œï¼ˆaccess tokenï¼‰ã€‚ä»¤ç‰Œå°±æ˜¯ç±»ä¼¼å¯†ç çš„ä¸€ä¸²æ•°å­—ï¼Œåªåœ¨çŸ­æœŸå†…ï¼ˆæ¯”å¦‚ä¸ƒå¤©ï¼‰æœ‰æ•ˆã€‚</p>
<p>ç¬¬å››æ­¥ï¼Œå¿«é€’å‘˜å‘é—¨ç¦ç³»ç»Ÿè¾“å…¥ä»¤ç‰Œï¼Œè¿›å…¥å°åŒºã€‚</p>
<p>æœ‰äººå¯èƒ½ä¼šé—®ï¼Œä¸ºä»€ä¹ˆä¸æ˜¯è¿œç¨‹ä¸ºå¿«é€’å‘˜å¼€é—¨ï¼Œè€Œè¦ä¸ºä»–å•ç‹¬ç”Ÿæˆä¸€ä¸ªä»¤ç‰Œï¼Ÿè¿™æ˜¯å› ä¸ºå¿«é€’å‘˜å¯èƒ½æ¯å¤©éƒ½ä¼šæ¥é€è´§ï¼Œç¬¬äºŒå¤©ä»–è¿˜å¯ä»¥å¤ç”¨è¿™ä¸ªä»¤ç‰Œã€‚å¦å¤–ï¼Œæœ‰çš„å°åŒºæœ‰å¤šé‡é—¨ç¦ï¼Œå¿«é€’å‘˜å¯ä»¥ä½¿ç”¨åŒä¸€ä¸ªä»¤ç‰Œé€šè¿‡å®ƒä»¬ã€‚</p>
<h2 id="ä¸‰ã€äº’è”ç½‘åœºæ™¯"><a href="#ä¸‰ã€äº’è”ç½‘åœºæ™¯" class="headerlink" title="ä¸‰ã€äº’è”ç½‘åœºæ™¯"></a>ä¸‰ã€äº’è”ç½‘åœºæ™¯</h2><p>æˆ‘ä»¬æŠŠä¸Šé¢çš„ä¾‹å­æ¬åˆ°äº’è”ç½‘ï¼Œå°±æ˜¯ OAuth çš„è®¾è®¡äº†ã€‚</p>
<p>é¦–å…ˆï¼Œå±…æ°‘å°åŒºå°±æ˜¯å‚¨å­˜ç”¨æˆ·æ•°æ®çš„ç½‘ç»œæœåŠ¡ã€‚æ¯”å¦‚ï¼Œå¾®ä¿¡å‚¨å­˜äº†æˆ‘çš„å¥½å‹ä¿¡æ¯ï¼Œè·å–è¿™äº›ä¿¡æ¯ï¼Œå°±å¿…é¡»ç»è¿‡å¾®ä¿¡çš„â€é—¨ç¦ç³»ç»Ÿâ€ã€‚</p>
<p>å…¶æ¬¡ï¼Œå¿«é€’å‘˜ï¼ˆæˆ–è€…è¯´å¿«é€’å…¬å¸ï¼‰å°±æ˜¯ç¬¬ä¸‰æ–¹åº”ç”¨ï¼Œæƒ³è¦ç©¿è¿‡é—¨ç¦ç³»ç»Ÿï¼Œè¿›å…¥å°åŒºã€‚</p>
<p>æœ€åï¼Œæˆ‘å°±æ˜¯ç”¨æˆ·æœ¬äººï¼ŒåŒæ„æˆæƒç¬¬ä¸‰æ–¹åº”ç”¨è¿›å…¥å°åŒºï¼Œè·å–æˆ‘çš„æ•°æ®ã€‚</p>
<p>ç®€å•è¯´ï¼ŒOAuth å°±æ˜¯ä¸€ç§æˆæƒæœºåˆ¶ã€‚æ•°æ®çš„æ‰€æœ‰è€…å‘Šè¯‰ç³»ç»Ÿï¼ŒåŒæ„æˆæƒç¬¬ä¸‰æ–¹åº”ç”¨è¿›å…¥ç³»ç»Ÿï¼Œè·å–è¿™äº›æ•°æ®ã€‚ç³»ç»Ÿä»è€Œäº§ç”Ÿä¸€ä¸ªçŸ­æœŸçš„è¿›å…¥ä»¤ç‰Œï¼ˆtokenï¼‰ï¼Œç”¨æ¥ä»£æ›¿å¯†ç ï¼Œä¾›ç¬¬ä¸‰æ–¹åº”ç”¨ä½¿ç”¨ã€‚</p>
<h2 id="å››ã€ä»¤ç‰Œä¸å¯†ç "><a href="#å››ã€ä»¤ç‰Œä¸å¯†ç " class="headerlink" title="å››ã€ä»¤ç‰Œä¸å¯†ç "></a>å››ã€ä»¤ç‰Œä¸å¯†ç </h2><p>ä»¤ç‰Œï¼ˆtokenï¼‰ä¸å¯†ç ï¼ˆpasswordï¼‰çš„ä½œç”¨æ˜¯ä¸€æ ·çš„ï¼Œéƒ½å¯ä»¥è¿›å…¥ç³»ç»Ÿï¼Œä½†æ˜¯æœ‰ä¸‰ç‚¹å·®å¼‚ã€‚</p>
<p>ï¼ˆ1ï¼‰ä»¤ç‰Œæ˜¯çŸ­æœŸçš„ï¼Œåˆ°æœŸä¼šè‡ªåŠ¨å¤±æ•ˆï¼Œç”¨æˆ·è‡ªå·±æ— æ³•ä¿®æ”¹ã€‚å¯†ç ä¸€èˆ¬é•¿æœŸæœ‰æ•ˆï¼Œç”¨æˆ·ä¸ä¿®æ”¹ï¼Œå°±ä¸ä¼šå‘ç”Ÿå˜åŒ–ã€‚</p>
<p>ï¼ˆ2ï¼‰ä»¤ç‰Œå¯ä»¥è¢«æ•°æ®æ‰€æœ‰è€…æ’¤é”€ï¼Œä¼šç«‹å³å¤±æ•ˆã€‚ä»¥ä¸Šä¾‹è€Œè¨€ï¼Œå±‹ä¸»å¯ä»¥éšæ—¶å–æ¶ˆå¿«é€’å‘˜çš„ä»¤ç‰Œã€‚å¯†ç ä¸€èˆ¬ä¸å…è®¸è¢«ä»–äººæ’¤é”€ã€‚</p>
<p>ï¼ˆ3ï¼‰ä»¤ç‰Œæœ‰æƒé™èŒƒå›´ï¼ˆscopeï¼‰ï¼Œæ¯”å¦‚åªèƒ½è¿›å°åŒºçš„äºŒå·é—¨ã€‚å¯¹äºç½‘ç»œæœåŠ¡æ¥è¯´ï¼Œåªè¯»ä»¤ç‰Œå°±æ¯”è¯»å†™ä»¤ç‰Œæ›´å®‰å…¨ã€‚å¯†ç ä¸€èˆ¬æ˜¯å®Œæ•´æƒé™ã€‚</p>
<p>ä¸Šé¢è¿™äº›è®¾è®¡ï¼Œä¿è¯äº†ä»¤ç‰Œæ—¢å¯ä»¥è®©ç¬¬ä¸‰æ–¹åº”ç”¨è·å¾—æƒé™ï¼ŒåŒæ—¶åˆéšæ—¶å¯æ§ï¼Œä¸ä¼šå±åŠç³»ç»Ÿå®‰å…¨ã€‚è¿™å°±æ˜¯ OAuth 2.0 çš„ä¼˜ç‚¹ã€‚</p>
<p>æ³¨æ„ï¼Œåªè¦çŸ¥é“äº†ä»¤ç‰Œï¼Œå°±èƒ½è¿›å…¥ç³»ç»Ÿã€‚ç³»ç»Ÿä¸€èˆ¬ä¸ä¼šå†æ¬¡ç¡®è®¤èº«ä»½ï¼Œæ‰€ä»¥ä»¤ç‰Œå¿…é¡»ä¿å¯†ï¼Œæ³„æ¼ä»¤ç‰Œä¸æ³„æ¼å¯†ç çš„åæœæ˜¯ä¸€æ ·çš„ã€‚ è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆä»¤ç‰Œçš„æœ‰æ•ˆæœŸï¼Œä¸€èˆ¬éƒ½è®¾ç½®å¾—å¾ˆçŸ­çš„åŸå› ã€‚</p>
<p>OAuth 2.0 å¯¹äºå¦‚ä½•é¢å‘ä»¤ç‰Œçš„ç»†èŠ‚ï¼Œè§„å®šå¾—éå¸¸è¯¦ç»†ã€‚å…·ä½“æ¥è¯´ï¼Œä¸€å…±åˆ†æˆå››ç§æˆæƒç±»å‹ï¼ˆauthorization grantï¼‰ï¼Œå³å››ç§é¢å‘ä»¤ç‰Œçš„æ–¹å¼ï¼Œé€‚ç”¨äºä¸åŒçš„äº’è”ç½‘åœºæ™¯ã€‚</p>
<h2 id="RFC-6749"><a href="#RFC-6749" class="headerlink" title="RFC 6749"></a>RFC 6749</h2><p>OAuth 2.0 çš„æ ‡å‡†æ˜¯ RFC 6749 æ–‡ä»¶ã€‚è¯¥æ–‡ä»¶å…ˆè§£é‡Šäº† OAuth æ˜¯ä»€ä¹ˆã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="TEXT"><figure class="iseeu highlight /text"><table><tr><td class="code"><pre><span class="line">OAuth å¼•å…¥äº†ä¸€ä¸ªæˆæƒå±‚ï¼Œç”¨æ¥åˆ†ç¦»ä¸¤ç§ä¸åŒçš„è§’è‰²ï¼šå®¢æˆ·ç«¯å’Œèµ„æºæ‰€æœ‰è€…ã€‚......èµ„æºæ‰€æœ‰è€…åŒæ„ä»¥åï¼Œèµ„æºæœåŠ¡å™¨å¯ä»¥å‘å®¢æˆ·ç«¯é¢å‘ä»¤ç‰Œã€‚å®¢æˆ·ç«¯é€šè¿‡ä»¤ç‰Œï¼Œå»è¯·æ±‚æ•°æ®ã€‚</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
<p>è¿™æ®µè¯çš„æ„æ€å°±æ˜¯ï¼ŒOAuth çš„æ ¸å¿ƒå°±æ˜¯å‘ç¬¬ä¸‰æ–¹åº”ç”¨é¢å‘ä»¤ç‰Œã€‚ç„¶åï¼ŒRFC 6749 æ¥ç€å†™é“ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="TEXT"><figure class="iseeu highlight /text"><table><tr><td class="code"><pre><span class="line">ï¼ˆç”±äºäº’è”ç½‘æœ‰å¤šç§åœºæ™¯ï¼Œï¼‰æœ¬æ ‡å‡†å®šä¹‰äº†è·å¾—ä»¤ç‰Œçš„å››ç§æˆæƒæ–¹å¼ï¼ˆauthorization grant ï¼‰ã€‚</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼ŒOAuth 2.0 è§„å®šäº†å››ç§è·å¾—ä»¤ç‰Œçš„æµç¨‹ã€‚ä½ å¯ä»¥é€‰æ‹©æœ€é€‚åˆè‡ªå·±çš„é‚£ä¸€ç§ï¼Œå‘ç¬¬ä¸‰æ–¹åº”ç”¨é¢å‘ä»¤ç‰Œã€‚ä¸‹é¢å°±æ˜¯è¿™å››ç§æˆæƒæ–¹å¼ã€‚</p>
<ul>
<li>æˆæƒç ï¼ˆauthorization-codeï¼‰ </li>
<li>éšè—å¼ï¼ˆimplicitï¼‰</li>
<li>å¯†ç å¼ï¼ˆpasswordï¼‰</li>
<li>å®¢æˆ·ç«¯å‡­è¯ï¼ˆclient credentialsï¼‰</li>
</ul>
<p>æ³¨æ„ï¼Œä¸ç®¡å“ªä¸€ç§æˆæƒæ–¹å¼ï¼Œç¬¬ä¸‰æ–¹åº”ç”¨ç”³è¯·ä»¤ç‰Œä¹‹å‰ï¼Œéƒ½å¿…é¡»å…ˆåˆ°ç³»ç»Ÿå¤‡æ¡ˆï¼Œè¯´æ˜è‡ªå·±çš„èº«ä»½ï¼Œç„¶åä¼šæ‹¿åˆ°ä¸¤ä¸ªèº«ä»½è¯†åˆ«ç ï¼šå®¢æˆ·ç«¯ IDï¼ˆclient IDï¼‰å’Œå®¢æˆ·ç«¯å¯†é’¥ï¼ˆclient secretï¼‰ã€‚è¿™æ˜¯ä¸ºäº†é˜²æ­¢ä»¤ç‰Œè¢«æ»¥ç”¨ï¼Œæ²¡æœ‰å¤‡æ¡ˆè¿‡çš„ç¬¬ä¸‰æ–¹åº”ç”¨ï¼Œæ˜¯ä¸ä¼šæ‹¿åˆ°ä»¤ç‰Œçš„ã€‚</p>
<h2 id="ç¬¬ä¸€ç§æˆæƒæ–¹å¼ï¼šæˆæƒç "><a href="#ç¬¬ä¸€ç§æˆæƒæ–¹å¼ï¼šæˆæƒç " class="headerlink" title="ç¬¬ä¸€ç§æˆæƒæ–¹å¼ï¼šæˆæƒç "></a>ç¬¬ä¸€ç§æˆæƒæ–¹å¼ï¼šæˆæƒç </h2><p>æˆæƒç ï¼ˆauthorization codeï¼‰æ–¹å¼ï¼ŒæŒ‡çš„æ˜¯ç¬¬ä¸‰æ–¹åº”ç”¨å…ˆç”³è¯·ä¸€ä¸ªæˆæƒç ï¼Œç„¶åå†ç”¨è¯¥ç è·å–ä»¤ç‰Œã€‚</p>
<p>è¿™ç§æ–¹å¼æ˜¯æœ€å¸¸ç”¨çš„æµç¨‹ï¼Œå®‰å…¨æ€§ä¹Ÿæœ€é«˜ï¼Œå®ƒé€‚ç”¨äºé‚£äº›æœ‰åç«¯çš„ Web åº”ç”¨ã€‚æˆæƒç é€šè¿‡å‰ç«¯ä¼ é€ï¼Œä»¤ç‰Œåˆ™æ˜¯å‚¨å­˜åœ¨åç«¯ï¼Œè€Œä¸”æ‰€æœ‰ä¸èµ„æºæœåŠ¡å™¨çš„é€šä¿¡éƒ½åœ¨åç«¯å®Œæˆã€‚è¿™æ ·çš„å‰åç«¯åˆ†ç¦»ï¼Œå¯ä»¥é¿å…ä»¤ç‰Œæ³„æ¼ã€‚</p>
<p>ç¬¬ä¸€æ­¥ï¼ŒA ç½‘ç«™æä¾›ä¸€ä¸ªé“¾æ¥ï¼Œç”¨æˆ·ç‚¹å‡»åå°±ä¼šè·³è½¬åˆ° B ç½‘ç«™ï¼Œæˆæƒç”¨æˆ·æ•°æ®ç»™ A ç½‘ç«™ä½¿ç”¨ã€‚ä¸‹é¢å°±æ˜¯ A ç½‘ç«™è·³è½¬ B ç½‘ç«™çš„ä¸€ä¸ªç¤ºæ„é“¾æ¥ã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="TEXT"><figure class="iseeu highlight /text"><table><tr><td class="code"><pre><span class="line">https://b.com/oauth/authorize?</span><br><span class="line">  response_type=code&amp;</span><br><span class="line">  client_id=CLIENT_ID&amp;</span><br><span class="line">  redirect_uri=CALLBACK_URL&amp;</span><br><span class="line">  scope=read</span><br></pre></td></tr></table></figure></div>
<p>ä¸Šé¢ URL ä¸­ï¼Œresponse_typeå‚æ•°è¡¨ç¤ºè¦æ±‚è¿”å›æˆæƒç ï¼ˆcodeï¼‰ï¼Œclient_idå‚æ•°è®© B çŸ¥é“æ˜¯è°åœ¨è¯·æ±‚ï¼Œredirect_uriå‚æ•°æ˜¯ B æ¥å—æˆ–æ‹’ç»è¯·æ±‚åçš„è·³è½¬ç½‘å€ï¼Œscopeå‚æ•°è¡¨ç¤ºè¦æ±‚çš„æˆæƒèŒƒå›´ï¼ˆè¿™é‡Œæ˜¯åªè¯»ï¼‰ã€‚</p>
<p><img src="/2022/07/18/uncatalog/cl5qed6p700001cr78iu9hcbm/bg2019040902.jpg" alt="img"></p>
<p>ç¬¬äºŒæ­¥ï¼Œç”¨æˆ·è·³è½¬åï¼ŒB ç½‘ç«™ä¼šè¦æ±‚ç”¨æˆ·ç™»å½•ï¼Œç„¶åè¯¢é—®æ˜¯å¦åŒæ„ç»™äºˆ A ç½‘ç«™æˆæƒã€‚ç”¨æˆ·è¡¨ç¤ºåŒæ„ï¼Œè¿™æ—¶ B ç½‘ç«™å°±ä¼šè·³å›redirect_uriå‚æ•°æŒ‡å®šçš„ç½‘å€ã€‚è·³è½¬æ—¶ï¼Œä¼šä¼ å›ä¸€ä¸ªæˆæƒç ï¼Œå°±åƒä¸‹é¢è¿™æ ·ã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="TEXT"><figure class="iseeu highlight /text"><table><tr><td class="code"><pre><span class="line">https://a.com/callback?code=AUTHORIZATION_CODE</span><br></pre></td></tr></table></figure></div>
<p>ä¸Šé¢ URL ä¸­ï¼Œcodeå‚æ•°å°±æ˜¯æˆæƒç ã€‚</p>
<p><img src="/2022/07/18/uncatalog/cl5qed6p700001cr78iu9hcbm/bg2019040907.jpg" alt="img"><br>ç¬¬ä¸‰æ­¥ï¼ŒA ç½‘ç«™æ‹¿åˆ°æˆæƒç ä»¥åï¼Œå°±å¯ä»¥åœ¨åç«¯ï¼Œå‘ B ç½‘ç«™è¯·æ±‚ä»¤ç‰Œã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="TEXT"><figure class="iseeu highlight /text"><table><tr><td class="code"><pre><span class="line">https://b.com/oauth/token?</span><br><span class="line"> client_id=CLIENT_ID&amp;</span><br><span class="line"> client_secret=CLIENT_SECRET&amp;</span><br><span class="line"> grant_type=authorization_code&amp;</span><br><span class="line"> code=AUTHORIZATION_CODE&amp;</span><br><span class="line"> redirect_uri=CALLBACK_URL</span><br></pre></td></tr></table></figure></div>
<p>ä¸Šé¢ URL ä¸­ï¼Œclient_idå‚æ•°å’Œclient_secretå‚æ•°ç”¨æ¥è®© B ç¡®è®¤ A çš„èº«ä»½ï¼ˆclient_secretå‚æ•°æ˜¯ä¿å¯†çš„ï¼Œå› æ­¤åªèƒ½åœ¨åç«¯å‘è¯·æ±‚ï¼‰ï¼Œgrant_typeå‚æ•°çš„å€¼æ˜¯AUTHORIZATION_CODEï¼Œè¡¨ç¤ºé‡‡ç”¨çš„æˆæƒæ–¹å¼æ˜¯æˆæƒç ï¼Œcodeå‚æ•°æ˜¯ä¸Šä¸€æ­¥æ‹¿åˆ°çš„æˆæƒç ï¼Œredirect_uriå‚æ•°æ˜¯ä»¤ç‰Œé¢å‘åçš„å›è°ƒç½‘å€ã€‚</p>
<p><img src="/2022/07/18/uncatalog/cl5qed6p700001cr78iu9hcbm/bg2019040904.jpg" alt="img"><br>ç¬¬å››æ­¥ï¼ŒB ç½‘ç«™æ”¶åˆ°è¯·æ±‚ä»¥åï¼Œå°±ä¼šé¢å‘ä»¤ç‰Œã€‚å…·ä½“åšæ³•æ˜¯å‘redirect_uriæŒ‡å®šçš„ç½‘å€ï¼Œå‘é€ä¸€æ®µ JSON æ•°æ®ã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JSON"><figure class="iseeu highlight /json"><table><tr><td class="code"><pre><span class="line">&#123;    </span><br><span class="line">  <span class="attr">&quot;access_token&quot;</span>:<span class="string">&quot;ACCESS_TOKEN&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;token_type&quot;</span>:<span class="string">&quot;bearer&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;expires_in&quot;</span>:<span class="number">2592000</span>,</span><br><span class="line">  <span class="attr">&quot;refresh_token&quot;</span>:<span class="string">&quot;REFRESH_TOKEN&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;scope&quot;</span>:<span class="string">&quot;read&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;uid&quot;</span>:<span class="number">100101</span>,</span><br><span class="line">  <span class="attr">&quot;info&quot;</span>:&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>ä¸Šé¢ JSON æ•°æ®ä¸­ï¼Œaccess_tokenå­—æ®µå°±æ˜¯ä»¤ç‰Œï¼ŒA ç½‘ç«™åœ¨åç«¯æ‹¿åˆ°äº†ã€‚<br><img src="/2022/07/18/uncatalog/cl5qed6p700001cr78iu9hcbm/bg2019040905.jpg" alt="img"></p>
<h2 id="ç¬¬äºŒç§æ–¹å¼ï¼šéšè—å¼"><a href="#ç¬¬äºŒç§æ–¹å¼ï¼šéšè—å¼" class="headerlink" title="ç¬¬äºŒç§æ–¹å¼ï¼šéšè—å¼"></a>ç¬¬äºŒç§æ–¹å¼ï¼šéšè—å¼</h2><p>æœ‰äº› Web åº”ç”¨æ˜¯çº¯å‰ç«¯åº”ç”¨ï¼Œæ²¡æœ‰åç«¯ã€‚è¿™æ—¶å°±ä¸èƒ½ç”¨ä¸Šé¢çš„æ–¹å¼äº†ï¼Œå¿…é¡»å°†ä»¤ç‰Œå‚¨å­˜åœ¨å‰ç«¯ã€‚RFC 6749 å°±è§„å®šäº†ç¬¬äºŒç§æ–¹å¼ï¼Œå…è®¸ç›´æ¥å‘å‰ç«¯é¢å‘ä»¤ç‰Œã€‚è¿™ç§æ–¹å¼æ²¡æœ‰æˆæƒç è¿™ä¸ªä¸­é—´æ­¥éª¤ï¼Œæ‰€ä»¥ç§°ä¸ºï¼ˆæˆæƒç ï¼‰â€éšè—å¼â€ï¼ˆimplicitï¼‰ã€‚</p>
<p>ç¬¬ä¸€æ­¥ï¼ŒA ç½‘ç«™æä¾›ä¸€ä¸ªé“¾æ¥ï¼Œè¦æ±‚ç”¨æˆ·è·³è½¬åˆ° B ç½‘ç«™ï¼Œæˆæƒç”¨æˆ·æ•°æ®ç»™ A ç½‘ç«™ä½¿ç”¨ã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="TEXT"><figure class="iseeu highlight /text"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">https://b.com/oauth/authorize?</span><br><span class="line">  response_type=token&amp;</span><br><span class="line">  client_id=CLIENT_ID&amp;</span><br><span class="line">  redirect_uri=CALLBACK_URL&amp;</span><br><span class="line">  scope=read</span><br></pre></td></tr></table></figure></div>
<p>ä¸Šé¢ URL ä¸­ï¼Œresponse_typeå‚æ•°ä¸ºtokenï¼Œè¡¨ç¤ºè¦æ±‚ç›´æ¥è¿”å›ä»¤ç‰Œã€‚</p>
<p>ç¬¬äºŒæ­¥ï¼Œç”¨æˆ·è·³è½¬åˆ° B ç½‘ç«™ï¼Œç™»å½•ååŒæ„ç»™äºˆ A ç½‘ç«™æˆæƒã€‚è¿™æ—¶ï¼ŒB ç½‘ç«™å°±ä¼šè·³å›redirect_uriå‚æ•°æŒ‡å®šçš„è·³è½¬ç½‘å€ï¼Œå¹¶ä¸”æŠŠä»¤ç‰Œä½œä¸º URL å‚æ•°ï¼Œä¼ ç»™ A ç½‘ç«™ã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="TEXT"><figure class="iseeu highlight /text"><table><tr><td class="code"><pre><span class="line">https://a.com/callback#token=ACCESS_TOKEN</span><br></pre></td></tr></table></figure></div>
<p>ä¸Šé¢ URL ä¸­ï¼Œtokenå‚æ•°å°±æ˜¯ä»¤ç‰Œï¼ŒA ç½‘ç«™å› æ­¤ç›´æ¥åœ¨å‰ç«¯æ‹¿åˆ°ä»¤ç‰Œã€‚</p>
<p>æ³¨æ„ï¼Œä»¤ç‰Œçš„ä½ç½®æ˜¯ URL é”šç‚¹ï¼ˆfragmentï¼‰ï¼Œè€Œä¸æ˜¯æŸ¥è¯¢å­—ç¬¦ä¸²ï¼ˆquerystringï¼‰ï¼Œè¿™æ˜¯å› ä¸º OAuth 2.0 å…è®¸è·³è½¬ç½‘å€æ˜¯ HTTP åè®®ï¼Œå› æ­¤å­˜åœ¨â€ä¸­é—´äººæ”»å‡»â€çš„é£é™©ï¼Œè€Œæµè§ˆå™¨è·³è½¬æ—¶ï¼Œé”šç‚¹ä¸ä¼šå‘åˆ°æœåŠ¡å™¨ï¼Œå°±å‡å°‘äº†æ³„æ¼ä»¤ç‰Œçš„é£é™©ã€‚<br><img src="/2022/07/18/uncatalog/cl5qed6p700001cr78iu9hcbm/bg2019040906.jpg" alt="img"></p>
<p>è¿™ç§æ–¹å¼æŠŠä»¤ç‰Œç›´æ¥ä¼ ç»™å‰ç«¯ï¼Œæ˜¯å¾ˆä¸å®‰å…¨çš„ã€‚å› æ­¤ï¼Œåªèƒ½ç”¨äºä¸€äº›å®‰å…¨è¦æ±‚ä¸é«˜çš„åœºæ™¯ï¼Œå¹¶ä¸”ä»¤ç‰Œçš„æœ‰æ•ˆæœŸå¿…é¡»éå¸¸çŸ­ï¼Œé€šå¸¸å°±æ˜¯ä¼šè¯æœŸé—´ï¼ˆsessionï¼‰æœ‰æ•ˆï¼Œæµè§ˆå™¨å…³æ‰ï¼Œä»¤ç‰Œå°±å¤±æ•ˆäº†ã€‚</p>
<h2 id="ç¬¬ä¸‰ç§æ–¹å¼ï¼šå¯†ç å¼"><a href="#ç¬¬ä¸‰ç§æ–¹å¼ï¼šå¯†ç å¼" class="headerlink" title="ç¬¬ä¸‰ç§æ–¹å¼ï¼šå¯†ç å¼"></a>ç¬¬ä¸‰ç§æ–¹å¼ï¼šå¯†ç å¼</h2><p>å¦‚æœä½ é«˜åº¦ä¿¡ä»»æŸä¸ªåº”ç”¨ï¼ŒRFC 6749 ä¹Ÿå…è®¸ç”¨æˆ·æŠŠç”¨æˆ·åå’Œå¯†ç ï¼Œç›´æ¥å‘Šè¯‰è¯¥åº”ç”¨ã€‚è¯¥åº”ç”¨å°±ä½¿ç”¨ä½ çš„å¯†ç ï¼Œç”³è¯·ä»¤ç‰Œï¼Œè¿™ç§æ–¹å¼ç§°ä¸ºâ€å¯†ç å¼â€ï¼ˆpasswordï¼‰ã€‚</p>
<p>ç¬¬ä¸€æ­¥ï¼ŒA ç½‘ç«™è¦æ±‚ç”¨æˆ·æä¾› B ç½‘ç«™çš„ç”¨æˆ·åå’Œå¯†ç ã€‚æ‹¿åˆ°ä»¥åï¼ŒA å°±ç›´æ¥å‘ B è¯·æ±‚ä»¤ç‰Œã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="TEXT"><figure class="iseeu highlight /text"><table><tr><td class="code"><pre><span class="line">https://oauth.b.com/token?</span><br><span class="line">  grant_type=password&amp;</span><br><span class="line">  username=USERNAME&amp;</span><br><span class="line">  password=PASSWORD&amp;</span><br><span class="line">  client_id=CLIENT_ID</span><br><span class="line">  </span><br></pre></td></tr></table></figure></div>

<p>ä¸Šé¢ URL ä¸­ï¼Œgrant_typeå‚æ•°æ˜¯æˆæƒæ–¹å¼ï¼Œè¿™é‡Œçš„passwordè¡¨ç¤ºâ€å¯†ç å¼â€ï¼Œusernameå’Œpasswordæ˜¯ B çš„ç”¨æˆ·åå’Œå¯†ç ã€‚</p>
<p>ç¬¬äºŒæ­¥ï¼ŒB ç½‘ç«™éªŒè¯èº«ä»½é€šè¿‡åï¼Œç›´æ¥ç»™å‡ºä»¤ç‰Œã€‚æ³¨æ„ï¼Œè¿™æ—¶ä¸éœ€è¦è·³è½¬ï¼Œè€Œæ˜¯æŠŠä»¤ç‰Œæ”¾åœ¨ JSON æ•°æ®é‡Œé¢ï¼Œä½œä¸º HTTP å›åº”ï¼ŒA å› æ­¤æ‹¿åˆ°ä»¤ç‰Œã€‚</p>
<p>è¿™ç§æ–¹å¼éœ€è¦ç”¨æˆ·ç»™å‡ºè‡ªå·±çš„ç”¨æˆ·å/å¯†ç ï¼Œæ˜¾ç„¶é£é™©å¾ˆå¤§ï¼Œå› æ­¤åªé€‚ç”¨äºå…¶ä»–æˆæƒæ–¹å¼éƒ½æ— æ³•é‡‡ç”¨çš„æƒ…å†µï¼Œè€Œä¸”å¿…é¡»æ˜¯ç”¨æˆ·é«˜åº¦ä¿¡ä»»çš„åº”ç”¨ã€‚</p>
<h2 id="ç¬¬å››ç§æ–¹å¼ï¼šå‡­è¯å¼"><a href="#ç¬¬å››ç§æ–¹å¼ï¼šå‡­è¯å¼" class="headerlink" title="ç¬¬å››ç§æ–¹å¼ï¼šå‡­è¯å¼"></a>ç¬¬å››ç§æ–¹å¼ï¼šå‡­è¯å¼</h2><p>æœ€åä¸€ç§æ–¹å¼æ˜¯å‡­è¯å¼ï¼ˆclient credentialsï¼‰ï¼Œé€‚ç”¨äºæ²¡æœ‰å‰ç«¯çš„å‘½ä»¤è¡Œåº”ç”¨ï¼Œå³åœ¨å‘½ä»¤è¡Œä¸‹è¯·æ±‚ä»¤ç‰Œã€‚</p>
<p>ç¬¬ä¸€æ­¥ï¼ŒA åº”ç”¨åœ¨å‘½ä»¤è¡Œå‘ B å‘å‡ºè¯·æ±‚ã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="TEXT"><figure class="iseeu highlight /text"><table><tr><td class="code"><pre><span class="line">https://oauth.b.com/token?</span><br><span class="line">  grant_type=client_credentials&amp;</span><br><span class="line">  client_id=CLIENT_ID&amp;</span><br><span class="line">  client_secret=CLIENT_SECRET</span><br></pre></td></tr></table></figure></div>
<p>ä¸Šé¢ URL ä¸­ï¼Œgrant_typeå‚æ•°ç­‰äºclient_credentialsè¡¨ç¤ºé‡‡ç”¨å‡­è¯å¼ï¼Œclient_idå’Œclient_secretç”¨æ¥è®© B ç¡®è®¤ A çš„èº«ä»½ã€‚</p>
<p>ç¬¬äºŒæ­¥ï¼ŒB ç½‘ç«™éªŒè¯é€šè¿‡ä»¥åï¼Œç›´æ¥è¿”å›ä»¤ç‰Œã€‚</p>
<p>è¿™ç§æ–¹å¼ç»™å‡ºçš„ä»¤ç‰Œï¼Œæ˜¯é’ˆå¯¹ç¬¬ä¸‰æ–¹åº”ç”¨çš„ï¼Œè€Œä¸æ˜¯é’ˆå¯¹ç”¨æˆ·çš„ï¼Œå³æœ‰å¯èƒ½å¤šä¸ªç”¨æˆ·å…±äº«åŒä¸€ä¸ªä»¤ç‰Œã€‚</p>
<h2 id="ä»¤ç‰Œçš„ä½¿ç”¨"><a href="#ä»¤ç‰Œçš„ä½¿ç”¨" class="headerlink" title="ä»¤ç‰Œçš„ä½¿ç”¨"></a>ä»¤ç‰Œçš„ä½¿ç”¨</h2><p>A ç½‘ç«™æ‹¿åˆ°ä»¤ç‰Œä»¥åï¼Œå°±å¯ä»¥å‘ B ç½‘ç«™çš„ API è¯·æ±‚æ•°æ®äº†ã€‚</p>
<p>æ­¤æ—¶ï¼Œæ¯ä¸ªå‘åˆ° API çš„è¯·æ±‚ï¼Œéƒ½å¿…é¡»å¸¦æœ‰ä»¤ç‰Œã€‚å…·ä½“åšæ³•æ˜¯åœ¨è¯·æ±‚çš„å¤´ä¿¡æ¯ï¼ŒåŠ ä¸Šä¸€ä¸ªAuthorizationå­—æ®µï¼Œä»¤ç‰Œå°±æ”¾åœ¨è¿™ä¸ªå­—æ®µé‡Œé¢ã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">curl -H &quot;Authorization: Bearer ACCESS_TOKEN&quot; \</span><br><span class="line">&quot;https://api.b.com&quot;</span><br></pre></td></tr></table></figure></div>
<p>ä¸Šé¢å‘½ä»¤ä¸­ï¼ŒACCESS_TOKENå°±æ˜¯æ‹¿åˆ°çš„ä»¤ç‰Œã€‚</p>
<h2 id="æ›´æ–°ä»¤ç‰Œ"><a href="#æ›´æ–°ä»¤ç‰Œ" class="headerlink" title="æ›´æ–°ä»¤ç‰Œ"></a>æ›´æ–°ä»¤ç‰Œ</h2><p>ä»¤ç‰Œçš„æœ‰æ•ˆæœŸåˆ°äº†ï¼Œå¦‚æœè®©ç”¨æˆ·é‡æ–°èµ°ä¸€éä¸Šé¢çš„æµç¨‹ï¼Œå†ç”³è¯·ä¸€ä¸ªæ–°çš„ä»¤ç‰Œï¼Œå¾ˆå¯èƒ½ä½“éªŒä¸å¥½ï¼Œè€Œä¸”ä¹Ÿæ²¡æœ‰å¿…è¦ã€‚OAuth 2.0 å…è®¸ç”¨æˆ·è‡ªåŠ¨æ›´æ–°ä»¤ç‰Œã€‚</p>
<p>å…·ä½“æ–¹æ³•æ˜¯ï¼ŒB ç½‘ç«™é¢å‘ä»¤ç‰Œçš„æ—¶å€™ï¼Œä¸€æ¬¡æ€§é¢å‘ä¸¤ä¸ªä»¤ç‰Œï¼Œä¸€ä¸ªç”¨äºè·å–æ•°æ®ï¼Œå¦ä¸€ä¸ªç”¨äºè·å–æ–°çš„ä»¤ç‰Œï¼ˆrefresh token å­—æ®µï¼‰ã€‚ä»¤ç‰Œåˆ°æœŸå‰ï¼Œç”¨æˆ·ä½¿ç”¨ refresh token å‘ä¸€ä¸ªè¯·æ±‚ï¼Œå»æ›´æ–°ä»¤ç‰Œã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="TEXT"><figure class="iseeu highlight /text"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">https://b.com/oauth/token?</span><br><span class="line">  grant_type=refresh_token&amp;</span><br><span class="line">  client_id=CLIENT_ID&amp;</span><br><span class="line">  client_secret=CLIENT_SECRET&amp;</span><br><span class="line">  refresh_token=REFRESH_TOKEN</span><br></pre></td></tr></table></figure></div>
<p>ä¸Šé¢ URL ä¸­ï¼Œgrant_typeå‚æ•°ä¸ºrefresh_tokenè¡¨ç¤ºè¦æ±‚æ›´æ–°ä»¤ç‰Œï¼Œclient_idå‚æ•°å’Œclient_secretå‚æ•°ç”¨äºç¡®è®¤èº«ä»½ï¼Œrefresh_tokenå‚æ•°å°±æ˜¯ç”¨äºæ›´æ–°ä»¤ç‰Œçš„ä»¤ç‰Œã€‚</p>
<p>B ç½‘ç«™éªŒè¯é€šè¿‡ä»¥åï¼Œå°±ä¼šé¢å‘æ–°çš„ä»¤ç‰Œã€‚</p>
<p>å†™åˆ°è¿™é‡Œï¼Œé¢å‘ä»¤ç‰Œçš„å››ç§æ–¹å¼å°±ä»‹ç»å®Œäº†ã€‚ä¸‹ä¸€ç¯‡æ–‡ç« ä¼šç¼–å†™ä¸€ä¸ªçœŸå®çš„ Demoï¼Œæ¼”ç¤ºå¦‚ä½•é€šè¿‡ OAuth 2.0 å‘ GitHub çš„ API ç”³è¯·ä»¤ç‰Œï¼Œç„¶åå†ç”¨ä»¤ç‰Œè·å–æ•°æ®ã€‚</p>
]]></content>
      <tags>
        <tag>æ¶æ„è®¾è®¡é‚£äº›äº‹å„¿</tag>
      </tags>
  </entry>
  <entry>
    <title>æ¶æ„è®¾è®¡é‚£äº›äº‹å„¿--ç™»å½•è®¤è¯é‚£äº›äº‹å„¿(äºŒ)ï¼ŒJSON Web Token</title>
    <url>/2022/07/18/uncatalog/cl5qf74ul000040r73q1jfruf/</url>
    <content><![CDATA[<hr>
<span id="more"></span>
<p>JSON Web Tokenï¼ˆç¼©å†™ JWTï¼‰æ˜¯ç›®å‰æœ€æµè¡Œçš„è·¨åŸŸè®¤è¯è§£å†³æ–¹æ¡ˆï¼Œæœ¬æ–‡ä»‹ç»å®ƒçš„åŸç†å’Œç”¨æ³•ã€‚</p>
<h2 id="ä¸€ã€è·¨åŸŸè®¤è¯çš„é—®é¢˜"><a href="#ä¸€ã€è·¨åŸŸè®¤è¯çš„é—®é¢˜" class="headerlink" title="ä¸€ã€è·¨åŸŸè®¤è¯çš„é—®é¢˜"></a>ä¸€ã€è·¨åŸŸè®¤è¯çš„é—®é¢˜</h2><p>äº’è”ç½‘æœåŠ¡ç¦»ä¸å¼€ç”¨æˆ·è®¤è¯ã€‚ä¸€èˆ¬æµç¨‹æ˜¯ä¸‹é¢è¿™æ ·ã€‚</p>
<ul>
<li><p>1ã€ç”¨æˆ·å‘æœåŠ¡å™¨å‘é€ç”¨æˆ·åå’Œå¯†ç ã€‚</p>
</li>
<li><p>2ã€æœåŠ¡å™¨éªŒè¯é€šè¿‡åï¼Œåœ¨å½“å‰å¯¹è¯ï¼ˆsessionï¼‰é‡Œé¢ä¿å­˜ç›¸å…³æ•°æ®ï¼Œæ¯”å¦‚ç”¨æˆ·è§’è‰²ã€ç™»å½•æ—¶é—´ç­‰ç­‰ã€‚</p>
</li>
<li><p>3ã€æœåŠ¡å™¨å‘ç”¨æˆ·è¿”å›ä¸€ä¸ª session_idï¼Œå†™å…¥ç”¨æˆ·çš„ Cookieã€‚</p>
</li>
<li><p>4ã€ç”¨æˆ·éšåçš„æ¯ä¸€æ¬¡è¯·æ±‚ï¼Œéƒ½ä¼šé€šè¿‡ Cookieï¼Œå°† session_id ä¼ å›æœåŠ¡å™¨ã€‚</p>
</li>
<li><p>5ã€æœåŠ¡å™¨æ”¶åˆ° session_idï¼Œæ‰¾åˆ°å‰æœŸä¿å­˜çš„æ•°æ®ï¼Œç”±æ­¤å¾—çŸ¥ç”¨æˆ·çš„èº«ä»½ã€‚</p>
</li>
</ul>
<p>è¿™ç§æ¨¡å¼çš„é—®é¢˜åœ¨äºï¼Œæ‰©å±•æ€§ï¼ˆscalingï¼‰ä¸å¥½ã€‚å•æœºå½“ç„¶æ²¡æœ‰é—®é¢˜ï¼Œå¦‚æœæ˜¯æœåŠ¡å™¨é›†ç¾¤ï¼Œæˆ–è€…æ˜¯è·¨åŸŸçš„æœåŠ¡å¯¼å‘æ¶æ„ï¼Œå°±è¦æ±‚ session æ•°æ®å…±äº«ï¼Œæ¯å°æœåŠ¡å™¨éƒ½èƒ½å¤Ÿè¯»å– sessionã€‚</p>
<p>ä¸¾ä¾‹æ¥è¯´ï¼ŒA ç½‘ç«™å’Œ B ç½‘ç«™æ˜¯åŒä¸€å®¶å…¬å¸çš„å…³è”æœåŠ¡ã€‚ç°åœ¨è¦æ±‚ï¼Œç”¨æˆ·åªè¦åœ¨å…¶ä¸­ä¸€ä¸ªç½‘ç«™ç™»å½•ï¼Œå†è®¿é—®å¦ä¸€ä¸ªç½‘ç«™å°±ä¼šè‡ªåŠ¨ç™»å½•ï¼Œè¯·é—®æ€ä¹ˆå®ç°ï¼Ÿ</p>
<p>ä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯ session æ•°æ®æŒä¹…åŒ–ï¼Œå†™å…¥æ•°æ®åº“æˆ–åˆ«çš„æŒä¹…å±‚ã€‚å„ç§æœåŠ¡æ”¶åˆ°è¯·æ±‚åï¼Œéƒ½å‘æŒä¹…å±‚è¯·æ±‚æ•°æ®ã€‚è¿™ç§æ–¹æ¡ˆçš„ä¼˜ç‚¹æ˜¯æ¶æ„æ¸…æ™°ï¼Œç¼ºç‚¹æ˜¯å·¥ç¨‹é‡æ¯”è¾ƒå¤§ã€‚å¦å¤–ï¼ŒæŒä¹…å±‚ä¸‡ä¸€æŒ‚äº†ï¼Œå°±ä¼šå•ç‚¹å¤±è´¥ã€‚</p>
<p>å¦ä¸€ç§æ–¹æ¡ˆæ˜¯æœåŠ¡å™¨ç´¢æ€§ä¸ä¿å­˜ session æ•°æ®äº†ï¼Œæ‰€æœ‰æ•°æ®éƒ½ä¿å­˜åœ¨å®¢æˆ·ç«¯ï¼Œæ¯æ¬¡è¯·æ±‚éƒ½å‘å›æœåŠ¡å™¨ã€‚JWT å°±æ˜¯è¿™ç§æ–¹æ¡ˆçš„ä¸€ä¸ªä»£è¡¨ã€‚</p>
<h2 id="äºŒã€JWT-çš„åŸç†"><a href="#äºŒã€JWT-çš„åŸç†" class="headerlink" title="äºŒã€JWT çš„åŸç†"></a>äºŒã€JWT çš„åŸç†</h2><p>JWT çš„åŸç†æ˜¯ï¼ŒæœåŠ¡å™¨è®¤è¯ä»¥åï¼Œç”Ÿæˆä¸€ä¸ª JSON å¯¹è±¡ï¼Œå‘å›ç»™ç”¨æˆ·ï¼Œå°±åƒä¸‹é¢è¿™æ ·ã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JSON"><figure class="iseeu highlight /json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="attr">&quot;å§“å&quot;</span>: <span class="string">&quot;å¼ ä¸‰&quot;</span>,</span><br><span class="line"><span class="attr">&quot;è§’è‰²&quot;</span>: <span class="string">&quot;ç®¡ç†å‘˜&quot;</span>,</span><br><span class="line"><span class="attr">&quot;åˆ°æœŸæ—¶é—´&quot;</span>: <span class="string">&quot;2018å¹´7æœˆ1æ—¥0ç‚¹0åˆ†&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>ä»¥åï¼Œç”¨æˆ·ä¸æœåŠ¡ç«¯é€šä¿¡çš„æ—¶å€™ï¼Œéƒ½è¦å‘å›è¿™ä¸ª JSON å¯¹è±¡ã€‚æœåŠ¡å™¨å®Œå…¨åªé è¿™ä¸ªå¯¹è±¡è®¤å®šç”¨æˆ·èº«ä»½ã€‚ä¸ºäº†é˜²æ­¢ç”¨æˆ·ç¯¡æ”¹æ•°æ®ï¼ŒæœåŠ¡å™¨åœ¨ç”Ÿæˆè¿™ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œä¼šåŠ ä¸Šç­¾åï¼ˆè¯¦è§åæ–‡ï¼‰ã€‚</p>
<p>æœåŠ¡å™¨å°±ä¸ä¿å­˜ä»»ä½• session æ•°æ®äº†ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒæœåŠ¡å™¨å˜æˆæ— çŠ¶æ€äº†ï¼Œä»è€Œæ¯”è¾ƒå®¹æ˜“å®ç°æ‰©å±•ã€‚</p>
<h2 id="ä¸‰ã€JWT-çš„æ•°æ®ç»“æ„"><a href="#ä¸‰ã€JWT-çš„æ•°æ®ç»“æ„" class="headerlink" title="ä¸‰ã€JWT çš„æ•°æ®ç»“æ„"></a>ä¸‰ã€JWT çš„æ•°æ®ç»“æ„</h2><p>å®é™…çš„ JWT å¤§æ¦‚å°±åƒä¸‹é¢è¿™æ ·ã€‚</p>
<p><img src="/2022/07/18/uncatalog/cl5qf74ul000040r73q1jfruf/bg2018072304.jpg" alt="img"><br>å®ƒæ˜¯ä¸€ä¸ªå¾ˆé•¿çš„å­—ç¬¦ä¸²ï¼Œä¸­é—´ç”¨ç‚¹ï¼ˆ.ï¼‰åˆ†éš”æˆä¸‰ä¸ªéƒ¨åˆ†ã€‚æ³¨æ„ï¼ŒJWT å†…éƒ¨æ˜¯æ²¡æœ‰æ¢è¡Œçš„ï¼Œè¿™é‡Œåªæ˜¯ä¸ºäº†ä¾¿äºå±•ç¤ºï¼Œå°†å®ƒå†™æˆäº†å‡ è¡Œã€‚</p>
<p>JWT çš„ä¸‰ä¸ªéƒ¨åˆ†ä¾æ¬¡å¦‚ä¸‹ã€‚</p>
<ul>
<li>Headerï¼ˆå¤´éƒ¨ï¼‰</li>
<li>Payloadï¼ˆè´Ÿè½½ï¼‰</li>
<li>Signatureï¼ˆç­¾åï¼‰</li>
</ul>
<p>å†™æˆä¸€è¡Œï¼Œå°±æ˜¯ä¸‹é¢çš„æ ·å­ã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="TEXT"><figure class="iseeu highlight /text"><table><tr><td class="code"><pre><span class="line">Header.Payload.Signature</span><br></pre></td></tr></table></figure></div>
<p><img src="/2022/07/18/uncatalog/cl5qf74ul000040r73q1jfruf/bg2018072303.jpg" alt="img"><br>ä¸‹é¢ä¾æ¬¡ä»‹ç»è¿™ä¸‰ä¸ªéƒ¨åˆ†ã€‚</p>
<h3 id="3-1-Header"><a href="#3-1-Header" class="headerlink" title="3.1 Header"></a>3.1 Header</h3><p>Header éƒ¨åˆ†æ˜¯ä¸€ä¸ª JSON å¯¹è±¡ï¼Œæè¿° JWT çš„å…ƒæ•°æ®ï¼Œé€šå¸¸æ˜¯ä¸‹é¢çš„æ ·å­ã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JSON"><figure class="iseeu highlight /json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;alg&quot;</span>: <span class="string">&quot;HS256&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;typ&quot;</span>: <span class="string">&quot;JWT&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>
<p>ä¸Šé¢ä»£ç ä¸­ï¼Œalgå±æ€§è¡¨ç¤ºç­¾åçš„ç®—æ³•ï¼ˆalgorithmï¼‰ï¼Œé»˜è®¤æ˜¯ HMAC SHA256ï¼ˆå†™æˆ HS256ï¼‰ï¼›typå±æ€§è¡¨ç¤ºè¿™ä¸ªä»¤ç‰Œï¼ˆtokenï¼‰çš„ç±»å‹ï¼ˆtypeï¼‰ï¼ŒJWT ä»¤ç‰Œç»Ÿä¸€å†™ä¸ºJWTã€‚</p>
<p>æœ€åï¼Œå°†ä¸Šé¢çš„ JSON å¯¹è±¡ä½¿ç”¨ Base64URL ç®—æ³•ï¼ˆè¯¦è§åæ–‡ï¼‰è½¬æˆå­—ç¬¦ä¸²ã€‚</p>
<h3 id="3-2-Payload"><a href="#3-2-Payload" class="headerlink" title="3.2 Payload"></a>3.2 Payload</h3><p>Payload éƒ¨åˆ†ä¹Ÿæ˜¯ä¸€ä¸ª JSON å¯¹è±¡ï¼Œç”¨æ¥å­˜æ”¾å®é™…éœ€è¦ä¼ é€’çš„æ•°æ®ã€‚JWT è§„å®šäº†7ä¸ªå®˜æ–¹å­—æ®µï¼Œä¾›é€‰ç”¨ã€‚</p>
<ul>
<li>iss (issuer)ï¼šç­¾å‘äºº</li>
<li>exp (expiration time)ï¼šè¿‡æœŸæ—¶é—´</li>
<li>sub (subject)ï¼šä¸»é¢˜</li>
<li>aud (audience)ï¼šå—ä¼—</li>
<li>nbf (Not Before)ï¼šç”Ÿæ•ˆæ—¶é—´</li>
<li>iat (Issued At)ï¼šç­¾å‘æ—¶é—´</li>
<li>jti (JWT ID)ï¼šç¼–å·</li>
</ul>
<p>é™¤äº†å®˜æ–¹å­—æ®µï¼Œä½ è¿˜å¯ä»¥åœ¨è¿™ä¸ªéƒ¨åˆ†å®šä¹‰ç§æœ‰å­—æ®µï¼Œä¸‹é¢å°±æ˜¯ä¸€ä¸ªä¾‹å­ã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="JSON"><figure class="iseeu highlight /json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;sub&quot;</span>: <span class="string">&quot;1234567890&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;John Doe&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;admin&quot;</span>: <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div>

<p>æ³¨æ„ï¼ŒJWT é»˜è®¤æ˜¯ä¸åŠ å¯†çš„ï¼Œä»»ä½•äººéƒ½å¯ä»¥è¯»åˆ°ï¼Œæ‰€ä»¥ä¸è¦æŠŠç§˜å¯†ä¿¡æ¯æ”¾åœ¨è¿™ä¸ªéƒ¨åˆ†ã€‚</p>
<p>è¿™ä¸ª JSON å¯¹è±¡ä¹Ÿè¦ä½¿ç”¨ Base64URL ç®—æ³•è½¬æˆå­—ç¬¦ä¸²ã€‚</p>
<h3 id="3-3-Signature"><a href="#3-3-Signature" class="headerlink" title="3.3 Signature"></a>3.3 Signature</h3><p>Signature éƒ¨åˆ†æ˜¯å¯¹å‰ä¸¤éƒ¨åˆ†çš„ç­¾åï¼Œé˜²æ­¢æ•°æ®ç¯¡æ”¹ã€‚</p>
<p>é¦–å…ˆï¼Œéœ€è¦æŒ‡å®šä¸€ä¸ªå¯†é’¥ï¼ˆsecretï¼‰ã€‚è¿™ä¸ªå¯†é’¥åªæœ‰æœåŠ¡å™¨æ‰çŸ¥é“ï¼Œä¸èƒ½æ³„éœ²ç»™ç”¨æˆ·ã€‚ç„¶åï¼Œä½¿ç”¨ Header é‡Œé¢æŒ‡å®šçš„ç­¾åç®—æ³•ï¼ˆé»˜è®¤æ˜¯ HMAC SHA256ï¼‰ï¼ŒæŒ‰ç…§ä¸‹é¢çš„å…¬å¼äº§ç”Ÿç­¾åã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="TEXT"><figure class="iseeu highlight /text"><table><tr><td class="code"><pre><span class="line">HMACSHA256(</span><br><span class="line">  base64UrlEncode(header) + &quot;.&quot; +</span><br><span class="line">  base64UrlEncode(payload),</span><br><span class="line">  secret)</span><br></pre></td></tr></table></figure></div>

<p>ç®—å‡ºç­¾åä»¥åï¼ŒæŠŠ Headerã€Payloadã€Signature ä¸‰ä¸ªéƒ¨åˆ†æ‹¼æˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ¯ä¸ªéƒ¨åˆ†ä¹‹é—´ç”¨â€ç‚¹â€ï¼ˆ.ï¼‰åˆ†éš”ï¼Œå°±å¯ä»¥è¿”å›ç»™ç”¨æˆ·ã€‚</p>
<h3 id="3-4-Base64URL"><a href="#3-4-Base64URL" class="headerlink" title="3.4 Base64URL"></a>3.4 Base64URL</h3><p>å‰é¢æåˆ°ï¼ŒHeader å’Œ Payload ä¸²å‹åŒ–çš„ç®—æ³•æ˜¯ Base64URLã€‚è¿™ä¸ªç®—æ³•è·Ÿ Base64 ç®—æ³•åŸºæœ¬ç±»ä¼¼ï¼Œä½†æœ‰ä¸€äº›å°çš„ä¸åŒã€‚</p>
<p>JWT ä½œä¸ºä¸€ä¸ªä»¤ç‰Œï¼ˆtokenï¼‰ï¼Œæœ‰äº›åœºåˆå¯èƒ½ä¼šæ”¾åˆ° URLï¼ˆæ¯”å¦‚ api.example.com/?token=xxxï¼‰ã€‚Base64 æœ‰ä¸‰ä¸ªå­—ç¬¦+ã€/å’Œ=ï¼Œåœ¨ URL é‡Œé¢æœ‰ç‰¹æ®Šå«ä¹‰ï¼Œæ‰€ä»¥è¦è¢«æ›¿æ¢æ‰ï¼š=è¢«çœç•¥ã€+æ›¿æ¢æˆ-ï¼Œ/æ›¿æ¢æˆ_ ã€‚è¿™å°±æ˜¯ Base64URL ç®—æ³•ã€‚</p>
<h2 id="å››ã€JWT-çš„ä½¿ç”¨æ–¹å¼"><a href="#å››ã€JWT-çš„ä½¿ç”¨æ–¹å¼" class="headerlink" title="å››ã€JWT çš„ä½¿ç”¨æ–¹å¼"></a>å››ã€JWT çš„ä½¿ç”¨æ–¹å¼</h2><p>å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨è¿”å›çš„ JWTï¼Œå¯ä»¥å‚¨å­˜åœ¨ Cookie é‡Œé¢ï¼Œä¹Ÿå¯ä»¥å‚¨å­˜åœ¨ localStorageã€‚</p>
<p>æ­¤åï¼Œå®¢æˆ·ç«¯æ¯æ¬¡ä¸æœåŠ¡å™¨é€šä¿¡ï¼Œéƒ½è¦å¸¦ä¸Šè¿™ä¸ª JWTã€‚ä½ å¯ä»¥æŠŠå®ƒæ”¾åœ¨ Cookie é‡Œé¢è‡ªåŠ¨å‘é€ï¼Œä½†æ˜¯è¿™æ ·ä¸èƒ½è·¨åŸŸï¼Œæ‰€ä»¥æ›´å¥½çš„åšæ³•æ˜¯æ”¾åœ¨ HTTP è¯·æ±‚çš„å¤´ä¿¡æ¯Authorizationå­—æ®µé‡Œé¢ã€‚</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="TEXT"><figure class="iseeu highlight /text"><table><tr><td class="code"><pre><span class="line">Authorization: Bearer &lt;token&gt;</span><br></pre></td></tr></table></figure></div>
<p>å¦ä¸€ç§åšæ³•æ˜¯ï¼Œè·¨åŸŸçš„æ—¶å€™ï¼ŒJWT å°±æ”¾åœ¨ POST è¯·æ±‚çš„æ•°æ®ä½“é‡Œé¢ã€‚</p>
<h2 id="äº”ã€JWT-çš„å‡ ä¸ªç‰¹ç‚¹"><a href="#äº”ã€JWT-çš„å‡ ä¸ªç‰¹ç‚¹" class="headerlink" title="äº”ã€JWT çš„å‡ ä¸ªç‰¹ç‚¹"></a>äº”ã€JWT çš„å‡ ä¸ªç‰¹ç‚¹</h2><p>ï¼ˆ1ï¼‰JWT é»˜è®¤æ˜¯ä¸åŠ å¯†ï¼Œä½†ä¹Ÿæ˜¯å¯ä»¥åŠ å¯†çš„ã€‚ç”ŸæˆåŸå§‹ Token ä»¥åï¼Œå¯ä»¥ç”¨å¯†é’¥å†åŠ å¯†ä¸€æ¬¡ã€‚</p>
<p>ï¼ˆ2ï¼‰JWT ä¸åŠ å¯†çš„æƒ…å†µä¸‹ï¼Œä¸èƒ½å°†ç§˜å¯†æ•°æ®å†™å…¥ JWTã€‚</p>
<p>ï¼ˆ3ï¼‰JWT ä¸ä»…å¯ä»¥ç”¨äºè®¤è¯ï¼Œä¹Ÿå¯ä»¥ç”¨äºäº¤æ¢ä¿¡æ¯ã€‚æœ‰æ•ˆä½¿ç”¨ JWTï¼Œå¯ä»¥é™ä½æœåŠ¡å™¨æŸ¥è¯¢æ•°æ®åº“çš„æ¬¡æ•°ã€‚</p>
<p>ï¼ˆ4ï¼‰JWT çš„æœ€å¤§ç¼ºç‚¹æ˜¯ï¼Œç”±äºæœåŠ¡å™¨ä¸ä¿å­˜ session çŠ¶æ€ï¼Œå› æ­¤æ— æ³•åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­åºŸæ­¢æŸä¸ª tokenï¼Œæˆ–è€…æ›´æ”¹ token çš„æƒé™ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€æ—¦ JWT ç­¾å‘äº†ï¼Œåœ¨åˆ°æœŸä¹‹å‰å°±ä¼šå§‹ç»ˆæœ‰æ•ˆï¼Œé™¤éæœåŠ¡å™¨éƒ¨ç½²é¢å¤–çš„é€»è¾‘ã€‚</p>
<p>ï¼ˆ5ï¼‰JWT æœ¬èº«åŒ…å«äº†è®¤è¯ä¿¡æ¯ï¼Œä¸€æ—¦æ³„éœ²ï¼Œä»»ä½•äººéƒ½å¯ä»¥è·å¾—è¯¥ä»¤ç‰Œçš„æ‰€æœ‰æƒé™ã€‚ä¸ºäº†å‡å°‘ç›—ç”¨ï¼ŒJWT çš„æœ‰æ•ˆæœŸåº”è¯¥è®¾ç½®å¾—æ¯”è¾ƒçŸ­ã€‚å¯¹äºä¸€äº›æ¯”è¾ƒé‡è¦çš„æƒé™ï¼Œä½¿ç”¨æ—¶åº”è¯¥å†æ¬¡å¯¹ç”¨æˆ·è¿›è¡Œè®¤è¯ã€‚</p>
<p>ï¼ˆ6ï¼‰ä¸ºäº†å‡å°‘ç›—ç”¨ï¼ŒJWT ä¸åº”è¯¥ä½¿ç”¨ HTTP åè®®æ˜ç ä¼ è¾“ï¼Œè¦ä½¿ç”¨ HTTPS åè®®ä¼ è¾“ã€‚</p>
]]></content>
      <tags>
        <tag>æ¶æ„è®¾è®¡é‚£äº›äº‹å„¿</tag>
      </tags>
  </entry>
  <entry>
    <title>ç©è½¬gitä¸‰å‰‘å®¢</title>
    <url>/2022/09/05/uncatalog/cl7oebs5q0000f0r7e0oq9fnk/</url>
    <content><![CDATA[<hr>
<span id="more"></span>

<h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>å®˜æ–¹å®‰è£…åŒ…ä¸‹è½½åœ°å€:<a href="https://git-scm.com/download/win">https://git-scm.com/download/win</a><br>éªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git --version</span></span><br><span class="line">git version 2.37.3.windows.1</span><br></pre></td></tr></table></figure></div>

<p>(å»ºè®®ä½¿ç”¨æ¯”è¾ƒé«˜çš„ç‰ˆæœ¬ï¼Œæ—§ç‰ˆæœ¬å¯èƒ½ä¼šåœ¨<code>git log --all</code>è¿™äº›ç»“æœå±•ç¤ºä¸Šæœ‰äº›ä¸å¤ªå‹å¥½çš„å·®å¼‚)</p>
<h2 id="gitä½¿ç”¨ä¹‹å‰è¦åšçš„æœ€å°é…ç½®"><a href="#gitä½¿ç”¨ä¹‹å‰è¦åšçš„æœ€å°é…ç½®" class="headerlink" title="gitä½¿ç”¨ä¹‹å‰è¦åšçš„æœ€å°é…ç½®"></a>gitä½¿ç”¨ä¹‹å‰è¦åšçš„æœ€å°é…ç½®</h2><ol>
<li>é…ç½®å…¨å±€ç”¨æˆ·ä¿¡æ¯</li>
</ol>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">git config --global user.name &#x27;your_name&#x27;</span><br><span class="line">git config --global user.email &#x27;your_email@domain.com&#x27;</span><br></pre></td></tr></table></figure></div>

<ol start="2">
<li>é…ç½®æŸä¸ªgitä»“åº“çš„ç”¨æˆ·ä¿¡æ¯</li>
</ol>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">git config --local user.name &#x27;your_name&#x27;</span><br><span class="line">git config --local user.email &#x27;your_email@domain.com&#x27;</span><br></pre></td></tr></table></figure></div>

<ol start="3">
<li>configçš„ä¸‰ä¸ªä½œç”¨åŸŸ(ä¼˜å…ˆçº§ä»é«˜åˆ°ä½)</li>
</ol>
<table>
<thead>
<tr>
<th>ä½œç”¨åŸŸ</th>
<th>ç”¨æ³•</th>
<th>æ•ˆæœ</th>
</tr>
</thead>
<tbody><tr>
<td>local</td>
<td>git config â€“local</td>
<td>åªå¯¹æŸä¸ªä»“åº“æœ‰æ•ˆ</td>
</tr>
<tr>
<td>global</td>
<td>git config â€“global</td>
<td>å¯¹å½“å‰ç”¨æˆ·æ‰€æœ‰ä»“åº“æœ‰æ•ˆ</td>
</tr>
<tr>
<td>system</td>
<td>git config â€“system</td>
<td>å¯¹ç³»ç»Ÿæ‰€æœ‰ç™»å½•çš„ç”¨æˆ·æœ‰æ•ˆ</td>
</tr>
<tr>
<td>4. æŸ¥çœ‹gité…ç½®</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">git config --list --local</span><br><span class="line">git config --list --global</span><br><span class="line">git config --list --system</span><br></pre></td></tr></table></figure></div>

<h2 id="gité¡¹ç›®åˆå§‹åŒ–"><a href="#gité¡¹ç›®åˆå§‹åŒ–" class="headerlink" title="gité¡¹ç›®åˆå§‹åŒ–"></a>gité¡¹ç›®åˆå§‹åŒ–</h2><ol>
<li>æŠŠå·²æœ‰çš„é¡¹ç›®ä»£ç çº³å…¥gitç®¡ç†</li>
</ol>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">cd é¡¹ç›®ä»£ç æ‰€åœ¨æ–‡ä»¶å¤¹</span><br><span class="line">git init</span><br></pre></td></tr></table></figure></div>

<ol start="2">
<li>æ–°å»ºçš„é¡¹ç›®ç›´æ¥ç”¨gitç®¡ç†</li>
</ol>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">cd æŸä¸ªæ–‡ä»¶å¤¹</span><br><span class="line">git init your_project_name # ä¼šè‡ªåŠ¨åˆ›å»ºæ–‡ä»¶å¤¹</span><br><span class="line">cd your_project_name</span><br></pre></td></tr></table></figure></div>

<h2 id="äº†è§£å·¥ä½œåŒºå’Œæš‚å­˜åŒº"><a href="#äº†è§£å·¥ä½œåŒºå’Œæš‚å­˜åŒº" class="headerlink" title="äº†è§£å·¥ä½œåŒºå’Œæš‚å­˜åŒº"></a>äº†è§£å·¥ä½œåŒºå’Œæš‚å­˜åŒº</h2><p><img src="/2022/09/05/uncatalog/cl7oebs5q0000f0r7e0oq9fnk/add.jpg"></p>
<h2 id="é€šè¿‡git-logæŸ¥çœ‹ç‰ˆæœ¬æ¼”å˜å†å²"><a href="#é€šè¿‡git-logæŸ¥çœ‹ç‰ˆæœ¬æ¼”å˜å†å²" class="headerlink" title="é€šè¿‡git logæŸ¥çœ‹ç‰ˆæœ¬æ¼”å˜å†å²"></a>é€šè¿‡<code>git log</code>æŸ¥çœ‹ç‰ˆæœ¬æ¼”å˜å†å²</h2><ol>
<li>åŸºæœ¬å‘½ä»¤<code>git log</code></li>
</ol>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">log</span></span></span><br><span class="line">commit a0b98ea6769a71901895c5f879b4b23383ba6bcd</span><br><span class="line">Author: xxx</span><br><span class="line">Date:   Wed Sep 7 11:20:39 xxx</span><br><span class="line"></span><br><span class="line">    Move readme.md to readme</span><br><span class="line"></span><br><span class="line">commit 63ca73303c196401d6f0312186a11d517c51f749</span><br><span class="line">Author: xxx</span><br><span class="line">Date:   Tue Sep 6 11:10:01 xxx</span><br><span class="line"></span><br><span class="line">    Add refering projects</span><br><span class="line"></span><br><span class="line">commit f77ad615d0a091ac22f78f892c4d50077b43096a</span><br><span class="line">Author: xxx</span><br><span class="line">Date:   Tue Sep 6 11:01:34 xxx</span><br><span class="line"></span><br><span class="line">    Add js</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<ol start="2">
<li>ç®€æ´å‘½ä»¤å‘½ä»¤<code>git log</code>ã€‚(è¿™æ¡å‘½ä»¤å¯ä»¥å¸®åŠ©ä½ ä»¥ç®€æ´çš„æ–¹å¼æŸ¥çœ‹æäº¤è®°å½•ã€‚å®ƒæŠŠæäº¤è®°å½•æµ“ç¼©åœ¨äº†ä¸€è¡Œï¼Œè€Œä¸”åªä¿ç•™ç±»ä¼¼è¾ƒçŸ­çš„æäº¤å“ˆå¸Œå€¼å’Œæäº¤ä¿¡æ¯)</li>
</ol>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">log</span> --oneline</span></span><br><span class="line">a0b98ea Move readme.md to readme</span><br><span class="line">63ca733 Add refering projects</span><br><span class="line">f77ad61 Add js</span><br></pre></td></tr></table></figure></div>

<ol start="3">
<li>æŸ¥çœ‹æŒ‡å®šçš„æœ€è¿‘mä¸ªcommitï¼Œåœ¨ä¸Šé¢çš„ä¸¤ä¸ªå‘½ä»¤é‡Œé¢æ·»åŠ  <code>-nm</code>å³å¯</li>
</ol>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">æœ€è¿‘çš„å››æ¬¡æäº¤</span> </span><br><span class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">log</span> -n4</span> </span><br><span class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">log</span> -n4 --oneline</span></span><br></pre></td></tr></table></figure></div>

<ol start="4">
<li>å›¾å½¢åŒ–æŸ¥çœ‹å„ä¸ªåˆ†æ”¯çš„<code>git log</code></li>
</ol>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">log</span> --all --graph</span></span><br><span class="line">* commit fee6bacc33f975bdb0f9ecd7edc7db5acd5429de (HEAD -&gt; main)</span><br><span class="line">| Author: BugKillerPro &lt;511808895@qq.com&gt;</span><br><span class="line">| Date:   Wed Sep 7 15:05:37 2022 +0800</span><br><span class="line">|</span><br><span class="line">|     Modify style.css on branch main</span><br><span class="line">|</span><br><span class="line">| * commit 97b461a6abd2c7700cc063b5795ec192d6d7d1c3 (tmp)</span><br><span class="line">|/  Author: BugKillerPro &lt;511808895@qq.com&gt;</span><br><span class="line">|   Date:   Wed Sep 7 14:46:59 2022 +0800</span><br><span class="line">|</span><br><span class="line">|       Add test to branch tmp</span><br><span class="line">|</span><br><span class="line">* commit a0b98ea6769a71901895c5f879b4b23383ba6bcd</span><br><span class="line">| Author: BugKillerPro &lt;511808895@qq.com&gt;</span><br><span class="line">| Date:   Wed Sep 7 11:20:39 2022 +0800</span><br><span class="line">|</span><br><span class="line">|     Move readme.md to readme</span><br><span class="line">|</span><br><span class="line">* commit 63ca73303c196401d6f0312186a11d517c51f749</span><br><span class="line">| Author: BugKillerPro &lt;511808895@qq.com&gt;</span><br><span class="line">| Date:   Tue Sep 6 11:10:01 2022 +0800</span><br><span class="line">|</span><br><span class="line">|     Add refering projects</span><br><span class="line">|</span><br><span class="line">* commit f77ad615d0a091ac22f78f892c4d50077b43096a (tag: js01)</span><br><span class="line">| Author: BugKillerPro &lt;511808895@qq.com&gt;</span><br><span class="line">| Date:   Tue Sep 6 11:01:34 2022 +0800</span><br><span class="line">|</span><br><span class="line">|     Add js</span><br><span class="line">|</span><br><span class="line">* commit 78be6970adb1671a56e4536b7ea2170a4aa0a7cf</span><br><span class="line">| Author: BugKillerPro &lt;511808895@qq.com&gt;</span><br><span class="line">| Date:   Tue Sep 6 10:59:30 2022 +0800</span><br><span class="line">|</span><br><span class="line">|     Add style.css</span><br><span class="line">|</span><br><span class="line">* commit f51e1172b2dca4aea588ec756f630f5ad803212d</span><br><span class="line">| Author: BugKillerPro &lt;511808895@qq.com&gt;</span><br><span class="line">| Date:   Tue Sep 6 10:55:52 2022 +0800</span><br><span class="line">|</span><br><span class="line">|     Add index _ log</span><br><span class="line">|</span><br><span class="line">* commit 97ad72879455e51a3529a52806f2ec07f67bc8bd (origin/main, origin/HEAD)</span><br><span class="line">  Author: bugmakerprox &lt;112847253+bugmakerprox@users.noreply.github.com&gt;</span><br><span class="line">  Date:   Mon Sep 5 14:02:11 2022 +0800</span><br><span class="line"></span><br><span class="line">      Initial commit</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>åŒæ ·ä¹Ÿå¯ä»¥åŠ ä¸Š<code>--oneline</code>æŸ¥çœ‹ç®€æ´åŒ–çš„logï¼Œä¹Ÿå¯ä»¥åŠ ä¸Š<code>-nm</code>ï¼ŒæŸ¥çœ‹æ‰€æœ‰åˆ†æ”¯çš„æœ€è¿‘mæ¡log</p>
<h2 id="é€šè¿‡å›¾å½¢åŒ–ç•Œé¢å·¥å…·æŸ¥çœ‹ç‰ˆæœ¬æ¼”å˜å†å²"><a href="#é€šè¿‡å›¾å½¢åŒ–ç•Œé¢å·¥å…·æŸ¥çœ‹ç‰ˆæœ¬æ¼”å˜å†å²" class="headerlink" title="é€šè¿‡å›¾å½¢åŒ–ç•Œé¢å·¥å…·æŸ¥çœ‹ç‰ˆæœ¬æ¼”å˜å†å²"></a>é€šè¿‡å›¾å½¢åŒ–ç•Œé¢å·¥å…·æŸ¥çœ‹ç‰ˆæœ¬æ¼”å˜å†å²</h2><p>è¾“å…¥<code>gitk</code>å‘½ä»¤ï¼Œä¼šå¼¹å‡ºå›¾å½¢åŒ–å·¥å…·ç•Œé¢</p>
<h2 id="æ¢ç§˜-gitæ–‡ä»¶å¤¹"><a href="#æ¢ç§˜-gitæ–‡ä»¶å¤¹" class="headerlink" title="æ¢ç§˜.gitæ–‡ä»¶å¤¹"></a>æ¢ç§˜<code>.git</code>æ–‡ä»¶å¤¹</h2><ol>
<li>æŸ¥çœ‹æ‰€æœ‰æ–‡ä»¶</li>
</ol>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ls -al</span></span><br><span class="line">drwxr-xr-x  7 root root 222 9æœˆ   7 15:30 .</span><br><span class="line">drwxr-xr-x  3 root root  18 9æœˆ   7 16:26 ..</span><br><span class="line">-rw-r--r--  1 root root  32 9æœˆ   7 15:05 COMMIT_EDITMSG</span><br><span class="line">-rw-r--r--  1 root root 360 9æœˆ   7 14:44 config</span><br><span class="line">-rw-r--r--  1 root root  73 9æœˆ   5 14:04 description</span><br><span class="line">-rw-r--r--  1 root root 103 9æœˆ   7 10:54 FETCH_HEAD</span><br><span class="line">-rw-r--r--  1 root root 546 9æœˆ   7 15:30 gitk.cache</span><br><span class="line">-rw-r--r--  1 root root  21 9æœˆ   7 14:52 HEAD</span><br><span class="line">drwxr-xr-x  2 root root 268 9æœˆ   5 14:04 hooks</span><br><span class="line">-rw-r--r--  1 root root 554 9æœˆ   7 15:05 index</span><br><span class="line">drwxr-xr-x  2 root root  21 9æœˆ   5 14:04 info</span><br><span class="line">drwxr-xr-x  3 root root  30 9æœˆ   5 14:04 logs</span><br><span class="line">drwxr-xr-x 32 root root 310 9æœˆ   7 16:03 objects</span><br><span class="line">-rw-r--r--  1 root root  41 9æœˆ   7 10:59 ORIG_HEAD</span><br><span class="line">-rw-r--r--  1 root root 105 9æœˆ   5 14:04 packed-refs</span><br><span class="line">drwxr-xr-x  5 root root  46 9æœˆ   5 14:04 refs</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<ol start="2">
<li>å‡ ä¸ªæ–‡ä»¶çš„è¯´æ˜</li>
</ol>
<p>2.1 <code>refs/</code>æ–‡ä»¶å¤¹</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> tree refs</span></span><br><span class="line">refs/</span><br><span class="line">â”œâ”€â”€ heads</span><br><span class="line">â”‚ â”œâ”€â”€ main</span><br><span class="line">â”‚ â””â”€â”€ tmp</span><br><span class="line">â”œâ”€â”€ remotes</span><br><span class="line">â”‚ â””â”€â”€ origin</span><br><span class="line">â”‚     â””â”€â”€ HEAD</span><br><span class="line">â””â”€â”€ tags</span><br><span class="line">    â””â”€â”€ js01</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>2.1.1  <code>heads</code>æ–‡ä»¶å¤¹â€“ ä»“åº“çš„åˆ†æ”¯æƒ…å†µ</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> cat main</span></span><br><span class="line">fee6bacc33f975bdb0f9ecd7edc7db5acd5429de</span><br><span class="line"><span class="meta">$</span><span class="bash"> cat tmp</span></span><br><span class="line">97b461a6abd2c7700cc063b5795ec192d6d7d1c3</span><br></pre></td></tr></table></figure></div>

<p>é€šè¿‡å¯¹æ¯”ä¸Šé¢è®²åˆ°çš„â€œå›¾å½¢åŒ–æŸ¥çœ‹å„ä¸ªåˆ†æ”¯â€ï¼Œå¯ä»¥å‘ç°ï¼Œ<code>main</code>å’Œ<code>tmp</code>æ–‡ä»¶é‡Œå­˜æ”¾çš„åˆ†åˆ«æ˜¯è¿™ä¸¤ä¸ªåˆ†æ”¯å½“å‰æŒ‡å‘çš„<code>commit</code>ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ªåˆ†æ”¯çš„æœ€åä¸€ä¸ª<code>commit</code>ã€‚<br>å¦å¤–ï¼Œå¯ä»¥é€šè¿‡<code>git cat-file -t</code>æŸ¥çœ‹å¯¹è±¡çš„ä¿¡æ¯ï¼Œå…³äº<code>git cat-file</code>çš„ç”¨æ³•ï¼Œè¯¦è§<a href="https://cloud.tencent.com/developer/section/1138770">cat-file</a></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git cat-file -t fee6bacc33f975bdb0f9ecd7edc7db5acd5429de</span></span><br><span class="line">commit</span><br></pre></td></tr></table></figure></div>

<p>æ‰€ä»¥ï¼Œ<code>refs/heads/</code>ç›®å½•ä¸‹çš„æ–‡ä»¶å†…å®¹æ˜¯<code>commit</code>å¯¹è±¡ä¿¡æ¯ã€‚</p>
<p>2.1.2 <code>tags</code> æ–‡ä»¶å¤¹ â€“ ä»“åº“çš„tagä¿¡æ¯</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> cat tags/js01</span></span><br><span class="line">db9cd1f2ba810d45ab0c214326ad50fc026dd65d</span><br></pre></td></tr></table></figure></div>

<p>åŒæ ·ï¼Œé€šè¿‡<code>git cat-file -t</code>æŸ¥çœ‹å¯¹è±¡ä¿¡æ¯</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git cat-file -t db9cd1f2ba810d45ab0c214326ad50fc026dd65d</span></span><br><span class="line">tag</span><br></pre></td></tr></table></figure></div>

<p>æ‰€ä»¥ï¼Œ<code>refs/tags/</code>ç›®å½•ä¸‹çš„æ–‡ä»¶å†…å®¹æ˜¯<code>tag</code>å¯¹è±¡ä¿¡æ¯ï¼Œå†é€šè¿‡<code>git cat-file -p</code>æŸ¥çœ‹ä¸€ä¸‹è¯¦ç»†ä¿¡æ¯</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git cat-file -p db9cd1f2ba810d45ab0c214326ad50fc026dd65d</span></span><br><span class="line">object f77ad615d0a091ac22f78f892c4d50077b43096a</span><br><span class="line">type commit</span><br><span class="line">tag js01</span><br><span class="line">tagger xxx &lt;email&gt; 1662537810 +0800</span><br><span class="line"></span><br><span class="line">js01</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> git cat-file -t f77ad615d0a091ac22f78f892c4d50077b43096a</span></span><br><span class="line">commit</span><br></pre></td></tr></table></figure></div>

<p>å¯ä»¥çœ‹å‡ºï¼Œ<code>js01</code>è¿™ä¸ªtagæ˜¯æ‰“åœ¨<code>f77ad615d0a091ac22f78f892c4d50077b43096a</code>è¿™æ¬¡<code>commit</code>ä¸Šçš„ï¼Œå’Œä¸Šé¢â€œå›¾å½¢åŒ–æŸ¥çœ‹å„ä¸ªåˆ†æ”¯â€çœ‹åˆ°çš„ä¿¡æ¯ä¸€è‡´ã€‚</p>
<p>2.2 <code>HEAD</code>æ–‡ä»¶<br>è¡¨ç¤ºå½“å‰ä»“åº“å·¥ä½œæ‰€åœ¨çš„åˆ†æ”¯ï¼Œæ–‡ä»¶å†…å®¹<code>ref: refs/heads/main</code> ï¼ŒæŒ‡å‘refs/headsä¸‹çš„åˆ†æ”¯æ–‡ä»¶</p>
<p>2.3 <code>config</code>æ–‡ä»¶<br>è¡¨ç¤ºå’Œæœ¬åœ°ä»“åº“ç›¸å…³çš„é…ç½®ä¿¡æ¯ï¼Œlocalä½œç”¨åŸŸçš„ä¿¡æ¯ä¼šå†™åœ¨è¿™é‡Œé¢ï¼›åŒæ ·ï¼Œç¼–è¾‘è¯¥æ–‡ä»¶ï¼Œä¿¡æ¯ä¹Ÿå¯ä»¥ä»<code>git config --local --list</code>çœ‹åˆ°</p>
<p>2.4 <code>objects</code>æ–‡ä»¶å¤¹</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> tree objects</span></span><br><span class="line">objects/</span><br><span class="line">â”œâ”€â”€ 06</span><br><span class="line">â”‚Â Â  â””â”€â”€ cdcb31ac08c3da684741bd9e576d806c02c509</span><br><span class="line">â”œâ”€â”€ 17</span><br><span class="line">â”‚Â Â  â””â”€â”€ 3e0e863d31a6977e6bea2f5433172c302c7827</span><br><span class="line">â”œâ”€â”€ 2c</span><br><span class="line">â”‚Â Â  â””â”€â”€ 8d044b64097ced0e003b9bded8ed5397767080</span><br><span class="line">â”œâ”€â”€ 2e</span><br><span class="line">â”‚Â Â  â””â”€â”€ a71f7370e32c9ab44a475cccbc289f65b2c11d</span><br><span class="line">â”œâ”€â”€ 37</span><br><span class="line">â”‚Â Â  â””â”€â”€ 809d45bb8f6e7699bc3216a4529b965831280f</span><br><span class="line">â”œâ”€â”€ 50</span><br><span class="line">â”‚Â Â  â””â”€â”€ b9f19afa5ffe2199377d70208207e692417f9d</span><br><span class="line">â”œâ”€â”€ 63</span><br><span class="line">â”‚Â Â  â””â”€â”€ ca73303c196401d6f0312186a11d517c51f749</span><br><span class="line">â”œâ”€â”€ 6a</span><br><span class="line">â”‚Â Â  â””â”€â”€ d4c68d567a1a5b415dcfce2010fce1a60b245f</span><br><span class="line">â”œâ”€â”€ 74</span><br><span class="line">â”‚Â Â  â””â”€â”€ ce54a5c285bebca10869bfde5a61183f37960d</span><br><span class="line">â”œâ”€â”€ 78</span><br><span class="line">â”‚Â Â  â””â”€â”€ be6970adb1671a56e4536b7ea2170a4aa0a7cf</span><br><span class="line">â”œâ”€â”€ 7c</span><br><span class="line">â”‚Â Â  â””â”€â”€ fe3376c0cc252bed22271480b06b642f960f48</span><br><span class="line">â”œâ”€â”€ 87</span><br><span class="line">â”‚Â Â  â””â”€â”€ b3e92f70e7dfa555f141afeae28a2bc4a343b6</span><br><span class="line">â”œâ”€â”€ 96</span><br><span class="line">â”‚Â Â  â””â”€â”€ b67e399c8496ec36cbbbcb776eb924fad7f9a7</span><br><span class="line">â”œâ”€â”€ 97</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ ad72879455e51a3529a52806f2ec07f67bc8bd</span><br><span class="line">â”‚Â Â  â””â”€â”€ b461a6abd2c7700cc063b5795ec192d6d7d1c3</span><br><span class="line">â”œâ”€â”€ a0</span><br><span class="line">â”‚Â Â  â””â”€â”€ b98ea6769a71901895c5f879b4b23383ba6bcd</span><br><span class="line">â”œâ”€â”€ a3</span><br><span class="line">â”‚Â Â  â””â”€â”€ 461553e40ba4259a40287239b5c38fb2fb76a7</span><br><span class="line">â”œâ”€â”€ ab</span><br><span class="line">â”‚Â Â  â””â”€â”€ 80565b73e7d2f0a2b5b9667c0b3470238b0fc0</span><br><span class="line">â”œâ”€â”€ ac</span><br><span class="line">â”‚Â Â  â””â”€â”€ c1c738d00c0c937ce5d630ef096199f8d8d73f</span><br><span class="line">â”œâ”€â”€ ae</span><br><span class="line">â”‚Â Â  â””â”€â”€ e37060401d19e7bd9f80b7b33920a000e96b5b</span><br><span class="line">â”œâ”€â”€ b0</span><br><span class="line">â”‚Â Â  â””â”€â”€ eb6f806441b634f3591e7e3abd87a7754d305a</span><br><span class="line">â”œâ”€â”€ cc</span><br><span class="line">â”‚Â Â  â””â”€â”€ b7b203933b7f1065b3a338eb321ba55112912f</span><br><span class="line">â”œâ”€â”€ d6</span><br><span class="line">â”‚Â Â  â””â”€â”€ 5a3bef25228c256c49b2ddf5bac2f367cb75f9</span><br><span class="line">â”œâ”€â”€ da</span><br><span class="line">â”‚Â Â  â””â”€â”€ f480669aa9256fa18b5c28e467af816f16482d</span><br><span class="line">â”œâ”€â”€ db</span><br><span class="line">â”‚Â Â  â””â”€â”€ 9cd1f2ba810d45ab0c214326ad50fc026dd65d</span><br><span class="line">â”œâ”€â”€ ef</span><br><span class="line">â”‚Â Â  â”œâ”€â”€ 3f137d8af338a8604544a3e482090684321d93</span><br><span class="line">â”‚Â Â  â””â”€â”€ b66cbd5ffbfe9578e4aaf7629402a9d943205a</span><br><span class="line">â”œâ”€â”€ f5</span><br><span class="line">â”‚Â Â  â””â”€â”€ 1e1172b2dca4aea588ec756f630f5ad803212d</span><br><span class="line">â”œâ”€â”€ f7</span><br><span class="line">â”‚Â Â  â””â”€â”€ 7ad615d0a091ac22f78f892c4d50077b43096a</span><br><span class="line">â”œâ”€â”€ fe</span><br><span class="line">â”‚Â Â  â””â”€â”€ e6bacc33f975bdb0f9ecd7edc7db5acd5429de</span><br><span class="line">â”œâ”€â”€ info</span><br><span class="line">â””â”€â”€ pack</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>è¯¦è§<a href="https://git-scm.com/book/zh/v2/Git-%E5%86%85%E9%83%A8%E5%8E%9F%E7%90%86-Git-%E5%AF%B9%E8%B1%A1">Git å†…éƒ¨åŸç† - Git å¯¹è±¡</a></p>
<h2 id="commitã€treeå’Œblobä¸‰ä¸ªå¯¹è±¡ä¹‹é—´çš„å…³ç³»"><a href="#commitã€treeå’Œblobä¸‰ä¸ªå¯¹è±¡ä¹‹é—´çš„å…³ç³»" class="headerlink" title="commitã€treeå’Œblobä¸‰ä¸ªå¯¹è±¡ä¹‹é—´çš„å…³ç³»"></a>commitã€treeå’Œblobä¸‰ä¸ªå¯¹è±¡ä¹‹é—´çš„å…³ç³»</h2><blockquote>
<p>äº†è§£<br><img src="/2022/09/05/uncatalog/cl7oebs5q0000f0r7e0oq9fnk/12.png" alt="12"></p>
</blockquote>
<h2 id="åˆ†ç¦»å¤´æŒ‡é’ˆ-detached-HEAD-æƒ…å†µä¸‹çš„æ³¨æ„äº‹é¡¹"><a href="#åˆ†ç¦»å¤´æŒ‡é’ˆ-detached-HEAD-æƒ…å†µä¸‹çš„æ³¨æ„äº‹é¡¹" class="headerlink" title="åˆ†ç¦»å¤´æŒ‡é’ˆ(detached HEAD)æƒ…å†µä¸‹çš„æ³¨æ„äº‹é¡¹"></a>åˆ†ç¦»å¤´æŒ‡é’ˆ(detached HEAD)æƒ…å†µä¸‹çš„æ³¨æ„äº‹é¡¹</h2><p>å¸¸è§äº§ç”Ÿåˆ†ç¦»å¤´æŒ‡é’ˆçš„æƒ…å†µï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">log</span> --all --graph --oneline</span></span><br><span class="line">* fee6bac (HEAD -&gt; main) Modify style.css on branch main</span><br><span class="line">| * 97b461a (tmp) Add test to branch tmp</span><br><span class="line">|/</span><br><span class="line">* a0b98ea Move readme.md to readme</span><br><span class="line">* 63ca733 Add refering projects</span><br><span class="line">* f77ad61 (tag: js01) Add js</span><br><span class="line">* 78be697 Add style.css</span><br><span class="line">* f51e117 Add index _ log</span><br><span class="line">* 97ad728 (origin/main, origin/HEAD) Initial commit</span><br><span class="line"></span><br><span class="line">jw.xu@hz-jw-xu-n MINGW64 /d/github/gitPractice (main)</span><br><span class="line"><span class="meta">$</span><span class="bash"> git checkout 78be697 <span class="comment"># è¯¥æ“ä½œä¼šäº§ç”Ÿåˆ†ç¦»å¤´æŒ‡é’ˆç°è±¡</span></span></span><br><span class="line">Note: switching to &#x27;78be697&#x27;.</span><br><span class="line"></span><br><span class="line">You are in &#x27;detached HEAD&#x27; state. You can look around, make experimental</span><br><span class="line">changes and commit them, and you can discard any commits you make in this</span><br><span class="line">state without impacting any branches by switching back to a branch.</span><br><span class="line"></span><br><span class="line">If you want to create a new branch to retain commits you create, you may</span><br><span class="line">do so (now or later) by using -c with the switch command. Example:</span><br><span class="line"></span><br><span class="line">  git switch -c &lt;new-branch-name&gt;</span><br><span class="line"></span><br><span class="line">Or undo this operation with:</span><br><span class="line"></span><br><span class="line">  git switch -</span><br><span class="line"></span><br><span class="line">Turn off this advice by setting config variable advice.detachedHead to false</span><br><span class="line"></span><br><span class="line">HEAD is now at 78be697 Add style.css</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">log</span> --all --graph --oneline</span></span><br><span class="line">* fee6bac (main) Modify style.css on branch main</span><br><span class="line">| * 97b461a (tmp) Add test to branch tmp</span><br><span class="line">|/</span><br><span class="line">* a0b98ea Move readme.md to readme</span><br><span class="line">* 63ca733 Add refering projects</span><br><span class="line">* f77ad61 (tag: js01) Add js</span><br><span class="line">* 78be697 (HEAD) Add style.css</span><br><span class="line">* f51e117 Add index _ log</span><br><span class="line">* 97ad728 (origin/main, origin/HEAD) Initial commit</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>åˆ†ç¦»å¤´æŒ‡é’ˆæ˜¯æŒ‡å½“å‰æ­£åœ¨å·¥ä½œåœ¨ä¸€ä¸ªæ²¡æœ‰åˆ†æ”¯çš„çŠ¶æ€ä¸‹ï¼Œå³æ²¡æœ‰æŒ‡å‘ä»»ä½•<code>branch</code>ã€‚å¦‚æœåœ¨è¿™ç§æƒ…å†µä¸‹åšäº†å˜æ›´ï¼Œç„¶ååˆåˆ‡æ¢åˆ°å…¶ä»–åˆ†æ”¯ï¼Œå˜æ›´å°†è¢«æ¸…ç†æ‰ã€‚<br>å½“ç„¶ï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨å¥½åˆ†ç¦»å¤´æŒ‡é’ˆè¿™ä¸ªç‰¹æ€§ï¼Œæ¯”å¦‚æˆ‘ä»¬ä»…ä»…éœ€è¦åœ¨æŸä¸ªcommitä¸Šåšä¸€äº›å°è¯•ä»£ç ï¼Œå¹¶ä¸éœ€è¦è®°å½•å’Œæäº¤ï¼Œå°è¯•å®Œä¹‹åï¼Œç›´æ¥åˆ‡æ¢åˆ°å…¶ä»–åˆ†æ”¯å³å¯ï¼Œå°è¯•ä»£ç ä¼šè¢«æ¸…ç†æ‰ã€‚<br>å¦‚æœåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåšäº†å˜æ›´ï¼Œåˆåšäº†commitï¼Œåˆ™ä¼šå‡ºç°ä»¥ä¸‹æƒ…å†µ:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git status</span></span><br><span class="line">HEAD detached at 78be697</span><br><span class="line">Changes not staged for commit:</span><br><span class="line">  (use &quot;git add &lt;file&gt;...&quot; to update what will be committed)</span><br><span class="line">  (use &quot;git restore &lt;file&gt;...&quot; to discard changes in working directory)</span><br><span class="line">        modified:   styles/style.css</span><br><span class="line"></span><br><span class="line">no changes added to commit (use &quot;git add&quot; and/or &quot;git commit -a&quot;)</span><br><span class="line"><span class="meta">$</span><span class="bash"> git add -u</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git commit -m <span class="string">&quot;Background to yellow&quot;</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">log</span> --all --graph --oneline</span></span><br><span class="line">* a5a8831 (HEAD) Background to yellow</span><br><span class="line">| * fee6bac (main) Modify style.css on branch main</span><br><span class="line">| | * 97b461a (tmp) Add test to branch tmp</span><br><span class="line">| |/</span><br><span class="line">| * a0b98ea Move readme.md to readme</span><br><span class="line">| * 63ca733 Add refering projects</span><br><span class="line">| * f77ad61 (tag: js01) Add js</span><br><span class="line">|/</span><br><span class="line">* 78be697 Add style.css</span><br><span class="line">* f51e117 Add index _ log</span><br><span class="line">* 97ad728 (origin/main, origin/HEAD) Initial commit</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> git branch</span></span><br><span class="line">* (HEAD detached from 78be697)</span><br><span class="line">  main</span><br><span class="line">  tmp</span><br></pre></td></tr></table></figure></div>

<p>å¯ä»¥çœ‹åˆ°å¤´æŒ‡é’ˆ(HEAD)æ²¡æœ‰æŒ‡å‘ä»»ä½•åˆ†æ”¯(mainæˆ–è€…tmp),å¦‚æœæ­¤æ—¶åˆ‡æ¢åˆ°äº†å…¶ä»–åˆ†æ”¯:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git checkout main</span></span><br><span class="line">Warning: you are leaving 1 commit behind, not connected to</span><br><span class="line">any of your branches:</span><br><span class="line"></span><br><span class="line">  a5a8831 Background to yellow</span><br><span class="line"></span><br><span class="line">If you want to keep it by creating a new branch, this may be a good time</span><br><span class="line">to do so with:</span><br><span class="line"></span><br><span class="line"> git branch &lt;new-branch-name&gt; a5a8831</span><br><span class="line"></span><br><span class="line">Switched to branch &#x27;main&#x27;</span><br><span class="line">Your branch is ahead of &#x27;origin/main&#x27; by 6 commits.</span><br><span class="line">  (use &quot;git push&quot; to publish your local commits)</span><br><span class="line">  </span><br><span class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">log</span> --all --graph --oneline</span></span><br><span class="line">* fee6bac (HEAD -&gt; main) Modify style.css on branch main</span><br><span class="line">| * 97b461a (tmp) Add test to branch tmp</span><br><span class="line">|/</span><br><span class="line">* a0b98ea Move readme.md to readme</span><br><span class="line">* 63ca733 Add refering projects</span><br><span class="line">* f77ad61 (tag: js01) Add js</span><br><span class="line">* 78be697 Add style.css</span><br><span class="line">* f51e117 Add index _ log</span><br><span class="line">* 97ad728 (origin/main, origin/HEAD) Initial commit </span><br></pre></td></tr></table></figure></div>
<p>å‘ç°ï¼Œä¹‹å‰çš„<code>a5a8831 (HEAD) Background to yellow</code>æ¶ˆå¤±äº†ã€‚å¦‚æœè§‰å¾—<code>a5a8831</code>å¾ˆé‡è¦ï¼Œæ­¤æ—¶è¿˜æœ‰è¡¥æ•‘åŠæ³•ï¼Œå°±æ˜¯ä¸Šé¢æç¤ºçš„é‚£æ ·<code>git branch &lt;new-branch-name&gt; a5a8831</code>æ“ä½œï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git branch fix_css a5a8831</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git branch</span></span><br><span class="line">  fix_css</span><br><span class="line">* main</span><br><span class="line">  tmp</span><br><span class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">log</span> --all --graph --oneline</span></span><br><span class="line">* a5a8831 (fix_css) Background to yellow</span><br><span class="line">| * fee6bac (HEAD -&gt; main) Modify style.css on branch main</span><br><span class="line">| | * 97b461a (tmp) Add test to branch tmp</span><br><span class="line">| |/</span><br><span class="line">| * a0b98ea Move readme.md to readme</span><br><span class="line">| * 63ca733 Add refering projects</span><br><span class="line">| * f77ad61 (tag: js01) Add js</span><br><span class="line">|/</span><br><span class="line">* 78be697 Add style.css</span><br><span class="line">* f51e117 Add index _ log</span><br><span class="line">* 97ad728 (origin/main, origin/HEAD) Initial commit</span><br></pre></td></tr></table></figure></div>
<p>æ–°å»ºäº†ä¸€ä¸ª<code>fix_css</code>åˆ†æ”¯ï¼Œä¹‹å‰çš„æäº¤<code>a5a8831</code>åˆå›æ¥äº†ã€‚</p>
<h2 id="è¿›ä¸€æ­¥ç†è§£HEADå’Œbranch"><a href="#è¿›ä¸€æ­¥ç†è§£HEADå’Œbranch" class="headerlink" title="è¿›ä¸€æ­¥ç†è§£HEADå’Œbranch"></a>è¿›ä¸€æ­¥ç†è§£HEADå’Œbranch</h2><p>HEAD å¯ä»¥æŒ‡å‘branchä¹Ÿå¯ä»¥æŒ‡å‘commit</p>
<h2 id="æ€ä¹ˆåˆ é™¤ä¸éœ€è¦çš„åˆ†æ”¯"><a href="#æ€ä¹ˆåˆ é™¤ä¸éœ€è¦çš„åˆ†æ”¯" class="headerlink" title="æ€ä¹ˆåˆ é™¤ä¸éœ€è¦çš„åˆ†æ”¯"></a>æ€ä¹ˆåˆ é™¤ä¸éœ€è¦çš„åˆ†æ”¯</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git branch -d åˆ†æ”¯å <span class="comment">#</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git branch -D åˆ†æ”¯å</span></span><br></pre></td></tr></table></figure></div>
<p>åŒºåˆ«ï¼š</p>
<blockquote>
<p>-d<br>â€“delete<br>Delete a branch. The branch must be fully merged in its upstream branch, or in HEAD if no upstream was set with â€“track or â€“set-upstream-to.<br>-D<br>Shortcut for â€“delete â€“force</p>
</blockquote>
<h2 id="æ€ä¹ˆä¿®æ”¹æœ€æ–°commitçš„message"><a href="#æ€ä¹ˆä¿®æ”¹æœ€æ–°commitçš„message" class="headerlink" title="æ€ä¹ˆä¿®æ”¹æœ€æ–°commitçš„message"></a>æ€ä¹ˆä¿®æ”¹æœ€æ–°commitçš„message</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">log</span> --all --graph --oneline -n2</span></span><br><span class="line">* a5a8831 (fix_css) Background to yellow</span><br><span class="line">| * fee6bac (HEAD -&gt; main) Modify style.css on branch main</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> git commit --amend <span class="comment"># å¼¹å‡ºvimä¿®æ”¹æ¡†</span></span></span><br><span class="line">[main 7f04fb2] Modify style.css on branch main amend</span><br><span class="line"> Date: Wed Sep 7 15:05:37 2022 +0800</span><br><span class="line"> 1 file changed, 5 insertions(+)</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">log</span> --all --graph --oneline -n2</span></span><br><span class="line">* 7f04fb2 (HEAD -&gt; main) Modify style.css on branch main amend</span><br><span class="line">| * a5a8831 (fix_css) Background to yellow</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<h2 id="æ€ä¹ˆä¿®æ”¹è€æ—§çš„commitçš„message"><a href="#æ€ä¹ˆä¿®æ”¹è€æ—§çš„commitçš„message" class="headerlink" title="æ€ä¹ˆä¿®æ”¹è€æ—§çš„commitçš„message"></a>æ€ä¹ˆä¿®æ”¹è€æ—§çš„commitçš„message</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">log</span> --all --graph --oneline -n6</span></span><br><span class="line">* fb1ece1 (HEAD -&gt; main) Add div class style</span><br><span class="line">* 167491f Add green style.css</span><br><span class="line">* f51e117 Add index _ log</span><br><span class="line">* 97ad728 (origin/main, origin/HEAD) Initial commit</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
<p>å¦‚æœæˆ‘æƒ³å˜æ›´<code>167491f Add green style.css</code>è¿™ä¸€æ¬¡commitçš„message,ä»â€œAdd green style.cssâ€å˜æ›´ä¸ºâ€œAdd red style.cssâ€ï¼Œå¯ä»¥ä½¿ç”¨å®ƒçš„çˆ¶commit<code>f51e117</code>åš<code>rebase</code>æ“ä½œï¼š<br>(tips:å¦‚æœè¯¥commitæ²¡æœ‰çˆ¶commitï¼Œå³æ˜¯ç¬¬ä¸€ä¸ªcommitï¼Œæˆ‘ä»¬å¯ä»¥å¯¹é€‰ç”¨å®ƒçš„commitIDåšrebaseæ“ä½œï¼Œç„¶ååœ¨ä¸‹é¢çš„å¼¹å‡ºå†…å®¹é‡Œï¼ŒæŠŠè¯¥commitæ·»åŠ è¿›å»å³å¯ï¼Œç„¶åå†é€‰æ‹©å¯¹åº”çš„commands)</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git rebase -i f51e117  <span class="comment"># -i äº¤äº’æ¨¡å¼</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¼¹å‡ºä»¥ä¸‹å†…å®¹</span></span><br><span class="line">pick 167491f Add green style.css</span><br><span class="line">pick fb1ece1 Add div class style</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Rebase 97ad728..63ca733 onto 97ad728 (4 commands)</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Commands:</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> p, pick &lt;commit&gt; = use commit</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> r, reword &lt;commit&gt; = use commit, but edit the commit message</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> e, edit &lt;commit&gt; = use commit, but stop <span class="keyword">for</span> amending</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> s, squash &lt;commit&gt; = use commit, but meld into previous commit</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> f, fixup [-C | -c] &lt;commit&gt; = like <span class="string">&quot;squash&quot;</span> but keep only the previous</span></span><br><span class="line"><span class="meta">#</span><span class="bash">                    commit<span class="string">&#x27;s log message, unless -C is used, in which case</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">                    keep only this commit<span class="string">&#x27;s message; -c is same as -C but</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">                    opens the editor</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> x, <span class="built_in">exec</span> &lt;<span class="built_in">command</span>&gt; = run <span class="built_in">command</span> (the rest of the line) using shell</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> b, <span class="built_in">break</span> = stop here (<span class="built_in">continue</span> rebase later with <span class="string">&#x27;git rebase --continue&#x27;</span>)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> d, drop &lt;commit&gt; = remove commit</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> l, label &lt;label&gt; = label current HEAD with a name</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> t, reset &lt;label&gt; = reset HEAD to a label</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> m, merge [-C &lt;commit&gt; | -c &lt;commit&gt;] &lt;label&gt; [<span class="comment"># &lt;oneline&gt;]</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> .       create a merge commit using the original merge commit<span class="string">&#x27;s</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> .       message (or the oneline, <span class="keyword">if</span> no original merge commit was</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> .       specified); use -c &lt;commit&gt; to reword the commit message</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># These lines can be re-ordered; they are executed from top to bottom.</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># If you remove a line here THAT COMMIT WILL BE LOST.</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># However, if you remove everything, the rebase will be aborted.</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
<p>æ¥ä¸‹æ¥å°±æ˜¯ç¼–å†™å¯¹åº”commitçš„commandsï¼Œå¸¸è§çš„commandsè§£æå¦‚ä¸‹:</p>
<table>
<thead>
<tr>
<th>commands</th>
<th>è§£æ</th>
</tr>
</thead>
<tbody><tr>
<td>pick(ç®€å†™p)</td>
<td>rebaseè¿‡ç¨‹ä¸­ä¿ç•™è¿™æ¬¡commit</td>
</tr>
<tr>
<td>reword(ç®€å†™r)</td>
<td>rebaseè¿‡ç¨‹ä¸­ä¿ç•™è¿™æ¬¡commit,ä½†æ˜¯éœ€è¦é‡æ–°ç¼–è¾‘è¿™æ¬¡commitçš„messageï¼Œä½¿ç”¨äº†è¿™ä¸ªå‘½ä»¤ä¹‹åï¼Œä¿å­˜é€€å‡ºï¼Œå°†ä¼šå¼¹å‡ºä¿®æ”¹messageç•Œé¢</td>
</tr>
<tr>
<td>edit(ç®€å†™e)</td>
<td>rebaseè¿‡ç¨‹ä¸­ä¿ç•™è¿™æ¬¡commit,ä¿ç•™commitï¼Œä½†rebaseæ“ä½œæ‰§è¡Œåˆ°è¯¥commitæ—¶ä¼šæš‚åœï¼Œç”¨æˆ·åœ¨æ­¤commitåŸºç¡€ä¸Šè¿›è¡Œå†…å®¹ä¿®æ”¹ï¼ˆå½“ç„¶ï¼Œä¹Ÿå¯ä»¥ä¸ä¿®æ”¹ï¼‰åï¼Œæ‰§è¡Œgit add ç›®æ ‡æ–‡ä»¶å’Œgit commit â€“amendæ›´æ–°messageï¼Œç„¶åæ‰§è¡Œgit rebase â€“continueç»§ç»­æœªå®Œæˆçš„rebaseå·¥ä½œ ã€‚è¿™ä¸ªå‘½ä»¤çš„ä½¿ç”¨åœºæ™¯æ˜¯ï¼Œéœ€è¦å¯¹ä¹‹å‰çš„æŸä¸€ä¸ªcommitä¸Šåšå†…å®¹ä¿®æ”¹</td>
</tr>
<tr>
<td>squash(ç®€å†™s)</td>
<td>rebaseè¿‡ç¨‹ä¸­ä¿ç•™è¿™æ¬¡commit, ä½†å°†å…¶åˆå¹¶è‡³å‰ä¸€ä¸ªcommitï¼Œåˆå¹¶æ—¶ï¼Œè‡ªåŠ¨æ±‡æ€»è¯¥commitä¸ä¸Šä¸€ä¸ªcommitçš„messageï¼Œç”¨æˆ·å¯è¿›è¡ŒäºŒæ¬¡ç¼–è¾‘message</td>
</tr>
<tr>
<td>fixup(ç®€å†™f)</td>
<td>ä¸squashåŠŸèƒ½ç±»ä¼¼ï¼Œä¿ç•™commitï¼Œå°†å…¶åˆå¹¶è‡³å‰ä¸€ä¸ªcommitï¼Œä½†æ˜¯ä¸¢å¼ƒè¯¥commitçš„messageï¼Œä½¿ç”¨ä¸Šä¸€ä¸ªcommitçš„message</td>
</tr>
</tbody></table>
<p>è¿™é‡Œæˆ‘ä»¬æŠŠ<code>pick 167491f Add green style.css</code>ä¿®æ”¹ä¸º<code>r 167491f Add green style.css</code>ï¼Œä¿å­˜é€€å‡ºä¹‹åï¼Œå¼¹å‡ºä¿®æ”¹messageé¡µé¢:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">Add red style.css</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Please enter the commit message <span class="keyword">for</span> your changes. Lines starting</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> with <span class="string">&#x27;#&#x27;</span> will be ignored, and an empty message aborts the commit.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Date:      Wed Sep 7 11:20:39 2022 +0800</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># interactive rebase in progress; onto 63ca733</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Last <span class="built_in">command</span> <span class="keyword">done</span> (1 <span class="built_in">command</span> <span class="keyword">done</span>):</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    reword a0b98ea Move readme.md to readme</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Next <span class="built_in">command</span> to <span class="keyword">do</span> (1 remaining <span class="built_in">command</span>):</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    pick 7f04fb2 Modify style.css on branch main amend</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> You are currently editing a commit <span class="keyword">while</span> rebasing branch <span class="string">&#x27;main&#x27;</span> on <span class="string">&#x27;63ca733&#x27;</span>.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Changes to be committed:</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">       renamed:    README.md -&gt; README</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Untracked files:</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">       .gitignore</span></span><br><span class="line"><span class="meta">#</span></span><br></pre></td></tr></table></figure></div>
<p>messageä¿®æ”¹å®Œä¹‹åï¼Œå†æ¬¡ä¿å­˜é€€å‡ºï¼Œå°†è‡ªåŠ¨å¼¹å‡º:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git rebase -i f51e117</span></span><br><span class="line">[detached HEAD 68c45d1] Add red style.css</span><br><span class="line"> Date: Tue Sep 6 10:59:30 2022 +0800</span><br><span class="line"> 1 file changed, 50 insertions(+)</span><br><span class="line"> create mode 100644 styles/style.css</span><br><span class="line">Successfully rebased and updated refs/heads/main.</span><br></pre></td></tr></table></figure></div>
<p>æˆ‘ä»¬å†æ¬¡æŸ¥çœ‹log:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">git log --all --graph --oneline -n6</span><br><span class="line">* 7db15bd (HEAD -&gt; main) Add div class style</span><br><span class="line">* 68c45d1 Add red style.css</span><br><span class="line">* f51e117 Add index _ log</span><br><span class="line">* 97ad728 (origin/main, origin/HEAD) Initial commit</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
<p>å¯¹æ¯”å¼€å§‹ä¹‹å‰çš„logï¼Œå·²ç»å®Œæˆäº†messageçš„ä¿®æ”¹ï¼Œåªä¸è¿‡commitçš„IDå‘ç”Ÿäº†å˜æ›´ã€‚<br>(æ³¨æ„ï¼Œå½“å­˜åœ¨å¤šä¸ªåˆ†æ”¯æ—¶ï¼Œä¿®æ”¹å¤šä¸ªåˆ†æ”¯å…±åŒè·¯å¾„ä¸Šçš„commitçš„messageï¼Œå°†ä»è¯¥commitçš„çˆ¶commitå¼€å§‹å‘ç”Ÿè£‚å˜ï¼Œå½“å‰åˆ†æ”¯è¯¥commitçš„messageå‘ç”Ÿäº†ä¿®æ”¹ï¼Œå…¶ä»–åˆ†æ”¯è¯¥commitçš„messageä¿æŒä¸å˜)<br>ä¿®æ”¹<code>f51e117 Add index _ log</code>å‰:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">* fd46298 (HEAD -&gt; b1) Add style to b1</span><br><span class="line">| * 72c72b5 (main) Add li to index</span><br><span class="line">|/</span><br><span class="line">* 7db15bd Add div class style</span><br><span class="line">* 68c45d1 Add red style.css</span><br><span class="line">* f51e117 Add index _ log</span><br><span class="line">* 97ad728 (origin/main, origin/HEAD) Initial commit</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
<p>ä¿®æ”¹<code>f51e117 Add index _ log</code>å:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">* 6f4263f (HEAD -&gt; b1) Add style to b1</span><br><span class="line">* 29ec5c3 Add div class style</span><br><span class="line">* f3f7003 Add red style.css</span><br><span class="line">* 8128f86 Add index _ log after init</span><br><span class="line">| * 72c72b5 (main) Add li to index</span><br><span class="line">| * 7db15bd Add div class style</span><br><span class="line">| * 68c45d1 Add red style.css</span><br><span class="line">| * f51e117 Add index _ log</span><br><span class="line">|/</span><br><span class="line">* 97ad728 (origin/main, origin/HEAD) Initial commit</span><br></pre></td></tr></table></figure></div>
<p><code>git rebase</code>å˜åŸºæ“ä½œåº”è¯¥åªåœ¨è‡ªå·±å¼€å‘çš„åˆ†æ”¯ä¸Šè¿›è¡Œï¼Œæ‰€ä»¥é€šè¿‡<code>git rebase -i commitID </code>ä¿®æ”¹æ—§çš„commitçš„messageåº”è¯¥ä»…é™äºè‡ªå·±åˆ†æ”¯ï¼Œä¸è¦å¯¹å›¢é˜Ÿé›†æˆè·¯å¾„ä¸Š/å…±åŒè·¯å¾„ä¸Šçš„commitçš„messageåšå˜æ›´ï¼Œä»¥å…å‡ºç°ä¸å¯é¢„æœŸçš„trouble. </p>
<h2 id="æ€ä¹ˆæŠŠå¤šä¸ªè¿ç»­çš„commitåˆå¹¶æˆä¸€ä¸ªcommit"><a href="#æ€ä¹ˆæŠŠå¤šä¸ªè¿ç»­çš„commitåˆå¹¶æˆä¸€ä¸ªcommit" class="headerlink" title="æ€ä¹ˆæŠŠå¤šä¸ªè¿ç»­çš„commitåˆå¹¶æˆä¸€ä¸ªcommit"></a>æ€ä¹ˆæŠŠå¤šä¸ªè¿ç»­çš„commitåˆå¹¶æˆä¸€ä¸ªcommit</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">log</span> --all --graph --oneline</span></span><br><span class="line">* a3d26dc (HEAD -&gt; main) Add 3 div to index</span><br><span class="line">* bac9977 Add 2 div to index</span><br><span class="line">* 2fab0c5 Add 1 div to index</span><br><span class="line">* 7db15bd Add div class style</span><br><span class="line">* 68c45d1 Add red style.css</span><br><span class="line">* f51e117 Add index _ log</span><br><span class="line">* 97ad728 (origin/main, origin/HEAD) Initial commit</span><br></pre></td></tr></table></figure></div>
<p>æœ€è¿‘çš„ä¸‰æ¬¡comimtéƒ½æ˜¯å¯¹indexæ–‡ä»¶çš„æ“ä½œï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘æŠŠå®ƒä»¬åˆå¹¶ä¸€ä¸‹:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git rebase -i 7db15bd</span> </span><br></pre></td></tr></table></figure></div>
<p>å¼¹å‡ºé¡µé¢:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">pick 2fab0c5 Add 1 div to index</span><br><span class="line">pick bac9977 Add 2 div to index</span><br><span class="line">pick a3d26dc Add 3 div to index</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Rebase 7db15bd..a3d26dc onto 7db15bd (3 commands)</span></span><br></pre></td></tr></table></figure></div>
<p>ä¿®æ”¹ä¸º:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">pick 2fab0c5 Add 1 div to index</span><br><span class="line">s bac9977 Add 2 div to index</span><br><span class="line">s a3d26dc Add 3 div to index</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Rebase 7db15bd..a3d26dc onto 7db15bd (3 commands)</span></span><br></pre></td></tr></table></figure></div>
<p>ä¿å­˜é€€å‡ºï¼Œå¼¹å‡ºé¡µé¢:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> This is a combination of 3 commits.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> This is the 1st commit message:</span></span><br><span class="line"></span><br><span class="line">Add 1 div to index</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> This is the commit message <span class="comment">#2:</span></span></span><br><span class="line"></span><br><span class="line">Add 2 div to index</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> This is the commit message <span class="comment">#3:</span></span></span><br><span class="line"></span><br><span class="line">Add 3 div to index</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Please enter the commit message <span class="keyword">for</span> your changes. Lines starting</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> with <span class="string">&#x27;#&#x27;</span> will be ignored, and an empty message aborts the commit.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Date:      Fri Sep 9 14:13:08 2022 +0800</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># interactive rebase in progress; onto 7db15bd</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Last commands <span class="keyword">done</span> (3 commands <span class="keyword">done</span>):</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    squash bac9977 Add 2 div to index</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    squash a3d26dc Add 3 div to index</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> No commands remaining.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> You are currently rebasing branch <span class="string">&#x27;main&#x27;</span> on <span class="string">&#x27;7db15bd&#x27;</span>.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Changes to be committed:</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">       modified:   index.html</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
<p>åœ¨<code># This is a combination of 3 commits.</code>ä¸‹é¢æ·»åŠ åˆå¹¶æˆä¸€ä¸ªcommitçš„messageï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> This is a combination of 3 commits.</span></span><br><span class="line">Add total 3 div to index,a combination commit message</span><br><span class="line"><span class="meta">#</span><span class="bash"> This is the 1st commit message:</span></span><br><span class="line"></span><br><span class="line">Add 1 div to index</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> This is the commit message <span class="comment">#2:</span></span></span><br><span class="line"></span><br><span class="line">Add 2 div to index</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> This is the commit message <span class="comment">#3:</span></span></span><br><span class="line"></span><br><span class="line">Add 3 div to index</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Please enter the commit message <span class="keyword">for</span> your changes. Lines starting</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> with <span class="string">&#x27;#&#x27;</span> will be ignored, and an empty message aborts the commit.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Date:      Fri Sep 9 14:13:08 2022 +0800</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># interactive rebase in progress; onto 7db15bd</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Last commands <span class="keyword">done</span> (3 commands <span class="keyword">done</span>):</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    squash bac9977 Add 2 div to index</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    squash a3d26dc Add 3 div to index</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> No commands remaining.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> You are currently rebasing branch <span class="string">&#x27;main&#x27;</span> on <span class="string">&#x27;7db15bd&#x27;</span>.</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
<p>ä¿å­˜é€€å‡º:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git rebase -i 7db15bd</span></span><br><span class="line">[detached HEAD 35a3dea] Add total 3 div to index,a combination commit message</span><br><span class="line"> Date: Fri Sep 9 14:13:08 2022 +0800</span><br><span class="line"> 1 file changed, 15 insertions(+)</span><br><span class="line">Successfully rebased and updated refs/heads/main.</span><br></pre></td></tr></table></figure></div>
<p>æŸ¥çœ‹logï¼Œå®Œæˆcommitåˆå¹¶:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">log</span> --all --graph --oneline</span></span><br><span class="line">* 35a3dea (HEAD -&gt; main) Add total 3 div to index,a combination commit message</span><br><span class="line">* 7db15bd Add div class style</span><br><span class="line">* 68c45d1 Add red style.css</span><br><span class="line">* f51e117 Add index _ log</span><br><span class="line">* 97ad728 (origin/main, origin/HEAD) Initial commit</span><br></pre></td></tr></table></figure></div>

<h2 id="æ€ä¹ˆæŠŠå¤šä¸ªä¸è¿ç»­çš„commitåˆå¹¶æˆä¸€ä¸ªcommit"><a href="#æ€ä¹ˆæŠŠå¤šä¸ªä¸è¿ç»­çš„commitåˆå¹¶æˆä¸€ä¸ªcommit" class="headerlink" title="æ€ä¹ˆæŠŠå¤šä¸ªä¸è¿ç»­çš„commitåˆå¹¶æˆä¸€ä¸ªcommit"></a>æ€ä¹ˆæŠŠå¤šä¸ªä¸è¿ç»­çš„commitåˆå¹¶æˆä¸€ä¸ªcommit</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">log</span> --all --graph --oneline</span></span><br><span class="line">* 6e38539 (HEAD -&gt; main) Add new annotation to index.html</span><br><span class="line">* b7e7353 Add gree style.css</span><br><span class="line">* 35a3dea Add total 3 div to index,a combination commit message</span><br><span class="line">* 7db15bd Add div class style</span><br><span class="line">* 68c45d1 Add red style.css</span><br><span class="line">* f51e117 Add index _ log</span><br><span class="line">* 97ad728 (origin/main, origin/HEAD) Initial commit</span><br></pre></td></tr></table></figure></div>
<p><code>b7e7353 Add gree style.css</code>å’Œ<code>68c45d1 Add red style.css</code>éƒ½æ˜¯å¯¹<code>style.css</code>çš„ä¿®æ”¹ï¼Œè€ƒè™‘åˆå¹¶æˆä¸€ä¸ªcommitï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git rebase -i f51e117</span></span><br></pre></td></tr></table></figure></div>
<p>å¼¹å‡º:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">pick 68c45d1 Add red style.css</span><br><span class="line">pick 7db15bd Add div class style</span><br><span class="line">pick 35a3dea Add total 3 div to index,a combination commit message</span><br><span class="line">pick b7e7353 Add gree style.css</span><br><span class="line">pick 6e38539 Add new annotation to index.html</span><br></pre></td></tr></table></figure></div>
<p>ä¿®æ”¹ä¸º:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">pick 68c45d1 Add red style.css</span><br><span class="line">s b7e7353 Add gree style.css</span><br><span class="line">pick 7db15bd Add div class style</span><br><span class="line">pick 35a3dea Add total 3 div to index,a combination commit message</span><br><span class="line">pick 6e38539 Add new annotation to index.html</span><br></pre></td></tr></table></figure></div>
<p>ä¿å­˜é€€å‡º(å¯¹äºä¸è¿ç»­çš„commitåšåˆå¹¶ï¼Œå¤§æ¦‚ç‡ä¼šé‡åˆ°å†²çªï¼Œå¦‚æœæœ‰å†²çªï¼Œåˆ™è§£å†³å®Œæ–‡ä»¶å†²çªåä½¿ç”¨<code>git add -u</code> å’Œ<code>git rebase --continue</code>)ï¼Œå¼¹å‡º:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> This is a combination of 2 commits.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> åœ¨æ­¤å¤„æ·»åŠ åˆå¹¶åçš„message</span></span><br><span class="line">Add some color style.css,combination message of 2 commits</span><br><span class="line"><span class="meta">#</span><span class="bash"> This is the 1st commit message:</span></span><br><span class="line"></span><br><span class="line">Add red style.css</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> This is the commit message <span class="comment">#2:</span></span></span><br><span class="line"></span><br><span class="line">Add gree style.css</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Please enter the commit message <span class="keyword">for</span> your changes. Lines starting</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> with <span class="string">&#x27;#&#x27;</span> will be ignored, and an empty message aborts the commit.</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># Date:      Tue Sep 6 10:59:30 2022 +0800</span></span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="bash"><span class="comment"># interactive rebase in progress; onto f51e117</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Last commands <span class="keyword">done</span> (2 commands <span class="keyword">done</span>):</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    pick 68c45d1 Add red style.css</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    squash b7e7353 Add gree style.css</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Next commands to <span class="keyword">do</span> (3 remaining commands):</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    pick 7db15bd Add div class style</span></span><br><span class="line"><span class="meta">#</span><span class="bash">    pick 35a3dea Add total 3 div to index,a combination commit message</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> You are currently rebasing branch <span class="string">&#x27;main&#x27;</span> on <span class="string">&#x27;f51e117&#x27;</span>.</span></span><br></pre></td></tr></table></figure></div>
<p>æŸ¥çœ‹åˆå¹¶ç»“æœ:</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">log</span> --all --graph --oneline</span></span><br><span class="line">* d3a8e50 (HEAD -&gt; main) Add new annotation to index.html</span><br><span class="line">* ad7fa4c Add total 3 div to index,a combination commit message</span><br><span class="line">* 6a384dd Add div class style</span><br><span class="line">* ebd0755 Add some color style.css,combination message of 2 commits</span><br><span class="line">* f51e117 Add index _ log</span><br><span class="line">* 97ad728 (origin/main, origin/HEAD) Initial commit</span><br></pre></td></tr></table></figure></div>

<h2 id="æ¶ˆé™¤æœ€è¿‘çš„å‡ æ¬¡æäº¤"><a href="#æ¶ˆé™¤æœ€è¿‘çš„å‡ æ¬¡æäº¤" class="headerlink" title="æ¶ˆé™¤æœ€è¿‘çš„å‡ æ¬¡æäº¤"></a>æ¶ˆé™¤æœ€è¿‘çš„å‡ æ¬¡æäº¤</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">log</span> --all --graph --oneline</span></span><br><span class="line">* e4eb5dd (HEAD -&gt; temp) Add images/wall_paper.jpg</span><br><span class="line">* ad147cf Remove style/style.css</span><br><span class="line">* 67626bb Add some comments</span><br><span class="line">| * 0007ea8 (main) Change styles/style.css to ç‰ˆæœ¬åº“</span><br><span class="line">| * d3a8e50 Add new annotation to index.html</span><br><span class="line">| * ad7fa4c Add total 3 div to index,a combination commit message</span><br><span class="line">| * 6a384dd Add div class style</span><br><span class="line">|/</span><br><span class="line">* ebd0755 Add some color style.css,combination message of 2 commits</span><br><span class="line">* f51e117 Add index _ log</span><br><span class="line">* 97ad728 (origin/main, origin/HEAD) Initial commit</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> git reset --hard 67626bb</span></span><br><span class="line">HEAD is now at 67626bb Add some comments</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">log</span> --all --graph --oneline</span></span><br><span class="line">* 67626bb (HEAD -&gt; temp) Add some comments</span><br><span class="line">| * 0007ea8 (main) Change styles/style.css to ç‰ˆæœ¬åº“</span><br><span class="line">| * d3a8e50 Add new annotation to index.html</span><br><span class="line">| * ad7fa4c Add total 3 div to index,a combination commit message</span><br><span class="line">| * 6a384dd Add div class style</span><br><span class="line">|/</span><br><span class="line">* ebd0755 Add some color style.css,combination message of 2 commits</span><br><span class="line">* f51e117 Add index _ log</span><br><span class="line">* 97ad728 (origin/main, origin/HEAD) Initial commit</span><br></pre></td></tr></table></figure></div>
<p><code>git reset --hard commitID</code>ï¼ŒHEADä¼šæŒ‡å‘<code>comitID</code>ï¼Œå¹¶ä¸”æš‚å­˜åŒºå’Œå·¥ä½œåŒºéƒ½ä¼šæ¢å¤åˆ°æŒ‡å®š<code>commitID</code>çš„å†…å®¹ã€‚</p>
<h2 id="æ€ä¹ˆæ¯”è¾ƒæš‚å­˜åŒºå’ŒHEADæ‰€å«æ–‡ä»¶çš„å·®å¼‚"><a href="#æ€ä¹ˆæ¯”è¾ƒæš‚å­˜åŒºå’ŒHEADæ‰€å«æ–‡ä»¶çš„å·®å¼‚" class="headerlink" title="æ€ä¹ˆæ¯”è¾ƒæš‚å­˜åŒºå’ŒHEADæ‰€å«æ–‡ä»¶çš„å·®å¼‚"></a>æ€ä¹ˆæ¯”è¾ƒæš‚å­˜åŒºå’ŒHEADæ‰€å«æ–‡ä»¶çš„å·®å¼‚</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å·¥ä½œåŒºæ–‡ä»¶ä¿®æ”¹åï¼Œæ·»åŠ åˆ°æš‚å­˜åŒº</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git add -u</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ¯”è¾ƒæš‚å­˜åŒºå’ŒHEADæ‰€å«æ–‡ä»¶çš„å·®å¼‚</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git diff --cached</span></span><br></pre></td></tr></table></figure></div>

<h2 id="å¦‚ä½•è®©æš‚å­˜åŒºæ¢å¤æˆå’ŒHEADçš„ä¸€æ ·"><a href="#å¦‚ä½•è®©æš‚å­˜åŒºæ¢å¤æˆå’ŒHEADçš„ä¸€æ ·" class="headerlink" title="å¦‚ä½•è®©æš‚å­˜åŒºæ¢å¤æˆå’ŒHEADçš„ä¸€æ ·"></a>å¦‚ä½•è®©æš‚å­˜åŒºæ¢å¤æˆå’ŒHEADçš„ä¸€æ ·</h2><blockquote>
<p>å³æ”¾å¼ƒå·²ç»addåˆ°æš‚å­˜åŒºçš„å˜æ›´</p>
</blockquote>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æ¢å¤</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git reset HEAD</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹å·®å¼‚ï¼ŒéªŒè¯æ¢å¤</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git diff --cached</span></span><br></pre></td></tr></table></figure></div>
<p>æ‰§è¡Œä¹‹åï¼Œä»ä¸Šä¸€æ¬¡commitåˆ°ç°åœ¨ï¼Œaddåˆ°æš‚å­˜åŒºçš„å˜æ›´å°†ä¼šæ¸…é™¤ï¼Œä½†æ˜¯æœ¬åœ°å·¥ä½œåŒºä¸ä¼šè¢«æ¸…é™¤</p>
<h2 id="æ€æ ·å–æ¶ˆæš‚å­˜åŒºéƒ¨åˆ†æ–‡ä»¶çš„æ›´æ”¹"><a href="#æ€æ ·å–æ¶ˆæš‚å­˜åŒºéƒ¨åˆ†æ–‡ä»¶çš„æ›´æ”¹" class="headerlink" title="æ€æ ·å–æ¶ˆæš‚å­˜åŒºéƒ¨åˆ†æ–‡ä»¶çš„æ›´æ”¹"></a>æ€æ ·å–æ¶ˆæš‚å­˜åŒºéƒ¨åˆ†æ–‡ä»¶çš„æ›´æ”¹</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git status</span></span><br><span class="line">On branch main</span><br><span class="line">Your branch is ahead of &#x27;origin/main&#x27; by 6 commits.</span><br><span class="line">  (use &quot;git push&quot; to publish your local commits)</span><br><span class="line"></span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use &quot;git restore --staged &lt;file&gt;...&quot; to unstage)</span><br><span class="line">        modified:   index.html</span><br><span class="line">        modified:   styles/style.css</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
<p><code>index.html</code>å’Œ<code>styles/style.css</code>ä¸¤ä¸ªæ–‡ä»¶éƒ½åšäº†ä¿®æ”¹ï¼Œå¹¶ä¸”å·²ç»addåˆ°æš‚å­˜åŒºï¼ŒåŒæ ·å¯ä»¥ä½¿ç”¨<code>git reset</code>å‘½ä»¤æ¥å–æ¶ˆæš‚å­˜åŒºæŸä¸ªæ–‡ä»¶çš„æ›´æ”¹ï¼Œå³æŠŠè¿™ä¸ªæ–‡ä»¶ä»ä¸Šä¸€æ¬¡commitåˆ°ç°åœ¨ï¼Œaddåˆ°æš‚å­˜åŒºçš„å˜æ›´å°†ä¼šæ¸…é™¤ï¼Œä½†æ˜¯æœ¬åœ°å·¥ä½œåŒºä¸ä¼šè¢«æ¸…é™¤</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git reset HEAD -- index.html</span></span><br></pre></td></tr></table></figure></div>
<p>æ‰§è¡Œä¹‹åï¼Œæš‚å­˜åŒºçš„<code>index.html</code>æ–‡ä»¶å°†å’Œä¸Šä¸€æ¬¡commitæ—¶ä¿æŒä¸€è‡´ï¼Œå¦‚æœæ­¤æ—¶å†<code>git commit</code>æ“ä½œ,å°†ä¼šæŠŠæš‚å­˜åŒº<code>styles/style.css</code>çš„å˜æ›´æäº¤åˆ°ç‰ˆæœ¬åº“ã€‚</p>
<h2 id="æ€ä¹ˆæ¯”è¾ƒå·¥ä½œåŒºå’Œæš‚å­˜åŒºæ‰€å«æ–‡ä»¶çš„å·®å¼‚"><a href="#æ€ä¹ˆæ¯”è¾ƒå·¥ä½œåŒºå’Œæš‚å­˜åŒºæ‰€å«æ–‡ä»¶çš„å·®å¼‚" class="headerlink" title="æ€ä¹ˆæ¯”è¾ƒå·¥ä½œåŒºå’Œæš‚å­˜åŒºæ‰€å«æ–‡ä»¶çš„å·®å¼‚"></a>æ€ä¹ˆæ¯”è¾ƒå·¥ä½œåŒºå’Œæš‚å­˜åŒºæ‰€å«æ–‡ä»¶çš„å·®å¼‚</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> å·¥ä½œåŒºæ–‡ä»¶ä¿®æ”¹ä¹‹åï¼Œæ·»åŠ åˆ°æš‚å­˜åŒºä¹‹å‰ï¼Œæ¯”è¾ƒå·¥ä½œåŒºå’Œæš‚å­˜åŒºæ‰€å«æ–‡ä»¶çš„å·®å¼‚</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git diff [-- filename(å¤šä¸ªç©ºæ ¼éš”å¼€) ]</span></span><br></pre></td></tr></table></figure></div>

<h2 id="å¦‚ä½•è®©å·¥ä½œåŒºçš„æ–‡ä»¶æ¢å¤ä¸ºå’Œæš‚å­˜åŒºä¸€æ ·"><a href="#å¦‚ä½•è®©å·¥ä½œåŒºçš„æ–‡ä»¶æ¢å¤ä¸ºå’Œæš‚å­˜åŒºä¸€æ ·" class="headerlink" title="å¦‚ä½•è®©å·¥ä½œåŒºçš„æ–‡ä»¶æ¢å¤ä¸ºå’Œæš‚å­˜åŒºä¸€æ ·"></a>å¦‚ä½•è®©å·¥ä½œåŒºçš„æ–‡ä»¶æ¢å¤ä¸ºå’Œæš‚å­˜åŒºä¸€æ ·</h2><blockquote>
<p>å³æ”¾å¼ƒä»ä¸Šæ¬¡addåˆ°ç›®å‰ï¼Œåœ¨å·¥ä½œåŒºçš„å˜æ›´</p>
</blockquote>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æ¢å¤æŒ‡å®šæ–‡ä»¶</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git checkout -- filename</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ¢å¤å½“å‰ç›®å½•ä¸‹æ‰€æœ‰</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git checkout .</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹å·®å¼‚ï¼ŒéªŒè¯æ¢å¤</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git diff</span></span><br></pre></td></tr></table></figure></div>
<p>æ€»ç»“:<br><img src="/2022/09/05/uncatalog/cl7oebs5q0000f0r7e0oq9fnk/add.jpg"></p>
<h2 id="æŸ¥çœ‹ä¸åŒæäº¤çš„æŒ‡å®šæ–‡ä»¶çš„å·®å¼‚"><a href="#æŸ¥çœ‹ä¸åŒæäº¤çš„æŒ‡å®šæ–‡ä»¶çš„å·®å¼‚" class="headerlink" title="æŸ¥çœ‹ä¸åŒæäº¤çš„æŒ‡å®šæ–‡ä»¶çš„å·®å¼‚"></a>æŸ¥çœ‹ä¸åŒæäº¤çš„æŒ‡å®šæ–‡ä»¶çš„å·®å¼‚</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> åˆ†ä¹‹é—´æ–‡ä»¶å·®å¼‚</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git diff branch1 branch2 -- filename</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> commité—´æ–‡ä»¶å·®å¼‚(commitID1å’ŒcommitID2å¯ä»¥åœ¨ä¸åŒçš„åˆ†æ”¯ä¸Š)</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git diff commitID1 commitID2 -- filename</span></span><br></pre></td></tr></table></figure></div>

<h2 id="æ­£ç¡®åˆ é™¤æ–‡ä»¶çš„æ–¹æ³•"><a href="#æ­£ç¡®åˆ é™¤æ–‡ä»¶çš„æ–¹æ³•" class="headerlink" title="æ­£ç¡®åˆ é™¤æ–‡ä»¶çš„æ–¹æ³•"></a>æ­£ç¡®åˆ é™¤æ–‡ä»¶çš„æ–¹æ³•</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git rm filename</span></span><br></pre></td></tr></table></figure></div>

<h2 id="å¦‚ä½•æŒ‡å®šä¸éœ€è¦gitç®¡ç†çš„æ–‡ä»¶"><a href="#å¦‚ä½•æŒ‡å®šä¸éœ€è¦gitç®¡ç†çš„æ–‡ä»¶" class="headerlink" title="å¦‚ä½•æŒ‡å®šä¸éœ€è¦gitç®¡ç†çš„æ–‡ä»¶"></a>å¦‚ä½•æŒ‡å®šä¸éœ€è¦gitç®¡ç†çš„æ–‡ä»¶</h2><p>è¯¦è§<a href="https://www.w3schools.com/git/git_ignore.asp">.gitignore</a></p>
<h2 id="å¦‚ä½•å°†gitä»“åº“å¤‡ä»½åˆ°æœ¬åœ°"><a href="#å¦‚ä½•å°†gitä»“åº“å¤‡ä»½åˆ°æœ¬åœ°" class="headerlink" title="å¦‚ä½•å°†gitä»“åº“å¤‡ä»½åˆ°æœ¬åœ°"></a>å¦‚ä½•å°†gitä»“åº“å¤‡ä»½åˆ°æœ¬åœ°</h2><ol>
<li>å“‘åè®®å’Œæ™ºèƒ½åè®®<br><img src="/2022/09/05/uncatalog/cl7oebs5q0000f0r7e0oq9fnk/protocal.png" alt="protocal"></li>
</ol>
<p><img src="/2022/09/05/uncatalog/cl7oebs5q0000f0r7e0oq9fnk/protocal_diff.png" alt="protocal_diff"></p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">pwd</span></span></span><br><span class="line">/d/github/gitPractice</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> ..</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆ›å»ºå“‘åè®®å¤‡ä»½ä»“åº“ç›®å½•</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> mkdir gitPracticeBackUpYa</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆ›å»ºåªèƒ½åè®®å¤‡ä»½ä»“åº“ç›®å½•</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> mkdir gitPracticeBackUpZhiNeng</span></span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> gitPracticeBackUpYa/</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> é€šè¿‡å“‘åè®®å¤‡ä»½åˆ°gitPracticeBackUpYaç›®å½•</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">clone</span> --bare /d/github/gitPractice/.git/ ya_xie_yi.git</span></span><br><span class="line">Cloning into bare repository &#x27;ya_xie_yi.git&#x27;...</span><br><span class="line">done.</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> ../gitPracticeBackUpZhiNeng/</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> é€šè¿‡æ™ºèƒ½åè®®å¤‡ä»½åˆ°gitPracticeBackUpYaç›®å½•ï¼Œ--bareä¸åŒ…å«å·¥ä½œåŒº</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">clone</span> --bare file:///d/github/gitPractice/.git zhi_neng.git</span></span><br><span class="line">Cloning into bare repository &#x27;zhi_neng.git&#x27;...</span><br><span class="line">remote: Enumerating objects: 29, done.</span><br><span class="line">remote: Counting objects: 100% (29/29), done.</span><br><span class="line">remote: Compressing objects: 100% (23/23), done.</span><br><span class="line">remote: Total 29 (delta 10), reused 0 (delta 0), pack-reused 0</span><br><span class="line">Receiving objects: 100% (29/29), 22.51 KiB | 5.63 MiB/s, done.</span><br><span class="line">Resolving deltas: 100% (10/10), done.</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> ls</span></span><br><span class="line">zhi_neng.git/</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> ls ../gitPracticeBackUpYa/</span></span><br><span class="line">ya_xie_yi.git/</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<ol start="2">
<li>å¤‡ä»½<br><img src="/2022/09/05/uncatalog/cl7oebs5q0000f0r7e0oq9fnk/backup.png" alt="backup"></li>
</ol>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">/d/github/gitPractice (temp)</span><br><span class="line"><span class="meta">$</span><span class="bash"> git remote -v <span class="comment"># æ˜¾ç¤ºéœ€è¦è¯»å†™è¿œç¨‹ä»“åº“ä½¿ç”¨çš„ Git ä¿å­˜çš„ç®€å†™ä¸å…¶å¯¹åº”çš„ URL</span></span></span><br><span class="line">origin  https://github.com/bugmakerprox/gitPractice.git (fetch)</span><br><span class="line">origin  https://github.com/bugmakerprox/gitPractice.git (push)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> git remote add &lt;shortname&gt; &lt;url&gt; æ·»åŠ ä¸€ä¸ªæ–°çš„è¿œç¨‹ Git ä»“åº“</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git remote add zhineng file:///d/github/gitPracticeBackUpZhiNeng/zhi_neng.git</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
<p>åœ¨å¤‡ä»½ä»“åº“(gitPracticeBackUpZhiNeng)æŸ¥çœ‹</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">pwd</span></span></span><br><span class="line">/d/github/gitPracticeBackUpZhiNeng/zhi_neng.git</span><br><span class="line"></span><br><span class="line">jw.xu@hz-jw-xu-n MINGW64 /d/github/gitPracticeBackUpZhiNeng/zhi_neng.git (BARE:temp)</span><br><span class="line"><span class="meta">$</span><span class="bash"> git branch -av</span></span><br><span class="line">  main 0007ea8 Change styles/style.css to ç‰ˆæœ¬åº“</span><br><span class="line">* temp 67626bb Add some comments</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> ..</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ls</span></span><br><span class="line">zhi_neng.git/</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>
<p>åœ¨æœ¬åœ°ä»“åº“æ¨é€åˆ°è¿œç¨‹ä»“åº“</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">/d/github/gitPractice (temp)</span><br><span class="line"><span class="meta">$</span><span class="bash"> git remote -v</span></span><br><span class="line">origin  https://github.com/bugmakerprox/gitPractice.git (fetch)</span><br><span class="line">origin  https://github.com/bugmakerprox/gitPractice.git (push)</span><br><span class="line">zhineng file:///d/github/gitPracticeBackUpZhiNeng/zhi_neng.git (fetch)</span><br><span class="line">zhineng file:///d/github/gitPracticeBackUpZhiNeng/zhi_neng.git (push)</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> git add .</span></span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> git commit -m <span class="string">&quot;Add to zhineng&quot;</span></span></span><br><span class="line">[temp aa50d7b] Add to zhineng</span><br><span class="line"> 4 files changed, 31 insertions(+)</span><br><span class="line"> create mode 100644 .idea/.gitignore</span><br><span class="line"> create mode 100644 .idea/gitPractice.iml</span><br><span class="line"> create mode 100644 .idea/modules.xml</span><br><span class="line"> create mode 100644 .idea/vcs.xml</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<p>åœ¨å¤‡ä»½ä»“åº“(gitPracticeBackUpZhiNeng)æŸ¥çœ‹</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">pwd</span></span></span><br><span class="line">/d/github/gitPracticeBackUpZhiNeng/zhi_neng.git</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> ..</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> ls</span></span><br><span class="line">zhi_neng.git/</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<ol start="3">
<li>æ¢å¤<br>æ¢å¤è¿™éƒ¨åˆ†å†…å®¹ï¼Œæ•™ç¨‹é‡Œé¢æ²¡æœ‰æ¶‰åŠï¼Œè€Œä¸”å‰é¢ä¸¤æ­¥è®²çš„æ¯”è¾ƒç¬¼ç»Ÿï¼Œè™½ç„¶ä¸Šé¢<code>gitPracticeBackUpZhiNeng</code>å’Œ<code>gitPracticeBackUpYa</code>ç›®å½•å¹¶æ²¡æœ‰å·¥ç¨‹ä»£ç ï¼Œåªå¤‡ä»½äº†.gitæ–‡ä»¶ï¼Œå¤‡ä»½æ¢å¤æ¥è¯´å·²ç»è¶³å¤Ÿäº†ï¼Œä¸‹é¢å°±è®²ä¸€ä¸‹å¦‚ä½•åˆ©ç”¨<code>zhi_neng.git</code>åšæ¢å¤  </li>
</ol>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ä»»æ„ç›®å½•</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">clone</span> file:///d/github/gitPracticeBackUpZhiNeng/zhi_neng.git</span></span><br><span class="line">Cloning into &#x27;zhi_neng&#x27;...</span><br><span class="line">remote: Enumerating objects: 36, done.</span><br><span class="line">remote: Counting objects: 100% (36/36), done.</span><br><span class="line">remote: Compressing objects: 100% (20/20), done.</span><br><span class="line">remote: Total 36 (delta 11), reused 28 (delta 10), pack-reused 0</span><br><span class="line">Receiving objects: 100% (36/36), 23.54 KiB | 3.92 MiB/s, done.</span><br><span class="line">Resolving deltas: 100% (11/11), done.</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> <span class="built_in">cd</span> zhi_neng/</span></span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> ls</span></span><br><span class="line">README.md  images/  index.html  styles/</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> git branch -av</span></span><br><span class="line">* temp                aa50d7b Add to zhineng</span><br><span class="line">  remotes/origin/HEAD -&gt; origin/temp</span><br><span class="line">  remotes/origin/main 0007ea8 Change styles/style.css to ç‰ˆæœ¬åº“</span><br><span class="line">  remotes/origin/temp aa50d7b Add to zhineng</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<h2 id="æŠŠæœ¬åœ°ä»“åº“åŒæ­¥åˆ°github"><a href="#æŠŠæœ¬åœ°ä»“åº“åŒæ­¥åˆ°github" class="headerlink" title="æŠŠæœ¬åœ°ä»“åº“åŒæ­¥åˆ°github"></a>æŠŠæœ¬åœ°ä»“åº“åŒæ­¥åˆ°github</h2><div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> git remote add &lt;shortname&gt; &lt;url&gt; æ·»åŠ ä¸€ä¸ªæ–°çš„è¿œç¨‹ Git ä»“åº“</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git remote add github git@github.com:bugmakerprox/gitPractice.git</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git remote -v</span></span><br><span class="line">github  git@github.com:bugmakerprox/gitPractice.git (fetch)</span><br><span class="line">github  git@github.com:bugmakerprox/gitPractice.git (push)</span><br><span class="line">origin  https://github.com/bugmakerprox/gitPractice.git (fetch)</span><br><span class="line">origin  https://github.com/bugmakerprox/gitPractice.git (push)</span><br><span class="line">zhineng file:///d/github/gitPracticeBackUpZhiNeng/zhi_neng.git (fetch)</span><br><span class="line">zhineng file:///d/github/gitPracticeBackUpZhiNeng/zhi_neng.git (push)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> push</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git push github --all</span></span><br><span class="line">Enumerating objects: 34, done.</span><br><span class="line">Counting objects: 100% (34/34), done.</span><br><span class="line">Delta compression using up to 4 threads</span><br><span class="line">Compressing objects: 100% (29/29), done.</span><br><span class="line">Writing objects: 100% (33/33), 22.97 KiB | 1.35 MiB/s, done.</span><br><span class="line">Total 33 (delta 11), reused 0 (delta 0), pack-reused 0</span><br><span class="line">remote: Resolving deltas: 100% (11/11), done.</span><br><span class="line">To github.com:bugmakerprox/gitPractice.git</span><br><span class="line">   97ad728..0007ea8  main -&gt; main</span><br><span class="line"> * [new branch]      temp -&gt; temp</span><br><span class="line"></span><br></pre></td></tr></table></figure></div>

<h2 id="ä¸åŒäººä¿®æ”¹äº†ä¸åŒæ–‡ä»¶æˆ–è€…ä¸åŒäººä¿®æ”¹äº†åŒæ–‡ä»¶çš„ä¸åŒåŒºåŸŸå¦‚ä½•å¤„ç†"><a href="#ä¸åŒäººä¿®æ”¹äº†ä¸åŒæ–‡ä»¶æˆ–è€…ä¸åŒäººä¿®æ”¹äº†åŒæ–‡ä»¶çš„ä¸åŒåŒºåŸŸå¦‚ä½•å¤„ç†" class="headerlink" title="ä¸åŒäººä¿®æ”¹äº†ä¸åŒæ–‡ä»¶æˆ–è€…ä¸åŒäººä¿®æ”¹äº†åŒæ–‡ä»¶çš„ä¸åŒåŒºåŸŸå¦‚ä½•å¤„ç†"></a>ä¸åŒäººä¿®æ”¹äº†ä¸åŒæ–‡ä»¶æˆ–è€…ä¸åŒäººä¿®æ”¹äº†åŒæ–‡ä»¶çš„ä¸åŒåŒºåŸŸå¦‚ä½•å¤„ç†</h2><p>å…ˆ<code>git pull</code>ï¼Œå’Œè¿œç¨‹ä»“åº“åšä¸ªåŒæ­¥(æ‹‰å»å…¶ä»–äººçš„å˜æ›´)ï¼Œå†<code>git push</code>è‡ªå·±çš„å˜æ›´åˆ°è¿œç¨‹ä»“åº“</p>
<blockquote>
<p>git pull = git fetch + git merge <a href="https://www.zhihu.com/question/38305012">è¯¦æƒ…</a></p>
</blockquote>
<h2 id="ä¸åŒäººåŒæ–‡ä»¶çš„åŒåŒºåŸŸå¦‚ä½•å¤„ç†"><a href="#ä¸åŒäººåŒæ–‡ä»¶çš„åŒåŒºåŸŸå¦‚ä½•å¤„ç†" class="headerlink" title="ä¸åŒäººåŒæ–‡ä»¶çš„åŒåŒºåŸŸå¦‚ä½•å¤„ç†"></a>ä¸åŒäººåŒæ–‡ä»¶çš„åŒåŒºåŸŸå¦‚ä½•å¤„ç†</h2><ul>
<li>å…ˆ<code>git pull</code>ï¼Œå’Œè¿œç¨‹ä»“åº“åšä¸ªåŒæ­¥(æ‹‰å–å…¶ä»–äººçš„å˜æ›´)</li>
<li>è¿™æ—¶ä¼šæç¤ºå‘ç”Ÿäº†<code>CONFLICT</code>ï¼Œéœ€è¦å…ˆè§£å†³å†²çªï¼Œç¼–è¾‘äº§ç”Ÿå†²çªçš„æ–‡ä»¶(å»ºè®®é€šè¿‡ç¼–è¯‘å™¨å¦‚Golandè‡ªå¸¦çš„Git â€“&gt; Resolve Conflictæ¥è§£å†³)</li>
<li>å†é€šè¿‡<code>git status</code>æŸ¥çœ‹å†²çªæ˜¯å¦å®Œå…¨è§£å†³</li>
<li>å¦‚æœæ˜¯ï¼Œåˆ™é€šè¿‡<code>git commit</code>æäº¤å³å¯å®Œæˆå†²çªåˆå¹¶ï¼Œå¦‚æœè¦æ”¾å¼ƒmergeï¼Œéœ€è¦ä½¿ç”¨<code>git merge --abort</code>æ¥å®ç°ã€‚</li>
</ul>
<h2 id="åŒæ—¶å˜æ›´äº†æ–‡ä»¶åå’Œæ–‡ä»¶å†…å®¹å¦‚ä½•å¤„ç†"><a href="#åŒæ—¶å˜æ›´äº†æ–‡ä»¶åå’Œæ–‡ä»¶å†…å®¹å¦‚ä½•å¤„ç†" class="headerlink" title="åŒæ—¶å˜æ›´äº†æ–‡ä»¶åå’Œæ–‡ä»¶å†…å®¹å¦‚ä½•å¤„ç†"></a>åŒæ—¶å˜æ›´äº†æ–‡ä»¶åå’Œæ–‡ä»¶å†…å®¹å¦‚ä½•å¤„ç†</h2><p>åœºæ™¯ï¼š</p>
<ul>
<li>ç”²æŠŠæ–‡ä»¶<code>A.html</code>å˜æ›´ä¸ºäº†<code>B.html</code>ï¼Œå¹¶<code>git push</code>æäº¤åˆ°äº†è¿œç¨‹ä»“åº“</li>
<li>åŒæ—¶ä¹™åœ¨æœ¬åœ°å¯¹<code>A.html</code>æ–‡ä»¶å†…å®¹è¿›è¡Œäº†ä¿®æ”¹ï¼Œ<code>git push</code>æäº¤åˆ°è¿œç¨‹ä»“åº“ï¼Œæ­¤æ—¶ä¼šå‘ç”Ÿ<code>! [rejected]</code>æç¤º<br><img src="/2022/09/05/uncatalog/cl7oebs5q0000f0r7e0oq9fnk/rename.png" alt="img"></li>
</ul>
<p>è§£å†³ï¼š<br> ä¹™éœ€è¦å…ˆ<code>git pull</code>ï¼Œå¦‚æœæœ‰å†²çªéœ€è¦å’Œä¸Šä¸€æ­¥ä¸€æ ·è§£å†³å†²çªï¼Œå¦‚æœæ²¡æœ‰å†²çªï¼Œä¼šå‘ç°æœ¬åœ°æ–‡ä»¶<code>A.html</code>å˜æ›´ä¸ºäº†<code>B.html</code>ï¼Œå¹¶ä¸”ä¹‹å‰åœ¨æœ¬åœ°å¯¹<code>A.html</code>æ–‡ä»¶å†…å®¹çš„ä¿®æ”¹ä¹Ÿä¼šå‡ºç°åœ¨<code>B.html</code>æ–‡ä»¶ï¼Œå³gitæ™ºèƒ½çš„å¸®æˆ‘ä»¬å®Œæˆäº†åˆå¹¶ï¼Œæ¥ä¸‹æ¥ç»§ç»­<code>commit</code>å’Œ<code>push</code>æäº¤åˆ°è¿œç¨‹ä»“åº“å³å¯ã€‚</p>
<h2 id="å¤šäººä¿®æ”¹åŒä¸€æ–‡ä»¶çš„æ–‡ä»¶åå¦‚ä½•å¤„ç†"><a href="#å¤šäººä¿®æ”¹åŒä¸€æ–‡ä»¶çš„æ–‡ä»¶åå¦‚ä½•å¤„ç†" class="headerlink" title="å¤šäººä¿®æ”¹åŒä¸€æ–‡ä»¶çš„æ–‡ä»¶åå¦‚ä½•å¤„ç†"></a>å¤šäººä¿®æ”¹åŒä¸€æ–‡ä»¶çš„æ–‡ä»¶åå¦‚ä½•å¤„ç†</h2><p>åœºæ™¯ï¼š</p>
<ul>
<li>ç”²æŠŠæ–‡ä»¶<code>index.htm</code>å˜æ›´ä¸ºäº†<code>index2.htm</code>ï¼Œå¹¶<code>commit</code>å’Œ<code>push</code>æäº¤åˆ°äº†è¿œç¨‹ä»“åº“</li>
<li>ä¹™æŠŠæ–‡ä»¶<code>index.htm</code>å˜æ›´ä¸ºäº†<code>index1.htm</code>ï¼Œå¹¶é€šè¿‡<code>commit</code>å’Œ<code>push</code>åšæäº¤ï¼Œæ­¤æ—¶ä¼šå‘ç”Ÿ<code>! [rejected]</code>æç¤º<br><img src="/2022/09/05/uncatalog/cl7oebs5q0000f0r7e0oq9fnk/rename1.png" alt="img"></li>
</ul>
<p>è§£å†³ï¼š<br>ä¹™éœ€è¦å…ˆ<code>git pull</code>ï¼Œä¼šæç¤ºå†²çª:<br><img src="/2022/09/05/uncatalog/cl7oebs5q0000f0r7e0oq9fnk/re3.png" alt="img"><br>æŸ¥çœ‹æœ¬åœ°æ–‡ä»¶ï¼Œä¼šå‘ç°åŒæ—¶å‡ºç°äº†<code>index1.htm</code>å’Œ<code>index2.htm</code>ä¸¤ä¸ªæ–‡ä»¶ï¼Œé€šè¿‡<code>git status</code>æŸ¥çœ‹ä¸€ä¸‹:<br><img src="/2022/09/05/uncatalog/cl7oebs5q0000f0r7e0oq9fnk/3.png" alt="img"><br>æç¤ºéå¸¸è¯¦ç»†ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">both deleted: index.htm</span><br><span class="line">added by us : index1.htm</span><br><span class="line">added by them : index2.htm</span><br></pre></td></tr></table></figure></div>
<p>åŒæ—¶ä¹Ÿç»™å‡ºäº†æ“ä½œå»ºè®®ï¼š</p>
<div class="highlight-wrap"autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" contenteditable="true"data-rel="SHELL"><figure class="iseeu highlight /shell"><table><tr><td class="code"><pre><span class="line">Unmerged pahts:</span><br><span class="line">   (use &quot;git add/rm &lt;file&gt;...&quot; as appropriate to mark resolution)</span><br></pre></td></tr></table></figure></div>
<p>ç”²å’Œä¹™åå•†<code>index.htm</code>æœ€ç»ˆéœ€è¦ç¡®å®šçš„åç§°ä¹‹åï¼Œæ¯”å¦‚<code>index1.htm</code>ï¼Œè¿›è¡Œå¦‚ä¸‹æ“ä½œ</p>
<ul>
<li><code>git rm index.htm</code></li>
<li><code>git rm index2.htm</code></li>
<li><code>git add index1.htm</code><br>æŸ¥çœ‹<code>git status</code>:<br><img src="/2022/09/05/uncatalog/cl7oebs5q0000f0r7e0oq9fnk/4.png" alt="img"></li>
</ul>
<p>å†²çªå·²ç»è§£å†³ï¼Œæ¥ä¸‹æ¥<code>git commit</code>å’Œ<code>git push</code>å³å¯ã€‚</p>
<h2 id="ç¦æ­¢å‘é›†æˆåˆ†æ”¯æ‰§è¡Œgit-push-fæ“ä½œ"><a href="#ç¦æ­¢å‘é›†æˆåˆ†æ”¯æ‰§è¡Œgit-push-fæ“ä½œ" class="headerlink" title="ç¦æ­¢å‘é›†æˆåˆ†æ”¯æ‰§è¡Œgit push -fæ“ä½œ"></a>ç¦æ­¢å‘é›†æˆåˆ†æ”¯æ‰§è¡Œ<code>git push -f</code>æ“ä½œ</h2><h2 id="ç¦æ­¢å‘é›†æˆåˆ†æ”¯æ‰§è¡Œå˜æ›´å†å²çš„æ“ä½œ"><a href="#ç¦æ­¢å‘é›†æˆåˆ†æ”¯æ‰§è¡Œå˜æ›´å†å²çš„æ“ä½œ" class="headerlink" title="ç¦æ­¢å‘é›†æˆåˆ†æ”¯æ‰§è¡Œå˜æ›´å†å²çš„æ“ä½œ"></a>ç¦æ­¢å‘é›†æˆåˆ†æ”¯æ‰§è¡Œå˜æ›´å†å²çš„æ“ä½œ</h2><h2 id="Some-tips"><a href="#Some-tips" class="headerlink" title="Some tips"></a>Some tips</h2><ol>
<li>windowsç³»ç»Ÿä¸­ï¼Œ<code>git commit -m &quot;Add file or files&quot;</code> æäº¤è¯´æ˜å»ºè®®ç”¨åŒå¼•å·ï¼Œä»¥å…å‡ºç°ä¸å¯é¢„çŸ¥çš„é”™è¯¯</li>
<li><code>git commit -m &quot;Add file or files&quot;</code>ï¼Œæäº¤è¯´æ˜ï¼Œå»ºè®®ç¬¬ä¸€ä¸ªå•è¯(<code>Add</code>)çš„é¦–å­—æ¯å¤§å†™</li>
<li>å¯¹äºgitå·²ç»è·Ÿè¸ªçš„æ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹å˜æ›´åï¼Œå»ºè®®ä½¿ç”¨<code>git add -u</code></li>
<li>å¯¹äºgitå·²ç»è·Ÿè¸ªçš„æ–‡ä»¶ï¼Œå¦‚æœè¦å¯¹å…¶è¿›è¡Œé‡å‘½åï¼Œå»ºè®®ä½¿ç”¨<code>git mv oldName newName</code>,ç„¶åç›´æ¥commit</li>
<li><code>git add</code> å’Œ<code>git commit -m </code>å¯ä»¥åˆå¹¶ä¸ºä¸€ä¸ªå‘½ä»¤<code>git commit -am</code></li>
</ol>
]]></content>
      <tags>
        <tag>git</tag>
      </tags>
  </entry>
</search>
